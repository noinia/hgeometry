<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BlockArguments #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase   #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="annot"><span class="hs-comment">-- | JavaScript code generator</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.StgToJS.CodeGen.html"><span class="hs-identifier">GHC.StgToJS.CodeGen</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#stgToJS"><span class="hs-identifier">stgToJS</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html"><span class="hs-identifier">GHC.Driver.Flags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier">DumpFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_js"><span class="hs-identifier">Opt_D_dump_js</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Ppr.html"><span class="hs-identifier">GHC.JS.Ppr</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html"><span class="hs-identifier">GHC.JS.JStg.Syntax</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html"><span class="hs-identifier">GHC.JS.Ident</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Make.html"><span class="hs-identifier">GHC.JS.Make</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Transform.html"><span class="hs-identifier">GHC.JS.Transform</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Optimizer.html"><span class="hs-identifier">GHC.JS.Optimizer</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html"><span class="hs-identifier">GHC.StgToJS.Arg</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Sinker.html"><span class="hs-identifier">GHC.StgToJS.Sinker</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html"><span class="hs-identifier">GHC.StgToJS.Types</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html"><span class="hs-identifier">GHC.StgToJS.Object</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Object</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Utils.html"><span class="hs-identifier">GHC.StgToJS.Utils</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Deps.html"><span class="hs-identifier">GHC.StgToJS.Deps</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Expr.html"><span class="hs-identifier">GHC.StgToJS.Expr</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.ExprCtx.html"><span class="hs-identifier">GHC.StgToJS.ExprCtx</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Monad.html"><span class="hs-identifier">GHC.StgToJS.Monad</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Profiling.html"><span class="hs-identifier">GHC.StgToJS.Profiling</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Regs.html"><span class="hs-identifier">GHC.StgToJS.Regs</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.StaticPtr.html"><span class="hs-identifier">GHC.StgToJS.StaticPtr</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Symbols.html"><span class="hs-identifier">GHC.StgToJS.Symbols</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Stack.html"><span class="hs-identifier">GHC.StgToJS.Stack</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html"><span class="hs-identifier">GHC.StgToJS.Ids</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier">scaledThing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier">SptEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html"><span class="hs-identifier">GHC.Types.ForeignStubs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignStubs.html#ForeignStubs"><span class="hs-identifier">ForeignStubs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#getCHeader"><span class="hs-identifier">getCHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#getCStub"><span class="hs-identifier">getCStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.html"><span class="hs-identifier">GHC.Utils.Encoding</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html"><span class="hs-identifier">GHC.Utils.Binary</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html"><span class="hs-identifier">Control.Monad.Trans.State.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Monoid.html"><span class="hs-identifier">Data.Monoid</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><span class="hs-comment">-- | Code generator for JavaScript</span></span><span>
</span><span id="line-68"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#stgToJS"><span class="hs-identifier hs-type">stgToJS</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StgToJSConfig"><span class="hs-identifier hs-type">StgToJSConfig</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Output file name</span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="stgToJS"><span class="annot"><span class="annottext">stgToJS :: Logger
-&gt; StgToJSConfig
-&gt; [CgStgTopBinding]
-&gt; Module
-&gt; [SptEntry]
-&gt; ForeignStubs
-&gt; CollectedCCs
-&gt; FilePath
-&gt; IO ()
</span><a href="GHC.StgToJS.CodeGen.html#stgToJS"><span class="hs-identifier hs-var hs-var">stgToJS</span></a></span></span><span> </span><span id="local-6989586621682897009"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682897009"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682897010"><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682897010"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682897011"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682897011"><span class="hs-identifier hs-var">stg_binds0</span></a></span></span><span> </span><span id="local-6989586621682897012"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682897012"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621682897013"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621682897013"><span class="hs-identifier hs-var">spt_entries</span></a></span></span><span> </span><span id="local-6989586621682897014"><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621682897014"><span class="hs-identifier hs-var">foreign_stubs</span></a></span></span><span> </span><span id="local-6989586621682897015"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621682897015"><span class="hs-identifier hs-var">cccs</span></a></span></span><span> </span><span id="local-6989586621682897016"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682897016"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682897017"><span class="annot"><span class="annottext">UniqFM Id CgStgExpr
</span><a href="#local-6989586621682897017"><span class="hs-identifier hs-var hs-var">unfloated_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682897018"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682897018"><span class="hs-identifier hs-var hs-var">stg_binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
-&gt; [CgStgTopBinding] -&gt; (UniqFM Id CgStgExpr, [CgStgTopBinding])
</span><a href="GHC.StgToJS.Sinker.html#sinkPgm"><span class="hs-identifier hs-var">sinkPgm</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682897012"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682897011"><span class="hs-identifier hs-var">stg_binds0</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- TODO: avoid top level lifting in core-2-core when the JS backend is</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-comment">-- enabled instead of undoing it here</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-comment">-- TODO: add dump pass for optimized STG ast for JS</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682897020"><span class="annot"><a href="#local-6989586621682897020"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682897021"><span class="annot"><a href="#local-6989586621682897021"><span class="hs-identifier hs-var">lus</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
-&gt; Module
-&gt; UniqFM Id CgStgExpr
-&gt; G (BlockInfo, [LinkableUnit])
-&gt; IO (BlockInfo, [LinkableUnit])
forall a.
StgToJSConfig -&gt; Module -&gt; UniqFM Id CgStgExpr -&gt; G a -&gt; IO a
</span><a href="GHC.StgToJS.Monad.html#runG"><span class="hs-identifier hs-var">runG</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682897010"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682897012"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id CgStgExpr
</span><a href="#local-6989586621682897017"><span class="hs-identifier hs-var">unfloated_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(G (BlockInfo, [LinkableUnit]) -&gt; IO (BlockInfo, [LinkableUnit]))
-&gt; G (BlockInfo, [LinkableUnit]) -&gt; IO (BlockInfo, [LinkableUnit])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">G () -&gt; G ()
forall m. Monoid m =&gt; G m -&gt; G m
</span><a href="GHC.StgToJS.Profiling.html#ifProfilingM"><span class="hs-identifier hs-var">ifProfilingM</span></a></span><span> </span><span class="annot"><span class="annottext">(G () -&gt; G ()) -&gt; G () -&gt; G ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CollectedCCs -&gt; G ()
</span><a href="GHC.StgToJS.Profiling.html#initCostCentres"><span class="hs-identifier hs-var">initCostCentres</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621682897015"><span class="hs-identifier hs-var">cccs</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621682897025"><span class="annot"><a href="#local-6989586621682897025"><span class="hs-identifier hs-var">lus</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
Module
-&gt; [CgStgTopBinding]
-&gt; [SptEntry]
-&gt; ForeignStubs
-&gt; G [LinkableUnit]
Module
-&gt; [CgStgTopBinding]
-&gt; [SptEntry]
-&gt; ForeignStubs
-&gt; G [LinkableUnit]
</span><a href="GHC.StgToJS.CodeGen.html#genUnits"><span class="hs-identifier hs-var">genUnits</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682897012"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682897018"><span class="hs-identifier hs-var">stg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621682897013"><span class="hs-identifier hs-var">spt_entries</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621682897014"><span class="hs-identifier hs-var">foreign_stubs</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621682897027"><span class="annot"><a href="#local-6989586621682897027"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Deps.html#genDependencyData"><span class="hs-identifier hs-type">genDependencyData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897012"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897025"><span class="hs-identifier hs-type">lus</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682897027"><span class="hs-identifier hs-type">deps</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682897025"><span class="hs-identifier hs-type">lus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- Doc to dump when -ddump-js is enabled</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897009"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_js"><span class="hs-identifier hs-type">Opt_D_dump_js</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897009"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_js"><span class="hs-identifier hs-type">Opt_D_dump_js</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;JavaScript code&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatJS"><span class="hs-identifier hs-type">FormatJS</span></a></span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.JS.Ppr.html#jsToDoc"><span class="hs-identifier hs-type">jsToDoc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#oiStat"><span class="hs-identifier hs-var">oiStat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#luObjBlock"><span class="hs-identifier hs-var">luObjBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682897021"><span class="hs-identifier hs-type">lus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-comment">-- Write the object file</span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621682897038"><span class="annot"><a href="#local-6989586621682897038"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#openBinMem"><span class="hs-identifier hs-type">openBinMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">*</span></span><span> </span><span class="annot"><span class="hs-number">1000</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- a bit less than 4kB</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.Object.html#putObject"><span class="hs-identifier hs-type">Object.putObject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897038"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897012"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682897020"><span class="hs-identifier hs-type">deps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#luObjBlock"><span class="hs-identifier hs-var">luObjBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897021"><span class="hs-identifier hs-type">lus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-type">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-type">takeDirectory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897016"><span class="hs-identifier hs-type">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#writeBinMem"><span class="hs-identifier hs-type">writeBinMem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897038"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897016"><span class="hs-identifier hs-type">output_fn</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><span class="hs-comment">-- | Generate the ingredients for the linkable units for this module</span></span><span>
</span><span id="line-107"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#genUnits"><span class="hs-identifier hs-type">genUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-108"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-109"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a></span><span>
</span><span id="line-112"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ the linkable units</span></span><span>
</span><span id="line-113"></span><span id="genUnits"><span class="annot"><span class="annottext">genUnits :: HasDebugCallStack =&gt;
Module
-&gt; [CgStgTopBinding]
-&gt; [SptEntry]
-&gt; ForeignStubs
-&gt; G [LinkableUnit]
</span><a href="GHC.StgToJS.CodeGen.html#genUnits"><span class="hs-identifier hs-var hs-var">genUnits</span></a></span></span><span> </span><span id="local-6989586621682897054"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682897054"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682897055"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682897055"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span id="local-6989586621682897056"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621682897056"><span class="hs-identifier hs-var">spt_entries</span></a></span></span><span> </span><span id="local-6989586621682897057"><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621682897057"><span class="hs-identifier hs-var">foreign_stubs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621682897058"><span class="annot"><a href="#local-6989586621682897058"><span class="hs-identifier hs-var">gbl</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">G LinkableUnit
HasDebugCallStack =&gt; G LinkableUnit
</span><a href="#local-6989586621682897059"><span class="hs-identifier hs-var">generateGlobalBlock</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621682897060"><span class="annot"><a href="#local-6989586621682897060"><span class="hs-identifier hs-var">exports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682897061"><span class="hs-identifier hs-type">generateExportsBlock</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621682897062"><span class="annot"><a href="#local-6989586621682897062"><span class="hs-identifier hs-var">others</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682897063"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621682897055"><span class="hs-identifier hs-type">ss</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682897058"><span class="hs-identifier hs-type">gbl</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682897060"><span class="hs-identifier hs-type">exports</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682897062"><span class="hs-identifier hs-type">others</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><a href="#local-6989586621682897063"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-120"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                 </span><span class="hs-comment">-- the block we're generating (block 0 is the global unit for the module)</span><span>
</span><span id="line-121"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span>      </span><span id="local-6989586621682897063"><span class="annot"><span class="annottext">go :: HasDebugCallStack =&gt; Int -&gt; [CgStgTopBinding] -&gt; G [LinkableUnit]
</span><a href="#local-6989586621682897063"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682897073"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682897073"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LinkableUnit] -&gt; G [LinkableUnit]
forall a. a -&gt; StateT GenState IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682897074"><span class="annot"><span class="annottext">CgStgTopBinding
</span><a href="#local-6989586621682897074"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682897075"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682897075"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>          </span><span id="local-6989586621682897076"><span class="annot"><a href="#local-6989586621682897076"><span class="hs-identifier hs-var">mlu</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
CgStgTopBinding -&gt; Int -&gt; G (Maybe LinkableUnit)
CgStgTopBinding -&gt; Int -&gt; G (Maybe LinkableUnit)
</span><a href="#local-6989586621682897077"><span class="hs-identifier hs-var">generateBlock</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgTopBinding
</span><a href="#local-6989586621682897074"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682897073"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-127"></span><span>          </span><span id="local-6989586621682897078"><span class="annot"><a href="#local-6989586621682897078"><span class="hs-identifier hs-var">lus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682897063"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682897073"><span class="hs-identifier hs-type">n</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682897075"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-128"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682897078"><span class="hs-identifier hs-type">lus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-glyph">:</span></span><span class="annot"><span class="hs-identifier">lus</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682897076"><span class="hs-identifier hs-type">mlu</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-comment">--   Generate the global unit that all other blocks in the module depend on</span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-comment">--   used for cost centres and static initializers</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-comment">--   the global unit has no dependencies, exports the moduleGlobalSymbol</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="#local-6989586621682897059"><span class="hs-identifier hs-type">generateGlobalBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span id="local-6989586621682897059"><span class="annot"><span class="annottext">generateGlobalBlock :: HasDebugCallStack =&gt; G LinkableUnit
</span><a href="#local-6989586621682897059"><span class="hs-identifier hs-var hs-var">generateGlobalBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>        </span><span id="local-6989586621682897090"><span class="annot"><a href="#local-6989586621682897090"><span class="hs-identifier hs-var">glbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenState -&gt; [JStgStat]) -&gt; StateT GenState IO [JStgStat]
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-var">State.gets</span></a></span><span> </span><span class="annot"><span class="annottext">GenState -&gt; [JStgStat]
</span><a href="GHC.StgToJS.Types.html#gsGlobal"><span class="hs-identifier hs-var">gsGlobal</span></a></span><span>
</span><span id="line-136"></span><span>        </span><span id="local-6989586621682897093"><span class="annot"><a href="#local-6989586621682897093"><span class="hs-identifier hs-var">staticInit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-137"></span><span>          </span><span class="annot"><a href="GHC.StgToJS.StaticPtr.html#initStaticPtrs"><span class="hs-identifier hs-type">initStaticPtrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897056"><span class="hs-identifier hs-type">spt_entries</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897095"><span class="annot"><a href="#local-6989586621682897095"><span class="hs-identifier hs-var hs-var">stat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">JStgStat -&gt; JStat
</span><a href="GHC.JS.Transform.html#jStgStatToJS"><span class="hs-identifier hs-var">jStgStatToJS</span></a></span><span>
</span><span id="line-139"></span><span>                   </span><span class="annot"><span class="annottext">(JStgStat -&gt; JStat) -&gt; JStgStat -&gt; JStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[JStgStat] -&gt; JStgStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[JStgStat] -&gt; [JStgStat]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[JStgStat]
</span><a href="#local-6989586621682897090"><span class="hs-identifier hs-var">glbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">JStgStat -&gt; JStgStat -&gt; JStgStat
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">JStgStat
</span><a href="#local-6989586621682897093"><span class="hs-identifier hs-var">staticInit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897098"><span class="annot"><a href="#local-6989586621682897098"><span class="hs-identifier hs-var hs-var">opt_stat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat -&gt; JStat
</span><a href="GHC.JS.Optimizer.html#jsOptimize"><span class="hs-identifier hs-var">jsOptimize</span></a></span><span> </span><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682897095"><span class="hs-identifier hs-var">stat</span></a></span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897100"><span class="annot"><a href="#local-6989586621682897100"><span class="hs-identifier hs-var hs-var">syms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Module -&gt; FastString
</span><a href="GHC.StgToJS.Symbols.html#moduleGlobalSymbol"><span class="hs-identifier hs-var">moduleGlobalSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682897054"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897102"><span class="annot"><a href="#local-6989586621682897102"><span class="hs-identifier hs-var hs-var">oi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ObjBlock"><span class="hs-identifier hs-type">ObjBlock</span></a></span><span>
</span><span id="line-143"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">oiSymbols :: [FastString]
</span><a href="GHC.StgToJS.Types.html#oiSymbols"><span class="hs-identifier hs-var">oiSymbols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897100"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-144"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiClInfo :: [ClosureInfo]
</span><a href="GHC.StgToJS.Types.html#oiClInfo"><span class="hs-identifier hs-var">oiClInfo</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStatic :: [StaticInfo]
</span><a href="GHC.StgToJS.Types.html#oiStatic"><span class="hs-identifier hs-var">oiStatic</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-146"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStat :: JStat
</span><a href="GHC.StgToJS.Types.html#oiStat"><span class="hs-identifier hs-var">oiStat</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682897098"><span class="hs-identifier hs-var">opt_stat</span></a></span><span>
</span><span id="line-147"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiRaw :: ByteString
</span><a href="GHC.StgToJS.Types.html#oiRaw"><span class="hs-identifier hs-var">oiRaw</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-148"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFExports :: [ExpFun]
</span><a href="GHC.StgToJS.Types.html#oiFExports"><span class="hs-identifier hs-var">oiFExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFImports :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#oiFImports"><span class="hs-identifier hs-var">oiFImports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-150"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897110"><span class="annot"><a href="#local-6989586621682897110"><span class="hs-identifier hs-var hs-var">lu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span>
</span><span id="line-152"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">luObjBlock :: ObjBlock
</span><a href="GHC.StgToJS.Types.html#luObjBlock"><span class="hs-identifier hs-var">luObjBlock</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjBlock
</span><a href="#local-6989586621682897102"><span class="hs-identifier hs-var">oi</span></a></span><span>
</span><span id="line-153"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdExports :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdExports"><span class="hs-identifier hs-var">luIdExports</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherExports :: [FastString]
</span><a href="GHC.StgToJS.Types.html#luOtherExports"><span class="hs-identifier hs-var">luOtherExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897100"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-155"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdDeps :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdDeps"><span class="hs-identifier hs-var">luIdDeps</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luPseudoIdDeps :: [Unique]
</span><a href="GHC.StgToJS.Types.html#luPseudoIdDeps"><span class="hs-identifier hs-var">luPseudoIdDeps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherDeps :: [OtherSymb]
</span><a href="GHC.StgToJS.Types.html#luOtherDeps"><span class="hs-identifier hs-var">luOtherDeps</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luRequired :: Bool
</span><a href="GHC.StgToJS.Types.html#luRequired"><span class="hs-identifier hs-var">luRequired</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-159"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luForeignRefs :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#luForeignRefs"><span class="hs-identifier hs-var">luForeignRefs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682897110"><span class="hs-identifier hs-type">lu</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><a href="#local-6989586621682897061"><span class="hs-identifier hs-type">generateExportsBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span>
</span><span id="line-164"></span><span>      </span><span id="local-6989586621682897061"><span class="annot"><span class="annottext">generateExportsBlock :: HasDebugCallStack =&gt; G LinkableUnit
</span><a href="#local-6989586621682897061"><span class="hs-identifier hs-var hs-var">generateExportsBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682897126"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682897126"><span class="hs-identifier hs-var hs-var">f_hdr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682897127"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682897127"><span class="hs-identifier hs-var hs-var">f_c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621682897057"><span class="hs-identifier hs-var">foreign_stubs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-166"></span><span>                                  </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="GHC.Types.ForeignStubs.html#NoStubs"><span class="hs-identifier hs-var">NoStubs</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>                                  </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a></span><span> </span><span id="local-6989586621682897131"><span class="annot"><span class="annottext">CHeader
</span><a href="#local-6989586621682897131"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span id="local-6989586621682897132"><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621682897132"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CHeader -&gt; SDoc
</span><a href="GHC.Types.ForeignStubs.html#getCHeader"><span class="hs-identifier hs-var">getCHeader</span></a></span><span> </span><span class="annot"><span class="annottext">CHeader
</span><a href="#local-6989586621682897131"><span class="hs-identifier hs-var">hdr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CStub -&gt; SDoc
</span><a href="GHC.Types.ForeignStubs.html#getCStub"><span class="hs-identifier hs-var">getCStub</span></a></span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621682897132"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>            </span><span id="local-6989586621682897133"><span class="annot"><span class="annottext">unique_deps :: [Unique]
</span><a href="#local-6989586621682897133"><span class="hs-identifier hs-var hs-var hs-var">unique_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Unique) -&gt; [FilePath] -&gt; [Unique]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Unique
</span><a href="#local-6989586621682897134"><span class="hs-identifier hs-var">mkUniqueDep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><span class="hs-identifier hs-var">lines</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; [FilePath]) -&gt; FilePath -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; FilePath
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682897126"><span class="hs-identifier hs-var">f_hdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>            </span><span id="local-6989586621682897134"><span class="annot"><span class="annottext">mkUniqueDep :: FilePath -&gt; Unique
</span><a href="#local-6989586621682897134"><span class="hs-identifier hs-var hs-var hs-var">mkUniqueDep</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682897142"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682897142"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682897143"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682897143"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word64 -&gt; Unique
</span><a href="GHC.Types.Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682897142"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Word64
forall a. Read a =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682897143"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>            </span><span class="annot"><a href="#local-6989586621682897134"><span class="hs-identifier hs-var">mkUniqueDep</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Unique
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;mkUniqueDep&quot;</span></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897147"><span class="annot"><span class="annottext">syms :: [FastString]
</span><a href="#local-6989586621682897147"><span class="hs-identifier hs-var hs-var hs-var">syms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Module -&gt; FastString
</span><a href="GHC.StgToJS.Symbols.html#moduleExportsSymbol"><span class="hs-identifier hs-var">moduleExportsSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682897054"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897149"><span class="annot"><span class="annottext">raw :: ByteString
</span><a href="#local-6989586621682897149"><span class="hs-identifier hs-var hs-var hs-var">raw</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ByteString
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.UTF8.html#utf8EncodeByteString"><span class="hs-identifier hs-var">utf8EncodeByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; ByteString) -&gt; FilePath -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; FilePath
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682897127"><span class="hs-identifier hs-var">f_c</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897151"><span class="annot"><span class="annottext">oi :: ObjBlock
</span><a href="#local-6989586621682897151"><span class="hs-identifier hs-var hs-var hs-var">oi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ObjBlock"><span class="hs-identifier hs-type">ObjBlock</span></a></span><span>
</span><span id="line-175"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">oiSymbols :: [FastString]
</span><a href="GHC.StgToJS.Types.html#oiSymbols"><span class="hs-identifier hs-var">oiSymbols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897147"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-176"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiClInfo :: [ClosureInfo]
</span><a href="GHC.StgToJS.Types.html#oiClInfo"><span class="hs-identifier hs-var">oiClInfo</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStatic :: [StaticInfo]
</span><a href="GHC.StgToJS.Types.html#oiStatic"><span class="hs-identifier hs-var">oiStatic</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-178"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStat :: JStat
</span><a href="GHC.StgToJS.Types.html#oiStat"><span class="hs-identifier hs-var">oiStat</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-179"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiRaw :: ByteString
</span><a href="GHC.StgToJS.Types.html#oiRaw"><span class="hs-identifier hs-var">oiRaw</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682897149"><span class="hs-identifier hs-var">raw</span></a></span><span>
</span><span id="line-180"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFExports :: [ExpFun]
</span><a href="GHC.StgToJS.Types.html#oiFExports"><span class="hs-identifier hs-var">oiFExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-181"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFImports :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#oiFImports"><span class="hs-identifier hs-var">oiFImports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-182"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897152"><span class="annot"><span class="annottext">lu :: LinkableUnit
</span><a href="#local-6989586621682897152"><span class="hs-identifier hs-var hs-var">lu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span>
</span><span id="line-184"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">luObjBlock :: ObjBlock
</span><a href="GHC.StgToJS.Types.html#luObjBlock"><span class="hs-identifier hs-var">luObjBlock</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjBlock
</span><a href="#local-6989586621682897151"><span class="hs-identifier hs-var">oi</span></a></span><span>
</span><span id="line-185"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdExports :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdExports"><span class="hs-identifier hs-var">luIdExports</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherExports :: [FastString]
</span><a href="GHC.StgToJS.Types.html#luOtherExports"><span class="hs-identifier hs-var">luOtherExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897147"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-187"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdDeps :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdDeps"><span class="hs-identifier hs-var">luIdDeps</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-188"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luPseudoIdDeps :: [Unique]
</span><a href="GHC.StgToJS.Types.html#luPseudoIdDeps"><span class="hs-identifier hs-var">luPseudoIdDeps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682897133"><span class="hs-identifier hs-var">unique_deps</span></a></span><span>
</span><span id="line-189"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherDeps :: [OtherSymb]
</span><a href="GHC.StgToJS.Types.html#luOtherDeps"><span class="hs-identifier hs-var">luOtherDeps</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luRequired :: Bool
</span><a href="GHC.StgToJS.Types.html#luRequired"><span class="hs-identifier hs-var">luRequired</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-191"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luForeignRefs :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#luForeignRefs"><span class="hs-identifier hs-var">luForeignRefs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-192"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">LinkableUnit -&gt; G LinkableUnit
forall a. a -&gt; StateT GenState IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LinkableUnit
</span><a href="#local-6989586621682897152"><span class="hs-identifier hs-var">lu</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>      </span><span class="hs-comment">--   Generate the linkable unit for one binding or group of</span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-comment">--   mutually recursive bindings</span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><a href="#local-6989586621682897077"><span class="hs-identifier hs-type">generateBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-198"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span>
</span><span id="line-199"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-200"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>      </span><span id="local-6989586621682897077"><span class="annot"><span class="annottext">generateBlock :: HasDebugCallStack =&gt;
CgStgTopBinding -&gt; Int -&gt; G (Maybe LinkableUnit)
</span><a href="#local-6989586621682897077"><span class="hs-identifier hs-var hs-var">generateBlock</span></a></span></span><span> </span><span id="local-6989586621682897189"><span class="annot"><span class="annottext">CgStgTopBinding
</span><a href="#local-6989586621682897189"><span class="hs-identifier hs-var">top_bind</span></a></span></span><span> </span><span id="local-6989586621682897190"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682897190"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CgStgTopBinding
</span><a href="#local-6989586621682897189"><span class="hs-identifier hs-var">top_bind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621682897192"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897192"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span id="local-6989586621682897193"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682897193"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>          </span><span id="local-6989586621682897194"><span class="annot"><a href="#local-6989586621682897194"><span class="hs-identifier hs-var">bids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; G [Ident]
</span><a href="GHC.StgToJS.Ids.html#identsForId"><span class="hs-identifier hs-var">identsForId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897192"><span class="hs-identifier hs-var">bnd</span></a></span><span>
</span><span id="line-204"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682897194"><span class="hs-identifier hs-type">bids</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682897197"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897197"><span class="hs-identifier hs-var">b1t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682897198"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897198"><span class="hs-identifier hs-var">b2t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>              </span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897197"><span class="hs-identifier hs-var">b1t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-var">StaticUnboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; StaticUnboxed
</span><a href="GHC.StgToJS.Types.html#StaticUnboxedString"><span class="hs-identifier hs-var">StaticUnboxedString</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682897193"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-207"></span><span>              </span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897198"><span class="hs-identifier hs-var">b2t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-var">StaticUnboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; StaticUnboxed
</span><a href="GHC.StgToJS.Types.html#StaticUnboxedStringOffset"><span class="hs-identifier hs-var">StaticUnboxedStringOffset</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682897193"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-208"></span><span>              </span><span id="local-6989586621682897203"><span class="annot"><a href="#local-6989586621682897203"><span class="hs-identifier hs-var">si</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenState -&gt; [StaticInfo]) -&gt; StateT GenState IO [StaticInfo]
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-var">State.gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGroupState -&gt; [StaticInfo]
</span><a href="GHC.StgToJS.Types.html#ggsStatic"><span class="hs-identifier hs-var">ggsStatic</span></a></span><span> </span><span class="annot"><span class="annottext">(GenGroupState -&gt; [StaticInfo])
-&gt; (GenState -&gt; GenGroupState) -&gt; GenState -&gt; [StaticInfo]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenState -&gt; GenGroupState
</span><a href="GHC.StgToJS.Types.html#gsGroup"><span class="hs-identifier hs-var">gsGroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897206"><span class="annot"><a href="#local-6989586621682897206"><span class="hs-identifier hs-var hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897192"><span class="hs-identifier hs-var">bnd</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-210"></span><span>              </span><span id="local-6989586621682897207"><span class="annot"><a href="#local-6989586621682897207"><span class="hs-identifier hs-var">syms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682897208"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897208"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897208"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html#identForId"><span class="hs-identifier hs-type">identForId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897192"><span class="hs-identifier hs-type">bnd</span></a></span><span>
</span><span id="line-211"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897211"><span class="annot"><a href="#local-6989586621682897211"><span class="hs-identifier hs-var hs-var">oi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ObjBlock"><span class="hs-identifier hs-type">ObjBlock</span></a></span><span>
</span><span id="line-212"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">oiSymbols :: [FastString]
</span><a href="GHC.StgToJS.Types.html#oiSymbols"><span class="hs-identifier hs-var">oiSymbols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897207"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-213"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiClInfo :: [ClosureInfo]
</span><a href="GHC.StgToJS.Types.html#oiClInfo"><span class="hs-identifier hs-var">oiClInfo</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStatic :: [StaticInfo]
</span><a href="GHC.StgToJS.Types.html#oiStatic"><span class="hs-identifier hs-var">oiStatic</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StaticInfo]
</span><a href="#local-6989586621682897203"><span class="hs-identifier hs-var">si</span></a></span><span>
</span><span id="line-215"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStat :: JStat
</span><a href="GHC.StgToJS.Types.html#oiStat"><span class="hs-identifier hs-var">oiStat</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-216"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiRaw :: ByteString
</span><a href="GHC.StgToJS.Types.html#oiRaw"><span class="hs-identifier hs-var">oiRaw</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-217"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFExports :: [ExpFun]
</span><a href="GHC.StgToJS.Types.html#oiFExports"><span class="hs-identifier hs-var">oiFExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-218"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFImports :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#oiFImports"><span class="hs-identifier hs-var">oiFImports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-220"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897212"><span class="annot"><a href="#local-6989586621682897212"><span class="hs-identifier hs-var hs-var">lu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span>
</span><span id="line-221"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">luObjBlock :: ObjBlock
</span><a href="GHC.StgToJS.Types.html#luObjBlock"><span class="hs-identifier hs-var">luObjBlock</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjBlock
</span><a href="#local-6989586621682897211"><span class="hs-identifier hs-var">oi</span></a></span><span>
</span><span id="line-222"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdExports :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdExports"><span class="hs-identifier hs-var">luIdExports</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682897206"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-223"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherExports :: [FastString]
</span><a href="GHC.StgToJS.Types.html#luOtherExports"><span class="hs-identifier hs-var">luOtherExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-224"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdDeps :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdDeps"><span class="hs-identifier hs-var">luIdDeps</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luPseudoIdDeps :: [Unique]
</span><a href="GHC.StgToJS.Types.html#luPseudoIdDeps"><span class="hs-identifier hs-var">luPseudoIdDeps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherDeps :: [OtherSymb]
</span><a href="GHC.StgToJS.Types.html#luOtherDeps"><span class="hs-identifier hs-var">luOtherDeps</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luRequired :: Bool
</span><a href="GHC.StgToJS.Types.html#luRequired"><span class="hs-identifier hs-var">luRequired</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-228"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luForeignRefs :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#luForeignRefs"><span class="hs-identifier hs-var">luForeignRefs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-230"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682897212"><span class="hs-identifier hs-type">lu</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>            </span><span class="annot"><span class="annottext">[Ident]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; G (Maybe LinkableUnit)
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;generateBlock: invalid size&quot;</span></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span id="local-6989586621682897214"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682897214"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>          </span><span id="local-6989586621682897215"><span class="annot"><a href="#local-6989586621682897215"><span class="hs-identifier hs-var">tl</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen -&gt; G JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#genToplevel"><span class="hs-identifier hs-var">genToplevel</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682897214"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-235"></span><span>          </span><span id="local-6989586621682897217"><span class="annot"><a href="#local-6989586621682897217"><span class="hs-identifier hs-var">extraTl</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-type">State.gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#ggsToplevelStats"><span class="hs-identifier hs-var">ggsToplevelStats</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#gsGroup"><span class="hs-identifier hs-var">gsGroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>          </span><span id="local-6989586621682897219"><span class="annot"><a href="#local-6989586621682897219"><span class="hs-identifier hs-var">ci</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-type">State.gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#ggsClosureInfo"><span class="hs-identifier hs-var">ggsClosureInfo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#gsGroup"><span class="hs-identifier hs-var">gsGroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>          </span><span id="local-6989586621682897221"><span class="annot"><a href="#local-6989586621682897221"><span class="hs-identifier hs-var">si</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-type">State.gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#ggsStatic"><span class="hs-identifier hs-var">ggsStatic</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#gsGroup"><span class="hs-identifier hs-var">gsGroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>          </span><span id="local-6989586621682897222"><span class="annot"><a href="#local-6989586621682897222"><span class="hs-identifier hs-var">unf</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-type">State.gets</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#gsUnfloated"><span class="hs-identifier hs-var">gsUnfloated</span></a></span><span>
</span><span id="line-239"></span><span>          </span><span id="local-6989586621682897224"><span class="annot"><a href="#local-6989586621682897224"><span class="hs-identifier hs-var">extraDeps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-type">State.gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#ggsExtraDeps"><span class="hs-identifier hs-var">ggsExtraDeps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#gsGroup"><span class="hs-identifier hs-var">gsGroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>          </span><span id="local-6989586621682897226"><span class="annot"><a href="#local-6989586621682897226"><span class="hs-identifier hs-var">fRefs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-type">State.gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#ggsForeignRefs"><span class="hs-identifier hs-var">ggsForeignRefs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#gsGroup"><span class="hs-identifier hs-var">gsGroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><a href="GHC.StgToJS.Monad.html#resetGroup"><span class="hs-identifier hs-type">resetGroup</span></a></span><span>
</span><span id="line-242"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897229"><span class="annot"><a href="#local-6989586621682897229"><span class="hs-identifier hs-var hs-var">allDeps</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM Id CgStgExpr -&gt; GenStgBinding 'CodeGen -&gt; [Id]
</span><a href="GHC.StgToJS.Utils.html#collectIds"><span class="hs-identifier hs-var">collectIds</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id CgStgExpr
</span><a href="#local-6989586621682897222"><span class="hs-identifier hs-var">unf</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682897214"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-243"></span><span>              </span><span id="local-6989586621682897231"><span class="annot"><a href="#local-6989586621682897231"><span class="hs-identifier hs-var hs-var">topDeps</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen -&gt; [Id]
</span><a href="GHC.StgToJS.Utils.html#collectTopIds"><span class="hs-identifier hs-var">collectTopIds</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682897214"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-244"></span><span>              </span><span id="local-6989586621682897233"><span class="annot"><a href="#local-6989586621682897233"><span class="hs-identifier hs-var hs-var">required</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#hasExport"><span class="hs-identifier hs-var">hasExport</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682897214"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-245"></span><span>              </span><span id="local-6989586621682897235"><span class="annot"><a href="#local-6989586621682897235"><span class="hs-identifier hs-var hs-var">stat</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStgStat -&gt; JStat
</span><a href="GHC.JS.Transform.html#jStgStatToJS"><span class="hs-identifier hs-var">jStgStatToJS</span></a></span><span>
</span><span id="line-246"></span><span>                         </span><span class="annot"><span class="annottext">(JStgStat -&gt; JStat) -&gt; JStgStat -&gt; JStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[JStgStat] -&gt; JStgStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[JStgStat] -&gt; [JStgStat]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[JStgStat]
</span><a href="#local-6989586621682897217"><span class="hs-identifier hs-var">extraTl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">JStgStat -&gt; JStgStat -&gt; JStgStat
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">JStgStat
</span><a href="#local-6989586621682897215"><span class="hs-identifier hs-var">tl</span></a></span><span>
</span><span id="line-247"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897236"><span class="annot"><a href="#local-6989586621682897236"><span class="hs-identifier hs-var hs-var">opt_stat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat -&gt; JStat
</span><a href="GHC.JS.Optimizer.html#jsOptimize"><span class="hs-identifier hs-var">jsOptimize</span></a></span><span> </span><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682897235"><span class="hs-identifier hs-var">stat</span></a></span><span>
</span><span id="line-248"></span><span>          </span><span id="local-6989586621682897237"><span class="annot"><a href="#local-6989586621682897237"><span class="hs-identifier hs-var">syms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682897239"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897239"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682897239"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html#identForId"><span class="hs-identifier hs-type">identForId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682897231"><span class="hs-identifier hs-type">topDeps</span></a></span><span>
</span><span id="line-249"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897240"><span class="annot"><a href="#local-6989586621682897240"><span class="hs-identifier hs-var hs-var">oi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ObjBlock"><span class="hs-identifier hs-type">ObjBlock</span></a></span><span>
</span><span id="line-250"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">oiSymbols :: [FastString]
</span><a href="GHC.StgToJS.Types.html#oiSymbols"><span class="hs-identifier hs-var">oiSymbols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897237"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-251"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiClInfo :: [ClosureInfo]
</span><a href="GHC.StgToJS.Types.html#oiClInfo"><span class="hs-identifier hs-var">oiClInfo</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ClosureInfo]
</span><a href="#local-6989586621682897219"><span class="hs-identifier hs-var">ci</span></a></span><span>
</span><span id="line-252"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStatic :: [StaticInfo]
</span><a href="GHC.StgToJS.Types.html#oiStatic"><span class="hs-identifier hs-var">oiStatic</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StaticInfo]
</span><a href="#local-6989586621682897221"><span class="hs-identifier hs-var">si</span></a></span><span>
</span><span id="line-253"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiStat :: JStat
</span><a href="GHC.StgToJS.Types.html#oiStat"><span class="hs-identifier hs-var">oiStat</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682897236"><span class="hs-identifier hs-var">opt_stat</span></a></span><span>
</span><span id="line-254"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiRaw :: ByteString
</span><a href="GHC.StgToJS.Types.html#oiRaw"><span class="hs-identifier hs-var">oiRaw</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-255"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFExports :: [ExpFun]
</span><a href="GHC.StgToJS.Types.html#oiFExports"><span class="hs-identifier hs-var">oiFExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oiFImports :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#oiFImports"><span class="hs-identifier hs-var">oiFImports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ForeignJSRef]
</span><a href="#local-6989586621682897226"><span class="hs-identifier hs-var">fRefs</span></a></span><span>
</span><span id="line-257"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897241"><span class="annot"><a href="#local-6989586621682897241"><span class="hs-identifier hs-var hs-var">lu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier hs-type">LinkableUnit</span></a></span><span>
</span><span id="line-259"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">luObjBlock :: ObjBlock
</span><a href="GHC.StgToJS.Types.html#luObjBlock"><span class="hs-identifier hs-var">luObjBlock</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjBlock
</span><a href="#local-6989586621682897240"><span class="hs-identifier hs-var">oi</span></a></span><span>
</span><span id="line-260"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdExports :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdExports"><span class="hs-identifier hs-var">luIdExports</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682897231"><span class="hs-identifier hs-var">topDeps</span></a></span><span>
</span><span id="line-261"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherExports :: [FastString]
</span><a href="GHC.StgToJS.Types.html#luOtherExports"><span class="hs-identifier hs-var">luOtherExports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luIdDeps :: [Id]
</span><a href="GHC.StgToJS.Types.html#luIdDeps"><span class="hs-identifier hs-var">luIdDeps</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682897229"><span class="hs-identifier hs-var">allDeps</span></a></span><span>
</span><span id="line-263"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luPseudoIdDeps :: [Unique]
</span><a href="GHC.StgToJS.Types.html#luPseudoIdDeps"><span class="hs-identifier hs-var">luPseudoIdDeps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-264"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luOtherDeps :: [OtherSymb]
</span><a href="GHC.StgToJS.Types.html#luOtherDeps"><span class="hs-identifier hs-var">luOtherDeps</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set OtherSymb -&gt; [OtherSymb]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set OtherSymb
</span><a href="#local-6989586621682897224"><span class="hs-identifier hs-var">extraDeps</span></a></span><span>
</span><span id="line-265"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luRequired :: Bool
</span><a href="GHC.StgToJS.Types.html#luRequired"><span class="hs-identifier hs-var">luRequired</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682897233"><span class="hs-identifier hs-var">required</span></a></span><span>
</span><span id="line-266"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">luForeignRefs :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#luForeignRefs"><span class="hs-identifier hs-var">luForeignRefs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ForeignJSRef]
</span><a href="#local-6989586621682897226"><span class="hs-identifier hs-var">fRefs</span></a></span><span>
</span><span id="line-267"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-268"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#seqList"><span class="hs-identifier hs-type">seqList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897231"><span class="hs-identifier hs-type">topDeps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#seqList"><span class="hs-identifier hs-type">seqList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897229"><span class="hs-identifier hs-type">allDeps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682897241"><span class="hs-identifier hs-type">lu</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><span class="hs-comment">-- | variable prefix for the nth block in module</span></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#genToplevel"><span class="hs-identifier hs-type">genToplevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgBinding"><span class="hs-identifier hs-type">CgStgBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgStat"><span class="hs-identifier hs-type">JStgStat</span></a></span><span>
</span><span id="line-273"></span><span id="genToplevel"><span class="annot"><span class="annottext">genToplevel :: GenStgBinding 'CodeGen -&gt; G JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#genToplevel"><span class="hs-identifier hs-var hs-var">genToplevel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621682897247"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621682897247"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621682897248"><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897248"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; GenStgRhs 'CodeGen -&gt; G JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#genToplevelDecl"><span class="hs-identifier hs-var">genToplevelDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Id
BinderP 'CodeGen
</span><a href="#local-6989586621682897247"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897248"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-274"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#genToplevel"><span class="hs-identifier hs-var">genToplevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621682897251"><span class="annot"><span class="annottext">[(BinderP 'CodeGen, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621682897251"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">[JStgStat] -&gt; JStgStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([JStgStat] -&gt; JStgStat)
-&gt; StateT GenState IO [JStgStat] -&gt; G JStgStat
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Id, GenStgRhs 'CodeGen) -&gt; G JStgStat)
-&gt; [(Id, GenStgRhs 'CodeGen)] -&gt; StateT GenState IO [JStgStat]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682897252"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897252"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682897253"><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897253"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; GenStgRhs 'CodeGen -&gt; G JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#genToplevelDecl"><span class="hs-identifier hs-var">genToplevelDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897252"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897253"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Id, GenStgRhs 'CodeGen)]
[(BinderP 'CodeGen, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621682897251"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#genToplevelDecl"><span class="hs-identifier hs-type">genToplevelDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgStat"><span class="hs-identifier hs-type">JStgStat</span></a></span><span>
</span><span id="line-278"></span><span id="genToplevelDecl"><span class="annot"><span class="annottext">genToplevelDecl :: Id -&gt; GenStgRhs 'CodeGen -&gt; G JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#genToplevelDecl"><span class="hs-identifier hs-var hs-var">genToplevelDecl</span></a></span></span><span> </span><span id="local-6989586621682897255"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897255"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682897256"><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897256"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="annottext">G () -&gt; G ()
forall a. G a -&gt; G a
</span><a href="GHC.StgToJS.Stack.html#resetSlots"><span class="hs-identifier hs-var">resetSlots</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; GenStgRhs 'CodeGen -&gt; G ()
</span><a href="GHC.StgToJS.CodeGen.html#genToplevelConEntry"><span class="hs-identifier hs-var">genToplevelConEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897255"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897256"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="annottext">G JStgStat -&gt; G JStgStat
forall a. G a -&gt; G a
</span><a href="GHC.StgToJS.Stack.html#resetSlots"><span class="hs-identifier hs-var">resetSlots</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; GenStgRhs 'CodeGen -&gt; G JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#genToplevelRhs"><span class="hs-identifier hs-var">genToplevelRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897255"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897256"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#genToplevelConEntry"><span class="hs-identifier hs-type">genToplevelConEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span id="genToplevelConEntry"><span class="annot"><span class="annottext">genToplevelConEntry :: Id -&gt; GenStgRhs 'CodeGen -&gt; G ()
</span><a href="GHC.StgToJS.CodeGen.html#genToplevelConEntry"><span class="hs-identifier hs-var hs-var">genToplevelConEntry</span></a></span></span><span> </span><span id="local-6989586621682897260"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897260"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682897261"><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897261"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897261"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-284"></span><span>   </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621682897263"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682897263"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621682897264"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682897264"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682897265"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682897265"><span class="hs-identifier hs-var">_mu</span></a></span></span><span> </span><span id="local-6989586621682897266"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621682897266"><span class="hs-identifier hs-var">_ts</span></a></span></span><span> </span><span id="local-6989586621682897267"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682897267"><span class="hs-identifier hs-var">_args</span></a></span></span><span> </span><span id="local-6989586621682897268"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682897268"><span class="hs-identifier hs-var">_typ</span></a></span></span><span>
</span><span id="line-285"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDataConWorkId"><span class="hs-identifier hs-var">isDataConWorkId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897260"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-286"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; DataCon -&gt; LiveVars -&gt; G ()
Id -&gt; DataCon -&gt; LiveVars -&gt; G ()
</span><a href="GHC.StgToJS.CodeGen.html#genSetConInfo"><span class="hs-identifier hs-var">genSetConInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897260"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682897264"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen -&gt; LiveVars
</span><a href="GHC.StgToJS.Utils.html#stgRhsLive"><span class="hs-identifier hs-var">stgRhsLive</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897261"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NoSRT</span><span>
</span><span id="line-287"></span><span>   </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682897273"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682897273"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621682897274"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621682897274"><span class="hs-identifier hs-var">_upd_flag</span></a></span></span><span> </span><span id="local-6989586621682897275"><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621682897275"><span class="hs-identifier hs-var">_args</span></a></span></span><span> </span><span id="local-6989586621682897276"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682897276"><span class="hs-identifier hs-var">_body</span></a></span></span><span> </span><span id="local-6989586621682897277"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682897277"><span class="hs-identifier hs-var">_typ</span></a></span></span><span>
</span><span id="line-288"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682897278"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682897278"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConWorkId_maybe"><span class="hs-identifier hs-var">isDataConWorkId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897260"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-289"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; DataCon -&gt; LiveVars -&gt; G ()
Id -&gt; DataCon -&gt; LiveVars -&gt; G ()
</span><a href="GHC.StgToJS.CodeGen.html#genSetConInfo"><span class="hs-identifier hs-var">genSetConInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897260"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682897278"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen -&gt; LiveVars
</span><a href="GHC.StgToJS.Utils.html#stgRhsLive"><span class="hs-identifier hs-var">stgRhsLive</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897261"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- srt</span><span>
</span><span id="line-290"></span><span>   </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; G ()
forall a. a -&gt; StateT GenState IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#genSetConInfo"><span class="hs-identifier hs-type">genSetConInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Utils.html#LiveVars"><span class="hs-identifier hs-type">LiveVars</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span id="genSetConInfo"><span class="annot"><span class="annottext">genSetConInfo :: HasDebugCallStack =&gt; Id -&gt; DataCon -&gt; LiveVars -&gt; G ()
</span><a href="GHC.StgToJS.CodeGen.html#genSetConInfo"><span class="hs-identifier hs-var hs-var">genSetConInfo</span></a></span></span><span> </span><span id="local-6989586621682897288"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897288"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682897289"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682897289"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682897290"><span class="annot"><span class="annottext">LiveVars
</span><a href="#local-6989586621682897290"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-comment">{- srt -}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621682897291"><span class="annot"><a href="#local-6989586621682897291"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForDataConEntryId"><span class="hs-identifier hs-var">identForDataConEntryId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897288"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span id="local-6989586621682897293"><span class="annot"><a href="#local-6989586621682897293"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Expr.html#genStaticRefs"><span class="hs-identifier hs-type">genStaticRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897290"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897295"><span class="annot"><a href="#local-6989586621682897295"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled Type -&gt; [JSRep]) -&gt; [Scaled Type] -&gt; [JSRep]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [JSRep]
Type -&gt; [JSRep]
</span><a href="GHC.StgToJS.Utils.html#typeJSRep"><span class="hs-identifier hs-var">typeJSRep</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; [JSRep])
-&gt; (Scaled Type -&gt; Type) -&gt; Scaled Type -&gt; [JSRep]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; (Scaled Type -&gt; Type) -&gt; Scaled Type -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConRepArgTys"><span class="hs-identifier hs-var">dataConRepArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682897289"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.Monad.html#emitClosureInfo"><span class="hs-identifier hs-type">emitClosureInfo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ClosureInfo"><span class="hs-identifier hs-type">ClosureInfo</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciVar"><span class="hs-identifier hs-var">ciVar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682897291"><span class="hs-identifier hs-type">ei</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciRegs"><span class="hs-identifier hs-var">ciRegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#CIRegs"><span class="hs-identifier hs-type">CIRegs</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#PtrV"><span class="hs-identifier hs-type">PtrV</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciName"><span class="hs-identifier hs-var">ciName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-type">mkFastString</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-type">renderWithContext</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-type">defaultSDocContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897289"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciLayout"><span class="hs-identifier hs-var">ciLayout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Utils.html#fixedLayout"><span class="hs-identifier hs-type">fixedLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897295"><span class="hs-identifier hs-type">fields</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciType"><span class="hs-identifier hs-var">ciType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#CICon"><span class="hs-identifier hs-type">CICon</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-type">dataConTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897289"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciStatic"><span class="hs-identifier hs-var">ciStatic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682897293"><span class="hs-identifier hs-type">sr</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.Monad.html#emitToplevel"><span class="hs-identifier hs-type">emitToplevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#mkDataEntry"><span class="hs-identifier hs-type">mkDataEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897291"><span class="hs-identifier hs-type">ei</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#mkDataEntry"><span class="hs-identifier hs-type">mkDataEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgStat"><span class="hs-identifier hs-type">JStgStat</span></a></span><span>
</span><span id="line-309"></span><span id="mkDataEntry"><span class="annot"><span class="annottext">mkDataEntry :: Ident -&gt; JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#mkDataEntry"><span class="hs-identifier hs-var hs-var">mkDataEntry</span></a></span></span><span> </span><span id="local-6989586621682897317"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682897317"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; [Ident] -&gt; JStgStat -&gt; JStgStat
</span><a href="GHC.JS.JStg.Syntax.html#FuncStat"><span class="hs-identifier hs-var">FuncStat</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682897317"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">JStgStat
</span><a href="GHC.JS.Make.html#returnStack"><span class="hs-identifier hs-var">returnStack</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#genToplevelRhs"><span class="hs-identifier hs-type">genToplevelRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgStat"><span class="hs-identifier hs-type">JStgStat</span></a></span><span>
</span><span id="line-312"></span><span class="hs-comment">-- general cases:</span><span>
</span><span id="line-313"></span><span id="genToplevelRhs"><span class="annot"><span class="annottext">genToplevelRhs :: Id -&gt; GenStgRhs 'CodeGen -&gt; G JStgStat
</span><a href="GHC.StgToJS.CodeGen.html#genToplevelRhs"><span class="hs-identifier hs-var hs-var">genToplevelRhs</span></a></span></span><span> </span><span id="local-6989586621682897320"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897320"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682897321"><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897321"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682897321"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621682897322"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682897322"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682897323"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682897323"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682897324"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682897324"><span class="hs-identifier hs-var">_mu</span></a></span></span><span> </span><span id="local-6989586621682897325"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621682897325"><span class="hs-identifier hs-var">_tys</span></a></span></span><span> </span><span id="local-6989586621682897326"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682897326"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682897327"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682897327"><span class="hs-identifier hs-var">_typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621682897328"><span class="annot"><a href="#local-6989586621682897328"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForId"><span class="hs-identifier hs-var">identForId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897320"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocConStatic"><span class="hs-identifier hs-type">allocConStatic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897328"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897322"><span class="hs-identifier hs-type">cc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897323"><span class="hs-identifier hs-type">con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897326"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621682897330"><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
</span><a href="#local-6989586621682897330"><span class="hs-identifier hs-var">_ext</span></a></span></span><span> </span><span id="local-6989586621682897331"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682897331"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682897332"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621682897332"><span class="hs-identifier hs-var">_upd_flag</span></a></span></span><span> </span><span class="hs-comment">{- srt -}</span><span> </span><span id="local-6989586621682897333"><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621682897333"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682897334"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682897334"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682897335"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682897335"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-comment">{-
      algorithm:
       - collect all Id refs that are in the global id cache
       - count usage in body for each ref
       - order by increasing use
       - prepend loading lives var to body: body can stay the same
    -}</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621682897336"><span class="annot"><a href="#local-6989586621682897336"><span class="hs-identifier hs-var">eid</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForEntryId"><span class="hs-identifier hs-var">identForEntryId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682897320"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621682897338"><span class="annot"><a href="#local-6989586621682897338"><span class="hs-identifier hs-var">idt</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html#identForId"><span class="hs-identifier hs-type">identForId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897320"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621682897339"><span class="annot"><a href="#local-6989586621682897339"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Expr.html#genBody"><span class="hs-identifier hs-type">genBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.ExprCtx.html#initExprCtx"><span class="hs-identifier hs-type">initExprCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897320"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.StgToJS.Regs.html#R2"><span class="hs-identifier hs-type">R2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897333"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897334"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897335"><span class="hs-identifier hs-type">typ</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621682897343"><span class="annot"><a href="#local-6989586621682897343"><span class="hs-identifier hs-var">global_occs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Monad.html#globalOccs"><span class="hs-identifier hs-type">globalOccs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897339"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897345"><span class="annot"><a href="#local-6989586621682897345"><span class="hs-identifier hs-var hs-var">eidt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682897336"><span class="hs-identifier hs-var">eid</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897346"><span class="annot"><a href="#local-6989586621682897346"><span class="hs-identifier hs-var hs-var">lidents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalOcc -&gt; Ident) -&gt; [GlobalOcc] -&gt; [Ident]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalOcc -&gt; Ident
</span><a href="GHC.StgToJS.Monad.html#global_ident"><span class="hs-identifier hs-var">global_ident</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalOcc]
</span><a href="#local-6989586621682897343"><span class="hs-identifier hs-var">global_occs</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897348"><span class="annot"><a href="#local-6989586621682897348"><span class="hs-identifier hs-var hs-var">lids</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalOcc -&gt; Id) -&gt; [GlobalOcc] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalOcc -&gt; Id
</span><a href="GHC.StgToJS.Monad.html#global_id"><span class="hs-identifier hs-var">global_id</span></a></span><span>    </span><span class="annot"><span class="annottext">[GlobalOcc]
</span><a href="#local-6989586621682897343"><span class="hs-identifier hs-var">global_occs</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897350"><span class="annot"><a href="#local-6989586621682897350"><span class="hs-identifier hs-var hs-var">lidents'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; FastString) -&gt; [Ident] -&gt; [FastString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621682897346"><span class="hs-identifier hs-var">lidents</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Types.html#CIStaticRefs"><span class="hs-identifier hs-type">CIStaticRefs</span></a></span><span> </span><span id="local-6989586621682897352"><span class="annot"><a href="#local-6989586621682897352"><span class="hs-identifier hs-var">sr0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Expr.html#genStaticRefsRhs"><span class="hs-identifier hs-type">genStaticRefsRhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897321"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682897354"><span class="annot"><a href="#local-6989586621682897354"><span class="hs-identifier hs-var hs-var">sri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; Bool) -&gt; [FastString] -&gt; [FastString]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897350"><span class="hs-identifier hs-var">lidents'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897352"><span class="hs-identifier hs-var">sr0</span></a></span><span>
</span><span id="line-336"></span><span>        </span><span id="local-6989586621682897356"><span class="annot"><a href="#local-6989586621682897356"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; CIStatic
</span><a href="GHC.StgToJS.Types.html#CIStaticRefs"><span class="hs-identifier hs-var">CIStaticRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682897354"><span class="hs-identifier hs-var">sri</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621682897357"><span class="annot"><a href="#local-6989586621682897357"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Expr.html#genEntryType"><span class="hs-identifier hs-type">genEntryType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897333"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621682897359"><span class="annot"><a href="#local-6989586621682897359"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Expr.html#loadLiveFun"><span class="hs-identifier hs-type">loadLiveFun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897348"><span class="hs-identifier hs-type">lids</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682897361"><span class="annot"><a href="#local-6989586621682897361"><span class="hs-identifier hs-var">static</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682897362"><span class="annot"><a href="#local-6989586621682897362"><span class="hs-identifier hs-var">regs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682897363"><span class="annot"><a href="#local-6989586621682897363"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682897357"><span class="hs-identifier hs-type">et</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#CIThunk"><span class="hs-identifier hs-type">CIThunk</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>          </span><span id="local-6989586621682897365"><span class="annot"><a href="#local-6989586621682897365"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Stack.html#updateThunk"><span class="hs-identifier hs-type">updateThunk</span></a></span><span>
</span><span id="line-343"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticThunk"><span class="hs-identifier hs-type">StaticThunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682897345"><span class="hs-identifier hs-type">eidt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticObjArg"><span class="hs-identifier hs-type">StaticObjArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897350"><span class="hs-identifier hs-type">lidents'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#CIRegs"><span class="hs-identifier hs-type">CIRegs</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#PtrV"><span class="hs-identifier hs-type">PtrV</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682897365"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticFun"><span class="hs-identifier hs-type">StaticFun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897345"><span class="hs-identifier hs-type">eidt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticObjArg"><span class="hs-identifier hs-type">StaticObjArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897350"><span class="hs-identifier hs-type">lidents'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-345"></span><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682897346"><span class="hs-identifier hs-type">lidents</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#CIRegs"><span class="hs-identifier hs-type">CIRegs</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">concatMap</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Utils.html#idJSRep"><span class="hs-identifier hs-type">idJSRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897333"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#CIRegs"><span class="hs-identifier hs-type">CIRegs</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#PtrV"><span class="hs-identifier hs-type">PtrV</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concatMap</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Utils.html#idJSRep"><span class="hs-identifier hs-type">idJSRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897333"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621682897372"><span class="annot"><a href="#local-6989586621682897372"><span class="hs-identifier hs-var">setcc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Profiling.html#ifProfiling"><span class="hs-identifier hs-type">ifProfiling</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-349"></span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682897357"><span class="hs-identifier hs-type">et</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#CIThunk"><span class="hs-identifier hs-type">CIThunk</span></a></span><span>
</span><span id="line-350"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.StgToJS.Profiling.html#enterCostCentreThunk"><span class="hs-identifier hs-type">enterCostCentreThunk</span></a></span><span>
</span><span id="line-351"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToJS.Profiling.html#enterCostCentreFun"><span class="hs-identifier hs-type">enterCostCentreFun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897331"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Monad.html#emitClosureInfo"><span class="hs-identifier hs-type">emitClosureInfo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ClosureInfo"><span class="hs-identifier hs-type">ClosureInfo</span></a></span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciVar"><span class="hs-identifier hs-var">ciVar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682897336"><span class="hs-identifier hs-type">eid</span></a></span><span>
</span><span id="line-354"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciRegs"><span class="hs-identifier hs-var">ciRegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682897362"><span class="hs-identifier hs-type">regs</span></a></span><span>
</span><span id="line-355"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciName"><span class="hs-identifier hs-var">ciName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682897338"><span class="hs-identifier hs-type">idt</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciLayout"><span class="hs-identifier hs-var">ciLayout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Utils.html#fixedLayout"><span class="hs-identifier hs-type">fixedLayout</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Utils.html#unaryTypeJSRep"><span class="hs-identifier hs-type">unaryTypeJSRep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682897348"><span class="hs-identifier hs-type">lids</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciType"><span class="hs-identifier hs-var">ciType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682897357"><span class="hs-identifier hs-type">et</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#ciStatic"><span class="hs-identifier hs-var">ciStatic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682897356"><span class="hs-identifier hs-type">sr</span></a></span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-360"></span><span>    </span><span id="local-6989586621682897378"><span class="annot"><a href="#local-6989586621682897378"><span class="hs-identifier hs-var">ccId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Profiling.html#costCentreStackLbl"><span class="hs-identifier hs-type">costCentreStackLbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897331"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-type">emitStatic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897338"><span class="hs-identifier hs-type">idt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897361"><span class="hs-identifier hs-type">static</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897378"><span class="hs-identifier hs-type">ccId</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#FuncStat"><span class="hs-identifier hs-type">FuncStat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682897336"><span class="hs-identifier hs-type">eid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682897359"><span class="hs-identifier hs-type">ll</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682897363"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682897372"><span class="hs-identifier hs-type">setcc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682897339"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-363"></span></pre></body></html>