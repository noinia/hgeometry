<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span> </span><span class="hs-comment">-- Wrinkle in Note [Trees That Grow]</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span> </span><span class="hs-comment">-- Wrinkle in Note [Trees That Grow]</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">{-
%
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html"><span class="hs-identifier">GHC.Tc.Gen.App</span></a></span><span>
</span><span id="line-18"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier">tcApp</span></a></span><span>
</span><span id="line-19"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier">tcInferSigma</span></a></span><span>
</span><span id="line-20"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier">tcExprPrag</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier">tcPolyExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html"><span class="hs-identifier">GHC.Tc.Gen.Head</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier">tcGetFamInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst_maybe"><span class="hs-identifier">tcLookupDataFamInst_maybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html"><span class="hs-identifier">GHC.Tc.Utils.Concrete</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#unifyConcrete"><span class="hs-identifier">unifyConcrete</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#idConcreteTvs"><span class="hs-identifier">idConcreteTvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html"><span class="hs-identifier">GHC.Tc.Utils.Concrete</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier">ConLike</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#dataConConcreteTyVars"><span class="hs-identifier">dataConConcreteTyVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#isNewDataCon"><span class="hs-identifier">isNewDataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier">dataConTyCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier">substTyWithInScope</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier">multiplicityTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html#tagToEnumKey"><span class="hs-identifier">tagToEnumKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier">emptyTidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier">mkInScopeSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#isBoxed"><span class="hs-identifier">isBoxed</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Quick Look overview
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">{- Note [Quick Look overview]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The implementation of Quick Look closely follows the QL paper
   A quick look at impredicativity, Serrano et al, ICFP 2020
   https://www.microsoft.com/en-us/research/publication/a-quick-look-at-impredicativity/

All the moving parts are in this module, GHC.Tc.Gen.App, so named
because it deal with n-ary application.  The main workhorse is tcApp.

Some notes relative to the paper

(QL1) The &quot;instantiation variables&quot; of the paper are ordinary unification
  variables.  We keep track of which variables are instantiation variables
  by giving them a TcLevel of QLInstVar, which is like &quot;infinity&quot;.

(QL2) When we learn what an instantiation variable must be, we simply unify
  it with that type; this is done in qlUnify, which is the function mgu_ql(t1,t2)
  of the paper.  This may fill in a (mutable) instantiation variable with
  a polytype.

(QL3) When QL is done, we turn the instantiation variables into ordinary unification
  variables, using qlZonkTcType.  This function fully zonks the type (thereby
  revealing all the polytypes), and updates any instantiation variables with
  ordinary unification variables.
  See Note [Instantiation variables are short lived].

(QL4) We cleverly avoid the quadratic cost of QL, alluded to in the paper.
  See Note [Quick Look at value arguments]

Note [Instantiation variables are short lived]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* An instantation variable is a mutable meta-type-variable, whose level number
  is QLInstVar.

* Ordinary unification variables always stand for monotypes; only instantiation
  variables can be unified with a polytype (by `qlUnify`).

* When we start typechecking the argments of the call, in tcValArgs, we will
  (a) monomorphise any un-filled-in instantiation variables
      (see Note [Monomorphise instantiation variables])
  (b) zonk the argument type to reveal any polytypes before typechecking that
      argument (see calls to `zonkTcType` and &quot;Crucial step&quot; in tcValArg)..
  See Section 4.3 &quot;Applications and instantiation&quot; of the paper.

* The constraint solver never sees an instantiation variable [not quite true;
  see below]

  However, the constraint solver can see a meta-type-variable filled
  in with a polytype (#18987). Suppose
    f :: forall a. Dict a =&gt; [a] -&gt; [a]
    xs :: [forall b. b-&gt;b]
  and consider the call (f xs).  QL will
  * Instantiate f, with a := kappa, where kappa is an instantiation variable
  * Emit a constraint (Dict kappa), via instantiateSigma, called from tcInstFun
  * Do QL on the argument, to discover kappa := forall b. b-&gt;b

  But by the time the third step has happened, the constraint has been emitted
  into the monad.  The constraint solver will later find it, and rewrite it to
  (Dict (forall b. b-&gt;b)). That's fine -- the constraint solver does no implicit
  instantiation (which is what makes it so tricky to have foralls hiding inside
  unification variables), so there is no difficulty with allowing those
  filled-in kappa's to persist.  (We could find them and zonk them away, but
  that would cost code and execution time, for no purpose.)

  Since the constraint solver does not do implicit instantiation (as the
  constraint generator does), the fact that a unification variable might stand
  for a polytype does not matter.

* Actually, sadly the constraint solver /can/ see an instantiation variable.
  Consider this from test VisFlag1_ql:
     f :: forall {k} {a :: k} (hk :: forall j. j -&gt; Type). hk a -&gt; ()

     bad_wild :: ()
     bad_wild = f @_ MkV
  In tcInstFun instantiate f with [k:=k0, a:=a0], and then encounter the `@_`,
  expecting it to have kind (forall j. j-&gt;Type).  We make a fresh variable (it'll
  be an instantiation variable since we are in tcInstFun) for the `_`, thus
  (_ : k0) and do `checkExpectedKind` to match up `k0` with `forall j. j-&gt;Type`.
  The unifier doesn't solve it (it does not unify instantiation variables) so
  it leaves it for the constraint solver.  Yuk.   It's hard to see what to do
  about this, but it seems to do no harm for the constraint solver to see the
  occasional instantiation variable.
-}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              tcInferSigma
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier hs-type">tcInferSigma</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- Used only to implement :type; see GHC.Tc.Module.tcRnExpr</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- True  &lt;=&gt; instantiate -- return a rho-type</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- False &lt;=&gt; don't instantiate -- return a sigma-type</span><span>
</span><span id="line-177"></span><span id="tcInferSigma"><span class="annot"><span class="annottext">tcInferSigma :: Bool -&gt; LHsExpr (GhcPass 'Renamed) -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier hs-var hs-var">tcInferSigma</span></a></span></span><span> </span><span id="local-6989586621683101851"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683101851"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683101853"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683101853"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683101854"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101854"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; TcM TcType -&gt; TcM TcType
forall a. HsExpr (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101854"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcType -&gt; TcM TcType) -&gt; TcM TcType -&gt; TcM TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM TcType -&gt; TcM TcType
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683101853"><span class="hs-identifier hs-var">loc</span></a></span><span>     </span><span class="annot"><span class="annottext">(TcM TcType -&gt; TcM TcType) -&gt; TcM TcType -&gt; TcM TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683101857"><span class="annot"><a href="#local-6989586621683101857"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683101858"><span class="annot"><a href="#local-6989586621683101858"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683101859"><span class="annot"><a href="#local-6989586621683101859"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101860"><span class="annot"><a href="#local-6989586621683101860"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-var">splitHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101854"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-181"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101862"><span class="annot"><a href="#local-6989586621683101862"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-type">wantQuickLook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101858"><span class="hs-identifier hs-type">rn_fun</span></a></span><span>
</span><span id="line-182"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683101864"><span class="annot"><a href="#local-6989586621683101864"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101865"><span class="annot"><a href="#local-6989586621683101865"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-type">tcInferAppHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101857"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683101867"><span class="annot"><a href="#local-6989586621683101867"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101868"><span class="annot"><a href="#local-6989586621683101868"><span class="hs-identifier hs-var">app_res_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-type">tcInstFun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101862"><span class="hs-identifier hs-type">do_ql</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101851"><span class="hs-identifier hs-type">inst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683101864"><span class="hs-identifier hs-type">tc_fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683101859"><span class="hs-identifier hs-type">fun_ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683101865"><span class="hs-identifier hs-type">fun_sigma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101860"><span class="hs-identifier hs-type">rn_args</span></a></span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-type">tcValArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101862"><span class="hs-identifier hs-type">do_ql</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101867"><span class="hs-identifier hs-type">inst_args</span></a></span><span>
</span><span id="line-185"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683101868"><span class="hs-identifier hs-type">app_res_sigma</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Typechecking n-ary applications
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">{- Note [Application chains and heads]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Quick Look treats application chains specially.  What is an
&quot;application chain&quot;?  See Fig 2, of the QL paper: &quot;A quick look at
impredicativity&quot; (ICFP'20). Here's the syntax:

app ::= head
     |  app expr            -- HsApp: ordinary application
     |  app @type           -- HsTypeApp: VTA
     |  expr `head` expr    -- OpApp: infix applications
     |  ( app )             -- HsPar: parens
     |  {-# PRAGMA #-} app  -- HsPragE: pragmas

head ::= f                -- HsVar:    variables
      |  fld              -- HsRecSel: record field selectors
      |  (expr :: ty)     -- ExprWithTySig: expr with user type sig
      |  lit              -- HsOverLit: overloaded literals
      |  other_expr       -- Other expressions

When tcExpr sees something that starts an application chain (namely,
any of the constructors in 'app' or 'head'), it invokes tcApp to
typecheck it: see Note [tcApp: typechecking applications].  However,
for HsPar and HsPragE, there is no tcWrapResult (which would
instantiate types, bypassing Quick Look), so nothing is gained by
using the application chain route, and we can just recurse to tcExpr.

A &quot;head&quot; has three special cases (for which we can infer a polytype
using tcInferAppHead_maybe); otherwise is just any old expression (for
which we can infer a rho-type (via tcInfer).

There is no special treatment for HsUnboundVar, HsOverLit etc, because
we can't get a polytype from them.

Left and right sections (e.g. (x +) and (+ x)) are not yet supported.
Probably left sections (x +) would be easy to add, since x is the
first arg of (+); but right sections are not so easy.  For symmetry
reasons I've left both unchanged, in GHC.Tc.Gen.Expr.

It may not be immediately obvious why ExprWithTySig (e::ty) should be
dealt with by tcApp, even when it is not applied to anything. Consider
   f :: [forall a. a-&gt;a] -&gt; Int
   ...(f (undefined :: forall b. b))...
Clearly this should work!  But it will /only/ work because if we
instantiate that (forall b. b) impredicatively!  And that only happens
in tcApp.

Note [tcApp: typechecking applications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tcApp implements the APP-Downarrow/Uparrow rule of
Fig 3, plus the modification in Fig 5, of the QL paper:
&quot;A quick look at impredicativity&quot; (ICFP'20).

It treats application chains (f e1 @ty e2) specially:

* So we can report errors like &quot;in the third argument of a call of f&quot;

* So we can do Visible Type Application (VTA), for which we must not
  eagerly instantiate the function part of the application.

* So that we can do Quick Look impredicativity.

tcApp works like this:

1. Use splitHsApps, which peels off
     HsApp, HsTypeApp, HsPrag, HsPar
   returning the function in the corner and the arguments

   splitHsApps can deal with infix as well as prefix application,
   and returns a Rebuilder to re-assemble the application after
   typechecking.

   The &quot;list of arguments&quot; is [HsExprArg], described in Note [HsExprArg].
   in GHC.Tc.Gen.Head

2. Use tcInferAppHead to infer the type of the function,
     as an (uninstantiated) TcSigmaType
   There are special cases for
     HsVar, HsRecSel, and ExprWithTySig
   Otherwise, delegate back to tcExpr, which
     infers an (instantiated) TcRhoType

   This isn't perfect. Consider this (which uses visible type application):
    (let { f :: forall a. a -&gt; a; f x = x } in f) @Int
   Since 'let' is not among the special cases for tcInferAppHead,
   we'll delegate back to tcExpr, which will instantiate f's type
   and the type application to @Int will fail.  Too bad!

3. Use tcInstFun to instantiate the function, Quick-Looking as we go.  This
   implements the |-inst judgement in Fig 4, plus the modification in Fig 5, of
   the QL paper: &quot;A quick look at impredicativity&quot; (ICFP'20).

   In tcInstFun we take a quick look at value arguments, using quickLookArg.
   See Note [Quick Look at value arguments].

   (TCAPP1) Crucially, just before `tcApp` calls `tcInstFun`, it sets the
       ambient TcLevel to QLInstVar, so all unification variables allocated by
       tcInstFun, and in the quick-looks it does at the arguments, will be
       instantiation variables.

   Consider (f (g (h x))).`tcApp` instantiates the call to `f`, and in doing
   so quick-looks at the argument(s), in this case (g (h x)).  But
   `quickLookArg` on (g (h x)) in turn instantiates `g` and quick-looks at
   /its/ argument(s), in this case (h x).  And so on recursively.  Key
   point: all these instantiations make instantiation variables.

Now we split into two cases:

4. Case NoQL: no Quick Look

   4.1 Use checkResultTy to connect the the result type.
       Do this /before/ checking the arguments; see
       Note [Unify with expected type before typechecking arguments]

   4.2 Check the arguments with `tcValArgs`.

   4.3 Use `finishApp` to wrap up.

5. Case DoQL: use Quick Look

   5.1 Use `quickLookResultType` to take a quick look at the result type,
       when in checking mode.  This is the shaded part of APP-Downarrow
       in Fig 5.  It also implements the key part of
       Note [Unify with expected type before typechecking arguments]

   5.2 Check the arguments with `tcValArgs`. Importantly, this will monomorphise
       all the instantiation variables of the call.
       See Note [Monomorphise instantiation variables].

   5.3 Use `zonkTcType` to expose the polymophism hidden under instantiation
       variables in `app_res_rho`, and the monomorphic versions of any
       un-unified instantiation variables.

   5.4 Use `checkResTy` to do the subsumption check as usual

   5.4 Use `finishApp` to wrap up

The funcion `finishApp` mainly calls `rebuildHsApps` to rebuild the
application; but it also does a couple of gruesome final checks:
  * Horrible newtype check
  * Special case for tagToEnum

(TCAPP2) There is a lurking difficulty in the above plan:
  * Before calling tcInstFun, we set the ambient level in the monad
    to QLInstVar (Step 2 above).
  * Then, when kind-checking the visible type args of the application,
    we may perhaps build an implication constraint.
  * That means we'll try to add 1 to the ambient level; which is a no-op.
  * So skolem escape checks won't work right.
  This is pretty exotic, so I'm just deferring it for now, leaving
  this note to alert you to the possiblity.

Note [Quick Look for particular Ids]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We switch on Quick Look (regardless of -XImpredicativeTypes) for certain
particular Ids:

* ($): For a long time GHC has had a special typing rule for ($), that
  allows it to type (runST $ foo), which requires impredicative instantiation
  of ($), without language flags.  It's a bit ad-hoc, but it's been that
  way for ages.  Using quickLookKeys is the only special treatment ($) needs
  now, which is a lot better.

* leftSection, rightSection: these are introduced by the expansion step in
  the renamer (Note [Handling overloaded and rebindable constructs] in
  GHC.Rename.Expr), and we want them to be instantiated impredicatively
  so that (f `op`), say, will work OK even if `f` is higher rank.
  See Note [Left and right sections] in GHC.Rename.Expr.

Note [Unify with expected type before typechecking arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this (#19364)
  data Pair a b = Pair a b
  baz :: MkPair Int Bool
  baz = MkPair &quot;yes&quot; &quot;no&quot;

We instantiate MkPair with `alpha`, `beta`, and push its argument
types (`alpha` and `beta`) into the arguments (&quot;yes&quot; and &quot;no&quot;).
But if we first unify the result type (Pair alpha beta) with the expected
type (Pair Int Bool) we will push the much more informative types
`Int` and `Bool` into the arguments.   This makes a difference:

Unify result type /after/ typechecking the args
    &#8226; Couldn't match type &#8216;[Char]&#8217; with &#8216;Bool&#8217;
      Expected type: Pair Foo Bar
        Actual type: Pair [Char] [Char]
    &#8226; In the expression: Pair &quot;yes&quot; &quot;no&quot;

Unify result type /before/ typechecking the args
    &#8226; Couldn't match type &#8216;[Char]&#8217; with &#8216;Bool&#8217;
      Expected: Foo
        Actual: String
    &#8226; In the first argument of &#8216;Pair&#8217;, namely &#8216;&quot;yes&quot;&#8217;

The latter is much better. That is why we call checkResultType before tcValArgs.
-}</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-type">tcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>   </span><span class="hs-comment">-- When checking, -XDeepSubsumption &lt;=&gt; deeply skolemised</span><span>
</span><span id="line-391"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- See Note [tcApp: typechecking applications]</span><span>
</span><span id="line-393"></span><span id="tcApp"><span class="annot"><span class="annottext">tcApp :: HsExpr (GhcPass 'Renamed) -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var hs-var">tcApp</span></a></span></span><span> </span><span id="local-6989586621683101871"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101871"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621683101872"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683101872"><span class="hs-identifier hs-var">exp_res_ty</span></a></span></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Step 1: Split the application chain</span><span>
</span><span id="line-395"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621683101873"><span class="annot"><a href="#local-6989586621683101873"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683101874"><span class="annot"><a href="#local-6989586621683101874"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101875"><span class="annot"><a href="#local-6989586621683101875"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101876"><span class="annot"><a href="#local-6989586621683101876"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-var">splitHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101871"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-396"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcApp {&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-397"></span><span>           </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn_expr:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101871"><span class="hs-identifier hs-type">rn_expr</span></a></span><span>
</span><span id="line-398"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn_fun:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101874"><span class="hs-identifier hs-type">rn_fun</span></a></span><span>
</span><span id="line-399"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;fun_ctxt:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101875"><span class="hs-identifier hs-type">fun_ctxt</span></a></span><span>
</span><span id="line-400"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn_args:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101876"><span class="hs-identifier hs-type">rn_args</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span>       </span><span class="hs-comment">-- Step 2: Infer the type of `fun`, the head of the application</span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683101882"><span class="annot"><a href="#local-6989586621683101882"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101883"><span class="annot"><a href="#local-6989586621683101883"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-type">tcInferAppHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101873"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-404"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683101884"><span class="annot"><a href="#local-6989586621683101884"><span class="hs-identifier hs-var hs-var">tc_head</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683101882"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101875"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>       </span><span class="hs-comment">-- Step 3: Instantiate the function type (taking a quick look at args)</span><span>
</span><span id="line-407"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101885"><span class="annot"><a href="#local-6989586621683101885"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-type">wantQuickLook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101874"><span class="hs-identifier hs-type">rn_fun</span></a></span><span>
</span><span id="line-408"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683101886"><span class="annot"><a href="#local-6989586621683101886"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101887"><span class="annot"><a href="#local-6989586621683101887"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#setQLInstLevel"><span class="hs-identifier hs-type">setQLInstLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101885"><span class="hs-identifier hs-type">do_ql</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>  </span><span class="hs-comment">-- See (TCAPP1) and (TCAPP2) in</span><span>
</span><span id="line-410"></span><span>                                         </span><span class="hs-comment">-- Note [tcApp: typechecking applications]</span><span>
</span><span id="line-411"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-type">tcInstFun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101885"><span class="hs-identifier hs-type">do_ql</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683101884"><span class="hs-identifier hs-type">tc_head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101883"><span class="hs-identifier hs-type">fun_sigma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101876"><span class="hs-identifier hs-type">rn_args</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683101885"><span class="hs-identifier hs-type">do_ql</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>            </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-var">NoQL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcApp:NoQL&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101874"><span class="hs-identifier hs-var">rn_fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101887"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>                         </span><span class="hs-comment">-- Step 4.1: subsumption check against expected result type</span><span>
</span><span id="line-417"></span><span>                         </span><span class="hs-comment">-- See Note [Unify with expected type before typechecking arguments]</span><span>
</span><span id="line-418"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101891"><span class="annot"><a href="#local-6989586621683101891"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; (HsExpr GhcTc, AppCtxt)
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM HsWrapper
forall (p :: TcPass).
HsExpr (GhcPass 'Renamed)
-&gt; (HsExpr GhcTc, AppCtxt)
-&gt; [HsExprArg p]
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.App.html#checkResultTy"><span class="hs-identifier hs-var">checkResultTy</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101871"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683101884"><span class="hs-identifier hs-var">tc_head</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683101886"><span class="hs-identifier hs-var">inst_args</span></a></span><span>
</span><span id="line-419"></span><span>                                                   </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101887"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683101872"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span>
</span><span id="line-420"></span><span>                         </span><span class="hs-comment">-- Step 4.2: typecheck the  arguments</span><span>
</span><span id="line-421"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101893"><span class="annot"><a href="#local-6989586621683101893"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-type">tcValArgs</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-type">NoQL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101886"><span class="hs-identifier hs-type">inst_args</span></a></span><span>
</span><span id="line-422"></span><span>                         </span><span class="hs-comment">-- Step 4.3: wrap up</span><span>
</span><span id="line-423"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#finishApp"><span class="hs-identifier hs-type">finishApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101884"><span class="hs-identifier hs-type">tc_head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101893"><span class="hs-identifier hs-type">tc_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101887"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101891"><span class="hs-identifier hs-type">res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>            </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcApp:DoQL&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101874"><span class="hs-identifier hs-var">rn_fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101887"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>                         </span><span class="hs-comment">-- Step 5.1: Take a quick look at the result type</span><span>
</span><span id="line-428"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-var">quickLookResultType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101887"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683101872"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span>
</span><span id="line-429"></span><span>                         </span><span class="hs-comment">-- Step 5.2: typecheck the arguments, and monomorphise</span><span>
</span><span id="line-430"></span><span>                         </span><span class="hs-comment">--           any un-unified instantiation variables</span><span>
</span><span id="line-431"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101897"><span class="annot"><a href="#local-6989586621683101897"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QLFlag -&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
</span><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-var">tcValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683101886"><span class="hs-identifier hs-var">inst_args</span></a></span><span>
</span><span id="line-432"></span><span>                         </span><span class="hs-comment">-- Step 5.3: typecheck the arguments</span><span>
</span><span id="line-433"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101898"><span class="annot"><a href="#local-6989586621683101898"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101887"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span>
</span><span id="line-434"></span><span>                         </span><span class="hs-comment">-- Step 5.4: subsumption check against the expected type</span><span>
</span><span id="line-435"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101901"><span class="annot"><a href="#local-6989586621683101901"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#checkResultTy"><span class="hs-identifier hs-type">checkResultTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101871"><span class="hs-identifier hs-type">rn_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101884"><span class="hs-identifier hs-type">tc_head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101886"><span class="hs-identifier hs-type">inst_args</span></a></span><span>
</span><span id="line-436"></span><span>                                                   </span><span class="annot"><a href="#local-6989586621683101898"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101872"><span class="hs-identifier hs-type">exp_res_ty</span></a></span><span>
</span><span id="line-437"></span><span>                         </span><span class="hs-comment">-- Step 5.5: wrap up</span><span>
</span><span id="line-438"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#finishApp"><span class="hs-identifier hs-type">finishApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101884"><span class="hs-identifier hs-type">tc_head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101897"><span class="hs-identifier hs-type">tc_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101898"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101901"><span class="hs-identifier hs-type">res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span id="local-6989586621683101176"><span class="annot"><a href="GHC.Tc.Gen.App.html#setQLInstLevel"><span class="hs-identifier hs-type">setQLInstLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101176"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101176"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-441"></span><span id="setQLInstLevel"><span class="annot"><span class="annottext">setQLInstLevel :: forall a. QLFlag -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#setQLInstLevel"><span class="hs-identifier hs-var hs-var">setQLInstLevel</span></a></span></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span id="local-6989586621683101902"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683101902"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcM a -&gt; TcM a
forall a. TcLevel -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier hs-var">setTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#QLInstVar"><span class="hs-identifier hs-var">QLInstVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683101902"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-442"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#setQLInstLevel"><span class="hs-identifier hs-var">setQLInstLevel</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-var">NoQL</span></a></span><span> </span><span id="local-6989586621683101905"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683101905"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683101905"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-type">quickLookResultType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- This function implements the shaded bit of rule APP-Downarrow in</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- Fig 5 of the QL paper: &quot;A quick look at impredicativity&quot; (ICFP'20).</span><span>
</span><span id="line-447"></span><span id="quickLookResultType"><span class="annot"><span class="annottext">quickLookResultType :: TcType -&gt; ExpRhoType -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-var hs-var">quickLookResultType</span></a></span></span><span> </span><span id="local-6989586621683101907"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101907"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621683101909"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101909"><span class="hs-identifier hs-var">exp_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-var">qlUnify</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101907"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101909"><span class="hs-identifier hs-var">exp_rho</span></a></span><span>
</span><span id="line-448"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-var">quickLookResultType</span></a></span><span>  </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span>           </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#finishApp"><span class="hs-identifier hs-type">finishApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-451"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-452"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span class="hs-comment">-- Do final checks and wrap up the result</span><span>
</span><span id="line-454"></span><span id="finishApp"><span class="annot"><span class="annottext">finishApp :: (HsExpr GhcTc, AppCtxt)
-&gt; [HsExprArg 'TcpTc] -&gt; TcType -&gt; HsWrapper -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#finishApp"><span class="hs-identifier hs-var hs-var">finishApp</span></a></span></span><span> </span><span id="local-6989586621683101911"><span class="annot"><span class="annottext">tc_head :: (HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683101911"><span class="hs-identifier hs-var">tc_head</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683101912"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683101912"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683101913"><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683101913"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span id="local-6989586621683101914"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101914"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span id="local-6989586621683101915"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683101915"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Horrible newtype check</span><span>
</span><span id="line-456"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#rejectRepPolyNewtypes"><span class="hs-identifier hs-var">rejectRepPolyNewtypes</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683101911"><span class="hs-identifier hs-var">tc_head</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101914"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>       </span><span class="hs-comment">-- Reconstruct, with a horrible special case for tagToEnum#.</span><span>
</span><span id="line-459"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683101917"><span class="annot"><a href="#local-6989586621683101917"><span class="hs-identifier hs-var">res_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-var">isTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683101912"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-460"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
-&gt; [HsExprArg 'TcpTc] -&gt; TcType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcTagToEnum"><span class="hs-identifier hs-var">tcTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683101911"><span class="hs-identifier hs-var">tc_head</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683101913"><span class="hs-identifier hs-var">tc_args</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101914"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-461"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683101911"><span class="hs-identifier hs-var">tc_head</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683101913"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-type">mkHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101915"><span class="hs-identifier hs-type">res_wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101917"><span class="hs-identifier hs-type">res_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span id="local-6989586621683101178"><span class="annot"><a href="GHC.Tc.Gen.App.html#checkResultTy"><span class="hs-identifier hs-type">checkResultTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-465"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Head</span><span>
</span><span id="line-466"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101178"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- Arguments, just error messages</span><span>
</span><span id="line-467"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>  </span><span class="hs-comment">-- Inferred type of the application; zonked to</span><span>
</span><span id="line-468"></span><span>                            </span><span class="hs-comment">--   expose foralls, but maybe not deeply instantiated</span><span>
</span><span id="line-469"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-comment">-- Expected type; this is deeply skolemised</span><span>
</span><span id="line-470"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span></span><span>
</span><span id="line-471"></span><span class="hs-comment">-- Connect up the inferred type of the application with the expected type</span><span>
</span><span id="line-472"></span><span class="hs-comment">-- This is usually just a unification, but with deep subsumption there is more to do</span><span>
</span><span id="line-473"></span><span id="checkResultTy"><span class="annot"><span class="annottext">checkResultTy :: forall (p :: TcPass).
HsExpr (GhcPass 'Renamed)
-&gt; (HsExpr GhcTc, AppCtxt)
-&gt; [HsExprArg p]
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.App.html#checkResultTy"><span class="hs-identifier hs-var hs-var">checkResultTy</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg p]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683101951"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101951"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span id="local-6989586621683101953"><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621683101953"><span class="hs-identifier hs-var">inf_res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683101954"><span class="annot"><a href="#local-6989586621683101954"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; InferResult -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#fillInferResult"><span class="hs-identifier hs-var">fillInferResult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101951"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621683101953"><span class="hs-identifier hs-var">inf_res</span></a></span><span>
</span><span id="line-475"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-type">mkWpCastN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101954"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#checkResultTy"><span class="hs-identifier hs-var">checkResultTy</span></a></span><span> </span><span id="local-6989586621683101957"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101957"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683101958"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683101958"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683101959"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101959"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683101960"><span class="annot"><span class="annottext">[HsExprArg p]
</span><a href="#local-6989586621683101960"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span> </span><span id="local-6989586621683101961"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101961"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621683101962"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101962"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- Unify with expected type from the context</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- See Note [Unify with expected type before typechecking arguments]</span><span>
</span><span id="line-480"></span><span class="hs-comment">--</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- Match up app_res_rho: the result type of rn_expr</span><span>
</span><span id="line-482"></span><span class="hs-comment">--     with res_ty:  the expected result type</span><span>
</span><span id="line-483"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM HsWrapper -&gt; TcM HsWrapper
</span><a href="#local-6989586621683101963"><span class="hs-identifier hs-var">perhaps_add_res_ty_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM HsWrapper -&gt; TcM HsWrapper) -&gt; TcM HsWrapper -&gt; TcM HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-484"></span><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683101964"><span class="annot"><a href="#local-6989586621683101964"><span class="hs-identifier hs-var">ds_flag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM DeepSubsumptionFlag
</span><a href="GHC.Tc.Utils.Unify.html#getDeepSubsumptionFlag"><span class="hs-identifier hs-var">getDeepSubsumptionFlag</span></a></span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkResultTy {&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-486"></span><span>          </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_fun:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101958"><span class="hs-identifier hs-type">tc_fun</span></a></span><span>
</span><span id="line-487"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;app_res_rho:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101961"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span>
</span><span id="line-488"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;res_ty:&quot;</span></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101962"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-489"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ds_flag:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101964"><span class="hs-identifier hs-type">ds_flag</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-490"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683101964"><span class="hs-identifier hs-type">ds_flag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-491"></span><span>          </span><span class="annot"><span class="annottext">DeepSubsumptionFlag
</span><a href="GHC.Tc.Utils.Unify.html#Shallow"><span class="hs-identifier hs-var">Shallow</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- No deep subsumption</span><span>
</span><span id="line-492"></span><span>             </span><span class="hs-comment">-- app_res_rho and res_ty are both rho-types,</span><span>
</span><span id="line-493"></span><span>             </span><span class="hs-comment">-- so with simple subsumption we can just unify them</span><span>
</span><span id="line-494"></span><span>             </span><span class="hs-comment">-- No need to zonk; the unifier does that</span><span>
</span><span id="line-495"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683101967"><span class="annot"><a href="#local-6989586621683101967"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyExprType"><span class="hs-identifier hs-var">unifyExprType</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101957"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101961"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101962"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-496"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkResultTy 1 }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101967"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-type">mkWpCastN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101967"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>          </span><span class="annot"><span class="annottext">DeepSubsumptionFlag
</span><a href="GHC.Tc.Utils.Unify.html#Deep"><span class="hs-identifier hs-var">Deep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="hs-comment">-- Deep subsumption</span><span>
</span><span id="line-500"></span><span>             </span><span class="hs-comment">-- Even though both app_res_rho and res_ty are rho-types,</span><span>
</span><span id="line-501"></span><span>             </span><span class="hs-comment">-- they may have nested polymorphism, so if deep subsumption</span><span>
</span><span id="line-502"></span><span>             </span><span class="hs-comment">-- is on we must call tcSubType.</span><span>
</span><span id="line-503"></span><span>             </span><span class="hs-comment">-- Zonk app_res_rho first, because QL may have instantiated some</span><span>
</span><span id="line-504"></span><span>             </span><span class="hs-comment">-- delta variables to polytypes, and tcSubType doesn't expect that</span><span>
</span><span id="line-505"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683101970"><span class="annot"><a href="#local-6989586621683101970"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; TcType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypeDS"><span class="hs-identifier hs-var">tcSubTypeDS</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683101957"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101961"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101962"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-506"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkResultTy 2 }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101961"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101962"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683101970"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-comment">-- perhaps_add_res_ty_ctxt: Inside an expansion, the addFunResCtxt stuff is</span><span>
</span><span id="line-510"></span><span>    </span><span class="hs-comment">-- more confusing than helpful because the function at the head isn't in</span><span>
</span><span id="line-511"></span><span>    </span><span class="hs-comment">-- the source program; it was added by the renamer.  See</span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-comment">-- Note [Handling overloaded and rebindable constructs] in GHC.Rename.Expr</span><span>
</span><span id="line-513"></span><span>    </span><span id="local-6989586621683101963"><span class="annot"><span class="annottext">perhaps_add_res_ty_ctxt :: TcM HsWrapper -&gt; TcM HsWrapper
</span><a href="#local-6989586621683101963"><span class="hs-identifier hs-var hs-var">perhaps_add_res_ty_ctxt</span></a></span></span><span> </span><span id="local-6989586621683101972"><span class="annot"><span class="annottext">TcM HsWrapper
</span><a href="#local-6989586621683101972"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-514"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#insideExpansion"><span class="hs-identifier hs-var">insideExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101959"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span>
</span><span id="line-515"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; TcM HsWrapper -&gt; TcM HsWrapper
forall a. AppCtxt -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Head.html#addHeadCtxt"><span class="hs-identifier hs-var">addHeadCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101959"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcM HsWrapper
</span><a href="#local-6989586621683101972"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
-&gt; [HsExprArg p]
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM HsWrapper
-&gt; TcM HsWrapper
forall (p :: TcPass) a.
HsExpr GhcTc
-&gt; [HsExprArg p] -&gt; TcType -&gt; ExpRhoType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Head.html#addFunResCtxt"><span class="hs-identifier hs-var">addFunResCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683101958"><span class="hs-identifier hs-var">tc_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg p]
</span><a href="#local-6989586621683101960"><span class="hs-identifier hs-var">inst_args</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101961"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683101962"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM HsWrapper -&gt; TcM HsWrapper) -&gt; TcM HsWrapper -&gt; TcM HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-518"></span><span>        </span><span class="annot"><span class="annottext">TcM HsWrapper
</span><a href="#local-6989586621683101972"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-521"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-type">tcValArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-522"></span><span class="hs-comment">-- Importantly, tcValArgs works left-to-right, so that by the time we</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- encounter an argument, we have monomorphised all the instantiation</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- variables that its type contains.  All that is left to do is an ordinary</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- zonkTcType.  See Note [Monomorphise instantiation variables].</span><span>
</span><span id="line-526"></span><span id="tcValArgs"><span class="annot"><span class="annottext">tcValArgs :: QLFlag -&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
</span><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-var hs-var">tcValArgs</span></a></span></span><span> </span><span id="local-6989586621683101977"><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683101977"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span id="local-6989586621683101978"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683101978"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExprArg 'TcpInst
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc))
-&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QLFlag
-&gt; HsExprArg 'TcpInst
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
</span><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-var">tcValArg</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683101977"><span class="hs-identifier hs-var">do_ql</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683101978"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-type">tcValArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span>    </span><span class="hs-comment">-- Actual argument</span><span>
</span><span id="line-529"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- Resulting argument</span><span>
</span><span id="line-530"></span><span id="tcValArg"><span class="annot"><span class="annottext">tcValArg :: QLFlag
-&gt; HsExprArg 'TcpInst
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
</span><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-var hs-var">tcValArg</span></a></span></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span id="local-6989586621683101982"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101982"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683101983"><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683101983"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; HsPragE (GhcPass (XPass 'TcpTc)) -&gt; HsExprArg 'TcpTc
forall (p :: TcPass).
AppCtxt -&gt; HsPragE (GhcPass (XPass p)) -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-var">EPrag</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101982"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed) -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-var">tcExprPrag</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed)
HsPragE (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683101983"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-var">tcValArg</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span id="local-6989586621683101985"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101985"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683101986"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683101986"><span class="hs-identifier hs-var">hty</span></a></span></span><span> </span><span id="local-6989586621683101987"><span class="annot"><span class="annottext">XETAType 'TcpInst
</span><a href="#local-6989586621683101987"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt
-&gt; LHsWcType (GhcPass 'Renamed)
-&gt; XETAType 'TcpTc
-&gt; HsExprArg 'TcpTc
forall (p :: TcPass).
AppCtxt
-&gt; LHsWcType (GhcPass 'Renamed) -&gt; XETAType p -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-var">ETypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101985"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683101986"><span class="hs-identifier hs-var">hty</span></a></span><span> </span><span class="annot"><span class="annottext">XETAType 'TcpInst
XETAType 'TcpTc
</span><a href="#local-6989586621683101987"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-var">tcValArg</span></a></span><span> </span><span id="local-6989586621683101988"><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683101988"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EHsWrap"><span class="hs-identifier hs-type">EHsWrap</span></a></span><span> </span><span id="local-6989586621683101991"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683101991"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">QLFlag -&gt; ZonkM () -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#whenQL"><span class="hs-identifier hs-var">whenQL</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683101988"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcRn ()) -&gt; ZonkM () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#qlMonoHsWrapper"><span class="hs-identifier hs-var">qlMonoHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683101991"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-533"></span><span>                                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpTc
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EHsWrap"><span class="hs-identifier hs-var">EHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683101991"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-comment">-- qlMonoHsWrapper: see Note [Monomorphise instantiation variables]</span><span>
</span><span id="line-535"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-var">tcValArg</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span id="local-6989586621683101994"><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683101994"><span class="hs-identifier hs-var">ew</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpTc
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683101994"><span class="hs-identifier hs-var">ew</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-var">tcValArg</span></a></span><span> </span><span id="local-6989586621683101995"><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683101995"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683101998"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101998"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-538"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102000"><span class="annot"><span class="annottext">larg :: LHsExpr (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683102000"><span class="hs-identifier hs-var">larg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102001"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102001"><span class="hs-identifier hs-var">arg_loc</span></a></span></span><span> </span><span id="local-6989586621683102002"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102002"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_arg_ty :: forall (p :: TcPass). HsExprArg p -&gt; XEVAType p
</span><a href="GHC.Tc.Gen.Head.html#ea_arg_ty"><span class="hs-identifier hs-var">ea_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102004"><span class="annot"><span class="annottext">XEVAType 'TcpInst
</span><a href="#local-6989586621683102004"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a. AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var">addArgCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101998"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
LHsExpr (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683102000"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcValArg&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-542"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683101998"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-543"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
XEVAType 'TcpInst
</span><a href="#local-6989586621683102004"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span><span>
</span><span id="line-544"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102002"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>         </span><span class="hs-comment">-- Crucial step: expose QL results before checking exp_arg_ty</span><span>
</span><span id="line-547"></span><span>         </span><span class="hs-comment">-- So far as the paper is concerned, this step applies</span><span>
</span><span id="line-548"></span><span>         </span><span class="hs-comment">-- the poly-substitution Theta, learned by QL, so that we</span><span>
</span><span id="line-549"></span><span>         </span><span class="hs-comment">-- &quot;see&quot; the polymorphism in that argument type. E.g.</span><span>
</span><span id="line-550"></span><span>         </span><span class="hs-comment">--    (:) e ids, where ids :: [forall a. a-&gt;a]</span><span>
</span><span id="line-551"></span><span>         </span><span class="hs-comment">--                     (:) :: forall p. p-&gt;[p]-&gt;[p]</span><span>
</span><span id="line-552"></span><span>         </span><span class="hs-comment">-- Then Theta = [p :-&gt; forall a. a-&gt;a], and we want</span><span>
</span><span id="line-553"></span><span>         </span><span class="hs-comment">-- to check 'e' with expected type (forall a. a-&gt;a)</span><span>
</span><span id="line-554"></span><span>         </span><span class="hs-comment">-- See Note [Instantiation variables are short lived]</span><span>
</span><span id="line-555"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621683102007"><span class="annot"><a href="#local-6989586621683102007"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683102008"><span class="annot"><a href="#local-6989586621683102008"><span class="hs-identifier hs-var">exp_arg_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683101995"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-556"></span><span>              </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ZonkM (Scaled TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM (Scaled TcType)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType))
-&gt; ZonkM (Scaled TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; ZonkM (Scaled TcType)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkScaledTcType"><span class="hs-identifier hs-var">zonkScaledTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
XEVAType 'TcpInst
</span><a href="#local-6989586621683102004"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span><span>
</span><span id="line-557"></span><span>              </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-var">NoQL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
XEVAType 'TcpInst
</span><a href="#local-6989586621683102004"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>         </span><span class="hs-comment">-- Now check the argument</span><span>
</span><span id="line-560"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102010"><span class="annot"><a href="#local-6989586621683102010"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102007"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-561"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-type">tcPolyExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102002"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102008"><span class="hs-identifier hs-type">exp_arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683101998"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-564"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102001"><span class="hs-identifier hs-type">arg_loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102010"><span class="hs-identifier hs-type">arg'</span></a></span><span>
</span><span id="line-565"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ea_arg_ty"><span class="hs-identifier hs-var">ea_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArg"><span class="hs-identifier hs-var">tcValArg</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArgQL"><span class="hs-identifier hs-type">EValArgQL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eaql_wanted :: HsExprArg 'TcpInst -&gt; WantedConstraints
</span><a href="GHC.Tc.Gen.Head.html#eaql_wanted"><span class="hs-identifier hs-var">eaql_wanted</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102048"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683102048"><span class="hs-identifier hs-var">wanted</span></a></span></span><span>
</span><span id="line-568"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_ctxt :: HsExprArg 'TcpInst -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#eaql_ctxt"><span class="hs-identifier hs-var">eaql_ctxt</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102050"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102050"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-569"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_arg_ty :: HsExprArg 'TcpInst -&gt; Scaled TcType
</span><a href="GHC.Tc.Gen.Head.html#eaql_arg_ty"><span class="hs-identifier hs-var">eaql_arg_ty</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102052"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102052"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span></span><span>
</span><span id="line-570"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_larg :: HsExprArg 'TcpInst -&gt; LHsExpr (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#eaql_larg"><span class="hs-identifier hs-var">eaql_larg</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102054"><span class="annot"><span class="annottext">larg :: LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102054"><span class="hs-identifier hs-var">larg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102055"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102055"><span class="hs-identifier hs-var">arg_loc</span></a></span></span><span> </span><span id="local-6989586621683102056"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102056"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_tc_fun :: HsExprArg 'TcpInst -&gt; (HsExpr GhcTc, AppCtxt)
</span><a href="GHC.Tc.Gen.Head.html#eaql_tc_fun"><span class="hs-identifier hs-var">eaql_tc_fun</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102058"><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683102058"><span class="hs-identifier hs-var">tc_head</span></a></span></span><span>
</span><span id="line-572"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_fun_ue :: HsExprArg 'TcpInst -&gt; UsageEnv
</span><a href="GHC.Tc.Gen.Head.html#eaql_fun_ue"><span class="hs-identifier hs-var">eaql_fun_ue</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102060"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621683102060"><span class="hs-identifier hs-var">head_ue</span></a></span></span><span>
</span><span id="line-573"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_args :: HsExprArg 'TcpInst -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#eaql_args"><span class="hs-identifier hs-var">eaql_args</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102062"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102062"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span>
</span><span id="line-574"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_encl :: HsExprArg 'TcpInst -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#eaql_encl"><span class="hs-identifier hs-var">eaql_encl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102064"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102064"><span class="hs-identifier hs-var">arg_influences_enclosing_call</span></a></span></span><span>
</span><span id="line-575"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_res_rho :: HsExprArg 'TcpInst -&gt; TcType
</span><a href="GHC.Tc.Gen.Head.html#eaql_res_rho"><span class="hs-identifier hs-var">eaql_res_rho</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102066"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102066"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a. AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var">addArgCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102050"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102054"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsExprArg 'TcpTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Expose QL results to tcSkolemise, as in EValArg case</span><span>
</span><span id="line-578"></span><span>         </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621683102067"><span class="annot"><a href="#local-6989586621683102067"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683102068"><span class="annot"><a href="#local-6989586621683102068"><span class="hs-identifier hs-var">exp_arg_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM (Scaled TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM (Scaled TcType)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType))
-&gt; ZonkM (Scaled TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; ZonkM (Scaled TcType)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkScaledTcType"><span class="hs-identifier hs-var">zonkScaledTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102052"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcEValArgQL {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;app_res_rho:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102066"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span>
</span><span id="line-581"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;exp_arg_ty:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102068"><span class="hs-identifier hs-type">exp_arg_ty</span></a></span><span>
</span><span id="line-582"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;args:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102062"><span class="hs-identifier hs-type">inst_args</span></a></span><span>
</span><span id="line-583"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mult:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102067"><span class="hs-identifier hs-type">mult</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102069"><span class="annot"><a href="#local-6989586621683102069"><span class="hs-identifier hs-var">ds_flag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#getDeepSubsumptionFlag"><span class="hs-identifier hs-type">getDeepSubsumptionFlag</span></a></span><span>
</span><span id="line-586"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102070"><span class="annot"><a href="#local-6989586621683102070"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102071"><span class="annot"><a href="#local-6989586621683102071"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102067"><span class="hs-identifier hs-type">mult</span></a></span><span>  </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-588"></span><span>               </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSkolemise"><span class="hs-identifier hs-type">tcSkolemise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102069"><span class="hs-identifier hs-type">ds_flag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-type">GenSigCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102068"><span class="hs-identifier hs-type">exp_arg_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683102074"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102074"><span class="hs-identifier hs-var">exp_arg_rho</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-589"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Emit saved-up constraints, /under/ the tcSkolemise</span><span>
</span><span id="line-590"></span><span>                    </span><span class="hs-comment">-- See (QLA4) in Note [Quick Look at value arguments]</span><span>
</span><span id="line-591"></span><span>                    </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683102048"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-592"></span><span>                    </span><span class="hs-comment">-- Emit saved-up usages /under/ the tcScalingUsage.</span><span>
</span><span id="line-593"></span><span>                    </span><span class="hs-comment">-- See (QLA5) in Note [Quick Look at value arguments]</span><span>
</span><span id="line-594"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621683102060"><span class="hs-identifier hs-var">head_ue</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>                    </span><span class="hs-comment">-- Unify with context if we have not already done so</span><span>
</span><span id="line-597"></span><span>                    </span><span class="hs-comment">-- See (QLA4) in Note [Quick Look at value arguments]</span><span>
</span><span id="line-598"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102064"><span class="hs-identifier hs-var">arg_influences_enclosing_call</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- Don't repeat</span><span>
</span><span id="line-599"></span><span>                    </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-var">qlUnify</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102066"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102074"><span class="hs-identifier hs-var">exp_arg_rho</span></a></span><span>         </span><span class="hs-comment">-- the qlUnify</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102078"><span class="annot"><a href="#local-6989586621683102078"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QLFlag -&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
</span><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-var">tcValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102062"><span class="hs-identifier hs-var">inst_args</span></a></span><span>
</span><span id="line-602"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102079"><span class="annot"><a href="#local-6989586621683102079"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102066"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span>
</span><span id="line-603"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102080"><span class="annot"><a href="#local-6989586621683102080"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#checkResultTy"><span class="hs-identifier hs-type">checkResultTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102056"><span class="hs-identifier hs-type">rn_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102058"><span class="hs-identifier hs-type">tc_head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102062"><span class="hs-identifier hs-type">inst_args</span></a></span><span>
</span><span id="line-604"></span><span>                                              </span><span class="annot"><a href="#local-6989586621683102079"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102074"><span class="hs-identifier hs-type">exp_arg_rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#finishApp"><span class="hs-identifier hs-type">finishApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102058"><span class="hs-identifier hs-type">tc_head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102078"><span class="hs-identifier hs-type">tc_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102079"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102080"><span class="hs-identifier hs-type">res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcEValArgQL }&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-608"></span><span>           </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;app_res_rho:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102066"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102050"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-611"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102055"><span class="hs-identifier hs-type">arg_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-type">mkHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102070"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102071"><span class="hs-identifier hs-type">arg'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ea_arg_ty"><span class="hs-identifier hs-var">ea_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-616"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-type">wantQuickLook</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span>
</span><span id="line-617"></span><span id="wantQuickLook"><span class="annot"><span class="annottext">wantQuickLook :: HsExpr (GhcPass 'Renamed) -&gt; TcM QLFlag
</span><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var hs-var">wantQuickLook</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102082"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683102082"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683102082"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; [Unique] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="GHC.Tc.Gen.App.html#quickLookKeys"><span class="hs-identifier hs-var">quickLookKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QLFlag -&gt; TcM QLFlag
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span>
</span><span id="line-619"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var">wantQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102086"><span class="annot"><a href="#local-6989586621683102086"><span class="hs-identifier hs-var">impred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ImpredicativeTypes</span></span><span>
</span><span id="line-620"></span><span>                                          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683102086"><span class="hs-identifier hs-type">impred</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-type">DoQL</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-type">NoQL</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookKeys"><span class="hs-identifier hs-type">quickLookKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-623"></span><span class="hs-comment">-- See Note [Quick Look for particular Ids]</span><span>
</span><span id="line-624"></span><span id="quickLookKeys"><span class="annot"><span class="annottext">quickLookKeys :: [Unique]
</span><a href="GHC.Tc.Gen.App.html#quickLookKeys"><span class="hs-identifier hs-var hs-var">quickLookKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#dollarIdKey"><span class="hs-identifier hs-var">dollarIdKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#leftSectionKey"><span class="hs-identifier hs-var">leftSectionKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#rightSectionKey"><span class="hs-identifier hs-var">rightSectionKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Instantiating the call
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-type">tcInstFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span>
</span><span id="line-633"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- False &lt;=&gt; Instantiate only /inferred/ variables at the end</span><span>
</span><span id="line-634"></span><span>                    </span><span class="hs-comment">--           so may return a sigma-type</span><span>
</span><span id="line-635"></span><span>                    </span><span class="hs-comment">-- True  &lt;=&gt; Instantiate all type variables at the end:</span><span>
</span><span id="line-636"></span><span>                    </span><span class="hs-comment">--           return a rho-type</span><span>
</span><span id="line-637"></span><span>                    </span><span class="hs-comment">-- The /only/ call site that passes in False is the one</span><span>
</span><span id="line-638"></span><span>                    </span><span class="hs-comment">--    in tcInferSigma, which is used only to implement :type</span><span>
</span><span id="line-639"></span><span>                    </span><span class="hs-comment">-- Otherwise we do eager instantiation; in Fig 5 of the paper</span><span>
</span><span id="line-640"></span><span>                    </span><span class="hs-comment">--    |-inst returns a rho-type</span><span>
</span><span id="line-641"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-643"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-644"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span class="hs-comment">-- This crucial function implements the |-inst judgement in Fig 4, plus the</span><span>
</span><span id="line-646"></span><span class="hs-comment">-- modification in Fig 5, of the QL paper:</span><span>
</span><span id="line-647"></span><span class="hs-comment">-- &quot;A quick look at impredicativity&quot; (ICFP'20).</span><span>
</span><span id="line-648"></span><span id="tcInstFun"><span class="annot"><span class="annottext">tcInstFun :: QLFlag
-&gt; Bool
-&gt; (HsExpr GhcTc, AppCtxt)
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-var hs-var">tcInstFun</span></a></span></span><span> </span><span id="local-6989586621683102092"><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683102092"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span id="local-6989586621683102093"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102093"><span class="hs-identifier hs-var">inst_final</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102094"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102095"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102095"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102096"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102096"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span> </span><span id="local-6989586621683102097"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102097"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInstFun&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_fun&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-650"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fun_sigma&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102096"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span>
</span><span id="line-651"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fun_ctxt&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102095"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span>
</span><span id="line-652"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;args:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102097"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-653"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;do_ql&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="#local-6989586621683102092"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102098"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102096"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102097"><span class="hs-identifier hs-var">rn_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-656"></span><span>    </span><span id="local-6989586621683102099"><span class="annot"><span class="annottext">fun_orig :: CtOrigin
</span><a href="#local-6989586621683102099"><span class="hs-identifier hs-var hs-var">fun_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102095"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-657"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigStmt"><span class="hs-identifier hs-type">OrigStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a></span><span>
</span><span id="line-658"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigPat"><span class="hs-identifier hs-type">OrigPat</span></a></span><span> </span><span id="local-6989586621683102104"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621683102104"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed) -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoPatOrigin"><span class="hs-identifier hs-var">DoPatOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621683102104"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-659"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigExpr"><span class="hs-identifier hs-type">OrigExpr</span></a></span><span> </span><span id="local-6989586621683102107"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102107"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102107"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-660"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span id="local-6989586621683102110"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102110"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102110"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span>    </span><span class="hs-comment">-- These are the type variables which must be instantiated to concrete</span><span>
</span><span id="line-663"></span><span>    </span><span class="hs-comment">-- types. See Note [Representation-polymorphic Ids with no binding]</span><span>
</span><span id="line-664"></span><span>    </span><span class="hs-comment">-- in GHC.Tc.Utils.Concrete</span><span>
</span><span id="line-665"></span><span>    </span><span id="local-6989586621683102111"><span class="annot"><span class="annottext">fun_conc_tvs :: ConcreteTyVars
</span><a href="#local-6989586621683102111"><span class="hs-identifier hs-var hs-var">fun_conc_tvs</span></a></span></span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102112"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102112"><span class="hs-identifier hs-var">fun_id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; ConcreteTyVars
</span><a href="GHC.Tc.Utils.Concrete.html#idConcreteTvs"><span class="hs-identifier hs-var">idConcreteTvs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102112"><span class="hs-identifier hs-var">fun_id</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-comment">-- Recall that DataCons are represented using ConLikeTc at GhcTc stage,</span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-comment">-- see Note [Typechecking data constructors] in GHC.Tc.Gen.Head.</span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ConLikeTc"><span class="hs-identifier hs-type">ConLikeTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621683102116"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683102116"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConcreteTyVars
</span><a href="GHC.Core.DataCon.html#dataConConcreteTyVars"><span class="hs-identifier hs-var">dataConConcreteTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683102116"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-672"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="GHC.Tc.Utils.TcType.html#noConcreteTyVars"><span class="hs-identifier hs-var">noConcreteTyVars</span></a></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>    </span><span class="hs-comment">-- Count value args only when complaining about a function</span><span>
</span><span id="line-676"></span><span>    </span><span class="hs-comment">-- applied to too many value args</span><span>
</span><span id="line-677"></span><span>    </span><span class="hs-comment">-- See Note [Herald for matchExpectedFunTys] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-678"></span><span>    </span><span id="local-6989586621683102118"><span class="annot"><span class="annottext">n_val_args :: Int
</span><a href="#local-6989586621683102118"><span class="hs-identifier hs-var hs-var">n_val_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExprArg 'TcpRn -&gt; Bool) -&gt; [HsExprArg 'TcpRn] -&gt; Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Int
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; Bool
forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102097"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621683102121"><span class="annot"><span class="annottext">fun_is_out_of_scope :: Bool
</span><a href="#local-6989586621683102121"><span class="hs-identifier hs-var hs-var">fun_is_out_of_scope</span></a></span></span><span>  </span><span class="hs-comment">-- See Note [VTA for out-of-scope functions]</span><span>
</span><span id="line-681"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-682"></span><span>          </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-683"></span><span>          </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>    </span><span class="annot"><a href="#local-6989586621683102123"><span class="hs-identifier hs-type">inst_fun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-686"></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; instantiate a tyvar with this ForAllTyFlag</span><span>
</span><span id="line-687"></span><span>    </span><span id="local-6989586621683102123"><span class="annot"><span class="annottext">inst_fun :: [HsExprArg 'TcpRn] -&gt; ForAllTyFlag -&gt; Bool
</span><a href="#local-6989586621683102123"><span class="hs-identifier hs-var hs-var">inst_fun</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102093"><span class="hs-identifier hs-var">inst_final</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="Language.Haskell.Syntax.Specificity.html#isInvisibleForAllTyFlag"><span class="hs-identifier hs-var">isInvisibleForAllTyFlag</span></a></span><span>
</span><span id="line-688"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ForAllTyFlag -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-689"></span><span>                </span><span class="hs-comment">-- Using `const False` for `:type` avoids</span><span>
</span><span id="line-690"></span><span>                </span><span class="hs-comment">-- `forall {r1} (a :: TYPE r1) {r2} (b :: TYPE r2). a -&gt; b`</span><span>
</span><span id="line-691"></span><span>                </span><span class="hs-comment">-- turning into `forall a {r2} (b :: TYPE r2). a -&gt; b`.</span><span>
</span><span id="line-692"></span><span>                </span><span class="hs-comment">-- See #21088.</span><span>
</span><span id="line-693"></span><span>    </span><span class="annot"><a href="#local-6989586621683102123"><span class="hs-identifier hs-var">inst_fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="Language.Haskell.Syntax.Specificity.html#isInvisibleForAllTyFlag"><span class="hs-identifier hs-var">isInvisibleForAllTyFlag</span></a></span><span>
</span><span id="line-694"></span><span>    </span><span class="annot"><a href="#local-6989586621683102123"><span class="hs-identifier hs-var">inst_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="Language.Haskell.Syntax.Specificity.html#isInferredForAllTyFlag"><span class="hs-identifier hs-var">isInferredForAllTyFlag</span></a></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span>    </span><span class="hs-comment">-----------</span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><a href="#local-6989586621683102098"><span class="hs-identifier hs-type">go</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-type">go1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                      </span><span class="hs-comment">-- Value-argument position of next arg</span><span>
</span><span id="line-698"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Accumulator, reversed</span><span>
</span><span id="line-699"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-700"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span>    </span><span class="hs-comment">-- go: If fun_ty=kappa, look it up in Theta</span><span>
</span><span id="line-703"></span><span>    </span><span id="local-6989586621683102098"><span class="annot"><span class="annottext">go :: Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102098"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683102128"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102128"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102129"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102129"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102130"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102130"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621683102131"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102131"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-704"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102132"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102132"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe Id
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102130"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-705"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isQLInstTyVar"><span class="hs-identifier hs-var">isQLInstTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102132"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-706"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102135"><span class="annot"><a href="#local-6989586621683102135"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaDetails
forall (m :: * -&gt; *). MonadIO m =&gt; Id -&gt; m MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102132"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-707"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102135"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-708"></span><span>                </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683102138"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102138"><span class="hs-identifier hs-var">fun_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102098"><span class="hs-identifier hs-var">go</span></a></span><span>  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102128"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102129"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102138"><span class="hs-identifier hs-var">fun_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102131"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-709"></span><span>                </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102128"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102129"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102130"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102131"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-710"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-711"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102128"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102129"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102130"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102131"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-comment">-- go1: fun_ty is not filled-in instantiation variable</span><span>
</span><span id="line-714"></span><span>    </span><span class="hs-comment">--      ('go' dealt with that case)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-comment">-- Handle out-of-scope functions gracefully</span><span>
</span><span id="line-717"></span><span>    </span><span id="local-6989586621683102127"><span class="annot"><span class="annottext">go1 :: Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102127"><span class="hs-identifier hs-var hs-var">go1</span></a></span></span><span> </span><span id="local-6989586621683102140"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102140"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102141"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102141"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102142"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102142"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102143"><span class="annot"><span class="annottext">HsExprArg 'TcpRn
</span><a href="#local-6989586621683102143"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683102144"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102144"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102121"><span class="hs-identifier hs-var">fun_is_out_of_scope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#looks_like_type_arg"><span class="hs-identifier hs-var">looks_like_type_arg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn
</span><a href="#local-6989586621683102143"><span class="hs-identifier hs-var">arg</span></a></span><span>   </span><span class="hs-comment">-- See Note [VTA for out-of-scope functions]</span><span>
</span><span id="line-719"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102098"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102140"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102141"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102142"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102144"><span class="hs-identifier hs-var">rest_args</span></a></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>    </span><span class="hs-comment">-- Rule IALL from Fig 4 of the QL paper; applies even if args = []</span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-comment">-- Instantiate invisible foralls and dictionaries.</span><span>
</span><span id="line-723"></span><span>    </span><span class="hs-comment">-- c.f. GHC.Tc.Utils.Instantiate.topInstantiate</span><span>
</span><span id="line-724"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102146"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102146"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102147"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102147"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102148"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102148"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621683102149"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102149"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-725"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102150"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683102150"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621683102151"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102151"><span class="hs-identifier hs-var">body1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ForAllTyFlag -&gt; Bool) -&gt; TcType -&gt; ([Id], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSomeForAllTyVars"><span class="hs-identifier hs-var">tcSplitSomeForAllTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; ForAllTyFlag -&gt; Bool
</span><a href="#local-6989586621683102123"><span class="hs-identifier hs-var">inst_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102149"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102148"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-726"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102153"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102153"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102154"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102154"><span class="hs-identifier hs-var">body2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; ForAllTyFlag -&gt; Bool
</span><a href="#local-6989586621683102123"><span class="hs-identifier hs-var">inst_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102149"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span>
</span><span id="line-727"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; (ThetaType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102151"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-728"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102151"><span class="hs-identifier hs-var">body1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-comment">-- inst_fun args Inferred: dictionary parameters are like Inferred foralls</span><span>
</span><span id="line-730"></span><span>        </span><span class="hs-comment">-- E.g. #22908: f :: Foo =&gt; blah</span><span>
</span><span id="line-731"></span><span>        </span><span class="hs-comment">-- No foralls!  But if inst_final=False, don't instantiate</span><span>
</span><span id="line-732"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102157"><span class="annot"><span class="annottext">no_tvs :: Bool
</span><a href="#local-6989586621683102157"><span class="hs-identifier hs-var hs-var">no_tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683102150"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-733"></span><span>            </span><span id="local-6989586621683102159"><span class="annot"><span class="annottext">no_theta :: Bool
</span><a href="#local-6989586621683102159"><span class="hs-identifier hs-var hs-var">no_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102153"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-734"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102157"><span class="hs-identifier hs-var">no_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102159"><span class="hs-identifier hs-var">no_theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102162"><span class="annot"><a href="#local-6989586621683102162"><span class="hs-identifier hs-var">_inst_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102163"><span class="annot"><a href="#local-6989586621683102163"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102164"><span class="annot"><a href="#local-6989586621683102164"><span class="hs-identifier hs-var">fun_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-736"></span><span>                </span><span class="hs-comment">-- addHeadCtxt: important for the class constraints</span><span>
</span><span id="line-737"></span><span>                </span><span class="hs-comment">-- that may be emitted from instantiating fun_sigma</span><span>
</span><span id="line-738"></span><span>                </span><span class="annot"><span class="annottext">AppCtxt
-&gt; TcM ([Id], HsWrapper, TcType) -&gt; TcM ([Id], HsWrapper, TcType)
forall a. AppCtxt -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Head.html#addHeadCtxt"><span class="hs-identifier hs-var">addHeadCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102095"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([Id], HsWrapper, TcType) -&gt; TcM ([Id], HsWrapper, TcType))
-&gt; TcM ([Id], HsWrapper, TcType) -&gt; TcM ([Id], HsWrapper, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-739"></span><span>                </span><span class="annot"><span class="annottext">CtOrigin
-&gt; ConcreteTyVars
-&gt; [Id]
-&gt; ThetaType
-&gt; TcType
-&gt; TcM ([Id], HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#instantiateSigma"><span class="hs-identifier hs-var">instantiateSigma</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683102099"><span class="hs-identifier hs-var">fun_orig</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102111"><span class="hs-identifier hs-var">fun_conc_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683102150"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102153"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102154"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-740"></span><span>                  </span><span class="hs-comment">-- See Note [Representation-polymorphism checking built-ins]</span><span>
</span><span id="line-741"></span><span>                  </span><span class="hs-comment">-- in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-742"></span><span>                  </span><span class="hs-comment">-- NB: we are doing this even when &quot;acc&quot; is not empty,</span><span>
</span><span id="line-743"></span><span>                  </span><span class="hs-comment">-- to handle e.g.</span><span>
</span><span id="line-744"></span><span>                  </span><span class="hs-comment">--</span><span>
</span><span id="line-745"></span><span>                  </span><span class="hs-comment">--   badTup :: forall r (a :: TYPE r). a -&gt; (# Int, a #)</span><span>
</span><span id="line-746"></span><span>                  </span><span class="hs-comment">--   badTup = (# , #) @LiftedRep</span><span>
</span><span id="line-747"></span><span>                  </span><span class="hs-comment">--</span><span>
</span><span id="line-748"></span><span>                  </span><span class="hs-comment">-- in which we already have instantiated the first RuntimeRep</span><span>
</span><span id="line-749"></span><span>                  </span><span class="hs-comment">-- argument of (#,#) to @LiftedRep, but want to rule out the</span><span>
</span><span id="line-750"></span><span>                  </span><span class="hs-comment">-- second instantiation @r.</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683102098"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102146"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-type">addArgWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102163"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102147"><span class="hs-identifier hs-type">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683102164"><span class="hs-identifier hs-type">fun_rho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102149"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-753"></span><span>                </span><span class="hs-comment">-- Going around again means we deal easily with</span><span>
</span><span id="line-754"></span><span>                </span><span class="hs-comment">-- nested  forall a. Eq a =&gt; forall b. Show b =&gt; blah</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>    </span><span class="hs-comment">-- Rule IRESULT from Fig 4 of the QL paper; no more arguments</span><span>
</span><span id="line-757"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102167"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102167"><span class="hs-identifier hs-var">_pos</span></a></span></span><span> </span><span id="local-6989586621683102168"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102168"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102169"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102169"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-758"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInstFun:ret&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102169"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([HsExprArg 'TcpInst], TcType)
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102168"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102169"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-comment">-- Rule ITVDQ from the GHC Proposal #281</span><span>
</span><span id="line-762"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102171"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102171"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102172"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102172"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102173"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102173"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102174"><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621683102174"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683102175"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102175"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102176"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102176"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102177"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102177"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TyVarBinder, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinder_maybe"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinder_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102173"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-764"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; SDoc
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBinder -&gt; ForAllTyFlag
forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderFlag"><span class="hs-identifier hs-var">binderFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102176"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Required"><span class="hs-identifier hs-var">Required</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102173"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683102174"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM ([HsExprArg 'TcpInst], TcType)
 -&gt; TcM ([HsExprArg 'TcpInst], TcType))
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-765"></span><span>        </span><span class="hs-comment">-- Any invisible binders have been instantiated by IALL above,</span><span>
</span><span id="line-766"></span><span>        </span><span class="hs-comment">-- so this forall must be visible (i.e. Required)</span><span>
</span><span id="line-767"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102182"><span class="annot"><a href="#local-6989586621683102182"><span class="hs-identifier hs-var">ty_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102183"><span class="annot"><a href="#local-6989586621683102183"><span class="hs-identifier hs-var">inst_body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
-&gt; (TyVarBinder, TcType)
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tcVDQ"><span class="hs-identifier hs-var">tcVDQ</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102111"><span class="hs-identifier hs-var">fun_conc_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102176"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102177"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621683102174"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-768"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102185"><span class="annot"><a href="#local-6989586621683102185"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102182"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-769"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683102098"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683102171"><span class="hs-identifier hs-type">pos</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-type">addArgWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102185"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102172"><span class="hs-identifier hs-type">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683102183"><span class="hs-identifier hs-type">inst_body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102175"><span class="hs-identifier hs-type">rest_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102188"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102188"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102189"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102189"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102190"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102190"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span id="local-6989586621683102191"><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683102191"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683102192"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102192"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102188"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpInst
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683102191"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102189"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102190"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102192"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102193"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102193"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102194"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102194"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102195"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102195"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span id="local-6989586621683102196"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102196"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621683102197"><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621683102197"><span class="hs-identifier hs-var">prag</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683102198"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102198"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [HsExprArg 'TcpInst]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ([HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102193"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; HsPragE (GhcPass (XPass 'TcpInst)) -&gt; HsExprArg 'TcpInst
forall (p :: TcPass).
AppCtxt -&gt; HsPragE (GhcPass (XPass p)) -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-var">EPrag</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102196"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpRn))
HsPragE (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683102197"><span class="hs-identifier hs-var">prag</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102194"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102195"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102198"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>    </span><span class="hs-comment">-- Rule ITYARG from Fig 4 of the QL paper</span><span>
</span><span id="line-778"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102199"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102199"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102200"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102200"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102201"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102201"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102202"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102202"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_hs_ty :: forall (p :: TcPass). HsExprArg p -&gt; LHsWcType (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#ea_hs_ty"><span class="hs-identifier hs-var">ea_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102204"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102204"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-779"></span><span>                             </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683102205"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102205"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102206"><span class="annot"><a href="#local-6989586621683102206"><span class="hs-identifier hs-var">ty_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102207"><span class="annot"><a href="#local-6989586621683102207"><span class="hs-identifier hs-var">inst_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
-&gt; TcType -&gt; LHsWcType (GhcPass 'Renamed) -&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tcVTA"><span class="hs-identifier hs-var">tcVTA</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102111"><span class="hs-identifier hs-var">fun_conc_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102201"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102204"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-781"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102209"><span class="annot"><a href="#local-6989586621683102209"><span class="hs-identifier hs-var hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102202"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_hs_ty :: LHsWcType (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#ea_hs_ty"><span class="hs-identifier hs-var">ea_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102204"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ty_arg :: XETAType 'TcpInst
</span><a href="GHC.Tc.Gen.Head.html#ea_ty_arg"><span class="hs-identifier hs-var">ea_ty_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
XETAType 'TcpInst
</span><a href="#local-6989586621683102206"><span class="hs-identifier hs-var">ty_arg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-782"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683102098"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102199"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683102209"><span class="hs-identifier hs-type">arg'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683102200"><span class="hs-identifier hs-type">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683102207"><span class="hs-identifier hs-type">inst_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102205"><span class="hs-identifier hs-type">rest_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span>    </span><span class="hs-comment">-- Rule IVAR from Fig 4 of the QL paper:</span><span>
</span><span id="line-785"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102211"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102211"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102212"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102212"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102213"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102213"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621683102214"><span class="annot"><span class="annottext">args :: [HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102214"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102215"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102215"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe Id
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102213"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-787"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isQLInstTyVar"><span class="hs-identifier hs-var">isQLInstTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102215"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-788"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Function type was of form   f :: forall a b. t1 -&gt; t2 -&gt; b</span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-comment">-- with 'b', one of the quantified type variables, in the corner</span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-comment">-- but the call applies it to three or more value args.</span><span>
</span><span id="line-791"></span><span>        </span><span class="hs-comment">-- Suppose b is instantiated by kappa.  Then we want to make fresh</span><span>
</span><span id="line-792"></span><span>        </span><span class="hs-comment">-- instantiation variables nu1, nu2, and set kappa := nu1 -&gt; nu2</span><span>
</span><span id="line-793"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-794"></span><span>        </span><span class="hs-comment">-- In principle what is happening here is not unlike matchActualFunTys</span><span>
</span><span id="line-795"></span><span>        </span><span class="hs-comment">-- but there are many small differences:</span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-comment">--   - We know that the function type in unfilled meta-tyvar</span><span>
</span><span id="line-797"></span><span>        </span><span class="hs-comment">--     matchActualFunTys is much more general, has a loop, etc.</span><span>
</span><span id="line-798"></span><span>        </span><span class="hs-comment">--   - We must be sure to actually update the variable right now,</span><span>
</span><span id="line-799"></span><span>        </span><span class="hs-comment">--     not defer in any way, because this is a QL instantiation variable.</span><span>
</span><span id="line-800"></span><span>        </span><span class="hs-comment">-- It's easier just to do the job directly here.</span><span>
</span><span id="line-801"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102216"><span class="annot"><a href="#local-6989586621683102216"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
 -&gt; Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType))
-&gt; [GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
-&gt; [Int]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Scaled TcType]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
-&gt; Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
</span><a href="#local-6989586621683102218"><span class="hs-identifier hs-var">new_arg_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; [LHsExpr (GhcPass 'Renamed)]
</span><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102214"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102211"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-802"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102220"><span class="annot"><a href="#local-6989586621683102220"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-type">newOpenFlexiTyVarTy</span></a></span><span>
</span><span id="line-803"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102222"><span class="annot"><a href="#local-6989586621683102222"><span class="hs-identifier hs-var hs-var">fun_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; TcType -&gt; TcType
HasDebugCallStack =&gt; [Scaled TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkScaledFunTys"><span class="hs-identifier hs-var">mkScaledFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621683102216"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102220"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-804"></span><span>
</span><span id="line-805"></span><span>           </span><span class="hs-comment">-- Fill in kappa := nu_1 -&gt; .. -&gt; nu_n -&gt; res_nu</span><span>
</span><span id="line-806"></span><span>           </span><span class="hs-comment">-- NB: kappa is uninstantiated ('go' already checked that)</span><span>
</span><span id="line-807"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102224"><span class="annot"><a href="#local-6989586621683102224"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-type">unifyKind</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-type">tyVarKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102215"><span class="hs-identifier hs-type">kappa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>                 </span><span class="hs-comment">-- unifyKind: see (UQL3) in Note [QuickLook unification]</span><span>
</span><span id="line-809"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-type">writeMetaTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102215"><span class="hs-identifier hs-type">kappa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-type">mkCastTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102222"><span class="hs-identifier hs-type">fun_ty'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102224"><span class="hs-identifier hs-type">kind_co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102230"><span class="annot"><a href="#local-6989586621683102230"><span class="hs-identifier hs-var hs-var">co_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TcType -&gt; TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var">mkGReflLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102222"><span class="hs-identifier hs-var">fun_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621683102224"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>                 </span><span id="local-6989586621683102233"><span class="annot"><a href="#local-6989586621683102233"><span class="hs-identifier hs-var hs-var">acc'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
forall (p :: TcPass). HsWrapper -&gt; [HsExprArg p] -&gt; [HsExprArg p]
</span><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-var">addArgWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683102230"><span class="hs-identifier hs-var">co_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102212"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-813"></span><span>                 </span><span class="hs-comment">-- Suppose kappa :: kk</span><span>
</span><span id="line-814"></span><span>                 </span><span class="hs-comment">-- Then fun_ty :: kk, fun_ty' :: Type, kind_co :: Type ~ kk</span><span>
</span><span id="line-815"></span><span>                 </span><span class="hs-comment">--      co_wrap :: (fun_ty' |&gt; kind_co) ~ fun_ty'</span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683102098"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102211"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102233"><span class="hs-identifier hs-type">acc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102222"><span class="hs-identifier hs-type">fun_ty'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102214"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>    </span><span class="hs-comment">-- Rule IARG from Fig 4 of the QL paper:</span><span>
</span><span id="line-820"></span><span>    </span><span class="annot"><a href="#local-6989586621683102127"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621683102234"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102234"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621683102235"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102235"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683102236"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102236"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span>
</span><span id="line-821"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102237"><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621683102237"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102238"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102238"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683102239"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683102239"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102240"><span class="annot"><span class="annottext">herald :: ExpectedFunTyOrigin
</span><a href="#local-6989586621683102240"><span class="hs-identifier hs-var hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102095"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-823"></span><span>                             </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigStmt"><span class="hs-identifier hs-type">OrigStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; HsExpr GhcTc -&gt; ExpectedFunTyOrigin
forall (p :: Pass).
OutputableBndrId p =&gt;
CtOrigin -&gt; HsExpr (GhcPass p) -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTySyntaxOp"><span class="hs-identifier hs-var">ExpectedFunTySyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-824"></span><span>                             </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">TypedThing -&gt; HsExpr (GhcPass 'Renamed) -&gt; ExpectedFunTyOrigin
forall (p :: Pass).
Outputable (HsExpr (GhcPass p)) =&gt;
TypedThing -&gt; HsExpr (GhcPass p) -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyArg"><span class="hs-identifier hs-var">ExpectedFunTyArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#HsExprTcThing"><span class="hs-identifier hs-var">HsExprTcThing</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; HsExpr (GhcPass 'Renamed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683102237"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102245"><span class="annot"><a href="#local-6989586621683102245"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102246"><span class="annot"><a href="#local-6989586621683102246"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102247"><span class="annot"><a href="#local-6989586621683102247"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-826"></span><span>                </span><span class="hs-comment">-- NB: matchActualFunTy does the rep-poly check.</span><span>
</span><span id="line-827"></span><span>                </span><span class="hs-comment">-- For example, suppose we have f :: forall r (a::TYPE r). a -&gt; Int</span><span>
</span><span id="line-828"></span><span>                </span><span class="hs-comment">-- In an application (f x), we need 'x' to have a fixed runtime</span><span>
</span><span id="line-829"></span><span>                </span><span class="hs-comment">-- representation; matchActualFunTy checks that when</span><span>
</span><span id="line-830"></span><span>                </span><span class="hs-comment">-- taking apart the arrow type (a -&gt; Int).</span><span>
</span><span id="line-831"></span><span>                </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
-&gt; Maybe TypedThing
-&gt; (Int, TcType)
-&gt; TcType
-&gt; TcM (HsWrapper, Scaled TcType, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTy"><span class="hs-identifier hs-var">matchActualFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
</span><a href="#local-6989586621683102240"><span class="hs-identifier hs-var">herald</span></a></span><span>
</span><span id="line-832"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedThing -&gt; Maybe TypedThing
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TypedThing -&gt; Maybe TypedThing) -&gt; TypedThing -&gt; Maybe TypedThing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#HsExprTcThing"><span class="hs-identifier hs-var">HsExprTcThing</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102118"><span class="hs-identifier hs-var">n_val_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102096"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102236"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102249"><span class="annot"><a href="#local-6989586621683102249"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookArg"><span class="hs-identifier hs-type">quickLookArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102092"><span class="hs-identifier hs-type">do_ql</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102238"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102237"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102246"><span class="hs-identifier hs-type">arg_ty</span></a></span><span>
</span><span id="line-836"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102251"><span class="annot"><a href="#local-6989586621683102251"><span class="hs-identifier hs-var hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst
</span><a href="#local-6989586621683102249"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
forall (p :: TcPass). HsWrapper -&gt; [HsExprArg p] -&gt; [HsExprArg p]
</span><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-var">addArgWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683102245"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683102235"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-837"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683102098"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683102234"><span class="hs-identifier hs-type">pos</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683102251"><span class="hs-identifier hs-type">acc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102247"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102239"><span class="hs-identifier hs-type">rest_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span>    </span><span class="annot"><a href="#local-6989586621683102218"><span class="hs-identifier hs-type">new_arg_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>    </span><span class="hs-comment">-- Make a fresh nus for each argument in rule IVAR</span><span>
</span><span id="line-841"></span><span>    </span><span id="local-6989586621683102218"><span class="annot"><span class="annottext">new_arg_ty :: LHsExpr (GhcPass 'Renamed)
-&gt; Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcType)
</span><a href="#local-6989586621683102218"><span class="hs-identifier hs-var hs-var">new_arg_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102252"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102252"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102253"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102253"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-842"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102254"><span class="annot"><a href="#local-6989586621683102254"><span class="hs-identifier hs-var">arg_nu</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiFRRTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(FixedRuntimeRepContext -&gt; TcM TcType)
-&gt; FixedRuntimeRepContext -&gt; TcM TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-843"></span><span>                       </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin -&gt; Int -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRExpectedFunTy"><span class="hs-identifier hs-var">FRRExpectedFunTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedThing -&gt; HsExpr (GhcPass 'Renamed) -&gt; ExpectedFunTyOrigin
forall (p :: Pass).
Outputable (HsExpr (GhcPass p)) =&gt;
TypedThing -&gt; HsExpr (GhcPass p) -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyArg"><span class="hs-identifier hs-var">ExpectedFunTyArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#HsExprTcThing"><span class="hs-identifier hs-var">HsExprTcThing</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102094"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102252"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102253"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-844"></span><span>               </span><span class="hs-comment">-- Following matchActualFunTy, we create nu_i :: TYPE kappa_i[conc],</span><span>
</span><span id="line-845"></span><span>               </span><span class="hs-comment">-- thereby ensuring that the arguments have concrete runtime representations</span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102257"><span class="annot"><a href="#local-6989586621683102257"><span class="hs-identifier hs-var">mult_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-type">multiplicityTy</span></a></span><span>
</span><span id="line-848"></span><span>               </span><span class="hs-comment">-- mult_ty: e need variables for argument multiplicities (#18731)</span><span>
</span><span id="line-849"></span><span>               </span><span class="hs-comment">-- Otherwise, 'undefined x' wouldn't be linear in x</span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkScaled"><span class="hs-identifier hs-type">mkScaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102257"><span class="hs-identifier hs-type">mult_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102254"><span class="hs-identifier hs-type">arg_nu</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span class="hs-comment">-- Is the argument supposed to instantiate a forall?</span><span>
</span><span id="line-854"></span><span class="hs-comment">--</span><span>
</span><span id="line-855"></span><span class="hs-comment">-- In other words, given a function application `fn arg`,</span><span>
</span><span id="line-856"></span><span class="hs-comment">-- can we look at the `arg` and conclude that `fn :: forall x. t`</span><span>
</span><span id="line-857"></span><span class="hs-comment">-- or `fn :: forall x -&gt; t`?</span><span>
</span><span id="line-858"></span><span class="hs-comment">--</span><span>
</span><span id="line-859"></span><span class="hs-comment">-- This is a conservative heuristic that returns `False` for &quot;don't know&quot;.</span><span>
</span><span id="line-860"></span><span class="hs-comment">-- Used to improve error messages only.</span><span>
</span><span id="line-861"></span><span class="hs-comment">-- See Note [VTA for out-of-scope functions].</span><span>
</span><span id="line-862"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#looks_like_type_arg"><span class="hs-identifier hs-type">looks_like_type_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-863"></span><span id="looks_like_type_arg"><span class="annot"><span class="annottext">looks_like_type_arg :: HsExprArg 'TcpRn -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#looks_like_type_arg"><span class="hs-identifier hs-var hs-var">looks_like_type_arg</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-comment">-- The argument is clearly supposed to instantiate an invisible forall,</span><span>
</span><span id="line-865"></span><span>  </span><span class="hs-comment">-- i.e. when we see `f @a`, we expect `f :: forall x. t`.</span><span>
</span><span id="line-866"></span><span>  </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-867"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#looks_like_type_arg"><span class="hs-identifier hs-var">looks_like_type_arg</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102260"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102260"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-868"></span><span>  </span><span class="hs-comment">-- Check if the argument is supposed to instantiate a visible forall,</span><span>
</span><span id="line-869"></span><span>  </span><span class="hs-comment">-- i.e. when we see `f (type Int)`, we expect `f :: forall x -&gt; t`,</span><span>
</span><span id="line-870"></span><span>  </span><span class="hs-comment">--      but not if we see `f True`.</span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-comment">-- We can't say for sure though. Part 2 of GHC Proposal #281 allows</span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-comment">-- type arguments without the `type` qualifier, so `f True` could</span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-comment">-- instantiate `forall (b :: Bool) -&gt; t`.</span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; HsExpr (GhcPass 'Renamed)
forall (p :: Pass). HsExpr (GhcPass p) -&gt; HsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#stripParensHsExpr"><span class="hs-identifier hs-var">stripParensHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102260"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-875"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsEmbTy"><span class="hs-identifier hs-type">HsEmbTy</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTy (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-876"></span><span>    </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-877"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#looks_like_type_arg"><span class="hs-identifier hs-var">looks_like_type_arg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span id="local-6989586621683101203"><span class="annot"><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-type">addArgCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-880"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101203"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101203"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-881"></span><span class="hs-comment">-- There are four cases:</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- 1. In the normal case, we add an informative context</span><span>
</span><span id="line-883"></span><span class="hs-comment">--          &quot;In the third argument of f, namely blah&quot;</span><span>
</span><span id="line-884"></span><span class="hs-comment">-- 2. If we are deep inside generated code (`isGeneratedCode` is `True`)</span><span>
</span><span id="line-885"></span><span class="hs-comment">--    or if all or part of this particular application is an expansion</span><span>
</span><span id="line-886"></span><span class="hs-comment">--    `VAExpansion`, just use the less-informative context</span><span>
</span><span id="line-887"></span><span class="hs-comment">--          &quot;In the expression: arg&quot;</span><span>
</span><span id="line-888"></span><span class="hs-comment">--   Unless the arg is also a generated thing, in which case do nothing.</span><span>
</span><span id="line-889"></span><span class="hs-comment">--   See Note [Rebindable syntax and XXExprGhcRn] in GHC.Hs.Expr</span><span>
</span><span id="line-890"></span><span class="hs-comment">-- 3. We are in an expanded `do`-block's non-bind statement</span><span>
</span><span id="line-891"></span><span class="hs-comment">--    we simply add the statement context</span><span>
</span><span id="line-892"></span><span class="hs-comment">--       &quot;In the statement of the `do`-block ..&quot;</span><span>
</span><span id="line-893"></span><span class="hs-comment">-- 4. We are in an expanded do block's bind statement</span><span>
</span><span id="line-894"></span><span class="hs-comment">--    a. Then either we are typechecking the first argument of the bind which is user located</span><span>
</span><span id="line-895"></span><span class="hs-comment">--       so we set the location to be that of the argument</span><span>
</span><span id="line-896"></span><span class="hs-comment">--    b. Or, we are typechecking the second argument which would be a generated lambda</span><span>
</span><span id="line-897"></span><span class="hs-comment">--       so we set the location to be whatever the location in the context is</span><span>
</span><span id="line-898"></span><span class="hs-comment">--  See Note [Expanding HsDo with XXExprGhcRn] in GHC.Tc.Gen.Do</span><span>
</span><span id="line-899"></span><span class="hs-comment">-- For future: we need a cleaner way of doing this bit of adding the right error context.</span><span>
</span><span id="line-900"></span><span class="hs-comment">-- There is a delicate dance of looking at source locations and reconstructing</span><span>
</span><span id="line-901"></span><span class="hs-comment">-- whether the piece of code is a `do`-expanded code or some other expanded code.</span><span>
</span><span id="line-902"></span><span id="addArgCtxt"><span class="annot"><span class="annottext">addArgCtxt :: forall a. AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var hs-var">addArgCtxt</span></a></span></span><span> </span><span id="local-6989586621683102268"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102268"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102269"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102269"><span class="hs-identifier hs-var">arg_loc</span></a></span></span><span> </span><span id="local-6989586621683102270"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102270"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102271"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683102271"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102272"><span class="annot"><a href="#local-6989586621683102272"><span class="hs-identifier hs-var">in_generated_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier hs-var">inGeneratedCode</span></a></span><span>
</span><span id="line-904"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102268"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-905"></span><span>           </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span id="local-6989586621683102274"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102274"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683102275"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102275"><span class="hs-identifier hs-var">arg_no</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683102272"><span class="hs-identifier hs-var">in_generated_code</span></a></span><span>
</span><span id="line-906"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM a -&gt; TcM a
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102269"><span class="hs-identifier hs-var">arg_loc</span></a></span><span>                    </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-907"></span><span>                     </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; HsExpr (GhcPass 'Renamed) -&gt; Int -&gt; SDoc
forall fun arg.
(Outputable fun, Outputable arg) =&gt;
fun -&gt; arg -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102274"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102270"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683102275"><span class="hs-identifier hs-var">arg_no</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-908"></span><span>                     </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683102271"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span>           </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigStmt"><span class="hs-identifier hs-type">OrigStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102278"><span class="annot"><span class="annottext">stmt :: StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102278"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102280"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683102280"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-911"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGeneratedSrcSpan"><span class="hs-identifier hs-var">isGeneratedSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102269"><span class="hs-identifier hs-var">arg_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- This arg is the second argument to generated (&gt;&gt;=)</span><span>
</span><span id="line-912"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM a -&gt; TcM a
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683102280"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-913"></span><span>                  </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
forall a. ExprStmt (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addStmtCtxt"><span class="hs-identifier hs-var">addStmtCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102278"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-914"></span><span>                  </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683102271"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-915"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                        </span><span class="hs-comment">-- This arg is the first argument to generated (&gt;&gt;=)</span><span>
</span><span id="line-916"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM a -&gt; TcM a
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102269"><span class="hs-identifier hs-var">arg_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-917"></span><span>                  </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
forall a. ExprStmt (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addStmtCtxt"><span class="hs-identifier hs-var">addStmtCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102278"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-918"></span><span>                  </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683102271"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-919"></span><span>           </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigStmt"><span class="hs-identifier hs-type">OrigStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102285"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102285"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683102286"><span class="annot"><span class="annottext">StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102286"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-920"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM a -&gt; TcM a
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102285"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-921"></span><span>                  </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
forall a. ExprStmt (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addStmtCtxt"><span class="hs-identifier hs-var">addStmtCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102286"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-922"></span><span>                  </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683102271"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span>           </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM a -&gt; TcM a
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102269"><span class="hs-identifier hs-var">arg_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-925"></span><span>                  </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
forall a. HsExpr (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102270"><span class="hs-identifier hs-var">arg</span></a></span><span>     </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- Auto-suppressed if arg_loc is generated</span><span>
</span><span id="line-926"></span><span>                  </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683102271"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Visible type application
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span class="hs-comment">-- See Note [Visible type application and abstraction]</span><span>
</span><span id="line-935"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcVTA"><span class="hs-identifier hs-type">tcVTA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTyVars"><span class="hs-identifier hs-type">ConcreteTyVars</span></a></span><span>
</span><span id="line-936"></span><span>         </span><span class="hs-comment">-- ^ Type variables that must be instantiated to concrete types.</span><span>
</span><span id="line-937"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-938"></span><span>         </span><span class="hs-comment">-- See Note [Representation-polymorphism checking built-ins]</span><span>
</span><span id="line-939"></span><span>         </span><span class="hs-comment">-- in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-940"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Function type</span></span><span>
</span><span id="line-941"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Argument type</span></span><span>
</span><span id="line-942"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span class="hs-comment">-- Deal with a visible type application</span><span>
</span><span id="line-944"></span><span class="hs-comment">-- The function type has already had its Inferred binders instantiated</span><span>
</span><span id="line-945"></span><span id="tcVTA"><span class="annot"><span class="annottext">tcVTA :: ConcreteTyVars
-&gt; TcType -&gt; LHsWcType (GhcPass 'Renamed) -&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tcVTA"><span class="hs-identifier hs-var hs-var">tcVTA</span></a></span></span><span> </span><span id="local-6989586621683102287"><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102287"><span class="hs-identifier hs-var">conc_tvs</span></a></span></span><span> </span><span id="local-6989586621683102288"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102288"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621683102289"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102289"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102290"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102290"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102291"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102291"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TyVarBinder, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinder_maybe"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinder_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102288"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-947"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; ForAllTyFlag
forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderFlag"><span class="hs-identifier hs-var">binderFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102290"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Specified"><span class="hs-identifier hs-var">Specified</span></a></span><span>
</span><span id="line-948"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
-&gt; (TyVarBinder, TcType)
-&gt; LHsWcType (GhcPass 'Renamed)
-&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tc_inst_forall_arg"><span class="hs-identifier hs-var">tc_inst_forall_arg</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102287"><span class="hs-identifier hs-var">conc_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102290"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102291"><span class="hs-identifier hs-var">inner_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102289"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-951"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102294"><span class="annot"><a href="#local-6989586621683102294"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM (TidyEnv, TcType) -&gt; TcM (TidyEnv, TcType)
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM (TidyEnv, TcType) -&gt; TcM (TidyEnv, TcType))
-&gt; ZonkM (TidyEnv, TcType) -&gt; TcM (TidyEnv, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcType -&gt; ZonkM (TidyEnv, TcType)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102288"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-952"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-type">failWith</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnInvalidTypeApplication"><span class="hs-identifier hs-type">TcRnInvalidTypeApplication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102294"><span class="hs-identifier hs-type">fun_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102289"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span class="hs-comment">-- See Note [Visible type application and abstraction]</span><span>
</span><span id="line-955"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcVDQ"><span class="hs-identifier hs-type">tcVDQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTyVars"><span class="hs-identifier hs-type">ConcreteTyVars</span></a></span><span>              </span><span class="hs-comment">-- See Note [Representation-polymorphism checking built-ins]</span><span>
</span><span id="line-956"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#ForAllTyBinder"><span class="hs-identifier hs-type">ForAllTyBinder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Function type</span><span>
</span><span id="line-957"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>               </span><span class="hs-comment">-- Argument type</span><span>
</span><span id="line-958"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-959"></span><span id="tcVDQ"><span class="annot"><span class="annottext">tcVDQ :: ConcreteTyVars
-&gt; (TyVarBinder, TcType)
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tcVDQ"><span class="hs-identifier hs-var hs-var">tcVDQ</span></a></span></span><span> </span><span id="local-6989586621683102299"><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102299"><span class="hs-identifier hs-var">conc_tvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102300"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102300"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102301"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102301"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102302"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102302"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-960"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102303"><span class="annot"><a href="#local-6989586621683102303"><span class="hs-identifier hs-var">hs_wc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsWcType (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.App.html#expr_to_type"><span class="hs-identifier hs-var">expr_to_type</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102302"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-961"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tc_inst_forall_arg"><span class="hs-identifier hs-type">tc_inst_forall_arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102299"><span class="hs-identifier hs-type">conc_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683102300"><span class="hs-identifier hs-type">tvb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683102301"><span class="hs-identifier hs-type">inner_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683102303"><span class="hs-identifier hs-type">hs_wc_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span class="hs-comment">-- Convert a HsExpr into the equivalent HsType.</span><span>
</span><span id="line-964"></span><span class="hs-comment">-- See [RequiredTypeArguments and the T2T mapping]</span><span>
</span><span id="line-965"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#expr_to_type"><span class="hs-identifier hs-type">expr_to_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span id="expr_to_type"><span class="annot"><span class="annottext">expr_to_type :: LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsWcType (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.App.html#expr_to_type"><span class="hs-identifier hs-var hs-var">expr_to_type</span></a></span></span><span> </span><span id="local-6989586621683102305"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102305"><span class="hs-identifier hs-var">earg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-967"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass). LHsExpr (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#stripParensLHsExpr"><span class="hs-identifier hs-var">stripParensLHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102305"><span class="hs-identifier hs-var">earg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-968"></span><span>    </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsEmbTy"><span class="hs-identifier hs-type">HsEmbTy</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTy (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102307"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683102307"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-969"></span><span>      </span><span class="hs-comment">-- The entire type argument is guarded with the `type` herald,</span><span>
</span><span id="line-970"></span><span>      </span><span class="hs-comment">-- e.g. `vfun (type (Maybe Int))`. This special case supports</span><span>
</span><span id="line-971"></span><span>      </span><span class="hs-comment">-- named wildcards. See Note [Wildcards in the T2T translation]</span><span>
</span><span id="line-972"></span><span>      </span><span class="annot"><span class="annottext">HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsWildCardBndrs
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102307"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-973"></span><span>    </span><span id="local-6989586621683102308"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102308"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-974"></span><span>      </span><span class="hs-comment">-- The type argument is not guarded with the `type` herald, or perhaps</span><span>
</span><span id="line-975"></span><span>      </span><span class="hs-comment">-- only parts of it are, e.g. `vfun (Maybe Int)` or `vfun (Maybe (type Int))`.</span><span>
</span><span id="line-976"></span><span>      </span><span class="hs-comment">-- Apply a recursive T2T transformation.</span><span>
</span><span id="line-977"></span><span>      </span><span class="annot"><span class="annottext">XHsWC
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; HsWildCardBndrs
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall pass thing.
XHsWC pass thing -&gt; thing -&gt; HsWildCardBndrs pass thing
</span><a href="Language.Haskell.Syntax.Type.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
 -&gt; HsWildCardBndrs
      (GhcPass 'Renamed)
      (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsWildCardBndrs
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102308"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-978"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-979"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>    </span><span id="local-6989586621683102311"><span class="annot"><span class="annottext">go :: LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsEmbTy"><span class="hs-identifier hs-type">HsEmbTy</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTy (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102312"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683102312"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-981"></span><span>      </span><span class="hs-comment">-- HsEmbTy means there is an explicit `type` herald, e.g. vfun :: forall a -&gt; blah</span><span>
</span><span id="line-982"></span><span>      </span><span class="hs-comment">-- and the call   vfun (type Int)</span><span>
</span><span id="line-983"></span><span>      </span><span class="hs-comment">--           or   vfun (Int -&gt; type Int)</span><span>
</span><span id="line-984"></span><span>      </span><span class="hs-comment">-- The T2T transformation can simply discard the herald and use the embedded type.</span><span>
</span><span id="line-985"></span><span>      </span><span class="annot"><span class="annottext">HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall t. HsWildCardBndrs (GhcPass 'Renamed) t -&gt; TcM t
</span><a href="#local-6989586621683102313"><span class="hs-identifier hs-var">unwrap_wc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102312"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-986"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102314"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102314"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsFunArr"><span class="hs-identifier hs-type">HsFunArr</span></a></span><span> </span><span class="annot"><span class="annottext">XFunArr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102316"><span class="annot"><span class="annottext">HsArrowOf (LHsExpr (GhcPass 'Renamed)) (GhcPass 'Renamed)
</span><a href="#local-6989586621683102316"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683102317"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102317"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683102318"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102318"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-987"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102319"><span class="annot"><a href="#local-6989586621683102319"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102317"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-988"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102320"><span class="annot"><a href="#local-6989586621683102320"><span class="hs-identifier hs-var">mult'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102321"><span class="hs-identifier hs-type">go_arrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102316"><span class="hs-identifier hs-type">mult</span></a></span><span>
</span><span id="line-989"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102322"><span class="annot"><a href="#local-6989586621683102322"><span class="hs-identifier hs-var">res'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102318"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-990"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102314"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsFunTy"><span class="hs-identifier hs-type">HsFunTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102320"><span class="hs-identifier hs-type">mult'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102319"><span class="hs-identifier hs-type">arg'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102322"><span class="hs-identifier hs-type">res'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-991"></span><span>         </span><span class="hs-keyword">where</span><span>
</span><span id="line-992"></span><span>          </span><span class="annot"><a href="#local-6989586621683102321"><span class="hs-identifier hs-type">go_arrow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArrowOf"><span class="hs-identifier hs-type">HsArrowOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArrow"><span class="hs-identifier hs-type">HsArrow</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>          </span><span id="local-6989586621683102321"><span class="annot"><span class="annottext">go_arrow :: HsArrowOf (LHsExpr (GhcPass 'Renamed)) (GhcPass 'Renamed)
-&gt; TcM (HsArrow (GhcPass 'Renamed))
</span><a href="#local-6989586621683102321"><span class="hs-identifier hs-var hs-var">go_arrow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsUnrestrictedArrow"><span class="hs-identifier hs-type">HsUnrestrictedArrow</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsArrowOf
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsArrowOf
        (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
        (GhcPass 'Renamed))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnrestrictedArrow
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
-&gt; HsArrowOf
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
     (GhcPass 'Renamed)
forall mult pass.
XUnrestrictedArrow mult pass -&gt; HsArrowOf mult pass
</span><a href="Language.Haskell.Syntax.Type.html#HsUnrestrictedArrow"><span class="hs-identifier hs-var">HsUnrestrictedArrow</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XUnrestrictedArrow
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>          </span><span class="annot"><a href="#local-6989586621683102321"><span class="hs-identifier hs-var">go_arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsLinearArrow"><span class="hs-identifier hs-type">HsLinearArrow</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsArrowOf
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsArrowOf
        (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
        (GhcPass 'Renamed))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLinearArrow
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
-&gt; HsArrowOf
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
     (GhcPass 'Renamed)
forall mult pass. XLinearArrow mult pass -&gt; HsArrowOf mult pass
</span><a href="Language.Haskell.Syntax.Type.html#HsLinearArrow"><span class="hs-identifier hs-var">HsLinearArrow</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XLinearArrow
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>          </span><span class="annot"><a href="#local-6989586621683102321"><span class="hs-identifier hs-var">go_arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsExplicitMult"><span class="hs-identifier hs-type">HsExplicitMult</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitMult (LHsExpr (GhcPass 'Renamed)) (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102327"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102327"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XExplicitMult
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; HsArrowOf
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
     (GhcPass 'Renamed)
forall mult pass.
XExplicitMult mult pass -&gt; mult -&gt; HsArrowOf mult pass
</span><a href="Language.Haskell.Syntax.Type.html#HsExplicitMult"><span class="hs-identifier hs-var">HsExplicitMult</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XExplicitMult
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
  (GhcPass 'Renamed)
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
 -&gt; HsArrowOf
      (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
      (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsArrowOf
        (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
        (GhcPass 'Renamed))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102327"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-996"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102328"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102328"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsForAll"><span class="hs-identifier hs-type">HsForAll</span></a></span><span> </span><span class="annot"><span class="annottext">XForAll (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102330"><span class="annot"><span class="annottext">HsForAllTelescope (GhcPass 'Renamed)
</span><a href="#local-6989586621683102330"><span class="hs-identifier hs-var">tele</span></a></span></span><span> </span><span id="local-6989586621683102331"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102331"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-997"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102332"><span class="annot"><a href="#local-6989586621683102332"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102331"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-998"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102328"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsForAllTy"><span class="hs-identifier hs-type">HsForAllTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102330"><span class="hs-identifier hs-type">tele</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102332"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-999"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102334"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102334"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQual"><span class="hs-identifier hs-type">HsQual</span></a></span><span> </span><span class="annot"><span class="annottext">XQual (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102336"><span class="annot"><span class="annottext">SrcSpanAnnC
</span><a href="#local-6989586621683102336"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621683102337"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
</span><a href="#local-6989586621683102337"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102338"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102338"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1000"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102339"><span class="annot"><a href="#local-6989586621683102339"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))))
-&gt; [GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
</span><a href="#local-6989586621683102337"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1001"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102340"><span class="annot"><a href="#local-6989586621683102340"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102338"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-1002"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102334"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsQualTy"><span class="hs-identifier hs-type">HsQualTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102336"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102339"><span class="hs-identifier hs-type">ctxt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683102340"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1003"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102342"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102342"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102343"><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
</span><a href="#local-6989586621683102343"><span class="hs-identifier hs-var">lname</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1004"></span><span>      </span><span class="hs-comment">-- as per #281: variables and constructors (regardless of their namespace)</span><span>
</span><span id="line-1005"></span><span>      </span><span class="hs-comment">-- are mapped directly, without modification.</span><span>
</span><span id="line-1006"></span><span>      </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102342"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTyVar (GhcPass 'Renamed)
-&gt; PromotionFlag
-&gt; LIdP (GhcPass 'Renamed)
-&gt; HsType (GhcPass 'Renamed)
forall pass.
XTyVar pass -&gt; PromotionFlag -&gt; LIdP pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar (GhcPass 'Renamed)
EpToken &quot;'&quot;
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
</span><a href="#local-6989586621683102343"><span class="hs-identifier hs-var">lname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1007"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102347"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102347"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102349"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102349"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621683102350"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102350"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1008"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102351"><span class="annot"><a href="#local-6989586621683102351"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102349"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-1009"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102352"><span class="annot"><a href="#local-6989586621683102352"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102350"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-1010"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102347"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppTy"><span class="hs-identifier hs-type">HsAppTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102351"><span class="hs-identifier hs-type">lhs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102352"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1011"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102354"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102354"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102356"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102356"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621683102357"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683102357"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1012"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102358"><span class="annot"><a href="#local-6989586621683102358"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102356"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-1013"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102359"><span class="annot"><a href="#local-6989586621683102359"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102313"><span class="hs-identifier hs-type">unwrap_wc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102357"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-1014"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102354"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppKindTy"><span class="hs-identifier hs-type">HsAppKindTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102358"><span class="hs-identifier hs-type">lhs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102359"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1015"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102361"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102361"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683102362"><span class="annot"><span class="annottext">e :: HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102362"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OpApp"><span class="hs-identifier hs-type">OpApp</span></a></span><span> </span><span class="annot"><span class="annottext">XOpApp (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102364"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102364"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621683102365"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102365"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621683102366"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102366"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102367"><span class="annot"><a href="#local-6989586621683102367"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102364"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-1017"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102368"><span class="annot"><a href="#local-6989586621683102368"><span class="hs-identifier hs-var">op'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102365"><span class="hs-identifier hs-type">op</span></a></span><span>
</span><span id="line-1018"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102369"><span class="annot"><a href="#local-6989586621683102369"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102366"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-1019"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102370"><span class="annot"><a href="#local-6989586621683102370"><span class="hs-identifier hs-var">op_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683102371"><span class="hs-identifier hs-type">unwrap_op_tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102368"><span class="hs-identifier hs-type">op'</span></a></span><span>
</span><span id="line-1020"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102361"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOpTy"><span class="hs-identifier hs-type">HsOpTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-type">NotPromoted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102367"><span class="hs-identifier hs-type">lhs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102370"><span class="hs-identifier hs-type">op_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102369"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1021"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1022"></span><span>        </span><span id="local-6989586621683102371"><span class="annot"><span class="annottext">unwrap_op_tv :: GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (LIdP (GhcPass 'Renamed))
</span><a href="#local-6989586621683102371"><span class="hs-identifier hs-var hs-var">unwrap_op_tv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-type">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102373"><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
</span><a href="#local-6989586621683102373"><span class="hs-identifier hs-var">op_id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (LIdP (GhcPass 'Renamed))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
</span><a href="#local-6989586621683102373"><span class="hs-identifier hs-var">op_id</span></a></span><span>
</span><span id="line-1023"></span><span>        </span><span class="annot"><a href="#local-6989586621683102371"><span class="hs-identifier hs-var">unwrap_op_tv</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (LIdP (GhcPass 'Renamed))
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LIdP (GhcPass 'Renamed)))
-&gt; TcRnMessage
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (LIdP (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllformedTypeArgument"><span class="hs-identifier hs-var">TcRnIllformedTypeArgument</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102361"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102362"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102375"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102375"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102377"><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102377"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1025"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102378"><span class="annot"><span class="annottext">HsTyLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102378"><span class="hs-identifier hs-var">tylit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OverLitVal -&gt; Maybe (HsTyLit (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.HsType.html#tyLitFromOverloadedLit"><span class="hs-identifier hs-var">tyLitFromOverloadedLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed) -&gt; OverLitVal
forall p. HsOverLit p -&gt; OverLitVal
</span><a href="Language.Haskell.Syntax.Lit.html#ol_val"><span class="hs-identifier hs-var">ol_val</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102377"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102375"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTyLit (GhcPass 'Renamed)
-&gt; HsTyLit (GhcPass 'Renamed) -&gt; HsType (GhcPass 'Renamed)
forall pass. XTyLit pass -&gt; HsTyLit pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">XTyLit (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102378"><span class="hs-identifier hs-var">tylit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1027"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102382"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102382"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102384"><span class="annot"><span class="annottext">HsLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102384"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102385"><span class="annot"><span class="annottext">HsTyLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102385"><span class="hs-identifier hs-var">tylit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLit (GhcPass 'Renamed) -&gt; Maybe (HsTyLit (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.HsType.html#tyLitFromLit"><span class="hs-identifier hs-var">tyLitFromLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102384"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1029"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102382"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTyLit (GhcPass 'Renamed)
-&gt; HsTyLit (GhcPass 'Renamed) -&gt; HsType (GhcPass 'Renamed)
forall pass. XTyLit pass -&gt; HsTyLit pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">XTyLit (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102385"><span class="hs-identifier hs-var">tylit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102387"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102387"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-type">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102389"><span class="annot"><span class="annottext">[HsTupArg (GhcPass 'Renamed)]
</span><a href="#local-6989586621683102389"><span class="hs-identifier hs-var">tup_args</span></a></span></span><span> </span><span id="local-6989586621683102390"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621683102390"><span class="hs-identifier hs-var">boxity</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>      </span><span class="hs-comment">-- Neither unboxed tuples (#e1,e2#) nor tuple sections (e1,,e2,) can be promoted</span><span>
</span><span id="line-1032"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Bool
</span><a href="Language.Haskell.Syntax.Basic.html#isBoxed"><span class="hs-identifier hs-var">isBoxed</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621683102390"><span class="hs-identifier hs-var">boxity</span></a></span><span>
</span><span id="line-1033"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102391"><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Renamed)]
</span><a href="#local-6989586621683102391"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HsTupArg (GhcPass 'Renamed)] -&gt; Maybe [LHsExpr (GhcPass 'Renamed)]
forall (p :: Pass).
[HsTupArg (GhcPass p)] -&gt; Maybe [LHsExpr (GhcPass p)]
</span><a href="GHC.Hs.Expr.html#tupArgsPresent_maybe"><span class="hs-identifier hs-var">tupArgsPresent_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg (GhcPass 'Renamed)]
</span><a href="#local-6989586621683102389"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-1034"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102393"><span class="annot"><a href="#local-6989586621683102393"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))))
-&gt; [GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
</span><a href="#local-6989586621683102391"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1035"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102387"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsExplicitTupleTy"><span class="hs-identifier hs-type">HsExplicitTupleTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-type">NotPromoted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102393"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1036"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102396"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102396"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-type">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102398"><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Renamed)]
</span><a href="#local-6989586621683102398"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1037"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102399"><span class="annot"><a href="#local-6989586621683102399"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))))
-&gt; [GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
</span><a href="#local-6989586621683102398"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1038"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102396"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsExplicitListTy"><span class="hs-identifier hs-type">HsExplicitListTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-type">NotPromoted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102399"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1039"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102401"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102401"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">XExprWithTySig (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102403"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102403"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683102404"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683102404"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1040"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102405"><span class="annot"><a href="#local-6989586621683102405"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102403"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1041"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102406"><span class="annot"><a href="#local-6989586621683102406"><span class="hs-identifier hs-var">sig_ki</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683102407"><span class="hs-identifier hs-type">unwrap_sig</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683102313"><span class="hs-identifier hs-type">unwrap_wc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683102404"><span class="hs-identifier hs-type">sig_ty</span></a></span><span>
</span><span id="line-1042"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102401"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsKindSig"><span class="hs-identifier hs-type">HsKindSig</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102405"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102406"><span class="hs-identifier hs-type">sig_ki</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1043"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1044"></span><span>        </span><span class="annot"><a href="#local-6989586621683102407"><span class="hs-identifier hs-type">unwrap_sig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>        </span><span id="local-6989586621683102407"><span class="annot"><span class="annottext">unwrap_sig :: LHsSigType (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102407"><span class="hs-identifier hs-var hs-var">unwrap_sig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span> </span><span class="annot"><span class="annottext">XHsSig (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_ximplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterImplicit pass
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683102413"><span class="annot"><span class="annottext">XHsOuterImplicit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102413"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621683102414"><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102414"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Name]
XHsOuterImplicit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102413"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102414"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1047"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall t. [Name] -&gt; TcM t
</span><a href="#local-6989586621683102415"><span class="hs-identifier hs-var">illegal_implicit_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
XHsOuterImplicit (GhcPass 'Renamed)
</span><a href="#local-6989586621683102413"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1048"></span><span>        </span><span class="annot"><a href="#local-6989586621683102407"><span class="hs-identifier hs-var">unwrap_sig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102416"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102416"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span> </span><span class="annot"><span class="annottext">XHsSig (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_bndrs :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; [LHsTyVarBndr flag (NoGhcTc pass)]
</span><a href="Language.Haskell.Syntax.Type.html#hso_bndrs"><span class="hs-identifier hs-var">hso_bndrs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683102419"><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity (NoGhcTc (GhcPass 'Renamed))]
</span><a href="#local-6989586621683102419"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621683102420"><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102420"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1049"></span><span>          </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(LHsType (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed)))
-&gt; LHsType (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102416"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XForAllTy (GhcPass 'Renamed)
-&gt; HsForAllTelescope (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed)
-&gt; HsType (GhcPass 'Renamed)
forall pass.
XForAllTy pass
-&gt; HsForAllTelescope pass -&gt; LHsType pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsForAllTy"><span class="hs-identifier hs-var">HsForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">XForAllTy (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsForAllInvis (GhcPass 'Renamed)
-&gt; [LHsTyVarBndr Specificity (GhcPass 'Renamed)]
-&gt; HsForAllTelescope (GhcPass 'Renamed)
forall pass.
XHsForAllInvis pass
-&gt; [LHsTyVarBndr Specificity pass] -&gt; HsForAllTelescope pass
</span><a href="Language.Haskell.Syntax.Type.html#HsForAllInvis"><span class="hs-identifier hs-var">HsForAllInvis</span></a></span><span> </span><span class="annot"><span class="annottext">XHsForAllInvis (GhcPass 'Renamed)
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity (NoGhcTc (GhcPass 'Renamed))]
[LHsTyVarBndr Specificity (GhcPass 'Renamed)]
</span><a href="#local-6989586621683102419"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102420"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102422"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102422"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102424"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102424"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1051"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102425"><span class="annot"><a href="#local-6989586621683102425"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102424"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1052"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102422"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsParTy"><span class="hs-identifier hs-type">HsParTy</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102425"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1053"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102427"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102427"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span id="local-6989586621683102429"><span class="annot"><span class="annottext">XUntypedSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621683102429"><span class="hs-identifier hs-var">splice_result</span></a></span></span><span> </span><span id="local-6989586621683102430"><span class="annot"><span class="annottext">HsUntypedSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621683102430"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1054"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceTop"><span class="hs-identifier hs-type">HsUntypedSpliceTop</span></a></span><span> </span><span id="local-6989586621683102432"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621683102432"><span class="hs-identifier hs-var">finalizers</span></a></span></span><span> </span><span id="local-6989586621683102433"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102433"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">XUntypedSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621683102429"><span class="hs-identifier hs-var">splice_result</span></a></span><span>
</span><span id="line-1055"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102434"><span class="annot"><a href="#local-6989586621683102434"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102427"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102433"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102435"><span class="annot"><a href="#local-6989586621683102435"><span class="hs-identifier hs-var hs-var">splice_result'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; HsUntypedSpliceResult
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall thing.
ThModFinalizers -&gt; thing -&gt; HsUntypedSpliceResult thing
</span><a href="GHC.Hs.Expr.html#HsUntypedSpliceTop"><span class="hs-identifier hs-var">HsUntypedSpliceTop</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621683102432"><span class="hs-identifier hs-var">finalizers</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102434"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1057"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102427"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSpliceTy"><span class="hs-identifier hs-type">HsSpliceTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102435"><span class="hs-identifier hs-type">splice_result'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102430"><span class="hs-identifier hs-type">splice</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1058"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102437"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102437"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">XUnboundVar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102438"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683102438"><span class="hs-identifier hs-var">rdr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isUnderscore"><span class="hs-identifier hs-var">isUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683102440"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102437"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XWildCardTy (GhcPass 'Renamed) -&gt; HsType (GhcPass 'Renamed)
forall pass. XWildCardTy pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsWildCardTy"><span class="hs-identifier hs-var">HsWildCardTy</span></a></span><span> </span><span class="annot"><span class="annottext">XWildCardTy (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#startsWithUnderscore"><span class="hs-identifier hs-var">startsWithUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683102440"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1061"></span><span>          </span><span class="hs-comment">-- See Note [Wildcards in the T2T translation]</span><span>
</span><span id="line-1062"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102443"><span class="annot"><a href="#local-6989586621683102443"><span class="hs-identifier hs-var">wildcards_enabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.NamedWildCards</span></span><span>
</span><span id="line-1063"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683102443"><span class="hs-identifier hs-type">wildcards_enabled</span></a></span><span>
</span><span id="line-1064"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621683102445"><span class="hs-identifier hs-type">illegal_wc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102438"><span class="hs-identifier hs-type">rdr</span></a></span><span>
</span><span id="line-1065"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621683102446"><span class="hs-identifier hs-type">not_in_scope</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1066"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (LHsType (GhcPass 'Renamed))
IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102446"><span class="hs-identifier hs-var">not_in_scope</span></a></span><span>
</span><span id="line-1067"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683102440"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683102440"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683102438"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1068"></span><span>            </span><span id="local-6989586621683102446"><span class="annot"><span class="annottext">not_in_scope :: IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683102446"><span class="hs-identifier hs-var hs-var">not_in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))))
-&gt; TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; NotInScopeError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#mkTcRnNotInScope"><span class="hs-identifier hs-var">mkTcRnNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683102438"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="GHC.Tc.Errors.Types.html#NotInScope"><span class="hs-identifier hs-var">NotInScope</span></a></span><span>
</span><span id="line-1069"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683102450"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102450"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExpandedThingRn"><span class="hs-identifier hs-type">ExpandedThingRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigExpr"><span class="hs-identifier hs-type">OrigExpr</span></a></span><span> </span><span id="local-6989586621683102452"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102452"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1070"></span><span>      </span><span class="hs-comment">-- Use the original, user-written expression (before expansion).</span><span>
</span><span id="line-1071"></span><span>      </span><span class="hs-comment">-- Example. Say we have   vfun :: forall a -&gt; blah</span><span>
</span><span id="line-1072"></span><span>      </span><span class="hs-comment">--          and the call  vfun (Maybe [1,2,3])</span><span>
</span><span id="line-1073"></span><span>      </span><span class="hs-comment">--          expanded to   vfun (Maybe (fromListN 3 [1,2,3]))</span><span>
</span><span id="line-1074"></span><span>      </span><span class="hs-comment">-- (This happens when OverloadedLists is enabled).</span><span>
</span><span id="line-1075"></span><span>      </span><span class="hs-comment">-- The expanded expression can't be promoted, as there is no type-level</span><span>
</span><span id="line-1076"></span><span>      </span><span class="hs-comment">-- equivalent of fromListN, so we must use the original.</span><span>
</span><span id="line-1077"></span><span>      </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcM (LHsType (GhcPass 'Renamed))
</span><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683102450"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102452"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span>    </span><span class="annot"><a href="#local-6989586621683102311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683102453"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102453"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (LHsType (GhcPass 'Renamed))
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM (LHsType (GhcPass 'Renamed)))
-&gt; TcRnMessage -&gt; TcM (LHsType (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllformedTypeArgument"><span class="hs-identifier hs-var">TcRnIllformedTypeArgument</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102453"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span>    </span><span id="local-6989586621683101291"><span class="annot"><a href="#local-6989586621683102313"><span class="hs-identifier hs-type">unwrap_wc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWildCardBndrs"><span class="hs-identifier hs-type">HsWildCardBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101291"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101291"><span class="hs-identifier hs-type">t</span></a></span></span><span>
</span><span id="line-1081"></span><span>    </span><span id="local-6989586621683102313"><span class="annot"><span class="annottext">unwrap_wc :: forall t. HsWildCardBndrs (GhcPass 'Renamed) t -&gt; TcM t
</span><a href="#local-6989586621683102313"><span class="hs-identifier hs-var hs-var">unwrap_wc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWC"><span class="hs-identifier hs-type">HsWC</span></a></span><span> </span><span id="local-6989586621683102458"><span class="annot"><span class="annottext">XHsWC (GhcPass 'Renamed) t
</span><a href="#local-6989586621683102458"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span id="local-6989586621683102459"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683102459"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ZonkAny 0))
-&gt; [Name] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ZonkAny 0)
forall t. RdrName -&gt; TcM t
</span><a href="#local-6989586621683102445"><span class="hs-identifier hs-var">illegal_wc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ZonkAny 0))
-&gt; (Name -&gt; RdrName)
-&gt; Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ZonkAny 0)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
XHsWC (GhcPass 'Renamed) t
</span><a href="#local-6989586621683102458"><span class="hs-identifier hs-var">wcs</span></a></span><span>
</span><span id="line-1083"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">t -&gt; IOEnv (Env TcGblEnv TcLclEnv) t
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683102459"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span>    </span><span id="local-6989586621683101370"><span class="annot"><a href="#local-6989586621683102445"><span class="hs-identifier hs-type">illegal_wc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101370"><span class="hs-identifier hs-type">t</span></a></span></span><span>
</span><span id="line-1086"></span><span>    </span><span id="local-6989586621683102445"><span class="annot"><span class="annottext">illegal_wc :: forall t. RdrName -&gt; TcM t
</span><a href="#local-6989586621683102445"><span class="hs-identifier hs-var hs-var">illegal_wc</span></a></span></span><span> </span><span id="local-6989586621683102463"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683102463"><span class="hs-identifier hs-var">rdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn t
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn t) -&gt; TcRnMessage -&gt; TcRn t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalNamedWildcardInTypeArgument"><span class="hs-identifier hs-var">TcRnIllegalNamedWildcardInTypeArgument</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683102463"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span>    </span><span id="local-6989586621683101354"><span class="annot"><a href="#local-6989586621683102415"><span class="hs-identifier hs-type">illegal_implicit_tvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683101354"><span class="hs-identifier hs-type">t</span></a></span></span><span>
</span><span id="line-1089"></span><span>    </span><span id="local-6989586621683102415"><span class="annot"><span class="annottext">illegal_implicit_tvs :: forall t. [Name] -&gt; TcM t
</span><a href="#local-6989586621683102415"><span class="hs-identifier hs-var hs-var">illegal_implicit_tvs</span></a></span></span><span> </span><span id="local-6989586621683102468"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683102468"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-1090"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcRn ()) -&gt; [Name] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ())
-&gt; (Name -&gt; TcRnMessage) -&gt; Name -&gt; TcRn ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalImplicitTyVarInTypeArgument"><span class="hs-identifier hs-var">TcRnIllegalImplicitTyVarInTypeArgument</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; TcRnMessage)
-&gt; (Name -&gt; RdrName) -&gt; Name -&gt; TcRnMessage
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683102468"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1091"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) t
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span class="hs-comment">{- Note [RequiredTypeArguments and the T2T mapping]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The &quot;T2T-Mapping&quot; section of GHC Proposal #281 introduces a term-to-type transformation
that comes into play when we typecheck function applications to required type arguments.
Say we have a function that expects a required type argument, vfun :: forall a -&gt; ...
then it is possible to call it as follows:

  vfun (Maybe Int)

The Maybe Int argument is parsed and renamed as a term. There is no syntactic marker
to tell GHC that it is actually a type argument.  We only discover this by the time
we get to type checking, where we know that f's type has a visible forall at the front,
so we are expecting a type argument. More precisely, this happens in tcVDQ in GHC/Tc/Gen/App.hs:

  tcVDQ :: ConcreteTyVars              -- See Note [Representation-polymorphism checking built-ins]
        -&gt; (ForAllTyBinder, TcType)    -- Function type
        -&gt; LHsExpr GhcRn               -- Argument type
        -&gt; TcM (TcType, TcType)

What we want is a type to instantiate the forall-bound variable. But what we have is an HsExpr,
and we need to convert it to an HsType in order to reuse the same code paths as we use for
checking f @ty (see tc_inst_forall_arg).

  f (Maybe Int)
  -- ^^^^^^^^^
  -- parsed and renamed as:   HsApp   (HsVar   &quot;Maybe&quot;) (HsVar   &quot;Int&quot;)  ::  HsExpr GhcRn
  -- must be converted to:    HsTyApp (HsTyVar &quot;Maybe&quot;) (HsTyVar &quot;Int&quot;)  ::  HsType GhcRn

We do this using a helper function:

  expr_to_type :: LHsExpr GhcRn -&gt; TcM (LHsWcType GhcRn)

This conversion is in the TcM monad because
* It can fail, if the expression is not convertible to a type.
      vfun [x | x &lt;- xs]     Can't convert list comprehension to a type
      vfun (\x -&gt; x)         Can't convert a lambda to a type
* It needs to check for LangExt.NamedWildCards to generate an appropriate
  error message for HsUnboundVar.
     vfun _a    Not in scope: &#8216;_a&#8217;
                   (NamedWildCards disabled)
     vfun _a    Illegal named wildcard in a required type argument: &#8216;_a&#8217;
                   (NamedWildCards enabled)

Note [Wildcards in the T2T translation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose f1 :: forall a b. blah
        f2 :: forall a b -&gt; blah

Consider the terms
  f1 @_ @(Either _ _)
  f2 (type _) (type (Either _ _))
Those `_` wildcards are type wildcards, each standing for a monotype.
All good.

Now consider this, with -XNamedWildCards:
  f1 @_a @(Either _a _a)
  f2 (type _a) (type (Either _a _a))
Those `_a` are &quot;named wildcards&quot;, specified by the user manual like this: &quot;All
occurrences of the same named wildcard within one type signature will unify to
the same type&quot;.  Note &quot;within one signature&quot;.  So each type argument is considered
separately, and the examples mean the same as:
  f1 @_a1 @(Either _a2 _a2)
  f2 (type _a1) (type (Either _a2 _a2))
The repeated `_a2` ensures that the two arguments of `Either` are the same type;
but there is no connection with `_a1`.  (NB: `_a1` and `_a2` only scope within
their respective type, no further.)

Now, consider the T2T translation for
   f2 _ (Either _ _)
This is fine: the term wildcard `_` is translated to a type wildcard, so we get
the same as if we had written
   f2 (type _) (type (Either _ _))

But what about /named/ wildcards?
   f2 _a (Either _a _a)
Now we are in difficulties.  The renamer looks for a /term/ variable `_a` in scope,
and won't find one.  Even if it did, the three `_a`'s would not be renamed separately
as above.

Conclusion: we treat a named wildcard in the T2T translation as an error.  If you
want that, use a `(type ty)` argument instead.
-}</span><span>
</span><span id="line-1175"></span><span>
</span><span id="line-1176"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tc_inst_forall_arg"><span class="hs-identifier hs-type">tc_inst_forall_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTyVars"><span class="hs-identifier hs-type">ConcreteTyVars</span></a></span><span>            </span><span class="hs-comment">-- See Note [Representation-polymorphism checking built-ins]</span><span>
</span><span id="line-1177"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#ForAllTyBinder"><span class="hs-identifier hs-type">ForAllTyBinder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Function type</span><span>
</span><span id="line-1178"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>           </span><span class="hs-comment">-- Argument type</span><span>
</span><span id="line-1179"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span id="tc_inst_forall_arg"><span class="annot"><span class="annottext">tc_inst_forall_arg :: ConcreteTyVars
-&gt; (TyVarBinder, TcType)
-&gt; LHsWcType (GhcPass 'Renamed)
-&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tc_inst_forall_arg"><span class="hs-identifier hs-var hs-var">tc_inst_forall_arg</span></a></span></span><span> </span><span id="local-6989586621683102472"><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102472"><span class="hs-identifier hs-var">conc_tvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102473"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102473"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102474"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102474"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102475"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102475"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-1181"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102476"><span class="annot"><span class="annottext">tv :: Id
</span><a href="#local-6989586621683102476"><span class="hs-identifier hs-var hs-var hs-var">tv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; Id
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102473"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-1182"></span><span>             </span><span id="local-6989586621683102478"><span class="annot"><span class="annottext">kind :: TcType
</span><a href="#local-6989586621683102478"><span class="hs-identifier hs-var hs-var hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102476"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1183"></span><span>             </span><span id="local-6989586621683102479"><span class="annot"><span class="annottext">tv_nm :: Name
</span><a href="#local-6989586621683102479"><span class="hs-identifier hs-var hs-var hs-var">tv_nm</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102476"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1184"></span><span>             </span><span id="local-6989586621683102481"><span class="annot"><span class="annottext">mb_conc :: Maybe ConcreteTvOrigin
</span><a href="#local-6989586621683102481"><span class="hs-identifier hs-var hs-var hs-var">mb_conc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars -&gt; Name -&gt; Maybe ConcreteTvOrigin
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621683102472"><span class="hs-identifier hs-var">conc_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683102479"><span class="hs-identifier hs-var">tv_nm</span></a></span><span>
</span><span id="line-1185"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102483"><span class="annot"><a href="#local-6989586621683102483"><span class="hs-identifier hs-var">ty_arg0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed) -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTypeApp"><span class="hs-identifier hs-var">tcHsTypeApp</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683102475"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102478"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span>       </span><span class="hs-comment">-- Is this type variable required to be instantiated to a concrete type?</span><span>
</span><span id="line-1188"></span><span>       </span><span class="hs-comment">-- If so, ensure that that is the case.</span><span>
</span><span id="line-1189"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-1190"></span><span>       </span><span class="hs-comment">-- See [Wrinkle: VTA] in Note [Representation-polymorphism checking built-ins]</span><span>
</span><span id="line-1191"></span><span>       </span><span class="hs-comment">-- in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-1192"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102485"><span class="annot"><a href="#local-6989586621683102485"><span class="hs-identifier hs-var">th_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-type">getStage</span></a></span><span>
</span><span id="line-1193"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102487"><span class="annot"><a href="#local-6989586621683102487"><span class="hs-identifier hs-var">ty_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102481"><span class="hs-identifier hs-type">mb_conc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1194"></span><span>           </span><span class="annot"><span class="annottext">Maybe ConcreteTvOrigin
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102483"><span class="hs-identifier hs-var">ty_arg0</span></a></span><span>
</span><span id="line-1195"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102488"><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683102488"><span class="hs-identifier hs-var">conc</span></a></span></span><span>
</span><span id="line-1196"></span><span>             </span><span class="hs-comment">-- See [Wrinkle: Typed Template Haskell]</span><span>
</span><span id="line-1197"></span><span>             </span><span class="hs-comment">-- in Note [hasFixedRuntimeRep] in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-1198"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621683102485"><span class="hs-identifier hs-var">th_stage</span></a></span><span>
</span><span id="line-1199"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102483"><span class="hs-identifier hs-var">ty_arg0</span></a></span><span>
</span><span id="line-1200"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1201"></span><span>             </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1202"></span><span>             </span><span class="hs-comment">-- Example: user wrote e.g. (#,#) @(F Bool) for a type family F.</span><span>
</span><span id="line-1203"></span><span>             </span><span class="hs-comment">-- Emit [W] F Bool ~ kappa[conc] and pretend the user wrote (#,#) @kappa.</span><span>
</span><span id="line-1204"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102491"><span class="annot"><a href="#local-6989586621683102491"><span class="hs-identifier hs-var">mco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
FastString -&gt; ConcreteTvOrigin -&gt; TcType -&gt; TcM TcMCoercionN
FastString -&gt; ConcreteTvOrigin -&gt; TcType -&gt; TcM TcMCoercionN
</span><a href="GHC.Tc.Utils.Concrete.html#unifyConcrete"><span class="hs-identifier hs-var">unifyConcrete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString) -&gt; OccName -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; Name -&gt; OccName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683102479"><span class="hs-identifier hs-var">tv_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683102488"><span class="hs-identifier hs-var">conc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102483"><span class="hs-identifier hs-var">ty_arg0</span></a></span><span>
</span><span id="line-1205"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102491"><span class="hs-identifier hs-type">mco</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcMCoercionN
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102483"><span class="hs-identifier hs-var">ty_arg0</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621683102496"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621683102496"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercionN -&gt; TcType
TcCoercionN -&gt; TcType
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621683102496"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102498"><span class="annot"><a href="#local-6989586621683102498"><span class="hs-identifier hs-var hs-var">fun_ty</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621683102473"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102474"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-1208"></span><span>             </span><span id="local-6989586621683102500"><span class="annot"><a href="#local-6989586621683102500"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThetaType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102498"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102487"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>             </span><span id="local-6989586621683102502"><span class="annot"><a href="#local-6989586621683102502"><span class="hs-identifier hs-var hs-var">insted_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
InScopeSet -&gt; [Id] -&gt; ThetaType -&gt; TcType -&gt; TcType
InScopeSet -&gt; [Id] -&gt; ThetaType -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier hs-var">substTyWithInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621683102500"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102476"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102487"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102474"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-1210"></span><span>               </span><span class="hs-comment">-- This substitution is well-kinded even when inner_ty</span><span>
</span><span id="line-1211"></span><span>               </span><span class="hs-comment">-- is not fully zonked, because ty_arg is fully zonked.</span><span>
</span><span id="line-1212"></span><span>               </span><span class="hs-comment">-- See Note [Type application substitution].</span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_inst_forall_arg (VTA/VDQ)&quot;</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1215"></span><span>                  </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;fun_ty&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102498"><span class="hs-identifier hs-type">fun_ty</span></a></span><span>
</span><span id="line-1216"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tv&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102476"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102478"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-1217"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ty_arg&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102487"><span class="hs-identifier hs-type">ty_arg</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span>
</span><span id="line-1218"></span><span>                                       </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-type">typeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102487"><span class="hs-identifier hs-type">ty_arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inner_ty&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102474"><span class="hs-identifier hs-type">inner_ty</span></a></span><span>
</span><span id="line-1220"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;insted_ty&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102502"><span class="hs-identifier hs-type">insted_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683102487"><span class="hs-identifier hs-type">ty_arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683102502"><span class="hs-identifier hs-type">insted_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span class="hs-comment">{- Note [Visible type application and abstraction]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GHC supports the types
    forall {a}.  a -&gt; t     -- ForAllTyFlag is Inferred
    forall  a.   a -&gt; t     -- ForAllTyFlag is Specified
    forall  a -&gt; a -&gt; t     -- ForAllTyFlag is Required

The design of type abstraction and type application for those types has gradually
evolved over time, and is based on the following papers and proposals:
  - &quot;Visible Type Application&quot;
    https://richarde.dev/papers/2016/type-app/visible-type-app.pdf
  - &quot;Type Variables in Patterns&quot;
    https://richarde.dev/papers/2018/pat-tyvars/pat-tyvars.pdf
  - &quot;Modern Scoped Type Variables&quot;
    https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0448-type-variable-scoping.rst
  - &quot;Visible forall in types of terms&quot;
    https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0281-visible-forall.rst

Here we offer an overview of the design mixed with commentary on the
implementation status. The proposals have not been fully implemented at the
time of writing this Note (see &quot;not implemented&quot; in the rest of this Note).

Now consider functions
    fi :: forall {a}. a -&gt; t     -- Inferred:  type argument cannot be supplied
    fs :: forall a. a -&gt; t       -- Specified: type argument may    be supplied
    fr :: forall a -&gt; a -&gt; t     -- Required:  type argument must   be supplied

At a call site we may have calls looking like this
    fi             True  -- Inferred: no visible type argument
    fs             True  -- Specified: type argument omitted
    fs      @Bool  True  -- Specified: type argument supplied
    fr (type Bool) True  -- Required: type argument is compulsory, `type` qualifier used
    fr       Bool  True  -- Required: type argument is compulsory, `type` qualifier omitted

At definition sites we may have type /patterns/ to abstract over type variables
   fi           x       = rhs   -- Inferred: no type pattern
   fs           x       = rhs   -- Specified: type pattern omitted
   fs @a       (x :: a) = rhs   -- Specified: type pattern supplied
   fr (type a) (x :: a) = rhs   -- Required: type pattern is compulsory, `type` qualifier used
   fr a        (x :: a) = rhs   -- Required: type pattern is compulsory, `type` qualifier omitted

Type patterns in lambdas mostly work the same way as they do in a function LHS,
except for @-binders
   OK:  fs = \           x       -&gt; rhs   -- Specified: type pattern omitted
   Bad: fs = \ @a       (x :: a) -&gt; rhs   -- Specified: type pattern supplied
   OK:  fr = \ (type a) (x :: a) -&gt; rhs   -- Required: type pattern is compulsory, `type` qualifier used
   OK:  fr = \ a        (x :: a) -&gt; rhs   -- Required: type pattern is compulsory, `type` qualifier omitted

When it comes to @-binders in lambdas, they do work, but only in a limited set
of circumstances:
  * the lambda occurs as an argument to a higher-rank function or constructor
      higher-rank function:  h :: (forall a. blah) -&gt; ...
      call site:             x = h (\ @a -&gt; ... )
  * the lambda is annotated with an inline type signature:
      (\ @a -&gt; ... ) :: forall a. blah
  * the lambda is a field in a data structure, whose type is impredicative
      [ \ @a -&gt; ... ] :: [forall a. blah]
  * the @-binder is not the first binder in the lambda:
      \ x @a -&gt; ...

Type patterns may also occur in a constructor pattern. Consider the following data declaration
   data T where
     MkTI :: forall {a}. Show a =&gt; a -&gt; T   -- Inferred
     MkTS :: forall a.   Show a =&gt; a -&gt; T   -- Specified
     MkTR :: forall a -&gt; Show a =&gt; a -&gt; T   -- Required  (NB: not implemented)

Matching on its constructors may look like this
   f (MkTI           x)       = rhs  -- Inferred: no type pattern
   f (MkTS           x)       = rhs  -- Specified: type pattern omitted
   f (MkTS @a       (x :: a)) = rhs  -- Specified: type pattern supplied
   f (MkTR (type a) (x :: a)) = rhs  -- Required: type pattern is compulsory, `type` qualifier used    (NB: not implemented)
   f (MkTR a        (x :: a)) = rhs  -- Required: type pattern is compulsory, `type` qualifier omitted (NB: not implemented)

The moving parts are as follows:
  (abbreviations used: &quot;c.o.&quot; = &quot;constructor of&quot;)

Syntax of types
---------------
* The types are all initially represented with HsForAllTy (c.o. HsType).
  The binders are in the (hst_tele :: HsForAllTelescope pass) field of the HsForAllTy
  At this stage, we have
      forall {a}. t    -- HsForAllInvis (c.o. HsForAllTelescope) and InferredSpec  (c.o. Specificity)
      forall a. t      -- HsForAllInvis (c.o. HsForAllTelescope) and SpecifiedSpec (c.o. Specificity)
      forall a -&gt; t    -- HsForAllVis (c.o. HsForAllTelescope)

* By the time we get to checking applications/abstractions (e.g. GHC.Tc.Gen.App)
  the types have been kind-checked (e.g. by tcLHsType) into ForAllTy (c.o. Type).
  At this stage, we have:
      forall {a}. t    -- ForAllTy (c.o. Type) and Inferred  (c.o. ForAllTyFlag)
      forall a. t      -- ForAllTy (c.o. Type) and Specified (c.o. ForAllTyFlag)
      forall a -&gt; t    -- ForAllTy (c.o. Type) and Required  (c.o. ForAllTyFlag)

Syntax of applications in HsExpr
--------------------------------
* We represent type applications in HsExpr like this (ignoring parameterisation)
    data HsExpr = HsApp HsExpr HsExpr      -- (f True)    (plain function application)
                | HsAppType HsExpr HsType  -- (f @True)   (function application with `@`)
                | HsEmbTy HsType           -- (type Int)  (embed a type into an expression with `type`)
                | ...

* So (f @ty) is represented, just as you might expect:
    HsAppType f ty

* But (f (type ty)) is represented by:
    HsApp f (HsEmbTy ty)

  Why the difference?  Because we /also/ need to express these /nested/ uses of `type`:

      g (Maybe (type Int))               -- valid for g :: forall (a :: Type) -&gt; t
      g (Either (type Int) (type Bool))  -- valid for g :: forall (a :: Type) -&gt; t

  This nesting makes `type` rather different from `@`. Remember, the HsEmbTy mainly just
  switches namespace, and is subject to the term-to-type transformation.

Syntax of abstractions in Pat
-----------------------------
* Type patterns are represented in Pat roughly like this
     data Pat = ConPat   ConLike [HsTyPat] [Pat]  -- (Con @tp1 @tp2 p1 p2)  (constructor pattern)
              | EmbTyPat HsTyPat                  -- (type tp)              (embed a type into a pattern with `type`)
              | ...
     data HsTyPat = HsTP LHsType
  (In ConPat, the type and term arguments are actually inside HsConPatDetails.)

  * Similar to HsAppType in HsExpr, the [HsTyPat] in ConPat is used just for @ty arguments
  * Similar to HsEmbTy   in HsExpr, EmbTyPat lets you embed a type in a pattern

* Examples:
      \ (MkT @a  (x :: a)) -&gt; rhs    -- ConPat (c.o. Pat) and HsConPatTyArg (c.o. HsConPatTyArg)
      \ (type a) (x :: a)  -&gt; rhs    -- EmbTyPat (c.o. Pat)
      \ a        (x :: a)  -&gt; rhs    -- VarPat (c.o. Pat)
      \ @a       (x :: a)  -&gt; rhs    -- InvisPat (c.o. Pat)

* A HsTyPat is not necessarily a plain variable. At the very least,
  we support kind signatures and wildcards:
      \ (type _)           -&gt; rhs
      \ (type (b :: Bool)) -&gt; rhs
      \ (type (_ :: Bool)) -&gt; rhs
  But in constructor patterns we also support full-on types
      \ (P @(a -&gt; Either b c)) -&gt; rhs
  All these forms are represented with HsTP (c.o. HsTyPat).

Renaming type applications
--------------------------
rnExpr delegates renaming of type arguments to rnHsWcType if possible:
    f @t        -- HsAppType,         t is renamed with rnHsWcType
    f (type t)  -- HsApp and HsEmbTy, t is renamed with rnHsWcType

But what about:
    f t         -- HsApp, no HsEmbTy
We simply rename `t` as a term using a recursive call to rnExpr; in particular,
the type of `f` does not affect name resolution (Lexical Scoping Principle).
We will later convert `t` from a `HsExpr` to a `Type`, see &quot;Typechecking type
applications&quot; later in this Note. The details are spelled out in the &quot;Resolved
Syntax Tree&quot; and &quot;T2T-Mapping&quot; sections of GHC Proposal #281.

Renaming type abstractions
--------------------------
rnPat delegates renaming of type arguments to rnHsTyPat if possible:
  f (P @t)   = rhs  -- ConPat,   t is renamed with rnHsTyPat
  f (type t) = rhs  -- EmbTyPat, t is renamed with rnHsTyPat

But what about:
  f t = rhs   -- VarPat
The solution is as before (see previous section), mutatis mutandis.
Rename `t` as a pattern using a recursive call to `rnPat`, convert it
to a type pattern later.

One particularly prickly issue is that of implicit quantification. Consider:

  f :: forall a -&gt; ...
  f t = ...   -- binding site of `t`
    where
      g :: t -&gt; t   -- use site of `t` or a fresh variable?
      g = ...

Does the signature of `g` refer to `t` bound in `f`, or is it a fresh,
implicitly quantified variable? This is normally controlled by
ScopedTypeVariables, but in this example the renamer can't tell `t` from a term
variable.  Only later (in the type checker) will we find out that it stands for
the forall-bound type variable `a`.  So when RequiredTypeArguments is in effect,
we change implicit quantification to take term variables into account; that is,
we do not implicitly quantify the signature of `g` to `g :: forall t. t-&gt;t`
because of the term-level `t` that is in scope.
See Note [Term variable capture and implicit quantification].

Typechecking type applications
------------------------------
Type applications are checked alongside ordinary function applications
in tcInstFun.

First of all, we assume that the function type is known (i.e. not a metavariable)
and contains a `forall`. Consider:
  f :: forall a. a -&gt; a
  f x = const x (f @Int 5)
If the type signature is removed, the definition results in an error:
  Cannot apply expression of type &#8216;t1&#8217;
  to a visible type argument &#8216;Int&#8217;

The same principle applies to required type arguments:
  f :: forall a -&gt; a -&gt; a
  f (type a) x = const x (f (type Int) 5)
If the type signature is removed, the error is:
  Illegal type pattern.
  A type pattern must be checked against a visible forall.

When the type of the function is known and contains a `forall`, all we need to
do is instantiate the forall-bound variable with the supplied type argument.
This is done by tcVTA (if Specified) and tcVDQ (if Required).

tcVDQ unwraps the HsEmbTy and uses the type contained within it.  Crucially, in
tcVDQ we know that we are expecting a type argument.  This means that we can
support
    f (Maybe Int)   -- HsApp, no HsEmbTy
The type argument (Maybe Int) is represented as an HsExpr, but tcVDQ can easily
convert it to HsType.  This conversion is called the &quot;T2T-Mapping&quot; in GHC
Proposal #281.

Typechecking type abstractions
------------------------------
Type abstractions are checked alongside ordinary patterns in GHC.Tc.Gen.Pat.tcMatchPats.
One of its inputs is a list of ExpPatType that has two constructors
  * ExpFunPatTy    ...   -- the type A of a function A -&gt; B
  * ExpForAllPatTy ...   -- the binder (a::A) of forall (a::A) -&gt; B
so when we are checking
  f :: forall a b -&gt; a -&gt; b -&gt; ...
  f (type a) (type b) (x :: a) (y :: b) = ...
our expected pattern types are
  [ ExpForAllPatTy ...      -- forall a -&gt;
  , ExpForAllPatTy ...      -- forall b -&gt;
  , ExpFunPatTy    ...      -- a -&gt;
  , ExpFunPatTy    ...      -- b -&gt;
  ]

The [ExpPatType] is initially constructed by GHC.Tc.Utils.Unify.matchExpectedFunTys,
by decomposing the type signature for `f` in our example.  If we are given a
definition
   g (type a) = ...
we never /infer/ a type g :: forall a -&gt; blah.  We can only /check/
explicit type abstractions in terms.

The [ExpPatType] allows us to use different code paths for type abstractions
and ordinary patterns:
  * tc_pat :: Scaled ExpSigmaTypeFRR -&gt; Checker (Pat GhcRn) (Pat GhcTc)
  * tc_forall_pat :: Checker (Pat GhcRn, TcTyVar) (Pat GhcTc)

tc_forall_pat unwraps the EmbTyPat and uses the type pattern contained
within it. This is another spot where the &quot;T2T-Mapping&quot; can take place,
allowing us to support
  f a (x :: a) = rhs    -- no EmbTyPat

Type patterns in constructor patterns are handled in with tcConTyArg.
Both tc_forall_pat and tcConTyArg delegate most of the work to tcHsTyPat.

Note [VTA for out-of-scope functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose 'wurble' is not in scope, and we have
   (wurble @Int @Bool True 'x')

Then the renamer will make (HsUnboundVar &quot;wurble&quot;) for 'wurble',
and the typechecker will typecheck it with tcUnboundId, giving it
a type 'alpha', and emitting a deferred Hole constraint, to
be reported later.

But then comes the visible type application. If we do nothing, we'll
generate an immediate failure (in tc_app_err), saying that a function
of type 'alpha' can't be applied to Bool.  That's insane!  And indeed
users complain bitterly (#13834, #17150.)

The right error is the Hole, which has /already/ been emitted by
tcUnboundId.  It later reports 'wurble' as out of scope, and tries to
give its type.

Fortunately in tcInstFun we still have access to the function, so we
can check if it is a HsUnboundVar.  We use this info to simply skip
over any visible type arguments.  We'll /already/ have emitted a
Hole constraint; failing preserves that constraint.

We do /not/ want to fail altogether in this case (via failM) because
that may abandon an entire instance decl, which (in the presence of
-fdefer-type-errors) leads to leading to #17792.

What about required type arguments?  Suppose we see
    f (type Int)
where `f` is out of scope.  Then again we don't want to crash because f's
type (which will be just a fresh unification variable) isn't a visible forall.
Instead we just skip the `(type Int)` argument, as before.

Downside: the typechecked term has lost its visible type arguments; we
don't even kind-check them.  But let's jump that bridge if we come to
it.  Meanwhile, let's not crash!

Note [Type application substitution]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In `tc_inst_forall_arg`, suppose we are checking a visible type
application `f @hs_ty`, where `f :: forall (a :: k). body`.  We will:
  * Compute `ty &lt;- tcHsTypeApp hs_ty k`
  * Then substitute `a :-&gt; ty` in `body`.
Now, you might worry that `a` might not have the same kind as `ty`, so that the
substitution isn't kind-preserving.  How can that happen?  The kinds will
definitely be the same after zonking, and `ty` will be zonked (as this is
a postcondition of `tcHsTypeApp`). But the function type `forall a. body`
might not be fully zonked (hence the worry).

But it's OK!  During type checking, we don't require types to be well-kinded (without
zonking); we only require them to satsisfy the Purely Kinded Type Invariant (PKTI).
See Note [The Purely Kinded Type Invariant (PKTI)] in GHC.Tc.Gen.HsType.

In the case of a type application:
  * `forall a. body` satisfies the PKTI
  * `ty` is zonked
  * If we substitute a fully-zonked thing into an un-zonked Type that
    satisfies the PKTI, the result still satisfies the PKTI.

This last statement isn't obvious, but read
Note [The Purely Kinded Type Invariant (PKTI)] in GHC.Tc.Gen.HsType.
The tricky case is when `body` contains an application of the form `a b1 ... bn`,
and we substitute `a :-&gt; ty` where `ty` has fewer arrows in its kind than `a` does.
That can't happen: the call `tcHsTypeApp hs_ty k` would have rejected the
type application as ill-kinded.

Historical remark: we used to require a stronger invariant than the PKTI,
namely that all types are well-kinded prior to zonking. In that context, we did
need to zonk `body` before performing the substitution above. See test case
#14158, as well as the discussion in #23661.
-}</span><span>
</span><span id="line-1548"></span><span>
</span><span id="line-1549"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Quick Look
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1554"></span><span>
</span><span id="line-1555"></span><span class="hs-comment">{- Note [Quick Look at value arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The function quickLookArg implements the &quot;QL argument&quot; judgement of
the QL paper, in Fig 5 of &quot;A quick look at impredicativity&quot; (ICFP 2020),
rather directly.  The key rule, implemented by `quickLookArg` is

   G |-h h:sg                         -- Find the type of the head
   G |-inst sg;pis ~&gt; phis;rho_r      -- tcInstFun on the args
   (A) rho = T sgs  OR  (B) fiv(phis) = emptyset  -- can_do_ql
   -------------------------------------- APP-QL
   G |-ql h pis : rho ~&gt; qlUnify( rho, rho_r )

(The paper uses a lightning-bolt where we use &quot;ql&quot;.)  The most straightforward
way to implement this rule for a call (f e1 ... en) would be:

   1. Take a quick look at the argumets e1..en to guide instantiation
      of the function f.
   2. Then typecheck e1..en from scratch.

That's wasteful, because in Step 1, the quick look at each argument, say (g
h1..hm), involves instantiating `h` and taking a quick look at /its/
arguments.  Then in Step 2 we typecheck (g h1..hm) and again take a quick look
at its arguments.  This is quadratic in the nesting depth of the arguments.

Instead, after the quick look, we /save/ the work we have done in an EValArgQL
record, and /resume/ it later.  The way to think of it is this:

  * `tcApp` typechecks an application.  It uses `tcInstFun`, which in turn
    calls `quickLookArg` on each value argument.

  * `quickLookArg` (which takes a quick look at the argument)

      - Does the &quot;initial&quot; part of `tcApp`, especially `tcInstFun`

      - Captures the result in an EValArgQL record

      - Later, `tcValArg` starts from the EValArgQL record, and
        completes the job of typechecking the application

This turned out to be more subtle than I expected.  Wrinkles:

(QLA1) `quickLookArg` decides whether or not premises (A) and (B) of the
  quick-look-arg judgement APP-QL are satisfied; this is captured in
  `arg_influences_enclosing_call`.

(QLA2) We avoid zonking, so the `arg_influences_enclosing_call` sees the
  argument type /before/ the QL substitution Theta is applied to it. So we
  achieve argument-order independence for free (see 5.7 in the paper).  See the
  `isGuardedTy orig_arg_rho` test in `quickLookArg`.

(QLA3) Deciding whether the premises are satisfied involves calling `tcInstFun`
  (which takes quite some work becuase it calls quickLookArg on nested calls).
  That's why we want to capture the work done, in EValArgQL.

  Do we really have to call `tcInstFun` before deciding (B) of
  `arg_influences_enclosing_call`? Yes (#24686).
  Suppose ids :: [forall a. a-&gt;a], and consider
     (:) (reverse ids) blah
  `tcApp` on the outer call will instantiate (:) with `kappa`, and take a
  quick look at (reverse ids). Only after instantiating `reverse` with kappa2,
  quick-looking at `ids` can we discover that (kappa2:=forall a. a-&gt;a), which
  satisfies premise (B) of `arg_influence_enclosing_call`.

(QLA4) When we resume typechecking an argument, in `tcValArg` on `EValArgQL`

  - Calling `tcInstFun` on the argument may have emitted some constraints, which
    we carefully captured in `quickLookArg` and stored in the EValArgQL.  We must
    now emit them with `emitConstraints`.  This must be done /under/ the skolemisation
    of the argument's type (see `tcSkolemise` in `tcValArg` for EValArgQL { ...}.
    Example:   f :: (forall b. Ord b =&gt; b -&gt; b -&gt; Bool) -&gt; ...
       Call:   f (==)
    we must skolemise the argument type (forall b. Ord b =&gt; b -&gt; b -&gt; Bool)
    before emitting the [W] Eq alpha constraint arising from the call to (==).
    It will be solved from the Ord b!

  - quickLookArg may or may not have done `qlUnify` with the calling context.
    If not (eaql_encl = False) must do so now.  Example:  choose [] ids,
            where ids :: [forall a. a-&gt;a]
                  choose :: a -&gt; a -&gt; a
    We instantiate choose with `kappa` and discover from `ids` that
    (kappa = [forall a. a-&gt;a]).  Now we resume typechecking argument [], and
    we must take advantage of what we have now discovered about `kappa`,
    to typecheck   [] :: [forall a. a-&gt;a]

(QLA5) In the quicklook pass, we don't scale multiplicities. Since arguments
    aren't typechecked yet, we don't know their free variable usages
    anyway. But, in a nested call, the head of an application chain is fully
    typechecked.

    In order for the multiplicities in the head to be properly scaled, we store
    the head's usage environment in the eaql_fun_ue field. Then, when we do the
    full-typechecking pass, we can emit the head's usage environment where we
    would have typechecked the head in a naive algorithm.

(QLA6) `quickLookArg` is supposed to capture the result of partially typechecking
   the argument, so it can be resumed later.  &quot;Capturing&quot; should include all
   generated type-class/equality constraints and Linear-Haskell usage info. There
   are two calls in `quickLookArg1` that might generate such constraints:

     - `tcInferAppHead_maybe`.  This can generat Linear-Haskell usage info, via
       the call to `tcEmitBindingUsage` in `check_local_id`, which is called
       indirectly by `tcInferAppHead_maybe`.

       In contrast, `tcInferAppHead_maybe` does not generate any type-class or
       equality constraints, because it doesn't instantiate any functions.  [But
       see #25493 and #25494 for why this isn't quite true today.]

    - `tcInstFun` generates lots of type-class and equality constraints, as it
      instantiates the function.  But it generates no usage info, because that
      comes only from the call to `check_local_id`, whose usage info is captured
      in the call to `tcInferAppHead_maybe` in `quickLookArg1`.

  Conclusion: in quickLookArg1:
    - capture usage information (but not constraints)
        for the call to `tcInferAppHead_maybe`
    - capture constraints (but not usage information)
        for the call to `tcInstFun`

-}</span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookArg"><span class="hs-identifier hs-type">quickLookArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span>
</span><span id="line-1676"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Argument</span></span><span>
</span><span id="line-1677"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Type expected by the function</span></span><span>
</span><span id="line-1678"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1679"></span><span class="hs-comment">-- See Note [Quick Look at value arguments]</span><span>
</span><span id="line-1680"></span><span id="quickLookArg"><span class="annot"><span class="annottext">quickLookArg :: QLFlag
-&gt; AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; Scaled TcType
-&gt; TcM (HsExprArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#quickLookArg"><span class="hs-identifier hs-var hs-var">quickLookArg</span></a></span></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-var">NoQL</span></a></span><span> </span><span id="local-6989586621683102507"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102507"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683102508"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102508"><span class="hs-identifier hs-var">larg</span></a></span></span><span> </span><span id="local-6989586621683102509"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102509"><span class="hs-identifier hs-var">orig_arg_ty</span></a></span></span><span>
</span><span id="line-1681"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; Scaled TcType
-&gt; TcM (HsExprArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var">skipQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102507"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102508"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102509"><span class="hs-identifier hs-var">orig_arg_ty</span></a></span><span>
</span><span id="line-1682"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookArg"><span class="hs-identifier hs-var">quickLookArg</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span id="local-6989586621683102511"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102511"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683102512"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102512"><span class="hs-identifier hs-var">larg</span></a></span></span><span> </span><span id="local-6989586621683102513"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102513"><span class="hs-identifier hs-var">orig_arg_ty</span></a></span></span><span>
</span><span id="line-1683"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102514"><span class="annot"><a href="#local-6989586621683102514"><span class="hs-identifier hs-var">is_rho</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.App.html#tcIsDeepRho"><span class="hs-identifier hs-var">tcIsDeepRho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102513"><span class="hs-identifier hs-var">orig_arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;qla&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102513"><span class="hs-identifier hs-type">orig_arg_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102514"><span class="hs-identifier hs-type">is_rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1685"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683102514"><span class="hs-identifier hs-type">is_rho</span></a></span><span>
</span><span id="line-1686"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-type">skipQuickLook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102511"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102512"><span class="hs-identifier hs-type">larg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102513"><span class="hs-identifier hs-type">orig_arg_ty</span></a></span><span>
</span><span id="line-1687"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookArg1"><span class="hs-identifier hs-type">quickLookArg1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102511"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102512"><span class="hs-identifier hs-type">larg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102513"><span class="hs-identifier hs-type">orig_arg_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1688"></span><span>
</span><span id="line-1689"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-type">skipQuickLook</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-1690"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1691"></span><span id="skipQuickLook"><span class="annot"><span class="annottext">skipQuickLook :: AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; Scaled TcType
-&gt; TcM (HsExprArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var hs-var">skipQuickLook</span></a></span></span><span> </span><span id="local-6989586621683102518"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102518"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683102519"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102519"><span class="hs-identifier hs-var">larg</span></a></span></span><span> </span><span id="local-6989586621683102520"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102520"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span>
</span><span id="line-1692"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; TcM (HsExprArg 'TcpInst)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102518"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1693"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_arg :: LHsExpr (GhcPass (XPass 'TcpInst))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
LHsExpr (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683102519"><span class="hs-identifier hs-var">larg</span></a></span><span>
</span><span id="line-1694"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_arg_ty :: XEVAType 'TcpInst
</span><a href="GHC.Tc.Gen.Head.html#ea_arg_ty"><span class="hs-identifier hs-var">ea_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled TcType
XEVAType 'TcpInst
</span><a href="#local-6989586621683102520"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1695"></span><span>
</span><span id="line-1696"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#whenQL"><span class="hs-identifier hs-type">whenQL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1697"></span><span id="whenQL"><span class="annot"><span class="annottext">whenQL :: QLFlag -&gt; ZonkM () -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#whenQL"><span class="hs-identifier hs-var hs-var">whenQL</span></a></span></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span id="local-6989586621683102521"><span class="annot"><span class="annottext">ZonkM ()
</span><a href="#local-6989586621683102521"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcRn ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM ()
</span><a href="#local-6989586621683102521"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1698"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#whenQL"><span class="hs-identifier hs-var">whenQL</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-var">NoQL</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM ()
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1699"></span><span>
</span><span id="line-1700"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcIsDeepRho"><span class="hs-identifier hs-type">tcIsDeepRho</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1701"></span><span class="hs-comment">-- This top-level zonk step, which is the reason we need a local 'go' loop,</span><span>
</span><span id="line-1702"></span><span class="hs-comment">-- is subtle. See Section 9 of the QL paper</span><span>
</span><span id="line-1703"></span><span>
</span><span id="line-1704"></span><span id="tcIsDeepRho"><span class="annot"><span class="annottext">tcIsDeepRho :: TcType -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.App.html#tcIsDeepRho"><span class="hs-identifier hs-var hs-var">tcIsDeepRho</span></a></span></span><span> </span><span id="local-6989586621683102522"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102522"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1705"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102523"><span class="annot"><a href="#local-6989586621683102523"><span class="hs-identifier hs-var">ds_flag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM DeepSubsumptionFlag
</span><a href="GHC.Tc.Utils.Unify.html#getDeepSubsumptionFlag"><span class="hs-identifier hs-var">getDeepSubsumptionFlag</span></a></span><span>
</span><span id="line-1706"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683102524"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102523"><span class="hs-identifier hs-type">ds_flag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102522"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1707"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1708"></span><span>    </span><span id="local-6989586621683102524"><span class="annot"><span class="annottext">go :: DeepSubsumptionFlag -&gt; TcType -&gt; m Bool
</span><a href="#local-6989586621683102524"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683102542"><span class="annot"><span class="annottext">DeepSubsumptionFlag
</span><a href="#local-6989586621683102542"><span class="hs-identifier hs-var">ds_flag</span></a></span></span><span> </span><span id="local-6989586621683102543"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102543"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1709"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isSigmaTy"><span class="hs-identifier hs-var">isSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102543"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1710"></span><span>
</span><span id="line-1711"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102545"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102545"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe Id
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102543"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1712"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isQLInstTyVar"><span class="hs-identifier hs-var">isQLInstTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102545"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-1713"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102546"><span class="annot"><a href="#local-6989586621683102546"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; m MetaDetails
forall (m :: * -&gt; *). MonadIO m =&gt; Id -&gt; m MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102545"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-1714"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102546"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1715"></span><span>               </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683102547"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102547"><span class="hs-identifier hs-var">arg_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeepSubsumptionFlag -&gt; TcType -&gt; m Bool
</span><a href="#local-6989586621683102524"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DeepSubsumptionFlag
</span><a href="#local-6989586621683102542"><span class="hs-identifier hs-var">ds_flag</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102547"><span class="hs-identifier hs-var">arg_ty'</span></a></span><span>
</span><span id="line-1716"></span><span>               </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1717"></span><span>
</span><span id="line-1718"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DeepSubsumptionFlag
</span><a href="GHC.Tc.Utils.Unify.html#Deep"><span class="hs-identifier hs-var">Deep</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DeepSubsumptionFlag
</span><a href="#local-6989586621683102542"><span class="hs-identifier hs-var">ds_flag</span></a></span><span>
</span><span id="line-1719"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102548"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102548"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (Scaled TcType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102543"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1720"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeepSubsumptionFlag -&gt; TcType -&gt; m Bool
</span><a href="#local-6989586621683102524"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DeepSubsumptionFlag
</span><a href="#local-6989586621683102542"><span class="hs-identifier hs-var">ds_flag</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102548"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1721"></span><span>
</span><span id="line-1722"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#isGuardedTy"><span class="hs-identifier hs-type">isGuardedTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1725"></span><span id="isGuardedTy"><span class="annot"><span class="annottext">isGuardedTy :: TcType -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#isGuardedTy"><span class="hs-identifier hs-var hs-var">isGuardedTy</span></a></span></span><span> </span><span id="local-6989586621683102551"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102551"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1726"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102552"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102552"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ThetaType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; Maybe (TyCon, ThetaType)
TcType -&gt; Maybe (TyCon, ThetaType)
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102551"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102552"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1727"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102551"><span class="hs-identifier hs-var">ty</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1728"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1729"></span><span>
</span><span id="line-1730"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookArg1"><span class="hs-identifier hs-type">quickLookArg1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1731"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>  </span><span class="hs-comment">-- Deeply skolemised</span><span>
</span><span id="line-1732"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1733"></span><span class="hs-comment">-- quickLookArg1 implements the &quot;QL Argument&quot; judgement in Fig 5 of the paper</span><span>
</span><span id="line-1734"></span><span id="quickLookArg1"><span class="annot"><span class="annottext">quickLookArg1 :: AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; Scaled TcType
-&gt; TcM (HsExprArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#quickLookArg1"><span class="hs-identifier hs-var hs-var">quickLookArg1</span></a></span></span><span> </span><span id="local-6989586621683102556"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102556"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683102557"><span class="annot"><span class="annottext">larg :: LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102557"><span class="hs-identifier hs-var">larg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102558"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102558"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102559"><span class="annot"><span class="annottext">sc_arg_ty :: Scaled TcType
</span><a href="#local-6989586621683102559"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102560"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102560"><span class="hs-identifier hs-var">orig_arg_rho</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1735"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; TcM (HsExprArg 'TcpInst)
-&gt; TcM (HsExprArg 'TcpInst)
forall a. AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var">addArgCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102556"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102557"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExprArg 'TcpInst) -&gt; TcM (HsExprArg 'TcpInst))
-&gt; TcM (HsExprArg 'TcpInst) -&gt; TcM (HsExprArg 'TcpInst)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- Context needed for constraints</span><span>
</span><span id="line-1736"></span><span>                           </span><span class="hs-comment">-- generated by calls in arg</span><span>
</span><span id="line-1737"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683102561"><span class="annot"><a href="#local-6989586621683102561"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102562"><span class="annot"><a href="#local-6989586621683102562"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102563"><span class="annot"><a href="#local-6989586621683102563"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-var">splitHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102558"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1738"></span><span>
</span><span id="line-1739"></span><span>       </span><span class="hs-comment">-- Step 1: get the type of the head of the argument</span><span>
</span><span id="line-1740"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102564"><span class="annot"><a href="#local-6989586621683102564"><span class="hs-identifier hs-var">fun_ue</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102565"><span class="annot"><a href="#local-6989586621683102565"><span class="hs-identifier hs-var">mb_fun_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-type">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferAppHead_maybe"><span class="hs-identifier hs-type">tcInferAppHead_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102561"><span class="hs-identifier hs-type">rn_fun</span></a></span><span>
</span><span id="line-1741"></span><span>         </span><span class="hs-comment">-- tcCollectingUsage: the use of an Id at the head generates usage-info</span><span>
</span><span id="line-1742"></span><span>         </span><span class="hs-comment">-- See the call to `tcEmitBindingUsage` in `check_local_id`.  So we must</span><span>
</span><span id="line-1743"></span><span>         </span><span class="hs-comment">-- capture and save it in the `EValArgQL`.  See (QLA6) in</span><span>
</span><span id="line-1744"></span><span>         </span><span class="hs-comment">-- Note [Quick Look at value arguments]</span><span>
</span><span id="line-1745"></span><span>
</span><span id="line-1746"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;quickLookArg {&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1747"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;arg:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102558"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-1748"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;orig_arg_rho:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102560"><span class="hs-identifier hs-type">orig_arg_rho</span></a></span><span>
</span><span id="line-1749"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;head:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102561"><span class="hs-identifier hs-type">rn_fun</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102565"><span class="hs-identifier hs-type">mb_fun_ty</span></a></span><span>
</span><span id="line-1750"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;args:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102563"><span class="hs-identifier hs-type">rn_args</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1751"></span><span>
</span><span id="line-1752"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102565"><span class="hs-identifier hs-type">mb_fun_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1753"></span><span>           </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcType)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AppCtxt
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; Scaled TcType
-&gt; TcM (HsExprArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var">skipQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102556"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102557"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621683102559"><span class="hs-identifier hs-var">sc_arg_ty</span></a></span><span> </span><span class="hs-special">;</span><span>    </span><span class="hs-comment">-- fun is too complicated</span><span>
</span><span id="line-1754"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102568"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102568"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102569"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102569"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1755"></span><span>
</span><span id="line-1756"></span><span>       </span><span class="hs-comment">-- step 2: use |-inst to instantiate the head applied to the arguments</span><span>
</span><span id="line-1757"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102570"><span class="annot"><span class="annottext">tc_head :: (HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683102570"><span class="hs-identifier hs-var hs-var hs-var">tc_head</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102568"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102562"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1758"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102571"><span class="annot"><a href="#local-6989586621683102571"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; TcM QLFlag
</span><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var">wantQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683102561"><span class="hs-identifier hs-var">rn_fun</span></a></span><span>
</span><span id="line-1759"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683102572"><span class="annot"><a href="#local-6989586621683102572"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102573"><span class="annot"><a href="#local-6989586621683102573"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102574"><span class="annot"><a href="#local-6989586621683102574"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1760"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1761"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-type">tcInstFun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102571"><span class="hs-identifier hs-type">do_ql</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683102570"><span class="hs-identifier hs-type">tc_head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102569"><span class="hs-identifier hs-type">fun_sigma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102563"><span class="hs-identifier hs-type">rn_args</span></a></span><span>
</span><span id="line-1762"></span><span>                </span><span class="hs-comment">-- We must capture type-class and equality constraints here, but</span><span>
</span><span id="line-1763"></span><span>                </span><span class="hs-comment">-- not equality constraints.  See (QLA6) in Note [Quick Look at</span><span>
</span><span id="line-1764"></span><span>                </span><span class="hs-comment">-- value arguments]</span><span>
</span><span id="line-1765"></span><span>
</span><span id="line-1766"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;quickLookArg 2&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1767"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;arg:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102558"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-1768"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;orig_arg_rho:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102560"><span class="hs-identifier hs-type">orig_arg_rho</span></a></span><span>
</span><span id="line-1769"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;app_res_rho:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102573"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1770"></span><span>
</span><span id="line-1771"></span><span>       </span><span class="hs-comment">-- Step 3: Check the two other premises of APP-lightning-bolt (Fig 5 in the paper)</span><span>
</span><span id="line-1772"></span><span>       </span><span class="hs-comment">--         Namely: (A) is orig_arg_rho is guarded</span><span>
</span><span id="line-1773"></span><span>         </span><span class="hs-comment">--           or: (B) fiv(app_res_rho) = emptyset</span><span>
</span><span id="line-1774"></span><span>       </span><span class="hs-comment">-- This tells us if the quick look at the argument yields information that</span><span>
</span><span id="line-1775"></span><span>       </span><span class="hs-comment">-- influences the enclosing function call</span><span>
</span><span id="line-1776"></span><span>       </span><span class="hs-comment">-- NB: guardedness is computed based on the original,</span><span>
</span><span id="line-1777"></span><span>       </span><span class="hs-comment">-- unzonked orig_arg_rho, so that we deliberately do</span><span>
</span><span id="line-1778"></span><span>       </span><span class="hs-comment">-- not exploit guardedness that emerges a result of QL on earlier args</span><span>
</span><span id="line-1779"></span><span>       </span><span class="hs-comment">-- We must do the anyFreeKappa test /after/ tcInstFun; see (QLA3).</span><span>
</span><span id="line-1780"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102576"><span class="annot"><a href="#local-6989586621683102576"><span class="hs-identifier hs-var">arg_influences_enclosing_call</span></a></span></span><span>
</span><span id="line-1781"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#isGuardedTy"><span class="hs-identifier hs-type">isGuardedTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102560"><span class="hs-identifier hs-type">orig_arg_rho</span></a></span><span>
</span><span id="line-1782"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-1783"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#anyFreeKappa"><span class="hs-identifier hs-type">anyFreeKappa</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102573"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span>  </span><span class="hs-comment">-- (B)</span><span>
</span><span id="line-1784"></span><span>                    </span><span class="hs-comment">-- For (B) see Note [The fiv test in quickLookArg]</span><span>
</span><span id="line-1785"></span><span>
</span><span id="line-1786"></span><span>       </span><span class="hs-comment">-- Step 4: do quick-look unification if either (A) or (B) hold</span><span>
</span><span id="line-1787"></span><span>       </span><span class="hs-comment">-- NB: orig_arg_rho may not be zonked, but that's ok</span><span>
</span><span id="line-1788"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621683102576"><span class="hs-identifier hs-type">arg_influences_enclosing_call</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1789"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-type">qlUnify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102573"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102560"><span class="hs-identifier hs-type">orig_arg_rho</span></a></span><span>
</span><span id="line-1790"></span><span>
</span><span id="line-1791"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;quickLookArg done }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102561"><span class="hs-identifier hs-type">rn_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span>
</span><span id="line-1793"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArgQL"><span class="hs-identifier hs-type">EValArgQL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_ctxt"><span class="hs-identifier hs-var">eaql_ctxt</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102556"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1794"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_arg_ty"><span class="hs-identifier hs-var">eaql_arg_ty</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102559"><span class="hs-identifier hs-type">sc_arg_ty</span></a></span><span>
</span><span id="line-1795"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_larg"><span class="hs-identifier hs-var">eaql_larg</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102557"><span class="hs-identifier hs-type">larg</span></a></span><span>
</span><span id="line-1796"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_tc_fun"><span class="hs-identifier hs-var">eaql_tc_fun</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102570"><span class="hs-identifier hs-type">tc_head</span></a></span><span>
</span><span id="line-1797"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_fun_ue"><span class="hs-identifier hs-var">eaql_fun_ue</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102564"><span class="hs-identifier hs-type">fun_ue</span></a></span><span>
</span><span id="line-1798"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_args"><span class="hs-identifier hs-var">eaql_args</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102572"><span class="hs-identifier hs-type">inst_args</span></a></span><span>
</span><span id="line-1799"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_wanted"><span class="hs-identifier hs-var">eaql_wanted</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102574"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-1800"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_encl"><span class="hs-identifier hs-var">eaql_encl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102576"><span class="hs-identifier hs-type">arg_influences_enclosing_call</span></a></span><span>
</span><span id="line-1801"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#eaql_res_rho"><span class="hs-identifier hs-var">eaql_res_rho</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683102573"><span class="hs-identifier hs-type">app_res_rho</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1802"></span><span>
</span><span id="line-1803"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Folding over instantiation variables
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1808"></span><span>
</span><span id="line-1809"></span><span class="hs-comment">{- Note [Monomorphise instantiation variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we are done with Quick Look on a call, we must turn any un-unified
/instantiation/ variables into regular /unification/ variables.  This is the
lower-case 'theta' (a mono-substitution) in the APP-DOWN rule of Fig 5 of the
Quick Look paper.

We so this by look at the arguments, left to right, monomorphising the free
instantiation variables of the /type/ arguments of the call.  Those type
arguments appear (only) in
  * the `WpTyApp` components of
  * the `HsWrapper` of
  * a `EWrap` argument
See `qlMonoHsWrapper`.

By going left to right, we are sure to monomorphise instantiation variables
before we encounter them in an argument type (in `tcValArg`).

All instantiation variables for a call will be reachable from the type(s)
at which the function is instantiated -- i.e. those WpTyApps.  Even instantiation
variables allocoated by tcInstFun itself, such as in the IRESULT rule, end up
connected to the original type(s) at which the function is instantiated.

To monomorphise the free QL instantiation variables of a type, we use
`foldQLInstVars`.

Wrinkles:

(MIV1) When monomorphising an instantiation variable, don't forget to
   monomorphise its kind. It might have type (a :: TYPE k), where both
  `a` and `k` are instantiation variables.

(MIV2) In `qlUnify`, `make_kinds_ok` may unify
    a :: k1  ~  b :: k2
  making a cast
    a := b |&gt; (co :: k1 ~ k2)
  But now suppose k1 is an instantiation variable.  Then that coercion hole
  `co` is the only place that `k1` will show up in the traversal, and yet
  we want to monomrphise it.  Hence the do_hole in `foldQLInstTyVars`
-}</span><span>
</span><span id="line-1849"></span><span>
</span><span id="line-1850"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#qlMonoHsWrapper"><span class="hs-identifier hs-type">qlMonoHsWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1851"></span><span class="hs-comment">-- See Note [Monomorphise instantiation variables]</span><span>
</span><span id="line-1852"></span><span id="qlMonoHsWrapper"><span class="annot"><span class="annottext">qlMonoHsWrapper :: HsWrapper -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#qlMonoHsWrapper"><span class="hs-identifier hs-var hs-var">qlMonoHsWrapper</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpCompose"><span class="hs-identifier hs-type">WpCompose</span></a></span><span> </span><span id="local-6989586621683102580"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683102580"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621683102581"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683102581"><span class="hs-identifier hs-var">w2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#qlMonoHsWrapper"><span class="hs-identifier hs-var">qlMonoHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683102580"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; ZonkM () -&gt; ZonkM ()
forall a b. ZonkM a -&gt; ZonkM b -&gt; ZonkM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#qlMonoHsWrapper"><span class="hs-identifier hs-var">qlMonoHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683102581"><span class="hs-identifier hs-var">w2</span></a></span><span>
</span><span id="line-1853"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#qlMonoHsWrapper"><span class="hs-identifier hs-var">qlMonoHsWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpTyApp"><span class="hs-identifier hs-type">WpTyApp</span></a></span><span> </span><span id="local-6989586621683102583"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102583"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#qlMonoTcType"><span class="hs-identifier hs-var">qlMonoTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102583"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1854"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#qlMonoHsWrapper"><span class="hs-identifier hs-var">qlMonoHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ZonkM ()
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1855"></span><span>
</span><span id="line-1856"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#qlMonoTcType"><span class="hs-identifier hs-type">qlMonoTcType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1857"></span><span class="hs-comment">-- See Note [Monomorphise instantiation variables]</span><span>
</span><span id="line-1858"></span><span id="qlMonoTcType"><span class="annot"><span class="annottext">qlMonoTcType :: TcType -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#qlMonoTcType"><span class="hs-identifier hs-var hs-var">qlMonoTcType</span></a></span></span><span> </span><span id="local-6989586621683102585"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102585"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1859"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.Monad.html#traceZonk"><span class="hs-identifier hs-var">traceZonk</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;monomorphiseQLInstVars {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102585"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1860"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM ()
</span><a href="#local-6989586621683102587"><span class="hs-identifier hs-var">go_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102585"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1861"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.Monad.html#traceZonk"><span class="hs-identifier hs-var">traceZonk</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;monomorphiseQLInstVars }&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1862"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1863"></span><span>    </span><span class="annot"><a href="#local-6989586621683102587"><span class="hs-identifier hs-type">go_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1864"></span><span>    </span><span id="local-6989586621683102587"><span class="annot"><span class="annottext">go_ty :: TcType -&gt; ZonkM ()
</span><a href="#local-6989586621683102587"><span class="hs-identifier hs-var hs-var">go_ty</span></a></span></span><span> </span><span id="local-6989586621683102589"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102589"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcMUnit -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#unTcMUnit"><span class="hs-identifier hs-var">unTcMUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; TcMUnit) -&gt; TcType -&gt; TcMUnit
forall a. Monoid a =&gt; (Id -&gt; a) -&gt; TcType -&gt; a
</span><a href="GHC.Tc.Gen.App.html#foldQLInstVars"><span class="hs-identifier hs-var">foldQLInstVars</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcMUnit
</span><a href="#local-6989586621683102592"><span class="hs-identifier hs-var">go_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102589"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1865"></span><span>
</span><span id="line-1866"></span><span>    </span><span class="annot"><a href="#local-6989586621683102592"><span class="hs-identifier hs-type">go_tv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TcMUnit"><span class="hs-identifier hs-type">TcMUnit</span></a></span><span>
</span><span id="line-1867"></span><span>    </span><span class="hs-comment">-- Precondition: tv is a QL instantiation variable</span><span>
</span><span id="line-1868"></span><span>    </span><span class="hs-comment">-- If it is already unified, look through it and carry on</span><span>
</span><span id="line-1869"></span><span>    </span><span class="hs-comment">-- If not, monomorphise it, by making a fresh unification variable,</span><span>
</span><span id="line-1870"></span><span>    </span><span class="hs-comment">-- at the ambient level</span><span>
</span><span id="line-1871"></span><span>    </span><span id="local-6989586621683102592"><span class="annot"><span class="annottext">go_tv :: Id -&gt; TcMUnit
</span><a href="#local-6989586621683102592"><span class="hs-identifier hs-var hs-var">go_tv</span></a></span></span><span> </span><span id="local-6989586621683102594"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102594"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1872"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: TcTyVarDetails -&gt; IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102597"><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683102597"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_tclvl :: TcTyVarDetails -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102599"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683102599"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_info :: TcTyVarDetails -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102601"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683102601"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102594"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1873"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcMUnit -&gt; TcMUnit
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683102599"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#QLInstVar"><span class="hs-identifier hs-var">QLInstVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102594"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcMUnit -&gt; TcMUnit) -&gt; TcMUnit -&gt; TcMUnit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1874"></span><span>        </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcMUnit
</span><a href="GHC.Tc.Gen.App.html#TCMU"><span class="hs-identifier hs-var">TCMU</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcMUnit) -&gt; ZonkM () -&gt; TcMUnit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.Monad.html#traceZonk"><span class="hs-identifier hs-var">traceZonk</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qlMonoTcType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102594"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1875"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102604"><span class="annot"><a href="#local-6989586621683102604"><span class="hs-identifier hs-var">flex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails -&gt; ZonkM MetaDetails
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683102597"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1876"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102604"><span class="hs-identifier hs-type">flex</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1877"></span><span>                      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683102606"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102606"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM ()
</span><a href="#local-6989586621683102587"><span class="hs-identifier hs-var">go_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102606"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1878"></span><span>                      </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1879"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102607"><span class="annot"><span class="annottext">kind :: TcType
</span><a href="#local-6989586621683102607"><span class="hs-identifier hs-var hs-var hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102594"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1880"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM ()
</span><a href="#local-6989586621683102587"><span class="hs-identifier hs-var">go_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102607"><span class="hs-identifier hs-var">kind</span></a></span><span>  </span><span class="hs-comment">-- See (MIV1) in Note [Monomorphise instantiation variables]</span><span>
</span><span id="line-1881"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102608"><span class="annot"><a href="#local-6989586621683102608"><span class="hs-identifier hs-var">ref2</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaDetails -&gt; ZonkM (IORef MetaDetails)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>
</span><span id="line-1882"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102610"><span class="annot"><a href="#local-6989586621683102610"><span class="hs-identifier hs-var">lvl2</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#getZonkTcLevel"><span class="hs-identifier hs-type">getZonkTcLevel</span></a></span><span>
</span><span id="line-1883"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102612"><span class="annot"><a href="#local-6989586621683102612"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_info :: MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683102601"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1884"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683102608"><span class="hs-identifier hs-var">ref2</span></a></span><span>
</span><span id="line-1885"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_tclvl :: TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683102610"><span class="hs-identifier hs-var">lvl2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1886"></span><span>                        </span><span id="local-6989586621683102613"><span class="annot"><a href="#local-6989586621683102613"><span class="hs-identifier hs-var hs-var">tv2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; Id
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102594"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102607"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683102612"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-1887"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102597"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102613"><span class="hs-identifier hs-type">tv2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1888"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1889"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcMUnit
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qlMonoTcType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102594"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1890"></span><span>
</span><span id="line-1891"></span><span class="hs-keyword">newtype</span><span> </span><span id="TcMUnit"><span class="annot"><a href="GHC.Tc.Gen.App.html#TcMUnit"><span class="hs-identifier hs-var">TcMUnit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TCMU"><span class="annot"><a href="GHC.Tc.Gen.App.html#TCMU"><span class="hs-identifier hs-var">TCMU</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unTcMUnit"><span class="annot"><span class="annottext">TcMUnit -&gt; ZonkM ()
</span><a href="GHC.Tc.Gen.App.html#unTcMUnit"><span class="hs-identifier hs-var hs-var">unTcMUnit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1892"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683102620"><span id="local-6989586621683102624"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TcMUnit"><span class="hs-identifier hs-type">TcMUnit</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1893"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TCMU"><span class="hs-identifier hs-type">TCMU</span></a></span><span> </span><span id="local-6989586621683102630"><span class="annot"><span class="annottext">ZonkM ()
</span><a href="#local-6989586621683102630"><span class="hs-identifier hs-var">ml</span></a></span></span><span> </span><span id="local-6989586621683102631"><span class="annot"><span class="annottext">&lt;&gt; :: TcMUnit -&gt; TcMUnit -&gt; TcMUnit
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TCMU"><span class="hs-identifier hs-type">TCMU</span></a></span><span> </span><span id="local-6989586621683102632"><span class="annot"><span class="annottext">ZonkM ()
</span><a href="#local-6989586621683102632"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcMUnit
</span><a href="GHC.Tc.Gen.App.html#TCMU"><span class="hs-identifier hs-var">TCMU</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ZonkM ()
</span><a href="#local-6989586621683102630"><span class="hs-identifier hs-var">ml</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; ZonkM () -&gt; ZonkM ()
forall a b. ZonkM a -&gt; ZonkM b -&gt; ZonkM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ZonkM ()
</span><a href="#local-6989586621683102632"><span class="hs-identifier hs-var">mr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683102637"><span id="local-6989586621683102640"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TcMUnit"><span class="hs-identifier hs-type">TcMUnit</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1895"></span><span>  </span><span id="local-6989586621683102644"><span class="annot"><span class="annottext">mempty :: TcMUnit
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcMUnit
</span><a href="GHC.Tc.Gen.App.html#TCMU"><span class="hs-identifier hs-var">TCMU</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ZonkM ()
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span class="hs-comment">{- Note [The fiv test in quickLookArg]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In rule APP-lightning-bolt in Fig 5 of the paper, we have to test rho_r
for having no free instantiation variables.  We do this in Step 3 of quickLookArg1,
using anyFreeKappa.  Example:
    Suppose       ids :: [forall a. a-&gt;a]
    and consider  Just (ids++ids)
We will instantiate Just with kappa, say, and then call
    quickLookArg1 False {kappa} (ids ++ ids) kappa
The call to tcInstFun will return with app_res_rho = [forall a. a-&gt;a]
which has no free instantiation variables, so we can QL-unify
  kappa ~ [Forall a. a-&gt;a]
-}</span><span>
</span><span id="line-1910"></span><span>
</span><span id="line-1911"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#anyFreeKappa"><span class="hs-identifier hs-type">anyFreeKappa</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1912"></span><span class="hs-comment">-- True if there is a free instantiation variable</span><span>
</span><span id="line-1913"></span><span class="hs-comment">-- in the argument type, after zonking</span><span>
</span><span id="line-1914"></span><span class="hs-comment">-- See Note [The fiv test in quickLookArg]</span><span>
</span><span id="line-1915"></span><span id="anyFreeKappa"><span class="annot"><span class="annottext">anyFreeKappa :: TcType -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.App.html#anyFreeKappa"><span class="hs-identifier hs-var hs-var">anyFreeKappa</span></a></span></span><span> </span><span id="local-6989586621683102645"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102645"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcMBool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.App.html#unTcMBool"><span class="hs-identifier hs-var">unTcMBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; TcMBool) -&gt; TcType -&gt; TcMBool
forall a. Monoid a =&gt; (Id -&gt; a) -&gt; TcType -&gt; a
</span><a href="GHC.Tc.Gen.App.html#foldQLInstVars"><span class="hs-identifier hs-var">foldQLInstVars</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcMBool
</span><a href="#local-6989586621683102647"><span class="hs-identifier hs-var">go_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102645"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1916"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1917"></span><span>    </span><span id="local-6989586621683102647"><span class="annot"><span class="annottext">go_tv :: Id -&gt; TcMBool
</span><a href="#local-6989586621683102647"><span class="hs-identifier hs-var hs-var">go_tv</span></a></span></span><span> </span><span id="local-6989586621683102651"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102651"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcMBool
</span><a href="GHC.Tc.Gen.App.html#TCMB"><span class="hs-identifier hs-var">TCMB</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcMBool)
-&gt; TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcMBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102653"><span class="annot"><a href="#local-6989586621683102653"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaDetails
forall (m :: * -&gt; *). MonadIO m =&gt; Id -&gt; m MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102651"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1918"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102653"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1919"></span><span>                             </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683102654"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102654"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.App.html#anyFreeKappa"><span class="hs-identifier hs-var">anyFreeKappa</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102654"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1920"></span><span>                             </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1921"></span><span>
</span><span id="line-1922"></span><span class="hs-keyword">newtype</span><span> </span><span id="TcMBool"><span class="annot"><a href="GHC.Tc.Gen.App.html#TcMBool"><span class="hs-identifier hs-var">TcMBool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TCMB"><span class="annot"><a href="GHC.Tc.Gen.App.html#TCMB"><span class="hs-identifier hs-var">TCMB</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unTcMBool"><span class="annot"><span class="annottext">TcMBool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.App.html#unTcMBool"><span class="hs-identifier hs-var hs-var">unTcMBool</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1923"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683102657"><span id="local-6989586621683102661"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TcMBool"><span class="hs-identifier hs-type">TcMBool</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1924"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TCMB"><span class="hs-identifier hs-type">TCMB</span></a></span><span> </span><span id="local-6989586621683102667"><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="#local-6989586621683102667"><span class="hs-identifier hs-var">ml</span></a></span></span><span> </span><span id="local-6989586621683102668"><span class="annot"><span class="annottext">&lt;&gt; :: TcMBool -&gt; TcMBool -&gt; TcMBool
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TCMB"><span class="hs-identifier hs-type">TCMB</span></a></span><span> </span><span id="local-6989586621683102669"><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="#local-6989586621683102669"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcMBool
</span><a href="GHC.Tc.Gen.App.html#TCMB"><span class="hs-identifier hs-var">TCMB</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102670"><span class="annot"><a href="#local-6989586621683102670"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="#local-6989586621683102667"><span class="hs-identifier hs-var">ml</span></a></span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683102670"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621683102669"><span class="hs-identifier hs-type">mr</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1925"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683102675"><span id="local-6989586621683102678"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#TcMBool"><span class="hs-identifier hs-type">TcMBool</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1926"></span><span>  </span><span id="local-6989586621683102681"><span class="annot"><span class="annottext">mempty :: TcMBool
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcMBool
</span><a href="GHC.Tc.Gen.App.html#TCMB"><span class="hs-identifier hs-var">TCMB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1927"></span><span>
</span><span id="line-1928"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#foldQLInstVars"><span class="hs-identifier hs-type">foldQLInstVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683101406"><span class="annot"><a href="#local-6989586621683101406"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621683101406"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683101406"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683101406"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1929"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#foldQLInstVars"><span class="hs-pragma hs-type">foldQLInstVars</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1930"></span><span id="foldQLInstVars"><span class="annot"><span class="annottext">foldQLInstVars :: forall a. Monoid a =&gt; (Id -&gt; a) -&gt; TcType -&gt; a
</span><a href="GHC.Tc.Gen.App.html#foldQLInstVars"><span class="hs-identifier hs-var hs-var">foldQLInstVars</span></a></span></span><span> </span><span id="local-6989586621683102688"><span class="annot"><span class="annottext">Id -&gt; a
</span><a href="#local-6989586621683102688"><span class="hs-identifier hs-var">check_tv</span></a></span></span><span> </span><span id="local-6989586621683102689"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102689"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1931"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; a
</span><a href="#local-6989586621683102690"><span class="hs-identifier hs-var">do_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102689"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1932"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1933"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683102690"><span class="annot"><span class="annottext">TcType -&gt; a
</span><a href="#local-6989586621683102690"><span class="hs-identifier hs-var">do_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcCoercionN] -&gt; a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoFolder () a
-&gt; ()
-&gt; (TcType -&gt; a, ThetaType -&gt; a, TcCoercionN -&gt; a,
    [TcCoercionN] -&gt; a)
forall a env.
Monoid a =&gt;
TyCoFolder env a
-&gt; env
-&gt; (TcType -&gt; a, ThetaType -&gt; a, TcCoercionN -&gt; a,
    [TcCoercionN] -&gt; a)
</span><a href="GHC.Core.TyCo.Rep.html#foldTyCo"><span class="hs-identifier hs-var">foldTyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoFolder () a
</span><a href="#local-6989586621683102692"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1934"></span><span>
</span><span id="line-1935"></span><span>    </span><span class="annot"><a href="#local-6989586621683102692"><span class="hs-identifier hs-type">folder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoFolder"><span class="hs-identifier hs-type">TyCoFolder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683101406"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1936"></span><span>    </span><span id="local-6989586621683102692"><span class="annot"><span class="annottext">folder :: TyCoFolder () a
</span><a href="#local-6989586621683102692"><span class="hs-identifier hs-var hs-var">folder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoFolder"><span class="hs-identifier hs-type">TyCoFolder</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcf_view :: TcType -&gt; Maybe TcType
</span><a href="GHC.Core.TyCo.Rep.html#tcf_view"><span class="hs-identifier hs-var">tcf_view</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcType
</span><a href="GHC.Core.TyCo.Rep.html#noView"><span class="hs-identifier hs-var">noView</span></a></span><span>  </span><span class="hs-comment">-- See Note [Free vars and synonyms]</span><span>
</span><span id="line-1937"></span><span>                                             </span><span class="hs-comment">-- in GHC.Core.TyCo.FVs</span><span>
</span><span id="line-1938"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tyvar :: () -&gt; Id -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tyvar"><span class="hs-identifier hs-var">tcf_tyvar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Id -&gt; a
</span><a href="#local-6989586621683102697"><span class="hs-identifier hs-var">do_tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_covar :: () -&gt; Id -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#tcf_covar"><span class="hs-identifier hs-var">tcf_covar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Id -&gt; a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1939"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_hole :: () -&gt; CoercionHole -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#tcf_hole"><span class="hs-identifier hs-var">tcf_hole</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CoercionHole -&gt; a
</span><a href="#local-6989586621683102700"><span class="hs-identifier hs-var">do_hole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tycobinder :: () -&gt; Id -&gt; ForAllTyFlag -&gt; ()
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tycobinder"><span class="hs-identifier hs-var">tcf_tycobinder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Id -&gt; ForAllTyFlag -&gt; ()
forall {p} {p} {p}. p -&gt; p -&gt; p -&gt; ()
</span><a href="#local-6989586621683102702"><span class="hs-identifier hs-var">do_bndr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1940"></span><span>
</span><span id="line-1941"></span><span>    </span><span id="local-6989586621683102702"><span class="annot"><span class="annottext">do_bndr :: p -&gt; p -&gt; p -&gt; ()
</span><a href="#local-6989586621683102702"><span class="hs-identifier hs-var hs-var">do_bndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1942"></span><span>
</span><span id="line-1943"></span><span>    </span><span id="local-6989586621683102700"><span class="annot"><span class="annottext">do_hole :: () -&gt; CoercionHole -&gt; a
</span><a href="#local-6989586621683102700"><span class="hs-identifier hs-var hs-var">do_hole</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102703"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683102703"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; a
</span><a href="#local-6989586621683102690"><span class="hs-identifier hs-var">do_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TcType
</span><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier hs-var">coVarKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; Id
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683102703"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1944"></span><span>                     </span><span class="hs-comment">-- See (MIV2) in Note [Monomorphise instantiation variables]</span><span>
</span><span id="line-1945"></span><span>
</span><span id="line-1946"></span><span>    </span><span class="annot"><a href="#local-6989586621683102697"><span class="hs-identifier hs-type">do_tv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683101406"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1947"></span><span>    </span><span id="local-6989586621683102697"><span class="annot"><span class="annottext">do_tv :: () -&gt; Id -&gt; a
</span><a href="#local-6989586621683102697"><span class="hs-identifier hs-var hs-var">do_tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102706"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102706"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isQLInstTyVar"><span class="hs-identifier hs-var">isQLInstTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102706"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; a
</span><a href="#local-6989586621683102688"><span class="hs-identifier hs-var">check_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102706"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1948"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1949"></span><span>
</span><span id="line-1950"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 QuickLook unification
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1955"></span><span>
</span><span id="line-1956"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-type">qlUnify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1957"></span><span class="hs-comment">-- Unify ty1 with ty2:</span><span>
</span><span id="line-1958"></span><span class="hs-comment">--   * It can unify both instantiation variables (possibly with polytypes),</span><span>
</span><span id="line-1959"></span><span class="hs-comment">--     and ordinary unification variables (but only with monotypes)</span><span>
</span><span id="line-1960"></span><span class="hs-comment">--   * It does not return a coercion (unlike unifyType); it is called</span><span>
</span><span id="line-1961"></span><span class="hs-comment">--     for the sole purpose of unifying instantiation variables, although it</span><span>
</span><span id="line-1962"></span><span class="hs-comment">--     may also (opportunistically) unify regular unification variables.</span><span>
</span><span id="line-1963"></span><span class="hs-comment">--   * It never produces errors, even for mis-matched types</span><span>
</span><span id="line-1964"></span><span class="hs-comment">--   * It may return without having made the argument types equal, of course;</span><span>
</span><span id="line-1965"></span><span class="hs-comment">--     it just makes best efforts.</span><span>
</span><span id="line-1966"></span><span id="qlUnify"><span class="annot"><span class="annottext">qlUnify :: TcType -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-var hs-var">qlUnify</span></a></span></span><span> </span><span id="local-6989586621683102707"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102707"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683102708"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102708"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1967"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qlUnify&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102707"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102708"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1968"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102707"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102708"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1969"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1970"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1971"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1972"></span><span>    </span><span id="local-6989586621683102709"><span class="annot"><span class="annottext">go :: TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621683102711"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102711"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102712"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102712"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1973"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102711"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102714"><span class="hs-identifier hs-var">go_kappa</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102711"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102712"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1974"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683102715"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102715"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621683102716"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102716"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1975"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102716"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102714"><span class="hs-identifier hs-var">go_kappa</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102716"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102715"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1976"></span><span>
</span><span id="line-1977"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621683102718"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102718"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102719"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102719"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102718"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102719"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1978"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683102720"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102720"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621683102721"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102721"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102720"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102721"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1979"></span><span>
</span><span id="line-1980"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621683102723"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102723"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621683102724"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102724"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1981"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102723"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102724"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="hs-comment">-- See GHC.Tc.Utils.Unify</span><span>
</span><span id="line-1982"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Note [Expanding synonyms during unification]</span><span>
</span><span id="line-1983"></span><span>
</span><span id="line-1984"></span><span>    </span><span class="hs-comment">-- Now, and only now, expand synonyms</span><span>
</span><span id="line-1985"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683102725"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102725"><span class="hs-identifier hs-var">rho1</span></a></span></span><span> </span><span id="local-6989586621683102726"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102726"><span class="hs-identifier hs-var">rho2</span></a></span></span><span>
</span><span id="line-1986"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102727"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102727"><span class="hs-identifier hs-var">rho1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcType
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102725"><span class="hs-identifier hs-var">rho1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102727"><span class="hs-identifier hs-var">rho1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102726"><span class="hs-identifier hs-var">rho2</span></a></span><span>
</span><span id="line-1987"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683102729"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102729"><span class="hs-identifier hs-var">rho2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcType
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102726"><span class="hs-identifier hs-var">rho2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102725"><span class="hs-identifier hs-var">rho1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102729"><span class="hs-identifier hs-var">rho2</span></a></span><span>
</span><span id="line-1988"></span><span>
</span><span id="line-1989"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621683102730"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102730"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621683102731"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102731"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621683102732"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102732"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621683102733"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102733"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1990"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102730"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102732"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1991"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102730"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1992"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102731"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102733"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1993"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; TcType -&gt; TcRn ()) -&gt; ThetaType -&gt; ThetaType -&gt; TcRn ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102731"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102733"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1994"></span><span>
</span><span id="line-1995"></span><span>    </span><span class="hs-comment">-- Decompose (arg1 -&gt; res1) ~ (arg2 -&gt; res2)</span><span>
</span><span id="line-1996"></span><span>    </span><span class="hs-comment">-- and         (c1 =&gt; res1) ~   (c2 =&gt; res2)</span><span>
</span><span id="line-1997"></span><span>    </span><span class="hs-comment">-- But for the latter we only learn instantiation info from res1~res2</span><span>
</span><span id="line-1998"></span><span>    </span><span class="hs-comment">-- We look at the multiplicity too, although the chances of getting</span><span>
</span><span id="line-1999"></span><span>    </span><span class="hs-comment">-- impredicative instantiation info from there seems...remote.</span><span>
</span><span id="line-2000"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: TcType -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102739"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683102739"><span class="hs-identifier hs-var">af1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102741"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102741"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102743"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102743"><span class="hs-identifier hs-var">res1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102745"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102745"><span class="hs-identifier hs-var">mult1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2001"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: TcType -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102746"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683102746"><span class="hs-identifier hs-var">af2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102747"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102747"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102748"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102748"><span class="hs-identifier hs-var">res2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683102749"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102749"><span class="hs-identifier hs-var">mult2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2002"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683102739"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683102746"><span class="hs-identifier hs-var">af2</span></a></span><span> </span><span class="hs-comment">-- Match the arrow TyCon</span><span>
</span><span id="line-2003"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisibleFunArg"><span class="hs-identifier hs-var">isVisibleFunArg</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683102739"><span class="hs-identifier hs-var">af1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102741"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102747"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2004"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isFUNArg"><span class="hs-identifier hs-var">isFUNArg</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683102739"><span class="hs-identifier hs-var">af1</span></a></span><span class="hs-special">)</span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102745"><span class="hs-identifier hs-var">mult1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102749"><span class="hs-identifier hs-var">mult2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2005"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102743"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102748"><span class="hs-identifier hs-var">res2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2006"></span><span>
</span><span id="line-2007"></span><span>    </span><span class="hs-comment">-- ToDo: c.f. Tc.Utils.unify.uType,</span><span>
</span><span id="line-2008"></span><span>    </span><span class="hs-comment">-- which does not split FunTy here</span><span>
</span><span id="line-2009"></span><span>    </span><span class="hs-comment">-- Also NB tcSplitAppTyNoView here, which does not split (c =&gt; t)</span><span>
</span><span id="line-2010"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621683102753"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102753"><span class="hs-identifier hs-var">t1a</span></a></span></span><span> </span><span id="local-6989586621683102754"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102754"><span class="hs-identifier hs-var">t1b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102755"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102755"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2011"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102756"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102756"><span class="hs-identifier hs-var">t2a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102757"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102757"><span class="hs-identifier hs-var">t2b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, TcType)
</span><a href="GHC.Core.Type.html#tcSplitAppTyNoView_maybe"><span class="hs-identifier hs-var">tcSplitAppTyNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102755"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2012"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102753"><span class="hs-identifier hs-var">t1a</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102756"><span class="hs-identifier hs-var">t2a</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102754"><span class="hs-identifier hs-var">t1b</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102757"><span class="hs-identifier hs-var">t2b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2013"></span><span>
</span><span id="line-2014"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683102759"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102759"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621683102760"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102760"><span class="hs-identifier hs-var">t2a</span></a></span></span><span> </span><span id="local-6989586621683102761"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102761"><span class="hs-identifier hs-var">t2b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2015"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102762"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102762"><span class="hs-identifier hs-var">t1a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102763"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102763"><span class="hs-identifier hs-var">t1b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, TcType)
</span><a href="GHC.Core.Type.html#tcSplitAppTyNoView_maybe"><span class="hs-identifier hs-var">tcSplitAppTyNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102759"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2016"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102762"><span class="hs-identifier hs-var">t1a</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102760"><span class="hs-identifier hs-var">t2a</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102763"><span class="hs-identifier hs-var">t1b</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102761"><span class="hs-identifier hs-var">t2b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2017"></span><span>
</span><span id="line-2018"></span><span>    </span><span class="annot"><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2019"></span><span>       </span><span class="hs-comment">-- Don't look under foralls; see (UQL4) of Note [QuickLook unification]</span><span>
</span><span id="line-2020"></span><span>
</span><span id="line-2021"></span><span>    </span><span class="hs-comment">----------------</span><span>
</span><span id="line-2022"></span><span>    </span><span id="local-6989586621683102714"><span class="annot"><span class="annottext">go_kappa :: Id -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102714"><span class="hs-identifier hs-var hs-var">go_kappa</span></a></span></span><span> </span><span id="local-6989586621683102770"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102770"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span id="local-6989586621683102771"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102771"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2023"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn () -&gt; TcRn ()
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102770"><span class="hs-identifier hs-var">kappa</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102770"><span class="hs-identifier hs-var">kappa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2024"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102772"><span class="annot"><a href="#local-6989586621683102772"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaDetails
forall (m :: * -&gt; *). MonadIO m =&gt; Id -&gt; m MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102770"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-2025"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683102772"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2026"></span><span>               </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683102773"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102773"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102709"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102773"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102771"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2027"></span><span>               </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102774"><span class="annot"><a href="#local-6989586621683102774"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TcType -&gt; TcM TcType
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM TcType -&gt; TcM TcType) -&gt; ZonkM TcType -&gt; TcM TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM TcType
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102771"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2028"></span><span>                                  </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683102775"><span class="hs-identifier hs-type">go_flexi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102770"><span class="hs-identifier hs-type">kappa</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102774"><span class="hs-identifier hs-type">ty2</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2029"></span><span>
</span><span id="line-2030"></span><span>    </span><span class="hs-comment">----------------</span><span>
</span><span id="line-2031"></span><span>    </span><span class="hs-comment">-- Swap (kappa1[conc] ~ kappa2[tau])</span><span>
</span><span id="line-2032"></span><span>    </span><span class="hs-comment">-- otherwise we'll fail to unify and emit a coercion.</span><span>
</span><span id="line-2033"></span><span>    </span><span class="hs-comment">-- Just an optimisation: emitting a coercion is fine</span><span>
</span><span id="line-2034"></span><span>    </span><span id="local-6989586621683102775"><span class="annot"><span class="annottext">go_flexi :: Id -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102775"><span class="hs-identifier hs-var hs-var">go_flexi</span></a></span></span><span> </span><span id="local-6989586621683102778"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102778"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621683102779"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102779"><span class="hs-identifier hs-var">tv2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2035"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Tc.Utils.Unify.html#lhsPriority"><span class="hs-identifier hs-var">lhsPriority</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102779"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Tc.Utils.Unify.html#lhsPriority"><span class="hs-identifier hs-var">lhsPriority</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102778"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-2036"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102782"><span class="hs-identifier hs-var">go_flexi1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102779"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102778"><span class="hs-identifier hs-var">kappa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2037"></span><span>    </span><span class="annot"><a href="#local-6989586621683102775"><span class="hs-identifier hs-var">go_flexi</span></a></span><span> </span><span id="local-6989586621683102783"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102783"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span id="local-6989586621683102784"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102784"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2038"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102782"><span class="hs-identifier hs-var">go_flexi1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102783"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102784"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2039"></span><span>
</span><span id="line-2040"></span><span>    </span><span id="local-6989586621683102782"><span class="annot"><span class="annottext">go_flexi1 :: Id -&gt; TcType -&gt; TcRn ()
</span><a href="#local-6989586621683102782"><span class="hs-identifier hs-var hs-var">go_flexi1</span></a></span></span><span> </span><span id="local-6989586621683102795"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102795"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span id="local-6989586621683102796"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102796"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>  </span><span class="hs-comment">-- ty2 is zonked</span><span>
</span><span id="line-2041"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- See Note [QuickLook unification] (UQL1)</span><span>
</span><span id="line-2042"></span><span>        </span><span class="annot"><span class="annottext">UnifyCheckCaller -&gt; Id -&gt; TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.Unify.html#simpleUnifyCheck"><span class="hs-identifier hs-var">simpleUnifyCheck</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyCheckCaller
</span><a href="GHC.Tc.Utils.Unify.html#UC_QuickLook"><span class="hs-identifier hs-var">UC_QuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102795"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102796"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2043"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102799"><span class="annot"><a href="#local-6989586621683102799"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedThing -&gt; Maybe TypedThing
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#TypeThing"><span class="hs-identifier hs-var">TypeThing</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102796"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102801"><span class="hs-identifier hs-var">ty2_kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102802"><span class="hs-identifier hs-var">kappa_kind</span></a></span><span>
</span><span id="line-2044"></span><span>                   </span><span class="hs-comment">-- unifyKind: see (UQL2) in Note [QuickLook unification]</span><span>
</span><span id="line-2045"></span><span>                   </span><span class="hs-comment">--            and (MIV2) in Note [Monomorphise instantiation variables]</span><span>
</span><span id="line-2046"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102803"><span class="annot"><a href="#local-6989586621683102803"><span class="hs-identifier hs-var hs-var">ty2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcCoercionN -&gt; TcType
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102796"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621683102799"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2047"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;qlUnify:update&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2048"></span><span>             </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102795"><span class="hs-identifier hs-type">kappa</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102796"><span class="hs-identifier hs-type">ty2</span></a></span><span>
</span><span id="line-2049"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-type">writeMetaTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102795"><span class="hs-identifier hs-type">kappa</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102803"><span class="hs-identifier hs-type">ty2'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2050"></span><span>
</span><span id="line-2051"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2052"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Occurs-check or forall-bound variable</span><span>
</span><span id="line-2053"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2054"></span><span>        </span><span id="local-6989586621683102802"><span class="annot"><span class="annottext">kappa_kind :: TcType
</span><a href="#local-6989586621683102802"><span class="hs-identifier hs-var hs-var">kappa_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102795"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-2055"></span><span>        </span><span id="local-6989586621683102801"><span class="annot"><span class="annottext">ty2_kind :: TcType
</span><a href="#local-6989586621683102801"><span class="hs-identifier hs-var hs-var">ty2_kind</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102796"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2056"></span><span>
</span><span id="line-2057"></span><span class="hs-comment">{- Note [QuickLook unification]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In qlUnify, if we find (kappa ~ ty), we are going to update kappa := ty.
That is the entire point of qlUnify!   Wrinkles:

(UQL1) Before unifying an instantiation variable in `go_flexi`, we must check
  the usual unification conditions, by calling `GHC.Tc.Utils.Unify.simpleUnifyCheck`.
  For example that checks for
    * An occurs-check
    * Level mis-match
    * An attempt to unify a concrete type variable with a non-concrete type.

(UQL2) What if kappa and ty have different kinds?  We simply call the
  ordinary unifier and use the coercion to connect the two.

  If that coercion is not Refl, it is all in vain: The whole point of
  qlUnify is to impredicatively unify (kappa := forall a. blah). It is
  no good to unify (kappa := (forall a.blah) |&gt; co) because we can't
  use that casted polytype.

  BUT: unifyKind has emitted constraint(s) into the Tc monad, so we may as well
  use them.  (An alternative; use uType directly, if the result is not Refl,
  discard the constraints and the coercion, and do not update the instantiation
  variable.  But see &quot;Sadly discarded design alternative&quot; below.)

  See also (TCAPP2) in Note [tcApp: typechecking applications].

(UQL3) Instantiation variables don't really have a settled level yet;
  they have level QLInstVar (see Note [The QLInstVar TcLevel] in GHC.Tc.Utils.TcType.
  You might worry that we might unify
      alpha[1] := Maybe kappa[qlinst]
  and later this kappa turns out to be a level-2 variable, and we have committed
  a skolem-escape error.

  But happily this can't happen: QL instantiation variables have level infinity,
  and we never unify a variable with a type from a deeper level.

(UQL4) Should we look under foralls in qlUnify? The use-case would be
     (forall a.  beta[qlinst] -&gt; a)  ~  (forall a. (forall b. b-&gt;b) -&gt; a)
  where we might hope for
     beta := forall b. b

  But in fact we don't attempt this:

  * The normal on-the-fly unifier doesn't look under foralls, so why
    should qlUnify?

  * Looking under foralls means we'd have to track the bound variables on both
    sides.  Tiresome but not a show stopper.

  * We might call the *regular* unifier (via unifyKind) under foralls, and that
    doesn't know about those bound variables (it controls scope through level
    numbers) so it might go totally wrong.  At least we'd have to instantaite
    the forall-types with skolems (with level numbers).  Maybe more.

  It's just not worth the trouble, we think (for now at least).


Sadly discarded design alternative
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It is very tempting to use `unifyType` rather than `qlUnify`, killing off the
latter.  (Extending `unifyType` slightly to allow it to unify an instantiation
variable with a polytype is easy.).  But I could not see how to make it work:

 * `unifyType` makes the types /equal/, and returns a coercion, and it is hard to
   marry that up with DeepSubsumption.  Absent deep subsumption, this approach
   might just work.

 * I considered making a wrapper for `uType`, which simply discards any deferred
   equality constraints.  But we can't do that: in a heterogeneous equality we might
   have unified a unification variable (alpha := ty |&gt; co), where `co` is only bound
   by those constraints.
-}</span><span>
</span><span id="line-2130"></span><span>
</span><span id="line-2131"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 tagToEnum#
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2136"></span><span>
</span><span id="line-2137"></span><span class="hs-comment">{- Note [tagToEnum#]
~~~~~~~~~~~~~~~~~~~~
Nasty check to ensure that tagToEnum# is applied to a type that is an
enumeration TyCon.  It's crude, because it relies on our
knowing *now* that the type is ok, which in turn relies on the
eager-unification part of the type checker pushing enough information
here.  In theory the Right Thing to do is to have a new form of
constraint but I definitely cannot face that!  And it works ok as-is.

Here's are two cases that should fail
        f :: forall a. a
        f = tagToEnum# 0        -- Can't do tagToEnum# at a type variable

        g :: Int
        g = tagToEnum# 0        -- Int is not an enumeration

When data type families are involved it's a bit more complicated.
     data family F a
     data instance F [Int] = A | B | C
Then we want to generate something like
     tagToEnum# R:FListInt 3# |&gt; co :: R:FListInt ~ F [Int]
Usually that coercion is hidden inside the wrappers for
constructors of F [Int] but here we have to do it explicitly.

It's all grotesquely complicated.
-}</span><span>
</span><span id="line-2163"></span><span>
</span><span id="line-2164"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-type">isTagToEnum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2165"></span><span id="isTagToEnum"><span class="annot"><span class="annottext">isTagToEnum :: HsExpr GhcTc -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-var hs-var">isTagToEnum</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683102804"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102804"><span class="hs-identifier hs-var">fun_id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683102804"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.PrimOps.html#tagToEnumKey"><span class="hs-identifier hs-var">tagToEnumKey</span></a></span><span>
</span><span id="line-2166"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-var">isTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcTagToEnum"><span class="hs-identifier hs-type">tcTagToEnum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2169"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-2170"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2171"></span><span class="hs-comment">-- tagToEnum# :: forall a. Int# -&gt; a</span><span>
</span><span id="line-2172"></span><span class="hs-comment">-- See Note [tagToEnum#]   Urgh!</span><span>
</span><span id="line-2173"></span><span id="tcTagToEnum"><span class="annot"><span class="annottext">tcTagToEnum :: (HsExpr GhcTc, AppCtxt)
-&gt; [HsExprArg 'TcpTc] -&gt; TcType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcTagToEnum"><span class="hs-identifier hs-var hs-var">tcTagToEnum</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102806"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102806"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102807"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102807"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102808"><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683102808"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span id="local-6989586621683102809"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102809"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-2174"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683102810"><span class="annot"><span class="annottext">HsExprArg 'TcpTc
</span><a href="#local-6989586621683102810"><span class="hs-identifier hs-var">val_arg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsExprArg 'TcpTc -&gt; Bool)
-&gt; [HsExprArg 'TcpTc] -&gt; [HsExprArg 'TcpTc]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">dropWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (HsExprArg 'TcpTc -&gt; Bool) -&gt; HsExprArg 'TcpTc -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpTc -&gt; Bool
forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683102808"><span class="hs-identifier hs-var">tc_args</span></a></span><span>
</span><span id="line-2175"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683102812"><span class="annot"><a href="#local-6989586621683102812"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TcType -&gt; TcM TcType
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM TcType -&gt; TcM TcType) -&gt; ZonkM TcType -&gt; TcM TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM TcType
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102809"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-2176"></span><span>
</span><span id="line-2177"></span><span>       </span><span class="hs-comment">-- Check that the type is algebraic</span><span>
</span><span id="line-2178"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-type">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102812"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2179"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TyCon, ThetaType)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTagToEnumUnspecifiedResTy"><span class="hs-identifier hs-var">TcRnTagToEnumUnspecifiedResTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102812"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2180"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc)
</span><a href="#local-6989586621683102815"><span class="hs-identifier hs-var">vanilla_result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2181"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102816"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102816"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102817"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102817"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2182"></span><span>
</span><span id="line-2183"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Look through any type family</span><span>
</span><span id="line-2184"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683102818"><span class="annot"><a href="#local-6989586621683102818"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2185"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst_maybe"><span class="hs-identifier hs-type">tcLookupDataFamInst_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102818"><span class="hs-identifier hs-type">fam_envs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102816"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683102817"><span class="hs-identifier hs-type">tc_args</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2186"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TyCon, ThetaType, TcCoercionN)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TyCon -&gt; TcRn ()
</span><a href="#local-6989586621683102819"><span class="hs-identifier hs-var">check_enumeration</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102812"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102816"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2187"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc)
</span><a href="#local-6989586621683102815"><span class="hs-identifier hs-var">vanilla_result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2188"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102820"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102820"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102821"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102821"><span class="hs-identifier hs-var">rep_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102822"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621683102822"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2189"></span><span>
</span><span id="line-2190"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- coi :: tc tc_args ~R rep_tc rep_args</span><span>
</span><span id="line-2191"></span><span>         </span><span class="annot"><span class="annottext">TcType -&gt; TyCon -&gt; TcRn ()
</span><a href="#local-6989586621683102819"><span class="hs-identifier hs-var">check_enumeration</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102812"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102820"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2192"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102823"><span class="annot"><span class="annottext">rep_ty :: TcType
</span><a href="#local-6989586621683102823"><span class="hs-identifier hs-var hs-var">rep_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ThetaType -&gt; TcType
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102820"><span class="hs-identifier hs-var">rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621683102821"><span class="hs-identifier hs-var">rep_args</span></a></span><span>
</span><span id="line-2193"></span><span>             </span><span id="local-6989586621683102825"><span class="annot"><span class="annottext">tc_fun' :: HsExpr GhcTc
</span><a href="#local-6989586621683102825"><span class="hs-identifier hs-var hs-var">tc_fun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpTyApp"><span class="hs-identifier hs-var">WpTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102823"><span class="hs-identifier hs-var">rep_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102806"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-2194"></span><span>             </span><span id="local-6989586621683102826"><span class="annot"><span class="annottext">df_wrap :: HsWrapper
</span><a href="#local-6989586621683102826"><span class="hs-identifier hs-var hs-var">df_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621683102822"><span class="hs-identifier hs-var">coi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2195"></span><span>             </span><span id="local-6989586621683102829"><span class="annot"><span class="annottext">tc_expr :: HsExpr GhcTc
</span><a href="#local-6989586621683102829"><span class="hs-identifier hs-var hs-var">tc_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102825"><span class="hs-identifier hs-var">tc_fun'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102807"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HsExprArg 'TcpTc
</span><a href="#local-6989586621683102810"><span class="hs-identifier hs-var">val_arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2196"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683102826"><span class="hs-identifier hs-var">df_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102829"><span class="hs-identifier hs-var">tc_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-2197"></span><span>
</span><span id="line-2198"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2199"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (HsExpr GhcTc)
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTagToEnumMissingValArg"><span class="hs-identifier hs-var">TcRnTagToEnumMissingValArg</span></a></span><span>
</span><span id="line-2200"></span><span>
</span><span id="line-2201"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2202"></span><span>    </span><span id="local-6989586621683102815"><span class="annot"><span class="annottext">vanilla_result :: TcM (HsExpr GhcTc)
</span><a href="#local-6989586621683102815"><span class="hs-identifier hs-var hs-var">vanilla_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102806"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683102807"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683102808"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2203"></span><span>
</span><span id="line-2204"></span><span>    </span><span id="local-6989586621683102819"><span class="annot"><span class="annottext">check_enumeration :: TcType -&gt; TyCon -&gt; TcRn ()
</span><a href="#local-6989586621683102819"><span class="hs-identifier hs-var hs-var">check_enumeration</span></a></span></span><span> </span><span id="local-6989586621683102833"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102833"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621683102834"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102834"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-2205"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- isTypeDataTyCon: see wrinkle (W1) in</span><span>
</span><span id="line-2206"></span><span>        </span><span class="hs-comment">-- Note [Type data declarations] in GHC.Rename.Module</span><span>
</span><span id="line-2207"></span><span>        </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeDataTyCon"><span class="hs-identifier hs-var">isTypeDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102834"><span class="hs-identifier hs-var">tc</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTagToEnumResTyTypeData"><span class="hs-identifier hs-var">TcRnTagToEnumResTyTypeData</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102833"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2208"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683102834"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2209"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTagToEnumResTyNotAnEnum"><span class="hs-identifier hs-var">TcRnTagToEnumResTyNotAnEnum</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102833"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2210"></span><span>
</span><span id="line-2211"></span><span>
</span><span id="line-2212"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
           Horrible hack for rep-poly unlifted newtypes
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2217"></span><span>
</span><span id="line-2218"></span><span class="hs-comment">{- Note [Eta-expanding rep-poly unlifted newtypes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Any occurrence of a newtype constructor must appear at a known representation.
If the newtype is applied to an argument, then we are done: by (I2) in
Note [Representation polymorphism invariants], the argument has a known
representation, and we are done. So we are left with the situation of an
unapplied newtype constructor. For example:

  type N :: TYPE r -&gt; TYPE r
  newtype N a = MkN a

  ok :: N Int# -&gt; N Int#
  ok = MkN

  bad :: forall r (a :: TYPE r). N (# Int, r #) -&gt; N (# Int, r #)
  bad = MkN

The difficulty is that, unlike the situation described in
Note [Representation-polymorphism checking built-ins] in GHC.Tc.Utils.Concrete,
it is not necessarily the case that we simply need to check the instantiation
of a single variable. Consider for example:

  type RR :: Type -&gt; Type -&gt; RuntimeRep
  type family RR a b where ...

  type T :: forall a -&gt; forall b -&gt; TYPE (RR a b)
  type family T a b where ...

  type M :: forall a -&gt; forall b -&gt; TYPE (RR a b)
  newtype M a b = MkM (T a b)

Now, suppose we instantiate MkM, say with two types X, Y from the environment:

  foo :: T X Y -&gt; M X Y
  foo = MkM @X @Y

we need to check that we can eta-expand MkM, for which we need to know the
representation of its argument, which is &quot;RR X Y&quot;.

To do this, in &quot;rejectRepPolyNewtypes&quot;, we perform a syntactic representation-
polymorphism check on the instantiated argument of the newtype, and reject
the definition if the representation isn't concrete (in the sense of Note [Concrete types]
in GHC.Tc.Utils.Concrete).

For example, we would accept &quot;ok&quot; above, as &quot;IntRep&quot; is a concrete RuntimeRep.
However, we would reject &quot;foo&quot;, because &quot;RR X Y&quot; is not a concrete RuntimeRep.
If we wanted to accept &quot;foo&quot; (performing a PHASE 2 check (in the sense of
Note [The Concrete mechanism] in GHC.Tc.Utils.Concrete), we would have to
significantly re-engineer unlifted newtypes in GHC. Currently, &quot;MkM&quot; has type:

  MkM :: forall a b. T a b %1 -&gt; M a b

However, we should only be able to use MkM when we know the representation of
T a b (which is RR a b). This means that MkM should instead have type:

  MkM :: forall {must_be_conc} a b (co :: RR a b ~# must_be_conc)
      .  T a b |&gt; GRefl Nominal (TYPE co) %1 -&gt; M a b

where &quot;must_be_conc&quot; is a skolem type variable that must be instantiated to a
concrete type, just as in Note [Representation-polymorphism checking built-ins]
in GHC.Tc.Utils.Concrete. This means that any instantiation of &quot;MkM&quot;, such as
&quot;MkM @X @Y&quot; from &quot;foo&quot;, would create a fresh concrete metavariable &quot;gamma[conc]&quot;
and emit a Wanted constraint

  [W] co :: RR X Y ~# gamma[conc]

However, this all seems like a lot of work for a feature that no one is asking for,
so we decided to keep the much simpler syntactic check. Note that one possible
advantage of this approach is that we should be able to stop skipping
representation-polymorphism checks in the output of the desugarer; see (C) in
Wrinkle [Representation-polymorphic lambdas] in Note [Typechecking data constructors].
-}</span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span class="hs-comment">-- | Reject any unsaturated use of an unlifted newtype constructor</span><span>
</span><span id="line-2292"></span><span class="hs-comment">-- if the representation of its argument isn't known.</span><span>
</span><span id="line-2293"></span><span class="hs-comment">--</span><span>
</span><span id="line-2294"></span><span class="hs-comment">-- See Note [Eta-expanding rep-poly unlifted newtypes].</span><span>
</span><span id="line-2295"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#rejectRepPolyNewtypes"><span class="hs-identifier hs-type">rejectRepPolyNewtypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2296"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-2297"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2298"></span><span id="rejectRepPolyNewtypes"><span class="annot"><span class="annottext">rejectRepPolyNewtypes :: (HsExpr GhcTc, AppCtxt) -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.App.html#rejectRepPolyNewtypes"><span class="hs-identifier hs-var hs-var">rejectRepPolyNewtypes</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102839"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102839"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683102840"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102840"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683102839"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2299"></span><span>
</span><span id="line-2300"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ConLikeTc"><span class="hs-identifier hs-type">ConLikeTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621683102841"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683102841"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2301"></span><span>    </span><span class="hs-comment">-- Check that this is an unsaturated occurrence of a</span><span>
</span><span id="line-2302"></span><span>    </span><span class="hs-comment">-- representation-polymorphic newtype constructor.</span><span>
</span><span id="line-2303"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNewDataCon"><span class="hs-identifier hs-var">isNewDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683102841"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2304"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tcHasFixedRuntimeRep"><span class="hs-identifier hs-var">tcHasFixedRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Bool) -&gt; TyCon -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683102841"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2305"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683102843"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683102843"><span class="hs-identifier hs-var">_rem_arg_af</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102844"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102844"><span class="hs-identifier hs-var">_rem_arg_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102845"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102845"><span class="hs-identifier hs-var">rem_arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683102846"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102846"><span class="hs-identifier hs-var">_nt_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2306"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (FunTyFlag, TcType, TcType, TcType)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102840"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-2307"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683102848"><span class="annot"><span class="annottext">frr_ctxt :: FixedRuntimeRepContext
</span><a href="#local-6989586621683102848"><span class="hs-identifier hs-var hs-var">frr_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRRepPolyUnliftedNewtype"><span class="hs-identifier hs-var">FRRRepPolyUnliftedNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683102841"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2308"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; FixedRuntimeRepContext -&gt; TcType -&gt; TcRn ()
FixedRuntimeRepContext -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683102848"><span class="hs-identifier hs-var">frr_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683102845"><span class="hs-identifier hs-var">rem_arg_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2309"></span><span>
</span><span id="line-2310"></span><span>  </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2311"></span><span>
</span><span id="line-2312"></span><span>
</span><span id="line-2313"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Pragmas on expressions
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2318"></span><span>
</span><span id="line-2319"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-type">tcExprPrag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-2320"></span><span id="tcExprPrag"><span class="annot"><span class="annottext">tcExprPrag :: HsPragE (GhcPass 'Renamed) -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-var hs-var">tcExprPrag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragSCC"><span class="hs-identifier hs-type">HsPragSCC</span></a></span><span> </span><span id="local-6989586621683102851"><span class="annot"><span class="annottext">XSCC (GhcPass 'Renamed)
</span><a href="#local-6989586621683102851"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621683102852"><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621683102852"><span class="hs-identifier hs-var">ann</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XSCC GhcTc -&gt; StringLiteral -&gt; HsPragE GhcTc
forall p. XSCC p -&gt; StringLiteral -&gt; HsPragE p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPragSCC"><span class="hs-identifier hs-var">HsPragSCC</span></a></span><span> </span><span class="annot"><span class="annottext">XSCC (GhcPass 'Renamed)
XSCC GhcTc
</span><a href="#local-6989586621683102851"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621683102852"><span class="hs-identifier hs-var">ann</span></a></span><span>
</span><span id="line-2321"></span></pre></body></html>