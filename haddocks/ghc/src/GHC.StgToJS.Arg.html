<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase   #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Module      :  GHC.StgToJS.Args</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2001</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- License     :  BSD-style (see the file LICENSE)</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Maintainer  :  Jeffrey Young  &lt;jeffrey.young@iohk.io&gt;</span><span>
</span><span id="line-11"></span><span class="hs-comment">--                Luite Stegeman &lt;luite.stegeman@iohk.io&gt;</span><span>
</span><span id="line-12"></span><span class="hs-comment">--                Sylvain Henry  &lt;sylvain.henry@iohk.io&gt;</span><span>
</span><span id="line-13"></span><span class="hs-comment">--                Josh Meredith  &lt;josh.meredith@iohk.io&gt;</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">--  Code generation of application arguments</span><span>
</span><span id="line-17"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html"><span class="hs-identifier">GHC.StgToJS.Arg</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#genArg"><span class="hs-identifier">genArg</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#genIdArg"><span class="hs-identifier">genIdArg</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#genIdArgI"><span class="hs-identifier">genIdArgI</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#genIdStackArgI"><span class="hs-identifier">genIdStackArgI</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocConStatic"><span class="hs-identifier">allocConStatic</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocUnboxedConStatic"><span class="hs-identifier">allocUnboxedConStatic</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocateStaticList"><span class="hs-identifier">allocateStaticList</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#jsStaticArg"><span class="hs-identifier">jsStaticArg</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#jsStaticArgs"><span class="hs-identifier">jsStaticArgs</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html"><span class="hs-identifier">GHC.JS.JStg.Syntax</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html"><span class="hs-identifier">GHC.JS.Ident</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Make.html"><span class="hs-identifier">GHC.JS.Make</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.DataCon.html"><span class="hs-identifier">GHC.StgToJS.DataCon</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html"><span class="hs-identifier">GHC.StgToJS.Types</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Monad.html"><span class="hs-identifier">GHC.StgToJS.Monad</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Literal.html"><span class="hs-identifier">GHC.StgToJS.Literal</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Utils.html"><span class="hs-identifier">GHC.StgToJS.Utils</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Profiling.html"><span class="hs-identifier">GHC.StgToJS.Profiling</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html"><span class="hs-identifier">GHC.StgToJS.Ids</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html"><span class="hs-identifier">Control.Monad.Trans.State.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">{-
Note [ Unboxable Literals Optimization ]
~~~~~~~~~~~~~~~~~~

Boxable types in the JS backend are represented as heap objects. See Note
[StgToJS design] in GHC.StgToJS.hs for more details. Some types, such as Int8
do not benefit from not being wrapped in an object in the JS runtime. This optimization
detects such types and changes the code generator to generate a more efficient
representation. The change is minor and saves one level on indirection. Instead
of generating a wrapper object with a field for the value's payload, such as:

// a JS object for an Int8
var anInt8 = { d1 = &lt;Int8# payload&gt;
             , f  : info table / entry function which would scrutinize the payload
             }

we instead generate:

// notice, no wrapper object. This representation is essentially an Int8# in the JS backend
var anInt8 = &lt;Int8# payload&gt;

This optimization fires when the follow invariants hold:
  1. The value in question has a Type which has a single data constructor
  2. The data constructor holds a single field that is monomorphic
  3. The value in question is distinguishable from a THUNK using the JavaScript typeof operator.

From the haskell perspective this means that:
  1. An Int8# is always a JavaScript 'number', never a JavaScript object.
  2. An Int8 is either a JavaScript 'number' _or_ a JavaScript object depending on
     its use case and this optimization.

How is this sound?
~~~~~~~~~~~~~~~~~~

Normally this optimization would violate the guarantees of call-by-need, however
we are able to statically detect whether the type in question will be a THUNK or
not during code gen because the JS backend is consuming STG and we can check
during runtime with the typeof operator. Similarly we can check at runtime using
JavaScript's introspection operator `typeof`. Thus, when we know the value in
question will not be a THUNK we can safely elide the wrapping object, which
unboxes the value in the JS runtime. For example, an Int8 contains an Int8#
which has the JavaScript type 'number'. A THUNK of type Int8 would have a
JavaScript type 'object', so using 'typeof' allows us to check if we have
something that is definitely evaluated (i.e., a 'number') or something else. If
it is an 'object' then we may need to enter it to begin its evaluation. Consider
a type which has a 'ThreadId#' field; such as type would not be subject to this
optimization because it has to be represented as a JavaScript 'object' and thus
cannot be unboxed in this way. Another (edge) case is Int64#. Int64# is
similarly not unboxable in this way because Int64# does not fit in one
JavaScript variable and thus requires an 'object' for its representation in the
JavaScript runtime.

-}</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><span class="hs-comment">-- | Generate JS code for static arguments</span></span><span>
</span><span id="line-114"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-type">genStaticArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticArg"><span class="hs-identifier hs-type">StaticArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-115"></span><span id="genStaticArg"><span class="annot"><span class="annottext">genStaticArg :: HasDebugCallStack =&gt; StgArg -&gt; G [StaticArg]
</span><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-var hs-var">genStaticArg</span></a></span></span><span> </span><span id="local-6989586621682695152"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695152"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695152"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621682695154"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695154"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(StaticLit -&gt; StaticArg) -&gt; [StaticLit] -&gt; [StaticArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">StaticLit -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-var">StaticLitArg</span></a></span><span> </span><span class="annot"><span class="annottext">([StaticLit] -&gt; [StaticArg])
-&gt; StateT GenState IO [StaticLit] -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; StateT GenState IO [StaticLit]
</span><a href="GHC.StgToJS.Literal.html#genStaticLit"><span class="hs-identifier hs-var">genStaticLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695154"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621682695159"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695159"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621682695160"><span class="annot"><a href="#local-6989586621682695160"><span class="hs-identifier hs-var">unFloat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenState -&gt; UniqFM Id CgStgExpr)
-&gt; StateT GenState IO (UniqFM Id CgStgExpr)
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-var">State.gets</span></a></span><span> </span><span class="annot"><span class="annottext">GenState -&gt; UniqFM Id CgStgExpr
</span><a href="GHC.StgToJS.Types.html#gsUnfloated"><span class="hs-identifier hs-var">gsUnfloated</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-type">lookupUFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695160"><span class="hs-identifier hs-type">unFloat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695159"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">Maybe CgStgExpr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">G [StaticArg]
</span><a href="#local-6989586621682695164"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682695165"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695165"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CgStgExpr -&gt; G [StaticArg]
</span><a href="#local-6989586621682695166"><span class="hs-identifier hs-var">unfloated</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695165"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-122"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>       </span><span id="local-6989586621682695167"><span class="annot"><span class="annottext">r :: JSRep
</span><a href="#local-6989586621682695167"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PrimOrVoidRep -&gt; JSRep
PrimOrVoidRep -&gt; JSRep
</span><a href="GHC.StgToJS.Utils.html#primOrVoidRepToJSRep"><span class="hs-identifier hs-var">primOrVoidRepToJSRep</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimOrVoidRep -&gt; JSRep) -&gt; PrimOrVoidRep -&gt; JSRep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimOrVoidRep
</span><a href="GHC.Stg.Syntax.html#stgArgRep1"><span class="hs-identifier hs-var">stgArgRep1</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695152"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-124"></span><span>       </span><span id="local-6989586621682695164"><span class="annot"><span class="annottext">reg :: G [StaticArg]
</span><a href="#local-6989586621682695164"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span>
</span><span id="line-125"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JSRep -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isVoid"><span class="hs-identifier hs-var">isVoid</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
</span><a href="#local-6989586621682695167"><span class="hs-identifier hs-var">r</span></a></span><span>            </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>             </span><span class="annot"><span class="annottext">[StaticArg] -&gt; G [StaticArg]
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695159"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.html#trueDataConId"><span class="hs-identifier hs-var">trueDataConId</span></a></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>             </span><span class="annot"><span class="annottext">[StaticArg] -&gt; G [StaticArg]
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StaticLit -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-var">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; StaticLit
</span><a href="GHC.StgToJS.Types.html#BoolLit"><span class="hs-identifier hs-var">BoolLit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-129"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695159"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.html#falseDataConId"><span class="hs-identifier hs-var">falseDataConId</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>             </span><span class="annot"><span class="annottext">[StaticArg] -&gt; G [StaticArg]
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StaticLit -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-var">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; StaticLit
</span><a href="GHC.StgToJS.Types.html#BoolLit"><span class="hs-identifier hs-var">BoolLit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JSRep -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isMultiVar"><span class="hs-identifier hs-var">isMultiVar</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
</span><a href="#local-6989586621682695167"><span class="hs-identifier hs-var">r</span></a></span><span>        </span><span class="hs-glyph">=</span><span>
</span><span id="line-132"></span><span>             </span><span class="annot"><span class="annottext">(Ident -&gt; StaticArg) -&gt; [Ident] -&gt; [StaticArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682695176"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695176"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticObjArg"><span class="hs-identifier hs-var">StaticObjArg</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695176"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Ident] -&gt; [StaticArg])
-&gt; StateT GenState IO [Ident] -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ConTag -&gt; StateT GenState IO Ident)
-&gt; [ConTag] -&gt; StateT GenState IO [Ident]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; ConTag -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForIdN"><span class="hs-identifier hs-var">identForIdN</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695159"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">JSRep -&gt; ConTag
</span><a href="GHC.StgToJS.Utils.html#varSize"><span class="hs-identifier hs-var">varSize</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
</span><a href="#local-6989586621682695167"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- this seems wrong, not an obj?</span><span>
</span><span id="line-133"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682695181"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695181"><span class="hs-identifier hs-var">it</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticObjArg"><span class="hs-identifier hs-var">StaticObjArg</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695181"><span class="hs-identifier hs-var">it</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; [StaticArg]) -&gt; StateT GenState IO Ident -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForId"><span class="hs-identifier hs-var">identForId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695159"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>       </span><span class="annot"><a href="#local-6989586621682695166"><span class="hs-identifier hs-type">unfloated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticArg"><span class="hs-identifier hs-type">StaticArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-136"></span><span>       </span><span id="local-6989586621682695166"><span class="annot"><span class="annottext">unfloated :: CgStgExpr -&gt; G [StaticArg]
</span><a href="#local-6989586621682695166"><span class="hs-identifier hs-var hs-var">unfloated</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-type">StgLit</span></a></span><span> </span><span id="local-6989586621682695184"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695184"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StaticLit -&gt; StaticArg) -&gt; [StaticLit] -&gt; [StaticArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">StaticLit -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-var">StaticLitArg</span></a></span><span> </span><span class="annot"><span class="annottext">([StaticLit] -&gt; [StaticArg])
-&gt; StateT GenState IO [StaticLit] -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; StateT GenState IO [StaticLit]
</span><a href="GHC.StgToJS.Literal.html#genStaticLit"><span class="hs-identifier hs-var">genStaticLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695184"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-137"></span><span>       </span><span class="annot"><a href="#local-6989586621682695166"><span class="hs-identifier hs-var">unfloated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621682695186"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695186"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621682695187"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682695187"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span id="local-6989586621682695188"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695188"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[[PrimRep]]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isBoolDataCon"><span class="hs-identifier hs-var">isBoolDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695186"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isUnboxableCon"><span class="hs-identifier hs-var">isUnboxableCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695186"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticArg -&gt; [StaticArg] -&gt; [StaticArg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StaticArg -&gt; [StaticArg])
-&gt; ([[StaticArg]] -&gt; StaticArg) -&gt; [[StaticArg]] -&gt; [StaticArg]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [StaticArg] -&gt; StaticArg
</span><a href="GHC.StgToJS.Arg.html#allocUnboxedConStatic"><span class="hs-identifier hs-var">allocUnboxedConStatic</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695186"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">([StaticArg] -&gt; StaticArg)
-&gt; ([[StaticArg]] -&gt; [StaticArg]) -&gt; [[StaticArg]] -&gt; StaticArg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[StaticArg]] -&gt; [StaticArg]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[StaticArg]] -&gt; [StaticArg])
-&gt; StateT GenState IO [[StaticArg]] -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; G [StaticArg])
-&gt; [StgArg] -&gt; StateT GenState IO [[StaticArg]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [StaticArg]
StgArg -&gt; G [StaticArg]
</span><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-var">genStaticArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695188"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-comment">-- fixme what is allocunboxedcon?</span><span>
</span><span id="line-140"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695188"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682695195"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695195"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticObjArg"><span class="hs-identifier hs-var">StaticObjArg</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695195"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; [StaticArg]) -&gt; StateT GenState IO Ident -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForId"><span class="hs-identifier hs-var">identForId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695186"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>             </span><span id="local-6989586621682695197"><span class="annot"><a href="#local-6989586621682695197"><span class="hs-keyword hs-var">as</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[StaticArg]] -&gt; [StaticArg]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[StaticArg]] -&gt; [StaticArg])
-&gt; StateT GenState IO [[StaticArg]] -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; G [StaticArg])
-&gt; [StgArg] -&gt; StateT GenState IO [[StaticArg]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [StaticArg]
StgArg -&gt; G [StaticArg]
</span><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-var">genStaticArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695188"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-143"></span><span>             </span><span id="local-6989586621682695198"><span class="annot"><a href="#local-6989586621682695198"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html#identForDataConWorker"><span class="hs-identifier hs-type">identForDataConWorker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695186"><span class="hs-identifier hs-type">dc</span></a></span><span>
</span><span id="line-144"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticConArg"><span class="hs-identifier hs-type">StaticConArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695198"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695197"><span class="hs-keyword hs-type">as</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span>       </span><span class="annot"><a href="#local-6989586621682695166"><span class="hs-identifier hs-var">unfloated</span></a></span><span> </span><span id="local-6989586621682695201"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695201"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; G [StaticArg]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;genArg: unexpected unfloated expression&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgPprOpts -&gt; CgStgExpr -&gt; SDoc
forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; GenStgExpr pass -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">StgPprOpts
</span><a href="GHC.Stg.Syntax.html#panicStgPprOpts"><span class="hs-identifier hs-var">panicStgPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695201"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><span class="hs-comment">-- | Generate JS code for an StgArg</span></span><span>
</span><span id="line-148"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#genArg"><span class="hs-identifier hs-type">genArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgExpr"><span class="hs-identifier hs-type">JStgExpr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span id="genArg"><span class="annot"><span class="annottext">genArg :: HasDebugCallStack =&gt; StgArg -&gt; G [JStgExpr]
</span><a href="GHC.StgToJS.Arg.html#genArg"><span class="hs-identifier hs-var hs-var">genArg</span></a></span></span><span> </span><span id="local-6989586621682695224"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695224"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695224"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621682695225"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695225"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Literal -&gt; G [JStgExpr]
Literal -&gt; G [JStgExpr]
</span><a href="GHC.StgToJS.Literal.html#genLit"><span class="hs-identifier hs-var">genLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695225"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621682695227"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695227"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621682695228"><span class="annot"><a href="#local-6989586621682695228"><span class="hs-identifier hs-var">unFloat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenState -&gt; UniqFM Id CgStgExpr)
-&gt; StateT GenState IO (UniqFM Id CgStgExpr)
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-var">State.gets</span></a></span><span> </span><span class="annot"><span class="annottext">GenState -&gt; UniqFM Id CgStgExpr
</span><a href="GHC.StgToJS.Types.html#gsUnfloated"><span class="hs-identifier hs-var">gsUnfloated</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-type">lookupUFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695228"><span class="hs-identifier hs-type">unFloat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695227"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682695229"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695229"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CgStgExpr -&gt; G [JStgExpr]
CgStgExpr -&gt; G [JStgExpr]
</span><a href="#local-6989586621682695230"><span class="hs-identifier hs-var">unfloated</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695229"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><span class="annottext">Maybe CgStgExpr
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-156"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JSRep -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isVoid"><span class="hs-identifier hs-var">isVoid</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
HasDebugCallStack =&gt; JSRep
</span><a href="#local-6989586621682695231"><span class="hs-identifier hs-var">r</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; G [JStgExpr]
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695227"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.html#trueDataConId"><span class="hs-identifier hs-var">trueDataConId</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; G [JStgExpr]
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">JStgExpr
</span><a href="GHC.JS.Make.html#true_"><span class="hs-identifier hs-var">true_</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695227"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.html#falseDataConId"><span class="hs-identifier hs-var">falseDataConId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; G [JStgExpr]
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">JStgExpr
</span><a href="GHC.JS.Make.html#false_"><span class="hs-identifier hs-var">false_</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JSRep -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isMultiVar"><span class="hs-identifier hs-var">isMultiVar</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
HasDebugCallStack =&gt; JSRep
</span><a href="#local-6989586621682695231"><span class="hs-identifier hs-var">r</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ConTag -&gt; StateT GenState IO JStgExpr) -&gt; [ConTag] -&gt; G [JStgExpr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; ConTag -&gt; StateT GenState IO JStgExpr
</span><a href="GHC.StgToJS.Ids.html#varForIdN"><span class="hs-identifier hs-var">varForIdN</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695227"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">JSRep -&gt; ConTag
</span><a href="GHC.StgToJS.Utils.html#varSize"><span class="hs-identifier hs-var">varSize</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
HasDebugCallStack =&gt; JSRep
</span><a href="#local-6989586621682695231"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JStgExpr -&gt; [JStgExpr] -&gt; [JStgExpr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(JStgExpr -&gt; [JStgExpr])
-&gt; StateT GenState IO JStgExpr -&gt; G [JStgExpr]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO JStgExpr
</span><a href="GHC.StgToJS.Ids.html#varForId"><span class="hs-identifier hs-var">varForId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695227"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>     </span><span class="hs-comment">-- if our argument is a joinid, it can be an unboxed tuple</span><span>
</span><span id="line-164"></span><span>     </span><span class="annot"><a href="#local-6989586621682695231"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#JSRep"><span class="hs-identifier hs-type">JSRep</span></a></span><span>
</span><span id="line-165"></span><span>     </span><span id="local-6989586621682695231"><span class="annot"><span class="annottext">r :: HasDebugCallStack =&gt; JSRep
</span><a href="#local-6989586621682695231"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PrimOrVoidRep -&gt; JSRep
PrimOrVoidRep -&gt; JSRep
</span><a href="GHC.StgToJS.Utils.html#primOrVoidRepToJSRep"><span class="hs-identifier hs-var">primOrVoidRepToJSRep</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimOrVoidRep -&gt; JSRep) -&gt; PrimOrVoidRep -&gt; JSRep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimOrVoidRep
</span><a href="GHC.Stg.Syntax.html#stgArgRep1"><span class="hs-identifier hs-var">stgArgRep1</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695224"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>     </span><span class="annot"><a href="#local-6989586621682695230"><span class="hs-identifier hs-type">unfloated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgExpr"><span class="hs-identifier hs-type">JStgExpr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>     </span><span id="local-6989586621682695230"><span class="annot"><span class="annottext">unfloated :: HasDebugCallStack =&gt; CgStgExpr -&gt; G [JStgExpr]
</span><a href="#local-6989586621682695230"><span class="hs-identifier hs-var hs-var">unfloated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-type">StgLit</span></a></span><span> </span><span id="local-6989586621682695266"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695266"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Literal -&gt; G [JStgExpr]
Literal -&gt; G [JStgExpr]
</span><a href="GHC.StgToJS.Literal.html#genLit"><span class="hs-identifier hs-var">genLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682695266"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621682695267"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695267"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621682695268"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682695268"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span id="local-6989586621682695269"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695269"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[[PrimRep]]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-171"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isBoolDataCon"><span class="hs-identifier hs-var">isBoolDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695267"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isUnboxableCon"><span class="hs-identifier hs-var">isUnboxableCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695267"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-172"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JStgExpr -&gt; [JStgExpr] -&gt; [JStgExpr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(JStgExpr -&gt; [JStgExpr])
-&gt; ([[JStgExpr]] -&gt; JStgExpr) -&gt; [[JStgExpr]] -&gt; [JStgExpr]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [JStgExpr] -&gt; JStgExpr
</span><a href="GHC.StgToJS.DataCon.html#allocUnboxedCon"><span class="hs-identifier hs-var">allocUnboxedCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695267"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">([JStgExpr] -&gt; JStgExpr)
-&gt; ([[JStgExpr]] -&gt; [JStgExpr]) -&gt; [[JStgExpr]] -&gt; JStgExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[JStgExpr]] -&gt; [JStgExpr]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[JStgExpr]] -&gt; [JStgExpr])
-&gt; StateT GenState IO [[JStgExpr]] -&gt; G [JStgExpr]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; G [JStgExpr])
-&gt; [StgArg] -&gt; StateT GenState IO [[JStgExpr]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [JStgExpr]
StgArg -&gt; G [JStgExpr]
</span><a href="GHC.StgToJS.Arg.html#genArg"><span class="hs-identifier hs-var">genArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695269"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-173"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695269"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JStgExpr -&gt; [JStgExpr] -&gt; [JStgExpr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(JStgExpr -&gt; [JStgExpr])
-&gt; StateT GenState IO JStgExpr -&gt; G [JStgExpr]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO JStgExpr
</span><a href="GHC.StgToJS.Ids.html#varForId"><span class="hs-identifier hs-var">varForId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695267"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>           </span><span id="local-6989586621682695271"><span class="annot"><a href="#local-6989586621682695271"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[JStgExpr]] -&gt; [JStgExpr]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[JStgExpr]] -&gt; [JStgExpr])
-&gt; StateT GenState IO [[JStgExpr]] -&gt; G [JStgExpr]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; G [JStgExpr])
-&gt; [StgArg] -&gt; StateT GenState IO [[JStgExpr]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [JStgExpr]
StgArg -&gt; G [JStgExpr]
</span><a href="GHC.StgToJS.Arg.html#genArg"><span class="hs-identifier hs-var">genArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695269"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-176"></span><span>           </span><span id="local-6989586621682695272"><span class="annot"><a href="#local-6989586621682695272"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html#varForDataConWorker"><span class="hs-identifier hs-type">varForDataConWorker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695267"><span class="hs-identifier hs-type">dc</span></a></span><span>
</span><span id="line-177"></span><span>           </span><span id="local-6989586621682695274"><span class="annot"><a href="#local-6989586621682695274"><span class="hs-identifier hs-var">inl_alloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#csInlineAlloc"><span class="hs-identifier hs-var">csInlineAlloc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Monad.html#getSettings"><span class="hs-identifier hs-type">getSettings</span></a></span><span>
</span><span id="line-178"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.DataCon.html#allocDynamicE"><span class="hs-identifier hs-type">allocDynamicE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695274"><span class="hs-identifier hs-type">inl_alloc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695272"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695271"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>      </span><span id="local-6989586621682695278"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695278"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; G [JStgExpr]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;genArg: unexpected unfloated expression&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgPprOpts -&gt; CgStgExpr -&gt; SDoc
forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; GenStgExpr pass -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">StgPprOpts
</span><a href="GHC.Stg.Syntax.html#panicStgPprOpts"><span class="hs-identifier hs-var">panicStgPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682695278"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><span class="hs-comment">-- | Generate a Var as JStgExpr</span></span><span>
</span><span id="line-182"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#genIdArg"><span class="hs-identifier hs-type">genIdArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgExpr"><span class="hs-identifier hs-type">JStgExpr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span id="genIdArg"><span class="annot"><span class="annottext">genIdArg :: HasDebugCallStack =&gt; Id -&gt; G [JStgExpr]
</span><a href="GHC.StgToJS.Arg.html#genIdArg"><span class="hs-identifier hs-var hs-var">genIdArg</span></a></span></span><span> </span><span id="local-6989586621682695281"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695281"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [JStgExpr]
StgArg -&gt; G [JStgExpr]
</span><a href="GHC.StgToJS.Arg.html#genArg"><span class="hs-identifier hs-var">genArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695281"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><span class="hs-comment">-- | Generate an Id as an Ident</span></span><span>
</span><span id="line-186"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#genIdArgI"><span class="hs-identifier hs-type">genIdArgI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.JS.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span id="genIdArgI"><span class="annot"><span class="annottext">genIdArgI :: HasDebugCallStack =&gt; Id -&gt; StateT GenState IO [Ident]
</span><a href="GHC.StgToJS.Arg.html#genIdArgI"><span class="hs-identifier hs-var hs-var">genIdArgI</span></a></span></span><span> </span><span id="local-6989586621682695290"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695290"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JSRep -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isVoid"><span class="hs-identifier hs-var">isVoid</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
</span><a href="#local-6989586621682695291"><span class="hs-identifier hs-var">r</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ident] -&gt; StateT GenState IO [Ident]
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JSRep -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isMultiVar"><span class="hs-identifier hs-var">isMultiVar</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
</span><a href="#local-6989586621682695291"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConTag -&gt; StateT GenState IO Ident)
-&gt; [ConTag] -&gt; StateT GenState IO [Ident]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; ConTag -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForIdN"><span class="hs-identifier hs-var">identForIdN</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695290"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">JSRep -&gt; ConTag
</span><a href="GHC.StgToJS.Utils.html#varSize"><span class="hs-identifier hs-var">varSize</span></a></span><span> </span><span class="annot"><span class="annottext">JSRep
</span><a href="#local-6989586621682695291"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; [Ident] -&gt; [Ident]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; [Ident])
-&gt; StateT GenState IO Ident -&gt; StateT GenState IO [Ident]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForId"><span class="hs-identifier hs-var">identForId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695290"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621682695291"><span class="annot"><span class="annottext">r :: JSRep
</span><a href="#local-6989586621682695291"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnaryType -&gt; JSRep
UnaryType -&gt; JSRep
</span><a href="GHC.StgToJS.Utils.html#unaryTypeJSRep"><span class="hs-identifier hs-var">unaryTypeJSRep</span></a></span><span> </span><span class="annot"><span class="annottext">(UnaryType -&gt; JSRep) -&gt; (Id -&gt; UnaryType) -&gt; Id -&gt; JSRep
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; UnaryType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; JSRep) -&gt; Id -&gt; JSRep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695290"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="annot"><span class="hs-comment">-- | Generate IDs for stack arguments. See 'StgToJS.Expr.loadRetArgs' for use case</span></span><span>
</span><span id="line-195"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#genIdStackArgI"><span class="hs-identifier hs-type">genIdStackArgI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.JS.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.StgToJS.Types.html#StackSlot"><span class="hs-identifier hs-type">StackSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span id="genIdStackArgI"><span class="annot"><span class="annottext">genIdStackArgI :: HasDebugCallStack =&gt; Id -&gt; G [(Ident, StackSlot)]
</span><a href="GHC.StgToJS.Arg.html#genIdStackArgI"><span class="hs-identifier hs-var hs-var">genIdStackArgI</span></a></span></span><span> </span><span id="local-6989586621682695299"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695299"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConTag -&gt; Ident -&gt; (Ident, StackSlot))
-&gt; [ConTag] -&gt; [Ident] -&gt; [(Ident, StackSlot)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">ConTag -&gt; Ident -&gt; (Ident, StackSlot)
</span><a href="#local-6989586621682695301"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([Ident] -&gt; [(Ident, StackSlot)])
-&gt; StateT GenState IO [Ident] -&gt; G [(Ident, StackSlot)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; StateT GenState IO [Ident]
Id -&gt; StateT GenState IO [Ident]
</span><a href="GHC.StgToJS.Arg.html#genIdArgI"><span class="hs-identifier hs-var">genIdArgI</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695299"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="#local-6989586621682695301"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.JS.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.StgToJS.Types.html#StackSlot"><span class="hs-identifier hs-type">StackSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621682695301"><span class="annot"><span class="annottext">f :: ConTag -&gt; Ident -&gt; (Ident, StackSlot)
</span><a href="#local-6989586621682695301"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682695302"><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621682695302"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682695303"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682695303"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682695303"><span class="hs-identifier hs-var">ident</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; ConTag -&gt; StackSlot
</span><a href="GHC.StgToJS.Types.html#SlotId"><span class="hs-identifier hs-var">SlotId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695299"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621682695302"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><span class="hs-comment">-- | Allocate Static Constructors</span></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocConStatic"><span class="hs-identifier hs-type">allocConStatic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CostCentreStack"><span class="hs-identifier hs-type">CostCentreStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span id="allocConStatic"><span class="annot"><span class="annottext">allocConStatic :: HasDebugCallStack =&gt;
Ident -&gt; CostCentreStack -&gt; DataCon -&gt; [StgArg] -&gt; G ()
</span><a href="GHC.StgToJS.Arg.html#allocConStatic"><span class="hs-identifier hs-var hs-var">allocConStatic</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682695313"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695313"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682695314"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682695314"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682695315"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682695316"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695316"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621682695317"><span class="annot"><a href="#local-6989586621682695317"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; G [StaticArg])
-&gt; [StgArg] -&gt; StateT GenState IO [[StaticArg]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [StaticArg]
StgArg -&gt; G [StaticArg]
</span><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-var">genStaticArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695316"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621682695318"><span class="annot"><a href="#local-6989586621682695318"><span class="hs-identifier hs-var">cc'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Profiling.html#costCentreStackLbl"><span class="hs-identifier hs-type">costCentreStackLbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695314"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="#local-6989586621682695320"><span class="hs-identifier hs-type">allocConStatic'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695318"><span class="hs-identifier hs-type">cc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621682695317"><span class="hs-keyword hs-type">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- see Note [ Unboxable Literals Optimization ] for the purpose of these</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- checks</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="#local-6989586621682695320"><span class="hs-identifier hs-type">allocConStatic'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.JS.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticArg"><span class="hs-identifier hs-type">StaticArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621682695320"><span class="annot"><span class="annottext">allocConStatic' :: HasDebugCallStack =&gt; Maybe Ident -&gt; [StaticArg] -&gt; G ()
</span><a href="#local-6989586621682695320"><span class="hs-identifier hs-var hs-var">allocConStatic'</span></a></span></span><span> </span><span id="local-6989586621682695338"><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695338"><span class="hs-identifier hs-var">cc'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isBoolDataCon"><span class="hs-identifier hs-var">isBoolDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConTag
</span><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-var">dataConTag</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag -&gt; ConTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>           </span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695313"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-var">StaticUnboxed</span></a></span><span> </span><span class="annot"><span class="annottext">(StaticUnboxed -&gt; StaticVal) -&gt; StaticUnboxed -&gt; StaticVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; StaticUnboxed
</span><a href="GHC.StgToJS.Types.html#StaticUnboxedBool"><span class="hs-identifier hs-var">StaticUnboxedBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695338"><span class="hs-identifier hs-var">cc'</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isBoolDataCon"><span class="hs-identifier hs-var">isBoolDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConTag
</span><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-var">dataConTag</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag -&gt; ConTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-215"></span><span>           </span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695313"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-var">StaticUnboxed</span></a></span><span> </span><span class="annot"><span class="annottext">(StaticUnboxed -&gt; StaticVal) -&gt; StaticUnboxed -&gt; StaticVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; StaticUnboxed
</span><a href="GHC.StgToJS.Types.html#StaticUnboxedBool"><span class="hs-identifier hs-var">StaticUnboxedBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695338"><span class="hs-identifier hs-var">cc'</span></a></span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>           </span><span id="local-6989586621682695344"><span class="annot"><a href="#local-6989586621682695344"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; FastString)
-&gt; StateT GenState IO Ident -&gt; StateT GenState IO FastString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForDataConWorker"><span class="hs-identifier hs-var">identForDataConWorker</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-218"></span><span>           </span><span class="annot"><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-type">emitStatic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695313"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticData"><span class="hs-identifier hs-type">StaticData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695344"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682695338"><span class="hs-identifier hs-type">cc'</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><a href="#local-6989586621682695320"><span class="hs-identifier hs-var">allocConStatic'</span></a></span><span> </span><span id="local-6989586621682695346"><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695346"><span class="hs-identifier hs-var">cc'</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682695347"><span class="annot"><span class="annottext">StaticArg
</span><a href="#local-6989586621682695347"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-220"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isUnboxableCon"><span class="hs-identifier hs-var">isUnboxableCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StaticArg
</span><a href="#local-6989586621682695347"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-222"></span><span>          </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-type">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#IntLit"><span class="hs-identifier hs-type">IntLit</span></a></span><span> </span><span id="local-6989586621682695349"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682695349"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695313"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-var">StaticUnboxed</span></a></span><span> </span><span class="annot"><span class="annottext">(StaticUnboxed -&gt; StaticVal) -&gt; StaticUnboxed -&gt; StaticVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; StaticUnboxed
</span><a href="GHC.StgToJS.Types.html#StaticUnboxedInt"><span class="hs-identifier hs-var">StaticUnboxedInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682695349"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695346"><span class="hs-identifier hs-var">cc'</span></a></span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-type">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#BoolLit"><span class="hs-identifier hs-type">BoolLit</span></a></span><span> </span><span id="local-6989586621682695351"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682695351"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695313"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-var">StaticUnboxed</span></a></span><span> </span><span class="annot"><span class="annottext">(StaticUnboxed -&gt; StaticVal) -&gt; StaticUnboxed -&gt; StaticVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; StaticUnboxed
</span><a href="GHC.StgToJS.Types.html#StaticUnboxedBool"><span class="hs-identifier hs-var">StaticUnboxedBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682695351"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695346"><span class="hs-identifier hs-var">cc'</span></a></span><span>
</span><span id="line-226"></span><span>          </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-type">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#DoubleLit"><span class="hs-identifier hs-type">DoubleLit</span></a></span><span> </span><span id="local-6989586621682695353"><span class="annot"><span class="annottext">SaneDouble
</span><a href="#local-6989586621682695353"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-227"></span><span>            </span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695313"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-var">StaticUnboxed</span></a></span><span> </span><span class="annot"><span class="annottext">(StaticUnboxed -&gt; StaticVal) -&gt; StaticUnboxed -&gt; StaticVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SaneDouble -&gt; StaticUnboxed
</span><a href="GHC.StgToJS.Types.html#StaticUnboxedDouble"><span class="hs-identifier hs-var">StaticUnboxedDouble</span></a></span><span> </span><span class="annot"><span class="annottext">SaneDouble
</span><a href="#local-6989586621682695353"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695346"><span class="hs-identifier hs-var">cc'</span></a></span><span>
</span><span id="line-228"></span><span>          </span><span class="annot"><span class="annottext">StaticArg
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; G ()
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;allocConStatic: invalid unboxed literal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">StaticArg
</span><a href="#local-6989586621682695347"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="#local-6989586621682695320"><span class="hs-identifier hs-var">allocConStatic'</span></a></span><span> </span><span id="local-6989586621682695356"><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695356"><span class="hs-identifier hs-var">cc'</span></a></span></span><span> </span><span id="local-6989586621682695357"><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682695357"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#consDataCon"><span class="hs-identifier hs-var">consDataCon</span></a></span><span>
</span><span id="line-232"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695316"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-233"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682695359"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695359"><span class="hs-identifier hs-var">a0</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682695360"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695360"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[StgArg]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(StaticVal -&gt; Maybe Ident -&gt; G ())
-&gt; Maybe Ident -&gt; StaticVal -&gt; G ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; StaticVal -&gt; Maybe Ident -&gt; G ()
</span><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-var">emitStatic</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695313"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682695356"><span class="hs-identifier hs-var">cc'</span></a></span><span> </span><span class="annot"><span class="annottext">(StaticVal -&gt; G ()) -&gt; StateT GenState IO StaticVal -&gt; G ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; StgArg -&gt; StateT GenState IO StaticVal
</span><a href="GHC.StgToJS.Arg.html#allocateStaticList"><span class="hs-identifier hs-var">allocateStaticList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695359"><span class="hs-identifier hs-var">a0</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695360"><span class="hs-identifier hs-var">a1</span></a></span><span>
</span><span id="line-234"></span><span>                </span><span class="annot"><span class="annottext">[StgArg]
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; G ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;allocConStatic: invalid args for consDataCon&quot;</span></span><span>
</span><span id="line-235"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>                </span><span id="local-6989586621682695364"><span class="annot"><a href="#local-6989586621682695364"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; FastString
</span><a href="GHC.JS.Ident.html#identFS"><span class="hs-identifier hs-var">identFS</span></a></span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; FastString)
-&gt; StateT GenState IO Ident -&gt; StateT GenState IO FastString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; StateT GenState IO Ident
</span><a href="GHC.StgToJS.Ids.html#identForDataConWorker"><span class="hs-identifier hs-var">identForDataConWorker</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695315"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-237"></span><span>                </span><span class="annot"><a href="GHC.StgToJS.Monad.html#emitStatic"><span class="hs-identifier hs-type">emitStatic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695313"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticData"><span class="hs-identifier hs-type">StaticData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695364"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695357"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682695356"><span class="hs-identifier hs-type">cc'</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><span class="hs-comment">-- | Allocate unboxed constructors</span></span><span>
</span><span id="line-240"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocUnboxedConStatic"><span class="hs-identifier hs-type">allocUnboxedConStatic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticArg"><span class="hs-identifier hs-type">StaticArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticArg"><span class="hs-identifier hs-type">StaticArg</span></a></span><span>
</span><span id="line-241"></span><span id="allocUnboxedConStatic"><span class="annot"><span class="annottext">allocUnboxedConStatic :: DataCon -&gt; [StaticArg] -&gt; StaticArg
</span><a href="GHC.StgToJS.Arg.html#allocUnboxedConStatic"><span class="hs-identifier hs-var hs-var">allocUnboxedConStatic</span></a></span></span><span> </span><span id="local-6989586621682695365"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695365"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isBoolDataCon"><span class="hs-identifier hs-var">isBoolDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695365"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConTag
</span><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-var">dataConTag</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695365"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag -&gt; ConTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">1</span></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StaticLit -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-var">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; StaticLit
</span><a href="GHC.StgToJS.Types.html#BoolLit"><span class="hs-identifier hs-var">BoolLit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.StgToJS.Utils.html#isBoolDataCon"><span class="hs-identifier hs-var">isBoolDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695365"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConTag
</span><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-var">dataConTag</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695365"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag -&gt; ConTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-number">2</span></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StaticLit -&gt; StaticArg
</span><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-var">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; StaticLit
</span><a href="GHC.StgToJS.Types.html#BoolLit"><span class="hs-identifier hs-var">BoolLit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">[</span><span id="local-6989586621682695366"><span class="annot"><span class="annottext">a :: StaticArg
</span><a href="#local-6989586621682695366"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-type">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#IntLit"><span class="hs-identifier hs-type">IntLit</span></a></span><span> </span><span id="local-6989586621682695367"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682695367"><span class="hs-identifier hs-var">_i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StaticArg
</span><a href="#local-6989586621682695366"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">[</span><span id="local-6989586621682695368"><span class="annot"><span class="annottext">a :: StaticArg
</span><a href="#local-6989586621682695368"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-type">StaticLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#DoubleLit"><span class="hs-identifier hs-type">DoubleLit</span></a></span><span> </span><span id="local-6989586621682695369"><span class="annot"><span class="annottext">SaneDouble
</span><a href="#local-6989586621682695369"><span class="hs-identifier hs-var">_d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StaticArg
</span><a href="#local-6989586621682695368"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="annottext">[StaticArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; StaticArg
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;allocUnboxedConStatic: not an unboxed constructor&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695365"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="annot"><span class="hs-comment">-- | Allocate Static list</span></span><span>
</span><span id="line-253"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocateStaticList"><span class="hs-identifier hs-type">allocateStaticList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticVal"><span class="hs-identifier hs-type">StaticVal</span></a></span><span>
</span><span id="line-254"></span><span id="allocateStaticList"><span class="annot"><span class="annottext">allocateStaticList :: [StgArg] -&gt; StgArg -&gt; StateT GenState IO StaticVal
</span><a href="GHC.StgToJS.Arg.html#allocateStaticList"><span class="hs-identifier hs-var hs-var">allocateStaticList</span></a></span></span><span> </span><span id="local-6989586621682695370"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695370"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682695371"><span class="annot"><span class="annottext">a :: StgArg
</span><a href="#local-6989586621682695371"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621682695372"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695372"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConId_maybe"><span class="hs-identifier hs-var">isDataConId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682695372"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon -&gt; Maybe DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Maybe DataCon
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#nilDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Maybe StgArg -&gt; StateT GenState IO StaticVal
</span><a href="#local-6989586621682695375"><span class="hs-identifier hs-var">listAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695370"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StgArg
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>      </span><span id="local-6989586621682695376"><span class="annot"><a href="#local-6989586621682695376"><span class="hs-identifier hs-var">unFloat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenState -&gt; UniqFM Id CgStgExpr)
-&gt; StateT GenState IO (UniqFM Id CgStgExpr)
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Strict.html#gets"><span class="hs-identifier hs-var">State.gets</span></a></span><span> </span><span class="annot"><span class="annottext">GenState -&gt; UniqFM Id CgStgExpr
</span><a href="GHC.StgToJS.Types.html#gsUnfloated"><span class="hs-identifier hs-var">gsUnfloated</span></a></span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-type">lookupUFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695376"><span class="hs-identifier hs-type">unFloat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695372"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621682695377"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695377"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621682695378"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682695378"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682695379"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695379"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682695380"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695380"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[[PrimRep]]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682695377"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#consDataCon"><span class="hs-identifier hs-var">consDataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; StgArg -&gt; StateT GenState IO StaticVal
</span><a href="GHC.StgToJS.Arg.html#allocateStaticList"><span class="hs-identifier hs-var">allocateStaticList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695379"><span class="hs-identifier hs-var">h</span></a></span><span class="annot"><span class="annottext">StgArg -&gt; [StgArg] -&gt; [StgArg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695370"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695380"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">Maybe CgStgExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Maybe StgArg -&gt; StateT GenState IO StaticVal
</span><a href="#local-6989586621682695375"><span class="hs-identifier hs-var">listAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695370"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgArg -&gt; Maybe StgArg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695371"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="#local-6989586621682695375"><span class="hs-identifier hs-type">listAlloc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#G"><span class="hs-identifier hs-type">G</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticVal"><span class="hs-identifier hs-type">StaticVal</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621682695375"><span class="annot"><span class="annottext">listAlloc :: [StgArg] -&gt; Maybe StgArg -&gt; StateT GenState IO StaticVal
</span><a href="#local-6989586621682695375"><span class="hs-identifier hs-var hs-var">listAlloc</span></a></span></span><span> </span><span id="local-6989586621682695381"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695381"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe StgArg
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>      </span><span id="local-6989586621682695382"><span class="annot"><a href="#local-6989586621682695382"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[StaticArg]] -&gt; [StaticArg]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[StaticArg]] -&gt; [StaticArg])
-&gt; ([[StaticArg]] -&gt; [[StaticArg]]) -&gt; [[StaticArg]] -&gt; [StaticArg]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[StaticArg]] -&gt; [[StaticArg]]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([[StaticArg]] -&gt; [StaticArg])
-&gt; StateT GenState IO [[StaticArg]] -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; G [StaticArg])
-&gt; [StgArg] -&gt; StateT GenState IO [[StaticArg]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [StaticArg]
StgArg -&gt; G [StaticArg]
</span><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-var">genStaticArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695381"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticList"><span class="hs-identifier hs-type">StaticList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695382"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621682695375"><span class="hs-identifier hs-var">listAlloc</span></a></span><span> </span><span id="local-6989586621682695385"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695385"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682695386"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695386"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>      </span><span id="local-6989586621682695387"><span class="annot"><a href="#local-6989586621682695387"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[StaticArg]] -&gt; [StaticArg]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[StaticArg]] -&gt; [StaticArg])
-&gt; ([[StaticArg]] -&gt; [[StaticArg]]) -&gt; [[StaticArg]] -&gt; [StaticArg]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[StaticArg]] -&gt; [[StaticArg]]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([[StaticArg]] -&gt; [StaticArg])
-&gt; StateT GenState IO [[StaticArg]] -&gt; G [StaticArg]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; G [StaticArg])
-&gt; [StgArg] -&gt; StateT GenState IO [[StaticArg]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; StgArg -&gt; G [StaticArg]
StgArg -&gt; G [StaticArg]
</span><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-var">genStaticArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695385"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-269"></span><span>      </span><span id="local-6989586621682695388"><span class="annot"><a href="#local-6989586621682695388"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html#genStaticArg"><span class="hs-identifier hs-type">genStaticArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682695386"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-270"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682695388"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticObjArg"><span class="hs-identifier hs-type">StaticObjArg</span></a></span><span> </span><span id="local-6989586621682695389"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695389"><span class="hs-identifier hs-var">ri</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StaticVal -&gt; StateT GenState IO StaticVal
forall a. a -&gt; StateT GenState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StaticArg] -&gt; Maybe FastString -&gt; StaticVal
</span><a href="GHC.StgToJS.Types.html#StaticList"><span class="hs-identifier hs-var">StaticList</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682695387"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Maybe FastString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695389"><span class="hs-identifier hs-var">ri</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">[StaticArg]
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; StateT GenState IO StaticVal
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;allocateStaticList: invalid argument (tail)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([StgArg], StgArg) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682695385"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682695386"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#allocateStaticList"><span class="hs-identifier hs-var">allocateStaticList</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; StateT GenState IO StaticVal
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;allocateStaticList: unexpected literal in list&quot;</span></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><span class="hs-comment">-- | Generate JS code corresponding to a static arg</span></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#jsStaticArg"><span class="hs-identifier hs-type">jsStaticArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticArg"><span class="hs-identifier hs-type">StaticArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgExpr"><span class="hs-identifier hs-type">JStgExpr</span></a></span><span>
</span><span id="line-278"></span><span id="jsStaticArg"><span class="annot"><span class="annottext">jsStaticArg :: StaticArg -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArg"><span class="hs-identifier hs-var hs-var">jsStaticArg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticLitArg"><span class="hs-identifier hs-type">StaticLitArg</span></a></span><span> </span><span id="local-6989586621682695390"><span class="annot"><span class="annottext">StaticLit
</span><a href="#local-6989586621682695390"><span class="hs-identifier hs-var">l</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StaticLit -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="annot"><span class="annottext">StaticLit
</span><a href="#local-6989586621682695390"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticObjArg"><span class="hs-identifier hs-type">StaticObjArg</span></a></span><span> </span><span id="local-6989586621682695392"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695392"><span class="hs-identifier hs-var">t</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695392"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticConArg"><span class="hs-identifier hs-type">StaticConArg</span></a></span><span> </span><span id="local-6989586621682695394"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695394"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682695395"><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682695395"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; JStgExpr -&gt; [JStgExpr] -&gt; Maybe JStgExpr -&gt; JStgExpr
</span><a href="GHC.StgToJS.DataCon.html#allocDynamicE"><span class="hs-identifier hs-var">allocDynamicE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682695394"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(StaticArg -&gt; JStgExpr) -&gt; [StaticArg] -&gt; [JStgExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">StaticArg -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArg"><span class="hs-identifier hs-var">jsStaticArg</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682695395"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe JStgExpr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><span class="hs-comment">-- | Generate JS code corresponding to a list of static args</span></span><span>
</span><span id="line-285"></span><span class="annot"><a href="GHC.StgToJS.Arg.html#jsStaticArgs"><span class="hs-identifier hs-type">jsStaticArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticArg"><span class="hs-identifier hs-type">StaticArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgExpr"><span class="hs-identifier hs-type">JStgExpr</span></a></span><span>
</span><span id="line-286"></span><span id="jsStaticArgs"><span class="annot"><span class="annottext">jsStaticArgs :: [StaticArg] -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArgs"><span class="hs-identifier hs-var hs-var">jsStaticArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JVal -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#ValExpr"><span class="hs-identifier hs-var">ValExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(JVal -&gt; JStgExpr)
-&gt; ([StaticArg] -&gt; JVal) -&gt; [StaticArg] -&gt; JStgExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; JVal
</span><a href="GHC.JS.JStg.Syntax.html#JList"><span class="hs-identifier hs-var">JList</span></a></span><span> </span><span class="annot"><span class="annottext">([JStgExpr] -&gt; JVal)
-&gt; ([StaticArg] -&gt; [JStgExpr]) -&gt; [StaticArg] -&gt; JVal
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StaticArg -&gt; JStgExpr) -&gt; [StaticArg] -&gt; [JStgExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">StaticArg -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArg"><span class="hs-identifier hs-var">jsStaticArg</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span></pre></body></html>