<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="local-6989586621682451434"><span id="local-6989586621682451435"><span id="local-6989586621682451436"><span id="local-6989586621682451437"></span></span></span></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE UnboxedTuples #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE UnliftedFFITypes #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -O2 -funbox-strict-fields #-}</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- We always optimise this, otherwise performance of a non-optimised</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- compiler is severely affected</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- There are two principal string types used internally by GHC:</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- ['FastString']</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">--   * A compact, hash-consed, representation of character strings.</span><span>
</span><span id="line-17"></span><span class="hs-comment">--   * Generated by 'fsLit'.</span><span>
</span><span id="line-18"></span><span class="hs-comment">--   * You can get a 'GHC.Types.Unique.Unique' from them.</span><span>
</span><span id="line-19"></span><span class="hs-comment">--   * Equality test is O(1) (it uses the Unique).</span><span>
</span><span id="line-20"></span><span class="hs-comment">--   * Comparison is O(1) or O(n):</span><span>
</span><span id="line-21"></span><span class="hs-comment">--       * O(n) but deterministic with lexical comparison (`lexicalCompareFS`)</span><span>
</span><span id="line-22"></span><span class="hs-comment">--       * O(1) but non-deterministic with Unique comparison (`uniqCompareFS`)</span><span>
</span><span id="line-23"></span><span class="hs-comment">--   * Turn into 'GHC.Utils.Outputable.SDoc' with 'GHC.Utils.Outputable.ftext'.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- ['PtrString']</span><span>
</span><span id="line-26"></span><span class="hs-comment">--</span><span>
</span><span id="line-27"></span><span class="hs-comment">--   * Pointer and size of a Latin-1 encoded string.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--   * Practically no operations.</span><span>
</span><span id="line-29"></span><span class="hs-comment">--   * Outputting them is fast.</span><span>
</span><span id="line-30"></span><span class="hs-comment">--   * Generated by 'mkPtrString#'.</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   * Length of string literals (mkPtrString# &quot;abc&quot;#) is computed statically</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   * Turn into 'GHC.Utils.Outputable.SDoc' with 'GHC.Utils.Outputable.ptext'</span><span>
</span><span id="line-33"></span><span class="hs-comment">--   * Requires manual memory management.</span><span>
</span><span id="line-34"></span><span class="hs-comment">--     Improper use may lead to memory leaks or dangling pointers.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--   * It assumes Latin-1 as the encoding, therefore it cannot represent</span><span>
</span><span id="line-36"></span><span class="hs-comment">--     arbitrary Unicode strings.</span><span>
</span><span id="line-37"></span><span class="hs-comment">--</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- Use 'PtrString' unless you want the facilities of 'FastString'.</span><span>
</span><span id="line-39"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-40"></span><span>       </span><span class="hs-special">(</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><span class="hs-comment">-- * ByteString</span></span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier">bytesFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToByteString"><span class="hs-identifier">fastStringToByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteString"><span class="hs-identifier">mkFastStringByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fastZStringToByteString"><span class="hs-identifier">fastZStringToByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unsafeMkByteString"><span class="hs-identifier">unsafeMkByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><span class="hs-comment">-- * ShortByteString</span></span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToShortByteString"><span class="hs-identifier">fastStringToShortByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier">mkFastStringShortByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><span class="hs-comment">-- * ShortText</span></span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToShortText"><span class="hs-identifier">fastStringToShortText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><span class="hs-comment">-- * FastZString</span></span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier">FastZString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#hPutFZS"><span class="hs-identifier">hPutFZS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#zString"><span class="hs-identifier">zString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#zStringTakeN"><span class="hs-identifier">zStringTakeN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lengthFZS"><span class="hs-identifier">lengthFZS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><span class="hs-comment">-- * FastStrings</span></span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier">FastString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- not abstract, for now.</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier">NonDetFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier">LexicalFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Construction</span></span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier">fsLit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier">mkFastString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier">mkFastStringBytes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteList"><span class="hs-identifier">mkFastStringByteList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-identifier">mkFastString#</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Deconstruction</span></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier">unpackFS</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- :: FastString -&gt; String</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unconsFS"><span class="hs-identifier">unconsFS</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- :: FastString -&gt; Maybe (Char, FastString)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Encoding</span></span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#zEncodeFS"><span class="hs-identifier">zEncodeFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Operations</span></span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#uniqueOfFS"><span class="hs-identifier">uniqueOfFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier">lengthFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#nullFS"><span class="hs-identifier">nullFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier">appendFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier">concatFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#consFS"><span class="hs-identifier">consFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier">nilFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier">lexicalCompareFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier">uniqCompareFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Outputting</span></span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#hPutFS"><span class="hs-identifier">hPutFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Internal</span></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringTable"><span class="hs-identifier">getFastStringTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringZEncCounter"><span class="hs-identifier">getFastStringZEncCounter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><span class="hs-comment">-- * PtrStrings</span></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier">PtrString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Construction</span></span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-identifier">mkPtrString#</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Deconstruction</span></span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unpackPtrString"><span class="hs-identifier">unpackPtrString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unpackPtrStringTakeN"><span class="hs-identifier">unpackPtrStringTakeN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Operations</span></span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lengthPS"><span class="hs-identifier">lengthPS</span></a></span><span>
</span><span id="line-111"></span><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.Basic.html"><span class="hs-identifier">GHC.Prelude.Basic</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.html"><span class="hs-identifier">GHC.Utils.Encoding</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.IO.Unsafe.html"><span class="hs-identifier">GHC.Utils.IO.Unsafe</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html"><span class="hs-identifier">GHC.Data.FastMutInt</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Concurrent.MVar.html"><span class="hs-identifier">Control.Concurrent.MVar</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.html"><span class="hs-identifier">Data.ByteString.Short</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier">ShortByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Char8.html"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSC</span></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Unsafe.html"><span class="hs-identifier">Data.ByteString.Unsafe</span></a></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.html"><span class="hs-identifier">Data.ByteString.Short</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span class="hs-cpp">
#if !MIN_VERSION_bytestring(0,11,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Short.Internal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">SBS</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html"><span class="hs-identifier">GHC.Data.ShortText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#ShortText"><span class="hs-identifier">ShortText</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.C.html"><span class="hs-identifier">Foreign.C</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Data.html"><span class="hs-identifier">Data.Data</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Semi</span></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.html"><span class="hs-identifier">Foreign</span></a></span><span class="hs-cpp">

#if MIN_VERSION_GLASGOW_HASKELL(9,3,0,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.Conc.Sync.html"><span class="hs-identifier">GHC.Conc.Sync</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sharedCAF</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.IO.html"><span class="hs-identifier">GHC.IO</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">-- | Gives the Modified UTF-8 encoded bytes corresponding to a 'FastString'</span></span><span>
</span><span id="line-150"></span><span class="annot"><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-type">bytesFS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToByteString"><span class="hs-identifier hs-type">fastStringToByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-151"></span><span class="hs-pragma">{-# INLINE</span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-pragma hs-type">bytesFS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-152"></span><span id="bytesFS"><span class="annot"><span class="annottext">bytesFS :: FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-var hs-var">bytesFS</span></a></span></span><span> </span><span id="local-6989586621682451544"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451544"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#fromShort"><span class="hs-identifier hs-var">SBS.fromShort</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; ByteString) -&gt; ShortByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451544"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">fastStringToByteString</span><span> </span><span class="hs-pragma">&quot;Use `bytesFS` instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-155"></span><span id="fastStringToByteString"><span class="annot"><span class="annottext">fastStringToByteString :: FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#fastStringToByteString"><span class="hs-identifier hs-var hs-var">fastStringToByteString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-var">bytesFS</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToShortByteString"><span class="hs-identifier hs-type">fastStringToShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span>
</span><span id="line-158"></span><span id="fastStringToShortByteString"><span class="annot"><span class="annottext">fastStringToShortByteString :: FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fastStringToShortByteString"><span class="hs-identifier hs-var hs-var">fastStringToShortByteString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToShortText"><span class="hs-identifier hs-type">fastStringToShortText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#ShortText"><span class="hs-identifier hs-type">ShortText</span></a></span><span>
</span><span id="line-161"></span><span id="fastStringToShortText"><span class="annot"><span class="annottext">fastStringToShortText :: FastString -&gt; ShortText
</span><a href="GHC.Data.FastString.html#fastStringToShortText"><span class="hs-identifier hs-var hs-var">fastStringToShortText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ShortText
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#ShortText"><span class="hs-identifier hs-var">ShortText</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; ShortText)
-&gt; (FastString -&gt; ShortByteString) -&gt; FastString -&gt; ShortText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="GHC.Data.FastString.html#fastZStringToByteString"><span class="hs-identifier hs-type">fastZStringToByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-164"></span><span id="fastZStringToByteString"><span class="annot"><span class="annottext">fastZStringToByteString :: FastZString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#fastZStringToByteString"><span class="hs-identifier hs-var hs-var">fastZStringToByteString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621682451550"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451550"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451550"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- This will drop information if any character &gt; '\xFF'</span><span>
</span><span id="line-167"></span><span class="annot"><a href="GHC.Data.FastString.html#unsafeMkByteString"><span class="hs-identifier hs-type">unsafeMkByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-168"></span><span id="unsafeMkByteString"><span class="annot"><span class="annottext">unsafeMkByteString :: String -&gt; ByteString
</span><a href="GHC.Data.FastString.html#unsafeMkByteString"><span class="hs-identifier hs-var hs-var">unsafeMkByteString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Char8.html#pack"><span class="hs-identifier hs-var">BSC.pack</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.Data.FastString.html#hashFastString"><span class="hs-identifier hs-type">hashFastString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-171"></span><span id="hashFastString"><span class="annot"><span class="annottext">hashFastString :: FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashFastString"><span class="hs-identifier hs-var hs-var">hashFastString</span></a></span></span><span> </span><span id="local-6989586621682451553"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451553"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-var">hashStr</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Int) -&gt; ShortByteString -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451553"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-keyword">newtype</span><span> </span><span id="FastZString"><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-var">FastZString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastZString"><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-var">FastZString</span></a></span></span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621682451556"><span class="annot"><span class="annottext">FastZString -&gt; ()
(FastZString -&gt; ()) -&gt; NFData FastZString
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: FastZString -&gt; ()
rnf :: FastZString -&gt; ()
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="GHC.Data.FastString.html#hPutFZS"><span class="hs-identifier hs-type">hPutFZS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="hPutFZS"><span class="annot"><span class="annottext">hPutFZS :: Handle -&gt; FastZString -&gt; IO ()
</span><a href="GHC.Data.FastString.html#hPutFZS"><span class="hs-identifier hs-var hs-var">hPutFZS</span></a></span></span><span> </span><span id="local-6989586621682451563"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682451563"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621682451564"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451564"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#hPut"><span class="hs-identifier hs-var">BS.hPut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682451563"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451564"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="GHC.Data.FastString.html#zString"><span class="hs-identifier hs-type">zString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-182"></span><span id="zString"><span class="annot"><span class="annottext">zString :: FastZString -&gt; String
</span><a href="GHC.Data.FastString.html#zString"><span class="hs-identifier hs-var hs-var">zString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621682451566"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451566"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">IO String -&gt; String
forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; String) -&gt; IO String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (CStringLen -&gt; IO String) -&gt; IO String
forall a. ByteString -&gt; (CStringLen -&gt; IO a) -&gt; IO a
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Unsafe.html#unsafeUseAsCStringLen"><span class="hs-identifier hs-var">BS.unsafeUseAsCStringLen</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451566"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">CStringLen -&gt; IO String
</span><span class="hs-identifier hs-var">peekCAStringLen</span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | @zStringTakeN n = 'take' n . 'zString'@</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- but is performed in \(O(\min(n,l))\) rather than \(O(l)\),</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- where \(l\) is the length of the 'FastZString'.</span><span>
</span><span id="line-188"></span><span class="annot"><a href="GHC.Data.FastString.html#zStringTakeN"><span class="hs-identifier hs-type">zStringTakeN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-189"></span><span id="zStringTakeN"><span class="annot"><span class="annottext">zStringTakeN :: Int -&gt; FastZString -&gt; String
</span><a href="GHC.Data.FastString.html#zStringTakeN"><span class="hs-identifier hs-var hs-var">zStringTakeN</span></a></span></span><span> </span><span id="local-6989586621682451571"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682451571"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621682451572"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451572"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">IO String -&gt; String
forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; String) -&gt; IO String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (CStringLen -&gt; IO String) -&gt; IO String
forall a. ByteString -&gt; (CStringLen -&gt; IO a) -&gt; IO a
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Unsafe.html#unsafeUseAsCStringLen"><span class="hs-identifier hs-var">BS.unsafeUseAsCStringLen</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451572"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">((CStringLen -&gt; IO String) -&gt; IO String)
-&gt; (CStringLen -&gt; IO String) -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682451573"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621682451573"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451574"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682451574"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><span class="annottext">CStringLen -&gt; IO String
</span><span class="hs-identifier hs-var">peekCAStringLen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621682451573"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682451571"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682451574"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="GHC.Data.FastString.html#lengthFZS"><span class="hs-identifier hs-type">lengthFZS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-194"></span><span id="lengthFZS"><span class="annot"><span class="annottext">lengthFZS :: FastZString -&gt; Int
</span><a href="GHC.Data.FastString.html#lengthFZS"><span class="hs-identifier hs-var hs-var">lengthFZS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621682451576"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451576"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#length"><span class="hs-identifier hs-var">BS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682451576"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastZStringString"><span class="hs-identifier hs-type">mkFastZStringString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-197"></span><span id="mkFastZStringString"><span class="annot"><span class="annottext">mkFastZStringString :: String -&gt; FastZString
</span><a href="GHC.Data.FastString.html#mkFastZStringString"><span class="hs-identifier hs-var hs-var">mkFastZStringString</span></a></span></span><span> </span><span id="local-6989586621682451579"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682451579"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-var">FastZString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Char8.html#pack"><span class="hs-identifier hs-var">BSC.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682451579"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><span class="hs-comment">{-| A 'FastString' is a Modified UTF-8 encoded string together with a unique ID.
All 'FastString's are stored in a global hashtable to support fast O(1)
comparison.

It is also associated with a lazy reference to the Z-encoding
of this string which is used by the compiler internally.
-}</span></span><span>
</span><span id="line-208"></span><span class="hs-keyword">data</span><span> </span><span id="FastString"><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-var">FastString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastString"><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-var">FastString</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-209"></span><span>      </span><span id="uniq"><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var hs-var">uniq</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- unique id</span><span>
</span><span id="line-210"></span><span>      </span><span id="n_chars"><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#n_chars"><span class="hs-identifier hs-var hs-var">n_chars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- number of chars</span><span>
</span><span id="line-211"></span><span>      </span><span id="fs_sbs"><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var hs-var">fs_sbs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-212"></span><span>      </span><span id="fs_zenc"><span class="annot"><span class="annottext">FastString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#fs_zenc"><span class="hs-identifier hs-var hs-var">fs_zenc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-213"></span><span>      </span><span class="hs-comment">-- ^ Lazily computed Z-encoding of this string. See Note [Z-Encoding] in</span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-comment">-- GHC.Utils.Encoding.</span><span>
</span><span id="line-215"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-comment">-- Since 'FastString's are globally memoized this is computed at most</span><span>
</span><span id="line-217"></span><span>      </span><span class="hs-comment">-- once for any given string.</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682451585"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621682451590"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451590"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621682451591"><span class="annot"><span class="annottext">== :: FastString -&gt; FastString -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621682451592"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451592"><span class="hs-identifier hs-var">f2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451590"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451592"><span class="hs-identifier hs-var">f2</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- We don't provide any &quot;Ord FastString&quot; instance to force you to think about</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- which ordering you want:</span><span>
</span><span id="line-225"></span><span class="hs-comment">--    * lexical:   deterministic,     O(n). Cf lexicalCompareFS and LexicalFastString.</span><span>
</span><span id="line-226"></span><span class="hs-comment">--    * by unique: non-deterministic, O(1). Cf uniqCompareFS    and NonDetFastString.</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621682451596"><span class="annot"><span class="annottext">fromString :: String -&gt; FastString
</span><span class="hs-identifier hs-var hs-var hs-var">fromString</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682451599"><span id="local-6989586621682451603"><span class="annot"><span class="hs-identifier hs-type">Semi.Semigroup</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621682451608"><span class="annot"><span class="annottext">&lt;&gt; :: FastString -&gt; FastString -&gt; FastString
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier hs-var">appendFS</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621682451616"><span class="annot"><span class="annottext">mempty :: FastString
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier hs-var">nilFS</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621682451618"><span class="annot"><span class="annottext">mappend :: FastString -&gt; FastString -&gt; FastString
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(Semi.&lt;&gt;)</span></span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621682451619"><span class="annot"><span class="annottext">mconcat :: [FastString] -&gt; FastString
</span><span class="hs-identifier hs-var hs-var hs-var">mconcat</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; FastString
</span><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier hs-var">concatFS</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682451621"><span id="local-6989586621682451626"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-240"></span><span>   </span><span id="local-6989586621682451633"><span class="annot"><span class="annottext">show :: FastString -&gt; String
</span><a href="#local-6989586621682451633"><span class="hs-identifier hs-var hs-var hs-var">show</span></a></span></span><span> </span><span id="local-6989586621682451635"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451635"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShowS
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451635"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682451639"><span id="local-6989586621682451646"><span id="local-6989586621682451651"><span id="local-6989586621682451656"><span id="local-6989586621682451659"><span id="local-6989586621682451662"><span id="local-6989586621682451665"><span id="local-6989586621682451668"><span id="local-6989586621682451671"><span id="local-6989586621682451676"><span id="local-6989586621682451681"><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-comment">-- don't traverse?</span><span>
</span><span id="line-244"></span><span>  </span><span id="local-6989586621682451686"><span class="annot"><span class="annottext">toConstr :: FastString -&gt; Constr
</span><a href="#local-6989586621682451686"><span class="hs-identifier hs-var hs-var hs-var">toConstr</span></a></span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Constr
</span><a href="GHC.Utils.Misc.html#abstractConstr"><span class="hs-identifier hs-var">abstractConstr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FastString&quot;</span></span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621682451691"><span class="annot"><span class="annottext">gunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c FastString
</span><a href="#local-6989586621682451691"><span class="hs-identifier hs-var hs-var hs-var">gunfold</span></a></span></span><span> </span><span class="annot"><span class="annottext">forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">forall r. r -&gt; c r
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Constr -&gt; c FastString
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;gunfold&quot;</span></span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621682451694"><span class="annot"><span class="annottext">dataTypeOf :: FastString -&gt; DataType
</span><a href="#local-6989586621682451694"><span class="hs-identifier hs-var hs-var hs-var">dataTypeOf</span></a></span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DataType
</span><span class="hs-identifier hs-var">mkNoRepType</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FastString&quot;</span></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621682451699"><span class="annot"><span class="annottext">rnf :: FastString -&gt; ()
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span id="local-6989586621682451700"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451700"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451700"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-comment">-- | Compare FastString lexically</span><span>
</span><span id="line-252"></span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- If you don't care about the lexical ordering, use `uniqCompareFS` instead.</span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier hs-type">lexicalCompareFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-255"></span><span id="lexicalCompareFS"><span class="annot"><span class="annottext">lexicalCompareFS :: FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier hs-var hs-var">lexicalCompareFS</span></a></span></span><span> </span><span id="local-6989586621682451701"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451701"><span class="hs-identifier hs-var">fs1</span></a></span></span><span> </span><span id="local-6989586621682451702"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451702"><span class="hs-identifier hs-var">fs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451701"><span class="hs-identifier hs-var">fs1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451702"><span class="hs-identifier hs-var">fs2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="annottext">ShortByteString -&gt; ShortByteString -&gt; Ordering
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.UTF8.html#utf8CompareShortByteString"><span class="hs-identifier hs-var">utf8CompareShortByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451701"><span class="hs-identifier hs-var">fs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451702"><span class="hs-identifier hs-var">fs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-comment">-- perform a lexical comparison taking into account the Modified UTF-8</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-comment">-- encoding we use (cf #18562)</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">-- | Compare FastString by their Unique (not lexically).</span><span>
</span><span id="line-262"></span><span class="hs-comment">--</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- Much cheaper than `lexicalCompareFS` but non-deterministic!</span><span>
</span><span id="line-264"></span><span class="annot"><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier hs-type">uniqCompareFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-265"></span><span id="uniqCompareFS"><span class="annot"><span class="annottext">uniqCompareFS :: FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier hs-var hs-var">uniqCompareFS</span></a></span></span><span> </span><span id="local-6989586621682451704"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451704"><span class="hs-identifier hs-var">fs1</span></a></span></span><span> </span><span id="local-6989586621682451705"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451705"><span class="hs-identifier hs-var">fs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451704"><span class="hs-identifier hs-var">fs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451705"><span class="hs-identifier hs-var">fs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- | Non-deterministic FastString</span><span>
</span><span id="line-268"></span><span class="hs-comment">--</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- This is a simple FastString wrapper with an Ord instance using</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- `uniqCompareFS` (i.e. which compares FastStrings on their Uniques). Hence it</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- is not deterministic from one run to the other.</span><span>
</span><span id="line-272"></span><span class="hs-keyword">newtype</span><span> </span><span id="NonDetFastString"><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-var">NonDetFastString</span></a></span></span><span>
</span><span id="line-273"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="NonDetFastString"><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-var">NonDetFastString</span></a></span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-274"></span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682451709"><span id="local-6989586621682451713"><span class="annot"><span class="annottext">NonDetFastString -&gt; NonDetFastString -&gt; Bool
(NonDetFastString -&gt; NonDetFastString -&gt; Bool)
-&gt; (NonDetFastString -&gt; NonDetFastString -&gt; Bool)
-&gt; Eq NonDetFastString
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
== :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
$c/= :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
/= :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451719"><span id="local-6989586621682451723"><span id="local-6989586621682451727"><span class="annot"><span class="annottext">Int -&gt; NonDetFastString -&gt; ShowS
[NonDetFastString] -&gt; ShowS
NonDetFastString -&gt; String
(Int -&gt; NonDetFastString -&gt; ShowS)
-&gt; (NonDetFastString -&gt; String)
-&gt; ([NonDetFastString] -&gt; ShowS)
-&gt; Show NonDetFastString
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; NonDetFastString -&gt; ShowS
showsPrec :: Int -&gt; NonDetFastString -&gt; ShowS
$cshow :: NonDetFastString -&gt; String
show :: NonDetFastString -&gt; String
$cshowList :: [NonDetFastString] -&gt; ShowS
showList :: [NonDetFastString] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span id="local-6989586621682451736"><span id="local-6989586621682451739"><span id="local-6989586621682451742"><span id="local-6989586621682451744"><span id="local-6989586621682451746"><span id="local-6989586621682451752"><span id="local-6989586621682451757"><span id="local-6989586621682451760"><span id="local-6989586621682451763"><span id="local-6989586621682451766"><span id="local-6989586621682451769"><span id="local-6989586621682451772"><span id="local-6989586621682451777"><span id="local-6989586621682451782"><span class="annot"><span class="annottext">Typeable NonDetFastString
Typeable NonDetFastString =&gt;
(forall (c :: * -&gt; *).
 (forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
 -&gt; (forall g. g -&gt; c g) -&gt; NonDetFastString -&gt; c NonDetFastString)
-&gt; (forall (c :: * -&gt; *).
    (forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
    -&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c NonDetFastString)
-&gt; (NonDetFastString -&gt; Constr)
-&gt; (NonDetFastString -&gt; DataType)
-&gt; (forall (t :: * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d. Data d =&gt; c (t d)) -&gt; Maybe (c NonDetFastString))
-&gt; (forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d e. (Data d, Data e) =&gt; c (t d e))
    -&gt; Maybe (c NonDetFastString))
-&gt; ((forall b. Data b =&gt; b -&gt; b)
    -&gt; NonDetFastString -&gt; NonDetFastString)
-&gt; (forall r r'.
    (r -&gt; r' -&gt; r)
    -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r)
-&gt; (forall r r'.
    (r' -&gt; r -&gt; r)
    -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r)
-&gt; (forall u.
    (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; [u])
-&gt; (forall u.
    Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; u)
-&gt; (forall (m :: * -&gt; *).
    Monad m =&gt;
    (forall d. Data d =&gt; d -&gt; m d)
    -&gt; NonDetFastString -&gt; m NonDetFastString)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d)
    -&gt; NonDetFastString -&gt; m NonDetFastString)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d)
    -&gt; NonDetFastString -&gt; m NonDetFastString)
-&gt; Data NonDetFastString
NonDetFastString -&gt; Constr
NonDetFastString -&gt; DataType
(forall b. Data b =&gt; b -&gt; b)
-&gt; NonDetFastString -&gt; NonDetFastString
forall a.
Typeable a =&gt;
(forall (c :: * -&gt; *).
 (forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
 -&gt; (forall g. g -&gt; c g) -&gt; a -&gt; c a)
-&gt; (forall (c :: * -&gt; *).
    (forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
    -&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c a)
-&gt; (a -&gt; Constr)
-&gt; (a -&gt; DataType)
-&gt; (forall (t :: * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d. Data d =&gt; c (t d)) -&gt; Maybe (c a))
-&gt; (forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d e. (Data d, Data e) =&gt; c (t d e)) -&gt; Maybe (c a))
-&gt; ((forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a)
-&gt; (forall r r'.
    (r -&gt; r' -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall r r'.
    (r' -&gt; r -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; [u])
-&gt; (forall u. Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; u)
-&gt; (forall (m :: * -&gt; *).
    Monad m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; Data a
forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; u
forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; [u]
forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c NonDetFastString
forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; NonDetFastString -&gt; c NonDetFastString
forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c NonDetFastString)
forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c NonDetFastString)
$cgfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; NonDetFastString -&gt; c NonDetFastString
gfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; NonDetFastString -&gt; c NonDetFastString
$cgunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c NonDetFastString
gunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c NonDetFastString
$ctoConstr :: NonDetFastString -&gt; Constr
toConstr :: NonDetFastString -&gt; Constr
$cdataTypeOf :: NonDetFastString -&gt; DataType
dataTypeOf :: NonDetFastString -&gt; DataType
$cdataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c NonDetFastString)
dataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c NonDetFastString)
$cdataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c NonDetFastString)
dataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c NonDetFastString)
$cgmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; NonDetFastString -&gt; NonDetFastString
gmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; NonDetFastString -&gt; NonDetFastString
$cgmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
gmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
$cgmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
gmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
$cgmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; [u]
gmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; [u]
$cgmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; u
gmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; u
$cgmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
gmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
$cgmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
gmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
$cgmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
gmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Data</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682451791"><span id="local-6989586621682451795"><span id="local-6989586621682451798"><span id="local-6989586621682451801"><span id="local-6989586621682451804"><span id="local-6989586621682451807"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>   </span><span id="local-6989586621682451810"><span class="annot"><span class="annottext">compare :: NonDetFastString -&gt; NonDetFastString -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var">compare</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span><span> </span><span id="local-6989586621682451811"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451811"><span class="hs-identifier hs-var">fs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span><span> </span><span id="local-6989586621682451812"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451812"><span class="hs-identifier hs-var">fs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier hs-var">uniqCompareFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451811"><span class="hs-identifier hs-var">fs1</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451812"><span class="hs-identifier hs-var">fs2</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-comment">-- | Lexical FastString</span><span>
</span><span id="line-281"></span><span class="hs-comment">--</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- This is a simple FastString wrapper with an Ord instance using</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- `lexicalCompareFS` (i.e. which compares FastStrings on their String</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- representation). Hence it is deterministic from one run to the other.</span><span>
</span><span id="line-285"></span><span class="hs-keyword">newtype</span><span> </span><span id="LexicalFastString"><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-var">LexicalFastString</span></a></span></span><span>
</span><span id="line-286"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="LexicalFastString"><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-var">LexicalFastString</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getLexicalFastString"><span class="annot"><span class="annottext">LexicalFastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#getLexicalFastString"><span class="hs-identifier hs-var hs-var">getLexicalFastString</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-287"></span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682451816"><span id="local-6989586621682451820"><span class="annot"><span class="annottext">LexicalFastString -&gt; LexicalFastString -&gt; Bool
(LexicalFastString -&gt; LexicalFastString -&gt; Bool)
-&gt; (LexicalFastString -&gt; LexicalFastString -&gt; Bool)
-&gt; Eq LexicalFastString
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
== :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
$c/= :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
/= :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451825"><span id="local-6989586621682451829"><span id="local-6989586621682451833"><span class="annot"><span class="annottext">Int -&gt; LexicalFastString -&gt; ShowS
[LexicalFastString] -&gt; ShowS
LexicalFastString -&gt; String
(Int -&gt; LexicalFastString -&gt; ShowS)
-&gt; (LexicalFastString -&gt; String)
-&gt; ([LexicalFastString] -&gt; ShowS)
-&gt; Show LexicalFastString
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; LexicalFastString -&gt; ShowS
showsPrec :: Int -&gt; LexicalFastString -&gt; ShowS
$cshow :: LexicalFastString -&gt; String
show :: LexicalFastString -&gt; String
$cshowList :: [LexicalFastString] -&gt; ShowS
showList :: [LexicalFastString] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span id="local-6989586621682451840"><span id="local-6989586621682451843"><span id="local-6989586621682451846"><span id="local-6989586621682451848"><span id="local-6989586621682451850"><span id="local-6989586621682451856"><span id="local-6989586621682451861"><span id="local-6989586621682451864"><span id="local-6989586621682451867"><span id="local-6989586621682451870"><span id="local-6989586621682451873"><span id="local-6989586621682451876"><span id="local-6989586621682451881"><span id="local-6989586621682451886"><span class="annot"><span class="annottext">Typeable LexicalFastString
Typeable LexicalFastString =&gt;
(forall (c :: * -&gt; *).
 (forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
 -&gt; (forall g. g -&gt; c g)
 -&gt; LexicalFastString
 -&gt; c LexicalFastString)
-&gt; (forall (c :: * -&gt; *).
    (forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
    -&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c LexicalFastString)
-&gt; (LexicalFastString -&gt; Constr)
-&gt; (LexicalFastString -&gt; DataType)
-&gt; (forall (t :: * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d. Data d =&gt; c (t d)) -&gt; Maybe (c LexicalFastString))
-&gt; (forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d e. (Data d, Data e) =&gt; c (t d e))
    -&gt; Maybe (c LexicalFastString))
-&gt; ((forall b. Data b =&gt; b -&gt; b)
    -&gt; LexicalFastString -&gt; LexicalFastString)
-&gt; (forall r r'.
    (r -&gt; r' -&gt; r)
    -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r)
-&gt; (forall r r'.
    (r' -&gt; r -&gt; r)
    -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r)
-&gt; (forall u.
    (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; [u])
-&gt; (forall u.
    Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; u)
-&gt; (forall (m :: * -&gt; *).
    Monad m =&gt;
    (forall d. Data d =&gt; d -&gt; m d)
    -&gt; LexicalFastString -&gt; m LexicalFastString)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d)
    -&gt; LexicalFastString -&gt; m LexicalFastString)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d)
    -&gt; LexicalFastString -&gt; m LexicalFastString)
-&gt; Data LexicalFastString
LexicalFastString -&gt; Constr
LexicalFastString -&gt; DataType
(forall b. Data b =&gt; b -&gt; b)
-&gt; LexicalFastString -&gt; LexicalFastString
forall a.
Typeable a =&gt;
(forall (c :: * -&gt; *).
 (forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
 -&gt; (forall g. g -&gt; c g) -&gt; a -&gt; c a)
-&gt; (forall (c :: * -&gt; *).
    (forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
    -&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c a)
-&gt; (a -&gt; Constr)
-&gt; (a -&gt; DataType)
-&gt; (forall (t :: * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d. Data d =&gt; c (t d)) -&gt; Maybe (c a))
-&gt; (forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d e. (Data d, Data e) =&gt; c (t d e)) -&gt; Maybe (c a))
-&gt; ((forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a)
-&gt; (forall r r'.
    (r -&gt; r' -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall r r'.
    (r' -&gt; r -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; [u])
-&gt; (forall u. Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; u)
-&gt; (forall (m :: * -&gt; *).
    Monad m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; Data a
forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; u
forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; [u]
forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c LexicalFastString
forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; LexicalFastString -&gt; c LexicalFastString
forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c LexicalFastString)
forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c LexicalFastString)
$cgfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; LexicalFastString -&gt; c LexicalFastString
gfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; LexicalFastString -&gt; c LexicalFastString
$cgunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c LexicalFastString
gunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c LexicalFastString
$ctoConstr :: LexicalFastString -&gt; Constr
toConstr :: LexicalFastString -&gt; Constr
$cdataTypeOf :: LexicalFastString -&gt; DataType
dataTypeOf :: LexicalFastString -&gt; DataType
$cdataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c LexicalFastString)
dataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c LexicalFastString)
$cdataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c LexicalFastString)
dataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c LexicalFastString)
$cgmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; LexicalFastString -&gt; LexicalFastString
gmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; LexicalFastString -&gt; LexicalFastString
$cgmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
gmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
$cgmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
gmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
$cgmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; [u]
gmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; [u]
$cgmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; u
gmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; u
$cgmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
gmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
$cgmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
gmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
$cgmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
gmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Data</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682451894"><span id="local-6989586621682451898"><span id="local-6989586621682451901"><span id="local-6989586621682451904"><span id="local-6989586621682451907"><span id="local-6989586621682451910"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>   </span><span id="local-6989586621682451912"><span class="annot"><span class="annottext">compare :: LexicalFastString -&gt; LexicalFastString -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var">compare</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span id="local-6989586621682451913"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451913"><span class="hs-identifier hs-var">fs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span id="local-6989586621682451914"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451914"><span class="hs-identifier hs-var">fs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier hs-var">lexicalCompareFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451913"><span class="hs-identifier hs-var">fs1</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451914"><span class="hs-identifier hs-var">fs2</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621682451918"><span class="annot"><span class="annottext">rnf :: LexicalFastString -&gt; ()
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span id="local-6989586621682451919"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451919"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-var">rnf</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451919"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- Construction</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">{-
Internally, the compiler will maintain a fast string symbol table, providing
sharing and fast comparison. Creation of new @FastString@s then covertly does a
lookup, re-using the @FastString@ if there was a hit.

The design of the FastString hash table allows for lockless concurrent reads
and updates to multiple buckets with low synchronization overhead.

See Note [Updating the FastString table] on how it's updated.
-}</span><span>
</span><span id="line-309"></span><span class="hs-keyword">data</span><span> </span><span id="FastStringTable"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-var">FastStringTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastStringTable"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-var">FastStringTable</span></a></span></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- ^ The unique ID counter shared with all buckets</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-comment">-- We unpack the 'FastMutInt' counter as it is always consumed strictly.</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-pragma">{-# NOUNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-comment">-- ^ Number of computed z-encodings for all buckets.</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-comment">-- We mark this as 'NOUNPACK' as this 'FastMutInt' is retained by a thunk</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-comment">-- in 'mkFastStringWith' and needs to be boxed any way.</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-comment">-- If this is unpacked, then we box this single 'FastMutInt' once for each</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-comment">-- allocated FastString.</span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Array#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^  concurrent segments</span></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-keyword">data</span><span> </span><span id="FastStringTableSegment"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastStringTableSegment"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- the lock for write in each segment</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-comment">-- the number of elements</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- buckets in this segment</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">{-
Following parameters are determined based on:

* Benchmark based on testsuite/tests/utils/should_run/T14854.hs
* Stats of @echo :browse | ghc --interactive -dfaststring-stats &gt;/dev/null@:
  on 2018-10-24, we have 13920 entries.
-}</span><span>
</span><span id="line-335"></span><span class="annot"><a href="GHC.Data.FastString.html#segmentBits"><span class="hs-identifier hs-type">segmentBits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-type">numSegments</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#segmentMask"><span class="hs-identifier hs-type">segmentMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#initialNumBuckets"><span class="hs-identifier hs-type">initialNumBuckets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-336"></span><span id="segmentBits"><span class="annot"><span class="annottext">segmentBits :: Int
</span><a href="GHC.Data.FastString.html#segmentBits"><span class="hs-identifier hs-var hs-var">segmentBits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-337"></span><span id="numSegments"><span class="annot"><span class="annottext">numSegments :: Int
</span><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-var hs-var">numSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">256</span></span><span>   </span><span class="hs-comment">-- bit segmentBits</span><span>
</span><span id="line-338"></span><span id="segmentMask"><span class="annot"><span class="annottext">segmentMask :: Int
</span><a href="GHC.Data.FastString.html#segmentMask"><span class="hs-identifier hs-var hs-var">segmentMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xff</span></span><span>  </span><span class="hs-comment">-- bit segmentBits - 1</span><span>
</span><span id="line-339"></span><span id="initialNumBuckets"><span class="annot"><span class="annottext">initialNumBuckets :: Int
</span><a href="GHC.Data.FastString.html#initialNumBuckets"><span class="hs-identifier hs-var hs-var">initialNumBuckets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">64</span></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="GHC.Data.FastString.html#hashToSegment%23"><span class="hs-identifier hs-type">hashToSegment#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span>
</span><span id="line-342"></span><span id="hashToSegment%23"><span class="annot"><span class="annottext">hashToSegment# :: Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToSegment%23"><span class="hs-identifier hs-var hs-var">hashToSegment#</span></a></span></span><span> </span><span id="local-6989586621682451928"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451928"><span class="hs-identifier hs-var">hash#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451928"><span class="hs-identifier hs-var">hash#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`andI#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451929"><span class="hs-identifier hs-var">segmentMask#</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682451929"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451929"><span class="hs-identifier hs-var">segmentMask#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#segmentMask"><span class="hs-identifier hs-var">segmentMask</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="annot"><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-type">hashToIndex#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span>
</span><span id="line-347"></span><span id="hashToIndex%23"><span class="annot"><span class="annottext">hashToIndex# :: MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var hs-var">hashToIndex#</span></a></span></span><span> </span><span id="local-6989586621682451931"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451931"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span id="local-6989586621682451932"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451932"><span class="hs-identifier hs-var">hash#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451932"><span class="hs-identifier hs-var">hash#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`uncheckedIShiftRL#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451933"><span class="hs-identifier hs-var">segmentBits#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`remInt#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451934"><span class="hs-identifier hs-var">size#</span></a></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682451933"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451933"><span class="hs-identifier hs-var">segmentBits#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#segmentBits"><span class="hs-identifier hs-var">segmentBits</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span id="local-6989586621682451934"><span class="annot"><span class="annottext">size# :: Int#
</span><a href="#local-6989586621682451934"><span class="hs-identifier hs-var hs-var">size#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int#
forall d a. MutableArray# d a -&gt; Int#
</span><span class="hs-identifier hs-var">sizeofMutableArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451931"><span class="hs-identifier hs-var">buckets#</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Data.FastString.html#maybeResizeSegment"><span class="hs-identifier hs-type">maybeResizeSegment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span>
</span><span id="line-354"></span><span id="maybeResizeSegment"><span class="annot"><span class="annottext">maybeResizeSegment :: IORef FastStringTableSegment -&gt; IO FastStringTableSegment
</span><a href="GHC.Data.FastString.html#maybeResizeSegment"><span class="hs-identifier hs-var hs-var">maybeResizeSegment</span></a></span></span><span> </span><span id="local-6989586621682451936"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682451936"><span class="hs-identifier hs-var">segmentRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621682451937"><span class="annot"><a href="#local-6989586621682451937"><span class="hs-identifier hs-var">segment</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span id="local-6989586621682451938"><span class="annot"><a href="#local-6989586621682451938"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span id="local-6989586621682451939"><span class="annot"><a href="#local-6989586621682451939"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span id="local-6989586621682451940"><span class="annot"><a href="#local-6989586621682451940"><span class="hs-identifier hs-var">old#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment -&gt; IO FastStringTableSegment
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682451936"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682451942"><span class="annot"><a href="#local-6989586621682451942"><span class="hs-identifier hs-var hs-var">oldSize#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int#
forall d a. MutableArray# d a -&gt; Int#
</span><span class="hs-identifier hs-var">sizeofMutableArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451940"><span class="hs-identifier hs-var">old#</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span id="local-6989586621682451943"><span class="annot"><a href="#local-6989586621682451943"><span class="hs-identifier hs-var hs-var">newSize#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451942"><span class="hs-identifier hs-var">oldSize#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">*#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">2#</span></span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682451944"><span class="annot"><a href="#local-6989586621682451944"><span class="hs-identifier hs-var">n#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#readFastMutInt"><span class="hs-identifier hs-type">readFastMutInt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682451939"><span class="hs-identifier hs-type">counter</span></a></span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">isTrue#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682451944"><span class="hs-identifier hs-type">n#</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;#</span></span><span> </span><span class="annot"><a href="#local-6989586621682451943"><span class="hs-identifier hs-type">newSize#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- maximum load of 1</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682451937"><span class="hs-identifier hs-type">segment</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621682451947"><span class="annot"><a href="#local-6989586621682451947"><span class="hs-identifier hs-var">resizedSegment</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682451948"><span class="annot"><a href="#local-6989586621682451948"><span class="hs-identifier hs-var">new#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682451949"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451949"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int#
-&gt; [FastString]
-&gt; State# RealWorld
-&gt; (# State# RealWorld, MutableArray# RealWorld [FastString] #)
forall a d.
Int# -&gt; a -&gt; State# d -&gt; (# State# d, MutableArray# d a #)
</span><span class="hs-identifier hs-var">newArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451943"><span class="hs-identifier hs-var">newSize#</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451949"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451950"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451950"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451951"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451951"><span class="hs-identifier hs-var">arr#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451950"><span class="hs-identifier hs-var">s2#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MVar ()
-&gt; FastMutInt
-&gt; MutableArray# RealWorld [FastString]
-&gt; FastStringTableSegment
</span><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621682451938"><span class="hs-identifier hs-var">lock</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682451939"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451951"><span class="hs-identifier hs-var">arr#</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-365"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span class="annot"><a href="#local-6989586621682451942"><span class="hs-identifier hs-type">oldSize#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682451953"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451953"><span class="hs-identifier hs-var">i#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>      </span><span id="local-6989586621682451954"><span class="annot"><a href="#local-6989586621682451954"><span class="hs-identifier hs-var">fsList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, [FastString] #))
-&gt; IO [FastString]
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, [FastString] #))
 -&gt; IO [FastString])
-&gt; (State# RealWorld -&gt; (# State# RealWorld, [FastString] #))
-&gt; IO [FastString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
-&gt; Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, [FastString] #)
forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451940"><span class="hs-identifier hs-var">old#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451953"><span class="hs-identifier hs-var">i#</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682451954"><span class="hs-identifier hs-type">fsList</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682451955"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451955"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-368"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Shall we store in hash value in FastString instead?</span><span>
</span><span id="line-369"></span><span>            </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682451956"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451956"><span class="hs-identifier hs-var">hash#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashFastString"><span class="hs-identifier hs-var">hashFastString</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451955"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span id="local-6989586621682451957"><span class="annot"><span class="annottext">idx# :: Int#
</span><a href="#local-6989586621682451957"><span class="hs-identifier hs-var hs-var">idx#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var">hashToIndex#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451948"><span class="hs-identifier hs-var">new#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451956"><span class="hs-identifier hs-var">hash#</span></a></span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ())
-&gt; (State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682451958"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451958"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-372"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
-&gt; Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, [FastString] #)
forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451948"><span class="hs-identifier hs-var">new#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451957"><span class="hs-identifier hs-var">idx#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451958"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451959"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451959"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451960"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682451960"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
-&gt; Int# -&gt; [FastString] -&gt; State# RealWorld -&gt; State# RealWorld
forall d a. MutableArray# d a -&gt; Int# -&gt; a -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">writeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451948"><span class="hs-identifier hs-var">new#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451957"><span class="hs-identifier hs-var">idx#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682451955"><span class="hs-identifier hs-var">fs</span></a></span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [FastString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682451960"><span class="hs-identifier hs-var">bucket</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451959"><span class="hs-identifier hs-var">s2#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>              </span><span id="local-6989586621682451961"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451961"><span class="hs-identifier hs-var">s3#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451961"><span class="hs-identifier hs-var">s3#</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682451936"><span class="hs-identifier hs-type">segmentRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682451947"><span class="hs-identifier hs-type">resizedSegment</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682451947"><span class="hs-identifier hs-type">resizedSegment</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#stringTable"><span class="hs-pragma hs-type">stringTable</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-type">stringTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span>
</span><span id="line-380"></span><span id="stringTable"><span class="annot"><span class="annottext">stringTable :: FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var hs-var">stringTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO FastStringTable -&gt; FastStringTable
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO FastStringTable -&gt; FastStringTable)
-&gt; IO FastStringTable -&gt; FastStringTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682451965"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451965"><span class="hs-identifier hs-var hs-var">numSegments#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-var">numSegments</span></a></span><span>
</span><span id="line-382"></span><span>      </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682451966"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451966"><span class="hs-identifier hs-var hs-var">initialNumBuckets#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#initialNumBuckets"><span class="hs-identifier hs-var">initialNumBuckets</span></a></span><span>
</span><span id="line-383"></span><span>      </span><span id="local-6989586621682451967"><span class="annot"><span class="annottext">loop :: MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; Int# -&gt; State# RealWorld -&gt; State# RealWorld
</span><a href="#local-6989586621682451967"><span class="hs-identifier hs-var hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621682451968"><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451968"><span class="hs-identifier hs-var">a#</span></a></span></span><span> </span><span id="local-6989586621682451969"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451969"><span class="hs-identifier hs-var">i#</span></a></span></span><span> </span><span id="local-6989586621682451970"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451970"><span class="hs-identifier hs-var">s1#</span></a></span></span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Bool
</span><span class="hs-identifier hs-var">isTrue#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451969"><span class="hs-identifier hs-var">i#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">==#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451965"><span class="hs-identifier hs-var">numSegments#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451970"><span class="hs-identifier hs-var">s1#</span></a></span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (MVar ()) -&gt; State# RealWorld -&gt; (# State# RealWorld, MVar () #)
forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><span class="hs-operator hs-var">`unIO`</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451970"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-386"></span><span>            </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451973"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451973"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451974"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621682451974"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO FastMutInt
</span><a href="GHC.Data.FastMutInt.html#newFastMutInt"><span class="hs-identifier hs-var">newFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">IO FastMutInt
-&gt; State# RealWorld -&gt; (# State# RealWorld, FastMutInt #)
forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><span class="hs-operator hs-var">`unIO`</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451973"><span class="hs-identifier hs-var">s2#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-387"></span><span>              </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451976"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451976"><span class="hs-identifier hs-var">s3#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451977"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682451977"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int#
-&gt; [FastString]
-&gt; State# RealWorld
-&gt; (# State# RealWorld, MutableArray# RealWorld [FastString] #)
forall a d.
Int# -&gt; a -&gt; State# d -&gt; (# State# d, MutableArray# d a #)
</span><span class="hs-identifier hs-var">newArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451966"><span class="hs-identifier hs-var">initialNumBuckets#</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451976"><span class="hs-identifier hs-var">s3#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-388"></span><span>                </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451978"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451978"><span class="hs-identifier hs-var">s4#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451979"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451979"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FastStringTableSegment -&gt; IO (IORef FastStringTableSegment)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span>
</span><span id="line-389"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar ()
-&gt; FastMutInt
-&gt; MutableArray# RealWorld [FastString]
-&gt; FastStringTableSegment
</span><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621682451974"><span class="hs-identifier hs-var">lock</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682451977"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682451979"><span class="hs-identifier hs-var">buckets#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (IORef FastStringTableSegment)
-&gt; State# RealWorld
-&gt; (# State# RealWorld, IORef FastStringTableSegment #)
forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><span class="hs-operator hs-var">`unIO`</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451978"><span class="hs-identifier hs-var">s4#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-390"></span><span>                  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451981"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451981"><span class="hs-identifier hs-var">s5#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451982"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682451982"><span class="hs-identifier hs-var">segment</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; Int#
-&gt; IORef FastStringTableSegment
-&gt; State# RealWorld
-&gt; State# RealWorld
forall d a. MutableArray# d a -&gt; Int# -&gt; a -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">writeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451968"><span class="hs-identifier hs-var">a#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451969"><span class="hs-identifier hs-var">i#</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682451982"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451981"><span class="hs-identifier hs-var">s5#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>                    </span><span id="local-6989586621682451983"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451983"><span class="hs-identifier hs-var">s6#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; Int# -&gt; State# RealWorld -&gt; State# RealWorld
</span><a href="#local-6989586621682451967"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451968"><span class="hs-identifier hs-var">a#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451969"><span class="hs-identifier hs-var">i#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">+#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451983"><span class="hs-identifier hs-var">s6#</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621682451984"><span class="annot"><a href="#local-6989586621682451984"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO FastMutInt
</span><a href="GHC.Data.FastMutInt.html#newFastMutInt"><span class="hs-identifier hs-var">newFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">603979776</span></span><span> </span><span class="hs-comment">-- ord '$' * 0x01000000</span><span>
</span><span id="line-393"></span><span>  </span><span id="local-6989586621682451985"><span class="annot"><a href="#local-6989586621682451985"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#newFastMutInt"><span class="hs-identifier hs-type">newFastMutInt</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-394"></span><span>  </span><span id="local-6989586621682451986"><span class="annot"><a href="#local-6989586621682451986"><span class="hs-identifier hs-var">tab</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682451987"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451987"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int#
-&gt; IORef FastStringTableSegment
-&gt; State# RealWorld
-&gt; (# State# RealWorld,
      MutableArray# RealWorld (IORef FastStringTableSegment) #)
forall a d.
Int# -&gt; a -&gt; State# d -&gt; (# State# d, MutableArray# d a #)
</span><span class="hs-identifier hs-var">newArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682451965"><span class="hs-identifier hs-var">numSegments#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IORef FastStringTableSegment
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;string_table&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451987"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451989"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451989"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451990"><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451990"><span class="hs-identifier hs-var">arr#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; Int# -&gt; State# RealWorld -&gt; State# RealWorld
</span><a href="#local-6989586621682451967"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451990"><span class="hs-identifier hs-var">arr#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451989"><span class="hs-identifier hs-var">s2#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-397"></span><span>        </span><span id="local-6989586621682451991"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451991"><span class="hs-identifier hs-var">s3#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; State# RealWorld
-&gt; (# State# RealWorld, Array# (IORef FastStringTableSegment) #)
forall d a.
MutableArray# d a -&gt; State# d -&gt; (# State# d, Array# a #)
</span><span class="hs-identifier hs-var">unsafeFreezeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451990"><span class="hs-identifier hs-var">arr#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451991"><span class="hs-identifier hs-var">s3#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>          </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682451992"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451992"><span class="hs-identifier hs-var">s4#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682451993"><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451993"><span class="hs-identifier hs-var">segments#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>            </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682451992"><span class="hs-identifier hs-var">s4#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastMutInt
-&gt; FastMutInt
-&gt; Array# (IORef FastStringTableSegment)
-&gt; FastStringTable
</span><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-var">FastStringTable</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682451984"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682451985"><span class="hs-identifier hs-var">n_zencs</span></a></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621682451993"><span class="hs-identifier hs-var">segments#</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-comment">-- use the support wired into the RTS to share this CAF among all images of</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-comment">-- libHSghc</span><span class="hs-cpp">
#if !MIN_VERSION_GLASGOW_HASKELL(9,3,0,0)
</span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">tab</span><span class="hs-cpp">
#else
</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">sharedCAF</span></span><span> </span><span class="annot"><a href="#local-6989586621682451986"><span class="hs-identifier hs-type">tab</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#getOrSetLibHSghcFastStringTable"><span class="hs-identifier hs-type">getOrSetLibHSghcFastStringTable</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">-- from the 9.3 RTS; the previous RTS before might not have this symbol.  The</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- right way to do this however would be to define some HAVE_FAST_STRING_TABLE</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- or similar rather than use (odd parity) development versions.</span><span>
</span><span id="line-411"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;getOrSetLibHSghcFastStringTable&quot;</span></span><span>
</span><span id="line-412"></span><span>  </span><span id="getOrSetLibHSghcFastStringTable"><span class="annot"><a href="GHC.Data.FastString.html#getOrSetLibHSghcFastStringTable"><span class="hs-identifier hs-var">getOrSetLibHSghcFastStringTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682451421"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621682451421"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621682451421"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-415"></span><span class="hs-comment">{-

We include the FastString table in the `sharedCAF` mechanism because we'd like
FastStrings created by a Core plugin to have the same uniques as corresponding
strings created by the host compiler itself.  For example, this allows plugins
to lookup known names (eg `mkTcOcc &quot;MySpecialType&quot;`) in the GlobalRdrEnv or
even re-invoke the parser.

In particular, the following little sanity test was failing in a plugin
prototyping safe newtype-coercions: GHC.NT.Type.NT was imported, but could not
be looked up /by the plugin/.

   let rdrName = mkModuleName &quot;GHC.NT.Type&quot; `mkRdrQual` mkTcOcc &quot;NT&quot;
   putMsgS $ showSDoc dflags $ ppr $
     lookupGRE (mg_rdr_env guts) (LookupRdrName rdrName AllRelevantGREs)

`mkTcOcc` involves the lookup (or creation) of a FastString.  Since the
plugin's FastString.string_table is empty, constructing the RdrName also
allocates new uniques for the FastStrings &quot;GHC.NT.Type&quot; and &quot;NT&quot;.  These
uniques are almost certainly unequal to the ones that the host compiler
originally assigned to those FastStrings.  Thus the lookup fails since the
domain of the GlobalRdrEnv is affected by the RdrName's OccName's FastString's
unique.

Maintaining synchronization of the two instances of this global is rather
difficult because of the uses of `unsafePerformIO` in this module.  Not
synchronizing them risks breaking the rather major invariant that two
FastStrings with the same unique have the same string. Thus we use the
lower-level `sharedCAF` mechanism that relies on Globals.c.

-}</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-identifier hs-type">mkFastString#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Addr#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-448"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-pragma hs-type">mkFastString#</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-449"></span><span id="mkFastString%23"><span class="annot"><span class="annottext">mkFastString# :: Addr# -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-identifier hs-var hs-var">mkFastString#</span></a></span></span><span> </span><span id="local-6989586621682451995"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682451995"><span class="hs-identifier hs-var">a#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier hs-var">mkFastStringBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621682451996"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int
</span><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-var">ptrStrLength</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621682451996"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682451996"><span class="annot"><span class="annottext">ptr :: Ptr Word8
</span><a href="#local-6989586621682451996"><span class="hs-identifier hs-var hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Ptr Word8
forall a. Addr# -&gt; Ptr a
</span><span class="hs-identifier hs-var">Ptr</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682451995"><span class="hs-identifier hs-var">a#</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="hs-comment">{- Note [Updating the FastString table]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We use a concurrent hashtable which contains multiple segments, each hash value
always maps to the same segment. Read is lock-free, write to the a segment
should acquire a lock for that segment to avoid race condition, writes to
different segments are independent.

The procedure goes like this:

1. Find out which segment to operate on based on the hash value
2. Read the relevant bucket and perform a look up of the string.
3. If it exists, return it.
4. Otherwise grab a unique ID, create a new FastString and atomically attempt
   to update the relevant segment with this FastString:

   * Resize the segment by doubling the number of buckets when the number of
     FastStrings in this segment grows beyond the threshold.
   * Double check that the string is not in the bucket. Another thread may have
     inserted it while we were creating our string.
   * Return the existing FastString if it exists. The one we preemptively
     created will get GCed.
   * Otherwise, insert and return the string we created.
-}</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-type">mkFastStringWith</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-478"></span><span id="mkFastStringWith"><span class="annot"><span class="annottext">mkFastStringWith :: (Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var hs-var">mkFastStringWith</span></a></span></span><span> </span><span id="local-6989586621682451999"><span class="annot"><span class="annottext">Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="#local-6989586621682451999"><span class="hs-identifier hs-var">mk_fs</span></a></span></span><span> </span><span id="local-6989586621682452000"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452000"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span id="local-6989586621682452001"><span class="annot"><a href="#local-6989586621682452001"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682452002"><span class="annot"><a href="#local-6989586621682452002"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment -&gt; IO FastStringTableSegment
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682452003"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682452004"><span class="annot"><a href="#local-6989586621682452004"><span class="hs-identifier hs-var hs-var">idx#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var">hashToIndex#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682452002"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452005"><span class="hs-identifier hs-var">hash#</span></a></span><span>
</span><span id="line-481"></span><span>  </span><span id="local-6989586621682452006"><span class="annot"><a href="#local-6989586621682452006"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readArray#</span></span><span> </span><span class="annot"><a href="#local-6989586621682452002"><span class="hs-identifier hs-type">buckets#</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452004"><span class="hs-identifier hs-type">idx#</span></a></span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-type">bucket_match</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452006"><span class="hs-identifier hs-type">bucket</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452000"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682452008"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452008"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; IO FastString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452008"><span class="hs-identifier hs-var">found</span></a></span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="annottext">Maybe FastString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-comment">-- The withMVar below is not dupable. It can lead to deadlock if it is</span><span>
</span><span id="line-486"></span><span>      </span><span class="hs-comment">-- only run partially and putMVar is not called after takeMVar.</span><span>
</span><span id="line-487"></span><span>      </span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier hs-var">noDuplicate</span></span><span>
</span><span id="line-488"></span><span>      </span><span id="local-6989586621682452010"><span class="annot"><a href="#local-6989586621682452010"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621682452011"><span class="hs-identifier hs-var">get_uid</span></a></span><span>
</span><span id="line-489"></span><span>      </span><span id="local-6989586621682452012"><span class="annot"><a href="#local-6989586621682452012"><span class="hs-identifier hs-var">new_fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682451999"><span class="hs-identifier hs-type">mk_fs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452010"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452013"><span class="hs-identifier hs-type">n_zencs</span></a></span><span>
</span><span id="line-490"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">withMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621682452001"><span class="hs-identifier hs-type">lock</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; IO FastString
</span><a href="#local-6989586621682452015"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452012"><span class="hs-identifier hs-var">new_fs</span></a></span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span> </span><span id="local-6989586621682452016"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452016"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682452013"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452013"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span id="local-6989586621682452017"><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621682452017"><span class="hs-identifier hs-var">segments#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var">stringTable</span></a></span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621682452011"><span class="annot"><span class="annottext">get_uid :: IO Int
</span><a href="#local-6989586621682452011"><span class="hs-identifier hs-var hs-var">get_uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; Int -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#atomicFetchAddFastMut"><span class="hs-identifier hs-var">atomicFetchAddFastMut</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452016"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682452005"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452005"><span class="hs-identifier hs-var">hash#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-var">hashStr</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452000"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682452003"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682452003"><span class="hs-identifier hs-var">segmentRef</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
-&gt; Int# -&gt; (# IORef FastStringTableSegment #)
forall a. Array# a -&gt; Int# -&gt; (# a #)
</span><span class="hs-identifier hs-var">indexArray#</span></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621682452017"><span class="hs-identifier hs-var">segments#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToSegment%23"><span class="hs-identifier hs-var">hashToSegment#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452005"><span class="hs-identifier hs-var">hash#</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>    </span><span id="local-6989586621682452015"><span class="annot"><span class="annottext">insert :: FastString -&gt; IO FastString
</span><a href="#local-6989586621682452015"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span id="local-6989586621682452019"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452019"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>      </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682452020"><span class="annot"><a href="#local-6989586621682452020"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span id="local-6989586621682452021"><span class="annot"><a href="#local-6989586621682452021"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment -&gt; IO FastStringTableSegment
</span><a href="GHC.Data.FastString.html#maybeResizeSegment"><span class="hs-identifier hs-var">maybeResizeSegment</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682452003"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-499"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682452022"><span class="annot"><a href="#local-6989586621682452022"><span class="hs-identifier hs-var hs-var">idx#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var">hashToIndex#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682452021"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452005"><span class="hs-identifier hs-var">hash#</span></a></span><span>
</span><span id="line-500"></span><span>      </span><span id="local-6989586621682452023"><span class="annot"><a href="#local-6989586621682452023"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readArray#</span></span><span> </span><span class="annot"><a href="#local-6989586621682452021"><span class="hs-identifier hs-type">buckets#</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452022"><span class="hs-identifier hs-type">idx#</span></a></span><span>
</span><span id="line-501"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-type">bucket_match</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452023"><span class="hs-identifier hs-type">bucket</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452000"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-comment">-- The FastString was added by another thread after previous read and</span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-comment">-- before we acquired the write lock.</span><span>
</span><span id="line-504"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682452024"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452024"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; IO FastString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452024"><span class="hs-identifier hs-var">found</span></a></span><span>
</span><span id="line-505"></span><span>        </span><span class="annot"><span class="annottext">Maybe FastString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>          </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ())
-&gt; (State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682452025"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452025"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-507"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
-&gt; Int# -&gt; [FastString] -&gt; State# RealWorld -&gt; State# RealWorld
forall d a. MutableArray# d a -&gt; Int# -&gt; a -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">writeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682452021"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452022"><span class="hs-identifier hs-var">idx#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452019"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [FastString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682452023"><span class="hs-identifier hs-var">bucket</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452025"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-508"></span><span>              </span><span id="local-6989586621682452026"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452026"><span class="hs-identifier hs-var">s2#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452026"><span class="hs-identifier hs-var">s2#</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-509"></span><span>          </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; Int -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#atomicFetchAddFastMut"><span class="hs-identifier hs-var">atomicFetchAddFastMut</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452020"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-510"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682452019"><span class="hs-identifier hs-type">fs</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="annot"><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-type">bucket_match</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-513"></span><span id="bucket_match"><span class="annot"><span class="annottext">bucket_match :: [FastString] -&gt; ShortByteString -&gt; Maybe FastString
</span><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-var hs-var">bucket_match</span></a></span></span><span> </span><span id="local-6989586621682452027"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682452027"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682452028"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452028"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; Maybe FastString
</span><a href="#local-6989586621682452029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682452027"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682452029"><span class="annot"><span class="annottext">go :: [FastString] -&gt; Maybe FastString
</span><a href="#local-6989586621682452029"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-515"></span><span>        </span><span class="annot"><a href="#local-6989586621682452029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682452030"><span class="annot"><span class="annottext">fs :: FastString
</span><a href="#local-6989586621682452030"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">fs_sbs :: FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682452031"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452031"><span class="hs-identifier hs-var">fs_sbs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682452032"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682452032"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452031"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ShortByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452028"><span class="hs-identifier hs-var">sbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Maybe FastString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452030"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-517"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; Maybe FastString
</span><a href="#local-6989586621682452029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682452032"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-518"></span><span class="hs-comment">-- bucket_match used to inline before changes to instance Eq ShortByteString</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- in bytestring-0.12, which made it slightly larger than inlining threshold.</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- Non-inlining causes a small, but measurable performance regression, so let's force it.</span><span>
</span><span id="line-521"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-pragma hs-type">bucket_match</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier hs-type">mkFastStringBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-524"></span><span id="mkFastStringBytes"><span class="annot"><span class="annottext">mkFastStringBytes :: Ptr Word8 -&gt; Int -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier hs-var hs-var">mkFastStringBytes</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682452033"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621682452033"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682452034"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452034"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-comment">-- NB: Might as well use unsafeDupablePerformIO, since mkFastStringWith is</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-comment">-- idempotent.</span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><span class="annottext">IO FastString -&gt; FastString
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafeDupablePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO FastString -&gt; FastString) -&gt; IO FastString -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-528"></span><span>        </span><span id="local-6989586621682452036"><span class="annot"><a href="#local-6989586621682452036"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; IO ShortByteString
forall a. Ptr a -&gt; Int -&gt; IO ShortByteString
</span><a href="GHC.Data.FastString.html#newSBSFromPtr"><span class="hs-identifier hs-var">newSBSFromPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621682452033"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452034"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-type">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-type">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452036"><span class="hs-identifier hs-type">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682452036"><span class="hs-identifier hs-type">sbs</span></a></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span id="local-6989586621682451425"><span class="annot"><a href="GHC.Data.FastString.html#newSBSFromPtr"><span class="hs-identifier hs-type">newSBSFromPtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621682451425"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span></span><span>
</span><span id="line-532"></span><span id="newSBSFromPtr"><span class="annot"><span class="annottext">newSBSFromPtr :: forall a. Ptr a -&gt; Int -&gt; IO ShortByteString
</span><a href="GHC.Data.FastString.html#newSBSFromPtr"><span class="hs-identifier hs-var hs-var">newSBSFromPtr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span id="local-6989586621682452039"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452039"><span class="hs-identifier hs-var">src#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682452040"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452040"><span class="hs-identifier hs-var">len#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, ShortByteString #))
-&gt; IO ShortByteString
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, ShortByteString #))
 -&gt; IO ShortByteString)
-&gt; (State# RealWorld -&gt; (# State# RealWorld, ShortByteString #))
-&gt; IO ShortByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682452041"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452041"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int#
-&gt; State# RealWorld
-&gt; (# State# RealWorld, MutableByteArray# RealWorld #)
forall d. Int# -&gt; State# d -&gt; (# State# d, MutableByteArray# d #)
</span><span class="hs-identifier hs-var">newByteArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452040"><span class="hs-identifier hs-var">len#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452041"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682452042"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452042"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682452043"><span class="annot"><span class="annottext">MutableByteArray# RealWorld
</span><a href="#local-6989586621682452043"><span class="hs-identifier hs-var">dst#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Addr#
-&gt; MutableByteArray# RealWorld
-&gt; Int#
-&gt; Int#
-&gt; State# RealWorld
-&gt; State# RealWorld
forall d.
Addr#
-&gt; MutableByteArray# d -&gt; Int# -&gt; Int# -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">copyAddrToByteArray#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452039"><span class="hs-identifier hs-var">src#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld
</span><a href="#local-6989586621682452043"><span class="hs-identifier hs-var">dst#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452040"><span class="hs-identifier hs-var">len#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452042"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682452044"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452044"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld
-&gt; State# RealWorld -&gt; (# State# RealWorld, ByteArray# #)
forall d.
MutableByteArray# d -&gt; State# d -&gt; (# State# d, ByteArray# #)
</span><span class="hs-identifier hs-var">unsafeFreezeByteArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld
</span><a href="#local-6989586621682452043"><span class="hs-identifier hs-var">dst#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452044"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682452045"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452045"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682452046"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621682452046"><span class="hs-identifier hs-var">ba#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682452045"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; ShortByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#SBS"><span class="hs-identifier hs-var">SBS.SBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621682452046"><span class="hs-identifier hs-var">ba#</span></a></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="annot"><span class="hs-comment">-- | Create a 'FastString' by copying an existing 'ByteString'</span></span><span>
</span><span id="line-540"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteString"><span class="hs-identifier hs-type">mkFastStringByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-541"></span><span id="mkFastStringByteString"><span class="annot"><span class="annottext">mkFastStringByteString :: ByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringByteString"><span class="hs-identifier hs-var hs-var">mkFastStringByteString</span></a></span></span><span> </span><span id="local-6989586621682452048"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682452048"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682452049"><span class="annot"><span class="annottext">sbs :: ShortByteString
</span><a href="#local-6989586621682452049"><span class="hs-identifier hs-var hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ShortByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#toShort"><span class="hs-identifier hs-var">SBS.toShort</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682452048"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><span class="annottext">IO FastString -&gt; FastString
forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO FastString -&gt; FastString) -&gt; IO FastString -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-544"></span><span>      </span><span class="annot"><span class="annottext">(Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452049"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452049"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="hs-comment">-- | Create a 'FastString' from an existing 'ShortByteString' without</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- copying.</span><span>
</span><span id="line-548"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-type">mkFastStringShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-549"></span><span id="mkFastStringShortByteString"><span class="annot"><span class="annottext">mkFastStringShortByteString :: ShortByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-var hs-var">mkFastStringShortByteString</span></a></span></span><span> </span><span id="local-6989586621682452051"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452051"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><span class="annottext">IO FastString -&gt; FastString
forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO FastString -&gt; FastString) -&gt; IO FastString -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452051"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452051"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><span class="hs-comment">-- | Creates a UTF-8 encoded 'FastString' from a 'String'</span></span><span>
</span><span id="line-553"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-type">mkFastString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-554"></span><span class="hs-pragma">{-# NOINLINE</span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-pragma hs-type">mkFastString</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-555"></span><span id="mkFastString"><span class="annot"><span class="annottext">mkFastString :: String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var hs-var">mkFastString</span></a></span></span><span> </span><span id="local-6989586621682452052"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682452052"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-556"></span><span>  </span><span class="annot"><span class="annottext">IO FastString -&gt; FastString
forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO FastString -&gt; FastString) -&gt; IO FastString -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682452053"><span class="annot"><span class="annottext">sbs :: ShortByteString
</span><a href="#local-6989586621682452053"><span class="hs-identifier hs-var hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShortByteString
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.UTF8.html#utf8EncodeShortByteString"><span class="hs-identifier hs-var">utf8EncodeShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682452052"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><span class="annottext">(Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452053"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452053"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="hs-comment">-- The following rule is used to avoid polluting the non-reclaimable FastString</span><span>
</span><span id="line-561"></span><span class="hs-comment">-- table with transient strings when we only want their encoding.</span><span>
</span><span id="line-562"></span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-563"></span><span class="annot"><span class="hs-pragma">&quot;bytesFS/mkFastString&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621682452055"><span class="annot"><a href="#local-6989586621682452055"><span class="hs-pragma hs-var">x</span></a></span></span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-pragma hs-type">bytesFS</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-pragma hs-type">mkFastString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452055"><span class="hs-pragma hs-type">x</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.UTF8.html#utf8EncodeByteString"><span class="hs-pragma hs-type">utf8EncodeByteString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452055"><span class="hs-pragma hs-type">x</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="annot"><span class="hs-comment">-- | Creates a 'FastString' from a UTF-8 encoded @[Word8]@</span></span><span>
</span><span id="line-566"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteList"><span class="hs-identifier hs-type">mkFastStringByteList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-567"></span><span id="mkFastStringByteList"><span class="annot"><span class="annottext">mkFastStringByteList :: [Word8] -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringByteList"><span class="hs-identifier hs-var hs-var">mkFastStringByteList</span></a></span></span><span> </span><span id="local-6989586621682452057"><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621682452057"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-var">mkFastStringShortByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word8] -&gt; ShortByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#pack"><span class="hs-identifier hs-var">SBS.pack</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621682452057"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span class="hs-comment">-- | Creates a (lazy) Z-encoded 'FastString' from a 'ShortByteString' and</span><span>
</span><span id="line-570"></span><span class="hs-comment">-- account the number of forced z-strings into the passed 'FastMutInt'.</span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.Data.FastString.html#mkZFastString"><span class="hs-identifier hs-type">mkZFastString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-572"></span><span id="mkZFastString"><span class="annot"><span class="annottext">mkZFastString :: FastMutInt -&gt; ShortByteString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#mkZFastString"><span class="hs-identifier hs-var hs-var">mkZFastString</span></a></span></span><span> </span><span id="local-6989586621682452060"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452060"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span id="local-6989586621682452061"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452061"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO FastZString -&gt; FastZString
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO FastZString -&gt; FastZString) -&gt; IO FastZString -&gt; FastZString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-573"></span><span>  </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; Int -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#atomicFetchAddFastMut"><span class="hs-identifier hs-var">atomicFetchAddFastMut</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452060"><span class="hs-identifier hs-var">n_zencs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-574"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastZStringString"><span class="hs-identifier hs-type">mkFastZStringString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.html#zEncodeString"><span class="hs-identifier hs-type">zEncodeString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.UTF8.html#utf8DecodeShortByteString"><span class="hs-identifier hs-type">utf8DecodeShortByteString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452061"><span class="hs-identifier hs-type">sbs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-type">mkNewFastStringShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-577"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-578"></span><span id="mkNewFastStringShortByteString"><span class="annot"><span class="annottext">mkNewFastStringShortByteString :: ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var hs-var">mkNewFastStringShortByteString</span></a></span></span><span> </span><span id="local-6989586621682452064"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452064"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span id="local-6989586621682452065"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452065"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682452066"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452066"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682452067"><span class="annot"><span class="annottext">zstr :: FastZString
</span><a href="#local-6989586621682452067"><span class="hs-identifier hs-var hs-var">zstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; ShortByteString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#mkZFastString"><span class="hs-identifier hs-var">mkZFastString</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452066"><span class="hs-identifier hs-var">n_zencs</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452064"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-580"></span><span>      </span><span id="local-6989586621682452068"><span class="annot"><span class="annottext">chars :: Int
</span><a href="#local-6989586621682452068"><span class="hs-identifier hs-var hs-var">chars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.UTF8.html#utf8CountCharsShortByteString"><span class="hs-identifier hs-var">utf8CountCharsShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452064"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; IO FastString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ShortByteString -&gt; FastZString -&gt; FastString
</span><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-var">FastString</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452065"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452068"><span class="hs-identifier hs-var">chars</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452064"><span class="hs-identifier hs-var">sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastZString
</span><a href="#local-6989586621682452067"><span class="hs-identifier hs-var">zstr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span class="annot"><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-type">hashStr</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-584"></span><span> </span><span class="hs-comment">-- produce a hash value between 0 &amp; m (inclusive)</span><span>
</span><span id="line-585"></span><span id="hashStr"><span class="annot"><span class="annottext">hashStr :: ShortByteString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-var hs-var">hashStr</span></a></span></span><span> </span><span id="local-6989586621682452070"><span class="annot"><span class="annottext">sbs :: ShortByteString
</span><a href="#local-6989586621682452070"><span class="hs-identifier hs-var">sbs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#SBS"><span class="hs-identifier hs-type">SBS.SBS</span></a></span><span> </span><span id="local-6989586621682452071"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621682452071"><span class="hs-identifier hs-var">ba#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int
</span><a href="#local-6989586621682452072"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span>
</span><span id="line-586"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-587"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682452073"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452073"><span class="hs-identifier hs-var">len#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#length"><span class="hs-identifier hs-var">SBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621682452070"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-588"></span><span>    </span><span id="local-6989586621682452072"><span class="annot"><span class="annottext">loop :: Int# -&gt; Int# -&gt; Int
</span><a href="#local-6989586621682452072"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621682452075"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452075"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682452076"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452076"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-589"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Bool
</span><span class="hs-identifier hs-var">isTrue#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452076"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">==#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452073"><span class="hs-identifier hs-var">len#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-590"></span><span>        </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452075"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-591"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-593"></span><span>          </span><span class="hs-comment">-- DO NOT move this let binding! indexCharOffAddr# reads from the</span><span>
</span><span id="line-594"></span><span>          </span><span class="hs-comment">-- pointer so we need to evaluate this based on the length check</span><span>
</span><span id="line-595"></span><span>          </span><span class="hs-comment">-- above. Not doing this right caused #17909.</span><span>
</span><span id="line-596"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621682452077"><span class="annot"><span class="annottext">c :: Int#
</span><a href="#local-6989586621682452077"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int8# -&gt; Int#
</span><span class="hs-identifier hs-var">int8ToInt#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray# -&gt; Int# -&gt; Int8#
</span><span class="hs-identifier hs-var">indexInt8Array#</span></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621682452071"><span class="hs-identifier hs-var">ba#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452076"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621682452078"><span class="annot"><span class="annottext">h2 :: Int#
</span><a href="#local-6989586621682452078"><span class="hs-identifier hs-var hs-var">h2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452075"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">*#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">16777619#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`xorI#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452077"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-599"></span><span>          </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int
</span><a href="#local-6989586621682452072"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452078"><span class="hs-identifier hs-var">h2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452076"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">+#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-602"></span><span class="hs-comment">-- Operations</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="annot"><span class="hs-comment">-- | Returns the length of the 'FastString' in characters</span></span><span>
</span><span id="line-605"></span><span class="annot"><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier hs-type">lengthFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-606"></span><span id="lengthFS"><span class="annot"><span class="annottext">lengthFS :: FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier hs-var hs-var">lengthFS</span></a></span></span><span> </span><span id="local-6989586621682452079"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452079"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#n_chars"><span class="hs-identifier hs-var">n_chars</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452079"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="annot"><span class="hs-comment">-- | Returns @True@ if the 'FastString' is empty</span></span><span>
</span><span id="line-609"></span><span class="annot"><a href="GHC.Data.FastString.html#nullFS"><span class="hs-identifier hs-type">nullFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-610"></span><span id="nullFS"><span class="annot"><span class="annottext">nullFS :: FastString -&gt; Bool
</span><a href="GHC.Data.FastString.html#nullFS"><span class="hs-identifier hs-var hs-var">nullFS</span></a></span></span><span> </span><span id="local-6989586621682452080"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452080"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Bool
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Short.Internal.html#null"><span class="hs-identifier hs-var">SBS.null</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Bool) -&gt; ShortByteString -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452080"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span class="annot"><span class="hs-comment">-- | Lazily unpacks and decodes the FastString</span></span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-type">unpackFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-614"></span><span id="unpackFS"><span class="annot"><span class="annottext">unpackFS :: FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var hs-var">unpackFS</span></a></span></span><span> </span><span id="local-6989586621682452082"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452082"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; String
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Utils.Encoding.UTF8.html#utf8DecodeShortByteString"><span class="hs-identifier hs-var">utf8DecodeShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; String) -&gt; ShortByteString -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452082"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="hs-comment">-- | Returns a Z-encoded version of a 'FastString'.  This might be the</span><span>
</span><span id="line-617"></span><span class="hs-comment">-- original, if it was already Z-encoded.  The first time this</span><span>
</span><span id="line-618"></span><span class="hs-comment">-- function is applied to a particular 'FastString', the results are</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- memoized.</span><span>
</span><span id="line-620"></span><span class="hs-comment">--</span><span>
</span><span id="line-621"></span><span class="annot"><a href="GHC.Data.FastString.html#zEncodeFS"><span class="hs-identifier hs-type">zEncodeFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-622"></span><span id="zEncodeFS"><span class="annot"><span class="annottext">zEncodeFS :: FastString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#zEncodeFS"><span class="hs-identifier hs-var hs-var">zEncodeFS</span></a></span></span><span> </span><span id="local-6989586621682452083"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452083"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#fs_zenc"><span class="hs-identifier hs-var">fs_zenc</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452083"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="annot"><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier hs-type">appendFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-625"></span><span id="appendFS"><span class="annot"><span class="annottext">appendFS :: FastString -&gt; FastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier hs-var hs-var">appendFS</span></a></span></span><span> </span><span id="local-6989586621682452084"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452084"><span class="hs-identifier hs-var">fs1</span></a></span></span><span> </span><span id="local-6989586621682452085"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452085"><span class="hs-identifier hs-var">fs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-var">mkFastStringShortByteString</span></a></span><span>
</span><span id="line-626"></span><span>                 </span><span class="annot"><span class="annottext">(ShortByteString -&gt; FastString) -&gt; ShortByteString -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ShortByteString -&gt; ShortByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(Semi.&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452084"><span class="hs-identifier hs-var">fs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452085"><span class="hs-identifier hs-var">fs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier hs-type">concatFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-629"></span><span id="concatFS"><span class="annot"><span class="annottext">concatFS :: [FastString] -&gt; FastString
</span><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier hs-var hs-var">concatFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-var">mkFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; FastString)
-&gt; ([FastString] -&gt; ShortByteString) -&gt; [FastString] -&gt; FastString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ShortByteString] -&gt; ShortByteString
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([ShortByteString] -&gt; ShortByteString)
-&gt; ([FastString] -&gt; [ShortByteString])
-&gt; [FastString]
-&gt; ShortByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; ShortByteString)
-&gt; [FastString] -&gt; [ShortByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span class="annot"><a href="GHC.Data.FastString.html#consFS"><span class="hs-identifier hs-type">consFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-632"></span><span id="consFS"><span class="annot"><span class="annottext">consFS :: Char -&gt; FastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#consFS"><span class="hs-identifier hs-var hs-var">consFS</span></a></span></span><span> </span><span id="local-6989586621682452086"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682452086"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682452087"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452087"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682452086"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ShowS
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452087"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span class="annot"><a href="GHC.Data.FastString.html#unconsFS"><span class="hs-identifier hs-type">unconsFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span id="unconsFS"><span class="annot"><span class="annottext">unconsFS :: FastString -&gt; Maybe (Char, FastString)
</span><a href="GHC.Data.FastString.html#unconsFS"><span class="hs-identifier hs-var hs-var">unconsFS</span></a></span></span><span> </span><span id="local-6989586621682452088"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452088"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452088"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Char, FastString)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-638"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682452089"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682452089"><span class="hs-identifier hs-var">chr</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682452090"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682452090"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Char, FastString) -&gt; Maybe (Char, FastString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682452089"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682452090"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span class="annot"><a href="GHC.Data.FastString.html#uniqueOfFS"><span class="hs-identifier hs-type">uniqueOfFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-641"></span><span id="uniqueOfFS"><span class="annot"><span class="annottext">uniqueOfFS :: FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniqueOfFS"><span class="hs-identifier hs-var hs-var">uniqueOfFS</span></a></span></span><span> </span><span id="local-6989586621682452091"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452091"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452091"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span class="annot"><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier hs-type">nilFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-644"></span><span id="nilFS"><span class="annot"><span class="annottext">nilFS :: FastString
</span><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier hs-var hs-var">nilFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-647"></span><span class="hs-comment">-- Stats</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringTable"><span class="hs-identifier hs-type">getFastStringTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span id="getFastStringTable"><span class="annot"><span class="annottext">getFastStringTable :: IO [[[FastString]]]
</span><a href="GHC.Data.FastString.html#getFastStringTable"><span class="hs-identifier hs-var hs-var">getFastStringTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; IO [[FastString]]) -&gt; IO [[[FastString]]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-var">numSegments</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; IO [[FastString]]) -&gt; IO [[[FastString]]])
-&gt; (Int -&gt; IO [[FastString]]) -&gt; IO [[[FastString]]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682452093"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452093"><span class="hs-identifier hs-var">i#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-652"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682452094"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682452094"><span class="hs-identifier hs-var hs-var">segmentRef</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
-&gt; Int# -&gt; (# IORef FastStringTableSegment #)
forall a. Array# a -&gt; Int# -&gt; (# a #)
</span><span class="hs-identifier hs-var">indexArray#</span></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621682452095"><span class="hs-identifier hs-var">segments#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452093"><span class="hs-identifier hs-var">i#</span></a></span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682452096"><span class="annot"><a href="#local-6989586621682452096"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment -&gt; IO FastStringTableSegment
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621682452094"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-654"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682452097"><span class="annot"><a href="#local-6989586621682452097"><span class="hs-identifier hs-var hs-var">bucketSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int#
forall d a. MutableArray# d a -&gt; Int#
</span><span class="hs-identifier hs-var">sizeofMutableArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682452096"><span class="hs-identifier hs-var">buckets#</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><a href="#local-6989586621682452097"><span class="hs-identifier hs-type">bucketSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682452098"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452098"><span class="hs-identifier hs-var">j#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-656"></span><span>      </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, [FastString] #))
-&gt; IO [FastString]
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, [FastString] #))
 -&gt; IO [FastString])
-&gt; (State# RealWorld -&gt; (# State# RealWorld, [FastString] #))
-&gt; IO [FastString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
-&gt; Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, [FastString] #)
forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621682452096"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452098"><span class="hs-identifier hs-var">j#</span></a></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682452095"><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621682452095"><span class="hs-identifier hs-var">segments#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var">stringTable</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringZEncCounter"><span class="hs-identifier hs-type">getFastStringZEncCounter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-661"></span><span id="getFastStringZEncCounter"><span class="annot"><span class="annottext">getFastStringZEncCounter :: IO Int
</span><a href="GHC.Data.FastString.html#getFastStringZEncCounter"><span class="hs-identifier hs-var hs-var">getFastStringZEncCounter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#readFastMutInt"><span class="hs-identifier hs-var">readFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452099"><span class="hs-identifier hs-var">n_zencs</span></a></span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-663"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682452099"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621682452099"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var">stringTable</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-666"></span><span class="hs-comment">-- Outputting 'FastString's</span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="hs-comment">-- |Outputs a 'FastString' with /no decoding at all/, that is, you</span><span>
</span><span id="line-669"></span><span class="hs-comment">-- get the actual bytes in the 'FastString' written to the 'Handle'.</span><span>
</span><span id="line-670"></span><span class="annot"><a href="GHC.Data.FastString.html#hPutFS"><span class="hs-identifier hs-type">hPutFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span id="hPutFS"><span class="annot"><span class="annottext">hPutFS :: Handle -&gt; FastString -&gt; IO ()
</span><a href="GHC.Data.FastString.html#hPutFS"><span class="hs-identifier hs-var hs-var">hPutFS</span></a></span></span><span> </span><span id="local-6989586621682452100"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682452100"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621682452101"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452101"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#hPut"><span class="hs-identifier hs-var">BS.hPut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682452100"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; ByteString -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-var">bytesFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682452101"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="hs-comment">-- ToDo: we'll probably want an hPutFSLocal, or something, to output</span><span>
</span><span id="line-674"></span><span class="hs-comment">-- in the current locale's encoding (for error messages and suchlike).</span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-677"></span><span class="hs-comment">-- PtrStrings, here for convenience only.</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="annot"><span class="hs-comment">-- | A 'PtrString' is a pointer to some array of Latin-1 encoded chars.</span></span><span>
</span><span id="line-680"></span><span class="hs-keyword">data</span><span> </span><span id="PtrString"><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-var">PtrString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PtrString"><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-var">PtrString</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="annot"><span class="hs-comment">-- | Wrap an unboxed address into a 'PtrString'.</span></span><span>
</span><span id="line-683"></span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-identifier hs-type">mkPtrString#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Addr#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span>
</span><span id="line-684"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-pragma hs-type">mkPtrString#</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-685"></span><span id="mkPtrString%23"><span class="annot"><span class="annottext">mkPtrString# :: Addr# -&gt; PtrString
</span><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-identifier hs-var hs-var">mkPtrString#</span></a></span></span><span> </span><span id="local-6989586621682452102"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452102"><span class="hs-identifier hs-var">a#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; PtrString
</span><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-var">PtrString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr# -&gt; Ptr Word8
forall a. Addr# -&gt; Ptr a
</span><span class="hs-identifier hs-var">Ptr</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452102"><span class="hs-identifier hs-var">a#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int
</span><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-var">ptrStrLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr# -&gt; Ptr Word8
forall a. Addr# -&gt; Ptr a
</span><span class="hs-identifier hs-var">Ptr</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452102"><span class="hs-identifier hs-var">a#</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="hs-comment">-- | Decode a 'PtrString' back into a 'String' using Latin-1 encoding.</span><span>
</span><span id="line-688"></span><span class="hs-comment">-- This does not free the memory associated with 'PtrString'.</span><span>
</span><span id="line-689"></span><span class="annot"><a href="GHC.Data.FastString.html#unpackPtrString"><span class="hs-identifier hs-type">unpackPtrString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-690"></span><span id="unpackPtrString"><span class="annot"><span class="annottext">unpackPtrString :: PtrString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackPtrString"><span class="hs-identifier hs-var hs-var">unpackPtrString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span id="local-6989586621682452103"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452103"><span class="hs-identifier hs-var">p#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682452104"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452104"><span class="hs-identifier hs-var">n#</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; String
</span><span class="hs-identifier hs-var">unpackNBytes#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452103"><span class="hs-identifier hs-var">p#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452104"><span class="hs-identifier hs-var">n#</span></a></span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-comment">-- | @unpackPtrStringTakeN n = 'take' n . 'unpackPtrString'@</span><span>
</span><span id="line-693"></span><span class="hs-comment">-- but is performed in \(O(\min(n,l))\) rather than \(O(l)\),</span><span>
</span><span id="line-694"></span><span class="hs-comment">-- where \(l\) is the length of the 'PtrString'.</span><span>
</span><span id="line-695"></span><span class="annot"><a href="GHC.Data.FastString.html#unpackPtrStringTakeN"><span class="hs-identifier hs-type">unpackPtrStringTakeN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-696"></span><span id="unpackPtrStringTakeN"><span class="annot"><span class="annottext">unpackPtrStringTakeN :: Int -&gt; PtrString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackPtrStringTakeN"><span class="hs-identifier hs-var hs-var">unpackPtrStringTakeN</span></a></span></span><span> </span><span id="local-6989586621682452106"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452106"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span id="local-6989586621682452107"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452107"><span class="hs-identifier hs-var">p#</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682452108"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452108"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452108"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682452109"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452109"><span class="hs-identifier hs-var">n#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; String
</span><span class="hs-identifier hs-var">unpackNBytes#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452107"><span class="hs-identifier hs-var">p#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682452109"><span class="hs-identifier hs-var">n#</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><span class="hs-comment">-- | Return the length of a 'PtrString'</span></span><span>
</span><span id="line-701"></span><span class="annot"><a href="GHC.Data.FastString.html#lengthPS"><span class="hs-identifier hs-type">lengthPS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-702"></span><span id="lengthPS"><span class="annot"><span class="annottext">lengthPS :: PtrString -&gt; Int
</span><a href="GHC.Data.FastString.html#lengthPS"><span class="hs-identifier hs-var hs-var">lengthPS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682452110"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452110"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682452110"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-705"></span><span class="hs-comment">-- under the carpet</span><span class="hs-cpp">

#if !MIN_VERSION_GLASGOW_HASKELL(9,0,0,0)
</span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;strlen&quot;</span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-identifier">cstringLength#</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Addr#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int#</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-712"></span><span class="annot"><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-type">ptrStrLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-713"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-pragma hs-type">ptrStrLength</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-714"></span><span id="ptrStrLength"><span class="annot"><span class="annottext">ptrStrLength :: Ptr Word8 -&gt; Int
</span><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-var hs-var">ptrStrLength</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span id="local-6989586621682452111"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452111"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr# -&gt; Int#
</span><span class="hs-identifier hs-var">cstringLength#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682452111"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-pragma hs-type">fsLit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-717"></span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-718"></span><span id="fsLit"><span class="annot"><span class="annottext">fsLit :: String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var hs-var">fsLit</span></a></span></span><span> </span><span id="local-6989586621682452112"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682452112"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682452112"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;fslit&quot;</span></span><span>
</span><span id="line-721"></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621682452113"><span class="annot"><a href="#local-6989586621682452113"><span class="hs-pragma hs-var">x</span></a></span></span><span> </span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-pragma hs-type">fsLit</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">unpackCString#</span></span><span> </span><span class="annot"><a href="#local-6989586621682452113"><span class="hs-pragma hs-type">x</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-pragma hs-type">mkFastString#</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682452113"><span class="hs-pragma hs-type">x</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-722"></span></pre></body></html>