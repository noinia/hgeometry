<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html"><span class="hs-identifier">GHC.Tc.Gen.Bind</span></a></span><span>
</span><span id="line-15"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier">tcLocalBinds</span></a></span><span>
</span><span id="line-16"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcTopBinds"><span class="hs-identifier">tcTopBinds</span></a></span><span>
</span><span id="line-17"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcValBinds"><span class="hs-identifier">tcValBinds</span></a></span><span>
</span><span id="line-18"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcHsBootSigs"><span class="hs-identifier">tcHsBootSigs</span></a></span><span>
</span><span id="line-19"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcPolyCheck"><span class="hs-identifier">tcPolyCheck</span></a></span><span>
</span><span id="line-20"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier">chooseInferredQuantifiers</span></a></span><span>
</span><span id="line-21"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html"><span class="hs-identifier">GHC.Tc.Gen.Match</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGRHSsPat"><span class="hs-identifier">tcGRHSsPat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcFunBindMatches"><span class="hs-identifier">tcFunBindMatches</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier">tcCheckMonoExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html"><span class="hs-identifier">GHC.Tc.TyCl.PatSyn</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html#tcPatSynDecl"><span class="hs-identifier">tcPatSynDecl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html#tcPatSynBuilderBind"><span class="hs-identifier">tcPatSynBuilderBind</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier">CoreTickish</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#GenTickish"><span class="hs-identifier">GenTickish</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.CostCentre.html#mkUserCC"><span class="hs-identifier">mkUserCC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#mkDeclCCFlavour"><span class="hs-identifier">mkDeclCCFlavour</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html"><span class="hs-identifier">GHC.Rename.Bind</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rejectBootDecls"><span class="hs-identifier">rejectBootDecls</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html"><span class="hs-identifier">GHC.Tc.Gen.Sig</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html"><span class="hs-identifier">GHC.Tc.Utils.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#bottomUE"><span class="hs-identifier">bottomUE</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html"><span class="hs-identifier">GHC.Tc.Gen.Pat</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier">tcGetFamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html"><span class="hs-identifier">GHC.Tc.Validity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier">checkValidType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkEscapingKind"><span class="hs-identifier">checkEscapingKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html"><span class="hs-identifier">GHC.Core.Reduction</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier">Reduction</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#normaliseType"><span class="hs-identifier">normaliseType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier">Class</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier">mkSymCo</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier">mkStrLitTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier">tidyOpenTypeX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier">mkCastTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier">pprTyVars</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#mkConstraintTupleTy"><span class="hs-identifier">mkConstraintTupleTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier">multiplicityTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#oneDataConTy"><span class="hs-identifier">oneDataConTy</span></a></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Var</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TyVarEnv"><span class="hs-identifier">TyVarEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier">mkVarEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier">lookupVarEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#ipClassName"><span class="hs-identifier">ipClassName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html"><span class="hs-identifier">GHC.Data.Graph.Directed</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Type-checking bindings}
*                                                                      *
************************************************************************

@tcBindsAndThen@ typechecks a @HsBinds@.  The &quot;and then&quot; part is because
it needs to know something about the {\em usage} of the things bound,
so that it can create specialisations of them.  So @tcBindsAndThen@
takes a function which, given an extended environment, E, typechecks
the scope of the bindings returning a typechecked thing and (most
important) an LIE.  It is this LIE which is then used as the basis for
specialising the things bound.

@tcBindsAndThen@ also takes a &quot;combiner&quot; which glues together the
bindings and the &quot;thing&quot; to make a new &quot;thing&quot;.

The real work is done by @tcBindWithSigsAndThen@.

Recursive and non-recursive binds are handled in essentially the same
way: because of uniques there are no scoping issues left.  The only
difference is that non-recursive bindings can bind primitive values.

Even for non-recursive binding groups we add typings for each binder
to the LVE for the following reason.  When each individual binding is
checked the type of its LHS is unified with that of its RHS; and
type-checking the LHS of course requires that the binder is in scope.

At the top-level the LIE is sure to contain nothing but constant
dictionaries, which we resolve at the module level.

Note [Polymorphic recursion]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The game plan for polymorphic recursion in the code above is

        * Bind any variable for which we have a type signature
          to an Id with a polymorphic type.  Then when type-checking
          the RHSs we'll make a full polymorphic call.

This fine, but if you aren't a bit careful you end up with a horrendous
amount of partial application and (worse) a huge space leak. For example:

        f :: Eq a =&gt; [a] -&gt; [a]
        f xs = ...f...

If we don't take care, after typechecking we get

        f = /\a -&gt; \d::Eq a -&gt; let f' = f a d
                               in
                               \ys:[a] -&gt; ...f'...

Notice the stupid construction of (f a d), which is of course
identical to the function we're executing.  In this case, the
polymorphic recursion isn't being used (but that's a very common case).
This can lead to a massive space leak, from the following top-level defn
(post-typechecking)

        ff :: [Int] -&gt; [Int]
        ff = f Int dEqInt

Now (f dEqInt) evaluates to a lambda that has f' as a free variable; but
f' is another thunk which evaluates to the same thing... and you end
up with a chain of identical values all hung onto by the CAF ff.

        ff = f Int dEqInt

           = let f' = f Int dEqInt in \ys. ...f'...

           = let f' = let f' = f Int dEqInt in \ys. ...f'...
                      in \ys. ...f'...

Etc.

NOTE: a bit of arity analysis would push the (f a d) inside the (\ys...),
which would make the space leak go away in this case

Solution: when typechecking the RHSs we always have in hand the
*monomorphic* Ids for each binding.  So we just need to make sure that
if (Method f a d) shows up in the constraints emerging from (...f...)
we just use the monomorphic Id.  We achieve this by adding monomorphic Ids
to the &quot;givens&quot; when simplifying constraints.  That's what the &quot;lies_avail&quot;
is doing.

Then we get

        f = /\a -&gt; \d::Eq a -&gt; letrec
                                 fm = \ys:[a] -&gt; ...fm...
                               in
                               fm
-}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcTopBinds"><span class="hs-identifier hs-type">tcTopBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- The TcGblEnv contains the new tcg_binds and tcg_spects</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- The TcLclEnv has an extended type envt for the new bindings</span><span>
</span><span id="line-193"></span><span id="tcTopBinds"><span class="annot"><span class="annottext">tcTopBinds :: [(RecFlag, LHsBinds GhcRn)]
-&gt; [LSig GhcRn] -&gt; TcM (TcGblEnv, TcLclEnv)
</span><a href="GHC.Tc.Gen.Bind.html#tcTopBinds"><span class="hs-identifier hs-var hs-var">tcTopBinds</span></a></span></span><span> </span><span id="local-6989586621683083128"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083128"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621683083129"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083129"><span class="hs-identifier hs-var">sigs</span></a></span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Pattern synonym bindings populate the global environment</span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683083130"><span class="annot"><a href="#local-6989586621683083130"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083131"><span class="annot"><a href="#local-6989586621683083131"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083132"><span class="annot"><a href="#local-6989586621683083132"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083133"><span class="annot"><a href="#local-6989586621683083133"><span class="hs-identifier hs-var">tcl_env</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; [(RecFlag, LHsBinds GhcRn)]
-&gt; [LSig GhcRn]
-&gt; TcM (TcGblEnv, TcLclEnv)
-&gt; TcM
     ([(RecFlag, LHsBinds GhcTc)], HsWrapper, (TcGblEnv, TcLclEnv))
forall thing.
TopLevelFlag
-&gt; [(RecFlag, LHsBinds GhcRn)]
-&gt; [LSig GhcRn]
-&gt; TcM thing
-&gt; TcM ([(RecFlag, LHsBinds GhcTc)], HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcValBinds"><span class="hs-identifier hs-var">tcValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#TopLevel"><span class="hs-identifier hs-var">TopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083128"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083129"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM (TcGblEnv, TcLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#isIdHsWrapper"><span class="hs-identifier hs-type">isIdHsWrapper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083131"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Non-identity multiplicity wrapper at toplevel:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083131"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>          </span><span class="hs-comment">-- The wrapper (`wrap`) is always the identity because toplevel</span><span>
</span><span id="line-199"></span><span>          </span><span class="hs-comment">-- binders are unrestricted (and `tcSubmult _ ManyTy` returns the</span><span>
</span><span id="line-200"></span><span>          </span><span class="hs-comment">-- identity wrapper). Therefore it's safe to drop it altogether.</span><span>
</span><span id="line-201"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-comment">-- See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083141"><span class="annot"><a href="#local-6989586621683083141"><span class="hs-identifier hs-var">specs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#tcImpPrags"><span class="hs-identifier hs-type">tcImpPrags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083129"><span class="hs-identifier hs-type">sigs</span></a></span><span>   </span><span class="hs-comment">-- SPECIALISE prags for imported Ids</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083143"><span class="annot"><a href="#local-6989586621683083143"><span class="hs-identifier hs-var hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683083132"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imp_specs"><span class="hs-identifier hs-var">tcg_imp_specs</span></a></span><span>
</span><span id="line-207"></span><span>                                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083141"><span class="hs-identifier hs-type">specs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imp_specs"><span class="hs-identifier hs-var">tcg_imp_specs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083132"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>                           </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [LHsBinds GhcTc] -&gt; TcGblEnv
</span><a href="GHC.Tc.Utils.Env.html#addTypecheckedBinds"><span class="hs-operator hs-var">`addTypecheckedBinds`</span></a></span><span> </span><span class="annot"><span class="annottext">((RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])
 -&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])
-&gt; [(RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])]
-&gt; [[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])]
</span><a href="#local-6989586621683083130"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083143"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083133"><span class="hs-identifier hs-type">tcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-comment">-- The top level bindings are flattened into a giant</span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-comment">-- implicitly-mutually-recursive LHsBinds</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcHsBootSigs"><span class="hs-identifier hs-type">tcHsBootSigs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- A hs-boot file has only one BindGroup, and it only has type</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- signatures in it.  The renamer checked all this.</span><span>
</span><span id="line-217"></span><span id="tcHsBootSigs"><span class="annot"><span class="annottext">tcHsBootSigs :: [(RecFlag, LHsBinds GhcRn)] -&gt; [LSig GhcRn] -&gt; TcM [TcId]
</span><a href="GHC.Tc.Gen.Bind.html#tcHsBootSigs"><span class="hs-identifier hs-var hs-var">tcHsBootSigs</span></a></span></span><span> </span><span id="local-6989586621683083148"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083148"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621683083149"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083149"><span class="hs-identifier hs-var">sigs</span></a></span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
[(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])]
</span><a href="#local-6989586621683083148"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-219"></span><span>            </span><span class="annot"><span class="annottext">HsBootOrSig
-&gt; (NonEmpty (GenLocated SrcSpanAnnA (HsBind GhcRn))
    -&gt; BadBootDecls)
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall decl.
HsBootOrSig
-&gt; (NonEmpty (LocatedA decl) -&gt; BadBootDecls)
-&gt; [LocatedA decl]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Bind.html#rejectBootDecls"><span class="hs-identifier hs-var">rejectBootDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#HsBoot"><span class="hs-identifier hs-var">HsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LHsBindLR GhcRn GhcRn) -&gt; BadBootDecls
NonEmpty (GenLocated SrcSpanAnnA (HsBind GhcRn)) -&gt; BadBootDecls
</span><a href="GHC.Tc.Errors.Types.html#BootBindsRn"><span class="hs-identifier hs-var">BootBindsRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])
 -&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)])
-&gt; [(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])]
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
[(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])]
</span><a href="#local-6989586621683083148"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Sig GhcRn) -&gt; TcM [TcId])
-&gt; [GenLocated SrcSpanAnnA (Sig GhcRn)] -&gt; TcM [TcId]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Sig GhcRn -&gt; TcM [TcId])
-&gt; GenLocated SrcSpanAnnA (Sig GhcRn) -&gt; TcM [TcId]
forall t a b. HasLoc t =&gt; (a -&gt; TcM b) -&gt; GenLocated t a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a></span><span> </span><span class="annot"><span class="annottext">Sig GhcRn -&gt; TcM [TcId]
</span><a href="#local-6989586621683083157"><span class="hs-identifier hs-var">tc_boot_sig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Sig GhcRn) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (Sig GhcRn)]
-&gt; [GenLocated SrcSpanAnnA (Sig GhcRn)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">LSig GhcRn -&gt; Bool
GenLocated SrcSpanAnnA (Sig GhcRn) -&gt; Bool
forall p. UnXRec p =&gt; LSig p -&gt; Bool
</span><a href="Language.Haskell.Syntax.Binds.html#isTypeLSig"><span class="hs-identifier hs-var">isTypeLSig</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
[GenLocated SrcSpanAnnA (Sig GhcRn)]
</span><a href="#local-6989586621683083149"><span class="hs-identifier hs-var">sigs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621683083157"><span class="annot"><span class="annottext">tc_boot_sig :: Sig GhcRn -&gt; TcM [TcId]
</span><a href="#local-6989586621683083157"><span class="hs-identifier hs-var hs-var">tc_boot_sig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#TypeSig"><span class="hs-identifier hs-type">TypeSig</span></a></span><span> </span><span class="annot"><span class="annottext">XTypeSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083178"><span class="annot"><span class="annottext">[LIdP GhcRn]
</span><a href="#local-6989586621683083178"><span class="hs-identifier hs-var">lnames</span></a></span></span><span> </span><span id="local-6989586621683083179"><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621683083179"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnN Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId)
-&gt; [GenLocated SrcSpanAnnN Name] -&gt; TcM [TcId]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
</span><a href="#local-6989586621683083181"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[LIdP GhcRn]
[GenLocated SrcSpanAnnN Name]
</span><a href="#local-6989586621683083178"><span class="hs-identifier hs-var">lnames</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>        </span><span id="local-6989586621683083181"><span class="annot"><span class="annottext">f :: GenLocated SrcSpanAnnN Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
</span><a href="#local-6989586621683083181"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083183"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083183"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083184"><span class="annot"><a href="#local-6989586621683083184"><span class="hs-identifier hs-var">sigma_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigWcType GhcRn -&gt; TcM Kind
</span><a href="GHC.Tc.Gen.HsType.html#tcHsSigWcType"><span class="hs-identifier hs-var">tcHsSigWcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ReportRedundantConstraints -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083183"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ReportRedundantConstraints
</span><a href="GHC.Tc.Types.Origin.html#NoRRC"><span class="hs-identifier hs-var">NoRRC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621683083179"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-226"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#mkVanillaGlobal"><span class="hs-identifier hs-type">mkVanillaGlobal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083183"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083184"><span class="hs-identifier hs-type">sigma_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-comment">-- Notice that we make GlobalIds, not LocalIds</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="#local-6989586621683083157"><span class="hs-identifier hs-var">tc_boot_sig</span></a></span><span> </span><span id="local-6989586621683083189"><span class="annot"><span class="annottext">Sig GhcRn
</span><a href="#local-6989586621683083189"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM [TcId]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcHsBootSigs/tc_boot_sig&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sig GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Sig GhcRn
</span><a href="#local-6989586621683083189"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">-- Why an HsWrapper? See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-233"></span><span id="local-6989586621683082415"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-type">tcLocalBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsLocalBinds"><span class="hs-identifier hs-type">HsLocalBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082415"><span class="hs-identifier hs-type">thing</span></a></span><span>
</span><span id="line-234"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsLocalBinds"><span class="hs-identifier hs-type">HsLocalBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082415"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span id="tcLocalBinds"><span class="annot"><span class="annottext">tcLocalBinds :: forall thing.
HsLocalBinds GhcRn
-&gt; TcM thing -&gt; TcM (HsLocalBinds GhcTc, HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var hs-var">tcLocalBinds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#EmptyLocalBinds"><span class="hs-identifier hs-type">EmptyLocalBinds</span></a></span><span> </span><span id="local-6989586621683083209"><span class="annot"><span class="annottext">XEmptyLocalBinds GhcRn GhcRn
</span><a href="#local-6989586621683083209"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683083210"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083210"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083211"><span class="annot"><a href="#local-6989586621683083211"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083210"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#EmptyLocalBinds"><span class="hs-identifier hs-type">EmptyLocalBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083209"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083211"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span id="local-6989586621683083214"><span class="annot"><span class="annottext">XHsValBinds GhcRn GhcRn
</span><a href="#local-6989586621683083214"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-type">XValBindsLR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-type">NValBinds</span></a></span><span> </span><span id="local-6989586621683083217"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083217"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621683083218"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083218"><span class="hs-identifier hs-var">sigs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683083219"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083219"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083220"><span class="annot"><a href="#local-6989586621683083220"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083221"><span class="annot"><a href="#local-6989586621683083221"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083222"><span class="annot"><a href="#local-6989586621683083222"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; [(RecFlag, LHsBinds GhcRn)]
-&gt; [LSig GhcRn]
-&gt; TcM thing
-&gt; TcM ([(RecFlag, LHsBinds GhcTc)], HsWrapper, thing)
forall thing.
TopLevelFlag
-&gt; [(RecFlag, LHsBinds GhcRn)]
-&gt; [LSig GhcRn]
-&gt; TcM thing
-&gt; TcM ([(RecFlag, LHsBinds GhcTc)], HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcValBinds"><span class="hs-identifier hs-var">tcValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083217"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083218"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083219"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083214"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-type">XValBindsLR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-type">NValBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083220"><span class="hs-identifier hs-type">binds'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083218"><span class="hs-identifier hs-type">sigs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083221"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083222"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XHsValBinds GhcRn GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#ValBinds"><span class="hs-identifier hs-type">ValBinds</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM thing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (HsLocalBinds GhcTc, HsWrapper, thing)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcLocalBinds&quot;</span></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsIPBinds"><span class="hs-identifier hs-type">HsIPBinds</span></a></span><span> </span><span id="local-6989586621683083227"><span class="annot"><span class="annottext">XHsIPBinds GhcRn GhcRn
</span><a href="#local-6989586621683083227"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#IPBinds"><span class="hs-identifier hs-type">IPBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XIPBinds GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083229"><span class="annot"><span class="annottext">[LIPBind GhcRn]
</span><a href="#local-6989586621683083229"><span class="hs-identifier hs-var">ip_binds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683083230"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083230"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083231"><span class="annot"><a href="#local-6989586621683083231"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083233"><span class="annot"><a href="#local-6989586621683083233"><span class="hs-identifier hs-var">given_ips</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083234"><span class="annot"><a href="#local-6989586621683083234"><span class="hs-identifier hs-var">ip_binds'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">mapAndUnzipM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocSndMA"><span class="hs-identifier hs-type">wrapLocSndMA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083237"><span class="hs-identifier hs-type">tc_ip_bind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083231"><span class="hs-identifier hs-type">ipClass</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083229"><span class="hs-identifier hs-type">ip_binds</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-comment">-- Add all the IP bindings as givens for the body of the 'let'</span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083238"><span class="annot"><a href="#local-6989586621683083238"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083239"><span class="annot"><a href="#local-6989586621683083239"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#checkConstraints"><span class="hs-identifier hs-type">checkConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#IPSkol"><span class="hs-identifier hs-type">IPSkol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083242"><span class="hs-identifier hs-type">ips</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>                                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683083233"><span class="hs-identifier hs-type">given_ips</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083230"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-comment">-- We don't have linear implicit parameters, yet. So the wrapper can be</span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-comment">-- the identity.</span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-comment">-- See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsIPBinds"><span class="hs-identifier hs-type">HsIPBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083227"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#IPBinds"><span class="hs-identifier hs-type">IPBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083238"><span class="hs-identifier hs-type">ev_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083234"><span class="hs-identifier hs-type">ip_binds'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083239"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621683083242"><span class="annot"><span class="annottext">ips :: [HsIPName]
</span><a href="#local-6989586621683083242"><span class="hs-identifier hs-var hs-var">ips</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683083243"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#IPBind"><span class="hs-identifier hs-type">IPBind</span></a></span><span> </span><span class="annot"><span class="annottext">XCIPBind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083243"><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683083243"><span class="hs-identifier hs-var">ip</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LIPBind GhcRn]
[GenLocated SrcSpanAnnA (IPBind GhcRn)]
</span><a href="#local-6989586621683083229"><span class="hs-identifier hs-var">ip_binds</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-comment">-- I wonder if we should do these one at a time</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-comment">-- Consider     ?x = 4</span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-comment">--              ?y = ?x + 1</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621683083237"><span class="hs-identifier hs-type">tc_ip_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#IPBind"><span class="hs-identifier hs-type">IPBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#DictId"><span class="hs-identifier hs-type">DictId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#IPBind"><span class="hs-identifier hs-type">IPBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621683083237"><span class="annot"><span class="annottext">tc_ip_bind :: Class -&gt; IPBind GhcRn -&gt; TcM (TcId, IPBind GhcTc)
</span><a href="#local-6989586621683083237"><span class="hs-identifier hs-var hs-var">tc_ip_bind</span></a></span></span><span> </span><span id="local-6989586621683083246"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683083246"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#IPBind"><span class="hs-identifier hs-type">IPBind</span></a></span><span> </span><span class="annot"><span class="annottext">XCIPBind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083247"><span class="annot"><span class="annottext">l_name :: XRec GhcRn HsIPName
</span><a href="#local-6989586621683083247"><span class="hs-identifier hs-var">l_name</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083248"><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683083248"><span class="hs-identifier hs-var">ip</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683083249"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621683083249"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083250"><span class="annot"><a href="#local-6989586621683083250"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; TcM Kind
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>  </span><span class="hs-comment">-- see #24298</span><span>
</span><span id="line-267"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083253"><span class="annot"><a href="#local-6989586621683083253"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Kind
</span><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; Kind) -&gt; FastString -&gt; Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsIPName -&gt; FastString
</span><a href="Language.Haskell.Syntax.Type.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683083248"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083255"><span class="annot"><a href="#local-6989586621683083255"><span class="hs-identifier hs-var">ip_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newDict"><span class="hs-identifier hs-type">newDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083246"><span class="hs-identifier hs-type">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621683083253"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083250"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083257"><span class="annot"><a href="#local-6989586621683083257"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-type">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083249"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083250"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083258"><span class="annot"><a href="#local-6989586621683083258"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a b.
(a -&gt; b) -&gt; GenLocated SrcSpanAnnA a -&gt; GenLocated SrcSpanAnnA b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Kind -&gt; Kind -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621683083259"><span class="hs-identifier hs-var">toDict</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683083246"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083253"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083250"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683083257"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083255"><span class="hs-identifier hs-type">ip_id</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#IPBind"><span class="hs-identifier hs-type">IPBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083255"><span class="hs-identifier hs-type">ip_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083247"><span class="hs-identifier hs-type">l_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083258"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-comment">-- Coerces a `t` into a dictionary for `IP &quot;x&quot; t`.</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- co : t -&gt; IP &quot;x&quot; t</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="#local-6989586621683083259"><span class="hs-identifier hs-type">toDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>  </span><span class="hs-comment">-- IP class</span><span>
</span><span id="line-276"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="hs-comment">-- type-level string for name of IP</span><span>
</span><span id="line-277"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="hs-comment">-- type of IP</span><span>
</span><span id="line-278"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>   </span><span class="hs-comment">-- def'n of IP variable</span><span>
</span><span id="line-279"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>   </span><span class="hs-comment">-- dictionary for IP</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621683083259"><span class="annot"><span class="annottext">toDict :: Class -&gt; Kind -&gt; Kind -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621683083259"><span class="hs-identifier hs-var hs-var">toDict</span></a></span></span><span> </span><span id="local-6989586621683083261"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683083261"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span id="local-6989586621683083262"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083262"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683083263"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083263"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercionR -&gt; HsWrapper) -&gt; TcCoercionR -&gt; HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-281"></span><span>                          </span><span class="annot"><span class="annottext">Kind -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#wrapIP"><span class="hs-identifier hs-var">wrapIP</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; TcCoercionR) -&gt; Kind -&gt; TcCoercionR
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Class -&gt; TcThetaType -&gt; Kind
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683083261"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083262"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083263"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- Why an HsWrapper? See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-284"></span><span id="local-6989586621683082363"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcValBinds"><span class="hs-identifier hs-type">tcValBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span>
</span><span id="line-285"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082363"><span class="hs-identifier hs-type">thing</span></a></span><span>
</span><span id="line-287"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082363"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span id="tcValBinds"><span class="annot"><span class="annottext">tcValBinds :: forall thing.
TopLevelFlag
-&gt; [(RecFlag, LHsBinds GhcRn)]
-&gt; [LSig GhcRn]
-&gt; TcM thing
-&gt; TcM ([(RecFlag, LHsBinds GhcTc)], HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcValBinds"><span class="hs-identifier hs-var hs-var">tcValBinds</span></a></span></span><span> </span><span id="local-6989586621683083278"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083278"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683083279"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083279"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621683083280"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083280"><span class="hs-identifier hs-var">sigs</span></a></span></span><span> </span><span id="local-6989586621683083281"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083281"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- Typecheck the signatures</span><span>
</span><span id="line-291"></span><span>            </span><span class="hs-comment">-- It's easier to do so now, once for all the SCCs together</span><span>
</span><span id="line-292"></span><span>            </span><span class="hs-comment">-- because a single signature  f,g :: &lt;type&gt;</span><span>
</span><span id="line-293"></span><span>            </span><span class="hs-comment">-- might relate to more than one SCC</span><span>
</span><span id="line-294"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683083282"><span class="annot"><a href="#local-6989586621683083282"><span class="hs-identifier hs-var">poly_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083283"><span class="annot"><a href="#local-6989586621683083283"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PatSynBind GhcRn GhcRn]
-&gt; TcM ([TcId], TcSigFun) -&gt; TcM ([TcId], TcSigFun)
forall a. [PatSynBind GhcRn GhcRn] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcAddPatSynPlaceholders"><span class="hs-identifier hs-var">tcAddPatSynPlaceholders</span></a></span><span> </span><span class="annot"><span class="annottext">[PatSynBind GhcRn GhcRn]
</span><a href="#local-6989586621683083285"><span class="hs-identifier hs-var">patsyns</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([TcId], TcSigFun) -&gt; TcM ([TcId], TcSigFun))
-&gt; TcM ([TcId], TcSigFun) -&gt; TcM ([TcId], TcSigFun)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-295"></span><span>                                </span><span class="annot"><span class="annottext">[LSig GhcRn] -&gt; TcM ([TcId], TcSigFun)
</span><a href="GHC.Tc.Gen.Sig.html#tcTySigs"><span class="hs-identifier hs-var">tcTySigs</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083280"><span class="hs-identifier hs-var">sigs</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-comment">-- Extend the envt right away with all the Ids</span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-comment">--   declared with complete type signatures</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-comment">-- Do not extend the TcBinderStack; instead</span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-comment">--   we extend it on a per-rhs basis in tcExtendForRhs</span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-comment">--   See Note [Relevant bindings and the binder stack]</span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-comment">-- For the moment, let bindings and top-level bindings introduce</span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-comment">-- only unrestricted variables.</span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendSigIds"><span class="hs-identifier hs-type">tcExtendSigIds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083278"><span class="hs-identifier hs-type">top_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083282"><span class="hs-identifier hs-type">poly_ids</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-306"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083288"><span class="annot"><a href="#local-6989586621683083288"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083289"><span class="annot"><a href="#local-6989586621683083289"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083290"><span class="annot"><a href="#local-6989586621683083290"><span class="hs-identifier hs-var">extra_binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083291"><span class="annot"><a href="#local-6989586621683083291"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcBindGroups"><span class="hs-identifier hs-type">tcBindGroups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083278"><span class="hs-identifier hs-type">top_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083283"><span class="hs-identifier hs-type">sig_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083293"><span class="hs-identifier hs-type">prag_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083279"><span class="hs-identifier hs-type">binds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-308"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083294"><span class="annot"><a href="#local-6989586621683083294"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683083281"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-309"></span><span>                       </span><span class="hs-comment">-- See Note [Pattern synonym builders don't yield dependencies]</span><span>
</span><span id="line-310"></span><span>                       </span><span class="hs-comment">--     in GHC.Rename.Bind</span><span>
</span><span id="line-311"></span><span>                    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083295"><span class="annot"><a href="#local-6989586621683083295"><span class="hs-identifier hs-var">patsyn_builders</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html#tcPatSynBuilderBind"><span class="hs-identifier hs-type">tcPatSynBuilderBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083293"><span class="hs-identifier hs-type">prag_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083285"><span class="hs-identifier hs-type">patsyns</span></a></span><span>
</span><span id="line-312"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083296"><span class="annot"><a href="#local-6989586621683083296"><span class="hs-identifier hs-var hs-var">extra_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683083298"><span class="hs-identifier hs-var">builder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>                                        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083298"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683083298"><span class="hs-identifier hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]]
</span><a href="#local-6989586621683083295"><span class="hs-identifier hs-var">patsyn_builders</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-314"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083296"><span class="hs-identifier hs-type">extra_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083294"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083288"><span class="hs-identifier hs-type">binds'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683083290"><span class="hs-identifier hs-type">extra_binds'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083289"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083291"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621683083285"><span class="annot"><span class="annottext">patsyns :: [PatSynBind GhcRn GhcRn]
</span><a href="#local-6989586621683083285"><span class="hs-identifier hs-var hs-var">patsyns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)] -&gt; [PatSynBind GhcRn GhcRn]
forall id.
UnXRec id =&gt;
[(RecFlag, LHsBinds id)] -&gt; [PatSynBind id id]
</span><a href="GHC.Hs.Utils.html#getPatSynBinds"><span class="hs-identifier hs-var">getPatSynBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083279"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621683083293"><span class="annot"><span class="annottext">prag_fn :: TcPragEnv
</span><a href="#local-6989586621683083293"><span class="hs-identifier hs-var hs-var">prag_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn] -&gt; LHsBinds GhcRn -&gt; TcPragEnv
</span><a href="GHC.Tc.Gen.Sig.html#mkPragEnv"><span class="hs-identifier hs-var">mkPragEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083280"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])
 -&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)])
-&gt; [(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])]
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
[(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])]
</span><a href="#local-6989586621683083279"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">-- Why an HsWrapper? See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-323"></span><span id="local-6989586621683082465"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcBindGroups"><span class="hs-identifier hs-type">tcBindGroups</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>
</span><span id="line-324"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082465"><span class="hs-identifier hs-type">thing</span></a></span><span>
</span><span id="line-325"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082465"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-326"></span><span class="hs-comment">-- Typecheck a whole lot of value bindings,</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- one strongly-connected component at a time</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- Here a &quot;strongly connected component&quot; has the straightforward</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- meaning of a group of bindings that mention each other,</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- ignoring type signatures (that part comes later)</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span id="tcBindGroups"><span class="annot"><span class="annottext">tcBindGroups :: forall thing.
TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; [(RecFlag, LHsBinds GhcRn)]
-&gt; TcM thing
-&gt; TcM ([(RecFlag, LHsBinds GhcTc)], HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcBindGroups"><span class="hs-identifier hs-var hs-var">tcBindGroups</span></a></span></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683083306"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083306"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083307"><span class="annot"><a href="#local-6989586621683083307"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083306"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083307"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcBindGroups"><span class="hs-identifier hs-var">tcBindGroups</span></a></span><span> </span><span id="local-6989586621683083308"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083308"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683083309"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083309"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083310"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083310"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083311"><span class="annot"><span class="annottext">(RecFlag, LHsBinds GhcRn)
</span><a href="#local-6989586621683083311"><span class="hs-identifier hs-var">group</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683083312"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621683083312"><span class="hs-identifier hs-var">groups</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683083313"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083313"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- See Note [Closed binder groups]</span><span>
</span><span id="line-338"></span><span>          </span><span id="local-6989586621683083314"><span class="annot"><a href="#local-6989586621683083314"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcTypeEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var">getLclTypeEnv</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083316"><span class="annot"><a href="#local-6989586621683083316"><span class="hs-identifier hs-var hs-var">closed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; LHsBinds GhcRn -&gt; IsGroupClosed
</span><a href="GHC.Tc.Gen.Bind.html#isClosedBndrGroup"><span class="hs-identifier hs-var">isClosedBndrGroup</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621683083314"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(RecFlag, LHsBinds GhcRn)
(RecFlag, [GenLocated SrcSpanAnnA (HsBind GhcRn)])
</span><a href="#local-6989586621683083311"><span class="hs-identifier hs-var">group</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083318"><span class="annot"><a href="#local-6989586621683083318"><span class="hs-identifier hs-var">group'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083319"><span class="annot"><a href="#local-6989586621683083319"><span class="hs-identifier hs-var">outer_wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083320"><span class="annot"><a href="#local-6989586621683083320"><span class="hs-identifier hs-var">groups'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083321"><span class="annot"><a href="#local-6989586621683083321"><span class="hs-identifier hs-var">inner_wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083322"><span class="annot"><a href="#local-6989586621683083322"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tc_group"><span class="hs-identifier hs-type">tc_group</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083308"><span class="hs-identifier hs-type">top_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083309"><span class="hs-identifier hs-type">sig_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083310"><span class="hs-identifier hs-type">prag_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083311"><span class="hs-identifier hs-type">group</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083316"><span class="hs-identifier hs-type">closed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-342"></span><span>                   </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcBindGroups"><span class="hs-identifier hs-type">tcBindGroups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083308"><span class="hs-identifier hs-type">top_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083309"><span class="hs-identifier hs-type">sig_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083310"><span class="hs-identifier hs-type">prag_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083312"><span class="hs-identifier hs-type">groups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083313"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083318"><span class="hs-identifier hs-type">group'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683083320"><span class="hs-identifier hs-type">groups'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083319"><span class="hs-identifier hs-type">outer_wrapper</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083321"><span class="hs-identifier hs-type">inner_wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083322"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">-- Note [Closed binder groups]</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-347"></span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span class="hs-comment">--  A mutually recursive group is &quot;closed&quot; if all of the free variables of</span><span>
</span><span id="line-349"></span><span class="hs-comment">--  the bindings are closed. For example</span><span>
</span><span id="line-350"></span><span class="hs-comment">--</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- &gt;  h = \x -&gt; let f = ...g...</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- &gt;                g = ....f...x...</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- &gt;             in ...</span><span>
</span><span id="line-354"></span><span class="hs-comment">--</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- Here @g@ is not closed because it mentions @x@; and hence neither is @f@</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- closed.</span><span>
</span><span id="line-357"></span><span class="hs-comment">--</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- So we need to compute closed-ness on each strongly connected components,</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- before we sub-divide it based on what type signatures it has.</span><span>
</span><span id="line-360"></span><span class="hs-comment">--</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tc_group"><span class="hs-identifier hs-type">tc_group</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683082470"><span class="annot"><a href="#local-6989586621683082470"><span class="hs-identifier hs-type">thing</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-364"></span><span>            </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>
</span><span id="line-365"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#IsGroupClosed"><span class="hs-identifier hs-type">IsGroupClosed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082470"><span class="hs-identifier hs-type">thing</span></a></span><span>
</span><span id="line-366"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082470"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="hs-comment">-- Typecheck one strongly-connected component of the original program.</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- We get a list of groups back, because there may</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- be specialisations etc as well</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span id="tc_group"><span class="annot"><span class="annottext">tc_group :: forall thing.
TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; (RecFlag, LHsBinds GhcRn)
-&gt; IsGroupClosed
-&gt; TcM thing
-&gt; TcM ([(RecFlag, LHsBinds GhcTc)], HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tc_group"><span class="hs-identifier hs-var hs-var">tc_group</span></a></span></span><span> </span><span id="local-6989586621683083347"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083347"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683083348"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083348"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083349"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083349"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083350"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083350"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683083351"><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083351"><span class="hs-identifier hs-var">closed</span></a></span></span><span> </span><span id="local-6989586621683083352"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083352"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-comment">-- A single non-recursive binding</span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-comment">-- We want to keep non-recursive things non-recursive</span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-comment">-- so that we desugar unlifted bindings correctly</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083353"><span class="annot"><span class="annottext">bind :: LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083353"><span class="hs-identifier hs-var hs-var hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083350"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-377"></span><span>                 </span><span class="hs-special">[</span><span id="local-6989586621683083354"><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083354"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083354"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-378"></span><span>                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; GenLocated SrcSpanAnnA (HsBind GhcRn)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_group: empty list of binds&quot;</span></span><span>
</span><span id="line-379"></span><span>                 </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; GenLocated SrcSpanAnnA (HsBind GhcRn)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_group: NonRecursive binds is not a singleton bag&quot;</span></span><span>
</span><span id="line-380"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083355"><span class="annot"><a href="#local-6989586621683083355"><span class="hs-identifier hs-var">bind'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083356"><span class="annot"><a href="#local-6989586621683083356"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083357"><span class="annot"><a href="#local-6989586621683083357"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; LHsBindLR GhcRn GhcRn
-&gt; IsGroupClosed
-&gt; TcM thing
-&gt; TcM (LHsBinds GhcTc, HsWrapper, thing)
forall thing.
TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; LHsBindLR GhcRn GhcRn
-&gt; IsGroupClosed
-&gt; TcM thing
-&gt; TcM (LHsBinds GhcTc, HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tc_single"><span class="hs-identifier hs-var">tc_single</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083347"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083348"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083349"><span class="hs-identifier hs-var">prag_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083353"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083351"><span class="hs-identifier hs-var">closed</span></a></span><span>
</span><span id="line-381"></span><span>                                     </span><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083352"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-382"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083355"><span class="hs-identifier hs-type">bind'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083356"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083357"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tc_group"><span class="hs-identifier hs-var">tc_group</span></a></span><span> </span><span id="local-6989586621683083359"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083359"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683083360"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083360"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083361"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083361"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083363"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083363"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683083364"><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083364"><span class="hs-identifier hs-var">closed</span></a></span></span><span> </span><span id="local-6989586621683083365"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083365"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- To maximise polymorphism, we do a new</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-comment">-- strongly-connected-component analysis, this time omitting</span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-comment">-- any references to variables with type signatures.</span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-comment">-- (This used to be optional, but isn't now.)</span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-comment">-- See Note [Polymorphic recursion] in &quot;GHC.Hs.Binds&quot;.</span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_group rec&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsBinds GhcRn -&gt; SDoc
forall (idL :: Pass) (idR :: Pass).
(OutputableBndrId idL, OutputableBndrId idR) =&gt;
LHsBindsLR (GhcPass idL) (GhcPass idR) -&gt; SDoc
</span><a href="GHC.Hs.Binds.html#pprLHsBinds"><span class="hs-identifier hs-var">pprLHsBinds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083363"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn))
-&gt; (GenLocated SrcSpanAnnA (HsBind GhcRn)
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="GHC.Data.Maybe.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn))
</span><a href="#local-6989586621683083369"><span class="hs-identifier hs-var">mbFirstPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">((GenLocated SrcSpanAnnA (HsBind GhcRn)
  -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; (GenLocated SrcSpanAnnA (HsBind GhcRn)
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683083370"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083370"><span class="hs-identifier hs-var">lpat_syn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-392"></span><span>            </span><span class="annot"><span class="annottext">SrcSpan -&gt; LHsBinds GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. SrcSpan -&gt; LHsBinds GhcRn -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#recursivePatSynErr"><span class="hs-identifier hs-var">recursivePatSynErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpanAnnA -&gt; SrcSpan) -&gt; SrcSpanAnnA -&gt; SrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; SrcSpanAnnA
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083370"><span class="hs-identifier hs-var">lpat_syn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083363"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083374"><span class="annot"><a href="#local-6989586621683083374"><span class="hs-identifier hs-var">binds1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083375"><span class="annot"><a href="#local-6989586621683083375"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083376"><span class="annot"><a href="#local-6989586621683083376"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SCC (LHsBindLR GhcRn GhcRn)]
-&gt; TcM (LHsBinds GhcTc, HsWrapper, thing)
</span><a href="#local-6989586621683083377"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC (LHsBindLR GhcRn GhcRn)]
</span><a href="#local-6989586621683083378"><span class="hs-identifier hs-var">sccs</span></a></span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083374"><span class="hs-identifier hs-type">binds1</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083375"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083376"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-395"></span><span>                </span><span class="hs-comment">-- Rec them all together</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621683083369"><span class="annot"><span class="annottext">mbFirstPatSyn :: Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn))
</span><a href="#local-6989586621683083369"><span class="hs-identifier hs-var hs-var">mbFirstPatSyn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
-&gt; Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn))
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBind GhcRn -&gt; Bool
forall {idL} {idR}. HsBindLR idL idR -&gt; Bool
</span><a href="#local-6989586621683083379"><span class="hs-identifier hs-var">isPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">(HsBind GhcRn -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; HsBind GhcRn)
-&gt; GenLocated SrcSpanAnnA (HsBind GhcRn)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; HsBind GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083363"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621683083379"><span class="annot"><span class="annottext">isPatSyn :: HsBindLR idL idR -&gt; Bool
</span><a href="#local-6989586621683083379"><span class="hs-identifier hs-var hs-var">isPatSyn</span></a></span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatSynBind"><span class="hs-identifier hs-type">PatSynBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="#local-6989586621683083379"><span class="hs-identifier hs-var">isPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">HsBindLR idL idR
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>    </span><span class="annot"><a href="#local-6989586621683083378"><span class="hs-identifier hs-type">sccs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621683083378"><span class="annot"><span class="annottext">sccs :: [SCC (LHsBindLR GhcRn GhcRn)]
</span><a href="#local-6989586621683083378"><span class="hs-identifier hs-var hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Node BKey (GenLocated SrcSpanAnnA (HsBind GhcRn))]
-&gt; [SCC (GenLocated SrcSpanAnnA (HsBind GhcRn))]
forall key payload.
Uniquable key =&gt;
[Node key payload] -&gt; [SCC payload]
</span><a href="GHC.Data.Graph.Directed.html#stronglyConnCompFromEdgedVerticesUniq"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesUniq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSigFun -&gt; LHsBinds GhcRn -&gt; [Node BKey (LHsBindLR GhcRn GhcRn)]
</span><a href="GHC.Tc.Gen.Bind.html#mkEdges"><span class="hs-identifier hs-var">mkEdges</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083360"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083363"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><a href="#local-6989586621683083377"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082470"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621683083377"><span class="annot"><span class="annottext">go :: [SCC (LHsBindLR GhcRn GhcRn)]
-&gt; TcM (LHsBinds GhcTc, HsWrapper, thing)
</span><a href="#local-6989586621683083377"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083386"><span class="annot"><span class="annottext">SCC (LHsBindLR GhcRn GhcRn)
</span><a href="#local-6989586621683083386"><span class="hs-identifier hs-var">scc</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683083387"><span class="annot"><span class="annottext">[SCC (LHsBindLR GhcRn GhcRn)]
</span><a href="#local-6989586621683083387"><span class="hs-identifier hs-var">sccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083388"><span class="annot"><a href="#local-6989586621683083388"><span class="hs-identifier hs-var">binds1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083389"><span class="annot"><a href="#local-6989586621683083389"><span class="hs-identifier hs-var">ids1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SCC (GenLocated SrcSpanAnnA (HsBind GhcRn))
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="#local-6989586621683083390"><span class="hs-identifier hs-var">tc_scc</span></a></span><span> </span><span class="annot"><span class="annottext">SCC (LHsBindLR GhcRn GhcRn)
SCC (GenLocated SrcSpanAnnA (HsBind GhcRn))
</span><a href="#local-6989586621683083386"><span class="hs-identifier hs-var">scc</span></a></span><span>
</span><span id="line-406"></span><span>                         </span><span class="hs-comment">-- recursive bindings must be unrestricted</span><span>
</span><span id="line-407"></span><span>                         </span><span class="hs-comment">-- (the ids added to the environment here are the name of the recursive definitions).</span><span>
</span><span id="line-408"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683083391"><span class="annot"><a href="#local-6989586621683083391"><span class="hs-identifier hs-var">binds2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083392"><span class="annot"><a href="#local-6989586621683083392"><span class="hs-identifier hs-var">inner_wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083393"><span class="annot"><a href="#local-6989586621683083393"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083394"><span class="annot"><a href="#local-6989586621683083394"><span class="hs-identifier hs-var">outer_wrapper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-409"></span><span>                              </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendLetEnv"><span class="hs-identifier hs-type">tcExtendLetEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083359"><span class="hs-identifier hs-type">top_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083360"><span class="hs-identifier hs-type">sig_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083364"><span class="hs-identifier hs-type">closed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083389"><span class="hs-identifier hs-type">ids1</span></a></span><span>
</span><span id="line-410"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083377"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083387"><span class="hs-identifier hs-type">sccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083388"><span class="hs-identifier hs-type">binds1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683083391"><span class="hs-identifier hs-type">binds2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083394"><span class="hs-identifier hs-type">outer_wrapper</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083392"><span class="hs-identifier hs-type">inner_wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083393"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><a href="#local-6989586621683083377"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083396"><span class="annot"><a href="#local-6989586621683083396"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083365"><span class="hs-identifier hs-var">thing_inside</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083396"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621683083390"><span class="annot"><span class="annottext">tc_scc :: SCC (GenLocated SrcSpanAnnA (HsBind GhcRn))
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="#local-6989586621683083390"><span class="hs-identifier hs-var hs-var">tc_scc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621683083398"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083398"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecFlag
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="#local-6989586621683083399"><span class="hs-identifier hs-var">tc_sub_group</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083398"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><a href="#local-6989586621683083390"><span class="hs-identifier hs-var">tc_scc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621683083401"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083401"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecFlag
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="#local-6989586621683083399"><span class="hs-identifier hs-var">tc_sub_group</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span>    </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083401"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621683083399"><span class="annot"><span class="annottext">tc_sub_group :: RecFlag
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="#local-6989586621683083399"><span class="hs-identifier hs-var hs-var">tc_sub_group</span></a></span></span><span> </span><span id="local-6989586621683083402"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083402"><span class="hs-identifier hs-var">rec_tc</span></a></span></span><span> </span><span id="local-6989586621683083403"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083403"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; RecFlag
-&gt; RecFlag
-&gt; IsGroupClosed
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyBinds"><span class="hs-identifier hs-var">tcPolyBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083359"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083360"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083361"><span class="hs-identifier hs-var">prag_fn</span></a></span><span>
</span><span id="line-418"></span><span>                                            </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083402"><span class="hs-identifier hs-var">rec_tc</span></a></span><span> </span><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083364"><span class="hs-identifier hs-var">closed</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083403"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span id="local-6989586621683082480"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#recursivePatSynErr"><span class="hs-identifier hs-type">recursivePatSynErr</span></a></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-comment">-- ^ The location of the first pattern synonym binding</span><span>
</span><span id="line-422"></span><span>             </span><span class="hs-comment">--   (for error reporting)</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082480"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-425"></span><span id="recursivePatSynErr"><span class="annot"><span class="annottext">recursivePatSynErr :: forall a. SrcSpan -&gt; LHsBinds GhcRn -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#recursivePatSynErr"><span class="hs-identifier hs-var hs-var">recursivePatSynErr</span></a></span></span><span> </span><span id="local-6989586621683083405"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683083405"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683083406"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083406"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; TcRn a
forall a. SrcSpan -&gt; TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier hs-var">failAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683083405"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn a) -&gt; TcRnMessage -&gt; TcRn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnRecursivePatternSynonym"><span class="hs-identifier hs-var">TcRnRecursivePatternSynonym</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083406"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tc_single"><span class="hs-identifier hs-type">tc_single</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683082473"><span class="annot"><a href="#local-6989586621683082473"><span class="hs-identifier hs-type">thing</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-429"></span><span>            </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>
</span><span id="line-430"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#IsGroupClosed"><span class="hs-identifier hs-type">IsGroupClosed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082473"><span class="hs-identifier hs-type">thing</span></a></span><span>
</span><span id="line-431"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082473"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span id="tc_single"><span class="annot"><span class="annottext">tc_single :: forall thing.
TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; LHsBindLR GhcRn GhcRn
-&gt; IsGroupClosed
-&gt; TcM thing
-&gt; TcM (LHsBinds GhcTc, HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tc_single"><span class="hs-identifier hs-var hs-var">tc_single</span></a></span></span><span> </span><span id="local-6989586621683083415"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083415"><span class="hs-identifier hs-var">_top_lvl</span></a></span></span><span> </span><span id="local-6989586621683083416"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083416"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083417"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083417"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span>
</span><span id="line-433"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683083418"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083418"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatSynBind"><span class="hs-identifier hs-type">PatSynBind</span></a></span><span> </span><span class="annot"><span class="annottext">XPatSynBind GhcRn GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083419"><span class="annot"><span class="annottext">PatSynBind GhcRn GhcRn
</span><a href="#local-6989586621683083419"><span class="hs-identifier hs-var">psb</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>          </span><span class="annot"><span class="annottext">IsGroupClosed
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083420"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083420"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083421"><span class="annot"><a href="#local-6989586621683083421"><span class="hs-identifier hs-var">aux_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083422"><span class="annot"><a href="#local-6989586621683083422"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocatedA (PatSynBind GhcRn GhcRn)
-&gt; TcSigFun -&gt; TcPragEnv -&gt; TcM (LHsBinds GhcTc, TcGblEnv)
</span><a href="GHC.Tc.TyCl.PatSyn.html#tcPatSynDecl"><span class="hs-identifier hs-var">tcPatSynDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; PatSynBind GhcRn GhcRn -&gt; LocatedA (PatSynBind GhcRn GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083418"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PatSynBind GhcRn GhcRn
</span><a href="#local-6989586621683083419"><span class="hs-identifier hs-var">psb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083416"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083417"><span class="hs-identifier hs-var">prag_fn</span></a></span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083423"><span class="annot"><a href="#local-6989586621683083423"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083422"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083420"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-437"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083421"><span class="hs-identifier hs-type">aux_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083423"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tc_single"><span class="hs-identifier hs-var">tc_single</span></a></span><span> </span><span id="local-6989586621683083425"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083425"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683083426"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083426"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083427"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083427"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span id="local-6989586621683083428"><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083428"><span class="hs-identifier hs-var">lbind</span></a></span></span><span> </span><span id="local-6989586621683083429"><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083429"><span class="hs-identifier hs-var">closed</span></a></span></span><span> </span><span id="local-6989586621683083430"><span class="annot"><span class="annottext">TcM thing
</span><a href="#local-6989586621683083430"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083431"><span class="annot"><a href="#local-6989586621683083431"><span class="hs-identifier hs-var">binds1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083432"><span class="annot"><a href="#local-6989586621683083432"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; RecFlag
-&gt; RecFlag
-&gt; IsGroupClosed
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyBinds"><span class="hs-identifier hs-var">tcPolyBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083425"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083426"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083427"><span class="hs-identifier hs-var">prag_fn</span></a></span><span>
</span><span id="line-442"></span><span>                                      </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span>
</span><span id="line-443"></span><span>                                      </span><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083429"><span class="hs-identifier hs-var">closed</span></a></span><span>
</span><span id="line-444"></span><span>                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083428"><span class="hs-identifier hs-var">lbind</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-445"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083433"><span class="annot"><a href="#local-6989586621683083433"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083434"><span class="annot"><a href="#local-6989586621683083434"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendLetEnv"><span class="hs-identifier hs-type">tcExtendLetEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083425"><span class="hs-identifier hs-type">top_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083426"><span class="hs-identifier hs-type">sig_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083429"><span class="hs-identifier hs-type">closed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083432"><span class="hs-identifier hs-type">ids</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083430"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-446"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083431"><span class="hs-identifier hs-type">binds1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083434"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083433"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-449"></span><span class="hs-keyword">type</span><span> </span><span id="BKey"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#BKey"><span class="hs-identifier hs-var">BKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- Just number off the bindings</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mkEdges"><span class="hs-identifier hs-type">mkEdges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#BKey"><span class="hs-identifier hs-type">BKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- See Note [Polymorphic recursion] in &quot;GHC.Hs.Binds&quot;.</span><span>
</span><span id="line-453"></span><span id="mkEdges"><span class="annot"><span class="annottext">mkEdges :: TcSigFun -&gt; LHsBinds GhcRn -&gt; [Node BKey (LHsBindLR GhcRn GhcRn)]
</span><a href="GHC.Tc.Gen.Bind.html#mkEdges"><span class="hs-identifier hs-var hs-var">mkEdges</span></a></span></span><span> </span><span id="local-6989586621683083435"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083435"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083436"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083436"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
-&gt; BKey
-&gt; [BKey]
-&gt; Node BKey (GenLocated SrcSpanAnnA (HsBind GhcRn))
forall key payload. payload -&gt; key -&gt; [key] -&gt; Node key payload
</span><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083438"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">BKey
</span><a href="#local-6989586621683083439"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BKey
</span><a href="#local-6989586621683083440"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083441"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083441"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; [Name]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBind GhcRn -&gt; XFunBind GhcRn GhcRn
forall {idL} {idR}.
(XPatBind idL idR ~ XFunBind idL idR,
 XFunBind idL idR ~ NameSet) =&gt;
HsBindLR idL idR -&gt; XFunBind idL idR
</span><a href="#local-6989586621683083443"><span class="hs-identifier hs-var">bind_fvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; HsBind GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083438"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-455"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083440"><span class="annot"><span class="annottext">BKey
</span><a href="#local-6989586621683083440"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">NameEnv BKey -&gt; Name -&gt; Maybe BKey
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv BKey
</span><a href="#local-6989586621683083445"><span class="hs-identifier hs-var">key_map</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083441"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683083446"><span class="hs-identifier hs-var">no_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083441"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083438"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083438"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083439"><span class="annot"><span class="annottext">BKey
</span><a href="#local-6989586621683083439"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (HsBind GhcRn), BKey)]
</span><a href="#local-6989586621683083447"><span class="hs-identifier hs-var">keyd_binds</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here as stronglyConnCompFromEdgedVertices</span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-comment">-- is still deterministic even if the edges are in nondeterministic order</span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-comment">-- as explained in Note [Deterministic SCC] in GHC.Data.Graph.Directed.</span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621683083443"><span class="annot"><span class="annottext">bind_fvs :: HsBindLR idL idR -&gt; XFunBind idL idR
</span><a href="#local-6989586621683083443"><span class="hs-identifier hs-var hs-var">bind_fvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_ext :: forall idL idR. HsBindLR idL idR -&gt; XFunBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#fun_ext"><span class="hs-identifier hs-var">fun_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083454"><span class="annot"><span class="annottext">XFunBind idL idR
</span><a href="#local-6989586621683083454"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XFunBind idL idR
</span><a href="#local-6989586621683083454"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><a href="#local-6989586621683083443"><span class="hs-identifier hs-var">bind_fvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_ext :: forall idL idR. HsBindLR idL idR -&gt; XPatBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#pat_ext"><span class="hs-identifier hs-var">pat_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083457"><span class="annot"><span class="annottext">XPatBind idL idR
</span><a href="#local-6989586621683083457"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPatBind idL idR
XFunBind idL idR
</span><a href="#local-6989586621683083457"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><a href="#local-6989586621683083443"><span class="hs-identifier hs-var">bind_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">HsBindLR idL idR
</span><span class="hs-identifier">_</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XFunBind idL idR
NameSet
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><a href="#local-6989586621683083446"><span class="hs-identifier hs-type">no_sig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-467"></span><span>    </span><span id="local-6989586621683083446"><span class="annot"><span class="annottext">no_sig :: Name -&gt; Bool
</span><a href="#local-6989586621683083446"><span class="hs-identifier hs-var hs-var">no_sig</span></a></span></span><span> </span><span id="local-6989586621683083459"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083459"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSigFun -&gt; Name -&gt; Bool
</span><a href="GHC.Tc.Types.BasicTypes.html#hasCompleteSig"><span class="hs-identifier hs-var">hasCompleteSig</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083435"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083459"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>    </span><span id="local-6989586621683083447"><span class="annot"><span class="annottext">keyd_binds :: [(GenLocated SrcSpanAnnA (HsBind GhcRn), BKey)]
</span><a href="#local-6989586621683083447"><span class="hs-identifier hs-var hs-var">keyd_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083436"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBind GhcRn)]
-&gt; [BKey] -&gt; [(GenLocated SrcSpanAnnA (HsBind GhcRn), BKey)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BKey
</span><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#BKey"><span class="hs-identifier hs-type">BKey</span></a></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>    </span><span class="annot"><a href="#local-6989586621683083445"><span class="hs-identifier hs-type">key_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#BKey"><span class="hs-identifier hs-type">BKey</span></a></span><span>     </span><span class="hs-comment">-- Which binding it comes from</span><span>
</span><span id="line-472"></span><span>    </span><span id="local-6989586621683083445"><span class="annot"><span class="annottext">key_map :: NameEnv BKey
</span><a href="#local-6989586621683083445"><span class="hs-identifier hs-var hs-var">key_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, BKey)] -&gt; NameEnv BKey
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083463"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BKey
</span><a href="#local-6989586621683083464"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083465"><span class="annot"><span class="annottext">HsBind GhcRn
</span><a href="#local-6989586621683083465"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083464"><span class="annot"><span class="annottext">BKey
</span><a href="#local-6989586621683083464"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (HsBind GhcRn), BKey)]
</span><a href="#local-6989586621683083447"><span class="hs-identifier hs-var">keyd_binds</span></a></span><span>
</span><span id="line-473"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083463"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083463"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; HsBind GhcRn -&gt; [IdP GhcRn]
forall p idR.
CollectPass p =&gt;
CollectFlag p -&gt; HsBindLR p idR -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectHsBindBinders"><span class="hs-identifier hs-var">collectHsBindBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsBind GhcRn
</span><a href="#local-6989586621683083465"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-476"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcPolyBinds"><span class="hs-identifier hs-type">tcPolyBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>
</span><span id="line-477"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span>         </span><span class="hs-comment">-- Whether the group is really recursive</span><span>
</span><span id="line-478"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span>         </span><span class="hs-comment">-- Whether it's recursive after breaking</span><span>
</span><span id="line-479"></span><span>                               </span><span class="hs-comment">-- dependencies based on type signatures</span><span>
</span><span id="line-480"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#IsGroupClosed"><span class="hs-identifier hs-type">IsGroupClosed</span></a></span><span>   </span><span class="hs-comment">-- Whether the group is closed</span><span>
</span><span id="line-481"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- None are PatSynBind</span><span>
</span><span id="line-482"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="hs-comment">-- Typechecks a single bunch of values bindings all together,</span><span>
</span><span id="line-485"></span><span class="hs-comment">-- and generalises them.  The bunch may be only part of a recursive</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- group, because we use type signatures to maximise polymorphism</span><span>
</span><span id="line-487"></span><span class="hs-comment">--</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- Returns a list because the input may be a single non-recursive binding,</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- in which case the dependency order of the resulting bindings is</span><span>
</span><span id="line-490"></span><span class="hs-comment">-- important.</span><span>
</span><span id="line-491"></span><span class="hs-comment">--</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- Knows nothing about the scope of the bindings</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- None of the bindings are pattern synonyms</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span id="tcPolyBinds"><span class="annot"><span class="annottext">tcPolyBinds :: TopLevelFlag
-&gt; TcSigFun
-&gt; TcPragEnv
-&gt; RecFlag
-&gt; RecFlag
-&gt; IsGroupClosed
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyBinds"><span class="hs-identifier hs-var hs-var">tcPolyBinds</span></a></span></span><span> </span><span id="local-6989586621683083468"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083468"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683083469"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083469"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083470"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083470"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span id="local-6989586621683083471"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083471"><span class="hs-identifier hs-var">rec_group</span></a></span></span><span> </span><span id="local-6989586621683083472"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083472"><span class="hs-identifier hs-var">rec_tc</span></a></span></span><span> </span><span id="local-6989586621683083473"><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083473"><span class="hs-identifier hs-var">closed</span></a></span></span><span> </span><span id="local-6989586621683083474"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083474"><span class="hs-identifier hs-var">bind_list</span></a></span></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683083476"><span class="hs-identifier hs-var">loc</span></a></span><span>                              </span><span class="annot"><span class="annottext">(TcM (LHsBinds GhcTc, [Scaled TcId])
 -&gt; TcM (LHsBinds GhcTc, [Scaled TcId]))
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-497"></span><span>    </span><span class="annot"><span class="annottext">TcM (LHsBinds GhcTc, [Scaled TcId])
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-var">recoverM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; TcSigFun -&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#recoveryCode"><span class="hs-identifier hs-var">recoveryCode</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683083479"><span class="hs-identifier hs-var">binder_names</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083469"><span class="hs-identifier hs-var">sig_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsBinds GhcTc, [Scaled TcId])
 -&gt; TcM (LHsBinds GhcTc, [Scaled TcId]))
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-comment">-- Set up main recover; take advantage of any type sigs</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;------------------------------------------------&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Bindings for {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683083479"><span class="hs-identifier hs-var">binder_names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083481"><span class="annot"><a href="#local-6989586621683083481"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083483"><span class="annot"><a href="#local-6989586621683083483"><span class="hs-identifier hs-var hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; TopLevelFlag
-&gt; IsGroupClosed
-&gt; TcSigFun
-&gt; LHsBinds GhcRn
-&gt; GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#decideGeneralisationPlan"><span class="hs-identifier hs-var">decideGeneralisationPlan</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683083481"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683083468"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683083473"><span class="hs-identifier hs-var">closed</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083469"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083474"><span class="hs-identifier hs-var">bind_list</span></a></span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Generalisation plan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083483"><span class="hs-identifier hs-type">plan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083485"><span class="annot"><a href="#local-6989586621683083485"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083486"><span class="annot"><a href="#local-6989586621683083486"><span class="hs-identifier hs-var">scaled_poly_ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683083483"><span class="hs-identifier hs-type">plan</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-506"></span><span>         </span><span class="annot"><span class="annottext">GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecFlag
-&gt; TcPragEnv
-&gt; TcSigFun
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyNoGen"><span class="hs-identifier hs-var">tcPolyNoGen</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083472"><span class="hs-identifier hs-var">rec_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083470"><span class="hs-identifier hs-var">prag_fn</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083469"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083474"><span class="hs-identifier hs-var">bind_list</span></a></span><span>
</span><span id="line-507"></span><span>         </span><span class="annot"><span class="annottext">GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecFlag
-&gt; TcPragEnv
-&gt; TcSigFun
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyInfer"><span class="hs-identifier hs-var">tcPolyInfer</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083472"><span class="hs-identifier hs-var">rec_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083470"><span class="hs-identifier hs-var">prag_fn</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083469"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083474"><span class="hs-identifier hs-var">bind_list</span></a></span><span>
</span><span id="line-508"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#CheckGen"><span class="hs-identifier hs-type">CheckGen</span></a></span><span> </span><span id="local-6989586621683083492"><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083492"><span class="hs-identifier hs-var">lbind</span></a></span></span><span> </span><span id="local-6989586621683083493"><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683083493"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcPragEnv
-&gt; TcCompleteSig
-&gt; LHsBindLR GhcRn GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyCheck"><span class="hs-identifier hs-var">tcPolyCheck</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083470"><span class="hs-identifier hs-var">prag_fn</span></a></span><span> </span><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683083493"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083492"><span class="hs-identifier hs-var">lbind</span></a></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083494"><span class="annot"><a href="#local-6989586621683083494"><span class="hs-identifier hs-var hs-var">poly_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled TcId -&gt; TcId) -&gt; [Scaled TcId] -&gt; [TcId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled TcId -&gt; TcId
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcId]
</span><a href="#local-6989586621683083486"><span class="hs-identifier hs-var">scaled_poly_ids</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683083497"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083497"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-513"></span><span>        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
FixedRuntimeRepContext -&gt; Kind -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
FixedRuntimeRepContext -&gt; Kind -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRBinder"><span class="hs-identifier hs-var">FRRBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; FixedRuntimeRepContext) -&gt; Name -&gt; FixedRuntimeRepContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcId -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083497"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083497"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>        </span><span class="annot"><a href="#local-6989586621683083494"><span class="hs-identifier hs-type">poly_ids</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;} End of bindings for&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083479"><span class="hs-identifier hs-type">binder_names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083471"><span class="hs-identifier hs-type">rec_group</span></a></span><span>
</span><span id="line-517"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083502"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083502"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083502"><span class="annot"><a href="#local-6989586621683083502"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683083494"><span class="hs-identifier hs-type">poly_ids</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-518"></span><span>                                          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683083485"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-522"></span><span>    </span><span id="local-6989586621683083479"><span class="annot"><span class="annottext">binder_names :: [IdP GhcRn]
</span><a href="#local-6989586621683083479"><span class="hs-identifier hs-var hs-var">binder_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; LHsBinds GhcRn -&gt; [IdP GhcRn]
forall p idR.
CollectPass p =&gt;
CollectFlag p -&gt; [LHsBindLR p idR] -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectHsBindListBinders"><span class="hs-identifier hs-var">collectHsBindListBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083474"><span class="hs-identifier hs-var">bind_list</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span id="local-6989586621683083476"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621683083476"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; SrcSpan -&gt; SrcSpan) -&gt; [SrcSpan] -&gt; SrcSpan
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpan -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#combineSrcSpans"><span class="hs-identifier hs-var">combineSrcSpans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; SrcSpan)
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)] -&gt; [SrcSpan]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpanAnnA -&gt; SrcSpan)
-&gt; (GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; SrcSpanAnnA)
-&gt; GenLocated SrcSpanAnnA (HsBind GhcRn)
-&gt; SrcSpan
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; SrcSpanAnnA
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083474"><span class="hs-identifier hs-var">bind_list</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>         </span><span class="hs-comment">-- The mbinds have been dependency analysed and</span><span>
</span><span id="line-525"></span><span>         </span><span class="hs-comment">-- may no longer be adjacent; so find the narrowest</span><span>
</span><span id="line-526"></span><span>         </span><span class="hs-comment">-- span that includes them all</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- If typechecking the binds fails, then return with each</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- signature-less binder given type (forall a.a), to minimise</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- subsequent error messages</span><span>
</span><span id="line-532"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#recoveryCode"><span class="hs-identifier hs-type">recoveryCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span id="recoveryCode"><span class="annot"><span class="annottext">recoveryCode :: [Name] -&gt; TcSigFun -&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#recoveryCode"><span class="hs-identifier hs-var hs-var">recoveryCode</span></a></span></span><span> </span><span id="local-6989586621683083506"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683083506"><span class="hs-identifier hs-var">binder_names</span></a></span></span><span> </span><span id="local-6989586621683083507"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083507"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcBindsWithSigs: error recovery&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683083506"><span class="hs-identifier hs-var">binder_names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083508"><span class="annot"><span class="annottext">poly_ids :: [Scaled TcId]
</span><a href="#local-6989586621683083508"><span class="hs-identifier hs-var hs-var">poly_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcId -&gt; Scaled TcId) -&gt; [TcId] -&gt; [Scaled TcId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; TcId -&gt; Scaled TcId
forall a. Kind -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TcId] -&gt; [Scaled TcId]) -&gt; [TcId] -&gt; [Scaled TcId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcId) -&gt; [Name] -&gt; [TcId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcId
</span><a href="#local-6989586621683083511"><span class="hs-identifier hs-var">mk_dummy</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683083506"><span class="hs-identifier hs-var">binder_names</span></a></span><span>
</span><span id="line-536"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)], [Scaled TcId])
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)], [Scaled TcId])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled TcId]
</span><a href="#local-6989586621683083508"><span class="hs-identifier hs-var">poly_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-538"></span><span>    </span><span id="local-6989586621683083511"><span class="annot"><span class="annottext">mk_dummy :: Name -&gt; TcId
</span><a href="#local-6989586621683083511"><span class="hs-identifier hs-var hs-var">mk_dummy</span></a></span></span><span> </span><span id="local-6989586621683083512"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083512"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083513"><span class="annot"><span class="annottext">TcSigInfo
</span><a href="#local-6989586621683083513"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083507"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083512"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083514"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083514"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSigInfo -&gt; Maybe TcId
</span><a href="GHC.Tc.Types.BasicTypes.html#completeSigPolyId_maybe"><span class="hs-identifier hs-var">completeSigPolyId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigInfo
</span><a href="#local-6989586621683083513"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-541"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083514"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Kind -&gt; Kind -&gt; TcId
Name -&gt; Kind -&gt; Kind -&gt; TcId
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083512"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Tc.Gen.Bind.html#forall_a_a"><span class="hs-identifier hs-var">forall_a_a</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#forall_a_a"><span class="hs-identifier hs-type">forall_a_a</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-546"></span><span class="hs-comment">-- At one point I had (forall r (a :: TYPE r). a), but of course</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- that type is ill-formed: its mentions 'r' which escapes r's scope.</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- Another alternative would be (forall (a :: TYPE kappa). a), where</span><span>
</span><span id="line-549"></span><span class="hs-comment">-- kappa is a unification variable. But I don't think we need that</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- complication here. I'm going to just use (forall (a::*). a).</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- See #15276</span><span>
</span><span id="line-552"></span><span id="forall_a_a"><span class="annot"><span class="annottext">forall_a_a :: Kind
</span><a href="GHC.Tc.Gen.Bind.html#forall_a_a"><span class="hs-identifier hs-var hs-var">forall_a_a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcId] -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcId
</span><a href="GHC.Builtin.Types.Prim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                         tcPolyNoGen
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcPolyNoGen"><span class="hs-identifier hs-type">tcPolyNoGen</span></a></span><span>     </span><span class="hs-comment">-- No generalisation whatsoever</span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span>       </span><span class="hs-comment">-- Whether it's recursive after breaking</span><span>
</span><span id="line-562"></span><span>                   </span><span class="hs-comment">-- dependencies based on type signatures</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span id="tcPolyNoGen"><span class="annot"><span class="annottext">tcPolyNoGen :: RecFlag
-&gt; TcPragEnv
-&gt; TcSigFun
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyNoGen"><span class="hs-identifier hs-var hs-var">tcPolyNoGen</span></a></span></span><span> </span><span id="local-6989586621683083522"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083522"><span class="hs-identifier hs-var">rec_tc</span></a></span></span><span> </span><span id="local-6989586621683083523"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083523"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span id="local-6989586621683083524"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083524"><span class="hs-identifier hs-var">tc_sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083525"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083525"><span class="hs-identifier hs-var">bind_list</span></a></span></span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083526"><span class="annot"><a href="#local-6989586621683083526"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083527"><span class="annot"><a href="#local-6989586621683083527"><span class="hs-identifier hs-var">mono_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RecFlag
-&gt; TcSigFun
-&gt; LetBndrSpec
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
</span><a href="GHC.Tc.Gen.Bind.html#tcMonoBinds"><span class="hs-identifier hs-var">tcMonoBinds</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083522"><span class="hs-identifier hs-var">rec_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083524"><span class="hs-identifier hs-var">tc_sig_fn</span></a></span><span>
</span><span id="line-569"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPragEnv -&gt; LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-var">LetGblBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083523"><span class="hs-identifier hs-var">prag_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>                                             </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083525"><span class="hs-identifier hs-var">bind_list</span></a></span><span>
</span><span id="line-571"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083530"><span class="annot"><a href="#local-6989586621683083530"><span class="hs-identifier hs-var">mono_ids'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="#local-6989586621683083531"><span class="hs-identifier hs-type">tc_mono_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083527"><span class="hs-identifier hs-type">mono_infos</span></a></span><span>
</span><span id="line-572"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083526"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083530"><span class="hs-identifier hs-type">mono_ids'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-574"></span><span>    </span><span id="local-6989586621683083531"><span class="annot"><span class="annottext">tc_mono_info :: MonoBindInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcId)
</span><a href="#local-6989586621683083531"><span class="hs-identifier hs-var hs-var">tc_mono_info</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_poly_name :: MonoBindInfo -&gt; Name
</span><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083534"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083534"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_id :: MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083536"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083536"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_mult :: MonoBindInfo -&gt; Kind
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_mult"><span class="hs-identifier hs-var">mbi_mono_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083538"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083538"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083539"><span class="annot"><a href="#local-6989586621683083539"><span class="hs-identifier hs-var">_specs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; [LSig GhcRn] -&gt; TcM [LTcSpecPrag]
</span><a href="GHC.Tc.Gen.Sig.html#tcSpecPrags"><span class="hs-identifier hs-var">tcSpecPrags</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083536"><span class="hs-identifier hs-var">mono_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPragEnv -&gt; Name -&gt; [LSig GhcRn]
</span><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083523"><span class="hs-identifier hs-var">prag_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083534"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083538"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083536"><span class="hs-identifier hs-type">mono_id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-577"></span><span>           </span><span class="hs-comment">-- NB: tcPrags generates error messages for</span><span>
</span><span id="line-578"></span><span>           </span><span class="hs-comment">--     specialisation pragmas for non-overloaded sigs</span><span>
</span><span id="line-579"></span><span>           </span><span class="hs-comment">-- Indeed that is why we call it here!</span><span>
</span><span id="line-580"></span><span>           </span><span class="hs-comment">-- So we can safely ignore _specs</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                         tcPolyCheck
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcPolyCheck"><span class="hs-identifier hs-type">tcPolyCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>
</span><span id="line-590"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcCompleteSig"><span class="hs-identifier hs-type">TcCompleteSig</span></a></span><span>
</span><span id="line-591"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="hs-comment">-- Must be a FunBind</span><span>
</span><span id="line-592"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- There is just one binding,</span><span>
</span><span id="line-594"></span><span class="hs-comment">--   it is a FunBind</span><span>
</span><span id="line-595"></span><span class="hs-comment">--   it has a complete type signature,</span><span>
</span><span id="line-596"></span><span id="tcPolyCheck"><span class="annot"><span class="annottext">tcPolyCheck :: TcPragEnv
-&gt; TcCompleteSig
-&gt; LHsBindLR GhcRn GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyCheck"><span class="hs-identifier hs-var hs-var">tcPolyCheck</span></a></span></span><span> </span><span id="local-6989586621683083542"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083542"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span>
</span><span id="line-597"></span><span>            </span><span id="local-6989586621683083543"><span class="annot"><span class="annottext">sig :: TcCompleteSig
</span><a href="#local-6989586621683083543"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#CSig"><span class="hs-identifier hs-type">CSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndr :: TcCompleteSig -&gt; TcId
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_bndr"><span class="hs-identifier hs-var">sig_bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083546"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083546"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_ctxt :: TcCompleteSig -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_ctxt"><span class="hs-identifier hs-var">sig_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083548"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683083548"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683083549"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083549"><span class="hs-identifier hs-var">bind_loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683083551"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683083551"><span class="hs-identifier hs-var">nm_loc</span></a></span></span><span> </span><span id="local-6989586621683083552"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083552"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-599"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_matches :: forall idL idR. HsBindLR idL idR -&gt; MatchGroup idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083554"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083554"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPolyCheck&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCompleteSig -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683083543"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>       </span><span class="hs-comment">-- Make a new Name, whose SrcSpan is nm_loc.  For a ClassOp</span><span>
</span><span id="line-603"></span><span>       </span><span class="hs-comment">-- The original Name, in the FunBind{fun_id}, is bound in the</span><span>
</span><span id="line-604"></span><span>       </span><span class="hs-comment">-- class declaration, whereas we want a Name bound right here.</span><span>
</span><span id="line-605"></span><span>       </span><span class="hs-comment">-- We pass mono_name to tcFunBindMatches which in turn puts it in</span><span>
</span><span id="line-606"></span><span>       </span><span class="hs-comment">-- the BinderStack, whence it shows up in &quot;Relevant bindings..&quot;</span><span>
</span><span id="line-607"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083555"><span class="annot"><a href="#local-6989586621683083555"><span class="hs-identifier hs-var">mono_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; SrcSpan -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-var">newNameAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083552"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683083551"><span class="hs-identifier hs-var">nm_loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083558"><span class="annot"><a href="#local-6989586621683083558"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-type">tcMultAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsNoMultAnn"><span class="hs-identifier hs-type">HsNoMultAnn</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083562"><span class="annot"><a href="#local-6989586621683083562"><span class="hs-identifier hs-var">wrap_gen</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083563"><span class="annot"><a href="#local-6989586621683083563"><span class="hs-identifier hs-var">wrap_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083564"><span class="annot"><a href="#local-6989586621683083564"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSkolemiseCompleteSig"><span class="hs-identifier hs-type">tcSkolemiseCompleteSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083543"><span class="hs-identifier hs-type">sig</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683083566"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621683083566"><span class="hs-identifier hs-var">invis_pat_tys</span></a></span></span><span> </span><span id="local-6989586621683083567"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083567"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083568"><span class="annot"><span class="annottext">mono_id :: TcId
</span><a href="#local-6989586621683083568"><span class="hs-identifier hs-var hs-var">mono_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Kind -&gt; Kind -&gt; TcId
Name -&gt; Kind -&gt; Kind -&gt; TcId
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083555"><span class="hs-identifier hs-var">mono_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Var.html#varMult"><span class="hs-identifier hs-var">varMult</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083546"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083567"><span class="hs-identifier hs-var">rho_ty</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-614"></span><span>                </span><span class="annot"><span class="annottext">[TcBinder]
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall a. [TcBinder] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendBinderStack"><span class="hs-identifier hs-var">tcExtendBinderStack</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcId -&gt; TopLevelFlag -&gt; TcBinder
</span><a href="GHC.Tc.Types.BasicTypes.html#TcIdBndr"><span class="hs-identifier hs-var">TcIdBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083568"><span class="hs-identifier hs-var">mono_id</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
 -&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc)))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-615"></span><span>                </span><span class="hs-comment">-- Why mono_id in the BinderStack?</span><span>
</span><span id="line-616"></span><span>                </span><span class="hs-comment">-- See Note [Relevant bindings and the binder stack]</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span>                </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083549"><span class="hs-identifier hs-var">bind_loc</span></a></span><span>  </span><span class="annot"><span class="annottext">(TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
 -&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc)))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-619"></span><span>                </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; Name
-&gt; Kind
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; [ExpPatType]
-&gt; ExpSigmaType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcFunBindMatches"><span class="hs-identifier hs-var">tcFunBindMatches</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683083548"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083555"><span class="hs-identifier hs-var">mono_name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083558"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083554"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621683083566"><span class="hs-identifier hs-var">invis_pat_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083567"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span>       </span><span class="hs-comment">-- We make a funny AbsBinds, abstracting over nothing,</span><span>
</span><span id="line-622"></span><span>       </span><span class="hs-comment">-- just so we have somewhere to put the SpecPrags.</span><span>
</span><span id="line-623"></span><span>       </span><span class="hs-comment">-- Otherwise we could just use the FunBind</span><span>
</span><span id="line-624"></span><span>       </span><span class="hs-comment">-- Hence poly_id2 is just a clone of poly_id;</span><span>
</span><span id="line-625"></span><span>       </span><span class="hs-comment">-- We re-use mono-name, but we could equally well use a fresh one</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083574"><span class="annot"><a href="#local-6989586621683083574"><span class="hs-identifier hs-var hs-var">prag_sigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPragEnv -&gt; Name -&gt; [LSig GhcRn]
</span><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083542"><span class="hs-identifier hs-var">prag_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083552"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-628"></span><span>             </span><span id="local-6989586621683083575"><span class="annot"><a href="#local-6989586621683083575"><span class="hs-identifier hs-var hs-var">poly_id2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Kind -&gt; Kind -&gt; TcId
Name -&gt; Kind -&gt; Kind -&gt; TcId
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083555"><span class="hs-identifier hs-var">mono_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idMult"><span class="hs-identifier hs-var">idMult</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083546"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083546"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083577"><span class="annot"><a href="#local-6989586621683083577"><span class="hs-identifier hs-var">spec_prags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#tcSpecPrags"><span class="hs-identifier hs-type">tcSpecPrags</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621683083546"><span class="hs-identifier hs-type">poly_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083574"><span class="hs-identifier hs-type">prag_sigs</span></a></span><span>
</span><span id="line-630"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083578"><span class="annot"><a href="#local-6989586621683083578"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#addInlinePrags"><span class="hs-identifier hs-type">addInlinePrags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083546"><span class="hs-identifier hs-type">poly_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083574"><span class="hs-identifier hs-type">prag_sigs</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083580"><span class="annot"><a href="#local-6989586621683083580"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span>
</span><span id="line-633"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083582"><span class="annot"><a href="#local-6989586621683083582"><span class="hs-identifier hs-var">tick</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#funBindTicks"><span class="hs-identifier hs-type">funBindTicks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083551"><span class="hs-identifier hs-type">nm_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083578"><span class="hs-identifier hs-type">poly_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083580"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083574"><span class="hs-identifier hs-type">prag_sigs</span></a></span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083584"><span class="annot"><a href="#local-6989586621683083584"><span class="hs-identifier hs-var hs-var">bind'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: LIdP GhcTc
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; TcId -&gt; GenLocated SrcSpanAnnN TcId
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683083551"><span class="hs-identifier hs-var">nm_loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083575"><span class="hs-identifier hs-var">poly_id2</span></a></span><span>
</span><span id="line-636"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_matches :: MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683083564"><span class="hs-identifier hs-var">matches'</span></a></span><span>
</span><span id="line-637"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_ext :: XFunBind GhcTc GhcTc
</span><a href="Language.Haskell.Syntax.Binds.html#fun_ext"><span class="hs-identifier hs-var">fun_ext</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683083562"><span class="hs-identifier hs-var">wrap_gen</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683083563"><span class="hs-identifier hs-var">wrap_res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683083582"><span class="hs-identifier hs-var">tick</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>             </span><span id="local-6989586621683083585"><span class="annot"><a href="#local-6989586621683083585"><span class="hs-keyword hs-var hs-var">export</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abe_wrap :: HsWrapper
</span><a href="GHC.Hs.Binds.html#abe_wrap"><span class="hs-identifier hs-var">abe_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-640"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_poly :: TcId
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083578"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-641"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_mono :: TcId
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083575"><span class="hs-identifier hs-var">poly_id2</span></a></span><span>
</span><span id="line-642"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_prags :: TcSpecPrags
</span><a href="GHC.Hs.Binds.html#abe_prags"><span class="hs-identifier hs-var">abe_prags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LTcSpecPrag] -&gt; TcSpecPrags
</span><a href="GHC.Hs.Binds.html#SpecPrags"><span class="hs-identifier hs-var">SpecPrags</span></a></span><span> </span><span class="annot"><span class="annottext">[LTcSpecPrag]
</span><a href="#local-6989586621683083577"><span class="hs-identifier hs-var">spec_prags</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>             </span><span id="local-6989586621683083592"><span class="annot"><a href="#local-6989586621683083592"><span class="hs-identifier hs-var hs-var">abs_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsBindLR GhcTc GhcTc
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083549"><span class="hs-identifier hs-var">bind_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(HsBindLR GhcTc GhcTc
 -&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc))
-&gt; HsBindLR GhcTc GhcTc
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XXHsBindsLR GhcTc GhcTc -&gt; HsBindLR GhcTc GhcTc
forall idL idR. XXHsBindsLR idL idR -&gt; HsBindLR idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#XHsBindsLR"><span class="hs-identifier hs-var">XHsBindsLR</span></a></span><span> </span><span class="annot"><span class="annottext">(XXHsBindsLR GhcTc GhcTc -&gt; HsBindLR GhcTc GhcTc)
-&gt; XXHsBindsLR GhcTc GhcTc -&gt; HsBindLR GhcTc GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-645"></span><span>                        </span><span class="annot"><a href="GHC.Hs.Binds.html#AbsBinds"><span class="hs-identifier hs-type">AbsBinds</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abs_tvs :: [TcId]
</span><a href="GHC.Hs.Binds.html#abs_tvs"><span class="hs-identifier hs-var">abs_tvs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-646"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_ev_vars :: [TcId]
</span><a href="GHC.Hs.Binds.html#abs_ev_vars"><span class="hs-identifier hs-var">abs_ev_vars</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-647"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_ev_binds :: [TcEvBinds]
</span><a href="GHC.Hs.Binds.html#abs_ev_binds"><span class="hs-identifier hs-var">abs_ev_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-648"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_exports :: [ABExport]
</span><a href="GHC.Hs.Binds.html#abs_exports"><span class="hs-identifier hs-var">abs_exports</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ABExport
</span><a href="#local-6989586621683083585"><span class="hs-keyword hs-var">export</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-649"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_binds :: LHsBinds GhcTc
</span><a href="GHC.Hs.Binds.html#abs_binds"><span class="hs-identifier hs-var">abs_binds</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsBindLR GhcTc GhcTc
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083549"><span class="hs-identifier hs-var">bind_loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc
</span><a href="#local-6989586621683083584"><span class="hs-identifier hs-var">bind'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_sig :: Bool
</span><a href="GHC.Hs.Binds.html#abs_sig"><span class="hs-identifier hs-var">abs_sig</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683083592"><span class="hs-identifier hs-type">abs_bind</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083558"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083578"><span class="hs-identifier hs-type">poly_id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcPolyCheck"><span class="hs-identifier hs-var">tcPolyCheck</span></a></span><span> </span><span id="local-6989586621683083601"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083601"><span class="hs-identifier hs-var">_prag_fn</span></a></span></span><span> </span><span id="local-6989586621683083602"><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683083602"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621683083603"><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683083603"><span class="hs-identifier hs-var">bind</span></a></span></span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)], [Scaled TcId])
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPolyCheck&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCompleteSig -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683083602"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683083603"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#funBindTicks"><span class="hs-identifier hs-type">funBindTicks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-658"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-659"></span><span id="funBindTicks"><span class="annot"><span class="annottext">funBindTicks :: SrcSpan -&gt; TcId -&gt; Module -&gt; [LSig GhcRn] -&gt; TcM [CoreTickish]
</span><a href="GHC.Tc.Gen.Bind.html#funBindTicks"><span class="hs-identifier hs-var hs-var">funBindTicks</span></a></span></span><span> </span><span id="local-6989586621683083605"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683083605"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683083606"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083606"><span class="hs-identifier hs-var">fun_id</span></a></span></span><span> </span><span id="local-6989586621683083607"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683083607"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621683083608"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621683083608"><span class="hs-identifier hs-var">sigs</span></a></span></span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083609"><span class="annot"><span class="annottext">Maybe (GenLocated EpAnnCO StringLiteral)
</span><a href="#local-6989586621683083609"><span class="hs-identifier hs-var">mb_cc_str</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (GenLocated EpAnnCO StringLiteral)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Maybe (XRec GhcRn StringLiteral)
Maybe (GenLocated EpAnnCO StringLiteral)
</span><a href="#local-6989586621683083610"><span class="hs-identifier hs-var">cc_name</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#SCCFunSig"><span class="hs-identifier hs-type">SCCFunSig</span></a></span><span> </span><span class="annot"><span class="annottext">XSCCFunSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083610"><span class="annot"><span class="annottext">Maybe (XRec GhcRn StringLiteral)
</span><a href="#local-6989586621683083610"><span class="hs-identifier hs-var">cc_name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
[GenLocated SrcSpanAnnA (Sig GhcRn)]
</span><a href="#local-6989586621683083608"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-661"></span><span>      </span><span class="hs-comment">-- this can only be a singleton list, as duplicate pragmas are rejected</span><span>
</span><span id="line-662"></span><span>      </span><span class="hs-comment">-- by the renamer</span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083612"><span class="annot"><span class="annottext">cc_str :: FastString
</span><a href="#local-6989586621683083612"><span class="hs-identifier hs-var hs-var">cc_str</span></a></span></span><span>
</span><span id="line-664"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083613"><span class="annot"><span class="annottext">GenLocated EpAnnCO StringLiteral
</span><a href="#local-6989586621683083613"><span class="hs-identifier hs-var">cc_str</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated EpAnnCO StringLiteral)
</span><a href="#local-6989586621683083609"><span class="hs-identifier hs-var">mb_cc_str</span></a></span><span>
</span><span id="line-665"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StringLiteral -&gt; FastString
</span><a href="GHC.Types.SourceText.html#sl_fs"><span class="hs-identifier hs-var">sl_fs</span></a></span><span> </span><span class="annot"><span class="annottext">(StringLiteral -&gt; FastString) -&gt; StringLiteral -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenLocated EpAnnCO StringLiteral -&gt; StringLiteral
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated EpAnnCO StringLiteral
</span><a href="#local-6989586621683083613"><span class="hs-identifier hs-var">cc_str</span></a></span><span>
</span><span id="line-666"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-667"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; FastString
forall a. NamedThing a =&gt; a -&gt; FastString
</span><a href="GHC.Types.Name.html#getOccFS"><span class="hs-identifier hs-var">getOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Name
</span><a href="GHC.Types.Var.html#varName"><span class="hs-identifier hs-var">Var.varName</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083606"><span class="hs-identifier hs-var">fun_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>        </span><span id="local-6989586621683083617"><span class="annot"><span class="annottext">cc_name :: FastString
</span><a href="#local-6989586621683083617"><span class="hs-identifier hs-var hs-var">cc_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; FastString
</span><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier hs-var">concatFS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModuleName -&gt; FastString
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683083607"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683083612"><span class="hs-identifier hs-var">cc_str</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-670"></span><span>      </span><span id="local-6989586621683083622"><span class="annot"><a href="#local-6989586621683083622"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CostCentreIndex -&gt; CCFlavour
</span><a href="GHC.Types.CostCentre.html#mkDeclCCFlavour"><span class="hs-identifier hs-var">mkDeclCCFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">(CostCentreIndex -&gt; CCFlavour)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) CostCentreIndex
-&gt; IOEnv (Env TcGblEnv TcLclEnv) CCFlavour
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; IOEnv (Env TcGblEnv TcLclEnv) CostCentreIndex
</span><a href="GHC.Tc.Utils.Monad.html#getCCIndexTcM"><span class="hs-identifier hs-var">getCCIndexTcM</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683083617"><span class="hs-identifier hs-var">cc_name</span></a></span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083625"><span class="annot"><a href="#local-6989586621683083625"><span class="hs-identifier hs-var hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Module -&gt; SrcSpan -&gt; CCFlavour -&gt; CostCentre
</span><a href="GHC.Types.CostCentre.html#mkUserCC"><span class="hs-identifier hs-var">mkUserCC</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683083617"><span class="hs-identifier hs-var">cc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683083607"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683083605"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">CCFlavour
</span><a href="#local-6989586621683083622"><span class="hs-identifier hs-var">flavour</span></a></span><span>
</span><span id="line-672"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#ProfNote"><span class="hs-identifier hs-type">ProfNote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083625"><span class="hs-identifier hs-type">cc</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">]</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; TcM [CoreTickish]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span class="hs-comment">{- Note [Instantiate sig with fresh variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's vital to instantiate a type signature with fresh variables.
For example:
      type T = forall a. [a] -&gt; [a]
      f :: T;
      f = g where { g :: T; g = &lt;rhs&gt; }

 We must not use the same 'a' from the defn of T at both places!!
(Instantiation is only necessary because of type synonyms.  Otherwise,
it's all cool; each signature has distinct type variables from the renamer.)
-}</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                         tcPolyInfer
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="hs-comment">{- Note [Non-variable pattern bindings aren't linear]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A fundamental limitation of the typechecking algorithm is that we cannot have a
binding which, at the same time,
- is linear in its rhs
- is a non-variable pattern
- binds variables to polymorphic or qualified types

A detailed explanation can be found at:
https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0111-linear-types.rst#let-bindings-and-polymorphism

To address this we to do a few things

- When a pattern is annotated with a multiplicity annotation `let %q pat = rhs
  in body` (note: multiplicity-annotated bindings are always parsed as a
  PatBind, see Note [Multiplicity annotations] in Language.Haskell.Syntax.Binds),
  then the let is never generalised (we use the NoGen plan).
- Whenever the typechecker infers an AbsBind *and* the inner binding is a
  non-variable PatBind, then the multiplicity of the binding is inferred to be
  Many. This is a little infelicitous: sometimes the typechecker infers an
  AbsBind where it didn't need to. This may cause some programs to be spuriously
  rejected, when NoMonoLocalBinds is on.
- LinearLet implies MonoLocalBinds to avoid the AbsBind case altogether.

-}</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcPolyInfer"><span class="hs-identifier hs-type">tcPolyInfer</span></a></span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span>       </span><span class="hs-comment">-- Whether it's recursive after breaking</span><span>
</span><span id="line-725"></span><span>                   </span><span class="hs-comment">-- dependencies based on type signatures</span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span id="tcPolyInfer"><span class="annot"><span class="annottext">tcPolyInfer :: RecFlag
-&gt; TcPragEnv
-&gt; TcSigFun
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [Scaled TcId])
</span><a href="GHC.Tc.Gen.Bind.html#tcPolyInfer"><span class="hs-identifier hs-var hs-var">tcPolyInfer</span></a></span></span><span> </span><span id="local-6989586621683083627"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083627"><span class="hs-identifier hs-var">rec_tc</span></a></span></span><span> </span><span id="local-6989586621683083628"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083628"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span id="local-6989586621683083629"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083629"><span class="hs-identifier hs-var">tc_sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083630"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083630"><span class="hs-identifier hs-var">bind_list</span></a></span></span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083631"><span class="annot"><a href="#local-6989586621683083631"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083632"><span class="annot"><a href="#local-6989586621683083632"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083633"><span class="annot"><a href="#local-6989586621683083633"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083634"><span class="annot"><a href="#local-6989586621683083634"><span class="hs-identifier hs-var">mono_infos</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsBinds GhcTc, [MonoBindInfo])
-&gt; TcM
     (TcLevel, WantedConstraints, (LHsBinds GhcTc, [MonoBindInfo]))
forall a. TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var">pushLevelAndCaptureConstraints</span></a></span><span>  </span><span class="annot"><span class="annottext">(TcM (LHsBinds GhcTc, [MonoBindInfo])
 -&gt; TcM
      (TcLevel, WantedConstraints, (LHsBinds GhcTc, [MonoBindInfo])))
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
-&gt; TcM
     (TcLevel, WantedConstraints, (LHsBinds GhcTc, [MonoBindInfo]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-732"></span><span>                </span><span class="annot"><span class="annottext">RecFlag
-&gt; TcSigFun
-&gt; LetBndrSpec
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
</span><a href="GHC.Tc.Gen.Bind.html#tcMonoBinds"><span class="hs-identifier hs-var">tcMonoBinds</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083627"><span class="hs-identifier hs-var">rec_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083629"><span class="hs-identifier hs-var">tc_sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083630"><span class="hs-identifier hs-var">bind_list</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083637"><span class="annot"><a href="#local-6989586621683083637"><span class="hs-identifier hs-var">apply_mr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#checkMonomorphismRestriction"><span class="hs-identifier hs-type">checkMonomorphismRestriction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083634"><span class="hs-identifier hs-type">mono_infos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083630"><span class="hs-identifier hs-type">bind_list</span></a></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span>       </span><span class="hs-comment">-- AbsBinds which are PatBinds can't be linear.</span><span>
</span><span id="line-737"></span><span>       </span><span class="hs-comment">-- See Note [Non-variable pattern bindings aren't linear]</span><span>
</span><span id="line-738"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083639"><span class="annot"><a href="#local-6989586621683083639"><span class="hs-identifier hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683083640"><span class="hs-identifier hs-type">manyIfPats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083633"><span class="hs-identifier hs-type">binds'</span></a></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcPolyInfer&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083637"><span class="hs-identifier hs-type">apply_mr</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083634"><span class="hs-identifier hs-type">mono_infos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083642"><span class="annot"><a href="#local-6989586621683083642"><span class="hs-identifier hs-var hs-var">name_taus</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MonoBindInfo -&gt; Name
</span><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683083643"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683083643"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083643"><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683083643"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683083634"><span class="hs-identifier hs-var">mono_infos</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-744"></span><span>             </span><span id="local-6989586621683083644"><span class="annot"><a href="#local-6989586621683083644"><span class="hs-identifier hs-var hs-var">sigs</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083645"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_sig :: MonoBindInfo -&gt; Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083645"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083645"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683083634"><span class="hs-identifier hs-var">mono_infos</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-745"></span><span>             </span><span id="local-6989586621683083646"><span class="annot"><a href="#local-6989586621683083646"><span class="hs-identifier hs-var hs-var">infer_mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683083637"><span class="hs-identifier hs-var">apply_mr</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#ApplyMR"><span class="hs-identifier hs-var">ApplyMR</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#NoRestrictions"><span class="hs-identifier hs-var">NoRestrictions</span></a></span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;simplifyInfer call&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083631"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083642"><span class="hs-identifier hs-type">name_taus</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083632"><span class="hs-identifier hs-type">wanted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683083649"><span class="annot"><a href="#local-6989586621683083649"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083650"><span class="annot"><a href="#local-6989586621683083650"><span class="hs-identifier hs-var">givens</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083651"><span class="annot"><a href="#local-6989586621683083651"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083652"><span class="annot"><a href="#local-6989586621683083652"><span class="hs-identifier hs-var">insoluble</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083653"><span class="annot"><a href="#local-6989586621683083653"><span class="hs-identifier hs-var">residual</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyInfer"><span class="hs-identifier hs-type">simplifyInfer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083631"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083646"><span class="hs-identifier hs-type">infer_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083644"><span class="hs-identifier hs-type">sigs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083642"><span class="hs-identifier hs-type">name_taus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083632"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083656"><span class="annot"><a href="#local-6989586621683083656"><span class="hs-identifier hs-var hs-var">inferred_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcId -&gt; Kind) -&gt; [TcId] -&gt; TcThetaType
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Tc.Utils.TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a></span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083650"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-752"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083658"><span class="annot"><a href="#local-6989586621683083658"><span class="hs-identifier hs-var">scaled_exports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-type">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-753"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mkExport"><span class="hs-identifier hs-type">mkExport</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083628"><span class="hs-identifier hs-type">prag_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083653"><span class="hs-identifier hs-type">residual</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083652"><span class="hs-identifier hs-type">insoluble</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083649"><span class="hs-identifier hs-type">qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083656"><span class="hs-identifier hs-type">inferred_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083634"><span class="hs-identifier hs-type">mono_infos</span></a></span><span>
</span><span id="line-754"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083661"><span class="annot"><a href="#local-6989586621683083661"><span class="hs-identifier hs-var hs-var">exports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled ABExport -&gt; ABExport) -&gt; [Scaled ABExport] -&gt; [ABExport]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled ABExport -&gt; ABExport
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled ABExport]
</span><a href="#local-6989586621683083658"><span class="hs-identifier hs-var">scaled_exports</span></a></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>         </span><span class="hs-comment">-- NB: *after* the checkNoErrs call above. This ensures that we don't get an error</span><span>
</span><span id="line-757"></span><span>         </span><span class="hs-comment">-- cascade in case mkExport runs into trouble. In particular, this avoids duplicate</span><span>
</span><span id="line-758"></span><span>         </span><span class="hs-comment">-- errors when a partial type signature cannot be quantified in chooseInferredQuantifiers.</span><span>
</span><span id="line-759"></span><span>         </span><span class="hs-comment">-- See Note [Quantification and partial signatures] in GHC.Tc.Solver, Wrinkle 4.</span><span>
</span><span id="line-760"></span><span>         </span><span class="hs-comment">-- Tested in partial-sigs/should_fail/NamedWilcardExplicitForall.</span><span>
</span><span id="line-761"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-type">emitConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083653"><span class="hs-identifier hs-type">residual</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083663"><span class="annot"><a href="#local-6989586621683083663"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span>
</span><span id="line-764"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083665"><span class="annot"><a href="#local-6989586621683083665"><span class="hs-identifier hs-var hs-var">scaled_poly_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; TcId -&gt; Scaled TcId
forall a. Kind -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083666"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABExport -&gt; TcId
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="annot"><span class="annottext">ABExport
</span><a href="#local-6989586621683083667"><span class="hs-keyword hs-var">export</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621683083666"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083666"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683083667"><span class="annot"><span class="annottext">ABExport
</span><a href="#local-6989586621683083667"><span class="hs-keyword hs-var">export</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Scaled ABExport]
</span><a href="#local-6989586621683083658"><span class="hs-identifier hs-var">scaled_exports</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-765"></span><span>             </span><span id="local-6989586621683083668"><span class="annot"><a href="#local-6989586621683083668"><span class="hs-identifier hs-var hs-var">poly_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled TcId -&gt; TcId) -&gt; [Scaled TcId] -&gt; [TcId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled TcId -&gt; TcId
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcId]
</span><a href="#local-6989586621683083665"><span class="hs-identifier hs-var">scaled_poly_ids</span></a></span><span>
</span><span id="line-766"></span><span>             </span><span id="local-6989586621683083669"><span class="annot"><a href="#local-6989586621683083669"><span class="hs-identifier hs-var hs-var">abs_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsBindLR GhcTc GhcTc
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683083663"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HsBindLR GhcTc GhcTc
 -&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc))
-&gt; HsBindLR GhcTc GhcTc
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XXHsBindsLR GhcTc GhcTc -&gt; HsBindLR GhcTc GhcTc
forall idL idR. XXHsBindsLR idL idR -&gt; HsBindLR idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#XHsBindsLR"><span class="hs-identifier hs-var">XHsBindsLR</span></a></span><span> </span><span class="annot"><span class="annottext">(XXHsBindsLR GhcTc GhcTc -&gt; HsBindLR GhcTc GhcTc)
-&gt; XXHsBindsLR GhcTc GhcTc -&gt; HsBindLR GhcTc GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-767"></span><span>                        </span><span class="annot"><a href="GHC.Hs.Binds.html#AbsBinds"><span class="hs-identifier hs-type">AbsBinds</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abs_tvs :: [TcId]
</span><a href="GHC.Hs.Binds.html#abs_tvs"><span class="hs-identifier hs-var">abs_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083649"><span class="hs-identifier hs-var">qtvs</span></a></span><span>
</span><span id="line-768"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_ev_vars :: [TcId]
</span><a href="GHC.Hs.Binds.html#abs_ev_vars"><span class="hs-identifier hs-var">abs_ev_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083650"><span class="hs-identifier hs-var">givens</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_ev_binds :: [TcEvBinds]
</span><a href="GHC.Hs.Binds.html#abs_ev_binds"><span class="hs-identifier hs-var">abs_ev_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683083651"><span class="hs-identifier hs-var">ev_binds</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-769"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_exports :: [ABExport]
</span><a href="GHC.Hs.Binds.html#abs_exports"><span class="hs-identifier hs-var">abs_exports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683083661"><span class="hs-identifier hs-var">exports</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_binds :: LHsBinds GhcTc
</span><a href="GHC.Hs.Binds.html#abs_binds"><span class="hs-identifier hs-var">abs_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683083639"><span class="hs-identifier hs-var">binds'</span></a></span><span>
</span><span id="line-770"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_sig :: Bool
</span><a href="GHC.Hs.Binds.html#abs_sig"><span class="hs-identifier hs-var">abs_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Binding:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083668"><span class="hs-identifier hs-type">poly_ids</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`zip`</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083668"><span class="hs-identifier hs-type">poly_ids</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683083669"><span class="hs-identifier hs-type">abs_bind</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083665"><span class="hs-identifier hs-type">scaled_poly_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-774"></span><span>         </span><span class="hs-comment">-- poly_ids are guaranteed zonked by mkExport</span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-776"></span><span>    </span><span id="local-6989586621683083677"><span class="annot"><span class="annottext">manyIfPat :: GenLocated l (HsBindLR GhcTc idR)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated l (HsBindLR GhcTc idR))
</span><a href="#local-6989586621683083677"><span class="hs-identifier hs-var hs-var">manyIfPat</span></a></span></span><span> </span><span id="local-6989586621683083678"><span class="annot"><span class="annottext">bind :: GenLocated l (HsBindLR GhcTc idR)
</span><a href="#local-6989586621683083678"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">pat_lhs :: forall idL idR. HsBindLR idL idR -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsBindLR GhcTc idR)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated l (HsBindLR GhcTc idR))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsBindLR GhcTc idR)
</span><a href="#local-6989586621683083678"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-778"></span><span>    </span><span class="annot"><a href="#local-6989586621683083677"><span class="hs-identifier hs-var">manyIfPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683083681"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683083681"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683083682"><span class="annot"><span class="annottext">pat :: HsBindLR GhcTc idR
</span><a href="#local-6989586621683083682"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">pat_mult :: forall idL idR. HsBindLR idL idR -&gt; HsMultAnn idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_mult"><span class="hs-identifier hs-var">pat_mult</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683083684"><span class="annot"><span class="annottext">HsMultAnn GhcTc
</span><a href="#local-6989586621683083684"><span class="hs-identifier hs-var">mult_ann</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_lhs :: forall idL idR. HsBindLR idL idR -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683083685"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683083685"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_ext :: forall idL idR. HsBindLR idL idR -&gt; XPatBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#pat_ext"><span class="hs-identifier hs-var">pat_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span class="hs-special">(</span><span id="local-6989586621683083686"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083686"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083687"><span class="annot"><a href="#local-6989586621683083687"><span class="hs-identifier hs-var">mult_co_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Kind -&gt; Kind -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubMult"><span class="hs-identifier hs-var">tcSubMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonLinearPatternReason -&gt; XRec GhcRn (Pat GhcRn) -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#NonLinearPatternOrigin"><span class="hs-identifier hs-var">NonLinearPatternOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#GeneralisedPatternReason"><span class="hs-identifier hs-var">GeneralisedPatternReason</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="GHC.Hs.Utils.html#nlWildPatName"><span class="hs-identifier hs-var">nlWildPatName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsMultAnn GhcTc -&gt; Kind
</span><a href="GHC.Hs.Binds.html#getTcMultAnn"><span class="hs-identifier hs-var">getTcMultAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsMultAnn GhcTc
</span><a href="#local-6989586621683083684"><span class="hs-identifier hs-var">mult_ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>           </span><span class="hs-comment">-- The wrapper checks for correct multiplicities.</span><span>
</span><span id="line-781"></span><span>           </span><span class="hs-comment">-- See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-782"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083693"><span class="annot"><a href="#local-6989586621683083693"><span class="hs-identifier hs-var hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; LPat GhcTc -&gt; Kind -&gt; LPat GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrapPat"><span class="hs-identifier hs-var">mkLHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683083687"><span class="hs-identifier hs-var">mult_co_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683083685"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083686"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-783"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083681"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083682"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="#local-6989586621683083693"><span class="hs-identifier hs-type">lhs'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-784"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-785"></span><span>    </span><span class="annot"><a href="#local-6989586621683083677"><span class="hs-identifier hs-var">manyIfPat</span></a></span><span> </span><span id="local-6989586621683083695"><span class="annot"><span class="annottext">GenLocated l (HsBindLR GhcTc idR)
</span><a href="#local-6989586621683083695"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsBindLR GhcTc idR)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated l (HsBindLR GhcTc idR))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsBindLR GhcTc idR)
</span><a href="#local-6989586621683083695"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-786"></span><span>    </span><span id="local-6989586621683083640"><span class="annot"><span class="annottext">manyIfPats :: t (GenLocated l (HsBindLR GhcTc idR))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (t (GenLocated l (HsBindLR GhcTc idR)))
</span><a href="#local-6989586621683083640"><span class="hs-identifier hs-var hs-var">manyIfPats</span></a></span></span><span> </span><span id="local-6989586621683083708"><span class="annot"><span class="annottext">t (GenLocated l (HsBindLR GhcTc idR))
</span><a href="#local-6989586621683083708"><span class="hs-identifier hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated l (HsBindLR GhcTc idR)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated l (HsBindLR GhcTc idR)))
-&gt; t (GenLocated l (HsBindLR GhcTc idR))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (t (GenLocated l (HsBindLR GhcTc idR)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsBindLR GhcTc idR)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated l (HsBindLR GhcTc idR))
forall {idR} {b} {l}.
(XPatBind GhcTc idR ~ (Kind, b)) =&gt;
GenLocated l (HsBindLR GhcTc idR)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated l (HsBindLR GhcTc idR))
</span><a href="#local-6989586621683083677"><span class="hs-identifier hs-var">manyIfPat</span></a></span><span> </span><span class="annot"><span class="annottext">t (GenLocated l (HsBindLR GhcTc idR))
</span><a href="#local-6989586621683083708"><span class="hs-identifier hs-var">binds'</span></a></span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#checkMonomorphismRestriction"><span class="hs-identifier hs-type">checkMonomorphismRestriction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-789"></span><span class="hs-comment">-- True &lt;=&gt; apply the MR</span><span>
</span><span id="line-790"></span><span class="hs-comment">-- See Note [When the MR applies]</span><span>
</span><span id="line-791"></span><span id="checkMonomorphismRestriction"><span class="annot"><span class="annottext">checkMonomorphismRestriction :: [MonoBindInfo] -&gt; LHsBinds GhcRn -&gt; TcM Bool
</span><a href="GHC.Tc.Gen.Bind.html#checkMonomorphismRestriction"><span class="hs-identifier hs-var hs-var">checkMonomorphismRestriction</span></a></span></span><span> </span><span id="local-6989586621683083710"><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683083710"><span class="hs-identifier hs-var">mbis</span></a></span></span><span> </span><span id="local-6989586621683083711"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083711"><span class="hs-identifier hs-var">lbinds</span></a></span></span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083712"><span class="annot"><a href="#local-6989586621683083712"><span class="hs-identifier hs-var">mr_on</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcM Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.MonomorphismRestriction</span></span><span>
</span><span id="line-793"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083715"><span class="annot"><a href="#local-6989586621683083715"><span class="hs-identifier hs-var hs-var">mr_applies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683083712"><span class="hs-identifier hs-var">mr_on</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBind GhcRn -&gt; Bool
</span><a href="#local-6989586621683083718"><span class="hs-identifier hs-var">restricted</span></a></span><span> </span><span class="annot"><span class="annottext">(HsBind GhcRn -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; HsBind GhcRn)
-&gt; GenLocated SrcSpanAnnA (HsBind GhcRn)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; HsBind GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083711"><span class="hs-identifier hs-var">lbinds</span></a></span><span>
</span><span id="line-794"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621683083715"><span class="hs-identifier hs-type">mr_applies</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#checkOverloadedSig"><span class="hs-identifier hs-type">checkOverloadedSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083710"><span class="hs-identifier hs-type">mbis</span></a></span><span>
</span><span id="line-795"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683083715"><span class="hs-identifier hs-type">mr_applies</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-797"></span><span>    </span><span class="annot"><a href="#local-6989586621683083721"><span class="hs-identifier hs-type">no_mr_bndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>
</span><span id="line-798"></span><span>    </span><span id="local-6989586621683083721"><span class="annot"><span class="annottext">no_mr_bndrs :: NameSet
</span><a href="#local-6989586621683083721"><span class="hs-identifier hs-var hs-var">no_mr_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MonoBindInfo -&gt; Maybe Name) -&gt; [MonoBindInfo] -&gt; [Name]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo -&gt; Maybe Name
</span><a href="#local-6989586621683083724"><span class="hs-identifier hs-var">no_mr_name</span></a></span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683083710"><span class="hs-identifier hs-var">mbis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>    </span><span class="annot"><a href="#local-6989586621683083724"><span class="hs-identifier hs-type">no_mr_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-comment">-- Just n for binders that have a signature that says &quot;no MR needed for me&quot;</span><span>
</span><span id="line-802"></span><span>    </span><span id="local-6989586621683083724"><span class="annot"><span class="annottext">no_mr_name :: MonoBindInfo -&gt; Maybe Name
</span><a href="#local-6989586621683083724"><span class="hs-identifier hs-var hs-var">no_mr_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_sig :: MonoBindInfo -&gt; Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083725"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083725"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TISI"><span class="hs-identifier hs-type">TISI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_inst_sig :: TcIdSigInst -&gt; TcIdSig
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_sig"><span class="hs-identifier hs-var">sig_inst_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083728"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083728"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_theta :: TcIdSigInst -&gt; TcThetaType
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_theta"><span class="hs-identifier hs-var">sig_inst_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083730"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083730"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_wcx :: TcIdSigInst -&gt; Maybe Kind
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_wcx"><span class="hs-identifier hs-var">sig_inst_wcx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083732"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621683083732"><span class="hs-identifier hs-var">wcx</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083725"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-804"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083728"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-805"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcCompleteSig"><span class="hs-identifier hs-type">TcCompleteSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#CSig"><span class="hs-identifier hs-type">CSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndr :: TcCompleteSig -&gt; TcId
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_bndr"><span class="hs-identifier hs-var">sig_bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083734"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083734"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083734"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-806"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcPartialSig"><span class="hs-identifier hs-type">TcPartialSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#PSig"><span class="hs-identifier hs-type">PSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">psig_name :: TcPartialSig -&gt; Name
</span><a href="GHC.Tc.Types.BasicTypes.html#psig_name"><span class="hs-identifier hs-var">psig_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083738"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083738"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcThetaType -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083730"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Kind -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621683083732"><span class="hs-identifier hs-var">wcx</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-comment">-- f :: _ -&gt; _</span><span>
</span><span id="line-808"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083738"><span class="hs-identifier hs-var">nm</span></a></span><span>  </span><span class="hs-comment">-- f :: Num a =&gt; a -&gt; _</span><span>
</span><span id="line-809"></span><span>             </span><span class="hs-comment">-- For the latter case, we don't want the MR:</span><span>
</span><span id="line-810"></span><span>             </span><span class="hs-comment">-- the user has explicitly specified a type-class context</span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><a href="#local-6989586621683083724"><span class="hs-identifier hs-var">no_mr_name</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>    </span><span class="hs-comment">-- The Haskell 98 monomorphism restriction</span><span>
</span><span id="line-814"></span><span>    </span><span class="annot"><a href="#local-6989586621683083718"><span class="hs-identifier hs-type">restricted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsBindLR"><span class="hs-identifier hs-type">HsBindLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-815"></span><span>    </span><span id="local-6989586621683083718"><span class="annot"><span class="annottext">restricted :: HsBind GhcRn -&gt; Bool
</span><a href="#local-6989586621683083718"><span class="hs-identifier hs-var hs-var">restricted</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-816"></span><span>    </span><span class="annot"><a href="#local-6989586621683083718"><span class="hs-identifier hs-var">restricted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083740"><span class="annot"><span class="annottext">LIdP GhcRn
</span><a href="#local-6989586621683083740"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_matches :: forall idL idR. HsBindLR idL idR -&gt; MatchGroup idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083741"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083741"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; Bool
forall {id :: Pass} {body}. MatchGroup (GhcPass id) body -&gt; Bool
</span><a href="#local-6989586621683083742"><span class="hs-identifier hs-var">restricted_match</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621683083741"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-817"></span><span>                                                           </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683083743"><span class="hs-identifier hs-var">mr_needed_for</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621683083740"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>    </span><span class="annot"><a href="#local-6989586621683083718"><span class="hs-identifier hs-var">restricted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#VarBind"><span class="hs-identifier hs-type">VarBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">var_ext :: forall idL idR. HsBindLR idL idR -&gt; XVarBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#var_ext"><span class="hs-identifier hs-var">var_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083746"><span class="annot"><span class="annottext">XVarBind GhcRn GhcRn
</span><a href="#local-6989586621683083746"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataConCantHappen -&gt; Bool
forall a. DataConCantHappen -&gt; a
</span><a href="Language.Haskell.Syntax.Extension.html#dataConCantHappen"><span class="hs-identifier hs-var">dataConCantHappen</span></a></span><span> </span><span class="annot"><span class="annottext">XVarBind GhcRn GhcRn
DataConCantHappen
</span><a href="#local-6989586621683083746"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-819"></span><span>    </span><span class="annot"><a href="#local-6989586621683083718"><span class="hs-identifier hs-var">restricted</span></a></span><span> </span><span id="local-6989586621683083748"><span class="annot"><span class="annottext">b :: HsBind GhcRn
</span><a href="#local-6989586621683083748"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatSynBind"><span class="hs-identifier hs-type">PatSynBind</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;isRestrictedGroup/unrestricted&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBind GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBind GhcRn
</span><a href="#local-6989586621683083748"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>    </span><span id="local-6989586621683083742"><span class="annot"><span class="annottext">restricted_match :: MatchGroup (GhcPass id) body -&gt; Bool
</span><a href="#local-6989586621683083742"><span class="hs-identifier hs-var hs-var">restricted_match</span></a></span></span><span> </span><span id="local-6989586621683083753"><span class="annot"><span class="annottext">MatchGroup (GhcPass id) body
</span><a href="#local-6989586621683083753"><span class="hs-identifier hs-var">mg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup (GhcPass id) body -&gt; BKey
forall (id :: Pass) body. MatchGroup (GhcPass id) body -&gt; BKey
</span><a href="GHC.Hs.Expr.html#matchGroupArity"><span class="hs-identifier hs-var">matchGroupArity</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup (GhcPass id) body
</span><a href="#local-6989586621683083753"><span class="hs-identifier hs-var">mg</span></a></span><span> </span><span class="annot"><span class="annottext">BKey -&gt; BKey -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BKey
</span><span class="hs-number">0</span></span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-comment">-- No args =&gt; like a pattern binding</span><span>
</span><span id="line-823"></span><span>        </span><span class="hs-comment">-- Some args =&gt; a function binding</span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>    </span><span id="local-6989586621683083743"><span class="annot"><span class="annottext">mr_needed_for :: Name -&gt; Bool
</span><a href="#local-6989586621683083743"><span class="hs-identifier hs-var hs-var">mr_needed_for</span></a></span></span><span> </span><span id="local-6989586621683083755"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083755"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083755"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683083721"><span class="hs-identifier hs-var">no_mr_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#checkOverloadedSig"><span class="hs-identifier hs-type">checkOverloadedSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-829"></span><span class="hs-comment">--   f :: Eq a =&gt; a -&gt; a</span><span>
</span><span id="line-830"></span><span class="hs-comment">--   K f = e</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- The MR applies, but the signature is overloaded, and it's</span><span>
</span><span id="line-832"></span><span class="hs-comment">-- best to complain about this directly</span><span>
</span><span id="line-833"></span><span class="hs-comment">-- c.f #11339</span><span>
</span><span id="line-834"></span><span id="checkOverloadedSig"><span class="annot"><span class="annottext">checkOverloadedSig :: MonoBindInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Gen.Bind.html#checkOverloadedSig"><span class="hs-identifier hs-var hs-var">checkOverloadedSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_sig :: MonoBindInfo -&gt; Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083757"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083757"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TISI"><span class="hs-identifier hs-type">TISI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_inst_sig :: TcIdSigInst -&gt; TcIdSig
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_sig"><span class="hs-identifier hs-var">sig_inst_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083758"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083758"><span class="hs-identifier hs-var">orig_sig</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_theta :: TcIdSigInst -&gt; TcThetaType
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_theta"><span class="hs-identifier hs-var">sig_inst_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083759"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083759"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_wcx :: TcIdSigInst -&gt; Maybe Kind
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_wcx"><span class="hs-identifier hs-var">sig_inst_wcx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083760"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621683083760"><span class="hs-identifier hs-var">wcx</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083757"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcThetaType -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083759"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621683083760"><span class="hs-identifier hs-var">wcx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSig -&gt; SrcSpan
</span><a href="GHC.Tc.Types.BasicTypes.html#tcIdSigLoc"><span class="hs-identifier hs-var">tcIdSigLoc</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083758"><span class="hs-identifier hs-var">orig_sig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcIdSig -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnOverloadedSig"><span class="hs-identifier hs-var">TcRnOverloadedSig</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083758"><span class="hs-identifier hs-var">orig_sig</span></a></span><span>
</span><span id="line-839"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#checkOverloadedSig"><span class="hs-identifier hs-var">checkOverloadedSig</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span class="hs-comment">{- Note [When the MR applies]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The Monomorphism Restriction (MR) applies as specifies in the Haskell Report:

* If -XMonomorphismRestriction is on, and
* Any binding is restricted

A binding is restricted if:
* It is a pattern binding e.g. (x,y) = e
* Or it is a FunBind with no arguments e.g. f = rhs
     and the binder `f` lacks a No-MR signature

A binder f has a No-MR signature if

* It has a complete type signature
    e.g. f :: Num a =&gt; a -&gt; a

* Or it has a /partial/ type signature with a /context/
    e.g.  f :: (_) =&gt; a -&gt; _
          g :: Num a =&gt; a -&gt; _
          h :: (Num a, _) =&gt; a -&gt; _
   All of f,g,h have a No-MR signature.  They say that the function is overloaded
   so it's silly to try to apply the MR. This means that #19106 works out
   fine.  Ditto #11016, which looked like
      f4 :: (?loc :: Int) =&gt; _
      f4 = ?loc

   This partial-signature stuff is a bit ad-hoc but seems to match our
   use-cases.  See also Note [Constraints in partial type signatures]
   in GHC.Tc.Solver.

Example: the MR does apply to
   k :: _ -&gt; _
   k = rhs
because k's binding has no arguments, and `k` does not have
a No-MR signature.

All of this checking takes place after synonym expansion.  For example:
   type Wombat a = forall b. Eq [b] =&gt; ...b...a...
   f5 :: Wombat _
This (and does) behave just like
   f5 :: forall b. Eq [b] =&gt; ...b..._...

-}</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-887"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mkExport"><span class="hs-identifier hs-type">mkExport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>
</span><span id="line-888"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>  </span><span class="hs-comment">-- residual constraints, already emitted (for errors only)</span><span>
</span><span id="line-889"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                        </span><span class="hs-comment">-- True &lt;=&gt; there was an insoluble type error</span><span>
</span><span id="line-890"></span><span>                                        </span><span class="hs-comment">--          when typechecking the bindings</span><span>
</span><span id="line-891"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span>      </span><span class="hs-comment">-- Both already zonked</span><span>
</span><span id="line-892"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span>
</span><span id="line-893"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABExport"><span class="hs-identifier hs-type">ABExport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-894"></span><span class="hs-comment">-- Only called for generalisation plan InferGen, not by CheckGen or NoGen</span><span>
</span><span id="line-895"></span><span class="hs-comment">--</span><span>
</span><span id="line-896"></span><span class="hs-comment">-- mkExport generates exports with</span><span>
</span><span id="line-897"></span><span class="hs-comment">--      zonked type variables,</span><span>
</span><span id="line-898"></span><span class="hs-comment">--      zonked poly_ids</span><span>
</span><span id="line-899"></span><span class="hs-comment">-- The former is just because no further unifications will change</span><span>
</span><span id="line-900"></span><span class="hs-comment">-- the quantified type variables, so we can fix their final form</span><span>
</span><span id="line-901"></span><span class="hs-comment">-- right now.</span><span>
</span><span id="line-902"></span><span class="hs-comment">-- The latter is needed because the poly_ids are used to extend the</span><span>
</span><span id="line-903"></span><span class="hs-comment">-- type environment; see the invariant on GHC.Tc.Utils.Env.tcExtendIdEnv</span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span class="hs-comment">-- Pre-condition: the qtvs and theta are already zonked</span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span id="mkExport"><span class="annot"><span class="annottext">mkExport :: TcPragEnv
-&gt; WantedConstraints
-&gt; Bool
-&gt; [TcId]
-&gt; TcThetaType
-&gt; MonoBindInfo
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled ABExport)
</span><a href="GHC.Tc.Gen.Bind.html#mkExport"><span class="hs-identifier hs-var hs-var">mkExport</span></a></span></span><span> </span><span id="local-6989586621683083765"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083765"><span class="hs-identifier hs-var">prag_fn</span></a></span></span><span> </span><span id="local-6989586621683083766"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683083766"><span class="hs-identifier hs-var">residual</span></a></span></span><span> </span><span id="local-6989586621683083767"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683083767"><span class="hs-identifier hs-var">insoluble</span></a></span></span><span> </span><span id="local-6989586621683083768"><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083768"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span> </span><span id="local-6989586621683083769"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083769"><span class="hs-identifier hs-var">theta</span></a></span></span><span>
</span><span id="line-908"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_poly_name :: MonoBindInfo -&gt; Name
</span><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083770"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083770"><span class="hs-identifier hs-var">poly_name</span></a></span></span><span>
</span><span id="line-909"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_sig :: MonoBindInfo -&gt; Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083771"><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683083771"><span class="hs-identifier hs-var">mb_sig</span></a></span></span><span>
</span><span id="line-910"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_id :: MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083772"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083772"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span>
</span><span id="line-911"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_mult :: MonoBindInfo -&gt; Kind
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_mult"><span class="hs-identifier hs-var">mbi_mono_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083773"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083773"><span class="hs-identifier hs-var">mono_mult</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083774"><span class="annot"><a href="#local-6989586621683083774"><span class="hs-identifier hs-var">mono_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM Kind -&gt; TcM Kind
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM Kind -&gt; TcM Kind) -&gt; ZonkM Kind -&gt; TcM Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; ZonkM Kind
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083772"><span class="hs-identifier hs-var">mono_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083777"><span class="annot"><a href="#local-6989586621683083777"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mkInferredPolyId"><span class="hs-identifier hs-type">mkInferredPolyId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083766"><span class="hs-identifier hs-type">residual</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083767"><span class="hs-identifier hs-type">insoluble</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083768"><span class="hs-identifier hs-type">qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083769"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083770"><span class="hs-identifier hs-type">poly_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083771"><span class="hs-identifier hs-type">mb_sig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083774"><span class="hs-identifier hs-type">mono_ty</span></a></span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-comment">-- NB: poly_id has a zonked type</span><span>
</span><span id="line-916"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083779"><span class="annot"><a href="#local-6989586621683083779"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#addInlinePrags"><span class="hs-identifier hs-type">addInlinePrags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083777"><span class="hs-identifier hs-type">poly_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083780"><span class="hs-identifier hs-type">prag_sigs</span></a></span><span>
</span><span id="line-917"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083781"><span class="annot"><a href="#local-6989586621683083781"><span class="hs-identifier hs-var">spec_prags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#tcSpecPrags"><span class="hs-identifier hs-type">tcSpecPrags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083779"><span class="hs-identifier hs-type">poly_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083780"><span class="hs-identifier hs-type">prag_sigs</span></a></span><span>
</span><span id="line-918"></span><span>                </span><span class="hs-comment">-- tcPrags requires a zonked poly_id</span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>        </span><span class="hs-comment">-- See Note [Impedance matching]</span><span>
</span><span id="line-921"></span><span>        </span><span class="hs-comment">-- NB: we have already done checkValidType, including an ambiguity check,</span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-comment">--     on the type; either when we checked the sig or in mkInferredPolyId</span><span>
</span><span id="line-923"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083782"><span class="annot"><a href="#local-6989586621683083782"><span class="hs-identifier hs-var hs-var">poly_ty</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083779"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-924"></span><span>              </span><span id="local-6989586621683083783"><span class="annot"><a href="#local-6989586621683083783"><span class="hs-identifier hs-var hs-var">sel_poly_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcId] -&gt; TcThetaType -&gt; Kind -&gt; Kind
HasDebugCallStack =&gt; [TcId] -&gt; TcThetaType -&gt; Kind -&gt; Kind
</span><a href="GHC.Tc.Utils.TcType.html#mkInfSigmaTy"><span class="hs-identifier hs-var">mkInfSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083768"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083769"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083774"><span class="hs-identifier hs-var">mono_ty</span></a></span><span>
</span><span id="line-925"></span><span>                </span><span class="hs-comment">-- This type is just going into tcSubType,</span><span>
</span><span id="line-926"></span><span>                </span><span class="hs-comment">-- so Inferred vs. Specified doesn't matter</span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mkExport&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083779"><span class="hs-identifier hs-type">poly_id</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083782"><span class="hs-identifier hs-type">poly_ty</span></a></span><span>
</span><span id="line-929"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083783"><span class="hs-identifier hs-type">sel_poly_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span>
</span><span id="line-931"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083786"><span class="annot"><a href="#local-6989586621683083786"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683083783"><span class="hs-identifier hs-type">sel_poly_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-type">`eqType`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083782"><span class="hs-identifier hs-type">poly_ty</span></a></span><span>  </span><span class="hs-comment">-- NB: eqType ignores visibility</span><span>
</span><span id="line-932"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span>  </span><span class="hs-comment">-- Fast path; also avoids complaint when we infer</span><span>
</span><span id="line-933"></span><span>                                           </span><span class="hs-comment">-- an ambiguous type and have AllowAmbiguousType</span><span>
</span><span id="line-934"></span><span>                                           </span><span class="hs-comment">-- e..g infer  x :: forall a. F a -&gt; Int</span><span>
</span><span id="line-935"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSubTypeSigma"><span class="hs-identifier hs-type">tcSubTypeSigma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ImpedanceMatching"><span class="hs-identifier hs-type">ImpedanceMatching</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083779"><span class="hs-identifier hs-type">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>                                      </span><span class="annot"><a href="#local-6989586621683083790"><span class="hs-identifier hs-type">sig_ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083783"><span class="hs-identifier hs-type">sel_poly_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083782"><span class="hs-identifier hs-type">poly_ty</span></a></span><span>
</span><span id="line-937"></span><span>                       </span><span class="hs-comment">-- See Note [Impedance matching]</span><span>
</span><span id="line-938"></span><span>
</span><span id="line-939"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#localSigWarn"><span class="hs-identifier hs-type">localSigWarn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083779"><span class="hs-identifier hs-type">poly_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083771"><span class="hs-identifier hs-type">mb_sig</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083773"><span class="hs-identifier hs-type">mono_mult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-942"></span><span>                  </span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_wrap"><span class="hs-identifier hs-var">abe_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083786"><span class="hs-identifier hs-type">wrap</span></a></span><span>
</span><span id="line-943"></span><span>                        </span><span class="hs-comment">-- abe_wrap :: (forall qtvs. theta =&gt; mono_ty) ~ idType poly_id</span><span>
</span><span id="line-944"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083779"><span class="hs-identifier hs-type">poly_id</span></a></span><span>
</span><span id="line-945"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083772"><span class="hs-identifier hs-type">mono_id</span></a></span><span>
</span><span id="line-946"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_prags"><span class="hs-identifier hs-var">abe_prags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#SpecPrags"><span class="hs-identifier hs-type">SpecPrags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083781"><span class="hs-identifier hs-type">spec_prags</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-947"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-948"></span><span>    </span><span id="local-6989586621683083780"><span class="annot"><span class="annottext">prag_sigs :: [LSig GhcRn]
</span><a href="#local-6989586621683083780"><span class="hs-identifier hs-var hs-var">prag_sigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPragEnv -&gt; Name -&gt; [LSig GhcRn]
</span><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683083765"><span class="hs-identifier hs-var">prag_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083770"><span class="hs-identifier hs-var">poly_name</span></a></span><span>
</span><span id="line-949"></span><span>    </span><span id="local-6989586621683083790"><span class="annot"><span class="annottext">sig_ctxt :: UserTypeCtxt
</span><a href="#local-6989586621683083790"><span class="hs-identifier hs-var hs-var">sig_ctxt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#InfSigCtxt"><span class="hs-identifier hs-var">InfSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083770"><span class="hs-identifier hs-var">poly_name</span></a></span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mkInferredPolyId"><span class="hs-identifier hs-type">mkInferredPolyId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>   </span><span class="hs-comment">-- the residual constraints, already emitted</span><span>
</span><span id="line-952"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="hs-comment">-- True &lt;=&gt; there was an insoluble error when</span><span>
</span><span id="line-953"></span><span>                          </span><span class="hs-comment">--          checking the binding group for this Id</span><span>
</span><span id="line-954"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span>
</span><span id="line-955"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-956"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-957"></span><span id="mkInferredPolyId"><span class="annot"><span class="annottext">mkInferredPolyId :: WantedConstraints
-&gt; Bool
-&gt; [TcId]
-&gt; TcThetaType
-&gt; Name
-&gt; Maybe TcIdSigInst
-&gt; Kind
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
</span><a href="GHC.Tc.Gen.Bind.html#mkInferredPolyId"><span class="hs-identifier hs-var hs-var">mkInferredPolyId</span></a></span></span><span> </span><span id="local-6989586621683083793"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683083793"><span class="hs-identifier hs-var">residual</span></a></span></span><span> </span><span id="local-6989586621683083794"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683083794"><span class="hs-identifier hs-var">insoluble</span></a></span></span><span> </span><span id="local-6989586621683083795"><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083795"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span> </span><span id="local-6989586621683083796"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083796"><span class="hs-identifier hs-var">inferred_theta</span></a></span></span><span> </span><span id="local-6989586621683083797"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083797"><span class="hs-identifier hs-var">poly_name</span></a></span></span><span> </span><span id="local-6989586621683083798"><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683083798"><span class="hs-identifier hs-var">mb_sig_inst</span></a></span></span><span> </span><span id="local-6989586621683083799"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083799"><span class="hs-identifier hs-var">mono_ty</span></a></span></span><span>
</span><span id="line-958"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TISI"><span class="hs-identifier hs-type">TISI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_inst_sig :: TcIdSigInst -&gt; TcIdSig
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_sig"><span class="hs-identifier hs-var">sig_inst_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083800"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083800"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683083798"><span class="hs-identifier hs-var">mb_sig_inst</span></a></span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcCompleteSig"><span class="hs-identifier hs-type">TcCompleteSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#CSig"><span class="hs-identifier hs-type">CSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndr :: TcCompleteSig -&gt; TcId
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_bndr"><span class="hs-identifier hs-var">sig_bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083801"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083801"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083800"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-960"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083801"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- Either no type sig or partial type sig</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) TcId
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) TcId
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- The checkNoErrs ensures that if the type is ambiguous</span><span>
</span><span id="line-964"></span><span>                   </span><span class="hs-comment">-- we don't carry on to the impedance matching, and generate</span><span>
</span><span id="line-965"></span><span>                   </span><span class="hs-comment">-- a duplicate ambiguity error.  There is a similar</span><span>
</span><span id="line-966"></span><span>                   </span><span class="hs-comment">-- checkNoErrs for complete type signatures too.</span><span>
</span><span id="line-967"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083802"><span class="annot"><a href="#local-6989586621683083802"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-968"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083803"><span class="annot"><a href="#local-6989586621683083803"><span class="hs-identifier hs-var hs-var">mono_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; Kind
</span><a href="GHC.Core.Reduction.html#reductionReducedType"><span class="hs-identifier hs-var">reductionReducedType</span></a></span><span> </span><span class="annot"><span class="annottext">(Reduction -&gt; Kind) -&gt; Reduction -&gt; Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Role -&gt; Kind -&gt; Reduction
</span><a href="GHC.Core.FamInstEnv.html#normaliseType"><span class="hs-identifier hs-var">normaliseType</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683083802"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083799"><span class="hs-identifier hs-var">mono_ty</span></a></span><span>
</span><span id="line-969"></span><span>               </span><span class="hs-comment">-- Unification may not have normalised the type,</span><span>
</span><span id="line-970"></span><span>               </span><span class="hs-comment">-- so do it here to make it as uncomplicated as possible.</span><span>
</span><span id="line-971"></span><span>               </span><span class="hs-comment">-- Example: f :: [F Int] -&gt; Bool</span><span>
</span><span id="line-972"></span><span>               </span><span class="hs-comment">-- should be rewritten to f :: [Char] -&gt; Bool, if possible</span><span>
</span><span id="line-973"></span><span>               </span><span class="hs-comment">--</span><span>
</span><span id="line-974"></span><span>               </span><span class="hs-comment">-- We can discard the coercion _co, because we'll reconstruct</span><span>
</span><span id="line-975"></span><span>               </span><span class="hs-comment">-- it in the call to tcSubType below</span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083806"><span class="annot"><a href="#local-6989586621683083806"><span class="hs-identifier hs-var">binders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083807"><span class="annot"><a href="#local-6989586621683083807"><span class="hs-identifier hs-var">theta'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier hs-type">chooseInferredQuantifiers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083793"><span class="hs-identifier hs-type">residual</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083796"><span class="hs-identifier hs-type">inferred_theta</span></a></span><span>
</span><span id="line-978"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-type">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083803"><span class="hs-identifier hs-type">mono_ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083795"><span class="hs-identifier hs-type">qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083798"><span class="hs-identifier hs-type">mb_sig_inst</span></a></span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083809"><span class="annot"><a href="#local-6989586621683083809"><span class="hs-identifier hs-var hs-var">inferred_poly_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity] -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083806"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcThetaType -&gt; Kind -&gt; Kind
HasDebugCallStack =&gt; TcThetaType -&gt; Kind -&gt; Kind
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083807"><span class="hs-identifier hs-var">theta'</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083803"><span class="hs-identifier hs-var">mono_ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mkInferredPolyId&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083797"><span class="hs-identifier hs-type">poly_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083795"><span class="hs-identifier hs-type">qtvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083807"><span class="hs-identifier hs-type">theta'</span></a></span><span>
</span><span id="line-983"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083809"><span class="hs-identifier hs-type">inferred_poly_ty</span></a></span><span>
</span><span id="line-984"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;insoluble&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083794"><span class="hs-identifier hs-type">insoluble</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621683083794"><span class="hs-identifier hs-type">insoluble</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-987"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-type">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mk_inf_msg"><span class="hs-identifier hs-type">mk_inf_msg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083797"><span class="hs-identifier hs-type">poly_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083809"><span class="hs-identifier hs-type">inferred_poly_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-988"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkEscapingKind"><span class="hs-identifier hs-type">checkEscapingKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083809"><span class="hs-identifier hs-type">inferred_poly_ty</span></a></span><span>
</span><span id="line-989"></span><span>                 </span><span class="hs-comment">-- See Note [Inferred type with escaping kind]</span><span>
</span><span id="line-990"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InfSigCtxt"><span class="hs-identifier hs-type">InfSigCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083797"><span class="hs-identifier hs-type">poly_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083809"><span class="hs-identifier hs-type">inferred_poly_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-991"></span><span>                 </span><span class="hs-comment">-- See Note [Validity of inferred types]</span><span>
</span><span id="line-992"></span><span>         </span><span class="hs-comment">-- unless insoluble: if we found an insoluble error in the</span><span>
</span><span id="line-993"></span><span>         </span><span class="hs-comment">-- function definition, don't do this check; otherwise</span><span>
</span><span id="line-994"></span><span>         </span><span class="hs-comment">-- (#14000) we may report an ambiguity error for a rather</span><span>
</span><span id="line-995"></span><span>         </span><span class="hs-comment">-- bogus type.</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-type">mkLocalId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083797"><span class="hs-identifier hs-type">poly_name</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083809"><span class="hs-identifier hs-type">inferred_poly_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier hs-type">chooseInferredQuantifiers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>  </span><span class="hs-comment">-- residual constraints</span><span>
</span><span id="line-1001"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span>   </span><span class="hs-comment">-- inferred</span><span>
</span><span id="line-1002"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span>    </span><span class="hs-comment">-- tvs free in tau type</span><span>
</span><span id="line-1003"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- inferred quantified tvs</span><span>
</span><span id="line-1004"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a></span><span>
</span><span id="line-1005"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span id="chooseInferredQuantifiers"><span class="annot"><span class="annottext">chooseInferredQuantifiers :: WantedConstraints
-&gt; TcThetaType
-&gt; VarSet
-&gt; [TcId]
-&gt; Maybe TcIdSigInst
-&gt; TcM ([VarBndr TcId Specificity], TcThetaType)
</span><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier hs-var hs-var">chooseInferredQuantifiers</span></a></span></span><span> </span><span id="local-6989586621683083817"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683083817"><span class="hs-identifier hs-var">_residual</span></a></span></span><span> </span><span id="local-6989586621683083818"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083818"><span class="hs-identifier hs-var">inferred_theta</span></a></span></span><span> </span><span id="local-6989586621683083819"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083819"><span class="hs-identifier hs-var">tau_tvs</span></a></span></span><span> </span><span id="local-6989586621683083820"><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083820"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- No type signature (partial or complete) for this binder,</span><span>
</span><span id="line-1008"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083821"><span class="annot"><span class="annottext">free_tvs :: VarSet
</span><a href="#local-6989586621683083821"><span class="hs-identifier hs-var hs-var">free_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcThetaType -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Tc.Solver.html#growThetaTyVars"><span class="hs-identifier hs-var">growThetaTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083818"><span class="hs-identifier hs-var">inferred_theta</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083819"><span class="hs-identifier hs-var">tau_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span>                        </span><span class="hs-comment">-- See Note [growThetaTyVars vs closeWrtFunDeps] in GHC.Tc.Solver</span><span>
</span><span id="line-1010"></span><span>                        </span><span class="hs-comment">-- Include kind variables!  #7916</span><span>
</span><span id="line-1011"></span><span>             </span><span id="local-6989586621683083824"><span class="annot"><span class="annottext">my_theta :: TcThetaType
</span><a href="#local-6989586621683083824"><span class="hs-identifier hs-var hs-var">my_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcThetaType -&gt; TcThetaType
</span><a href="GHC.Tc.Utils.TcType.html#pickCapturedPreds"><span class="hs-identifier hs-var">pickCapturedPreds</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083821"><span class="hs-identifier hs-var">free_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083818"><span class="hs-identifier hs-var">inferred_theta</span></a></span><span>
</span><span id="line-1012"></span><span>             </span><span id="local-6989586621683083826"><span class="annot"><span class="annottext">binders :: [VarBndr TcId Specificity]
</span><a href="#local-6989586621683083826"><span class="hs-identifier hs-var hs-var">binders</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Specificity -&gt; TcId -&gt; VarBndr TcId Specificity
forall vis. vis -&gt; TcId -&gt; VarBndr TcId vis
</span><a href="GHC.Types.Var.html#mkTyVarBinder"><span class="hs-identifier hs-var">mkTyVarBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="Language.Haskell.Syntax.Specificity.html#InferredSpec"><span class="hs-identifier hs-var">InferredSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083829"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1013"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083829"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083829"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083820"><span class="hs-identifier hs-var">qtvs</span></a></span><span>
</span><span id="line-1014"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083829"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcId -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083821"><span class="hs-identifier hs-var">free_tvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1015"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([VarBndr TcId Specificity], TcThetaType)
-&gt; TcM ([VarBndr TcId Specificity], TcThetaType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083826"><span class="hs-identifier hs-var">binders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083824"><span class="hs-identifier hs-var">my_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier hs-var">chooseInferredQuantifiers</span></a></span><span> </span><span id="local-6989586621683083831"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683083831"><span class="hs-identifier hs-var">residual</span></a></span></span><span> </span><span id="local-6989586621683083832"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083832"><span class="hs-identifier hs-var">inferred_theta</span></a></span></span><span> </span><span id="local-6989586621683083833"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083833"><span class="hs-identifier hs-var">tau_tvs</span></a></span></span><span> </span><span id="local-6989586621683083834"><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083834"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TISI"><span class="hs-identifier hs-type">TISI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_inst_sig :: TcIdSigInst -&gt; TcIdSig
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_sig"><span class="hs-identifier hs-var">sig_inst_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083835"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083835"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_wcx :: TcIdSigInst -&gt; Maybe Kind
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_wcx"><span class="hs-identifier hs-var">sig_inst_wcx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083836"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621683083836"><span class="hs-identifier hs-var">wcx</span></a></span></span><span>
</span><span id="line-1019"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_theta :: TcIdSigInst -&gt; TcThetaType
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_theta"><span class="hs-identifier hs-var">sig_inst_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083837"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083837"><span class="hs-identifier hs-var">annotated_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_skols :: TcIdSigInst -&gt; [(Name, VarBndr TcId Specificity)]
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_skols"><span class="hs-identifier hs-var">sig_inst_skols</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083839"><span class="annot"><span class="annottext">[(Name, VarBndr TcId Specificity)]
</span><a href="#local-6989586621683083839"><span class="hs-identifier hs-var">annotated_tvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcPartialSig"><span class="hs-identifier hs-type">TcPartialSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#PSig"><span class="hs-identifier hs-type">PSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">psig_name :: TcPartialSig -&gt; Name
</span><a href="GHC.Tc.Types.BasicTypes.html#psig_name"><span class="hs-identifier hs-var">psig_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083840"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083840"><span class="hs-identifier hs-var">fn_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">psig_hs_ty :: TcPartialSig -&gt; LHsSigWcType GhcRn
</span><a href="GHC.Tc.Types.BasicTypes.html#psig_hs_ty"><span class="hs-identifier hs-var">psig_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083842"><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621683083842"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683083835"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1021"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Choose quantifiers for a partial type signature</span><span>
</span><span id="line-1022"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083843"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683083843"><span class="hs-identifier hs-var hs-var">psig_qtv_nms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083844"><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083844"><span class="hs-identifier hs-var hs-var">psig_qtv_bndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, VarBndr TcId Specificity)]
-&gt; ([Name], [VarBndr TcId Specificity])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(Name, VarBndr TcId Specificity)]
</span><a href="#local-6989586621683083839"><span class="hs-identifier hs-var">annotated_tvs</span></a></span><span>
</span><span id="line-1023"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083846"><span class="annot"><a href="#local-6989586621683083846"><span class="hs-identifier hs-var">psig_qtv_bndrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM [VarBndr TcId Specificity] -&gt; TcM [VarBndr TcId Specificity]
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM [VarBndr TcId Specificity]
 -&gt; TcM [VarBndr TcId Specificity])
-&gt; ZonkM [VarBndr TcId Specificity]
-&gt; TcM [VarBndr TcId Specificity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VarBndr TcId Specificity -&gt; ZonkM (VarBndr TcId Specificity))
-&gt; [VarBndr TcId Specificity] -&gt; ZonkM [VarBndr TcId Specificity]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity -&gt; ZonkM (VarBndr TcId Specificity)
forall spec. VarBndr TcId spec -&gt; ZonkM (VarBndr TcId spec)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkInvisTVBinder"><span class="hs-identifier hs-var">zonkInvisTVBinder</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083844"><span class="hs-identifier hs-var">psig_qtv_bndrs</span></a></span><span>
</span><span id="line-1024"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083848"><span class="annot"><a href="#local-6989586621683083848"><span class="hs-identifier hs-var hs-var">psig_qtvs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarBndr TcId Specificity -&gt; TcId)
-&gt; [VarBndr TcId Specificity] -&gt; [TcId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity -&gt; TcId
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083846"><span class="hs-identifier hs-var">psig_qtv_bndrs</span></a></span><span>
</span><span id="line-1025"></span><span>             </span><span id="local-6989586621683083850"><span class="annot"><a href="#local-6989586621683083850"><span class="hs-identifier hs-var hs-var">psig_qtv_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcId] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083848"><span class="hs-identifier hs-var">psig_qtvs</span></a></span><span>
</span><span id="line-1026"></span><span>             </span><span id="local-6989586621683083852"><span class="annot"><a href="#local-6989586621683083852"><span class="hs-identifier hs-var hs-var">psig_qtv_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683083843"><span class="hs-identifier hs-var">psig_qtv_nms</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [TcId] -&gt; [(Name, TcId)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><a href="#local-6989586621683083848"><span class="hs-identifier hs-var">psig_qtvs</span></a></span><span>
</span><span id="line-1027"></span><span>             </span><span class="annot"><a href="#local-6989586621683083853"><span class="hs-identifier hs-type">psig_bndr_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span>
</span><span id="line-1028"></span><span>             </span><span id="local-6989586621683083853"><span class="annot"><a href="#local-6989586621683083853"><span class="hs-identifier hs-var hs-var">psig_bndr_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TcId, VarBndr TcId Specificity)]
-&gt; TyVarEnv (VarBndr TcId Specificity)
forall a. [(TcId, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarBndr TcId Specificity -&gt; TcId
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity
</span><a href="#local-6989586621683083854"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity
</span><a href="#local-6989586621683083854"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083854"><span class="annot"><span class="annottext">VarBndr TcId Specificity
</span><a href="#local-6989586621683083854"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083846"><span class="hs-identifier hs-var">psig_qtv_bndrs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>            </span><span class="hs-comment">-- Check whether the quantified variables of the</span><span>
</span><span id="line-1031"></span><span>            </span><span class="hs-comment">-- partial signature have been unified together</span><span>
</span><span id="line-1032"></span><span>            </span><span class="hs-comment">-- See Note [Quantified variables in partial type signatures]</span><span>
</span><span id="line-1033"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083855"><span class="hs-identifier hs-type">report_dup_tyvar_tv_err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083840"><span class="hs-identifier hs-type">fn_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083842"><span class="hs-identifier hs-type">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1034"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#findDupTyVarTvs"><span class="hs-identifier hs-type">findDupTyVarTvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083852"><span class="hs-identifier hs-type">psig_qtv_prs</span></a></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span>            </span><span class="hs-comment">-- Check whether a quantified variable of the partial type</span><span>
</span><span id="line-1037"></span><span>            </span><span class="hs-comment">-- signature is not actually quantified.  How can that happen?</span><span>
</span><span id="line-1038"></span><span>            </span><span class="hs-comment">-- See Note [Quantification and partial signatures] Wrinkle 4</span><span>
</span><span id="line-1039"></span><span>            </span><span class="hs-comment">--     in GHC.Tc.Solver</span><span>
</span><span id="line-1040"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083857"><span class="hs-identifier hs-type">report_mono_sig_tv_err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083840"><span class="hs-identifier hs-type">fn_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083842"><span class="hs-identifier hs-type">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1041"></span><span>         </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621683083858"><span class="hs-identifier hs-type">pr</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083858"><span class="annot"><a href="#local-6989586621683083858"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683083859"><span class="annot"><a href="#local-6989586621683083859"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683083852"><span class="hs-identifier hs-type">psig_qtv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083859"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`elem`</span></span><span> </span><span class="annot"><a href="#local-6989586621683083834"><span class="hs-identifier hs-type">qtvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083861"><span class="annot"><a href="#local-6989586621683083861"><span class="hs-identifier hs-var">annotated_theta</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypes"><span class="hs-identifier hs-type">zonkTcTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083837"><span class="hs-identifier hs-type">annotated_theta</span></a></span><span>
</span><span id="line-1044"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083863"><span class="annot"><a href="#local-6989586621683083863"><span class="hs-identifier hs-var">free_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083864"><span class="annot"><a href="#local-6989586621683083864"><span class="hs-identifier hs-var">my_theta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683083865"><span class="hs-identifier hs-type">choose_psig_context</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083850"><span class="hs-identifier hs-type">psig_qtv_set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083861"><span class="hs-identifier hs-type">annotated_theta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083836"><span class="hs-identifier hs-type">wcx</span></a></span><span>
</span><span id="line-1045"></span><span>                                 </span><span class="hs-comment">-- NB: free_tvs includes tau_tvs</span><span>
</span><span id="line-1046"></span><span>
</span><span id="line-1047"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683083866"><span class="annot"><a href="#local-6989586621683083866"><span class="hs-identifier hs-var">final_qtvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083868"><span class="hs-identifier hs-type">choose_qtv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083853"><span class="hs-identifier hs-type">psig_bndr_map</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083863"><span class="hs-identifier hs-type">free_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083834"><span class="hs-identifier hs-type">qtvs</span></a></span><span>
</span><span id="line-1048"></span><span>                              </span><span class="hs-comment">-- Pulling from qtvs maintains original order</span><span>
</span><span id="line-1049"></span><span>                              </span><span class="hs-comment">-- NB: qtvs is already in dependency order</span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;chooseInferredQuantifiers&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1052"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;qtvs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083834"><span class="hs-identifier hs-type">qtvs</span></a></span><span>
</span><span id="line-1053"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;psig_qtv_bndrs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083846"><span class="hs-identifier hs-type">psig_qtv_bndrs</span></a></span><span>
</span><span id="line-1054"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;free_tvs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083863"><span class="hs-identifier hs-type">free_tvs</span></a></span><span>
</span><span id="line-1055"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;final_tvs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083866"><span class="hs-identifier hs-type">final_qtvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083866"><span class="hs-identifier hs-type">final_qtvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083864"><span class="hs-identifier hs-type">my_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1059"></span><span>    </span><span class="annot"><a href="#local-6989586621683083868"><span class="hs-identifier hs-type">choose_qtv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-1060"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>    </span><span class="hs-comment">-- Pick which of the original qtvs should be retained</span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-comment">-- Keep it if (a) it is mentioned in the body of the type (free_tvs)</span><span>
</span><span id="line-1063"></span><span>    </span><span class="hs-comment">--            (b) it is a forall'd variable of the partial signature (psig_qtv_bndrs)</span><span>
</span><span id="line-1064"></span><span>    </span><span class="hs-comment">--            (c) it is mentioned in the kind of a retained qtv (#22065)</span><span>
</span><span id="line-1065"></span><span>    </span><span id="local-6989586621683083868"><span class="annot"><span class="annottext">choose_qtv :: TyVarEnv (VarBndr TcId Specificity)
-&gt; TcId
-&gt; (VarSet, [VarBndr TcId Specificity])
-&gt; (VarSet, [VarBndr TcId Specificity])
</span><a href="#local-6989586621683083868"><span class="hs-identifier hs-var hs-var">choose_qtv</span></a></span></span><span> </span><span id="local-6989586621683083869"><span class="annot"><span class="annottext">TyVarEnv (VarBndr TcId Specificity)
</span><a href="#local-6989586621683083869"><span class="hs-identifier hs-var">psig_bndr_map</span></a></span></span><span> </span><span id="local-6989586621683083870"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083870"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083871"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083871"><span class="hs-identifier hs-var">free_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083872"><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083872"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083873"><span class="annot"><span class="annottext">VarBndr TcId Specificity
</span><a href="#local-6989586621683083873"><span class="hs-identifier hs-var">psig_bndr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyVarEnv (VarBndr TcId Specificity)
-&gt; TcId -&gt; Maybe (VarBndr TcId Specificity)
forall a. VarEnv a -&gt; TcId -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarEnv (VarBndr TcId Specificity)
</span><a href="#local-6989586621683083869"><span class="hs-identifier hs-var">psig_bndr_map</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083870"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1067"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083874"><span class="hs-identifier hs-var">free_tvs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity
</span><a href="#local-6989586621683083873"><span class="hs-identifier hs-var">psig_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity
-&gt; [VarBndr TcId Specificity] -&gt; [VarBndr TcId Specificity]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083872"><span class="hs-identifier hs-var">qtvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083870"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcId -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083871"><span class="hs-identifier hs-var">free_tvs</span></a></span><span>
</span><span id="line-1069"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083874"><span class="hs-identifier hs-var">free_tvs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Specificity -&gt; TcId -&gt; VarBndr TcId Specificity
forall vis. vis -&gt; TcId -&gt; VarBndr TcId vis
</span><a href="GHC.Types.Var.html#mkTyVarBinder"><span class="hs-identifier hs-var">mkTyVarBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="Language.Haskell.Syntax.Specificity.html#InferredSpec"><span class="hs-identifier hs-var">InferredSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083870"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity
-&gt; [VarBndr TcId Specificity] -&gt; [VarBndr TcId Specificity]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083872"><span class="hs-identifier hs-var">qtvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- Do not pick it</span><span>
</span><span id="line-1071"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083871"><span class="hs-identifier hs-var">free_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcId Specificity]
</span><a href="#local-6989586621683083872"><span class="hs-identifier hs-var">qtvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-1073"></span><span>         </span><span id="local-6989586621683083874"><span class="annot"><span class="annottext">free_tvs' :: VarSet
</span><a href="#local-6989586621683083874"><span class="hs-identifier hs-var hs-var">free_tvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083871"><span class="hs-identifier hs-var">free_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083870"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span>    </span><span class="annot"><a href="#local-6989586621683083865"><span class="hs-identifier hs-type">choose_psig_context</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1076"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>    </span><span id="local-6989586621683083865"><span class="annot"><span class="annottext">choose_psig_context :: VarSet -&gt; TcThetaType -&gt; Maybe Kind -&gt; TcM (VarSet, TcThetaType)
</span><a href="#local-6989586621683083865"><span class="hs-identifier hs-var hs-var">choose_psig_context</span></a></span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083877"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083877"><span class="hs-identifier hs-var">annotated_theta</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1078"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083878"><span class="annot"><span class="annottext">free_tvs :: VarSet
</span><a href="#local-6989586621683083878"><span class="hs-identifier hs-var hs-var">free_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcThetaType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083877"><span class="hs-identifier hs-var">annotated_theta</span></a></span><span>
</span><span id="line-1079"></span><span>                                            </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083833"><span class="hs-identifier hs-var">tau_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(VarSet, TcThetaType) -&gt; TcM (VarSet, TcThetaType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083878"><span class="hs-identifier hs-var">free_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083877"><span class="hs-identifier hs-var">annotated_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span>    </span><span class="annot"><a href="#local-6989586621683083865"><span class="hs-identifier hs-var">choose_psig_context</span></a></span><span> </span><span id="local-6989586621683083880"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083880"><span class="hs-identifier hs-var">psig_qtvs</span></a></span></span><span> </span><span id="local-6989586621683083881"><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083881"><span class="hs-identifier hs-var">annotated_theta</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083882"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083882"><span class="hs-identifier hs-var">wc_var_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1083"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083883"><span class="annot"><span class="annottext">free_tvs :: VarSet
</span><a href="#local-6989586621683083883"><span class="hs-identifier hs-var hs-var hs-var">free_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcThetaType -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Tc.Solver.html#growThetaTyVars"><span class="hs-identifier hs-var">growThetaTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083832"><span class="hs-identifier hs-var">inferred_theta</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083884"><span class="hs-identifier hs-var">seed_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>                            </span><span class="hs-comment">-- growThetaTyVars just like the no-type-sig case</span><span>
</span><span id="line-1085"></span><span>                            </span><span class="hs-comment">-- See Note [growThetaTyVars vs closeWrtFunDeps] in GHC.Tc.Solver</span><span>
</span><span id="line-1086"></span><span>                            </span><span class="hs-comment">-- Omitting this caused #12844</span><span>
</span><span id="line-1087"></span><span>                 </span><span id="local-6989586621683083884"><span class="annot"><span class="annottext">seed_tvs :: VarSet
</span><a href="#local-6989586621683083884"><span class="hs-identifier hs-var hs-var hs-var">seed_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcThetaType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083881"><span class="hs-identifier hs-var">annotated_theta</span></a></span><span>  </span><span class="hs-comment">-- These are put there</span><span>
</span><span id="line-1088"></span><span>                            </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083833"><span class="hs-identifier hs-var">tau_tvs</span></a></span><span>            </span><span class="hs-comment">--       by the user</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083885"><span class="annot"><span class="annottext">keep_me :: VarSet
</span><a href="#local-6989586621683083885"><span class="hs-identifier hs-var hs-var hs-var">keep_me</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083880"><span class="hs-identifier hs-var">psig_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083883"><span class="hs-identifier hs-var">free_tvs</span></a></span><span>
</span><span id="line-1091"></span><span>                 </span><span id="local-6989586621683083886"><span class="annot"><span class="annottext">my_theta :: TcThetaType
</span><a href="#local-6989586621683083886"><span class="hs-identifier hs-var hs-var hs-var">my_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcThetaType -&gt; TcThetaType
</span><a href="GHC.Tc.Utils.TcType.html#pickCapturedPreds"><span class="hs-identifier hs-var">pickCapturedPreds</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683083885"><span class="hs-identifier hs-var">keep_me</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083832"><span class="hs-identifier hs-var">inferred_theta</span></a></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span>           </span><span class="hs-comment">-- Fill in the extra-constraints wildcard hole with inferred_theta,</span><span>
</span><span id="line-1094"></span><span>           </span><span class="hs-comment">-- so that the Hole constraint we have already emitted</span><span>
</span><span id="line-1095"></span><span>           </span><span class="hs-comment">-- (in tcHsPartialSigType) can report what filled it in.</span><span>
</span><span id="line-1096"></span><span>           </span><span class="hs-comment">-- NB: my_theta already includes all the annotated constraints</span><span>
</span><span id="line-1097"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083887"><span class="annot"><a href="#local-6989586621683083887"><span class="hs-identifier hs-var">diff_theta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcThetaType -&gt; TcThetaType -&gt; TcM TcThetaType
</span><a href="GHC.Tc.Solver.html#findInferredDiff"><span class="hs-identifier hs-var">findInferredDiff</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083881"><span class="hs-identifier hs-var">annotated_theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083886"><span class="hs-identifier hs-var">my_theta</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#getCastedTyVar_maybe"><span class="hs-identifier hs-type">getCastedTyVar_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083882"><span class="hs-identifier hs-type">wc_var_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1100"></span><span>               </span><span class="hs-comment">-- We know that wc_co must have type kind(wc_var) ~ Constraint, as it</span><span>
</span><span id="line-1101"></span><span>               </span><span class="hs-comment">-- comes from the checkExpectedKind in GHC.Tc.Gen.HsType.tcAnonWildCardOcc.</span><span>
</span><span id="line-1102"></span><span>               </span><span class="hs-comment">-- So, to make the kinds work out, we reverse the cast here.</span><span>
</span><span id="line-1103"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083890"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083890"><span class="hs-identifier hs-var">wc_var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083891"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683083891"><span class="hs-identifier hs-var">wc_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; ZonkM () -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1104"></span><span>                                       </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcId -&gt; Kind -&gt; ZonkM ()
TcId -&gt; Kind -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083890"><span class="hs-identifier hs-var">wc_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcThetaType -&gt; Kind
</span><a href="GHC.Builtin.Types.html#mkConstraintTupleTy"><span class="hs-identifier hs-var">mkConstraintTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><a href="#local-6989586621683083887"><span class="hs-identifier hs-var">diff_theta</span></a></span><span>
</span><span id="line-1105"></span><span>                                                              </span><span class="annot"><span class="annottext">Kind -&gt; TcCoercionR -&gt; Kind
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; TcCoercionR
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683083891"><span class="hs-identifier hs-var">wc_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>               </span><span class="annot"><span class="annottext">Maybe (TcId, TcCoercionR)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;chooseInferredQuantifiers 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083882"><span class="hs-identifier hs-var">wc_var_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;completeTheta&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1109"></span><span>                </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083835"><span class="hs-identifier hs-type">sig</span></a></span><span>
</span><span id="line-1110"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;annotated_theta:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083881"><span class="hs-identifier hs-type">annotated_theta</span></a></span><span>
</span><span id="line-1111"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inferred_theta:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083832"><span class="hs-identifier hs-type">inferred_theta</span></a></span><span>
</span><span id="line-1112"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;my_theta:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083886"><span class="hs-identifier hs-type">my_theta</span></a></span><span>
</span><span id="line-1113"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;diff_theta:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083887"><span class="hs-identifier hs-type">diff_theta</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1114"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083883"><span class="hs-identifier hs-type">free_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083881"><span class="hs-identifier hs-type">annotated_theta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683083887"><span class="hs-identifier hs-type">diff_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1115"></span><span>             </span><span class="hs-comment">-- Return (annotated_theta ++ diff_theta)</span><span>
</span><span id="line-1116"></span><span>             </span><span class="hs-comment">-- See Note [Extra-constraints wildcards]</span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span>    </span><span id="local-6989586621683083855"><span class="annot"><span class="annottext">report_dup_tyvar_tv_err :: Name
-&gt; HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsSigType GhcRn))
-&gt; (Name, Name)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683083855"><span class="hs-identifier hs-var hs-var">report_dup_tyvar_tv_err</span></a></span></span><span> </span><span id="local-6989586621683083893"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083893"><span class="hs-identifier hs-var">fn_name</span></a></span></span><span> </span><span id="local-6989586621683083894"><span class="annot"><span class="annottext">HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsSigType GhcRn))
</span><a href="#local-6989586621683083894"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083895"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083895"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683083896"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083896"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1119"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name -&gt; LHsSigWcType GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnPartialTypeSigTyVarMismatch"><span class="hs-identifier hs-var">TcRnPartialTypeSigTyVarMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083895"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083896"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083893"><span class="hs-identifier hs-var">fn_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsSigType GhcRn))
</span><a href="#local-6989586621683083894"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span>    </span><span id="local-6989586621683083857"><span class="annot"><span class="annottext">report_mono_sig_tv_err :: Name
-&gt; HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsSigType GhcRn))
-&gt; (Name, TcId)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683083857"><span class="hs-identifier hs-var hs-var">report_mono_sig_tv_err</span></a></span></span><span> </span><span id="local-6989586621683083899"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083899"><span class="hs-identifier hs-var">fn_name</span></a></span></span><span> </span><span id="local-6989586621683083900"><span class="annot"><span class="annottext">HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsSigType GhcRn))
</span><a href="#local-6989586621683083900"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083901"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083901"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683083902"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083902"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe Kind -&gt; LHsSigWcType GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnPartialTypeSigBadQuantifier"><span class="hs-identifier hs-var">TcRnPartialTypeSigBadQuantifier</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083901"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083899"><span class="hs-identifier hs-var">fn_name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621683083904"><span class="hs-identifier hs-var">m_unif_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsSigType GhcRn))
</span><a href="#local-6989586621683083900"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1124"></span><span>        </span><span id="local-6989586621683083904"><span class="annot"><span class="annottext">m_unif_ty :: Maybe Kind
</span><a href="#local-6989586621683083904"><span class="hs-identifier hs-var hs-var">m_unif_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcThetaType -&gt; Maybe Kind
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span>
</span><span id="line-1125"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083906"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1126"></span><span>                      </span><span class="hs-comment">-- recall that residuals are always implications</span><span>
</span><span id="line-1127"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683083907"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621683083907"><span class="hs-identifier hs-var">residual_implic</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bag Implication -&gt; [Implication]
forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Bag Implication -&gt; [Implication])
-&gt; Bag Implication -&gt; [Implication]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Implication
</span><a href="GHC.Tc.Types.Constraint.html#wc_impl"><span class="hs-identifier hs-var">wc_impl</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683083831"><span class="hs-identifier hs-var">residual</span></a></span><span>
</span><span id="line-1128"></span><span>                      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083910"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683083910"><span class="hs-identifier hs-var">residual_ct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; [Ct]
forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Bag Ct -&gt; [Ct]) -&gt; Bag Ct -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Implication -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621683083907"><span class="hs-identifier hs-var">residual_implic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083913"><span class="annot"><span class="annottext">residual_pred :: Kind
</span><a href="#local-6989586621683083913"><span class="hs-identifier hs-var hs-var">residual_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Kind
</span><a href="GHC.Tc.Types.Constraint.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683083910"><span class="hs-identifier hs-var">residual_ct</span></a></span><span>
</span><span id="line-1130"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083915"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083915"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083906"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083906"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Maybe (Role, Kind, Kind)
</span><a href="GHC.Core.Predicate.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083913"><span class="hs-identifier hs-var">residual_pred</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1131"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083917"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083917"><span class="hs-identifier hs-var">lhs_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Maybe TcId
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083915"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1132"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083917"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcId -&gt; TcId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083902"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1133"></span><span>
</span><span id="line-1134"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier hs-var">chooseInferredQuantifiers</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcThetaType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TcId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083919"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083919"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ([VarBndr TcId Specificity], TcThetaType)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;chooseInferredQuantifiers&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083919"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mk_inf_msg"><span class="hs-identifier hs-type">mk_inf_msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span id="mk_inf_msg"><span class="annot"><span class="annottext">mk_inf_msg :: Name -&gt; Kind -&gt; TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="GHC.Tc.Gen.Bind.html#mk_inf_msg"><span class="hs-identifier hs-var hs-var">mk_inf_msg</span></a></span></span><span> </span><span id="local-6989586621683083920"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083920"><span class="hs-identifier hs-var">poly_name</span></a></span></span><span> </span><span id="local-6989586621683083921"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083921"><span class="hs-identifier hs-var">poly_ty</span></a></span></span><span> </span><span id="local-6989586621683083922"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683083922"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span>
</span><span id="line-1139"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083923"><span class="annot"><a href="#local-6989586621683083923"><span class="hs-identifier hs-var">tidy_env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083924"><span class="annot"><a href="#local-6989586621683083924"><span class="hs-identifier hs-var">poly_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Kind -&gt; ZonkM (TidyEnv, Kind)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683083922"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083921"><span class="hs-identifier hs-var">poly_ty</span></a></span><span>
</span><span id="line-1140"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083926"><span class="annot"><a href="#local-6989586621683083926"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking the inferred type&quot;</span></span><span>
</span><span id="line-1141"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BKey -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">BKey
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083920"><span class="hs-identifier hs-var">poly_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083924"><span class="hs-identifier hs-var">poly_ty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1142"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083923"><span class="hs-identifier hs-type">tidy_env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083926"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span class="annot"><span class="hs-comment">-- | Warn the user about polymorphic local binders that lack type signatures.</span></span><span>
</span><span id="line-1145"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#localSigWarn"><span class="hs-identifier hs-type">localSigWarn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1146"></span><span id="localSigWarn"><span class="annot"><span class="annottext">localSigWarn :: TcId -&gt; Maybe TcIdSigInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Gen.Bind.html#localSigWarn"><span class="hs-identifier hs-var hs-var">localSigWarn</span></a></span></span><span> </span><span id="local-6989586621683083928"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083928"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621683083929"><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683083929"><span class="hs-identifier hs-var">mb_sig</span></a></span></span><span>
</span><span id="line-1147"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683083929"><span class="hs-identifier hs-var">mb_sig</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1148"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isSigmaTy"><span class="hs-identifier hs-var">isSigmaTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083928"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1149"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Gen.Bind.html#warnMissingSignatures"><span class="hs-identifier hs-var">warnMissingSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083928"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#warnMissingSignatures"><span class="hs-identifier hs-type">warnMissingSignatures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1152"></span><span id="warnMissingSignatures"><span class="annot"><span class="annottext">warnMissingSignatures :: TcId -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Gen.Bind.html#warnMissingSignatures"><span class="hs-identifier hs-var hs-var">warnMissingSignatures</span></a></span></span><span> </span><span id="local-6989586621683083932"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083932"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-1153"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083933"><span class="annot"><a href="#local-6989586621683083933"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv -&gt; TcM TidyEnv
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM TidyEnv -&gt; TcM TidyEnv) -&gt; ZonkM TidyEnv -&gt; TcM TidyEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv
</span><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span>
</span><span id="line-1154"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083935"><span class="annot"><a href="#local-6989586621683083935"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083936"><span class="annot"><a href="#local-6989586621683083936"><span class="hs-identifier hs-var">tidy_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier hs-type">tidyOpenTypeX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083933"><span class="hs-identifier hs-type">env0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083932"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083937"><span class="annot"><a href="#local-6989586621683083937"><span class="hs-identifier hs-var hs-var">dia</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnPolymorphicBinderMissingSig"><span class="hs-identifier hs-var">TcRnPolymorphicBinderMissingSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083932"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083936"><span class="hs-identifier hs-var">tidy_ty</span></a></span><span>
</span><span id="line-1156"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTcM"><span class="hs-identifier hs-type">addDiagnosticTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083935"><span class="hs-identifier hs-type">env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083937"><span class="hs-identifier hs-type">dia</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span class="hs-comment">{- Note [Partial type signatures and generalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If /any/ of the signatures in the group is a partial type signature
   f :: _ -&gt; Int
then we *always* use the InferGen plan, and hence tcPolyInfer.
We do this even for a local binding with -XMonoLocalBinds, when
we normally use NoGen.

Reasons:
  * The TcSigInfo for 'f' has a unification variable for the '_',
    whose TcLevel is one level deeper than the current level.
    (See pushTcLevelM in tcTySig.)  But NoGen doesn't increase
    the TcLevel like InferGen, so we lose the level invariant.

  * The signature might be   f :: forall a. _ -&gt; a
    so it really is polymorphic.  It's not clear what it would
    mean to use NoGen on this, and indeed the ASSERT in tcLhs,
    in the (Just sig) case, checks that if there is a signature
    then we are using LetLclBndr, and hence a nested AbsBinds with
    increased TcLevel

It might be possible to fix these difficulties somehow, but there
doesn't seem much point.  Indeed, adding a partial type signature is a
way to get per-binding inferred generalisation.

Note [Quantified variables in partial type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  f :: forall a. a -&gt; a -&gt; _
  f x y = g x y
  g :: forall b. b -&gt; b -&gt; _
  g x y = [x, y]

Here, 'f' and 'g' are mutually recursive, and we end up unifying 'a' and 'b'
together, which is fine.  So we bind 'a' and 'b' to TyVarTvs, which can then
unify with each other.

But now consider:
  f :: forall a b. a -&gt; b -&gt; _
  f x y = [x, y]

We want to get an error from this, because 'a' and 'b' get unified.
So we make a test, one per partial signature, to check that the
explicitly-quantified type variables have not been unified together.
#14449 showed this up.

Note [Extra-constraints wildcards]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this from #18646
    class Foo x where
      foo :: x

    bar :: (Foo (), _) =&gt; f ()
    bar = pure foo

We get [W] Foo (), [W] Applicative f.   When we do pickCapturedPreds in
choose_psig_context, we'll discard Foo ()!  Usually would not quantify over
such (closed) predicates.  So my_theta will be (Applicative f). But we really
do want to quantify over (Foo ()) -- it was specified by the programmer.
Solution: always return annotated_theta (user-specified) plus the extra piece
diff_theta.

Note [Validity of inferred types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We need to check inferred type for validity, in case it uses language
extensions that are not turned on.  The principle is that if the user
simply adds the inferred type to the program source, it'll compile fine.
See #8883.

Examples that might fail:
 - the type might be ambiguous

 - an inferred theta that requires type equalities e.g. (F a ~ G b)
                                or multi-parameter type classes
 - an inferred type that includes unboxed tuples

Note [Inferred type with escaping kind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Check for an inferred type with an escaping kind; e.g. #23051
   forall {k} {f :: k -&gt; RuntimeRep} {g :: k} {a :: TYPE (f g)}. a
where the kind of the body of the forall mentions `f` and `g` which
are bound by the forall.  No no no.

This check, mkInferredPolyId, is really in the wrong place:
`inferred_poly_ty` doesn't obey the PKTI and it would be better not to
generalise it in the first place; see #20686.  But for now it works.

I considered adjusting the generalisation in GHC.Tc.Solver to directly check for
escaping kind variables; instead, promoting or defaulting them. But that
gets into the defaulting swamp and is a non-trivial and unforced
change, so I have left it alone for now.

Note [Impedance matching]
~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   f 0 x = x
   f n x = g [] (not x)

   g [] y = f 10 y
   g _  y = f 9  y

After typechecking we'll get
  f_mono_ty :: a -&gt; Bool -&gt; Bool
  g_mono_ty :: [b] -&gt; Bool -&gt; Bool
with constraints
  (Eq a, Num a)

Note that f is polymorphic in 'a' and g in 'b'; and these are not linked.
The types we really want for f and g are
   f :: forall a. (Eq a, Num a) =&gt; a -&gt; Bool -&gt; Bool
   g :: forall b. [b] -&gt; Bool -&gt; Bool

We can get these by &quot;impedance matching&quot;:
   tuple :: forall a b. (Eq a, Num a) =&gt; (a -&gt; Bool -&gt; Bool, [b] -&gt; Bool -&gt; Bool)
   tuple a b d1 d1 = let ...bind f_mono, g_mono in (f_mono, g_mono)

   f a d1 d2 = case tuple a Any d1 d2 of (f_mono, g_mono) -&gt; f_mono
   g b = case tuple Integer b dEqInteger dNumInteger of (f_mono,g_mono) -&gt; g_mono

Suppose the shared quantified tyvars are qtvs and constraints theta.
Then we want to check that
     forall qtvs. theta =&gt; f_mono_ty   is more polymorphic than   f's polytype
and the proof is the impedance matcher.

The impedance matcher can do defaulting: in the above example, we default
to Integer because of Num. See #7173. If we're dealing with a nondefaultable
class, impedance matching can fail. See #23427.

Note [SPECIALISE pragmas]
~~~~~~~~~~~~~~~~~~~~~~~~~
There is no point in a SPECIALISE pragma for a non-overloaded function:
   reverse :: [a] -&gt; [a]
   {-# SPECIALISE reverse :: [Int] -&gt; [Int] #-}

But SPECIALISE INLINE *can* make sense for GADTS:
   data Arr e where
     ArrInt :: !Int -&gt; ByteArray# -&gt; Arr Int
     ArrPair :: !Int -&gt; Arr e1 -&gt; Arr e2 -&gt; Arr (e1, e2)

   (!:) :: Arr e -&gt; Int -&gt; e
   {-# SPECIALISE INLINE (!:) :: Arr Int -&gt; Int -&gt; Int #-}
   {-# SPECIALISE INLINE (!:) :: Arr (a, b) -&gt; Int -&gt; (a, b) #-}
   (ArrInt _ ba)     !: (I# i) = I# (indexIntArray# ba i)
   (ArrPair _ a1 a2) !: i      = (a1 !: i, a2 !: i)

When (!:) is specialised it becomes non-recursive, and can usefully
be inlined.  Scary!  So we only warn for SPECIALISE *without* INLINE
for a non-overloaded function.

************************************************************************
*                                                                      *
                         tcMonoBinds
*                                                                      *
************************************************************************

@tcMonoBinds@ deals with a perhaps-recursive group of HsBinds.
The signatures have been dealt with already.
-}</span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span class="hs-keyword">data</span><span> </span><span id="MonoBindInfo"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-var">MonoBindInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MBI"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-var">MBI</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="mbi_poly_name"><span class="annot"><span class="annottext">MonoBindInfo -&gt; Name
</span><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var hs-var">mbi_poly_name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1318"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="mbi_sig"><span class="annot"><span class="annottext">MonoBindInfo -&gt; Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var hs-var">mbi_sig</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a></span><span>
</span><span id="line-1319"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="mbi_mono_id"><span class="annot"><span class="annottext">MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var hs-var">mbi_mono_id</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-1320"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="mbi_mono_mult"><span class="annot"><span class="annottext">MonoBindInfo -&gt; Kind
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_mult"><span class="hs-identifier hs-var hs-var">mbi_mono_mult</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1321"></span><span>
</span><span id="line-1322"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMonoBinds"><span class="hs-identifier hs-type">tcMonoBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span>  </span><span class="hs-comment">-- Whether the binding is recursive for typechecking purposes</span><span>
</span><span id="line-1323"></span><span>                        </span><span class="hs-comment">-- i.e. the binders are mentioned in their RHSs, and</span><span>
</span><span id="line-1324"></span><span>                        </span><span class="hs-comment">--      we are not rescued by a type signature</span><span>
</span><span id="line-1325"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span>
</span><span id="line-1326"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1327"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1328"></span><span>
</span><span id="line-1329"></span><span class="hs-comment">-- SPECIAL CASE 1: see Note [Special case for non-recursive function bindings]</span><span>
</span><span id="line-1330"></span><span id="tcMonoBinds"><span class="annot"><span class="annottext">tcMonoBinds :: RecFlag
-&gt; TcSigFun
-&gt; LetBndrSpec
-&gt; LHsBinds GhcRn
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
</span><a href="GHC.Tc.Gen.Bind.html#tcMonoBinds"><span class="hs-identifier hs-var hs-var">tcMonoBinds</span></a></span></span><span> </span><span id="local-6989586621683083941"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083941"><span class="hs-identifier hs-var">is_rec</span></a></span></span><span> </span><span id="local-6989586621683083942"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083942"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083943"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683083943"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span>
</span><span id="line-1331"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683083944"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083944"><span class="hs-identifier hs-var">b_loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683083945"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683083945"><span class="hs-identifier hs-var">nm_loc</span></a></span></span><span> </span><span id="local-6989586621683083946"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083946"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1332"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_matches :: forall idL idR. HsBindLR idL idR -&gt; MatchGroup idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083947"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083947"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1333"></span><span>                             </span><span class="hs-comment">-- Single function binding,</span><span>
</span><span id="line-1334"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083941"><span class="hs-identifier hs-var">is_rec</span></a></span><span>   </span><span class="hs-comment">-- ...binder isn't mentioned in RHS</span><span>
</span><span id="line-1335"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TcSigInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083942"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083946"><span class="hs-identifier hs-var">name</span></a></span><span>   </span><span class="hs-comment">-- ...with no type signature</span><span>
</span><span id="line-1336"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083944"><span class="hs-identifier hs-var">b_loc</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM (LHsBinds GhcTc, [MonoBindInfo])
 -&gt; TcM (LHsBinds GhcTc, [MonoBindInfo]))
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1337"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083948"><span class="annot"><a href="#local-6989586621683083948"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMultAnn GhcRn -&gt; TcM Kind
</span><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-var">tcMultAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XNoMultAnn GhcRn -&gt; HsMultAnn GhcRn
forall pass. XNoMultAnn pass -&gt; HsMultAnn pass
</span><a href="Language.Haskell.Syntax.Binds.html#HsNoMultAnn"><span class="hs-identifier hs-var">HsNoMultAnn</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XNoMultAnn GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683083949"><span class="annot"><a href="#local-6989586621683083949"><span class="hs-identifier hs-var">co_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083950"><span class="annot"><a href="#local-6989586621683083950"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083951"><span class="annot"><a href="#local-6989586621683083951"><span class="hs-identifier hs-var">rhs_ty'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInferFRR"><span class="hs-identifier hs-type">tcInferFRR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBinder"><span class="hs-identifier hs-type">FRRBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083946"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683083953"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683083953"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1341"></span><span>                 </span><span class="hs-comment">-- tcInferFRR: the type of a let-binder must have</span><span>
</span><span id="line-1342"></span><span>                 </span><span class="hs-comment">-- a fixed runtime rep. See #23176</span><span>
</span><span id="line-1343"></span><span>               </span><span class="annot"><span class="annottext">[TcBinder]
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall a. [TcBinder] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendBinderStack"><span class="hs-identifier hs-var">tcExtendBinderStack</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; ExpSigmaType -&gt; TopLevelFlag -&gt; TcBinder
</span><a href="GHC.Tc.Types.BasicTypes.html#TcIdBndr_ExpType"><span class="hs-identifier hs-var">TcIdBndr_ExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083946"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683083953"><span class="hs-identifier hs-var">exp_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
 -&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc)))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1344"></span><span>                 </span><span class="hs-comment">-- We extend the error context even for a non-recursive</span><span>
</span><span id="line-1345"></span><span>                 </span><span class="hs-comment">-- function so that in type error messages we show the</span><span>
</span><span id="line-1346"></span><span>                 </span><span class="hs-comment">-- type of the thing whose rhs we are type checking.</span><span>
</span><span id="line-1347"></span><span>                 </span><span class="hs-comment">-- See Note [Relevant bindings and the binder stack]</span><span>
</span><span id="line-1348"></span><span>               </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; Name
-&gt; Kind
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; [ExpPatType]
-&gt; ExpSigmaType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcFunBindMatches"><span class="hs-identifier hs-var">tcFunBindMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#InfSigCtxt"><span class="hs-identifier hs-var">InfSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083946"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083946"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083948"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083947"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683083953"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-1349"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683083955"><span class="annot"><a href="#local-6989586621683083955"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-type">newLetBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083943"><span class="hs-identifier hs-type">no_gen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083946"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083948"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083951"><span class="hs-identifier hs-type">rhs_ty'</span></a></span><span>
</span><span id="line-1350"></span><span>
</span><span id="line-1351"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083944"><span class="hs-identifier hs-type">b_loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1352"></span><span>                     </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083945"><span class="hs-identifier hs-type">nm_loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083955"><span class="hs-identifier hs-type">mono_id</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1353"></span><span>                               </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083950"><span class="hs-identifier hs-type">matches'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1354"></span><span>                               </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#fun_ext"><span class="hs-identifier hs-var">fun_ext</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083949"><span class="hs-identifier hs-type">co_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-1355"></span><span>                  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083946"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-1356"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1357"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083955"><span class="hs-identifier hs-type">mono_id</span></a></span><span>
</span><span id="line-1358"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_mono_mult"><span class="hs-identifier hs-var">mbi_mono_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083948"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span class="hs-comment">-- SPECIAL CASE 2: see Note [Special case for non-recursive pattern bindings]</span><span>
</span><span id="line-1361"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMonoBinds"><span class="hs-identifier hs-var">tcMonoBinds</span></a></span><span> </span><span id="local-6989586621683083958"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083958"><span class="hs-identifier hs-var">is_rec</span></a></span></span><span> </span><span id="local-6989586621683083959"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083959"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083960"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683083960"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span>
</span><span id="line-1362"></span><span>           </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683083961"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683083961"><span class="hs-identifier hs-var">b_loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_lhs :: forall idL idR. HsBindLR idL idR -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083962"><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683083962"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_rhs :: forall idL idR. HsBindLR idL idR -&gt; GRHSs idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#pat_rhs"><span class="hs-identifier hs-var">pat_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083964"><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083964"><span class="hs-identifier hs-var">grhss</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_mult :: forall idL idR. HsBindLR idL idR -&gt; HsMultAnn idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_mult"><span class="hs-identifier hs-var">pat_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083965"><span class="annot"><span class="annottext">HsMultAnn GhcRn
</span><a href="#local-6989586621683083965"><span class="hs-identifier hs-var">mult_ann</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1363"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621683083958"><span class="hs-identifier hs-var">is_rec</span></a></span><span>   </span><span class="hs-comment">-- ...binder isn't mentioned in RHS</span><span>
</span><span id="line-1364"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TcSigInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe TcSigInfo -&gt; Bool) -&gt; TcSigFun -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083959"><span class="hs-identifier hs-var">sig_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683083967"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1365"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn) -&gt; GRHSs GhcRn (LHsExpr GhcRn) -&gt; SDoc
forall (p :: Pass).
OutputableBndrId p =&gt;
LPat (GhcPass p) -&gt; GRHSs GhcRn (LHsExpr GhcRn) -&gt; SDoc
</span><a href="GHC.Tc.Gen.Bind.html#patMonoBindsCtxt"><span class="hs-identifier hs-var">patMonoBindsCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683083962"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083964"><span class="hs-identifier hs-var">grhss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsBinds GhcTc, [MonoBindInfo])
 -&gt; TcM (LHsBinds GhcTc, [MonoBindInfo]))
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
-&gt; TcM (LHsBinds GhcTc, [MonoBindInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1366"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083970"><span class="annot"><a href="#local-6989586621683083970"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMultAnn GhcRn -&gt; TcM Kind
</span><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-var">tcMultAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsMultAnn GhcRn
</span><a href="#local-6989586621683083965"><span class="hs-identifier hs-var">mult_ann</span></a></span><span>
</span><span id="line-1367"></span><span>
</span><span id="line-1368"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083971"><span class="annot"><a href="#local-6989586621683083971"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083972"><span class="annot"><a href="#local-6989586621683083972"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInferFRR"><span class="hs-identifier hs-type">tcInferFRR</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRPatBind"><span class="hs-identifier hs-type">FRRPatBind</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683083974"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683083974"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1369"></span><span>                          </span><span class="hs-comment">-- tcInferFRR: the type of each let-binder must have</span><span>
</span><span id="line-1370"></span><span>                          </span><span class="hs-comment">-- a fixed runtime rep. See #23176</span><span>
</span><span id="line-1371"></span><span>                             </span><span class="annot"><span class="annottext">Kind
-&gt; GRHSs GhcRn (LHsExpr GhcRn)
-&gt; ExpSigmaType
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSsPat"><span class="hs-identifier hs-var">tcGRHSsPat</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083970"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683083964"><span class="hs-identifier hs-var">grhss</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683083974"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683083975"><span class="hs-identifier hs-type">exp_pat_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span>
</span><span id="line-1374"></span><span>             </span><span id="local-6989586621683083975"><span class="annot"><a href="#local-6989586621683083975"><span class="hs-identifier hs-var hs-var">exp_pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; ExpSigmaType -&gt; Scaled ExpSigmaType
forall a. Kind -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083970"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683083972"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1375"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683083977"><span class="annot"><a href="#local-6989586621683083977"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683083978"><span class="annot"><a href="#local-6989586621683083978"><span class="hs-identifier hs-var">mbis</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-type">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1376"></span><span>                         </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier hs-type">tcLetPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083960"><span class="hs-identifier hs-type">no_gen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083962"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083975"><span class="hs-identifier hs-type">exp_pat_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1377"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-type">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#bottomUE"><span class="hs-identifier hs-type">bottomUE</span></a></span><span>
</span><span id="line-1378"></span><span>                           </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#lookupMBI"><span class="hs-identifier hs-type">lookupMBI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083967"><span class="hs-identifier hs-type">bndrs</span></a></span><span>
</span><span id="line-1379"></span><span>            </span><span class="hs-comment">-- What's happening here? Typing pattern-matching (either from case</span><span>
</span><span id="line-1380"></span><span>            </span><span class="hs-comment">-- expression or equation) and typing bindings (let or where) have a</span><span>
</span><span id="line-1381"></span><span>            </span><span class="hs-comment">-- different control flow: for pattern-matching, the rhs is typed</span><span>
</span><span id="line-1382"></span><span>            </span><span class="hs-comment">-- within the `thing_inside` argument. The type-checker walks down</span><span>
</span><span id="line-1383"></span><span>            </span><span class="hs-comment">-- the pattern, and when finally it is done, all variables have been</span><span>
</span><span id="line-1384"></span><span>            </span><span class="hs-comment">-- added to the environment, thing_inside is called. So, when</span><span>
</span><span id="line-1385"></span><span>            </span><span class="hs-comment">-- type-checking patterns, the check for the correctness of</span><span>
</span><span id="line-1386"></span><span>            </span><span class="hs-comment">-- multiplicity is generated in the VarPat case. This is quite</span><span>
</span><span id="line-1387"></span><span>            </span><span class="hs-comment">-- natural.</span><span>
</span><span id="line-1388"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-1389"></span><span>            </span><span class="hs-comment">-- Bindings, however, have a more complex control flow for our</span><span>
</span><span id="line-1390"></span><span>            </span><span class="hs-comment">-- purpose: we collect all the variables as we go down, then return</span><span>
</span><span id="line-1391"></span><span>            </span><span class="hs-comment">-- them (here as `mapM lookupMBI bndrs`), and in a subsequent</span><span>
</span><span id="line-1392"></span><span>            </span><span class="hs-comment">-- computation (rather than an inner computation), the rhs is</span><span>
</span><span id="line-1393"></span><span>            </span><span class="hs-comment">-- type-checked. This poses a problem here: we're calling</span><span>
</span><span id="line-1394"></span><span>            </span><span class="hs-comment">-- `tcLetPat`, which will verify the proper usage of the introduced</span><span>
</span><span id="line-1395"></span><span>            </span><span class="hs-comment">-- variable when reaching the `VarPat` case. But there is no actual</span><span>
</span><span id="line-1396"></span><span>            </span><span class="hs-comment">-- usage of variable in the `thing_inside`. This would always</span><span>
</span><span id="line-1397"></span><span>            </span><span class="hs-comment">-- fail. So we emit a `bottomUE`, which is compatible with every</span><span>
</span><span id="line-1398"></span><span>            </span><span class="hs-comment">-- usage. So that we can bypass the check in VarPat. Then we use</span><span>
</span><span id="line-1399"></span><span>            </span><span class="hs-comment">-- `tcCollectingUsage` to throw the `bottomUE` away, since it would</span><span>
</span><span id="line-1400"></span><span>            </span><span class="hs-comment">-- let us bypass many linearity checks.</span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083961"><span class="hs-identifier hs-type">b_loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1403"></span><span>                     </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083977"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_rhs"><span class="hs-identifier hs-var">pat_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683083971"><span class="hs-identifier hs-type">grhss'</span></a></span><span>
</span><span id="line-1404"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_ext"><span class="hs-identifier hs-var">pat_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683083972"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1405"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_mult"><span class="hs-identifier hs-var">pat_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#setTcMultAnn"><span class="hs-identifier hs-type">setTcMultAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083970"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083965"><span class="hs-identifier hs-type">mult_ann</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1406"></span><span>
</span><span id="line-1407"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083978"><span class="hs-identifier hs-type">mbis</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1408"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1409"></span><span>    </span><span id="local-6989586621683083967"><span class="annot"><span class="annottext">bndrs :: [IdP GhcRn]
</span><a href="#local-6989586621683083967"><span class="hs-identifier hs-var hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; XRec GhcRn (Pat GhcRn) -&gt; [IdP GhcRn]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683083962"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-1410"></span><span>
</span><span id="line-1411"></span><span class="hs-comment">-- GENERAL CASE</span><span>
</span><span id="line-1412"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMonoBinds"><span class="hs-identifier hs-var">tcMonoBinds</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683083986"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083986"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683083987"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683083987"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span id="local-6989586621683083988"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683083988"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-1413"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683083989"><span class="annot"><a href="#local-6989586621683083989"><span class="hs-identifier hs-var">tc_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBind GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA TcMonoBind))
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA TcMonoBind]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsBind GhcRn -&gt; TcM TcMonoBind)
-&gt; GenLocated SrcSpanAnnA (HsBind GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA TcMonoBind)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSigFun -&gt; LetBndrSpec -&gt; HsBind GhcRn -&gt; TcM TcMonoBind
</span><a href="GHC.Tc.Gen.Bind.html#tcLhs"><span class="hs-identifier hs-var">tcLhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683083986"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683083987"><span class="hs-identifier hs-var">no_gen</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683083988"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1414"></span><span>
</span><span id="line-1415"></span><span>        </span><span class="hs-comment">-- Bring the monomorphic Ids, into scope for the RHSs</span><span>
</span><span id="line-1416"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683083992"><span class="annot"><a href="#local-6989586621683083992"><span class="hs-identifier hs-var hs-var">mono_infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA TcMonoBind] -&gt; [MonoBindInfo]
</span><a href="GHC.Tc.Gen.Bind.html#getMonoBindInfo"><span class="hs-identifier hs-var">getMonoBindInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA TcMonoBind]
</span><a href="#local-6989586621683083989"><span class="hs-identifier hs-var">tc_binds</span></a></span><span>
</span><span id="line-1417"></span><span>              </span><span id="local-6989586621683083994"><span class="annot"><a href="#local-6989586621683083994"><span class="hs-identifier hs-var hs-var">rhs_id_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083995"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083996"><span class="hs-identifier hs-var">mono_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1418"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_poly_name :: MonoBindInfo -&gt; Name
</span><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083995"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683083995"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1419"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_sig :: MonoBindInfo -&gt; Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083997"><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683083997"><span class="hs-identifier hs-var">mb_sig</span></a></span></span><span>
</span><span id="line-1420"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_id :: MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683083996"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683083996"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683083992"><span class="hs-identifier hs-var">mono_infos</span></a></span><span>
</span><span id="line-1421"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683083997"><span class="hs-identifier hs-var">mb_sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1422"></span><span>                               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683083998"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083998"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst -&gt; Bool
</span><a href="GHC.Tc.Types.BasicTypes.html#isPartialSig"><span class="hs-identifier hs-var">isPartialSig</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683083998"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1423"></span><span>                               </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1424"></span><span>                </span><span class="hs-comment">-- A monomorphic binding for each term variable that lacks</span><span>
</span><span id="line-1425"></span><span>                </span><span class="hs-comment">-- a complete type sig.  (Ones with a sig are already in scope.)</span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcMonoBinds&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084000"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084001"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084001"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span>                                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683084000"><span class="annot"><a href="#local-6989586621683084000"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683084001"><span class="annot"><a href="#local-6989586621683084001"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683083994"><span class="hs-identifier hs-type">rhs_id_env</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1429"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683084002"><span class="annot"><a href="#local-6989586621683084002"><span class="hs-identifier hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendRecIds"><span class="hs-identifier hs-type">tcExtendRecIds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683083994"><span class="hs-identifier hs-type">rhs_id_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1430"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-type">wrapLocMA</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcRhs"><span class="hs-identifier hs-type">tcRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683083989"><span class="hs-identifier hs-type">tc_binds</span></a></span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683084002"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683083992"><span class="hs-identifier hs-type">mono_infos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span class="hs-comment">{- Note [Special case for non-recursive function bindings]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In the special case of
* A non-recursive FunBind
* With no type signature
we infer the type of the right hand side first (it may have a
higher-rank type) and *then* make the monomorphic Id for the LHS e.g.
   f = \(x::forall a. a-&gt;a) -&gt; &lt;body&gt;

We want to infer a higher-rank type for f

Note [Special case for non-recursive pattern bindings]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In the special case of
* A pattern binding
* With no type signature for any of the binders
we can /infer/ the type of the RHS, and /check/ the pattern
against that type.  For example (#18323)

  ids :: [forall a. a -&gt; a]
  combine :: (forall a . [a] -&gt; a) -&gt; [forall a. a -&gt; a]
          -&gt; ((forall a . [a] -&gt; a), [forall a. a -&gt; a])

  (x,y) = combine head ids

with -XImpredicativeTypes we can infer a good type for
(combine head ids), and use that to tell us the polymorphic
types of x and y.

We don't need to check -XImpredicativeTypes because without it
these types like [forall a. a-&gt;a] are illegal anyway, so this
special case code only really has an effect if -XImpredicativeTypes
is on.  Small exception:
  (x) = e
is currently treated as a pattern binding so, even absent
-XImpredicativeTypes, we will get a small improvement in behaviour.
But I don't think it's worth an extension flag.

Why do we require no type signatures on /any/ of the binders?
Consider
   x :: forall a. a-&gt;a
   y :: forall a. a-&gt;a
   (x,y) = (id,id)

Here we should /check/ the RHS with expected type
  (forall a. a-&gt;a, forall a. a-&gt;a).

If we have no signatures, we can the approach of this Note
to /infer/ the type of the RHS.

But what if we have some signatures, but not all? Say this:
  p :: forall a. a-&gt;a
  (p,q) = (id,  (\(x::forall b. b-&gt;b). x True))

Here we want to push p's signature inwards, i.e. /checking/, to
correctly elaborate 'id'. But we want to /infer/ q's higher rank
type.  There seems to be no way to do this.  So currently we only
switch to inference when we have no signature for any of the binders.

-}</span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span>
</span><span id="line-1496"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-1497"></span><span class="hs-comment">-- tcLhs typechecks the LHS of the bindings, to construct the environment in which</span><span>
</span><span id="line-1498"></span><span class="hs-comment">-- we typecheck the RHSs.  Basically what we are doing is this: for each binder:</span><span>
</span><span id="line-1499"></span><span class="hs-comment">--      if there's a signature for it, use the instantiated signature type</span><span>
</span><span id="line-1500"></span><span class="hs-comment">--      otherwise invent a type variable</span><span>
</span><span id="line-1501"></span><span class="hs-comment">-- You see that quite directly in the FunBind case.</span><span>
</span><span id="line-1502"></span><span class="hs-comment">--</span><span>
</span><span id="line-1503"></span><span class="hs-comment">-- But there's a complication for pattern bindings:</span><span>
</span><span id="line-1504"></span><span class="hs-comment">--      data T = MkT (forall a. a-&gt;a)</span><span>
</span><span id="line-1505"></span><span class="hs-comment">--      MkT f = e</span><span>
</span><span id="line-1506"></span><span class="hs-comment">-- Here we can guess a type variable for the entire LHS (which will be refined to T)</span><span>
</span><span id="line-1507"></span><span class="hs-comment">-- but we want to get (f::forall a. a-&gt;a) as the RHS environment.</span><span>
</span><span id="line-1508"></span><span class="hs-comment">-- The simplest way to do this is to typecheck the pattern, and then look up the</span><span>
</span><span id="line-1509"></span><span class="hs-comment">-- bound mono-ids.  Then we want to retain the typechecked pattern to avoid re-doing</span><span>
</span><span id="line-1510"></span><span class="hs-comment">-- it; hence the TcMonoBind data type in which the LHS is done but the RHS isn't</span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span class="hs-keyword">data</span><span> </span><span id="TcMonoBind"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcMonoBind"><span class="hs-identifier hs-var">TcMonoBind</span></a></span></span><span>         </span><span class="hs-comment">-- Half completed; LHS done, RHS not done</span><span>
</span><span id="line-1513"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TcFunBind"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcFunBind"><span class="hs-identifier hs-var">TcFunBind</span></a></span></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span>  </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1514"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TcPatBind"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcPatBind"><span class="hs-identifier hs-var">TcPatBind</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsMultAnn"><span class="hs-identifier hs-type">HsMultAnn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1515"></span><span>              </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLhs"><span class="hs-identifier hs-type">tcLhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsBind"><span class="hs-identifier hs-type">HsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcMonoBind"><span class="hs-identifier hs-type">TcMonoBind</span></a></span><span>
</span><span id="line-1518"></span><span class="hs-comment">-- Only called with plan InferGen (LetBndrSpec = LetLclBndr)</span><span>
</span><span id="line-1519"></span><span class="hs-comment">--                    or NoGen    (LetBndrSpec = LetGblBndr)</span><span>
</span><span id="line-1520"></span><span class="hs-comment">-- CheckGen is used only for functions with a complete type signature,</span><span>
</span><span id="line-1521"></span><span class="hs-comment">--          and tcPolyCheck doesn't use tcMonoBinds at all</span><span>
</span><span id="line-1522"></span><span>
</span><span id="line-1523"></span><span id="tcLhs"><span class="annot"><span class="annottext">tcLhs :: TcSigFun -&gt; LetBndrSpec -&gt; HsBind GhcRn -&gt; TcM TcMonoBind
</span><a href="GHC.Tc.Gen.Bind.html#tcLhs"><span class="hs-identifier hs-var hs-var">tcLhs</span></a></span></span><span> </span><span id="local-6989586621683084008"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683084008"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683084009"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084009"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683084010"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683084010"><span class="hs-identifier hs-var">nm_loc</span></a></span></span><span> </span><span id="local-6989586621683084011"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084011"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1524"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_matches :: forall idL idR. HsBindLR idL idR -&gt; MatchGroup idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084012"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084012"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1525"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSig"><span class="hs-identifier hs-type">TcIdSig</span></a></span><span> </span><span id="local-6989586621683084014"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084014"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683084008"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084011"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1526"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- There is a type signature.</span><span>
</span><span id="line-1527"></span><span>    </span><span class="hs-comment">-- It must be partial; if complete we'd be in tcPolyCheck!</span><span>
</span><span id="line-1528"></span><span>    </span><span class="hs-comment">--    e.g.   f :: _ -&gt; _</span><span>
</span><span id="line-1529"></span><span>    </span><span class="hs-comment">--           f x = ...g...</span><span>
</span><span id="line-1530"></span><span>    </span><span class="hs-comment">--           Just g = ...f...</span><span>
</span><span id="line-1531"></span><span>    </span><span class="hs-comment">-- Hence always typechecked with InferGen</span><span>
</span><span id="line-1532"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683084015"><span class="annot"><a href="#local-6989586621683084015"><span class="hs-identifier hs-var">mono_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
-&gt; (Name, TcIdSig) -&gt; IOEnv (Env TcGblEnv TcLclEnv) MonoBindInfo
</span><a href="GHC.Tc.Gen.Bind.html#tcLhsSigId"><span class="hs-identifier hs-var">tcLhsSigId</span></a></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084009"><span class="hs-identifier hs-var">no_gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084011"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084014"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1533"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683084017"><span class="annot"><a href="#local-6989586621683084017"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-type">tcMultAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsNoMultAnn"><span class="hs-identifier hs-type">HsNoMultAnn</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1534"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcFunBind"><span class="hs-identifier hs-type">TcFunBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084015"><span class="hs-identifier hs-type">mono_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084010"><span class="hs-identifier hs-type">nm_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683084017"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084012"><span class="hs-identifier hs-type">matches</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1535"></span><span>
</span><span id="line-1536"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- No type signature</span><span>
</span><span id="line-1537"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683084018"><span class="annot"><a href="#local-6989586621683084018"><span class="hs-identifier hs-var">mono_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Kind
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span>
</span><span id="line-1538"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683084020"><span class="annot"><a href="#local-6989586621683084020"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-type">tcMultAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsNoMultAnn"><span class="hs-identifier hs-type">HsNoMultAnn</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1539"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683084021"><span class="annot"><a href="#local-6989586621683084021"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-type">newLetBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084009"><span class="hs-identifier hs-type">no_gen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084011"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084020"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084018"><span class="hs-identifier hs-type">mono_ty</span></a></span><span>
</span><span id="line-1540"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683084022"><span class="annot"><a href="#local-6989586621683084022"><span class="hs-identifier hs-var hs-var">mono_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_poly_name :: Name
</span><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084011"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1541"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_sig :: Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1542"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_id :: TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084021"><span class="hs-identifier hs-var">mono_id</span></a></span><span>
</span><span id="line-1543"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_mult :: Kind
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_mult"><span class="hs-identifier hs-var">mbi_mono_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084020"><span class="hs-identifier hs-var">mult</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1544"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcFunBind"><span class="hs-identifier hs-type">TcFunBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084022"><span class="hs-identifier hs-type">mono_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084010"><span class="hs-identifier hs-type">nm_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683084020"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084012"><span class="hs-identifier hs-type">matches</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1545"></span><span>
</span><span id="line-1546"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLhs"><span class="hs-identifier hs-var">tcLhs</span></a></span><span> </span><span id="local-6989586621683084023"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683084023"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683084024"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084024"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_lhs :: forall idL idR. HsBindLR idL idR -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084025"><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683084025"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_rhs :: forall idL idR. HsBindLR idL idR -&gt; GRHSs idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#pat_rhs"><span class="hs-identifier hs-var">pat_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084026"><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084026"><span class="hs-identifier hs-var">grhss</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_mult :: forall idL idR. HsBindLR idL idR -&gt; HsMultAnn idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_mult"><span class="hs-identifier hs-var">pat_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084027"><span class="annot"><span class="annottext">HsMultAnn GhcRn
</span><a href="#local-6989586621683084027"><span class="hs-identifier hs-var">mult_ann</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1547"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Typechecking pattern bindings]</span><span>
</span><span id="line-1548"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683084028"><span class="annot"><a href="#local-6989586621683084028"><span class="hs-identifier hs-var">sig_mbis</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, TcIdSig) -&gt; IOEnv (Env TcGblEnv TcLclEnv) MonoBindInfo)
-&gt; [(Name, TcIdSig)] -&gt; TcM [MonoBindInfo]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LetBndrSpec
-&gt; (Name, TcIdSig) -&gt; IOEnv (Env TcGblEnv TcLclEnv) MonoBindInfo
</span><a href="GHC.Tc.Gen.Bind.html#tcLhsSigId"><span class="hs-identifier hs-var">tcLhsSigId</span></a></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084024"><span class="hs-identifier hs-var">no_gen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, TcIdSig)]
</span><a href="#local-6989586621683084029"><span class="hs-identifier hs-var">sig_names</span></a></span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683084030"><span class="annot"><a href="#local-6989586621683084030"><span class="hs-identifier hs-var hs-var">inst_sig_fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv TcId -&gt; Name -&gt; Maybe TcId
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(NameEnv TcId -&gt; Name -&gt; Maybe TcId)
-&gt; NameEnv TcId -&gt; Name -&gt; Maybe TcId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, TcId)] -&gt; NameEnv TcId
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, TcId)] -&gt; NameEnv TcId) -&gt; [(Name, TcId)] -&gt; NameEnv TcId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1551"></span><span>                             </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MonoBindInfo -&gt; Name
</span><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683084031"><span class="hs-identifier hs-var">mbi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683084031"><span class="hs-identifier hs-var">mbi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1552"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683084031"><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683084031"><span class="hs-identifier hs-var">mbi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084028"><span class="hs-identifier hs-var">sig_mbis</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1553"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683084032"><span class="annot"><a href="#local-6989586621683084032"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-type">tcMultAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084027"><span class="hs-identifier hs-type">mult_ann</span></a></span><span>
</span><span id="line-1554"></span><span>            </span><span class="hs-comment">-- See Note [Typechecking pattern bindings]</span><span>
</span><span id="line-1555"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683084033"><span class="annot"><a href="#local-6989586621683084033"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683084034"><span class="annot"><a href="#local-6989586621683084034"><span class="hs-identifier hs-var">nosig_mbis</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683084035"><span class="annot"><a href="#local-6989586621683084035"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-type">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#patMonoBindsCtxt"><span class="hs-identifier hs-type">patMonoBindsCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084025"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084026"><span class="hs-identifier hs-type">grhss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1557"></span><span>               </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInferFRR"><span class="hs-identifier hs-type">tcInferFRR</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRPatBind"><span class="hs-identifier hs-type">FRRPatBind</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683084036"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683084036"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1558"></span><span>               </span><span class="annot"><span class="annottext">(Name -&gt; Maybe TcId)
-&gt; LetBndrSpec
-&gt; XRec GhcRn (Pat GhcRn)
-&gt; Scaled ExpSigmaType
-&gt; TcM [MonoBindInfo]
-&gt; TcM (LPat GhcTc, [MonoBindInfo])
forall a.
(Name -&gt; Maybe TcId)
-&gt; LetBndrSpec
-&gt; XRec GhcRn (Pat GhcRn)
-&gt; Scaled ExpSigmaType
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier hs-var">tcLetPat</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TcId
</span><a href="#local-6989586621683084030"><span class="hs-identifier hs-var">inst_sig_fun</span></a></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084024"><span class="hs-identifier hs-var">no_gen</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683084025"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; ExpSigmaType -&gt; Scaled ExpSigmaType
forall a. Kind -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084032"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683084036"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM [MonoBindInfo] -&gt; TcM (LPat GhcTc, [MonoBindInfo]))
-&gt; TcM [MonoBindInfo] -&gt; TcM (LPat GhcTc, [MonoBindInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1559"></span><span>                 </span><span class="hs-comment">-- The above inferred type get an unrestricted multiplicity. It may be</span><span>
</span><span id="line-1560"></span><span>                 </span><span class="hs-comment">-- worth it to try and find a finer-grained multiplicity here</span><span>
</span><span id="line-1561"></span><span>                 </span><span class="hs-comment">-- if examples warrant it.</span><span>
</span><span id="line-1562"></span><span>               </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) MonoBindInfo)
-&gt; [Name] -&gt; TcM [MonoBindInfo]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) MonoBindInfo
</span><a href="GHC.Tc.Gen.Bind.html#lookupMBI"><span class="hs-identifier hs-var">lookupMBI</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683084037"><span class="hs-identifier hs-var">nosig_names</span></a></span><span>
</span><span id="line-1563"></span><span>
</span><span id="line-1564"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683084038"><span class="annot"><a href="#local-6989586621683084038"><span class="hs-identifier hs-var hs-var">mbis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084028"><span class="hs-identifier hs-var">sig_mbis</span></a></span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo] -&gt; [MonoBindInfo] -&gt; [MonoBindInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084034"><span class="hs-identifier hs-var">nosig_mbis</span></a></span><span>
</span><span id="line-1565"></span><span>
</span><span id="line-1566"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcLhs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084039"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084039"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1567"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683084040"><span class="annot"><a href="#local-6989586621683084040"><span class="hs-identifier hs-var">mbi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683084038"><span class="hs-identifier hs-type">mbis</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683084039"><span class="annot"><a href="#local-6989586621683084039"><span class="hs-identifier hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683084040"><span class="hs-identifier hs-var">mbi</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1568"></span><span>                           </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084024"><span class="hs-identifier hs-type">no_gen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1569"></span><span>
</span><span id="line-1570"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcPatBind"><span class="hs-identifier hs-type">TcPatBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084038"><span class="hs-identifier hs-type">mbis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084033"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084032"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084027"><span class="hs-identifier hs-type">mult_ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084026"><span class="hs-identifier hs-type">grhss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084035"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1571"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1572"></span><span>    </span><span id="local-6989586621683084041"><span class="annot"><span class="annottext">bndr_names :: [IdP GhcRn]
</span><a href="#local-6989586621683084041"><span class="hs-identifier hs-var hs-var">bndr_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; XRec GhcRn (Pat GhcRn) -&gt; [IdP GhcRn]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683084025"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-1573"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683084037"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683084037"><span class="hs-identifier hs-var">nosig_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683084029"><span class="annot"><span class="annottext">[(Name, TcIdSig)]
</span><a href="#local-6989586621683084029"><span class="hs-identifier hs-var">sig_names</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Either Name (Name, TcIdSig))
-&gt; [Name] -&gt; ([Name], [(Name, TcIdSig)])
forall a b c. (a -&gt; Either b c) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Either Name (Name, TcIdSig)
</span><a href="#local-6989586621683084043"><span class="hs-identifier hs-var">find_sig</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683084041"><span class="hs-identifier hs-var">bndr_names</span></a></span><span>
</span><span id="line-1574"></span><span>
</span><span id="line-1575"></span><span>    </span><span class="annot"><a href="#local-6989586621683084043"><span class="hs-identifier hs-type">find_sig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSig"><span class="hs-identifier hs-type">TcIdSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span>    </span><span id="local-6989586621683084043"><span class="annot"><span class="annottext">find_sig :: Name -&gt; Either Name (Name, TcIdSig)
</span><a href="#local-6989586621683084043"><span class="hs-identifier hs-var hs-var">find_sig</span></a></span></span><span> </span><span id="local-6989586621683084044"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084044"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683084023"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084044"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1577"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSig"><span class="hs-identifier hs-type">TcIdSig</span></a></span><span> </span><span id="local-6989586621683084045"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084045"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name, TcIdSig) -&gt; Either Name (Name, TcIdSig)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084044"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084045"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>                      </span><span class="annot"><span class="annottext">Maybe TcSigInfo
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Either Name (Name, TcIdSig)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084044"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1579"></span><span>
</span><span id="line-1580"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLhs"><span class="hs-identifier hs-var">tcLhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683084046"><span class="annot"><span class="annottext">b :: HsBind GhcRn
</span><a href="#local-6989586621683084046"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatSynBind"><span class="hs-identifier hs-type">PatSynBind</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM TcMonoBind
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcLhs: PatSynBind&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBind GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBind GhcRn
</span><a href="#local-6989586621683084046"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>  </span><span class="hs-comment">-- pattern synonyms are handled separately; see tc_single</span><span>
</span><span id="line-1582"></span><span>
</span><span id="line-1583"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLhs"><span class="hs-identifier hs-var">tcLhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#VarBind"><span class="hs-identifier hs-type">VarBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">var_ext :: forall idL idR. HsBindLR idL idR -&gt; XVarBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#var_ext"><span class="hs-identifier hs-var">var_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084047"><span class="annot"><span class="annottext">XVarBind GhcRn GhcRn
</span><a href="#local-6989586621683084047"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataConCantHappen -&gt; TcM TcMonoBind
forall a. DataConCantHappen -&gt; a
</span><a href="Language.Haskell.Syntax.Extension.html#dataConCantHappen"><span class="hs-identifier hs-var">dataConCantHappen</span></a></span><span> </span><span class="annot"><span class="annottext">XVarBind GhcRn GhcRn
DataConCantHappen
</span><a href="#local-6989586621683084047"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#lookupMBI"><span class="hs-identifier hs-type">lookupMBI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span>
</span><span id="line-1586"></span><span class="hs-comment">-- After typechecking the pattern, look up the binder</span><span>
</span><span id="line-1587"></span><span class="hs-comment">-- names that lack a signature, which the pattern has brought</span><span>
</span><span id="line-1588"></span><span class="hs-comment">-- into scope.</span><span>
</span><span id="line-1589"></span><span id="lookupMBI"><span class="annot"><span class="annottext">lookupMBI :: Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) MonoBindInfo
</span><a href="GHC.Tc.Gen.Bind.html#lookupMBI"><span class="hs-identifier hs-var hs-var">lookupMBI</span></a></span></span><span> </span><span id="local-6989586621683084048"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084048"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1590"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683084049"><span class="annot"><a href="#local-6989586621683084049"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084048"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1591"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683084048"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-1592"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1593"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683084049"><span class="hs-identifier hs-type">mono_id</span></a></span><span>
</span><span id="line-1594"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_mono_mult"><span class="hs-identifier hs-var">mbi_mono_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idMult"><span class="hs-identifier hs-type">idMult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084049"><span class="hs-identifier hs-type">mono_id</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1597"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLhsSigId"><span class="hs-identifier hs-type">tcLhsSigId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSig"><span class="hs-identifier hs-type">TcIdSig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span>
</span><span id="line-1598"></span><span id="tcLhsSigId"><span class="annot"><span class="annottext">tcLhsSigId :: LetBndrSpec
-&gt; (Name, TcIdSig) -&gt; IOEnv (Env TcGblEnv TcLclEnv) MonoBindInfo
</span><a href="GHC.Tc.Gen.Bind.html#tcLhsSigId"><span class="hs-identifier hs-var hs-var">tcLhsSigId</span></a></span></span><span> </span><span id="local-6989586621683084051"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084051"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683084052"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084052"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683084053"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084053"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1599"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683084054"><span class="annot"><a href="#local-6989586621683084054"><span class="hs-identifier hs-var">inst_sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSig -&gt; TcM TcIdSigInst
</span><a href="GHC.Tc.Gen.Sig.html#tcInstSig"><span class="hs-identifier hs-var">tcInstSig</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084053"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1600"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683084056"><span class="annot"><a href="#local-6989586621683084056"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#newSigLetBndr"><span class="hs-identifier hs-type">newSigLetBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084051"><span class="hs-identifier hs-type">no_gen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084052"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084054"><span class="hs-identifier hs-type">inst_sig</span></a></span><span>
</span><span id="line-1601"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_poly_name"><span class="hs-identifier hs-var">mbi_poly_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683084052"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-1602"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683084054"><span class="hs-identifier hs-type">inst_sig</span></a></span><span>
</span><span id="line-1603"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683084056"><span class="hs-identifier hs-type">mono_id</span></a></span><span>
</span><span id="line-1604"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#mbi_mono_mult"><span class="hs-identifier hs-var">mbi_mono_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idMult"><span class="hs-identifier hs-type">idMult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084056"><span class="hs-identifier hs-type">mono_id</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1605"></span><span>
</span><span id="line-1606"></span><span class="hs-comment">------------</span><span>
</span><span id="line-1607"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#newSigLetBndr"><span class="hs-identifier hs-type">newSigLetBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-1608"></span><span id="newSigLetBndr"><span class="annot"><span class="annottext">newSigLetBndr :: LetBndrSpec
-&gt; Name -&gt; TcIdSigInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
</span><a href="GHC.Tc.Gen.Bind.html#newSigLetBndr"><span class="hs-identifier hs-var hs-var">newSigLetBndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-type">LetGblBndr</span></a></span><span> </span><span id="local-6989586621683084058"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683084058"><span class="hs-identifier hs-var">prags</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683084059"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084059"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TISI"><span class="hs-identifier hs-type">TISI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_inst_sig :: TcIdSigInst -&gt; TcIdSig
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_sig"><span class="hs-identifier hs-var">sig_inst_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084060"><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084060"><span class="hs-identifier hs-var">id_sig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1609"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcCompleteSig"><span class="hs-identifier hs-type">TcCompleteSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#CSig"><span class="hs-identifier hs-type">CSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndr :: TcCompleteSig -&gt; TcId
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_bndr"><span class="hs-identifier hs-var">sig_bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084061"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084061"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683084060"><span class="hs-identifier hs-var">id_sig</span></a></span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; [LSig GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
</span><a href="GHC.Tc.Gen.Sig.html#addInlinePrags"><span class="hs-identifier hs-var">addInlinePrags</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084061"><span class="hs-identifier hs-var">poly_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPragEnv -&gt; Name -&gt; [LSig GhcRn]
</span><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621683084058"><span class="hs-identifier hs-var">prags</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084059"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1611"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#newSigLetBndr"><span class="hs-identifier hs-var">newSigLetBndr</span></a></span><span> </span><span id="local-6989586621683084062"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084062"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span id="local-6989586621683084063"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084063"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TISI"><span class="hs-identifier hs-type">TISI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_inst_tau :: TcIdSigInst -&gt; Kind
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_tau"><span class="hs-identifier hs-var">sig_inst_tau</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084065"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084065"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1612"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
-&gt; Name -&gt; Kind -&gt; Kind -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcId
</span><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-var">newLetBndr</span></a></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621683084062"><span class="hs-identifier hs-var">no_gen</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084063"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084065"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-1613"></span><span>    </span><span class="hs-comment">-- Binders with a signature are currently always of multiplicity</span><span>
</span><span id="line-1614"></span><span>    </span><span class="hs-comment">-- Many. Because they come either from toplevel, let, or where</span><span>
</span><span id="line-1615"></span><span>    </span><span class="hs-comment">-- declarations. Which are all unrestricted currently.</span><span>
</span><span id="line-1616"></span><span>
</span><span id="line-1617"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1618"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcRhs"><span class="hs-identifier hs-type">tcRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcMonoBind"><span class="hs-identifier hs-type">TcMonoBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsBind"><span class="hs-identifier hs-type">HsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1619"></span><span id="tcRhs"><span class="annot"><span class="annottext">tcRhs :: TcMonoBind -&gt; TcM (HsBindLR GhcTc GhcTc)
</span><a href="GHC.Tc.Gen.Bind.html#tcRhs"><span class="hs-identifier hs-var hs-var">tcRhs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcFunBind"><span class="hs-identifier hs-type">TcFunBind</span></a></span><span> </span><span id="local-6989586621683084066"><span class="annot"><span class="annottext">info :: MonoBindInfo
</span><a href="#local-6989586621683084066"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_sig :: MonoBindInfo -&gt; Maybe TcIdSigInst
</span><a href="GHC.Tc.Gen.Bind.html#mbi_sig"><span class="hs-identifier hs-var">mbi_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084067"><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683084067"><span class="hs-identifier hs-var">mb_sig</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mbi_mono_id :: MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084068"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084068"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1620"></span><span>                 </span><span id="local-6989586621683084069"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683084069"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683084070"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084070"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683084071"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084071"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1621"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
-&gt; TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc)
forall a. [MonoBindInfo] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#tcExtendIdBinderStackForRhs"><span class="hs-identifier hs-var">tcExtendIdBinderStackForRhs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683084066"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="annottext">(TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc))
-&gt; TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1622"></span><span>    </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
-&gt; TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc)
forall a. Maybe TcIdSigInst -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#tcExtendTyVarEnvForRhs"><span class="hs-identifier hs-var">tcExtendTyVarEnvForRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><a href="#local-6989586621683084067"><span class="hs-identifier hs-var">mb_sig</span></a></span><span>       </span><span class="annot"><span class="annottext">(TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc))
-&gt; TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1623"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683084074"><span class="annot"><span class="annottext">mono_ty :: Kind
</span><a href="#local-6989586621683084074"><span class="hs-identifier hs-var hs-var hs-var">mono_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084068"><span class="hs-identifier hs-var">mono_id</span></a></span><span>
</span><span id="line-1624"></span><span>              </span><span id="local-6989586621683084075"><span class="annot"><span class="annottext">mono_name :: Name
</span><a href="#local-6989586621683084075"><span class="hs-identifier hs-var hs-var hs-var">mono_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084068"><span class="hs-identifier hs-var">mono_id</span></a></span><span>
</span><span id="line-1625"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRhs: fun bind&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084068"><span class="hs-identifier hs-var">mono_id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084074"><span class="hs-identifier hs-var">mono_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1626"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683084076"><span class="annot"><a href="#local-6989586621683084076"><span class="hs-identifier hs-var">co_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683084077"><span class="annot"><a href="#local-6989586621683084077"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; Name
-&gt; Kind
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; [ExpPatType]
-&gt; ExpSigmaType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcFunBindMatches"><span class="hs-identifier hs-var">tcFunBindMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#InfSigCtxt"><span class="hs-identifier hs-var">InfSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084075"><span class="hs-identifier hs-var">mono_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084075"><span class="hs-identifier hs-var">mono_name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084070"><span class="hs-identifier hs-var">mult</span></a></span><span>
</span><span id="line-1627"></span><span>                                                </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084071"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084074"><span class="hs-identifier hs-var">mono_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1628"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-type">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084069"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683084068"><span class="hs-identifier hs-type">mono_id</span></a></span><span>
</span><span id="line-1629"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683084077"><span class="hs-identifier hs-type">matches'</span></a></span><span>
</span><span id="line-1630"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#fun_ext"><span class="hs-identifier hs-var">fun_ext</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683084076"><span class="hs-identifier hs-type">co_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span>                           </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcRhs"><span class="hs-identifier hs-var">tcRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcPatBind"><span class="hs-identifier hs-type">TcPatBind</span></a></span><span> </span><span id="local-6989586621683084078"><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084078"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span id="local-6989586621683084079"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683084079"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span id="local-6989586621683084080"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084080"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683084081"><span class="annot"><span class="annottext">HsMultAnn GhcRn
</span><a href="#local-6989586621683084081"><span class="hs-identifier hs-var">mult_ann</span></a></span></span><span> </span><span id="local-6989586621683084082"><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084082"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span id="local-6989586621683084083"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084083"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- When we are doing pattern bindings we *don't* bring any scoped</span><span>
</span><span id="line-1635"></span><span>    </span><span class="hs-comment">-- type variables into scope unlike function bindings</span><span>
</span><span id="line-1636"></span><span>    </span><span class="hs-comment">-- Wny not?  They are not completely rigid.</span><span>
</span><span id="line-1637"></span><span>    </span><span class="hs-comment">-- That's why we have the special case for a single FunBind in tcMonoBinds</span><span>
</span><span id="line-1638"></span><span>    </span><span class="annot"><span class="annottext">[MonoBindInfo]
-&gt; TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc)
forall a. [MonoBindInfo] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#tcExtendIdBinderStackForRhs"><span class="hs-identifier hs-var">tcExtendIdBinderStackForRhs</span></a></span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084078"><span class="hs-identifier hs-var">infos</span></a></span><span>        </span><span class="annot"><span class="annottext">(TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc))
-&gt; TcM (HsBindLR GhcTc GhcTc) -&gt; TcM (HsBindLR GhcTc GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1639"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRhs: pat bind&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683084079"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084083"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683084084"><span class="annot"><a href="#local-6989586621683084084"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcTc -&gt; GRHSs GhcRn (LHsExpr GhcRn) -&gt; SDoc
forall (p :: Pass).
OutputableBndrId p =&gt;
LPat (GhcPass p) -&gt; GRHSs GhcRn (LHsExpr GhcRn) -&gt; SDoc
</span><a href="GHC.Tc.Gen.Bind.html#patMonoBindsCtxt"><span class="hs-identifier hs-var">patMonoBindsCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683084079"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084082"><span class="hs-identifier hs-var">grhss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (GRHSs GhcTc (LHsExpr GhcTc))
 -&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc)))
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1641"></span><span>                    </span><span class="annot"><span class="annottext">Kind
-&gt; GRHSs GhcRn (LHsExpr GhcRn)
-&gt; ExpSigmaType
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSsPat"><span class="hs-identifier hs-var">tcGRHSsPat</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084080"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084082"><span class="hs-identifier hs-var">grhss</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683084083"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683084079"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_rhs"><span class="hs-identifier hs-var">pat_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683084084"><span class="hs-identifier hs-type">grhss'</span></a></span><span>
</span><span id="line-1644"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_ext"><span class="hs-identifier hs-var">pat_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683084083"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#pat_mult"><span class="hs-identifier hs-var">pat_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#setTcMultAnn"><span class="hs-identifier hs-type">setTcMultAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084080"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683084081"><span class="hs-identifier hs-type">mult_ann</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>
</span><span id="line-1648"></span><span class="hs-comment">-- | @'tcMultAnn' ann@ takes an optional multiplicity annotation. If</span><span>
</span><span id="line-1649"></span><span class="hs-comment">-- present the multiplicity is returned, otherwise a fresh unification variable</span><span>
</span><span id="line-1650"></span><span class="hs-comment">-- is generated so that multiplicity can be inferred.</span><span>
</span><span id="line-1651"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-type">tcMultAnn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsMultAnn"><span class="hs-identifier hs-type">HsMultAnn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>
</span><span id="line-1652"></span><span id="tcMultAnn"><span class="annot"><span class="annottext">tcMultAnn :: HsMultAnn GhcRn -&gt; TcM Kind
</span><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-var hs-var">tcMultAnn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsPct1Ann"><span class="hs-identifier hs-type">HsPct1Ann</span></a></span><span> </span><span class="annot"><span class="annottext">XPct1Ann GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; TcM Kind
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#oneDataConTy"><span class="hs-identifier hs-var">oneDataConTy</span></a></span><span>
</span><span id="line-1653"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-var">tcMultAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsMultAnn"><span class="hs-identifier hs-type">HsMultAnn</span></a></span><span> </span><span class="annot"><span class="annottext">XMultAnn GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683084087"><span class="annot"><span class="annottext">LHsType (NoGhcTc GhcRn)
</span><a href="#local-6989586621683084087"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; ContextKind -&gt; TcM Kind
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsTypeInContext"><span class="hs-identifier hs-var">tcCheckLHsTypeInContext</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (NoGhcTc GhcRn)
LHsType GhcRn
</span><a href="#local-6989586621683084087"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcMultAnn"><span class="hs-identifier hs-var">tcMultAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsNoMultAnn"><span class="hs-identifier hs-type">HsNoMultAnn</span></a></span><span> </span><span class="annot"><span class="annottext">XNoMultAnn GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; TcM Kind
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-1655"></span><span>
</span><span id="line-1656"></span><span id="local-6989586621683082682"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcExtendTyVarEnvForRhs"><span class="hs-identifier hs-type">tcExtendTyVarEnvForRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082682"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082682"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1657"></span><span id="tcExtendTyVarEnvForRhs"><span class="annot"><span class="annottext">tcExtendTyVarEnvForRhs :: forall a. Maybe TcIdSigInst -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#tcExtendTyVarEnvForRhs"><span class="hs-identifier hs-var hs-var">tcExtendTyVarEnvForRhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe TcIdSigInst
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621683084090"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084090"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1658"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084090"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1659"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcExtendTyVarEnvForRhs"><span class="hs-identifier hs-var">tcExtendTyVarEnvForRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683084091"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683084091"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683084092"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084092"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1660"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst -&gt; TcM a -&gt; TcM a
forall a. TcIdSigInst -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#tcExtendTyVarEnvFromSig"><span class="hs-identifier hs-var">tcExtendTyVarEnvFromSig</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683084091"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084092"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1661"></span><span>
</span><span id="line-1662"></span><span id="local-6989586621683082689"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcExtendTyVarEnvFromSig"><span class="hs-identifier hs-type">tcExtendTyVarEnvFromSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082689"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082689"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1663"></span><span id="tcExtendTyVarEnvFromSig"><span class="annot"><span class="annottext">tcExtendTyVarEnvFromSig :: forall a. TcIdSigInst -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#tcExtendTyVarEnvFromSig"><span class="hs-identifier hs-var hs-var">tcExtendTyVarEnvFromSig</span></a></span></span><span> </span><span id="local-6989586621683084096"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683084096"><span class="hs-identifier hs-var">sig_inst</span></a></span></span><span> </span><span id="local-6989586621683084097"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084097"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1664"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TISI"><span class="hs-identifier hs-type">TISI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_inst_skols :: TcIdSigInst -&gt; [(Name, VarBndr TcId Specificity)]
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_skols"><span class="hs-identifier hs-var">sig_inst_skols</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084098"><span class="annot"><span class="annottext">[(Name, VarBndr TcId Specificity)]
</span><a href="#local-6989586621683084098"><span class="hs-identifier hs-var">skol_prs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_inst_wcs :: TcIdSigInst -&gt; [(Name, TcId)]
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_wcs"><span class="hs-identifier hs-var">sig_inst_wcs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084100"><span class="annot"><span class="annottext">[(Name, TcId)]
</span><a href="#local-6989586621683084100"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683084096"><span class="hs-identifier hs-var">sig_inst</span></a></span><span>
</span><span id="line-1665"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, TcId)] -&gt; TcM a -&gt; TcM a
forall a. [(Name, TcId)] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcId)]
</span><a href="#local-6989586621683084100"><span class="hs-identifier hs-var">wcs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1666"></span><span>    </span><span class="annot"><span class="annottext">[(Name, TcId)] -&gt; TcM a -&gt; TcM a
forall a. [(Name, TcId)] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VarBndr TcId Specificity -&gt; TcId)
-&gt; [(Name, VarBndr TcId Specificity)] -&gt; [(Name, TcId)]
forall (f :: * -&gt; *) b c a.
Functor f =&gt;
(b -&gt; c) -&gt; f (a, b) -&gt; f (a, c)
</span><a href="GHC.Utils.Misc.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr TcId Specificity -&gt; TcId
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, VarBndr TcId Specificity)]
</span><a href="#local-6989586621683084098"><span class="hs-identifier hs-var">skol_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1667"></span><span>    </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084097"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1668"></span><span>
</span><span id="line-1669"></span><span id="local-6989586621683082681"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcExtendIdBinderStackForRhs"><span class="hs-identifier hs-type">tcExtendIdBinderStackForRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082681"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082681"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1670"></span><span class="hs-comment">-- See Note [Relevant bindings and the binder stack]</span><span>
</span><span id="line-1671"></span><span id="tcExtendIdBinderStackForRhs"><span class="annot"><span class="annottext">tcExtendIdBinderStackForRhs :: forall a. [MonoBindInfo] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Bind.html#tcExtendIdBinderStackForRhs"><span class="hs-identifier hs-var hs-var">tcExtendIdBinderStackForRhs</span></a></span></span><span> </span><span id="local-6989586621683084103"><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084103"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span id="local-6989586621683084104"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084104"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1672"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcBinder] -&gt; TcM a -&gt; TcM a
forall a. [TcBinder] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendBinderStack"><span class="hs-identifier hs-var">tcExtendBinderStack</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TcId -&gt; TopLevelFlag -&gt; TcBinder
</span><a href="GHC.Tc.Types.BasicTypes.html#TcIdBndr"><span class="hs-identifier hs-var">TcIdBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084105"><span class="hs-identifier hs-var">mono_id</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span>
</span><span id="line-1673"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MBI"><span class="hs-identifier hs-type">MBI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mbi_mono_id :: MonoBindInfo -&gt; TcId
</span><a href="GHC.Tc.Gen.Bind.html#mbi_mono_id"><span class="hs-identifier hs-var">mbi_mono_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084105"><span class="annot"><span class="annottext">TcId
</span><a href="#local-6989586621683084105"><span class="hs-identifier hs-var">mono_id</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084103"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1674"></span><span>                        </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683084104"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1675"></span><span>    </span><span class="hs-comment">-- NotTopLevel: it's a monomorphic binding</span><span>
</span><span id="line-1676"></span><span>
</span><span id="line-1677"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-1678"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#getMonoBindInfo"><span class="hs-identifier hs-type">getMonoBindInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcMonoBind"><span class="hs-identifier hs-type">TcMonoBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1679"></span><span id="getMonoBindInfo"><span class="annot"><span class="annottext">getMonoBindInfo :: [GenLocated SrcSpanAnnA TcMonoBind] -&gt; [MonoBindInfo]
</span><a href="GHC.Tc.Gen.Bind.html#getMonoBindInfo"><span class="hs-identifier hs-var hs-var">getMonoBindInfo</span></a></span></span><span> </span><span id="local-6989586621683084106"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA TcMonoBind]
</span><a href="#local-6989586621683084106"><span class="hs-identifier hs-var">tc_binds</span></a></span></span><span>
</span><span id="line-1680"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA TcMonoBind
 -&gt; [MonoBindInfo] -&gt; [MonoBindInfo])
-&gt; [MonoBindInfo]
-&gt; [GenLocated SrcSpanAnnA TcMonoBind]
-&gt; [MonoBindInfo]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcMonoBind -&gt; [MonoBindInfo] -&gt; [MonoBindInfo]
</span><a href="#local-6989586621683084107"><span class="hs-identifier hs-var">get_info</span></a></span><span> </span><span class="annot"><span class="annottext">(TcMonoBind -&gt; [MonoBindInfo] -&gt; [MonoBindInfo])
-&gt; (GenLocated SrcSpanAnnA TcMonoBind -&gt; TcMonoBind)
-&gt; GenLocated SrcSpanAnnA TcMonoBind
-&gt; [MonoBindInfo]
-&gt; [MonoBindInfo]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA TcMonoBind -&gt; TcMonoBind
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA TcMonoBind]
</span><a href="#local-6989586621683084106"><span class="hs-identifier hs-var">tc_binds</span></a></span><span>
</span><span id="line-1681"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1682"></span><span>    </span><span id="local-6989586621683084107"><span class="annot"><span class="annottext">get_info :: TcMonoBind -&gt; [MonoBindInfo] -&gt; [MonoBindInfo]
</span><a href="#local-6989586621683084107"><span class="hs-identifier hs-var hs-var">get_info</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcFunBind"><span class="hs-identifier hs-type">TcFunBind</span></a></span><span> </span><span id="local-6989586621683084108"><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683084108"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621683084109"><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084109"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MonoBindInfo
</span><a href="#local-6989586621683084108"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">MonoBindInfo -&gt; [MonoBindInfo] -&gt; [MonoBindInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084109"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1683"></span><span>    </span><span class="annot"><a href="#local-6989586621683084107"><span class="hs-identifier hs-var">get_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#TcPatBind"><span class="hs-identifier hs-type">TcPatBind</span></a></span><span> </span><span id="local-6989586621683084110"><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084110"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsMultAnn GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683084111"><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084111"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084110"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo] -&gt; [MonoBindInfo] -&gt; [MonoBindInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[MonoBindInfo]
</span><a href="#local-6989586621683084111"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1684"></span><span>
</span><span id="line-1685"></span><span>
</span><span id="line-1686"></span><span class="hs-comment">{- Note [Relevant bindings and the binder stack]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When typecking a binding we extend the TcBinderStack for the RHS of
the binding, with the /monomorphic/ Id.  That way, if we have, say
    f = \x -&gt; blah
and something goes wrong in 'blah', we get a &quot;relevant binding&quot;
looking like  f :: alpha -&gt; beta
This applies if 'f' has a type signature too:
   f :: forall a. [a] -&gt; [a]
   f x = True
We can't unify True with [a], and a relevant binding is f :: [a] -&gt; [a]
If we had the *polymorphic* version of f in the TcBinderStack, it
would not be reported as relevant, because its type is closed.
(See TcErrors.relevantBindings.)

Note [Typechecking pattern bindings]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Look at:
   - typecheck/should_compile/ExPat
   - #12427, typecheck/should_compile/T12427{a,b}

  data T where
    MkT :: Integral a =&gt; a -&gt; Int -&gt; T

and suppose t :: T.  Which of these pattern bindings are ok?

  E1. let { MkT p _ = t } in &lt;body&gt;

  E2. let { MkT _ q = t } in &lt;body&gt;

  E3. let { MkT (toInteger -&gt; r) _ = t } in &lt;body&gt;

* (E1) is clearly wrong because the existential 'a' escapes.
  What type could 'p' possibly have?

* (E2) is fine, despite the existential pattern, because
  q::Int, and nothing escapes.

* Even (E3) is fine.  The existential pattern bindings a dictionary
  for (Integral a) which the view pattern can use to convert the
  a-valued field to an Integer, so r :: Integer.

An easy way to see all three is to imagine the desugaring.
For (E2) it would look like
    let q = case t of MkT _ q' -&gt; q'
    in &lt;body&gt;


We typecheck pattern bindings as follows.  First tcLhs does this:

  1. Take each type signature q :: ty, partial or complete, and
     instantiate it (with tcLhsSigId) to get a MonoBindInfo.  This
     gives us a fresh &quot;mono_id&quot; qm :: instantiate(ty), where qm has
     a fresh name.

     Any fresh unification variables in instantiate(ty) born here, not
     deep under implications as would happen if we allocated them when
     we encountered q during tcPat.

  2. Build a little environment mapping &quot;q&quot; -&gt; &quot;qm&quot; for those Ids
     with signatures (inst_sig_fun)

  3. Invoke tcLetPat to typecheck the pattern.

     - We pass in the current TcLevel.  This is captured by
       GHC.Tc.Gen.Pat.tcLetPat, and put into the pc_lvl field of PatCtxt, in
       PatEnv.

     - When tcPat finds an existential constructor, it binds fresh
       type variables and dictionaries as usual, increments the TcLevel,
       and emits an implication constraint.

     - When we come to a binder (GHC.Tc.Gen.Pat.tcPatBndr), it looks it up
       in the little environment (the pc_sig_fn field of PatCtxt).

         Success =&gt; There was a type signature, so just use it,
                    checking compatibility with the expected type.

         Failure =&gt; No type signature.
             Infer case: (happens only outside any constructor pattern)
                         use a unification variable
                         at the outer level pc_lvl

             Check case: use promoteTcType to promote the type
                         to the outer level pc_lvl.  This is the
                         place where we emit a constraint that'll blow
                         up if existential capture takes place

       Result: the type of the binder is always at pc_lvl. This is
       crucial.

  4. Throughout, when we are making up an Id for the pattern-bound variables
     (newLetBndr), we have two cases:

     - If we are generalising (generalisation plan is InferGen or
       CheckGen), then the let_bndr_spec will be LetLclBndr.  In that case
       we want to bind a cloned, local version of the variable, with the
       type given by the pattern context, *not* by the signature (even if
       there is one; see #7268). The mkExport part of the
       generalisation step will do the checking and impedance matching
       against the signature.

     - If for some reason we are not generalising (plan = NoGen), the
       LetBndrSpec will be LetGblBndr.  In that case we must bind the
       global version of the Id, and do so with precisely the type given
       in the signature.  (Then we unify with the type from the pattern
       context type.)


And that's it!  The implication constraints check for the skolem
escape.  It's quite simple and neat, and more expressive than before
e.g. GHC 8.0 rejects (E2) and (E3).

Example for (E1), starting at level 1.  We generate
     p :: beta:1, with constraints (forall:3 a. Integral a =&gt; a ~ beta)
The (a~beta) can't float (because of the 'a'), nor be solved (because
beta is untouchable.)

Example for (E2), we generate
     q :: beta:1, with constraint (forall:3 a. Integral a =&gt; Int ~ beta)
The beta is untouchable, but floats out of the constraint and can
be solved absolutely fine.


************************************************************************
*                                                                      *
                Generalisation
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1815"></span><span>
</span><span id="line-1816"></span><span class="hs-keyword">data</span><span> </span><span id="GeneralisationPlan"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#GeneralisationPlan"><span class="hs-identifier hs-var">GeneralisationPlan</span></a></span></span><span>
</span><span id="line-1817"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoGen"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a></span></span><span>               </span><span class="hs-comment">-- No generalisation, no AbsBinds</span><span>
</span><span id="line-1818"></span><span>
</span><span id="line-1819"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="InferGen"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a></span></span><span>            </span><span class="hs-comment">-- Implicit generalisation; there is an AbsBinds</span><span>
</span><span id="line-1820"></span><span>
</span><span id="line-1821"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CheckGen"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#CheckGen"><span class="hs-identifier hs-var">CheckGen</span></a></span></span><span>            </span><span class="hs-comment">-- One FunBind with a complete signature:</span><span>
</span><span id="line-1822"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">--   do explicit generalisation</span><span>
</span><span id="line-1823"></span><span>       </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcCompleteSig"><span class="hs-identifier hs-type">TcCompleteSig</span></a></span><span>
</span><span id="line-1824"></span><span>
</span><span id="line-1825"></span><span class="hs-comment">-- A consequence of the no-AbsBinds choice (NoGen) is that there is</span><span>
</span><span id="line-1826"></span><span class="hs-comment">-- no &quot;polymorphic Id&quot; and &quot;monmomorphic Id&quot;; there is just the one</span><span>
</span><span id="line-1827"></span><span>
</span><span id="line-1828"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#GeneralisationPlan"><span class="hs-identifier hs-type">GeneralisationPlan</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1829"></span><span>  </span><span id="local-6989586621683084119"><span class="annot"><span class="annottext">ppr :: GeneralisationPlan -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NoGen&quot;</span></span><span>
</span><span id="line-1830"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InferGen&quot;</span></span><span>
</span><span id="line-1831"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#CheckGen"><span class="hs-identifier hs-type">CheckGen</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683084120"><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683084120"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CheckGen&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcCompleteSig -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683084120"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1832"></span><span>
</span><span id="line-1833"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#decideGeneralisationPlan"><span class="hs-identifier hs-type">decideGeneralisationPlan</span></a></span><span>
</span><span id="line-1834"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#IsGroupClosed"><span class="hs-identifier hs-type">IsGroupClosed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a></span><span>
</span><span id="line-1835"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#GeneralisationPlan"><span class="hs-identifier hs-type">GeneralisationPlan</span></a></span><span>
</span><span id="line-1836"></span><span id="decideGeneralisationPlan"><span class="annot"><span class="annottext">decideGeneralisationPlan :: DynFlags
-&gt; TopLevelFlag
-&gt; IsGroupClosed
-&gt; TcSigFun
-&gt; LHsBinds GhcRn
-&gt; GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#decideGeneralisationPlan"><span class="hs-identifier hs-var hs-var">decideGeneralisationPlan</span></a></span></span><span> </span><span id="local-6989586621683084121"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683084121"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683084122"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683084122"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683084123"><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683084123"><span class="hs-identifier hs-var">closed</span></a></span></span><span> </span><span id="local-6989586621683084124"><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683084124"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621683084125"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683084125"><span class="hs-identifier hs-var">lbinds</span></a></span></span><span>
</span><span id="line-1837"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683084126"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683084126"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683084127"><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683084127"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn), TcCompleteSig)
</span><a href="#local-6989586621683084128"><span class="hs-identifier hs-var">one_funbind_with_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn -&gt; TcCompleteSig -&gt; GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#CheckGen"><span class="hs-identifier hs-var">CheckGen</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683084126"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683084127"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1838"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683084129"><span class="hs-identifier hs-var">generalise_binds</span></a></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a></span><span>
</span><span id="line-1839"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralisationPlan
</span><a href="GHC.Tc.Gen.Bind.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a></span><span>
</span><span id="line-1840"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1841"></span><span>    </span><span id="local-6989586621683084129"><span class="annot"><span class="annottext">generalise_binds :: Bool
</span><a href="#local-6989586621683084129"><span class="hs-identifier hs-var hs-var">generalise_binds</span></a></span></span><span>
</span><span id="line-1842"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683084122"><span class="hs-identifier hs-var">top_lvl</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1843"></span><span>        </span><span class="hs-comment">-- See Note [Always generalise top-level bindings]</span><span>
</span><span id="line-1844"></span><span>
</span><span id="line-1845"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683084131"><span class="hs-identifier hs-var">has_mult_anns_and_pats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1846"></span><span>        </span><span class="hs-comment">-- See Note [Non-variable pattern bindings aren't linear]</span><span>
</span><span id="line-1847"></span><span>
</span><span id="line-1848"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#IsGroupClosed"><span class="hs-identifier hs-type">IsGroupClosed</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv NameSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IsGroupClosed
</span><a href="#local-6989586621683084123"><span class="hs-identifier hs-var">closed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1849"></span><span>        </span><span class="hs-comment">-- The 'True' means that all of the group's</span><span>
</span><span id="line-1850"></span><span>        </span><span class="hs-comment">-- free vars have ClosedTypeId=True; so we can ignore</span><span>
</span><span id="line-1851"></span><span>        </span><span class="hs-comment">-- -XMonoLocalBinds, and generalise anyway</span><span>
</span><span id="line-1852"></span><span>
</span><span id="line-1853"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683084133"><span class="hs-identifier hs-var">has_partial_sigs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1854"></span><span>        </span><span class="hs-comment">-- See Note [Partial type signatures and generalisation]</span><span>
</span><span id="line-1855"></span><span>
</span><span id="line-1856"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.MonoLocalBinds</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683084121"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1857"></span><span>
</span><span id="line-1858"></span><span>    </span><span class="hs-comment">-- With OutsideIn, all nested bindings are monomorphic</span><span>
</span><span id="line-1859"></span><span>    </span><span class="hs-comment">-- except a single function binding with a complete signature</span><span>
</span><span id="line-1860"></span><span>    </span><span id="local-6989586621683084128"><span class="annot"><span class="annottext">one_funbind_with_sig :: Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn), TcCompleteSig)
</span><a href="#local-6989586621683084128"><span class="hs-identifier hs-var hs-var">one_funbind_with_sig</span></a></span></span><span>
</span><span id="line-1861"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683084136"><span class="annot"><span class="annottext">lbind :: LHsBindLR GhcRn GhcRn
</span><a href="#local-6989586621683084136"><span class="hs-identifier hs-var">lbind</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084137"><span class="annot"><span class="annottext">LIdP GhcRn
</span><a href="#local-6989586621683084137"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683084125"><span class="hs-identifier hs-var">lbinds</span></a></span><span>
</span><span id="line-1862"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSig"><span class="hs-identifier hs-type">TcIdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcCompleteSig"><span class="hs-identifier hs-type">TcCompleteSig</span></a></span><span> </span><span id="local-6989586621683084138"><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683084138"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683084124"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621683084137"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1863"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBind GhcRn), TcCompleteSig)
-&gt; Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn), TcCompleteSig)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsBindLR GhcRn GhcRn
GenLocated SrcSpanAnnA (HsBind GhcRn)
</span><a href="#local-6989586621683084136"><span class="hs-identifier hs-var">lbind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683084138"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1864"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1865"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsBind GhcRn), TcCompleteSig)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1866"></span><span>
</span><span id="line-1867"></span><span>    </span><span id="local-6989586621683084139"><span class="annot"><span class="annottext">binders :: [IdP GhcRn]
</span><a href="#local-6989586621683084139"><span class="hs-identifier hs-var hs-var">binders</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; LHsBinds GhcRn -&gt; [IdP GhcRn]
forall p idR.
CollectPass p =&gt;
CollectFlag p -&gt; [LHsBindLR p idR] -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectHsBindListBinders"><span class="hs-identifier hs-var">collectHsBindListBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683084125"><span class="hs-identifier hs-var">lbinds</span></a></span><span>
</span><span id="line-1868"></span><span>    </span><span id="local-6989586621683084133"><span class="annot"><span class="annottext">has_partial_sigs :: Bool
</span><a href="#local-6989586621683084133"><span class="hs-identifier hs-var hs-var">has_partial_sigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683084140"><span class="hs-identifier hs-var">has_partial_sig</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683084139"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-1869"></span><span>    </span><span id="local-6989586621683084140"><span class="annot"><span class="annottext">has_partial_sig :: Name -&gt; Bool
</span><a href="#local-6989586621683084140"><span class="hs-identifier hs-var hs-var">has_partial_sig</span></a></span></span><span> </span><span id="local-6989586621683084141"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084141"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcSigFun
</span><a href="#local-6989586621683084124"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084141"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1870"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSig"><span class="hs-identifier hs-type">TcIdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcPartialSig"><span class="hs-identifier hs-type">TcPartialSig</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1871"></span><span>      </span><span class="annot"><span class="annottext">Maybe TcSigInfo
</span><span class="hs-identifier">_</span></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1872"></span><span>    </span><span id="local-6989586621683084131"><span class="annot"><span class="annottext">has_mult_anns_and_pats :: Bool
</span><a href="#local-6989586621683084131"><span class="hs-identifier hs-var hs-var">has_mult_anns_and_pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; Bool
forall {idL} {l} {l} {idR}.
(XRec idL (Pat idL) ~ GenLocated l (Pat idL)) =&gt;
GenLocated l (HsBindLR idL idR) -&gt; Bool
</span><a href="#local-6989586621683084142"><span class="hs-identifier hs-var">has_mult_ann_and_pat</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683084125"><span class="hs-identifier hs-var">lbinds</span></a></span><span>
</span><span id="line-1873"></span><span>    </span><span id="local-6989586621683084142"><span class="annot"><span class="annottext">has_mult_ann_and_pat :: GenLocated l (HsBindLR idL idR) -&gt; Bool
</span><a href="#local-6989586621683084142"><span class="hs-identifier hs-var hs-var">has_mult_ann_and_pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">pat_mult :: forall idL idR. HsBindLR idL idR -&gt; HsMultAnn idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_mult"><span class="hs-identifier hs-var">pat_mult</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsNoMultAnn"><span class="hs-identifier hs-type">HsNoMultAnn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1874"></span><span>    </span><span class="annot"><a href="#local-6989586621683084142"><span class="hs-identifier hs-var">has_mult_ann_and_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">pat_lhs :: forall idL idR. HsBindLR idL idR -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1875"></span><span>    </span><span class="annot"><a href="#local-6989586621683084142"><span class="hs-identifier hs-var">has_mult_ann_and_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1876"></span><span>    </span><span class="annot"><a href="#local-6989586621683084142"><span class="hs-identifier hs-var">has_mult_ann_and_pat</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsBindLR idL idR)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1877"></span><span>
</span><span id="line-1878"></span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#isClosedBndrGroup"><span class="hs-identifier hs-type">isClosedBndrGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#IsGroupClosed"><span class="hs-identifier hs-type">IsGroupClosed</span></a></span><span>
</span><span id="line-1879"></span><span id="isClosedBndrGroup"><span class="annot"><span class="annottext">isClosedBndrGroup :: TcTypeEnv -&gt; LHsBinds GhcRn -&gt; IsGroupClosed
</span><a href="GHC.Tc.Gen.Bind.html#isClosedBndrGroup"><span class="hs-identifier hs-var hs-var">isClosedBndrGroup</span></a></span></span><span> </span><span id="local-6989586621683084145"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621683084145"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621683084146"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621683084146"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-1880"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv NameSet -&gt; Bool -&gt; IsGroupClosed
</span><a href="GHC.Tc.Types.BasicTypes.html#IsGroupClosed"><span class="hs-identifier hs-var">IsGroupClosed</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv NameSet
</span><a href="#local-6989586621683084147"><span class="hs-identifier hs-var">fv_env</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683084148"><span class="hs-identifier hs-var">type_closed</span></a></span><span>
</span><span id="line-1881"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1882"></span><span>    </span><span id="local-6989586621683084148"><span class="annot"><span class="annottext">type_closed :: Bool
</span><a href="#local-6989586621683084148"><span class="hs-identifier hs-var hs-var">type_closed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NameSet -&gt; Bool) -&gt; NameEnv NameSet -&gt; Bool
forall {k} elt (key :: k). (elt -&gt; Bool) -&gt; UniqFM key elt -&gt; Bool
</span><a href="GHC.Types.Unique.FM.html#allUFM"><span class="hs-identifier hs-var">allUFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#nameSetAll"><span class="hs-identifier hs-var">nameSetAll</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683084151"><span class="hs-identifier hs-var">is_closed_type_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NameEnv NameSet
</span><a href="#local-6989586621683084147"><span class="hs-identifier hs-var">fv_env</span></a></span><span>
</span><span id="line-1883"></span><span>
</span><span id="line-1884"></span><span>    </span><span class="annot"><a href="#local-6989586621683084147"><span class="hs-identifier hs-type">fv_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>
</span><span id="line-1885"></span><span>    </span><span id="local-6989586621683084147"><span class="annot"><span class="annottext">fv_env :: NameEnv NameSet
</span><a href="#local-6989586621683084147"><span class="hs-identifier hs-var hs-var">fv_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, NameSet)] -&gt; NameEnv NameSet
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, NameSet)] -&gt; NameEnv NameSet)
-&gt; [(Name, NameSet)] -&gt; NameEnv NameSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; [(Name, NameSet)])
-&gt; [GenLocated SrcSpanAnnA (HsBind GhcRn)] -&gt; [(Name, NameSet)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBind GhcRn -&gt; [(Name, NameSet)]
</span><a href="#local-6989586621683084152"><span class="hs-identifier hs-var">bindFvs</span></a></span><span> </span><span class="annot"><span class="annottext">(HsBind GhcRn -&gt; [(Name, NameSet)])
-&gt; (GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; HsBind GhcRn)
-&gt; GenLocated SrcSpanAnnA (HsBind GhcRn)
-&gt; [(Name, NameSet)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBind GhcRn) -&gt; HsBind GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
[GenLocated SrcSpanAnnA (HsBind GhcRn)]
</span><a href="#local-6989586621683084146"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1886"></span><span>
</span><span id="line-1887"></span><span>    </span><span class="annot"><a href="#local-6989586621683084152"><span class="hs-identifier hs-type">bindFvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsBindLR"><span class="hs-identifier hs-type">HsBindLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1888"></span><span>    </span><span id="local-6989586621683084152"><span class="annot"><span class="annottext">bindFvs :: HsBind GhcRn -&gt; [(Name, NameSet)]
</span><a href="#local-6989586621683084152"><span class="hs-identifier hs-var hs-var">bindFvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683084153"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084153"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-1889"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_ext :: forall idL idR. HsBindLR idL idR -&gt; XFunBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#fun_ext"><span class="hs-identifier hs-var">fun_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084154"><span class="annot"><span class="annottext">XFunBind GhcRn GhcRn
</span><a href="#local-6989586621683084154"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1890"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683084155"><span class="annot"><span class="annottext">open_fvs :: NameSet
</span><a href="#local-6989586621683084155"><span class="hs-identifier hs-var hs-var">open_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; NameSet
</span><a href="#local-6989586621683084156"><span class="hs-identifier hs-var">get_open_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">XFunBind GhcRn GhcRn
NameSet
</span><a href="#local-6989586621683084154"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-1891"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084153"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683084155"><span class="hs-identifier hs-var">open_fvs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1892"></span><span>    </span><span class="annot"><a href="#local-6989586621683084152"><span class="hs-identifier hs-var">bindFvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_lhs :: forall idL idR. HsBindLR idL idR -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084157"><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683084157"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_ext :: forall idL idR. HsBindLR idL idR -&gt; XPatBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#pat_ext"><span class="hs-identifier hs-var">pat_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683084158"><span class="annot"><span class="annottext">XPatBind GhcRn GhcRn
</span><a href="#local-6989586621683084158"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1893"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683084159"><span class="annot"><span class="annottext">open_fvs :: NameSet
</span><a href="#local-6989586621683084159"><span class="hs-identifier hs-var hs-var">open_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; NameSet
</span><a href="#local-6989586621683084156"><span class="hs-identifier hs-var">get_open_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">XPatBind GhcRn GhcRn
NameSet
</span><a href="#local-6989586621683084158"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-1894"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084160"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683084159"><span class="hs-identifier hs-var">open_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683084160"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084160"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; XRec GhcRn (Pat GhcRn) -&gt; [IdP GhcRn]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (Pat GhcRn)
</span><a href="#local-6989586621683084157"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1895"></span><span>    </span><span class="annot"><a href="#local-6989586621683084152"><span class="hs-identifier hs-var">bindFvs</span></a></span><span> </span><span class="annot"><span class="annottext">HsBind GhcRn
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1896"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1897"></span><span>
</span><span id="line-1898"></span><span>    </span><span id="local-6989586621683084156"><span class="annot"><span class="annottext">get_open_fvs :: NameSet -&gt; NameSet
</span><a href="#local-6989586621683084156"><span class="hs-identifier hs-var hs-var">get_open_fvs</span></a></span></span><span> </span><span id="local-6989586621683084161"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683084161"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; NameSet -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#filterNameSet"><span class="hs-identifier hs-var">filterNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Name -&gt; Bool) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683084163"><span class="hs-identifier hs-var">is_closed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683084161"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-1899"></span><span>
</span><span id="line-1900"></span><span>    </span><span class="annot"><a href="#local-6989586621683084163"><span class="hs-identifier hs-type">is_closed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ClosedTypeId"><span class="hs-identifier hs-type">ClosedTypeId</span></a></span><span>
</span><span id="line-1901"></span><span>    </span><span id="local-6989586621683084163"><span class="annot"><span class="annottext">is_closed :: Name -&gt; Bool
</span><a href="#local-6989586621683084163"><span class="hs-identifier hs-var hs-var">is_closed</span></a></span></span><span> </span><span id="local-6989586621683084165"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084165"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1902"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683084166"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621683084166"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621683084145"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084165"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1903"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621683084166"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1904"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1905"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_info :: TcTyThing -&gt; IdBindingInfo
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_info"><span class="hs-identifier hs-var">tct_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.BasicTypes.html#ClosedLet"><span class="hs-identifier hs-var">ClosedLet</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1906"></span><span>          </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1907"></span><span>
</span><span id="line-1908"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1909"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-comment">-- The free-var set for a top level binding mentions</span><span>
</span><span id="line-1910"></span><span>
</span><span id="line-1911"></span><span>
</span><span id="line-1912"></span><span>    </span><span class="annot"><a href="#local-6989586621683084151"><span class="hs-identifier hs-type">is_closed_type_id</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1913"></span><span>    </span><span class="hs-comment">-- We're already removed Global and ClosedLet Ids</span><span>
</span><span id="line-1914"></span><span>    </span><span id="local-6989586621683084151"><span class="annot"><span class="annottext">is_closed_type_id :: Name -&gt; Bool
</span><a href="#local-6989586621683084151"><span class="hs-identifier hs-var hs-var">is_closed_type_id</span></a></span></span><span> </span><span id="local-6989586621683084171"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084171"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1915"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683084172"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621683084172"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621683084145"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084171"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1916"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621683084172"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1917"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_info :: TcTyThing -&gt; IdBindingInfo
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_info"><span class="hs-identifier hs-var">tct_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#NonClosedLet"><span class="hs-identifier hs-type">NonClosedLet</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683084174"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683084174"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683084174"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1918"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_info :: TcTyThing -&gt; IdBindingInfo
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_info"><span class="hs-identifier hs-var">tct_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.BasicTypes.html#NotLetBound"><span class="hs-identifier hs-var">NotLetBound</span></a></span><span> </span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1919"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1920"></span><span>               </span><span class="hs-comment">-- In-scope type variables are not closed!</span><span>
</span><span id="line-1921"></span><span>          </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is_closed_id&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683084171"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1922"></span><span>
</span><span id="line-1923"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1924"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- The free-var set for a top level binding mentions</span><span>
</span><span id="line-1925"></span><span>               </span><span class="hs-comment">-- imported things too, so that we can report unused imports</span><span>
</span><span id="line-1926"></span><span>               </span><span class="hs-comment">-- These won't be in the local type env.</span><span>
</span><span id="line-1927"></span><span>               </span><span class="hs-comment">-- Ditto class method etc from the current module</span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span class="hs-comment">{- Note [Always generalise top-level bindings]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It is very confusing to apply NoGen to a top level binding. Consider (#20123):
   module M where
     x = 5
     f y = (x, y)

The MR means that x=5 is not generalise, so f's binding is no Closed.  So we'd
be tempted to use NoGen. But that leads to f :: Any -&gt; (Integer, Any), which
is plain stupid.

NoGen is good when we have call sites, but not at top level, where the
function may be exported.  And it's easier to grok &quot;MonoLocalBinds&quot; as
applying to, well, local bindings.
-}</span><span>
</span><span id="line-1944"></span><span>
</span><span id="line-1945"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
               Error contexts and messages
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1950"></span><span>
</span><span id="line-1951"></span><span class="hs-comment">-- This one is called on LHS, when pat and grhss are both Name</span><span>
</span><span id="line-1952"></span><span class="hs-comment">-- and on RHS, when pat is TcId and grhss is still Name</span><span>
</span><span id="line-1953"></span><span id="local-6989586621683082664"><span class="annot"><a href="GHC.Tc.Gen.Bind.html#patMonoBindsCtxt"><span class="hs-identifier hs-type">patMonoBindsCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#OutputableBndrId"><span class="hs-identifier hs-type">OutputableBndrId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082664"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1954"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082664"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-1955"></span><span id="patMonoBindsCtxt"><span class="annot"><span class="annottext">patMonoBindsCtxt :: forall (p :: Pass).
OutputableBndrId p =&gt;
LPat (GhcPass p) -&gt; GRHSs GhcRn (LHsExpr GhcRn) -&gt; SDoc
</span><a href="GHC.Tc.Gen.Bind.html#patMonoBindsCtxt"><span class="hs-identifier hs-var hs-var">patMonoBindsCtxt</span></a></span></span><span> </span><span id="local-6989586621683084181"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683084181"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683084182"><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084182"><span class="hs-identifier hs-var">grhss</span></a></span></span><span>
</span><span id="line-1956"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; BKey -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In a pattern binding:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BKey
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; GRHSs GhcRn (LHsExpr GhcRn) -&gt; SDoc
forall (bndr :: Pass) (p :: Pass).
(OutputableBndrId bndr, OutputableBndrId p) =&gt;
LPat (GhcPass bndr)
-&gt; GRHSs (GhcPass p) (LHsExpr (GhcPass p)) -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprPatBind"><span class="hs-identifier hs-var">pprPatBind</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683084181"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621683084182"><span class="hs-identifier hs-var">grhss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1957"></span></pre></body></html>