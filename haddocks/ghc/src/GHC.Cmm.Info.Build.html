<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs, RecordWildCards,
    NondecreasingIndentation,
    OverloadedStrings, LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html"><span class="hs-identifier">GHC.Cmm.Info.Build</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier">CAFSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFEnv"><span class="hs-identifier">CAFEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#cafAnal"><span class="hs-identifier">cafAnal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#cafAnalData"><span class="hs-identifier">cafAnalData</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#doSRTs"><span class="hs-identifier">doSRTs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier">ModuleSRTInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier">emptySRT</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTMap"><span class="hs-identifier">SRTMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtMapNonCAFs"><span class="hs-identifier">srtMapNonCAFs</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">succ</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html"><span class="hs-identifier">GHC.Platform.Profile</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html"><span class="hs-identifier">GHC.Cmm.BlockId</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Config.html"><span class="hs-identifier">GHC.Cmm.Config</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Graph.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Graph</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html"><span class="hs-identifier">GHC.Cmm.Dataflow</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html"><span class="hs-identifier">GHC.Data.Graph.Directed</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Heap.html"><span class="hs-identifier">GHC.StgToCmm.Heap</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.html"><span class="hs-identifier">Control.Monad.Trans.State</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Class.html"><span class="hs-identifier">Control.Monad.Trans.Class</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip4</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html"><span class="hs-identifier">GHC.Types.Unique.DSM</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">{- Note [SRTs]
   ~~~~~~~~~~~
Static Reference Tables (SRTs) are the mechanism by which the garbage collector
can determine the live CAFs in the program. An SRT is a static table associated
with a CAFfy closure which record which CAFfy objects are reachable from
the closure's code.

Representation
^^^^^^^^^^^^^^

+------+
| info |
|      |     +-----+---+---+---+
|   --------&gt;|SRT_2| | | | | 0 |
|------|     +-----+-|-+-|-+---+
|      |             |   |
| code |             |   |
|      |             v   v

An SRT is simply an object in the program's data segment. It has the
same representation as a static constructor.  There are 16
pre-compiled SRT info tables: stg_SRT_1_info, .. stg_SRT_16_info,
representing SRT objects with 1-16 pointers, respectively.

The entries of an SRT object point to static closures, which are either
- FUN_STATIC, THUNK_STATIC or CONSTR
- Another SRT (actually just a CONSTR)

The final field of the SRT is the static link field, used by the
garbage collector to chain together static closures that it visits and
to determine whether a static closure has been visited or not. (see
Note [STATIC_LINK fields])

By traversing the transitive closure of an SRT, the GC will reach all
of the CAFs that are reachable from the code associated with this SRT.

If we need to create an SRT with more than 16 entries, we build a
chain of SRT objects with all but the last having 16 entries.

+-----+---+- -+---+---+
|SRT16| | |   | | | 0 |
+-----+-|-+- -+-|-+---+
        |       |
        v       v
              +----+---+---+---+
              |SRT2| | | | | 0 |
              +----+-|-+-|-+---+
                     |   |
                     |   |
                     v   v

Referring to an SRT from the info table
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The following things have SRTs:

- Static functions (FUN)
- Static thunks (THUNK), ie. CAFs
- Continuations (RET_SMALL, etc.)

In each case, the info table points to the SRT, if there is one.

- info-&gt;srt is 0 if there's no SRT
- otherwise, there are three ways which we may encode the location of the SRT in
  the info table, described below.

USE_SRT_POINTER
---------------
Most general implementation. Can always be used, but other ways are more efficient.

- info-&gt;srt is a pointer

We encode an **absolute pointer** to the SRT in info-&gt;srt. e.g. for a FUN
with an SRT:

StgInfoTable          +------+
  info-&gt;layout.ptrs   | ...  |
  info-&gt;layout.nptrs  | ...  |
  info-&gt;srt           |  ------------&gt; pointer to SRT object
  info-&gt;type          | ...  |
                      |------|

USE_SRT_OFFSET
--------------
Requires:
  - tables-next-to-code enabled

In this case we use the info-&gt;srt to encode whether or not there is an SRT and
if so encode the offset to its location in info-&gt;f.srt_offset:

- info-&gt;srt is a half-word
- info-&gt;f.srt_offset is a 32-bit int
- info-&gt;srt is 0 if there's no SRT, otherwise,
- info-&gt;srt == 1 and info-&gt;f.srt_offset is a offset to the SRT, relative to the
field address itself

e.g. for a FUN with an SRT:

StgFunInfoTable       +------+
  info-&gt;f.srt_offset  |  ------------&gt; offset to SRT object
StgInfoTable          +------+
  info-&gt;layout.ptrs   | ...  |
  info-&gt;layout.nptrs  | ...  |
  info-&gt;srt           |  1   |
  info-&gt;type          | ...  |
                      |------|

USE_INLINE_SRT_FIELD
--------------------
Requires:
  - tables-next-to-code enabled
  - 64-bit architecture
  - small memory model

We optimise the info table representation further.  The offset to the SRT can
be stored in 32 bits (all code lives within a 2GB region in x86_64's small
memory model), so we can save a word in the info table by storing the
srt_offset in the srt field, which is half a word.

- info-&gt;srt is a half-word
- info-&gt;srt is 0 if there's no SRT, otherwise:
- info-&gt;srt is an offset from the info pointer to the SRT object

StgInfoTable          +------+
  info-&gt;layout.ptrs   |      |
  info-&gt;layout.nptrs  |      |
  info-&gt;srt           |  ------------&gt; offset to SRT object
                      |------|


EXAMPLE
^^^^^^^

f = \x. ... g ...
  where
    g = \y. ... h ... c1 ...
    h = \z. ... c2 ...

c1 &amp; c2 are CAFs

g and h are local functions, but they have no static closures.  When
we generate code for f, we start with a CmmGroup of four CmmDecls:

   [ f_closure, f_entry, g_entry, h_entry ]

we process each CmmDecl separately in cpsTop, giving us a list of
CmmDecls. e.g. for f_entry, we might end up with

   [ f_entry, f1_ret, f2_proc ]

where f1_ret is a return point, and f2_proc is a proc-point.  We have
a CAFSet for each of these CmmDecls, let's suppose they are

   [ f_entry{g_info}, f1_ret{g_info}, f2_proc{} ]
   [ g_entry{h_info, c1_closure} ]
   [ h_entry{c2_closure} ]

Next, we make an SRT for each of these functions:

  f_srt : [g_info]
  g_srt : [h_info, c1_closure]
  h_srt : [c2_closure]

Now, for g_info and h_info, we want to refer to the SRTs for g and h
respectively, which we'll label g_srt and h_srt:

  f_srt : [g_srt]
  g_srt : [h_srt, c1_closure]
  h_srt : [c2_closure]

Now, when an SRT has a single entry, we don't actually generate an SRT
closure for it, instead we just replace references to it with its
single element.  So, since h_srt == c2_closure, we have

  f_srt : [g_srt]
  g_srt : [c2_closure, c1_closure]
  h_srt : [c2_closure]

and the only SRT closure we generate is

  g_srt = SRT_2 [c2_closure, c1_closure]

Algorithm
^^^^^^^^^

0. let srtMap :: Map CAFfyLabel (Maybe SRTEntry) = {}
   Maps closures to their SRT entries (i.e. how they appear in a SRT payload)

1. Start with decls :: [CmmDecl]. This corresponds to an SCC of bindings in STG
   after code-generation.

2. CPS-convert each CmmDecl (GHC.Cmm.Pipeline.cpsTop), resulting in a list
   [CmmDecl]. There might be multiple CmmDecls in the result, due to proc-point
   splitting.

3. In cpsTop, *before* proc-point splitting, when we still have a single
   CmmDecl, we do cafAnal for procs:

   * cafAnal performs a backwards analysis on the code blocks

   * For each labelled block, the analysis produces a CAFSet (= Set CAFfyLabel),
     representing all the CAFfyLabels reachable from this label.

   * A label is added to the set if it refers to a FUN, THUNK, or RET,
     and its CafInfo /= NoCafRefs.
     (NB. all CafInfo for Ids in the current module should be initialised to
     MayHaveCafRefs)

   * The result is CAFEnv = LabelMap CAFSet

   (Why *before* proc-point splitting? Because the analysis needs to propagate
   information across branches, and proc-point splitting turns branches into
   CmmCalls to top-level CmmDecls.  The analysis would fail to find all the
   references to CAFFY labels if we did it after proc-point splitting.)

   For static data, cafAnalData simply returns set of all labels that refer to a
   FUN, THUNK, and RET whose CafInfos /= NoCafRefs.

4. The result of cpsTop is (CAFEnv, [CmmDecl]) for procs and (CAFSet, CmmDecl)
   for static data. So after `mapM cpsTop decls` we have
   [Either (CAFEnv, [CmmDecl]) (CAFSet, CmmDecl)]

5. For procs concat the decls and union the CAFEnvs to get (CAFEnv, [CmmDecl])

6. For static data generate a Map CLabel CAFSet (maps static data to their CAFSets)

7. Dependency-analyse the decls using CAFEnv and CAFSets, giving us SCC CAFfyLabel

8. For each SCC in dependency order
   - Let lbls :: [CAFfyLabel] be the non-recursive labels in this SCC
   - Apply CAFEnv to each label and concat the result :: [CAFfyLabel]
   - For each CAFfyLabel in the set apply srtMap (and ignore Nothing) to get
     srt :: [SRTEntry]
   - Make a label for this SRT, call it l
   - If the SRT is not empty (i.e. the group is CAFFY) add FUN_STATICs in the
     group to the SRT (see Note [Invalid optimisation: shortcutting])
   - Add to srtMap: lbls -&gt; if null srt then Nothing else Just l

9. At the end, update the IdInfo for every top-level binding x:
   if srtMap x == Nothing, then the binding is non-CAFFY, otherwise it is
   CAFFY.

Optimisations
^^^^^^^^^^^^^

To reduce the code size overhead and the cost of traversing SRTs in
the GC, we want to simplify SRTs where possible. We therefore apply
the following optimisations.  Each has a [keyword]; search for the
keyword in the code below to see where the optimisation is
implemented.

1. [Inline] we never create an SRT with a single entry, instead we
   point to the single entry directly from the info table.

   i.e. instead of

    +------+
    | info |
    |      |     +-----+---+---+
    |   --------&gt;|SRT_1| | | 0 |
    |------|     +-----+-|-+---+
    |      |             |
    | code |             |
    |      |             v
                         C

   we can point directly to the closure:

    +------+
    | info |
    |      |
    |   --------&gt;C
    |------|
    |      |
    | code |
    |      |


   Furthermore, the SRT for any code that refers to this info table
   can point directly to C.

   The exception to this is when we're doing dynamic linking. In that
   case, if the closure is not locally defined then we can't point to
   it directly from the info table, because this is the text section
   which cannot contain runtime relocations. In this case we skip this
   optimisation and generate the singleton SRT, because SRTs are in the
   data section and *can* have relocatable references.

2. [FUN] A static function closure can also be an SRT, we simply put
   the SRT entries as fields in the static closure.  This makes a lot
   of sense: the static references are just like the free variables of
   the FUN closure.

   i.e. instead of

   f_closure:
   +-----+---+
   |  |  | 0 |
   +- |--+---+
      |            +------+
      |            | info |     f_srt:
      |            |      |     +-----+---+---+---+
      |            |   --------&gt;|SRT_2| | | | + 0 |
      `-----------&gt;|------|     +-----+-|-+-|-+---+
                   |      |             |   |
                   | code |             |   |
                   |      |             v   v


   We can generate:

   f_closure:
   +-----+---+---+---+
   |  |  | | | | | 0 |
   +- |--+-|-+-|-+---+
      |    |   |   +------+
      |    v   v   | info |
      |            |      |
      |            |   0  |
      `-----------&gt;|------|
                   |      |
                   | code |
                   |      |


   (note: we can't do this for THUNKs, because the thunk gets
   overwritten when it is entered, so we wouldn't be able to share
   this SRT with other info tables that want to refer to it (see
   [Common] below). FUNs are immutable so don't have this problem.)

3. [Common] Identical SRTs can be commoned up.

4. [Filter] If an SRT A refers to an SRT B and a closure C, and B also
   refers to C (perhaps transitively), then we can omit the reference
   to C from A.


Note that there are many other optimisations that we could do, but
aren't implemented. In general, we could omit any reference from an
SRT if everything reachable from it is also reachable from the other
fields in the SRT. Our [Filter] optimisation is a special case of
this.

Another opportunity we don't exploit is this:

A = {X,Y,Z}
B = {Y,Z}
C = {X,B}

Here we could use C = {A} and therefore [Inline] C = A.
-}</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-404"></span><span class="hs-comment">{-
Note [No static object resurrection]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The &quot;static flag&quot; mechanism (see Note [STATIC_LINK fields] in smStorage.h) that
the GC uses to track liveness of static objects assumes that unreachable
objects will never become reachable again (i.e. are never &quot;resurrected&quot;).
Breaking this assumption can result in extremely subtle GC soundness issues
(e.g. #15544, #20959).

Guaranteeing that this assumption is not violated requires that all CAFfy
static objects reachable from the object's code are reachable from its SRT.  In
the past we have gotten this wrong in a few ways:

 * shortcutting references to FUN_STATICs to instead point to the FUN_STATIC's
   SRT. This lead to #15544 and is described in more detail in Note [Invalid
   optimisation: shortcutting].

 * omitting references to static data constructor applications. This previously
   happened due to an oversight (#20959): when generating an SRT for a
   recursive group we would drop references to the CAFfy static data
   constructors.

To see why we cannot allow object resurrection, see the examples in the
above-mentioned Notes.

If a static closure definitely does not transitively refer to any CAFs, then it
*may* be advertised as not-CAFfy in the interface file and consequently *may*
be omitted from SRTs. Regardless of whether the closure is advertised as CAFfy
or non-CAFfy, its STATIC_LINK field *must* be set to 3, so that it never
appears on the static closure list.
-}</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-comment">{-
Note [Invalid optimisation: shortcutting]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
You might think that if we have something like

A's SRT = {B}
B's SRT = {X}

that we could replace the reference to B in A's SRT with X.

A's SRT = {X}
B's SRT = {X}

and thereby perhaps save a little work at runtime, because we don't
have to visit B.

But this is NOT valid.

Consider these cases:

0. B can't be a constructor, because constructors don't have SRTs

1. B is a CAF. This is the easy one. Obviously we want A's SRT to
   point to B, so that it keeps B alive.

2. B is a function.  This is the tricky one. The reason we can't
   shortcut in this case is that we aren't allowed to resurrect static
   objects for the reason described in Note [No static object resurrection].
   We noticed this in #15544.

The particular case that cropped up when we tried this in #15544 was:

- A is a thunk
- B is a static function
- X is a CAF
- suppose we GC when A is alive, and B is not otherwise reachable.
- B is &quot;collected&quot;, meaning that it doesn't make it onto the static
  objects list during this GC, but nothing bad happens yet.
- Next, suppose we enter A, and then call B. (remember that A refers to B)
  At the entry point to B, we GC. This puts B on the stack, as part of the
  RET_FUN stack frame that gets pushed when we GC at a function entry point.
- This GC will now reach B
- But because B was previous &quot;collected&quot;, it breaks the assumption
  that static objects are never resurrected. See Note [STATIC_LINK
  fields] in rts/sm/Storage.h for why this is bad.
- In practice, the GC thinks that B has already been visited, and so
  doesn't visit X, and catastrophe ensues.



Note [Ticky labels in SRT analysis]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Raw Cmm data (CmmStaticsRaw) can't contain pointers so they're considered
non-CAFFY in SRT analysis and we update the SRTMap mapping them to `Nothing`
(meaning they're not CAFFY).

However when building with -ticky we generate ticky CLabels using the function's
`Name`. For example, if we have a top-level function `sat_s1rQ`, in a ticky
build we get two IdLabels using the name `sat_s1rQ`:

- For the function itself: IdLabel sat_s1rQ ... Entry
- For the ticky counter: IdLabel sat_s1rQ ... RednCounts

In these cases we really want to use the function definition for the SRT
analysis of this Name, because that's what we export for this Name -- ticky
counters are not exported. So we ignore ticky counters in SRT analysis (which
are never CAFFY and never exported).

Not doing this caused #17947 where we analysed the function first mapped the
name to CAFFY. We then saw the ticky constructor, and because it has the same
Name as the function and is not CAFFY we overrode the CafInfo of the name as
non-CAFFY.
-}</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- Label types</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-514"></span><span class="hs-comment">-- The label of a CAFfy thing.</span><span>
</span><span id="line-515"></span><span class="hs-comment">--</span><span>
</span><span id="line-516"></span><span class="hs-comment">-- Labels that come from 'cafAnal' can be:</span><span>
</span><span id="line-517"></span><span class="hs-comment">--   - @_closure@ labels for static functions, static data constructor</span><span>
</span><span id="line-518"></span><span class="hs-comment">--     applications, or static thunks</span><span>
</span><span id="line-519"></span><span class="hs-comment">--   - @_info@ labels for dynamic functions, thunks, or continuations</span><span>
</span><span id="line-520"></span><span class="hs-comment">--   - @_entry@ labels for functions or thunks</span><span>
</span><span id="line-521"></span><span class="hs-comment">--</span><span>
</span><span id="line-522"></span><span class="hs-comment">-- Meanwhile the labels on top-level blocks are @_entry@ labels.</span><span>
</span><span id="line-523"></span><span class="hs-comment">--</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- To put everything in the same namespace we convert all labels to</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- closure labels using 'toClosureLbl'.  Note that some of these</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- labels will not actually exist; that's ok because we're going to</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- map them to SRTEntry later, which ranges over labels that do exist.</span><span>
</span><span id="line-528"></span><span class="hs-comment">--</span><span>
</span><span id="line-529"></span><span class="hs-keyword">newtype</span><span> </span><span id="CAFfyLabel"><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-var">CAFfyLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CAFfyLabel"><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-var">CAFfyLabel</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951023"><span id="local-6989586621682951028"><span class="annot"><span class="annottext">CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
(CAFfyLabel -&gt; CAFfyLabel -&gt; Bool)
-&gt; (CAFfyLabel -&gt; CAFfyLabel -&gt; Bool) -&gt; Eq CAFfyLabel
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
== :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
$c/= :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
/= :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621682951037"><span id="local-6989586621682951041"><span id="local-6989586621682951045"><span id="local-6989586621682951049"><span id="local-6989586621682951053"><span id="local-6989586621682951057"><span id="local-6989586621682951061"><span class="annot"><span class="annottext">Eq CAFfyLabel
Eq CAFfyLabel =&gt;
(CAFfyLabel -&gt; CAFfyLabel -&gt; Ordering)
-&gt; (CAFfyLabel -&gt; CAFfyLabel -&gt; Bool)
-&gt; (CAFfyLabel -&gt; CAFfyLabel -&gt; Bool)
-&gt; (CAFfyLabel -&gt; CAFfyLabel -&gt; Bool)
-&gt; (CAFfyLabel -&gt; CAFfyLabel -&gt; Bool)
-&gt; (CAFfyLabel -&gt; CAFfyLabel -&gt; CAFfyLabel)
-&gt; (CAFfyLabel -&gt; CAFfyLabel -&gt; CAFfyLabel)
-&gt; Ord CAFfyLabel
CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
CAFfyLabel -&gt; CAFfyLabel -&gt; Ordering
CAFfyLabel -&gt; CAFfyLabel -&gt; CAFfyLabel
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: CAFfyLabel -&gt; CAFfyLabel -&gt; Ordering
compare :: CAFfyLabel -&gt; CAFfyLabel -&gt; Ordering
$c&lt; :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
&lt; :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
$c&lt;= :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
&lt;= :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
$c&gt; :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
&gt; :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
$c&gt;= :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
&gt;= :: CAFfyLabel -&gt; CAFfyLabel -&gt; Bool
$cmax :: CAFfyLabel -&gt; CAFfyLabel -&gt; CAFfyLabel
max :: CAFfyLabel -&gt; CAFfyLabel -&gt; CAFfyLabel
$cmin :: CAFfyLabel -&gt; CAFfyLabel -&gt; CAFfyLabel
min :: CAFfyLabel -&gt; CAFfyLabel -&gt; CAFfyLabel
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span id="local-6989586621682951073"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621682950502"><span class="annot"><a href="#local-6989586621682950502"><span class="hs-keyword hs-type">newtype</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950502"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950502"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-keyword">type</span><span> </span><span id="CAFSet"><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-var">CAFSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span>
</span><span id="line-535"></span><span class="hs-keyword">type</span><span> </span><span id="CAFEnv"><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFEnv"><span class="hs-identifier hs-var">CAFEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="annot"><span class="hs-comment">-- | Records the CAFfy references of a set of static data decls.</span></span><span>
</span><span id="line-538"></span><span class="hs-keyword">type</span><span> </span><span id="DataCAFEnv"><span class="annot"><a href="GHC.Cmm.Info.Build.html#DataCAFEnv"><span class="hs-identifier hs-var">DataCAFEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-type">mkCAFfyLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span>
</span><span id="line-542"></span><span id="mkCAFfyLabel"><span class="annot"><span class="annottext">mkCAFfyLabel :: Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var hs-var">mkCAFfyLabel</span></a></span></span><span> </span><span id="local-6989586621682951079"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951079"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951080"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951080"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-var">CAFfyLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#toClosureLbl"><span class="hs-identifier hs-var">toClosureLbl</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951080"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="hs-comment">-- This is a label that we can put in an SRT.  It *must* be a closure label,</span><span>
</span><span id="line-545"></span><span class="hs-comment">-- pointing to either a @FUN_STATIC@, @THUNK_STATIC@, or @CONSTR@.</span><span>
</span><span id="line-546"></span><span class="hs-keyword">newtype</span><span> </span><span id="SRTEntry"><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-var">SRTEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SRTEntry"><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-var">SRTEntry</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951083"><span id="local-6989586621682951087"><span class="annot"><span class="annottext">SRTEntry -&gt; SRTEntry -&gt; Bool
(SRTEntry -&gt; SRTEntry -&gt; Bool)
-&gt; (SRTEntry -&gt; SRTEntry -&gt; Bool) -&gt; Eq SRTEntry
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: SRTEntry -&gt; SRTEntry -&gt; Bool
== :: SRTEntry -&gt; SRTEntry -&gt; Bool
$c/= :: SRTEntry -&gt; SRTEntry -&gt; Bool
/= :: SRTEntry -&gt; SRTEntry -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951094"><span id="local-6989586621682951098"><span id="local-6989586621682951102"><span id="local-6989586621682951106"><span id="local-6989586621682951110"><span id="local-6989586621682951114"><span id="local-6989586621682951118"><span class="annot"><span class="annottext">Eq SRTEntry
Eq SRTEntry =&gt;
(SRTEntry -&gt; SRTEntry -&gt; Ordering)
-&gt; (SRTEntry -&gt; SRTEntry -&gt; Bool)
-&gt; (SRTEntry -&gt; SRTEntry -&gt; Bool)
-&gt; (SRTEntry -&gt; SRTEntry -&gt; Bool)
-&gt; (SRTEntry -&gt; SRTEntry -&gt; Bool)
-&gt; (SRTEntry -&gt; SRTEntry -&gt; SRTEntry)
-&gt; (SRTEntry -&gt; SRTEntry -&gt; SRTEntry)
-&gt; Ord SRTEntry
SRTEntry -&gt; SRTEntry -&gt; Bool
SRTEntry -&gt; SRTEntry -&gt; Ordering
SRTEntry -&gt; SRTEntry -&gt; SRTEntry
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: SRTEntry -&gt; SRTEntry -&gt; Ordering
compare :: SRTEntry -&gt; SRTEntry -&gt; Ordering
$c&lt; :: SRTEntry -&gt; SRTEntry -&gt; Bool
&lt; :: SRTEntry -&gt; SRTEntry -&gt; Bool
$c&lt;= :: SRTEntry -&gt; SRTEntry -&gt; Bool
&lt;= :: SRTEntry -&gt; SRTEntry -&gt; Bool
$c&gt; :: SRTEntry -&gt; SRTEntry -&gt; Bool
&gt; :: SRTEntry -&gt; SRTEntry -&gt; Bool
$c&gt;= :: SRTEntry -&gt; SRTEntry -&gt; Bool
&gt;= :: SRTEntry -&gt; SRTEntry -&gt; Bool
$cmax :: SRTEntry -&gt; SRTEntry -&gt; SRTEntry
max :: SRTEntry -&gt; SRTEntry -&gt; SRTEntry
$cmin :: SRTEntry -&gt; SRTEntry -&gt; SRTEntry
min :: SRTEntry -&gt; SRTEntry -&gt; SRTEntry
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span id="local-6989586621682951123"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621682950501"><span class="annot"><a href="#local-6989586621682950501"><span class="hs-keyword hs-type">newtype</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950501"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950501"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- CAF analysis</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-type">addCafLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-556"></span><span id="addCafLabel"><span class="annot"><span class="annottext">addCafLabel :: Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var hs-var">addCafLabel</span></a></span></span><span> </span><span id="local-6989586621682951127"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951127"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951128"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951128"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682951129"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951129"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe Name
</span><a href="GHC.Cmm.CLabel.html#hasHaskellName"><span class="hs-identifier hs-var">hasHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951128"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951131"><span class="annot"><span class="annottext">caf_label :: CAFfyLabel
</span><a href="#local-6989586621682951131"><span class="hs-identifier hs-var hs-var">caf_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var">mkCAFfyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951127"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951128"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-comment">-- For imported Ids hasCAF will have accurate CafInfo</span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-comment">-- Locals are initialized as CAFFY. We turn labels with empty SRTs into</span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-comment">-- non-CAFFYs in doSRTs</span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#hasCAF"><span class="hs-identifier hs-var">hasCAF</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951128"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CAFfyLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951131"><span class="hs-identifier hs-var">caf_label</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951129"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951129"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="annot"><span class="hs-comment">-- | Collect possible CAFfy references from a 'CmmData' decl.</span></span><span>
</span><span id="line-568"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#cafAnalData"><span class="hs-identifier hs-type">cafAnalData</span></a></span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a></span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-572"></span><span id="cafAnalData"><span class="annot"><span class="annottext">cafAnalData :: Platform -&gt; GenCmmStatics 'False -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#cafAnalData"><span class="hs-identifier hs-var hs-var">cafAnalData</span></a></span></span><span> </span><span id="local-6989586621682951136"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951136"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951137"><span class="annot"><span class="annottext">GenCmmStatics 'False
</span><a href="#local-6989586621682951137"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenCmmStatics 'False
</span><a href="#local-6989586621682951137"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-573"></span><span>   </span><span class="annot"><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-type">CmmStaticsRaw</span></a></span><span> </span><span id="local-6989586621682951139"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951139"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span> </span><span id="local-6989586621682951140"><span class="annot"><span class="annottext">[CmmStatic]
</span><a href="#local-6989586621682951140"><span class="hs-identifier hs-var">_data</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span>
</span><span id="line-574"></span><span>   </span><span class="annot"><a href="GHC.Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a></span><span> </span><span id="local-6989586621682951145"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951145"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span> </span><span id="local-6989586621682951146"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951146"><span class="hs-identifier hs-var">_itbl</span></a></span></span><span> </span><span id="local-6989586621682951147"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682951147"><span class="hs-identifier hs-var">_ccs</span></a></span></span><span> </span><span id="local-6989586621682951148"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951148"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span id="local-6989586621682951149"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951149"><span class="hs-identifier hs-var">_extras</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-575"></span><span>       </span><span class="annot"><span class="annottext">(Set CAFfyLabel -&gt; CmmLit -&gt; Set CAFfyLabel)
-&gt; Set CAFfyLabel -&gt; [CmmLit] -&gt; Set CAFfyLabel
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel -&gt; CmmLit -&gt; Set CAFfyLabel
</span><a href="#local-6989586621682951151"><span class="hs-identifier hs-var">analyzeStatic</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951148"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-576"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-577"></span><span>       </span><span id="local-6989586621682951151"><span class="annot"><span class="annottext">analyzeStatic :: Set CAFfyLabel -&gt; CmmLit -&gt; Set CAFfyLabel
</span><a href="#local-6989586621682951151"><span class="hs-identifier hs-var hs-var">analyzeStatic</span></a></span></span><span> </span><span id="local-6989586621682951152"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951152"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682951153"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682951153"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-578"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682951153"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-579"></span><span>           </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621682951155"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951155"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951136"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951155"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951152"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-580"></span><span>           </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-type">CmmLabelOff</span></a></span><span> </span><span id="local-6989586621682951157"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951157"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951136"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951157"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951152"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-581"></span><span>           </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelDiffOff"><span class="hs-identifier hs-type">CmmLabelDiffOff</span></a></span><span> </span><span id="local-6989586621682951159"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951159"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682951160"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951160"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951136"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951159"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">(Set CAFfyLabel -&gt; Set CAFfyLabel)
-&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951136"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951160"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951152"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-582"></span><span>           </span><span class="annot"><span class="annottext">CmmLit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951152"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-585"></span><span class="hs-comment">-- For each code block:</span><span>
</span><span id="line-586"></span><span class="hs-comment">--   - collect the references reachable from this code block to FUN,</span><span>
</span><span id="line-587"></span><span class="hs-comment">--     THUNK or RET labels for which @hasCAF == True@</span><span>
</span><span id="line-588"></span><span class="hs-comment">--</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- This gives us a 'CAFEnv': a mapping from code block to sets of labels</span><span>
</span><span id="line-590"></span><span class="hs-comment">--</span><span>
</span><span id="line-591"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#cafAnal"><span class="hs-identifier hs-type">cafAnal</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelSet"><span class="hs-identifier hs-type">LabelSet</span></a></span><span>   </span><span class="hs-comment">-- ^ The blocks representing continuations, ie. those</span><span>
</span><span id="line-594"></span><span>                </span><span class="hs-comment">-- that will get RET info tables.  These labels will</span><span>
</span><span id="line-595"></span><span>                </span><span class="hs-comment">-- get their own SRTs, so we don't aggregate CAFs from</span><span>
</span><span id="line-596"></span><span>                </span><span class="hs-comment">-- references to these labels, we just use the label.</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The top label of the proc</span></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFEnv"><span class="hs-identifier hs-type">CAFEnv</span></a></span><span>
</span><span id="line-600"></span><span id="cafAnal"><span class="annot"><span class="annottext">cafAnal :: Platform
-&gt; LabelSet -&gt; CLabel -&gt; GenGenCmmGraph LabelMap CmmNode -&gt; CAFEnv
</span><a href="GHC.Cmm.Info.Build.html#cafAnal"><span class="hs-identifier hs-var hs-var">cafAnal</span></a></span></span><span> </span><span id="local-6989586621682951163"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951163"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951164"><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682951164"><span class="hs-identifier hs-var">contLbls</span></a></span></span><span> </span><span id="local-6989586621682951165"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951165"><span class="hs-identifier hs-var">topLbl</span></a></span></span><span> </span><span id="local-6989586621682951166"><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951166"><span class="hs-identifier hs-var">cmmGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-601"></span><span>  </span><span class="annot"><span class="annottext">DataflowLattice (Set CAFfyLabel)
-&gt; TransferFun' CmmNode (Set CAFfyLabel)
-&gt; GenGenCmmGraph LabelMap CmmNode
-&gt; CAFEnv
-&gt; CAFEnv
forall (node :: Extensibility -&gt; Extensibility -&gt; *) f.
NonLocal node =&gt;
DataflowLattice f
-&gt; TransferFun' node f
-&gt; GenCmmGraph node
-&gt; FactBase f
-&gt; FactBase f
</span><a href="GHC.Cmm.Dataflow.html#analyzeCmmBwd"><span class="hs-identifier hs-var">analyzeCmmBwd</span></a></span><span> </span><span class="annot"><span class="annottext">DataflowLattice (Set CAFfyLabel)
</span><a href="GHC.Cmm.Info.Build.html#cafLattice"><span class="hs-identifier hs-var">cafLattice</span></a></span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform
-&gt; LabelSet
-&gt; BlockId
-&gt; CLabel
-&gt; TransferFun' CmmNode (Set CAFfyLabel)
</span><a href="GHC.Cmm.Info.Build.html#cafTransfers"><span class="hs-identifier hs-var">cafTransfers</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951163"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682951164"><span class="hs-identifier hs-var">contLbls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951166"><span class="hs-identifier hs-var">cmmGraph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951165"><span class="hs-identifier hs-var">topLbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951166"><span class="hs-identifier hs-var">cmmGraph</span></a></span><span> </span><span class="annot"><span class="annottext">CAFEnv
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#cafLattice"><span class="hs-identifier hs-type">cafLattice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-identifier hs-type">DataflowLattice</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-606"></span><span id="cafLattice"><span class="annot"><span class="annottext">cafLattice :: DataflowLattice (Set CAFfyLabel)
</span><a href="GHC.Cmm.Info.Build.html#cafLattice"><span class="hs-identifier hs-var hs-var">cafLattice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
-&gt; JoinFun (Set CAFfyLabel) -&gt; DataflowLattice (Set CAFfyLabel)
forall a. a -&gt; JoinFun a -&gt; DataflowLattice a
</span><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-identifier hs-var">DataflowLattice</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFun (Set CAFfyLabel)
forall {a}.
Ord a =&gt;
OldFact (Set a) -&gt; NewFact (Set a) -&gt; JoinedFact (Set a)
</span><a href="#local-6989586621682951173"><span class="hs-identifier hs-var">add</span></a></span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-608"></span><span>    </span><span id="local-6989586621682951173"><span class="annot"><span class="annottext">add :: OldFact (Set a) -&gt; NewFact (Set a) -&gt; JoinedFact (Set a)
</span><a href="#local-6989586621682951173"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.html#OldFact"><span class="hs-identifier hs-type">OldFact</span></a></span><span> </span><span id="local-6989586621682951182"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.html#NewFact"><span class="hs-identifier hs-type">NewFact</span></a></span><span> </span><span id="local-6989586621682951184"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621682951184"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-609"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682951185"><span class="annot"><span class="annottext">new' :: Set a
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var hs-var">new'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; Set a -&gt; Set a
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621682951184"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set a -&gt; JoinedFact (Set a)
forall a. Bool -&gt; a -&gt; JoinedFact a
</span><a href="GHC.Cmm.Dataflow.html#changedIf"><span class="hs-identifier hs-var">changedIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set a -&gt; WordOff
forall a. Set a -&gt; WordOff
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">new'</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; WordOff
forall a. Set a -&gt; WordOff
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">new'</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#cafTransfers"><span class="hs-identifier hs-type">cafTransfers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelSet"><span class="hs-identifier hs-type">LabelSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#TransferFun"><span class="hs-identifier hs-type">TransferFun</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-614"></span><span id="cafTransfers"><span class="annot"><span class="annottext">cafTransfers :: Platform
-&gt; LabelSet
-&gt; BlockId
-&gt; CLabel
-&gt; TransferFun' CmmNode (Set CAFfyLabel)
</span><a href="GHC.Cmm.Info.Build.html#cafTransfers"><span class="hs-identifier hs-var hs-var">cafTransfers</span></a></span></span><span> </span><span id="local-6989586621682951191"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951192"><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682951192"><span class="hs-identifier hs-var">contLbls</span></a></span></span><span> </span><span id="local-6989586621682951193"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951193"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span id="local-6989586621682951194"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951194"><span class="hs-identifier hs-var">topLbl</span></a></span></span><span>
</span><span id="line-615"></span><span>  </span><span id="local-6989586621682951195"><span class="annot"><span class="annottext">block :: CmmBlock
</span><a href="#local-6989586621682951195"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BlockCC"><span class="hs-identifier hs-type">BlockCC</span></a></span><span> </span><span id="local-6989586621682951227"><span class="annot"><span class="annottext">CmmNode C O
</span><a href="#local-6989586621682951227"><span class="hs-identifier hs-var">eNode</span></a></span></span><span> </span><span id="local-6989586621682951228"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682951228"><span class="hs-identifier hs-var">middle</span></a></span></span><span> </span><span id="local-6989586621682951229"><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682951229"><span class="hs-identifier hs-var">xNode</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682951230"><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951230"><span class="hs-identifier hs-var">fBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-616"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682951231"><span class="hs-identifier hs-type">joined</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-617"></span><span>        </span><span id="local-6989586621682951231"><span class="annot"><span class="annottext">joined :: Set CAFfyLabel
</span><a href="#local-6989586621682951231"><span class="hs-identifier hs-var hs-var">joined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmNode O C -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="#local-6989586621682951232"><span class="hs-identifier hs-var">cafsInNode</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682951229"><span class="hs-identifier hs-var">xNode</span></a></span><span> </span><span class="annot"><span class="annottext">(Set CAFfyLabel -&gt; Set CAFfyLabel)
-&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951233"><span class="hs-identifier hs-var">live'</span></a></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>        </span><span class="annot"><a href="#local-6989586621682951234"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-620"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621682951234"><span class="annot"><span class="annottext">result :: Set CAFfyLabel
</span><a href="#local-6989586621682951234"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel)
-&gt; Block CmmNode O O -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall (node :: Extensibility -&gt; Extensibility -&gt; *) f.
(node O O -&gt; f -&gt; f) -&gt; Block node O O -&gt; f -&gt; f
</span><a href="GHC.Cmm.Dataflow.html#foldNodesBwdOO"><span class="hs-identifier hs-var">foldNodesBwdOO</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O O -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="#local-6989586621682951232"><span class="hs-identifier hs-var">cafsInNode</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682951228"><span class="hs-identifier hs-var">middle</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951231"><span class="hs-identifier hs-var">joined</span></a></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span>        </span><span class="annot"><a href="#local-6989586621682951236"><span class="hs-identifier hs-type">facts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-623"></span><span>        </span><span id="local-6989586621682951236"><span class="annot"><span class="annottext">facts :: [Set CAFfyLabel]
</span><a href="#local-6989586621682951236"><span class="hs-identifier hs-var hs-var">facts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; Maybe (Set CAFfyLabel))
-&gt; [BlockId] -&gt; [Set CAFfyLabel]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; Maybe (Set CAFfyLabel)
</span><a href="#local-6989586621682951238"><span class="hs-identifier hs-var">successorFact</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode O C -&gt; [BlockId]
forall (e :: Extensibility). CmmNode e C -&gt; [BlockId]
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility).
NonLocal thing =&gt;
thing e C -&gt; [BlockId]
</span><a href="GHC.Cmm.Dataflow.Graph.html#successors"><span class="hs-identifier hs-var">successors</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682951229"><span class="hs-identifier hs-var">xNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>        </span><span class="annot"><a href="#local-6989586621682951233"><span class="hs-identifier hs-type">live'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span>
</span><span id="line-626"></span><span>        </span><span id="local-6989586621682951233"><span class="annot"><span class="annottext">live' :: Set CAFfyLabel
</span><a href="#local-6989586621682951233"><span class="hs-identifier hs-var hs-var">live'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataflowLattice (Set CAFfyLabel)
-&gt; [Set CAFfyLabel] -&gt; Set CAFfyLabel
forall f. DataflowLattice f -&gt; [f] -&gt; f
</span><a href="GHC.Cmm.Dataflow.html#joinFacts"><span class="hs-identifier hs-var">joinFacts</span></a></span><span> </span><span class="annot"><span class="annottext">DataflowLattice (Set CAFfyLabel)
</span><a href="GHC.Cmm.Info.Build.html#cafLattice"><span class="hs-identifier hs-var">cafLattice</span></a></span><span> </span><span class="annot"><span class="annottext">[Set CAFfyLabel]
</span><a href="#local-6989586621682951236"><span class="hs-identifier hs-var">facts</span></a></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><a href="#local-6989586621682951238"><span class="hs-identifier hs-type">successorFact</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>        </span><span id="local-6989586621682951238"><span class="annot"><span class="annottext">successorFact :: BlockId -&gt; Maybe (Set CAFfyLabel)
</span><a href="#local-6989586621682951238"><span class="hs-identifier hs-var hs-var">successorFact</span></a></span></span><span> </span><span id="local-6989586621682951241"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951241"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-630"></span><span>          </span><span class="hs-comment">-- If this is a loop back to the entry, we can refer to the</span><span>
</span><span id="line-631"></span><span>          </span><span class="hs-comment">-- entry label.</span><span>
</span><span id="line-632"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951241"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951193"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel -&gt; Maybe (Set CAFfyLabel)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951194"><span class="hs-identifier hs-var">topLbl</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>          </span><span class="hs-comment">-- If this is a continuation, we want to refer to the</span><span>
</span><span id="line-634"></span><span>          </span><span class="hs-comment">-- SRT for the continuation's info table</span><span>
</span><span id="line-635"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951241"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelSet -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Label.html#setMember"><span class="hs-operator hs-var">`setMember`</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682951192"><span class="hs-identifier hs-var">contLbls</span></a></span><span>
</span><span id="line-636"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel -&gt; Maybe (Set CAFfyLabel)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CAFfyLabel -&gt; Set CAFfyLabel
forall a. a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var">mkCAFfyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; CLabel
</span><a href="GHC.Cmm.BlockId.html#infoTblLbl"><span class="hs-identifier hs-var">infoTblLbl</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951241"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>          </span><span class="hs-comment">-- Otherwise, takes the CAF references from the destination</span><span>
</span><span id="line-638"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-639"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CAFEnv -&gt; Maybe (Set CAFfyLabel)
forall f. BlockId -&gt; FactBase f -&gt; Maybe f
</span><a href="GHC.Cmm.Dataflow.Label.html#lookupFact"><span class="hs-identifier hs-var">lookupFact</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951241"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951230"><span class="hs-identifier hs-var">fBase</span></a></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>        </span><span id="local-6989586621682950549"><span id="local-6989586621682950550"><span class="annot"><a href="#local-6989586621682951232"><span class="hs-identifier hs-type">cafsInNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950549"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950550"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span></span></span><span>
</span><span id="line-642"></span><span>        </span><span id="local-6989586621682951232"><span class="annot"><span class="annottext">cafsInNode :: forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="#local-6989586621682951232"><span class="hs-identifier hs-var hs-var">cafsInNode</span></a></span></span><span> </span><span id="local-6989586621682951246"><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682951246"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621682951247"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951247"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel)
-&gt; CmmNode e x -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall z (e :: Extensibility) (x :: Extensibility).
(CmmExpr -&gt; z -&gt; z) -&gt; CmmNode e x -&gt; z -&gt; z
</span><a href="GHC.Cmm.Node.html#foldExpDeep"><span class="hs-identifier hs-var">foldExpDeep</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="#local-6989586621682951249"><span class="hs-identifier hs-var">addCafExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682951246"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951247"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>        </span><span class="annot"><a href="#local-6989586621682951249"><span class="hs-identifier hs-type">addCafExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span>
</span><span id="line-645"></span><span>        </span><span id="local-6989586621682951249"><span class="annot"><span class="annottext">addCafExpr :: CmmExpr -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="#local-6989586621682951249"><span class="hs-identifier hs-var hs-var">addCafExpr</span></a></span></span><span> </span><span id="local-6989586621682951250"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682951250"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682951251"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951251"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-646"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682951250"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-647"></span><span>            </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621682951253"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951253"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-648"></span><span>              </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951253"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951251"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-649"></span><span>            </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-type">CmmLabelOff</span></a></span><span> </span><span id="local-6989586621682951254"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951254"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>              </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951254"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951251"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-651"></span><span>            </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelDiffOff"><span class="hs-identifier hs-type">CmmLabelDiffOff</span></a></span><span> </span><span id="local-6989586621682951255"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951255"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682951256"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951256"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-652"></span><span>              </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951255"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">(Set CAFfyLabel -&gt; Set CAFfyLabel)
-&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#addCafLabel"><span class="hs-identifier hs-var">addCafLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951256"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951251"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-653"></span><span>            </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-654"></span><span>              </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951251"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-655"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-656"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CAFEnv -&gt; CAFEnv
forall b. String -&gt; SDoc -&gt; b -&gt; b
</span><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-var">srtTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cafTransfers&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;block:&quot;</span></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmBlock -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682951195"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-657"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;contLbls:&quot;</span></span><span>     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682951192"><span class="hs-identifier hs-var">contLbls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-658"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;entry:&quot;</span></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951193"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-659"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;topLbl:&quot;</span></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951194"><span class="hs-identifier hs-var">topLbl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-660"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cafs in exit:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Set CAFfyLabel -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951231"><span class="hs-identifier hs-var">joined</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-661"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;result:&quot;</span></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Set CAFfyLabel -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951191"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951234"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CAFEnv -&gt; CAFEnv) -&gt; CAFEnv -&gt; CAFEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-662"></span><span>        </span><span class="annot"><span class="annottext">BlockId -&gt; Set CAFfyLabel -&gt; CAFEnv
forall v. BlockId -&gt; v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapSingleton"><span class="hs-identifier hs-var">mapSingleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O -&gt; BlockId
forall (x :: Extensibility). CmmNode C x -&gt; BlockId
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
NonLocal thing =&gt;
thing C x -&gt; BlockId
</span><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode C O
</span><a href="#local-6989586621682951227"><span class="hs-identifier hs-var">eNode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951234"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-666"></span><span class="hs-comment">-- ModuleSRTInfo</span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="hs-keyword">data</span><span> </span><span id="ModuleSRTInfo"><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-var">ModuleSRTInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ModuleSRTInfo"><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-var">ModuleSRTInfo</span></a></span></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="thisModule"><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Module
</span><a href="GHC.Cmm.Info.Build.html#thisModule"><span class="hs-identifier hs-var hs-var">thisModule</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Current module being compiled. Required for calling labelDynamic.</span></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dedupSRTs"><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Map (Set SRTEntry) SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#dedupSRTs"><span class="hs-identifier hs-var hs-var">dedupSRTs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span>
</span><span id="line-672"></span><span>    </span><span class="hs-comment">-- ^ previous SRTs we've emitted, so we can de-duplicate.</span><span>
</span><span id="line-673"></span><span>    </span><span class="hs-comment">-- Used to implement the [Common] optimisation.</span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="flatSRTs"><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Map SRTEntry (Set SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#flatSRTs"><span class="hs-identifier hs-var hs-var">flatSRTs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>    </span><span class="hs-comment">-- ^ The reverse mapping, so that we can remove redundant</span><span>
</span><span id="line-676"></span><span>    </span><span class="hs-comment">-- entries. e.g.  if we have an SRT [a,b,c], and we know that b</span><span>
</span><span id="line-677"></span><span>    </span><span class="hs-comment">-- points to [c,d], we can omit c and emit [a,b].</span><span>
</span><span id="line-678"></span><span>    </span><span class="hs-comment">-- Used to implement the [Filter] optimisation.</span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="moduleSRTMap"><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; SRTMap
</span><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var hs-var">moduleSRTMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTMap"><span class="hs-identifier hs-type">SRTMap</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682950578"><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950578"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950578"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-683"></span><span>  </span><span id="local-6989586621682951292"><span class="annot"><span class="annottext">pdoc :: env -&gt; ModuleSRTInfo -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var hs-var hs-var">pdoc</span></a></span></span><span> </span><span id="local-6989586621682951293"><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span class="hs-special">{</span><span id="local-6989586621682951294"><span id="local-6989586621682951295"><span id="local-6989586621682951296"><span id="local-6989586621682951297"><span class="annot"><span class="annottext">Map (Set SRTEntry) SRTEntry
Map SRTEntry (Set SRTEntry)
SRTMap
Module
thisModule :: ModuleSRTInfo -&gt; Module
dedupSRTs :: ModuleSRTInfo -&gt; Map (Set SRTEntry) SRTEntry
flatSRTs :: ModuleSRTInfo -&gt; Map SRTEntry (Set SRTEntry)
moduleSRTMap :: ModuleSRTInfo -&gt; SRTMap
thisModule :: Module
dedupSRTs :: Map (Set SRTEntry) SRTEntry
flatSRTs :: Map SRTEntry (Set SRTEntry)
moduleSRTMap :: SRTMap
</span><a href="GHC.Cmm.Info.Build.html#thisModule"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-684"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ModuleSRTInfo {&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dedupSRTs =&quot;</span></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">env -&gt; Map (Set SRTEntry) SRTEntry -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Set SRTEntry) SRTEntry
</span><a href="#local-6989586621682951295"><span class="hs-identifier hs-var">dedupSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-686"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;flatSRTs =&quot;</span></span><span>     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">env -&gt; Map SRTEntry (Set SRTEntry) -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Map SRTEntry (Set SRTEntry)
</span><a href="#local-6989586621682951296"><span class="hs-identifier hs-var">flatSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-687"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;moduleSRTMap =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">env -&gt; SRTMap -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951297"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'}'</span></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-type">emptySRT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span>
</span><span id="line-690"></span><span id="emptySRT"><span class="annot"><span class="annottext">emptySRT :: Module -&gt; ModuleSRTInfo
</span><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-var hs-var">emptySRT</span></a></span></span><span> </span><span id="local-6989586621682951300"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682951300"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">thisModule :: Module
</span><a href="GHC.Cmm.Info.Build.html#thisModule"><span class="hs-identifier hs-var">thisModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682951300"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dedupSRTs :: Map (Set SRTEntry) SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#dedupSRTs"><span class="hs-identifier hs-var">dedupSRTs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Set SRTEntry) SRTEntry
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-694"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">flatSRTs :: Map SRTEntry (Set SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#flatSRTs"><span class="hs-identifier hs-var">flatSRTs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SRTEntry (Set SRTEntry)
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-695"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">moduleSRTMap :: SRTMap
</span><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRTMap
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-696"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-699"></span><span class="hs-comment">-- Constructing SRTs</span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span class="hs-comment">{- Implementation notes

- In each CmmDecl there is a mapping info_tbls from Label -&gt; CmmInfoTable

- The entry in info_tbls corresponding to g_entry is the closure info
  table, the rest are continuations.

- Each entry in info_tbls possibly needs an SRT.  We need to make a
  label for each of these.

- We get the CAFSet for each entry from the CAFEnv

-}</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span class="hs-keyword">data</span><span> </span><span id="SomeLabel"><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-var">SomeLabel</span></a></span></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="BlockLabel"><span class="annot"><a href="GHC.Cmm.Info.Build.html#BlockLabel"><span class="hs-identifier hs-var">BlockLabel</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DeclLabel"><span class="annot"><a href="GHC.Cmm.Info.Build.html#DeclLabel"><span class="hs-identifier hs-var">DeclLabel</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951305"><span id="local-6989586621682951312"><span class="annot"><span class="annottext">SomeLabel -&gt; SomeLabel -&gt; Bool
(SomeLabel -&gt; SomeLabel -&gt; Bool)
-&gt; (SomeLabel -&gt; SomeLabel -&gt; Bool) -&gt; Eq SomeLabel
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: SomeLabel -&gt; SomeLabel -&gt; Bool
== :: SomeLabel -&gt; SomeLabel -&gt; Bool
$c/= :: SomeLabel -&gt; SomeLabel -&gt; Bool
/= :: SomeLabel -&gt; SomeLabel -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951318"><span id="local-6989586621682951323"><span id="local-6989586621682951327"><span id="local-6989586621682951330"><span id="local-6989586621682951333"><span id="local-6989586621682951336"><span id="local-6989586621682951339"><span class="annot"><span class="annottext">Eq SomeLabel
Eq SomeLabel =&gt;
(SomeLabel -&gt; SomeLabel -&gt; Ordering)
-&gt; (SomeLabel -&gt; SomeLabel -&gt; Bool)
-&gt; (SomeLabel -&gt; SomeLabel -&gt; Bool)
-&gt; (SomeLabel -&gt; SomeLabel -&gt; Bool)
-&gt; (SomeLabel -&gt; SomeLabel -&gt; Bool)
-&gt; (SomeLabel -&gt; SomeLabel -&gt; SomeLabel)
-&gt; (SomeLabel -&gt; SomeLabel -&gt; SomeLabel)
-&gt; Ord SomeLabel
SomeLabel -&gt; SomeLabel -&gt; Bool
SomeLabel -&gt; SomeLabel -&gt; Ordering
SomeLabel -&gt; SomeLabel -&gt; SomeLabel
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: SomeLabel -&gt; SomeLabel -&gt; Ordering
compare :: SomeLabel -&gt; SomeLabel -&gt; Ordering
$c&lt; :: SomeLabel -&gt; SomeLabel -&gt; Bool
&lt; :: SomeLabel -&gt; SomeLabel -&gt; Bool
$c&lt;= :: SomeLabel -&gt; SomeLabel -&gt; Bool
&lt;= :: SomeLabel -&gt; SomeLabel -&gt; Bool
$c&gt; :: SomeLabel -&gt; SomeLabel -&gt; Bool
&gt; :: SomeLabel -&gt; SomeLabel -&gt; Bool
$c&gt;= :: SomeLabel -&gt; SomeLabel -&gt; Bool
&gt;= :: SomeLabel -&gt; SomeLabel -&gt; Bool
$cmax :: SomeLabel -&gt; SomeLabel -&gt; SomeLabel
max :: SomeLabel -&gt; SomeLabel -&gt; SomeLabel
$cmin :: SomeLabel -&gt; SomeLabel -&gt; SomeLabel
min :: SomeLabel -&gt; SomeLabel -&gt; SomeLabel
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682950500"><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950500"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682950500"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-721"></span><span>   </span><span id="local-6989586621682951349"><span class="annot"><span class="annottext">pdoc :: env -&gt; SomeLabel -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var hs-var hs-var">pdoc</span></a></span></span><span> </span><span id="local-6989586621682951350"><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621682951350"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-722"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#BlockLabel"><span class="hs-identifier hs-type">BlockLabel</span></a></span><span> </span><span id="local-6989586621682951351"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951351"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;b:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">env -&gt; BlockId -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621682951350"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951351"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-723"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#DeclLabel"><span class="hs-identifier hs-type">DeclLabel</span></a></span><span> </span><span id="local-6989586621682951352"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951352"><span class="hs-identifier hs-var">l</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;s:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">env -&gt; CLabel -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621682951350"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951352"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#getBlockLabel"><span class="hs-identifier hs-type">getBlockLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span>
</span><span id="line-726"></span><span id="getBlockLabel"><span class="annot"><span class="annottext">getBlockLabel :: SomeLabel -&gt; Maybe BlockId
</span><a href="GHC.Cmm.Info.Build.html#getBlockLabel"><span class="hs-identifier hs-var hs-var">getBlockLabel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#BlockLabel"><span class="hs-identifier hs-type">BlockLabel</span></a></span><span> </span><span id="local-6989586621682951354"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951354"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; Maybe BlockId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951354"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-727"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#getBlockLabel"><span class="hs-identifier hs-var">getBlockLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#DeclLabel"><span class="hs-identifier hs-type">DeclLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe BlockId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#getBlockLabels"><span class="hs-identifier hs-type">getBlockLabels</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-730"></span><span id="getBlockLabels"><span class="annot"><span class="annottext">getBlockLabels :: [SomeLabel] -&gt; [BlockId]
</span><a href="GHC.Cmm.Info.Build.html#getBlockLabels"><span class="hs-identifier hs-var hs-var">getBlockLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeLabel -&gt; Maybe BlockId) -&gt; [SomeLabel] -&gt; [BlockId]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">SomeLabel -&gt; Maybe BlockId
</span><a href="GHC.Cmm.Info.Build.html#getBlockLabel"><span class="hs-identifier hs-var">getBlockLabel</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-comment">-- | Return a @(Label,CLabel)@ pair for each labelled block of a 'CmmDecl',</span><span>
</span><span id="line-733"></span><span class="hs-comment">--   where the label is</span><span>
</span><span id="line-734"></span><span class="hs-comment">--   - the info label for a continuation or dynamic closure</span><span>
</span><span id="line-735"></span><span class="hs-comment">--   - the closure label for a top-level function (not a CAF)</span><span>
</span><span id="line-736"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#getLabelledBlocks"><span class="hs-identifier hs-type">getLabelledBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmDecl"><span class="hs-identifier hs-type">CmmDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-737"></span><span id="getLabelledBlocks"><span class="annot"><span class="annottext">getLabelledBlocks :: Platform -&gt; CmmDecl -&gt; [(SomeLabel, CAFfyLabel)]
</span><a href="GHC.Cmm.Info.Build.html#getLabelledBlocks"><span class="hs-identifier hs-var hs-var">getLabelledBlocks</span></a></span></span><span> </span><span id="local-6989586621682951357"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951357"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951358"><span class="annot"><span class="annottext">CmmDecl
</span><a href="#local-6989586621682951358"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmDecl
</span><a href="#local-6989586621682951358"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-738"></span><span>   </span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-type">CmmStaticsRaw</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CmmStatic]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-739"></span><span>   </span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a></span><span> </span><span id="local-6989586621682951360"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951360"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682951361"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951361"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; SomeLabel
</span><a href="GHC.Cmm.Info.Build.html#DeclLabel"><span class="hs-identifier hs-var">DeclLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951360"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var">mkCAFfyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951357"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951360"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>                                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isThunkRep"><span class="hs-identifier hs-var">isThunkRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable -&gt; SMRep
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951361"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>                                            </span><span class="hs-special">]</span><span>
</span><span id="line-742"></span><span>   </span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682951366"><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951366"><span class="hs-identifier hs-var">top_info</span></a></span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; SomeLabel
</span><a href="GHC.Cmm.Info.Build.html#BlockLabel"><span class="hs-identifier hs-var">BlockLabel</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951367"><span class="hs-identifier hs-var">blockId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951368"><span class="hs-identifier hs-var">caf_lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>                                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951367"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951367"><span class="hs-identifier hs-var">blockId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951369"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951369"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LabelMap CmmInfoTable -&gt; [(BlockId, CmmInfoTable)]
forall b. LabelMap b -&gt; [(BlockId, b)]
</span><a href="GHC.Cmm.Dataflow.Label.html#mapToList"><span class="hs-identifier hs-var">mapToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap -&gt; LabelMap CmmInfoTable
forall (f :: * -&gt; *). GenCmmTopInfo f -&gt; f CmmInfoTable
</span><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951366"><span class="hs-identifier hs-var">top_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951372"><span class="annot"><span class="annottext">rep :: SMRep
</span><a href="#local-6989586621682951372"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable -&gt; SMRep
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951369"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-745"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isStaticRep"><span class="hs-identifier hs-var">isStaticRep</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951372"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isThunkRep"><span class="hs-identifier hs-var">isThunkRep</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951372"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682951368"><span class="annot"><span class="annottext">caf_lbl :: CAFfyLabel
</span><a href="#local-6989586621682951368"><span class="hs-identifier hs-var hs-var">caf_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var">mkCAFfyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951357"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable -&gt; CLabel
</span><a href="GHC.Cmm.html#cit_lbl"><span class="hs-identifier hs-var">cit_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951369"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>                                       </span><span class="hs-special">]</span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">-- | Put the labelled blocks that we will be annotating with SRTs into</span><span>
</span><span id="line-750"></span><span class="hs-comment">-- dependency order.  This is so that we can process them one at a</span><span>
</span><span id="line-751"></span><span class="hs-comment">-- time, resolving references to earlier blocks to point to their</span><span>
</span><span id="line-752"></span><span class="hs-comment">-- SRTs. CAFs themselves are not included here; see 'getCAFs' below.</span><span>
</span><span id="line-753"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#depAnalSRTs"><span class="hs-identifier hs-type">depAnalSRTs</span></a></span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFEnv"><span class="hs-identifier hs-type">CAFEnv</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ 'CAFEnv' for procedures. From 'cafAnal'.</span></span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span> </span><span class="hs-comment">-- ^ CAFEnv for statics. Maps statics to the set of the</span><span>
</span><span id="line-757"></span><span>                       </span><span class="hs-comment">-- CAFfy things which they refer to. From 'cafAnalData'.</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDecl"><span class="hs-identifier hs-type">CmmDecl</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ the decls to analyse.</span></span><span>
</span><span id="line-759"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-760"></span><span id="depAnalSRTs"><span class="annot"><span class="annottext">depAnalSRTs :: Platform
-&gt; CAFEnv
-&gt; DataCAFEnv
-&gt; [CmmDecl]
-&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="GHC.Cmm.Info.Build.html#depAnalSRTs"><span class="hs-identifier hs-var hs-var">depAnalSRTs</span></a></span></span><span> </span><span id="local-6989586621682951378"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951379"><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951379"><span class="hs-identifier hs-var">cafEnv</span></a></span></span><span> </span><span id="local-6989586621682951380"><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">cafEnv_static</span></a></span></span><span> </span><span id="local-6989586621682951381"><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-761"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
-&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
forall b. String -&gt; SDoc -&gt; b -&gt; b
</span><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-var">srtTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;depAnalSRTs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;decls:&quot;</span></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [CmmDecl] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-762"></span><span>                           </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nodes:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [(SomeLabel, CAFfyLabel, Set CAFfyLabel)] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)
 -&gt; (SomeLabel, CAFfyLabel, Set CAFfyLabel))
-&gt; [Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
-&gt; [(SomeLabel, CAFfyLabel, Set CAFfyLabel)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)
-&gt; (SomeLabel, CAFfyLabel, Set CAFfyLabel)
forall key payload. Node key payload -&gt; payload
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var">node_payload</span></a></span><span> </span><span class="annot"><span class="annottext">[Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951383"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-763"></span><span>                           </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;graph:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951384"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951384"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-764"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-765"></span><span>  </span><span class="annot"><a href="#local-6989586621682951385"><span class="hs-identifier hs-type">labelledBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-766"></span><span>  </span><span id="local-6989586621682951385"><span class="annot"><span class="annottext">labelledBlocks :: [(SomeLabel, CAFfyLabel)]
</span><a href="#local-6989586621682951385"><span class="hs-identifier hs-var hs-var">labelledBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmDecl -&gt; [(SomeLabel, CAFfyLabel)])
-&gt; [CmmDecl] -&gt; [(SomeLabel, CAFfyLabel)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmDecl -&gt; [(SomeLabel, CAFfyLabel)]
</span><a href="GHC.Cmm.Info.Build.html#getLabelledBlocks"><span class="hs-identifier hs-var">getLabelledBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-767"></span><span>  </span><span class="annot"><a href="#local-6989586621682951387"><span class="hs-identifier hs-type">labelToBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span>
</span><span id="line-768"></span><span>  </span><span id="local-6989586621682951387"><span class="annot"><span class="annottext">labelToBlock :: Map CAFfyLabel SomeLabel
</span><a href="#local-6989586621682951387"><span class="hs-identifier hs-var hs-var">labelToBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map CAFfyLabel SomeLabel
 -&gt; (SomeLabel, CAFfyLabel) -&gt; Map CAFfyLabel SomeLabel)
-&gt; Map CAFfyLabel SomeLabel
-&gt; [(SomeLabel, CAFfyLabel)]
-&gt; Map CAFfyLabel SomeLabel
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682951388"><span class="annot"><span class="annottext">Map CAFfyLabel SomeLabel
</span><a href="#local-6989586621682951388"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951389"><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951389"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682951390"><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951390"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CAFfyLabel
-&gt; SomeLabel
-&gt; Map CAFfyLabel SomeLabel
-&gt; Map CAFfyLabel SomeLabel
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951390"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951389"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map CAFfyLabel SomeLabel
</span><a href="#local-6989586621682951388"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map CAFfyLabel SomeLabel
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[(SomeLabel, CAFfyLabel)]
</span><a href="#local-6989586621682951385"><span class="hs-identifier hs-var">labelledBlocks</span></a></span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-comment">-- the set of graph nodes. A node is identified by either a BlockLabel (in</span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-comment">-- the case of code) or a DeclLabel (in the case of static data).</span><span>
</span><span id="line-772"></span><span>  </span><span class="annot"><a href="#local-6989586621682951383"><span class="hs-identifier hs-type">nodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-773"></span><span>  </span><span id="local-6989586621682951383"><span class="annot"><span class="annottext">nodes :: [Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951383"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(SomeLabel, CAFfyLabel, Set CAFfyLabel)
-&gt; SomeLabel
-&gt; [SomeLabel]
-&gt; Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)
forall key payload. payload -&gt; key -&gt; [key] -&gt; Node key payload
</span><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951393"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951394"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951395"><span class="hs-identifier hs-var">cafs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951393"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-774"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CAFfyLabel -&gt; Maybe SomeLabel) -&gt; [CAFfyLabel] -&gt; [SomeLabel]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CAFfyLabel -&gt; Map CAFfyLabel SomeLabel -&gt; Maybe SomeLabel)
-&gt; Map CAFfyLabel SomeLabel -&gt; CAFfyLabel -&gt; Maybe SomeLabel
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">CAFfyLabel -&gt; Map CAFfyLabel SomeLabel -&gt; Maybe SomeLabel
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Map CAFfyLabel SomeLabel
</span><a href="#local-6989586621682951387"><span class="hs-identifier hs-var">labelToBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CAFfyLabel -&gt; [CAFfyLabel]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951395"><span class="hs-identifier hs-var">cafs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951393"><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951393"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951394"><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951394"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SomeLabel, CAFfyLabel)]
</span><a href="#local-6989586621682951385"><span class="hs-identifier hs-var">labelledBlocks</span></a></span><span>
</span><span id="line-776"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951399"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951399"><span class="hs-identifier hs-var">cafs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-777"></span><span>              </span><span class="hs-special">[</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951393"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-778"></span><span>                 </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#BlockLabel"><span class="hs-identifier hs-type">BlockLabel</span></a></span><span> </span><span id="local-6989586621682951400"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951400"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CAFEnv -&gt; Maybe (Set CAFfyLabel)
forall f. BlockId -&gt; FactBase f -&gt; Maybe f
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951400"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951379"><span class="hs-identifier hs-var">cafEnv</span></a></span><span>
</span><span id="line-779"></span><span>                 </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#DeclLabel"><span class="hs-identifier hs-type">DeclLabel</span></a></span><span> </span><span id="local-6989586621682951402"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951402"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; DataCAFEnv -&gt; Maybe (Set CAFfyLabel)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951402"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">cafEnv_static</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-780"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951395"><span class="annot"><span class="annottext">cafs' :: Set CAFfyLabel
</span><a href="#local-6989586621682951395"><span class="hs-identifier hs-var hs-var">cafs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CAFfyLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#delete"><span class="hs-identifier hs-var">Set.delete</span></a></span><span> </span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951394"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951399"><span class="hs-identifier hs-var">cafs</span></a></span><span>
</span><span id="line-781"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>  </span><span class="annot"><a href="#local-6989586621682951384"><span class="hs-identifier hs-type">graph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-784"></span><span>  </span><span id="local-6989586621682951384"><span class="annot"><span class="annottext">graph :: [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951384"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
-&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
forall key payload. Ord key =&gt; [Node key payload] -&gt; [SCC payload]
</span><a href="GHC.Data.Graph.Directed.html#stronglyConnCompFromEdgedVerticesOrd"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesOrd</span></a></span><span> </span><span class="annot"><span class="annottext">[Node SomeLabel (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951383"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span class="hs-comment">-- | Get @(Maybe Label, CAFfyLabel, Set CAFfyLabel)@ for each CAF block.</span><span>
</span><span id="line-787"></span><span class="hs-comment">-- The @Set CAFfyLabel@ represents the set of CAFfy things which this CAF's code</span><span>
</span><span id="line-788"></span><span class="hs-comment">-- depends upon.</span><span>
</span><span id="line-789"></span><span class="hs-comment">--</span><span>
</span><span id="line-790"></span><span class="hs-comment">--  - The 'Label' represents the entry code of the closure. This may be</span><span>
</span><span id="line-791"></span><span class="hs-comment">--    'Nothing' if it is a standard closure type (e.g. @stg_unpack_cstring@; see</span><span>
</span><span id="line-792"></span><span class="hs-comment">--    Note [unpack_cstring closures] in StgStdThunks.cmm).</span><span>
</span><span id="line-793"></span><span class="hs-comment">--  - The 'CAFLabel' is the label of the CAF closure.</span><span>
</span><span id="line-794"></span><span class="hs-comment">--  - The @Set CAFLabel@ is the set of CAFfy closures which should be included</span><span>
</span><span id="line-795"></span><span class="hs-comment">--    in the closure's SRT.</span><span>
</span><span id="line-796"></span><span class="hs-comment">--</span><span>
</span><span id="line-797"></span><span class="hs-comment">-- Note that CAFs are treated differently from other labelled blocks:</span><span>
</span><span id="line-798"></span><span class="hs-comment">--</span><span>
</span><span id="line-799"></span><span class="hs-comment">--  - we never shortcut a reference to a CAF to the contents of its</span><span>
</span><span id="line-800"></span><span class="hs-comment">--    SRT, since the point of SRTs is to keep CAFs alive.</span><span>
</span><span id="line-801"></span><span class="hs-comment">--</span><span>
</span><span id="line-802"></span><span class="hs-comment">--  - CAFs therefore don't take part in the dependency analysis in depAnalSRTs.</span><span>
</span><span id="line-803"></span><span class="hs-comment">--    instead we generate their SRTs after everything else.</span><span>
</span><span id="line-804"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#getCAFs"><span class="hs-identifier hs-type">getCAFs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFEnv"><span class="hs-identifier hs-type">CAFEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDecl"><span class="hs-identifier hs-type">CmmDecl</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-805"></span><span id="getCAFs"><span class="annot"><span class="annottext">getCAFs :: Platform
-&gt; CAFEnv
-&gt; [CmmDecl]
-&gt; [(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)]
</span><a href="GHC.Cmm.Info.Build.html#getCAFs"><span class="hs-identifier hs-var hs-var">getCAFs</span></a></span></span><span> </span><span id="local-6989586621682951405"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951405"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951406"><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951406"><span class="hs-identifier hs-var">cafEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmDecl -&gt; Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel))
-&gt; [CmmDecl] -&gt; [(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">CmmDecl -&gt; Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
</span><a href="#local-6989586621682951407"><span class="hs-identifier hs-var">getCAFLabel</span></a></span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-807"></span><span>    </span><span class="annot"><a href="#local-6989586621682951407"><span class="hs-identifier hs-type">getCAFLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmDecl"><span class="hs-identifier hs-type">CmmDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span>    </span><span id="local-6989586621682951407"><span class="annot"><span class="annottext">getCAFLabel :: CmmDecl -&gt; Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
</span><a href="#local-6989586621682951407"><span class="hs-identifier hs-var hs-var">getCAFLabel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682951408"><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951408"><span class="hs-identifier hs-var">top_info</span></a></span></span><span> </span><span id="local-6989586621682951409"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951409"><span class="hs-identifier hs-var">top_lbl</span></a></span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951410"><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951410"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951411"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951411"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap CmmInfoTable -&gt; Maybe CmmInfoTable
forall f. BlockId -&gt; FactBase f -&gt; Maybe f
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951410"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap -&gt; LabelMap CmmInfoTable
forall (f :: * -&gt; *). GenCmmTopInfo f -&gt; f CmmInfoTable
</span><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951408"><span class="hs-identifier hs-var">top_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951412"><span class="annot"><span class="annottext">rep :: SMRep
</span><a href="#local-6989586621682951412"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable -&gt; SMRep
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951411"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-812"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isStaticRep"><span class="hs-identifier hs-var">isStaticRep</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951412"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isThunkRep"><span class="hs-identifier hs-var">isThunkRep</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951412"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-813"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951414"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951414"><span class="hs-identifier hs-var">cafs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CAFEnv -&gt; Maybe (Set CAFfyLabel)
forall f. BlockId -&gt; FactBase f -&gt; Maybe f
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951410"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951406"><span class="hs-identifier hs-var">cafEnv</span></a></span><span>
</span><span id="line-814"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
-&gt; Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Maybe BlockId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951410"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var">mkCAFfyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951405"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951409"><span class="hs-identifier hs-var">top_lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951414"><span class="hs-identifier hs-var">cafs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-817"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>    </span><span class="annot"><a href="#local-6989586621682951407"><span class="hs-identifier hs-var">getCAFLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a></span><span> </span><span id="local-6989586621682951416"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951416"><span class="hs-identifier hs-var">top_lbl</span></a></span></span><span> </span><span id="local-6989586621682951417"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951417"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682951418"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682951418"><span class="hs-identifier hs-var">_ccs</span></a></span></span><span> </span><span id="local-6989586621682951419"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951419"><span class="hs-identifier hs-var">_payload</span></a></span></span><span> </span><span id="local-6989586621682951420"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951420"><span class="hs-identifier hs-var">_extras</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isThunkRep"><span class="hs-identifier hs-var">isThunkRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable -&gt; SMRep
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951417"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
-&gt; Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe BlockId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var">mkCAFfyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951405"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951416"><span class="hs-identifier hs-var">top_lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-824"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="#local-6989586621682951407"><span class="hs-identifier hs-var">getCAFLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-type">CmmStaticsRaw</span></a></span><span> </span><span id="local-6989586621682951421"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951421"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span> </span><span id="local-6989586621682951422"><span class="annot"><span class="annottext">[CmmStatic]
</span><a href="#local-6989586621682951422"><span class="hs-identifier hs-var">_payload</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe BlockId, CAFfyLabel, Set CAFfyLabel)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="hs-comment">-- | Get the list of blocks that correspond to the entry points for</span><span>
</span><span id="line-830"></span><span class="hs-comment">-- @FUN_STATIC@ closures.  These are the blocks for which if we have an</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- SRT we can merge it with the static closure. [FUN]</span><span>
</span><span id="line-832"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#getStaticFuns"><span class="hs-identifier hs-type">getStaticFuns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDecl"><span class="hs-identifier hs-type">CmmDecl</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-833"></span><span id="getStaticFuns"><span class="annot"><span class="annottext">getStaticFuns :: [CmmDecl] -&gt; [(BlockId, CLabel)]
</span><a href="GHC.Cmm.Info.Build.html#getStaticFuns"><span class="hs-identifier hs-var hs-var">getStaticFuns</span></a></span></span><span> </span><span id="local-6989586621682951424"><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951424"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951425"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951426"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682951427"><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951427"><span class="hs-identifier hs-var">top_info</span></a></span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951425"><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951425"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951424"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951428"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951428"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap CmmInfoTable -&gt; Maybe CmmInfoTable
forall f. BlockId -&gt; FactBase f -&gt; Maybe f
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951425"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap -&gt; LabelMap CmmInfoTable
forall (f :: * -&gt; *). GenCmmTopInfo f -&gt; f CmmInfoTable
</span><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951427"><span class="hs-identifier hs-var">top_info</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951429"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682951429"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmInfoTable -&gt; Maybe (Id, CostCentreStack)
</span><a href="GHC.Cmm.html#cit_clo"><span class="hs-identifier hs-var">cit_clo</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951428"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-838"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951431"><span class="annot"><span class="annottext">rep :: SMRep
</span><a href="#local-6989586621682951431"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable -&gt; SMRep
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951428"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-839"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isStaticRep"><span class="hs-identifier hs-var">isStaticRep</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951431"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isFunRep"><span class="hs-identifier hs-var">isFunRep</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951431"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-840"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682951426"><span class="annot"><span class="annottext">lbl :: CLabel
</span><a href="#local-6989586621682951426"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CafInfo -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkClosureLabel"><span class="hs-identifier hs-var">mkClosureLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682951429"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CafInfo
</span><a href="GHC.Types.Id.html#idCafInfo"><span class="hs-identifier hs-var">idCafInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682951429"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span class="hs-comment">-- | Maps labels from 'cafAnal' to the final CLabel that will appear</span><span>
</span><span id="line-845"></span><span class="hs-comment">-- in the SRT.</span><span>
</span><span id="line-846"></span><span class="hs-comment">--   - closures with singleton SRTs resolve to their single entry</span><span>
</span><span id="line-847"></span><span class="hs-comment">--   - closures with larger SRTs map to the label for that SRT</span><span>
</span><span id="line-848"></span><span class="hs-comment">--   - CAFs must not map to anything!</span><span>
</span><span id="line-849"></span><span class="hs-comment">--   - if a labels maps to Nothing, we found that this label's SRT</span><span>
</span><span id="line-850"></span><span class="hs-comment">--     is empty, so we don't need to refer to it from other SRTs.</span><span>
</span><span id="line-851"></span><span class="hs-keyword">type</span><span> </span><span id="SRTMap"><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTMap"><span class="hs-identifier hs-var">SRTMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="hs-comment">-- | Given 'SRTMap' of a module, returns the set of non-CAFFY names in the</span><span>
</span><span id="line-855"></span><span class="hs-comment">-- module.  Any 'Name's not in the set are CAFFY.</span><span>
</span><span id="line-856"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtMapNonCAFs"><span class="hs-identifier hs-type">srtMapNonCAFs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTMap"><span class="hs-identifier hs-type">SRTMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NonCaffySet"><span class="hs-identifier hs-type">NonCaffySet</span></a></span><span>
</span><span id="line-857"></span><span id="srtMapNonCAFs"><span class="annot"><span class="annottext">srtMapNonCAFs :: SRTMap -&gt; NonCaffySet
</span><a href="GHC.Cmm.Info.Build.html#srtMapNonCAFs"><span class="hs-identifier hs-var hs-var">srtMapNonCAFs</span></a></span></span><span> </span><span id="local-6989586621682951436"><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951436"><span class="hs-identifier hs-var">srtMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-858"></span><span>    </span><span class="annot"><span class="annottext">NameSet -&gt; NonCaffySet
</span><a href="GHC.Types.Name.Set.html#NonCaffySet"><span class="hs-identifier hs-var">NonCaffySet</span></a></span><span> </span><span class="annot"><span class="annottext">(NameSet -&gt; NonCaffySet) -&gt; NameSet -&gt; NonCaffySet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CAFfyLabel, Maybe SRTEntry) -&gt; Maybe Name)
-&gt; [(CAFfyLabel, Maybe SRTEntry)] -&gt; [Name]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(CAFfyLabel, Maybe SRTEntry) -&gt; Maybe Name
forall {a}. (CAFfyLabel, Maybe a) -&gt; Maybe Name
</span><a href="#local-6989586621682951439"><span class="hs-identifier hs-var">get_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRTMap -&gt; [(CAFfyLabel, Maybe SRTEntry)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951436"><span class="hs-identifier hs-var">srtMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-860"></span><span>    </span><span id="local-6989586621682951439"><span class="annot"><span class="annottext">get_name :: (CAFfyLabel, Maybe a) -&gt; Maybe Name
</span><a href="#local-6989586621682951439"><span class="hs-identifier hs-var hs-var">get_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span id="local-6989586621682951441"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951441"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe Name
</span><a href="GHC.Cmm.CLabel.html#hasHaskellName"><span class="hs-identifier hs-var">hasHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951441"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-861"></span><span>    </span><span class="annot"><a href="#local-6989586621682951439"><span class="hs-identifier hs-var">get_name</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951442"><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951442"><span class="hs-identifier hs-var">_l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951443"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682951443"><span class="hs-identifier hs-var">_srt_entry</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span class="annot"><span class="hs-comment">-- | Resolve a CAFfyLabel to its 'SRTEntry' using the 'SRTMap'.</span></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#resolveCAF"><span class="hs-identifier hs-type">resolveCAF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTMap"><span class="hs-identifier hs-type">SRTMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span>
</span><span id="line-865"></span><span id="resolveCAF"><span class="annot"><span class="annottext">resolveCAF :: Platform -&gt; SRTMap -&gt; CAFfyLabel -&gt; Maybe SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#resolveCAF"><span class="hs-identifier hs-var hs-var">resolveCAF</span></a></span></span><span> </span><span id="local-6989586621682951445"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951445"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682951446"><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951446"><span class="hs-identifier hs-var">srtMap</span></a></span></span><span> </span><span id="local-6989586621682951447"><span class="annot"><span class="annottext">lbl :: CAFfyLabel
</span><a href="#local-6989586621682951447"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span id="local-6989586621682951448"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951448"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-866"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Maybe SRTEntry -&gt; Maybe SRTEntry
forall b. String -&gt; SDoc -&gt; b -&gt; b
</span><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-var">srtTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;resolveCAF&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-string">&quot;l:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951445"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951448"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-string">&quot;resolved:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Maybe SRTEntry -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951445"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry
</span><a href="#local-6989586621682951449"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry
</span><a href="#local-6989586621682951449"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-868"></span><span>    </span><span id="local-6989586621682951449"><span class="annot"><span class="annottext">ret :: Maybe SRTEntry
</span><a href="#local-6989586621682951449"><span class="hs-identifier hs-var hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry -&gt; CAFfyLabel -&gt; SRTMap -&gt; Maybe SRTEntry
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#findWithDefault"><span class="hs-identifier hs-var">Map.findWithDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRTEntry -&gt; Maybe SRTEntry
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-var">SRTEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#toClosureLbl"><span class="hs-identifier hs-var">toClosureLbl</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951445"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951448"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951447"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951446"><span class="hs-identifier hs-var">srtMap</span></a></span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#anyCafRefs"><span class="hs-identifier hs-type">anyCafRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Id.Info.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a></span><span>
</span><span id="line-871"></span><span id="anyCafRefs"><span class="annot"><span class="annottext">anyCafRefs :: [CafInfo] -&gt; CafInfo
</span><a href="GHC.Cmm.Info.Build.html#anyCafRefs"><span class="hs-identifier hs-var hs-var">anyCafRefs</span></a></span></span><span> </span><span id="local-6989586621682951452"><span class="annot"><span class="annottext">[CafInfo]
</span><a href="#local-6989586621682951452"><span class="hs-identifier hs-var">caf_infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(CafInfo -&gt; Bool) -&gt; [CafInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">CafInfo -&gt; Bool
</span><a href="GHC.Types.Id.Info.html#mayHaveCafRefs"><span class="hs-identifier hs-var">mayHaveCafRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[CafInfo]
</span><a href="#local-6989586621682951452"><span class="hs-identifier hs-var">caf_infos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-872"></span><span>                         </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a></span><span>
</span><span id="line-873"></span><span>                         </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span class="hs-comment">-- | Attach SRTs to all info tables in the 'CmmDecl's, and add SRT</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- declarations to the 'ModuleSRTInfo'.</span><span>
</span><span id="line-877"></span><span class="hs-comment">--</span><span>
</span><span id="line-878"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#doSRTs"><span class="hs-identifier hs-type">doSRTs</span></a></span><span>
</span><span id="line-879"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Config.html#CmmConfig"><span class="hs-identifier hs-type">CmmConfig</span></a></span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFEnv"><span class="hs-identifier hs-type">CAFEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDecl"><span class="hs-identifier hs-type">CmmDecl</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ 'CAFEnv's and 'CmmDecl's for code blocks</span></span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFSet"><span class="hs-identifier hs-type">CAFSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmDataDecl"><span class="hs-identifier hs-type">CmmDataDecl</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ static data decls and their 'CAFSet's</span></span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span id="doSRTs"><span class="annot"><span class="annottext">doSRTs :: CmmConfig
-&gt; ModuleSRTInfo
-&gt; DUniqSupply
-&gt; [(CAFEnv, [CmmDecl])]
-&gt; [(Set CAFfyLabel, CmmDataDecl)]
-&gt; IO (ModuleSRTInfo, DUniqSupply, [CmmDeclSRTs])
</span><a href="GHC.Cmm.Info.Build.html#doSRTs"><span class="hs-identifier hs-var hs-var">doSRTs</span></a></span></span><span> </span><span id="local-6989586621682951457"><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951457"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682951458"><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951458"><span class="hs-identifier hs-var">moduleSRTInfo</span></a></span></span><span> </span><span id="local-6989586621682951459"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682951459"><span class="hs-identifier hs-var">dus0</span></a></span></span><span> </span><span id="local-6989586621682951460"><span class="annot"><span class="annottext">[(CAFEnv, [CmmDecl])]
</span><a href="#local-6989586621682951460"><span class="hs-identifier hs-var">procs</span></a></span></span><span> </span><span id="local-6989586621682951461"><span class="annot"><span class="annottext">[(Set CAFfyLabel, CmmDataDecl)]
</span><a href="#local-6989586621682951461"><span class="hs-identifier hs-var">data_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951462"><span class="annot"><span class="annottext">origtag :: Char
</span><a href="#local-6989586621682951462"><span class="hs-identifier hs-var hs-var hs-var">origtag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DUniqSupply -&gt; Char
</span><a href="GHC.Types.Unique.DSM.html#getTagDUniqSupply"><span class="hs-identifier hs-var">getTagDUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682951459"><span class="hs-identifier hs-var">dus0</span></a></span><span>
</span><span id="line-889"></span><span>      </span><span id="local-6989586621682951464"><span class="annot"><span class="annottext">profile :: Profile
</span><a href="#local-6989586621682951464"><span class="hs-identifier hs-var hs-var hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmConfig -&gt; Profile
</span><a href="GHC.Cmm.Config.html#cmmProfile"><span class="hs-identifier hs-var">cmmProfile</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951457"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-890"></span><span>      </span><span id="local-6989586621682951466"><span class="annot"><span class="annottext">dus1 :: DUniqSupply
</span><a href="#local-6989586621682951466"><span class="hs-identifier hs-var hs-var hs-var">dus1</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; DUniqSupply -&gt; DUniqSupply
</span><a href="GHC.Types.Unique.DSM.html#newTagDUniqSupply"><span class="hs-identifier hs-var">newTagDUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'u'</span></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682951459"><span class="hs-identifier hs-var">dus0</span></a></span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-comment">-- Ignore the original grouping of decls, and combine all the</span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-comment">-- CAFEnvs into a single CAFEnv.</span><span>
</span><span id="line-894"></span><span>      </span><span class="annot"><a href="#local-6989586621682951468"><span class="hs-identifier hs-type">static_data_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#DataCAFEnv"><span class="hs-identifier hs-type">DataCAFEnv</span></a></span><span>
</span><span id="line-895"></span><span>      </span><span id="local-6989586621682951468"><span class="annot"><span class="annottext">static_data_env :: DataCAFEnv
</span><a href="#local-6989586621682951468"><span class="hs-identifier hs-var hs-var hs-var">static_data_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-896"></span><span>        </span><span class="annot"><span class="annottext">[(CLabel, Set CAFfyLabel)] -&gt; DataCAFEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(CLabel, Set CAFfyLabel)] -&gt; DataCAFEnv)
-&gt; [(CLabel, Set CAFfyLabel)] -&gt; DataCAFEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-897"></span><span>        </span><span class="annot"><span class="annottext">(((Set CAFfyLabel, CmmDataDecl) -&gt; (CLabel, Set CAFfyLabel))
 -&gt; [(Set CAFfyLabel, CmmDataDecl)] -&gt; [(CLabel, Set CAFfyLabel)])
-&gt; [(Set CAFfyLabel, CmmDataDecl)]
-&gt; ((Set CAFfyLabel, CmmDataDecl) -&gt; (CLabel, Set CAFfyLabel))
-&gt; [(CLabel, Set CAFfyLabel)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((Set CAFfyLabel, CmmDataDecl) -&gt; (CLabel, Set CAFfyLabel))
-&gt; [(Set CAFfyLabel, CmmDataDecl)] -&gt; [(CLabel, Set CAFfyLabel)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[(Set CAFfyLabel, CmmDataDecl)]
</span><a href="#local-6989586621682951461"><span class="hs-identifier hs-var">data_</span></a></span><span> </span><span class="annot"><span class="annottext">(((Set CAFfyLabel, CmmDataDecl) -&gt; (CLabel, Set CAFfyLabel))
 -&gt; [(CLabel, Set CAFfyLabel)])
-&gt; ((Set CAFfyLabel, CmmDataDecl) -&gt; (CLabel, Set CAFfyLabel))
-&gt; [(CLabel, Set CAFfyLabel)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-898"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682951470"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951470"><span class="hs-identifier hs-var">set</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951471"><span class="annot"><span class="annottext">CmmDataDecl
</span><a href="#local-6989586621682951471"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-899"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmDataDecl
</span><a href="#local-6989586621682951471"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-900"></span><span>            </span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682951472"><span class="annot"><span class="annottext">Void
</span><a href="#local-6989586621682951472"><span class="hs-identifier hs-var">void</span></a></span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Void
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Void
</span><a href="#local-6989586621682951472"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-901"></span><span>            </span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951473"><span class="annot"><span class="annottext">GenCmmStatics 'False
</span><a href="#local-6989586621682951473"><span class="hs-identifier hs-var">static</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-902"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenCmmStatics 'False
</span><a href="#local-6989586621682951473"><span class="hs-identifier hs-var">static</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-903"></span><span>                </span><span class="annot"><a href="GHC.Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a></span><span> </span><span id="local-6989586621682951475"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951475"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951475"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951470"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>                </span><span class="annot"><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-type">CmmStaticsRaw</span></a></span><span> </span><span id="local-6989586621682951476"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951476"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="annot"><span class="annottext">[CmmStatic]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951476"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951470"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682951477"><span class="annot"><span class="annottext">[CAFEnv]
</span><a href="#local-6989586621682951477"><span class="hs-identifier hs-var hs-var">proc_envs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951478"><span class="annot"><span class="annottext">[[CmmDecl]]
</span><a href="#local-6989586621682951478"><span class="hs-identifier hs-var hs-var">procss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CAFEnv, [CmmDecl])] -&gt; ([CAFEnv], [[CmmDecl]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(CAFEnv, [CmmDecl])]
</span><a href="#local-6989586621682951460"><span class="hs-identifier hs-var">procs</span></a></span><span>
</span><span id="line-907"></span><span>      </span><span id="local-6989586621682951480"><span class="annot"><span class="annottext">cafEnv :: CAFEnv
</span><a href="#local-6989586621682951480"><span class="hs-identifier hs-var hs-var hs-var">cafEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CAFEnv] -&gt; CAFEnv
forall a. [LabelMap a] -&gt; LabelMap a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapUnions"><span class="hs-identifier hs-var">mapUnions</span></a></span><span> </span><span class="annot"><span class="annottext">[CAFEnv]
</span><a href="#local-6989586621682951477"><span class="hs-identifier hs-var">proc_envs</span></a></span><span>
</span><span id="line-908"></span><span>      </span><span id="local-6989586621682951482"><span class="annot"><span class="annottext">decls :: [CmmDecl]
</span><a href="#local-6989586621682951482"><span class="hs-identifier hs-var hs-var hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Set CAFfyLabel, CmmDataDecl) -&gt; CmmDecl)
-&gt; [(Set CAFfyLabel, CmmDataDecl)] -&gt; [CmmDecl]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmDataDecl -&gt; CmmDecl
forall d h g. GenCmmDataDecl d -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#cmmDataDeclCmmDecl"><span class="hs-identifier hs-var">cmmDataDeclCmmDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmDataDecl -&gt; CmmDecl)
-&gt; ((Set CAFfyLabel, CmmDataDecl) -&gt; CmmDataDecl)
-&gt; (Set CAFfyLabel, CmmDataDecl)
-&gt; CmmDecl
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set CAFfyLabel, CmmDataDecl) -&gt; CmmDataDecl
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Set CAFfyLabel, CmmDataDecl)]
</span><a href="#local-6989586621682951461"><span class="hs-identifier hs-var">data_</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmDecl] -&gt; [CmmDecl] -&gt; [CmmDecl]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[CmmDecl]] -&gt; [CmmDecl]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[CmmDecl]]
</span><a href="#local-6989586621682951478"><span class="hs-identifier hs-var">procss</span></a></span><span>
</span><span id="line-909"></span><span>      </span><span id="local-6989586621682951487"><span class="annot"><span class="annottext">staticFuns :: LabelMap CLabel
</span><a href="#local-6989586621682951487"><span class="hs-identifier hs-var hs-var hs-var">staticFuns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BlockId, CLabel)] -&gt; LabelMap CLabel
forall v. [(BlockId, v)] -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapFromList"><span class="hs-identifier hs-var">mapFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CmmDecl] -&gt; [(BlockId, CLabel)]
</span><a href="GHC.Cmm.Info.Build.html#getStaticFuns"><span class="hs-identifier hs-var">getStaticFuns</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951482"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>      </span><span id="local-6989586621682951489"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmConfig -&gt; Platform
</span><a href="GHC.Cmm.Config.html#cmmPlatform"><span class="hs-identifier hs-var">cmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951457"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-comment">-- Put the decls in dependency order. Why? So that we can implement</span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-comment">-- [Inline] and [Filter].  If we need to refer to an SRT that has</span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-comment">-- a single entry, we use the entry itself, which means that we</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-comment">-- don't need to generate the singleton SRT in the first place.  But</span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-comment">-- to do this we need to process blocks before things that depend on</span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-comment">-- them.</span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-920"></span><span>    </span><span class="annot"><a href="#local-6989586621682951491"><span class="hs-identifier hs-type">sccs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-921"></span><span>    </span><span id="local-6989586621682951491"><span class="annot"><span class="annottext">sccs :: [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951491"><span class="hs-identifier hs-var hs-var hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">depAnalSRTs</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; CAFEnv
-&gt; DataCAFEnv
-&gt; [CmmDecl]
-&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="GHC.Cmm.Info.Build.html#depAnalSRTs"><span class="hs-identifier hs-var">depAnalSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951480"><span class="hs-identifier hs-var">cafEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951468"><span class="hs-identifier hs-var">static_data_env</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951482"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-922"></span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><a href="#local-6989586621682951492"><span class="hs-identifier hs-type">cafsWithSRTs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-924"></span><span>    </span><span id="local-6989586621682951492"><span class="annot"><span class="annottext">cafsWithSRTs :: [(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951492"><span class="hs-identifier hs-var hs-var hs-var">cafsWithSRTs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; CAFEnv
-&gt; [CmmDecl]
-&gt; [(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)]
</span><a href="GHC.Cmm.Info.Build.html#getCAFs"><span class="hs-identifier hs-var">getCAFs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CAFEnv
</span><a href="#local-6989586621682951480"><span class="hs-identifier hs-var">cafEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951482"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; String -&gt; SDoc -&gt; f ()
</span><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-var">srtTraceM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doSRTs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;data:&quot;</span></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [(Set CAFfyLabel, CmmDataDecl)] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[(Set CAFfyLabel, CmmDataDecl)]
</span><a href="#local-6989586621682951461"><span class="hs-identifier hs-var">data_</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-927"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;procs:&quot;</span></span><span>           </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [(CAFEnv, [CmmDecl])] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[(CAFEnv, [CmmDecl])]
</span><a href="#local-6989586621682951460"><span class="hs-identifier hs-var">procs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-928"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;static_data_env:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; DataCAFEnv -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951468"><span class="hs-identifier hs-var">static_data_env</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-929"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sccs:&quot;</span></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951491"><span class="hs-identifier hs-var">sccs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-930"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cafsWithSRTs:&quot;</span></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe BlockId, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951492"><span class="hs-identifier hs-var">cafsWithSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>  </span><span class="hs-comment">-- On each strongly-connected group of decls, construct the SRT</span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-comment">-- closures and the SRT fields for info tables.</span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682951494"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-935"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- generated SRTs</span><span>
</span><span id="line-936"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- SRT fields for info tables</span><span>
</span><span id="line-937"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- SRTs to attach to static functions</span><span>
</span><span id="line-938"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a></span><span>                </span><span class="hs-comment">-- Whether the group has CAF references</span><span>
</span><span id="line-939"></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682951494"><span class="annot"><span class="annottext">[([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
  CafInfo)]
</span><a href="#local-6989586621682951494"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951495"><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951495"><span class="hs-identifier hs-var hs-var">moduleSRTInfo'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951496"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682951496"><span class="hs-identifier hs-var hs-var">dus2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-942"></span><span>        </span><span class="annot"><span class="annottext">DUniqSupply
-&gt; UniqDSM
     ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
        CafInfo)],
      ModuleSRTInfo)
-&gt; (([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
       CafInfo)],
     ModuleSRTInfo),
    DUniqSupply)
forall a. DUniqSupply -&gt; UniqDSM a -&gt; (a, DUniqSupply)
</span><a href="GHC.Types.Unique.DSM.html#runUniqueDSM"><span class="hs-identifier hs-var">runUniqueDSM</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682951466"><span class="hs-identifier hs-var">dus1</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqDSM
   ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)],
    ModuleSRTInfo)
 -&gt; (([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
        CafInfo)],
      ModuleSRTInfo),
     DUniqSupply))
-&gt; UniqDSM
     ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
        CafInfo)],
      ModuleSRTInfo)
-&gt; (([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
       CafInfo)],
     ModuleSRTInfo),
    DUniqSupply)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-943"></span><span>        </span><span class="annot"><span class="annottext">(StateT
   ModuleSRTInfo
   UniqDSM
   [([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
     CafInfo)]
 -&gt; ModuleSRTInfo
 -&gt; UniqDSM
      ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
         CafInfo)],
       ModuleSRTInfo))
-&gt; ModuleSRTInfo
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     [([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
       CafInfo)]
-&gt; UniqDSM
     ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
        CafInfo)],
      ModuleSRTInfo)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT
  ModuleSRTInfo
  UniqDSM
  [([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
    CafInfo)]
-&gt; ModuleSRTInfo
-&gt; UniqDSM
     ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
        CafInfo)],
      ModuleSRTInfo)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Lazy.html#runStateT"><span class="hs-identifier hs-var">runStateT</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951458"><span class="hs-identifier hs-var">moduleSRTInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT
   ModuleSRTInfo
   UniqDSM
   [([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
     CafInfo)]
 -&gt; UniqDSM
      ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
         CafInfo)],
       ModuleSRTInfo))
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     [([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
       CafInfo)]
-&gt; UniqDSM
     ([([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
        CafInfo)],
      ModuleSRTInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-944"></span><span>          </span><span id="local-6989586621682951499"><span class="annot"><a href="#local-6989586621682951499"><span class="hs-identifier hs-var">nonCAFs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)
 -&gt; StateT
      ModuleSRTInfo
      UniqDSM
      ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
       CafInfo))
-&gt; [SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     [([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
       CafInfo)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmConfig
-&gt; LabelMap CLabel
-&gt; DataCAFEnv
-&gt; SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
</span><a href="GHC.Cmm.Info.Build.html#doSCC"><span class="hs-identifier hs-var">doSCC</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951457"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951487"><span class="hs-identifier hs-var">staticFuns</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951468"><span class="hs-identifier hs-var">static_data_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951491"><span class="hs-identifier hs-var">sccs</span></a></span><span>
</span><span id="line-945"></span><span>          </span><span id="local-6989586621682951502"><span class="annot"><a href="#local-6989586621682951502"><span class="hs-identifier hs-var">cAFs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682951492"><span class="hs-identifier hs-type">cafsWithSRTs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682951504"><span class="annot"><span class="annottext">Maybe BlockId
</span><a href="#local-6989586621682951504"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951505"><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951505"><span class="hs-identifier hs-var">cafLbl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951506"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951506"><span class="hs-identifier hs-var">cafs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-946"></span><span>            </span><span class="annot"><span class="annottext">CmmConfig
-&gt; LabelMap CLabel
-&gt; [SomeLabel]
-&gt; [CAFfyLabel]
-&gt; Bool
-&gt; Set CAFfyLabel
-&gt; DataCAFEnv
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
</span><a href="GHC.Cmm.Info.Build.html#oneSRT"><span class="hs-identifier hs-var">oneSRT</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951457"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951487"><span class="hs-identifier hs-var">staticFuns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockId -&gt; SomeLabel) -&gt; [BlockId] -&gt; [SomeLabel]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; SomeLabel
</span><a href="GHC.Cmm.Info.Build.html#BlockLabel"><span class="hs-identifier hs-var">BlockLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe BlockId -&gt; [BlockId]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe BlockId
</span><a href="#local-6989586621682951504"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951505"><span class="hs-identifier hs-var">cafLbl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-947"></span><span>                   </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-comment">{-is a CAF-}</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951506"><span class="hs-identifier hs-var">cafs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951468"><span class="hs-identifier hs-var">static_data_env</span></a></span><span>
</span><span id="line-948"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682951499"><span class="hs-identifier hs-type">nonCAFs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682951502"><span class="hs-identifier hs-type">cAFs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682951509"><span class="annot"><span class="annottext">[[CmmDeclSRTs]]
</span><a href="#local-6989586621682951509"><span class="hs-identifier hs-var hs-var">srt_declss</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951510"><span class="annot"><span class="annottext">[[(BlockId, CLabel)]]
</span><a href="#local-6989586621682951510"><span class="hs-identifier hs-var hs-var">pairs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951511"><span class="annot"><span class="annottext">[[(BlockId, [SRTEntry])]]
</span><a href="#local-6989586621682951511"><span class="hs-identifier hs-var hs-var">funSRTs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951512"><span class="annot"><span class="annottext">[CafInfo]
</span><a href="#local-6989586621682951512"><span class="hs-identifier hs-var hs-var">has_caf_refs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
  CafInfo)]
-&gt; ([[CmmDeclSRTs]], [[(BlockId, CLabel)]],
    [[(BlockId, [SRTEntry])]], [CafInfo])
forall a b c d. [(a, b, c, d)] -&gt; ([a], [b], [c], [d])
</span><span class="hs-identifier hs-var">unzip4</span></span><span> </span><span class="annot"><span class="annottext">[([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
  CafInfo)]
</span><a href="#local-6989586621682951494"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-951"></span><span>      </span><span id="local-6989586621682951514"><span class="annot"><span class="annottext">srt_decls :: [CmmDeclSRTs]
</span><a href="#local-6989586621682951514"><span class="hs-identifier hs-var hs-var hs-var">srt_decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[CmmDeclSRTs]] -&gt; [CmmDeclSRTs]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[CmmDeclSRTs]]
</span><a href="#local-6989586621682951509"><span class="hs-identifier hs-var">srt_declss</span></a></span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-comment">-- Next, update the info tables with the SRTs</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-955"></span><span>    </span><span id="local-6989586621682951516"><span class="annot"><span class="annottext">srtFieldMap :: LabelMap CLabel
</span><a href="#local-6989586621682951516"><span class="hs-identifier hs-var hs-var hs-var">srtFieldMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BlockId, CLabel)] -&gt; LabelMap CLabel
forall v. [(BlockId, v)] -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapFromList"><span class="hs-identifier hs-var">mapFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[(BlockId, CLabel)]] -&gt; [(BlockId, CLabel)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[(BlockId, CLabel)]]
</span><a href="#local-6989586621682951510"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>    </span><span id="local-6989586621682951518"><span class="annot"><span class="annottext">funSRTMap :: LabelMap [SRTEntry]
</span><a href="#local-6989586621682951518"><span class="hs-identifier hs-var hs-var hs-var">funSRTMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BlockId, [SRTEntry])] -&gt; LabelMap [SRTEntry]
forall v. [(BlockId, v)] -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapFromList"><span class="hs-identifier hs-var">mapFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[(BlockId, [SRTEntry])]] -&gt; [(BlockId, [SRTEntry])]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[(BlockId, [SRTEntry])]]
</span><a href="#local-6989586621682951511"><span class="hs-identifier hs-var">funSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>    </span><span id="local-6989586621682951519"><span class="annot"><span class="annottext">has_caf_refs' :: CafInfo
</span><a href="#local-6989586621682951519"><span class="hs-identifier hs-var hs-var hs-var">has_caf_refs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CafInfo] -&gt; CafInfo
</span><a href="GHC.Cmm.Info.Build.html#anyCafRefs"><span class="hs-identifier hs-var">anyCafRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[CafInfo]
</span><a href="#local-6989586621682951512"><span class="hs-identifier hs-var">has_caf_refs</span></a></span><span>
</span><span id="line-958"></span><span>    </span><span id="local-6989586621682951520"><span class="annot"><span class="annottext">decls' :: [CmmDeclSRTs]
</span><a href="#local-6989586621682951520"><span class="hs-identifier hs-var hs-var hs-var">decls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-959"></span><span>      </span><span class="annot"><span class="annottext">(CmmDecl -&gt; [CmmDeclSRTs]) -&gt; [CmmDecl] -&gt; [CmmDeclSRTs]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile
-&gt; LabelMap CLabel
-&gt; LabelMap [SRTEntry]
-&gt; CafInfo
-&gt; CmmDecl
-&gt; [CmmDeclSRTs]
</span><a href="GHC.Cmm.Info.Build.html#updInfoSRTs"><span class="hs-identifier hs-var">updInfoSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951464"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951516"><span class="hs-identifier hs-var">srtFieldMap</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap [SRTEntry]
</span><a href="#local-6989586621682951518"><span class="hs-identifier hs-var">funSRTMap</span></a></span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="#local-6989586621682951519"><span class="hs-identifier hs-var">has_caf_refs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmDecl]
</span><a href="#local-6989586621682951482"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span>  </span><span class="hs-comment">-- Finally update CafInfos for raw static literals (CmmStaticsRaw). Those are</span><span>
</span><span id="line-962"></span><span>  </span><span class="hs-comment">-- not analysed in oneSRT so we never add entries for them to the SRTMap.</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951522"><span class="annot"><span class="annottext">srtMap_w_raws :: SRTMap
</span><a href="#local-6989586621682951522"><span class="hs-identifier hs-var hs-var">srtMap_w_raws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-964"></span><span>        </span><span class="annot"><span class="annottext">(SRTMap -&gt; (Set CAFfyLabel, CmmDataDecl) -&gt; SRTMap)
-&gt; SRTMap -&gt; [(Set CAFfyLabel, CmmDataDecl)] -&gt; SRTMap
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682951523"><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951523"><span class="hs-identifier hs-var">srtMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTMap"><span class="hs-identifier hs-type">SRTMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951524"><span class="annot"><span class="annottext">CmmDataDecl
</span><a href="#local-6989586621682951524"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-965"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmDataDecl
</span><a href="#local-6989586621682951524"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-966"></span><span>                    </span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-967"></span><span>                      </span><span class="hs-comment">-- already updated by oneSRT</span><span>
</span><span id="line-968"></span><span>                      </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951523"><span class="hs-identifier hs-var">srtMap</span></a></span><span>
</span><span id="line-969"></span><span>                    </span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-type">CmmStaticsRaw</span></a></span><span> </span><span id="local-6989586621682951526"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951526"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="annot"><span class="annottext">[CmmStatic]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-970"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#isIdLabel"><span class="hs-identifier hs-var">isIdLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951526"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#isTickyLabel"><span class="hs-identifier hs-var">isTickyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951526"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-971"></span><span>                          </span><span class="hs-comment">-- Raw data are not analysed by oneSRT and they can't</span><span>
</span><span id="line-972"></span><span>                          </span><span class="hs-comment">-- be CAFFY.</span><span>
</span><span id="line-973"></span><span>                          </span><span class="hs-comment">-- See Note [Ticky labels in SRT analysis] above for</span><span>
</span><span id="line-974"></span><span>                          </span><span class="hs-comment">-- why we exclude ticky labels here.</span><span>
</span><span id="line-975"></span><span>                          </span><span class="annot"><span class="annottext">CAFfyLabel -&gt; Maybe SRTEntry -&gt; SRTMap -&gt; SRTMap
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CAFfyLabel
</span><a href="GHC.Cmm.Info.Build.html#mkCAFfyLabel"><span class="hs-identifier hs-var">mkCAFfyLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951526"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951523"><span class="hs-identifier hs-var">srtMap</span></a></span><span>
</span><span id="line-976"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-977"></span><span>                          </span><span class="hs-comment">-- Not an IdLabel, ignore</span><span>
</span><span id="line-978"></span><span>                          </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951523"><span class="hs-identifier hs-var">srtMap</span></a></span><span>
</span><span id="line-979"></span><span>                    </span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682951529"><span class="annot"><span class="annottext">Void
</span><a href="#local-6989586621682951529"><span class="hs-identifier hs-var">void</span></a></span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Void
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Void
</span><a href="#local-6989586621682951529"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; SRTMap
</span><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951495"><span class="hs-identifier hs-var">moduleSRTInfo'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Set CAFfyLabel, CmmDataDecl)]
</span><a href="#local-6989586621682951461"><span class="hs-identifier hs-var">data_</span></a></span><span>
</span><span id="line-981"></span><span>      </span><span id="local-6989586621682951530"><span class="annot"><span class="annottext">dus3 :: DUniqSupply
</span><a href="#local-6989586621682951530"><span class="hs-identifier hs-var hs-var">dus3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; DUniqSupply -&gt; DUniqSupply
</span><a href="GHC.Types.Unique.DSM.html#newTagDUniqSupply"><span class="hs-identifier hs-var">newTagDUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682951462"><span class="hs-identifier hs-var">origtag</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682951496"><span class="hs-identifier hs-var">dus2</span></a></span><span> </span><span class="hs-comment">-- restore original tag</span><span>
</span><span id="line-982"></span><span>  </span><span class="annot"><span class="annottext">(ModuleSRTInfo, DUniqSupply, [CmmDeclSRTs])
-&gt; IO (ModuleSRTInfo, DUniqSupply, [CmmDeclSRTs])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951495"><span class="hs-identifier hs-var">moduleSRTInfo'</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682951522"><span class="hs-identifier hs-type">srtMap_w_raws</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682951530"><span class="hs-identifier hs-var">dus3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CmmDeclSRTs]
</span><a href="#local-6989586621682951514"><span class="hs-identifier hs-var">srt_decls</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmDeclSRTs] -&gt; [CmmDeclSRTs] -&gt; [CmmDeclSRTs]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CmmDeclSRTs]
</span><a href="#local-6989586621682951520"><span class="hs-identifier hs-var">decls'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span class="annot"><span class="hs-comment">-- | Build the SRT for a strongly-connected component of blocks.</span></span><span>
</span><span id="line-986"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#doSCC"><span class="hs-identifier hs-type">doSCC</span></a></span><span>
</span><span id="line-987"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Config.html#CmmConfig"><span class="hs-identifier hs-type">CmmConfig</span></a></span><span>
</span><span id="line-988"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ which blocks are static function entry points</span></span><span>
</span><span id="line-989"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#DataCAFEnv"><span class="hs-identifier hs-type">DataCAFEnv</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ static data</span></span><span>
</span><span id="line-990"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Lazy.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span>
</span><span id="line-992"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- generated SRTs</span><span>
</span><span id="line-993"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- SRT fields for info tables</span><span>
</span><span id="line-994"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- SRTs to attach to static functions</span><span>
</span><span id="line-995"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a></span><span>                </span><span class="hs-comment">-- Whether the group has CAF references</span><span>
</span><span id="line-996"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span id="doSCC"><span class="annot"><span class="annottext">doSCC :: CmmConfig
-&gt; LabelMap CLabel
-&gt; DataCAFEnv
-&gt; SCC (SomeLabel, CAFfyLabel, Set CAFfyLabel)
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
</span><a href="GHC.Cmm.Info.Build.html#doSCC"><span class="hs-identifier hs-var hs-var">doSCC</span></a></span></span><span> </span><span id="local-6989586621682951531"><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951531"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682951532"><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951532"><span class="hs-identifier hs-var">staticFuns</span></a></span></span><span> </span><span id="local-6989586621682951533"><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951533"><span class="hs-identifier hs-var">static_data_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951535"><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951535"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951536"><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951536"><span class="hs-identifier hs-var">cafLbl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951537"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951537"><span class="hs-identifier hs-var">cafs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-999"></span><span>  </span><span class="annot"><span class="annottext">CmmConfig
-&gt; LabelMap CLabel
-&gt; [SomeLabel]
-&gt; [CAFfyLabel]
-&gt; Bool
-&gt; Set CAFfyLabel
-&gt; DataCAFEnv
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
</span><a href="GHC.Cmm.Info.Build.html#oneSRT"><span class="hs-identifier hs-var">oneSRT</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951531"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951532"><span class="hs-identifier hs-var">staticFuns</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SomeLabel
</span><a href="#local-6989586621682951535"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951536"><span class="hs-identifier hs-var">cafLbl</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951537"><span class="hs-identifier hs-var">cafs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951533"><span class="hs-identifier hs-var">static_data_env</span></a></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#doSCC"><span class="hs-identifier hs-var">doSCC</span></a></span><span> </span><span id="local-6989586621682951538"><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951538"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682951539"><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951539"><span class="hs-identifier hs-var">staticFuns</span></a></span></span><span> </span><span id="local-6989586621682951540"><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951540"><span class="hs-identifier hs-var">static_data_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621682951542"><span class="annot"><span class="annottext">[(SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951542"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-comment">-- build a single SRT for the whole cycle, see Note [recursive SRTs]</span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951543"><span class="annot"><span class="annottext">[SomeLabel]
</span><a href="#local-6989586621682951543"><span class="hs-identifier hs-var">lbls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951544"><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951544"><span class="hs-identifier hs-var">caf_lbls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951545"><span class="annot"><span class="annottext">[Set CAFfyLabel]
</span><a href="#local-6989586621682951545"><span class="hs-identifier hs-var">cafsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SomeLabel, CAFfyLabel, Set CAFfyLabel)]
-&gt; ([SomeLabel], [CAFfyLabel], [Set CAFfyLabel])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">[(SomeLabel, CAFfyLabel, Set CAFfyLabel)]
</span><a href="#local-6989586621682951542"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-1004"></span><span>      </span><span id="local-6989586621682951547"><span class="annot"><span class="annottext">cafs :: Set CAFfyLabel
</span><a href="#local-6989586621682951547"><span class="hs-identifier hs-var hs-var">cafs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set CAFfyLabel] -&gt; Set CAFfyLabel
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">Set.unions</span></a></span><span> </span><span class="annot"><span class="annottext">[Set CAFfyLabel]
</span><a href="#local-6989586621682951545"><span class="hs-identifier hs-var">cafsets</span></a></span><span>
</span><span id="line-1005"></span><span>  </span><span class="annot"><span class="annottext">CmmConfig
-&gt; LabelMap CLabel
-&gt; [SomeLabel]
-&gt; [CAFfyLabel]
-&gt; Bool
-&gt; Set CAFfyLabel
-&gt; DataCAFEnv
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
</span><a href="GHC.Cmm.Info.Build.html#oneSRT"><span class="hs-identifier hs-var">oneSRT</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951538"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951539"><span class="hs-identifier hs-var">staticFuns</span></a></span><span> </span><span class="annot"><span class="annottext">[SomeLabel]
</span><a href="#local-6989586621682951543"><span class="hs-identifier hs-var">lbls</span></a></span><span> </span><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951544"><span class="hs-identifier hs-var">caf_lbls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951547"><span class="hs-identifier hs-var">cafs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951540"><span class="hs-identifier hs-var">static_data_env</span></a></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span class="hs-comment">{- Note [recursive SRTs]
   ~~~~~~~~~~~~~~~~~~~~~
If the dependency analyser has found us a recursive group of
declarations, then we build a single SRT for the whole group, on the
grounds that everything in the group is reachable from everything
else, so we lose nothing by having a single SRT.

However, there are a couple of wrinkles to be aware of.

* The Set CAFfyLabel for this SRT will contain labels in the group
  itself. The SRTMap will therefore not contain entries for these labels
  yet, so we can't turn them into SRTEntries using resolveCAF. BUT we
  can just remove recursive references from the Set CAFLabel before
  generating the SRT - the group SRT will consist of the union of the SRTs of
  each of group's constituents minus recursive references.

* That is, EXCEPT for static function closures and static data constructor
  applications. For the same reason described in Note [No static object
  resurrection], we cannot omit references to static function closures and
  constructor applications.

  But, since we will merge the SRT with one of the static function
  closures (see [FUN]), we can omit references to *that* static
  function closure from the SRT.

* Similarly, we must reintroduce recursive references to static data
  constructor applications into the group's SRT.
-}</span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span class="annot"><span class="hs-comment">-- | Build an SRT for a set of blocks</span></span><span>
</span><span id="line-1038"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#oneSRT"><span class="hs-identifier hs-type">oneSRT</span></a></span><span>
</span><span id="line-1039"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Config.html#CmmConfig"><span class="hs-identifier hs-type">CmmConfig</span></a></span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ which blocks are static function entry points</span></span><span>
</span><span id="line-1041"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SomeLabel"><span class="hs-identifier hs-type">SomeLabel</span></a></span><span class="hs-special">]</span><span>                </span><span class="annot"><span class="hs-comment">-- ^ blocks in this set</span></span><span>
</span><span id="line-1042"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span class="hs-special">]</span><span>               </span><span class="annot"><span class="hs-comment">-- ^ labels for those blocks</span></span><span>
</span><span id="line-1043"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                       </span><span class="annot"><span class="hs-comment">-- ^ True &lt;=&gt; this SRT is for a CAF</span></span><span>
</span><span id="line-1044"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ SRT for this set</span></span><span>
</span><span id="line-1045"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#DataCAFEnv"><span class="hs-identifier hs-type">DataCAFEnv</span></a></span><span>                 </span><span class="hs-comment">-- Static data labels in this group</span><span>
</span><span id="line-1046"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Lazy.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span>
</span><span id="line-1047"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- SRT objects we built</span><span>
</span><span id="line-1048"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- SRT fields for these blocks' itbls</span><span>
</span><span id="line-1049"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- SRTs to attach to static functions</span><span>
</span><span id="line-1050"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a></span><span>                      </span><span class="hs-comment">-- Whether the group has CAF references</span><span>
</span><span id="line-1051"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span id="oneSRT"><span class="annot"><span class="annottext">oneSRT :: CmmConfig
-&gt; LabelMap CLabel
-&gt; [SomeLabel]
-&gt; [CAFfyLabel]
-&gt; Bool
-&gt; Set CAFfyLabel
-&gt; DataCAFEnv
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
</span><a href="GHC.Cmm.Info.Build.html#oneSRT"><span class="hs-identifier hs-var hs-var">oneSRT</span></a></span></span><span> </span><span id="local-6989586621682951549"><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951549"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682951550"><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951550"><span class="hs-identifier hs-var">staticFuns</span></a></span></span><span> </span><span id="local-6989586621682951551"><span class="annot"><span class="annottext">[SomeLabel]
</span><a href="#local-6989586621682951551"><span class="hs-identifier hs-var">lbls</span></a></span></span><span> </span><span id="local-6989586621682951552"><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951552"><span class="hs-identifier hs-var">caf_lbls</span></a></span></span><span> </span><span id="local-6989586621682951553"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951553"><span class="hs-identifier hs-var">isCAF</span></a></span></span><span> </span><span id="local-6989586621682951554"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951554"><span class="hs-identifier hs-var">cafs</span></a></span></span><span> </span><span id="local-6989586621682951555"><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951555"><span class="hs-identifier hs-var">static_data_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1054"></span><span>  </span><span id="local-6989586621682951556"><span class="annot"><a href="#local-6989586621682951556"><span class="hs-identifier hs-var">topSRT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT ModuleSRTInfo UniqDSM ModuleSRTInfo
forall (m :: * -&gt; *) s. Monad m =&gt; StateT s m s
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Lazy.html#get"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1057"></span><span>    </span><span id="local-6989586621682951558"><span class="annot"><a href="#local-6989586621682951558"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Module
</span><a href="GHC.Cmm.Info.Build.html#thisModule"><span class="hs-identifier hs-var">thisModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951556"><span class="hs-identifier hs-var">topSRT</span></a></span><span>
</span><span id="line-1058"></span><span>    </span><span id="local-6989586621682951559"><span class="annot"><a href="#local-6989586621682951559"><span class="hs-identifier hs-var hs-var">profile</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmConfig -&gt; Profile
</span><a href="GHC.Cmm.Config.html#cmmProfile"><span class="hs-identifier hs-var">cmmProfile</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951549"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-1059"></span><span>    </span><span id="local-6989586621682951560"><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951559"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1060"></span><span>    </span><span id="local-6989586621682951562"><span class="annot"><a href="#local-6989586621682951562"><span class="hs-identifier hs-var hs-var">srtMap</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; SRTMap
</span><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951556"><span class="hs-identifier hs-var">topSRT</span></a></span><span>
</span><span id="line-1061"></span><span>
</span><span id="line-1062"></span><span>    </span><span id="local-6989586621682951563"><span class="annot"><a href="#local-6989586621682951563"><span class="hs-identifier hs-var hs-var">blockids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SomeLabel] -&gt; [BlockId]
</span><a href="GHC.Cmm.Info.Build.html#getBlockLabels"><span class="hs-identifier hs-var">getBlockLabels</span></a></span><span> </span><span class="annot"><span class="annottext">[SomeLabel]
</span><a href="#local-6989586621682951551"><span class="hs-identifier hs-var">lbls</span></a></span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span>    </span><span class="hs-comment">-- Can we merge this SRT with a FUN_STATIC closure?</span><span>
</span><span id="line-1065"></span><span>    </span><span class="annot"><a href="#local-6989586621682951564"><span class="hs-identifier hs-type">maybeFunClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>    </span><span class="annot"><a href="#local-6989586621682951565"><span class="hs-identifier hs-type">otherFunLabels</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1067"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682951564"><span class="annot"><a href="#local-6989586621682951564"><span class="hs-identifier hs-var">maybeFunClosure</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951565"><span class="annot"><a href="#local-6989586621682951565"><span class="hs-identifier hs-var">otherFunLabels</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1068"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682951566"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682951567"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682951567"><span class="annot"><a href="#local-6989586621682951567"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682951563"><span class="hs-identifier hs-type">blockids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951566"><span class="annot"><a href="#local-6989586621682951566"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-type">mapLookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951567"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951550"><span class="hs-identifier hs-type">staticFuns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1069"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (CLabel, BlockId)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682951568"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951568"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682951569"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951569"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682951570"><span class="annot"><span class="annottext">[(CLabel, BlockId)]
</span><a href="#local-6989586621682951570"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CLabel, BlockId) -&gt; Maybe (CLabel, BlockId)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951568"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951569"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((CLabel, BlockId) -&gt; CLabel) -&gt; [(CLabel, BlockId)] -&gt; [CLabel]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(CLabel, BlockId) -&gt; CLabel
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(CLabel, BlockId)]
</span><a href="#local-6989586621682951570"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span>    </span><span class="hs-comment">-- Remove recursive references from the SRT as described in</span><span>
</span><span id="line-1073"></span><span>    </span><span class="hs-comment">-- Note [recursive SRTs]. We carefully reintroduce references to static</span><span>
</span><span id="line-1074"></span><span>    </span><span class="hs-comment">-- functions and data constructor applications below, as is necessary due</span><span>
</span><span id="line-1075"></span><span>    </span><span class="hs-comment">-- to Note [No static object resurrection].</span><span>
</span><span id="line-1076"></span><span>    </span><span class="annot"><a href="#local-6989586621682951572"><span class="hs-identifier hs-type">nonRec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span>
</span><span id="line-1077"></span><span>    </span><span id="local-6989586621682951572"><span class="annot"><a href="#local-6989586621682951572"><span class="hs-identifier hs-var hs-var">nonRec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951554"><span class="hs-identifier hs-var">cafs</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel -&gt; Set CAFfyLabel -&gt; Set CAFfyLabel
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">[CAFfyLabel] -&gt; Set CAFfyLabel
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951552"><span class="hs-identifier hs-var">caf_lbls</span></a></span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span>    </span><span class="hs-comment">-- Resolve references to their SRT entries</span><span>
</span><span id="line-1080"></span><span>    </span><span class="annot"><a href="#local-6989586621682951575"><span class="hs-identifier hs-type">resolved</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1081"></span><span>    </span><span id="local-6989586621682951575"><span class="annot"><a href="#local-6989586621682951575"><span class="hs-identifier hs-var hs-var">resolved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CAFfyLabel -&gt; Maybe SRTEntry) -&gt; [CAFfyLabel] -&gt; [SRTEntry]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; SRTMap -&gt; CAFfyLabel -&gt; Maybe SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#resolveCAF"><span class="hs-identifier hs-var">resolveCAF</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951562"><span class="hs-identifier hs-var">srtMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CAFfyLabel -&gt; [CAFfyLabel]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951572"><span class="hs-identifier hs-var">nonRec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span>    </span><span class="hs-comment">-- The set of all SRTEntries in SRTs that we refer to from here.</span><span>
</span><span id="line-1084"></span><span>    </span><span id="local-6989586621682951576"><span class="annot"><a href="#local-6989586621682951576"><span class="hs-identifier hs-var hs-var">allBelow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1085"></span><span>      </span><span class="annot"><span class="annottext">[Set SRTEntry] -&gt; Set SRTEntry
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">Set.unions</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951577"><span class="hs-identifier hs-var">lbls</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682951578"><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951578"><span class="hs-identifier hs-var">caf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951575"><span class="hs-identifier hs-var">resolved</span></a></span><span>
</span><span id="line-1086"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951577"><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951577"><span class="hs-identifier hs-var">lbls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SRTEntry -&gt; Map SRTEntry (Set SRTEntry) -&gt; Maybe (Set SRTEntry)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951578"><span class="hs-identifier hs-var">caf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Map SRTEntry (Set SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#flatSRTs"><span class="hs-identifier hs-var">flatSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951556"><span class="hs-identifier hs-var">topSRT</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span>    </span><span class="hs-comment">-- Remove SRTEntries that are also in an SRT that we refer to.</span><span>
</span><span id="line-1089"></span><span>    </span><span class="hs-comment">-- Implements the [Filter] optimisation.</span><span>
</span><span id="line-1090"></span><span>    </span><span id="local-6989586621682951579"><span class="annot"><a href="#local-6989586621682951579"><span class="hs-identifier hs-var hs-var">filtered0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SRTEntry] -&gt; Set SRTEntry
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951575"><span class="hs-identifier hs-var">resolved</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry -&gt; Set SRTEntry -&gt; Set SRTEntry
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951576"><span class="hs-identifier hs-var">allBelow</span></a></span><span>
</span><span id="line-1091"></span><span>
</span><span id="line-1092"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-type">srtTraceM</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oneSRT:&quot;</span></span><span>
</span><span id="line-1093"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;srtMap:&quot;</span></span><span>          </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951562"><span class="hs-identifier hs-type">srtMap</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1094"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;nonRec:&quot;</span></span><span>          </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951572"><span class="hs-identifier hs-type">nonRec</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1095"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lbls:&quot;</span></span><span>            </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951551"><span class="hs-identifier hs-type">lbls</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1096"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;caf_lbls:&quot;</span></span><span>        </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951552"><span class="hs-identifier hs-type">caf_lbls</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1097"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;static_data_env:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951555"><span class="hs-identifier hs-type">static_data_env</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1098"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cafs:&quot;</span></span><span>            </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951554"><span class="hs-identifier hs-type">cafs</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1099"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;blockids:&quot;</span></span><span>        </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951563"><span class="hs-identifier hs-type">blockids</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1100"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;maybeFunClosure:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951564"><span class="hs-identifier hs-type">maybeFunClosure</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1101"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;otherFunLabels:&quot;</span></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951565"><span class="hs-identifier hs-type">otherFunLabels</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1102"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;resolved:&quot;</span></span><span>        </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951575"><span class="hs-identifier hs-type">resolved</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1103"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;allBelow:&quot;</span></span><span>        </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951576"><span class="hs-identifier hs-type">allBelow</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1104"></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;filtered0:&quot;</span></span><span>       </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951579"><span class="hs-identifier hs-type">filtered0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>
</span><span id="line-1106"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1107"></span><span>    </span><span id="local-6989586621682951580"><span class="annot"><a href="#local-6989586621682951580"><span class="hs-identifier hs-var hs-var">isStaticFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CLabel, BlockId) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (CLabel, BlockId)
</span><a href="#local-6989586621682951564"><span class="hs-identifier hs-var">maybeFunClosure</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>    </span><span class="hs-comment">-- For a label without a closure (e.g. a continuation), we must</span><span>
</span><span id="line-1110"></span><span>    </span><span class="hs-comment">-- update the SRTMap for the label to point to a closure. It's</span><span>
</span><span id="line-1111"></span><span>    </span><span class="hs-comment">-- important that we don't do this for static functions or CAFs,</span><span>
</span><span id="line-1112"></span><span>    </span><span class="hs-comment">-- see Note [Invalid optimisation: shortcutting].</span><span>
</span><span id="line-1113"></span><span>    </span><span class="annot"><a href="#local-6989586621682951582"><span class="hs-identifier hs-type">updateSRTMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Lazy.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>    </span><span id="local-6989586621682951582"><span class="annot"><a href="#local-6989586621682951582"><span class="hs-identifier hs-var hs-var">updateSRTMap</span></a></span></span><span> </span><span id="local-6989586621682951583"><span class="annot"><span class="annottext">Maybe SRTEntry
</span><a href="#local-6989586621682951583"><span class="hs-identifier hs-var">srtEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1115"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; StateT ModuleSRTInfo UniqDSM ()
-&gt; StateT ModuleSRTInfo UniqDSM ()
forall b. String -&gt; SDoc -&gt; b -&gt; b
</span><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-var">srtTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;updateSRTMap&quot;</span></span><span>
</span><span id="line-1116"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Maybe SRTEntry -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry
</span><a href="#local-6989586621682951583"><span class="hs-identifier hs-var">srtEntry</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-string">&quot;isCAF:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951553"><span class="hs-identifier hs-var">isCAF</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1117"></span><span>         </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-string">&quot;isStaticFun:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951580"><span class="hs-identifier hs-var">isStaticFun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT ModuleSRTInfo UniqDSM ()
 -&gt; StateT ModuleSRTInfo UniqDSM ())
-&gt; StateT ModuleSRTInfo UniqDSM ()
-&gt; StateT ModuleSRTInfo UniqDSM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1118"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; StateT ModuleSRTInfo UniqDSM ()
-&gt; StateT ModuleSRTInfo UniqDSM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951553"><span class="hs-identifier hs-var">isCAF</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951580"><span class="hs-identifier hs-var">isStaticFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry
</span><a href="#local-6989586621682951583"><span class="hs-identifier hs-var">srtEntry</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT ModuleSRTInfo UniqDSM ()
 -&gt; StateT ModuleSRTInfo UniqDSM ())
-&gt; StateT ModuleSRTInfo UniqDSM ()
-&gt; StateT ModuleSRTInfo UniqDSM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1119"></span><span>        </span><span class="annot"><span class="annottext">(ModuleSRTInfo -&gt; ModuleSRTInfo) -&gt; StateT ModuleSRTInfo UniqDSM ()
forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; s) -&gt; StateT s m ()
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Lazy.html#modify%27"><span class="hs-identifier hs-var">modify'</span></a></span><span> </span><span class="annot"><span class="annottext">((ModuleSRTInfo -&gt; ModuleSRTInfo)
 -&gt; StateT ModuleSRTInfo UniqDSM ())
-&gt; (ModuleSRTInfo -&gt; ModuleSRTInfo)
-&gt; StateT ModuleSRTInfo UniqDSM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951587"><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951587"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1120"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682951588"><span class="annot"><span class="annottext">srt_map :: SRTMap
</span><a href="#local-6989586621682951588"><span class="hs-identifier hs-var hs-var">srt_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1121"></span><span>                 </span><span class="annot"><span class="annottext">(SRTMap -&gt; CAFfyLabel -&gt; SRTMap)
-&gt; SRTMap -&gt; [CAFfyLabel] -&gt; SRTMap
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682951589"><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951589"><span class="hs-identifier hs-var">srt_map</span></a></span></span><span> </span><span id="local-6989586621682951590"><span class="annot"><span class="annottext">cafLbl :: CAFfyLabel
</span><a href="#local-6989586621682951590"><span class="hs-identifier hs-var">cafLbl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span id="local-6989586621682951591"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951591"><span class="hs-identifier hs-var">clbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1122"></span><span>                          </span><span class="hs-comment">-- Only map static data to Nothing (== not CAFFY). For CAFFY</span><span>
</span><span id="line-1123"></span><span>                          </span><span class="hs-comment">-- statics we refer to the static itself instead of a SRT.</span><span>
</span><span id="line-1124"></span><span>                          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; DataCAFEnv -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">Map.member</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951591"><span class="hs-identifier hs-var">clbl</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951555"><span class="hs-identifier hs-var">static_data_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry
</span><a href="#local-6989586621682951583"><span class="hs-identifier hs-var">srtEntry</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1125"></span><span>                            </span><span class="annot"><span class="annottext">CAFfyLabel -&gt; Maybe SRTEntry -&gt; SRTMap -&gt; SRTMap
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">CAFfyLabel
</span><a href="#local-6989586621682951590"><span class="hs-identifier hs-var">cafLbl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SRTEntry
</span><a href="#local-6989586621682951583"><span class="hs-identifier hs-var">srtEntry</span></a></span><span> </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951589"><span class="hs-identifier hs-var">srt_map</span></a></span><span>
</span><span id="line-1126"></span><span>                          </span><span class="hs-keyword">else</span><span>
</span><span id="line-1127"></span><span>                            </span><span class="annot"><span class="annottext">SRTMap
</span><a href="#local-6989586621682951589"><span class="hs-identifier hs-var">srt_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; SRTMap
</span><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951587"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>                        </span><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951552"><span class="hs-identifier hs-var">caf_lbls</span></a></span><span>
</span><span id="line-1130"></span><span>           </span><span class="hs-keyword">in</span><span>
</span><span id="line-1131"></span><span>               </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951587"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682951588"><span class="hs-identifier hs-type">srt_map</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1132"></span><span>
</span><span id="line-1133"></span><span>    </span><span id="local-6989586621682951593"><span class="annot"><a href="#local-6989586621682951593"><span class="hs-identifier hs-var hs-var">allStaticData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1134"></span><span>      </span><span class="annot"><span class="annottext">(CAFfyLabel -&gt; Bool) -&gt; [CAFfyLabel] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#CAFfyLabel"><span class="hs-identifier hs-type">CAFfyLabel</span></a></span><span> </span><span id="local-6989586621682951595"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951595"><span class="hs-identifier hs-var">clbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; DataCAFEnv -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">Map.member</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951595"><span class="hs-identifier hs-var">clbl</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951555"><span class="hs-identifier hs-var">static_data_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951552"><span class="hs-identifier hs-var">caf_lbls</span></a></span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-type">Set.null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951579"><span class="hs-identifier hs-type">filtered0</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1137"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-type">srtTraceM</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oneSRT: empty&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951552"><span class="hs-identifier hs-type">caf_lbls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>    </span><span class="annot"><a href="#local-6989586621682951582"><span class="hs-identifier hs-type">updateSRTMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1139"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-type">NoCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1141"></span><span>    </span><span class="hs-comment">-- We're going to build an SRT for this group, which should include function</span><span>
</span><span id="line-1142"></span><span>    </span><span class="hs-comment">-- references in the group. See Note [recursive SRTs].</span><span>
</span><span id="line-1143"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951597"><span class="annot"><a href="#local-6989586621682951597"><span class="hs-identifier hs-var hs-var">allBelow_funs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1144"></span><span>          </span><span class="annot"><span class="annottext">[SRTEntry] -&gt; Set SRTEntry
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CLabel -&gt; SRTEntry) -&gt; [CLabel] -&gt; [SRTEntry]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-var">SRTEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; SRTEntry) -&gt; (CLabel -&gt; CLabel) -&gt; CLabel -&gt; SRTEntry
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#toClosureLbl"><span class="hs-identifier hs-var">toClosureLbl</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682951565"><span class="hs-identifier hs-var">otherFunLabels</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>    </span><span class="hs-comment">-- We must also ensure that all CAFfy static data constructor applications</span><span>
</span><span id="line-1146"></span><span>    </span><span class="hs-comment">-- are included. See Note [recursive SRTs] and #20959.</span><span>
</span><span id="line-1147"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951598"><span class="annot"><a href="#local-6989586621682951598"><span class="hs-identifier hs-var hs-var">allBelow_data</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1148"></span><span>          </span><span class="annot"><span class="annottext">[SRTEntry] -&gt; Set SRTEntry
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span>
</span><span id="line-1149"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-var">SRTEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; SRTEntry) -&gt; CLabel -&gt; SRTEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#toClosureLbl"><span class="hs-identifier hs-var">toClosureLbl</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951599"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-1150"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#DeclLabel"><span class="hs-identifier hs-type">DeclLabel</span></a></span><span> </span><span id="local-6989586621682951599"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951599"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SomeLabel]
</span><a href="#local-6989586621682951551"><span class="hs-identifier hs-var">lbls</span></a></span><span>
</span><span id="line-1151"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951600"><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951600"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Set CAFfyLabel) -&gt; [Maybe (Set CAFfyLabel)]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set CAFfyLabel) -&gt; [Maybe (Set CAFfyLabel)])
-&gt; Maybe (Set CAFfyLabel) -&gt; [Maybe (Set CAFfyLabel)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; DataCAFEnv -&gt; Maybe (Set CAFfyLabel)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951599"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">DataCAFEnv
</span><a href="#local-6989586621682951555"><span class="hs-identifier hs-var">static_data_env</span></a></span><span>
</span><span id="line-1152"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set CAFfyLabel
</span><a href="#local-6989586621682951600"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-1153"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1154"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951601"><span class="annot"><a href="#local-6989586621682951601"><span class="hs-identifier hs-var hs-var">filtered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951579"><span class="hs-identifier hs-var">filtered0</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry -&gt; Set SRTEntry -&gt; Set SRTEntry
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951597"><span class="hs-identifier hs-var">allBelow_funs</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry -&gt; Set SRTEntry -&gt; Set SRTEntry
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951598"><span class="hs-identifier hs-var">allBelow_data</span></a></span><span>
</span><span id="line-1155"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-type">srtTraceM</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oneSRT&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;filtered:&quot;</span></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951601"><span class="hs-identifier hs-type">filtered</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1156"></span><span>                        </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;allBelow_funs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951597"><span class="hs-identifier hs-type">allBelow_funs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-type">Set.toList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951601"><span class="hs-identifier hs-type">filtered</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1158"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oneSRT&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-comment">-- unreachable</span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span>      </span><span class="hs-comment">-- [Inline] - when we have only one entry there is no need to</span><span>
</span><span id="line-1161"></span><span>      </span><span class="hs-comment">-- build an SRT object at all, instead we put the singleton SRT</span><span>
</span><span id="line-1162"></span><span>      </span><span class="hs-comment">-- entry in the info table.</span><span>
</span><span id="line-1163"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621682951604"><span class="annot"><span class="annottext">one :: SRTEntry
</span><a href="#local-6989586621682951604"><span class="hs-identifier hs-var">one</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span id="local-6989586621682951605"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951605"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1164"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Info tables refer to SRTs by offset (as noted in the section</span><span>
</span><span id="line-1165"></span><span>          </span><span class="hs-comment">-- &quot;Referring to an SRT from the info table&quot; of Note [SRTs]). However,</span><span>
</span><span id="line-1166"></span><span>          </span><span class="hs-comment">-- when dynamic linking is used we cannot guarantee that the offset</span><span>
</span><span id="line-1167"></span><span>          </span><span class="hs-comment">-- between the SRT and the info table will fit in the offset field.</span><span>
</span><span id="line-1168"></span><span>          </span><span class="hs-comment">-- Consequently we build a singleton SRT in this case.</span><span>
</span><span id="line-1169"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Platform -&gt; Bool -&gt; CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#labelDynamic"><span class="hs-identifier hs-var">labelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682951558"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmConfig -&gt; Bool
</span><a href="GHC.Cmm.Config.html#cmmExternalDynamicRefs"><span class="hs-identifier hs-var">cmmExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621682951549"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951605"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span>          </span><span class="hs-comment">-- MachO relocations can't express offsets between compilation units at</span><span>
</span><span id="line-1172"></span><span>          </span><span class="hs-comment">-- all, so we are always forced to build a singleton SRT in this case</span><span>
</span><span id="line-1173"></span><span>          </span><span class="hs-comment">-- (cf #15169)</span><span>
</span><span id="line-1174"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><span class="hs-identifier hs-var">osMachOTarget</span></span><span> </span><span class="annot"><span class="annottext">(OS -&gt; Bool) -&gt; OS -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; OS) -&gt; Platform -&gt; OS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951559"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#isLocalCLabel"><span class="hs-identifier hs-var">isLocalCLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682951558"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951605"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span>          </span><span class="hs-comment">-- If we have a static function closure, then it becomes the</span><span>
</span><span id="line-1178"></span><span>          </span><span class="hs-comment">-- SRT object, and everything else points to it. (the only way</span><span>
</span><span id="line-1179"></span><span>          </span><span class="hs-comment">-- we could have multiple labels here is if this is a</span><span>
</span><span id="line-1180"></span><span>          </span><span class="hs-comment">-- recursive group, see Note [recursive SRTs])</span><span>
</span><span id="line-1181"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (CLabel, BlockId)
</span><a href="#local-6989586621682951564"><span class="hs-identifier hs-var">maybeFunClosure</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1182"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951611"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951611"><span class="hs-identifier hs-var">staticFunLbl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682951612"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951612"><span class="hs-identifier hs-var">staticFunBlock</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1183"></span><span>                </span><span class="annot"><span class="annottext">([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
 CafInfo)
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
forall a. a -&gt; StateT ModuleSRTInfo UniqDSM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(BlockId, CLabel)]
</span><a href="#local-6989586621682951613"><span class="hs-identifier hs-var">withLabels</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-1185"></span><span>                </span><span id="local-6989586621682951613"><span class="annot"><span class="annottext">withLabels :: [(BlockId, CLabel)]
</span><a href="#local-6989586621682951613"><span class="hs-identifier hs-var hs-var">withLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1186"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951614"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951614"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951612"><span class="hs-identifier hs-var">staticFunBlock</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951605"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951611"><span class="hs-identifier hs-var">staticFunLbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1187"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682951614"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951614"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[BlockId]
</span><a href="#local-6989586621682951563"><span class="hs-identifier hs-var">blockids</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1188"></span><span>            </span><span class="annot"><span class="annottext">Maybe (CLabel, BlockId)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1189"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; StateT ModuleSRTInfo UniqDSM ()
forall (f :: * -&gt; *). Applicative f =&gt; String -&gt; SDoc -&gt; f ()
</span><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-var">srtTraceM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oneSRT: one&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;caf_lbls:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [CAFfyLabel] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951552"><span class="hs-identifier hs-var">caf_lbls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1190"></span><span>                                       </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;one:&quot;</span></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; SRTEntry -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951604"><span class="hs-identifier hs-var">one</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1191"></span><span>              </span><span class="annot"><span class="annottext">Maybe SRTEntry -&gt; StateT ModuleSRTInfo UniqDSM ()
</span><a href="#local-6989586621682951582"><span class="hs-identifier hs-var">updateSRTMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRTEntry -&gt; Maybe SRTEntry
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951604"><span class="hs-identifier hs-var">one</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>              </span><span class="annot"><span class="annottext">([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
 CafInfo)
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
forall a. a -&gt; StateT ModuleSRTInfo UniqDSM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; (BlockId, CLabel)) -&gt; [BlockId] -&gt; [(BlockId, CLabel)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951605"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BlockId]
</span><a href="#local-6989586621682951563"><span class="hs-identifier hs-var">blockids</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span>      </span><span id="local-6989586621682951615"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951615"><span class="hs-identifier hs-var">cafList</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951593"><span class="hs-identifier hs-var">allStaticData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1195"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951616"><span class="annot"><span class="annottext">caffiness :: CafInfo
</span><a href="#local-6989586621682951616"><span class="hs-identifier hs-var hs-var">caffiness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[SRTEntry] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951615"><span class="hs-identifier hs-var">cafList</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a></span><span>
</span><span id="line-1196"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
 CafInfo)
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
forall a. a -&gt; StateT ModuleSRTInfo UniqDSM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="#local-6989586621682951616"><span class="hs-identifier hs-var">caffiness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>      </span><span id="local-6989586621682951618"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951618"><span class="hs-identifier hs-var">cafList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1199"></span><span>        </span><span class="hs-comment">-- Check whether an SRT with the same entries has been emitted already.</span><span>
</span><span id="line-1200"></span><span>        </span><span class="hs-comment">-- Implements the [Common] optimisation.</span><span>
</span><span id="line-1201"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set SRTEntry -&gt; Map (Set SRTEntry) SRTEntry -&gt; Maybe SRTEntry
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951601"><span class="hs-identifier hs-var">filtered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Map (Set SRTEntry) SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#dedupSRTs"><span class="hs-identifier hs-var">dedupSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951556"><span class="hs-identifier hs-var">topSRT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1202"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951619"><span class="annot"><span class="annottext">srtEntry :: SRTEntry
</span><a href="#local-6989586621682951619"><span class="hs-identifier hs-var">srtEntry</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span id="local-6989586621682951620"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951620"><span class="hs-identifier hs-var">srtLbl</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1203"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; StateT ModuleSRTInfo UniqDSM ()
forall (f :: * -&gt; *). Applicative f =&gt; String -&gt; SDoc -&gt; f ()
</span><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-var">srtTraceM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oneSRT [Common]&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [CAFfyLabel] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[CAFfyLabel]
</span><a href="#local-6989586621682951552"><span class="hs-identifier hs-var">caf_lbls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951560"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951620"><span class="hs-identifier hs-var">srtLbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1204"></span><span>            </span><span class="annot"><span class="annottext">Maybe SRTEntry -&gt; StateT ModuleSRTInfo UniqDSM ()
</span><a href="#local-6989586621682951582"><span class="hs-identifier hs-var">updateSRTMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRTEntry -&gt; Maybe SRTEntry
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951619"><span class="hs-identifier hs-var">srtEntry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span>            </span><span class="annot"><span class="annottext">([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
 CafInfo)
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, CLabel)], [(BlockId, [SRTEntry])],
      CafInfo)
forall a. a -&gt; StateT ModuleSRTInfo UniqDSM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; (BlockId, CLabel)) -&gt; [BlockId] -&gt; [(BlockId, CLabel)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951620"><span class="hs-identifier hs-var">srtLbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BlockId]
</span><a href="#local-6989586621682951563"><span class="hs-identifier hs-var">blockids</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>          </span><span class="annot"><span class="annottext">Maybe SRTEntry
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1207"></span><span>            </span><span class="hs-comment">-- No duplicates: we have to build a new SRT object</span><span>
</span><span id="line-1208"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682951621"><span class="annot"><a href="#local-6989586621682951621"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951622"><span class="annot"><a href="#local-6989586621682951622"><span class="hs-identifier hs-var">funSRTs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951623"><span class="annot"><a href="#local-6989586621682951623"><span class="hs-identifier hs-var">srtEntry</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1209"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (CLabel, BlockId)
</span><a href="#local-6989586621682951564"><span class="hs-identifier hs-var">maybeFunClosure</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1210"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951624"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951624"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682951625"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951625"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1211"></span><span>                  </span><span class="annot"><span class="annottext">([CmmDeclSRTs], [(BlockId, [SRTEntry])], SRTEntry)
-&gt; StateT
     ModuleSRTInfo
     UniqDSM
     ([CmmDeclSRTs], [(BlockId, [SRTEntry])], SRTEntry)
forall a. a -&gt; StateT ModuleSRTInfo UniqDSM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951625"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951618"><span class="hs-identifier hs-var">cafList</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-var">SRTEntry</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951624"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>                </span><span class="annot"><span class="annottext">Maybe (CLabel, BlockId)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1213"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621682951626"><span class="annot"><a href="#local-6989586621682951626"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951627"><span class="annot"><a href="#local-6989586621682951627"><span class="hs-identifier hs-var">entry</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqDSM ([CmmDeclSRTs], SRTEntry)
-&gt; StateT ModuleSRTInfo UniqDSM ([CmmDeclSRTs], SRTEntry)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT ModuleSRTInfo m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqDSM ([CmmDeclSRTs], SRTEntry)
 -&gt; StateT ModuleSRTInfo UniqDSM ([CmmDeclSRTs], SRTEntry))
-&gt; UniqDSM ([CmmDeclSRTs], SRTEntry)
-&gt; StateT ModuleSRTInfo UniqDSM ([CmmDeclSRTs], SRTEntry)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Profile -&gt; [SRTEntry] -&gt; UniqDSM ([CmmDeclSRTs], SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#buildSRTChain"><span class="hs-identifier hs-var">buildSRTChain</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951559"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951618"><span class="hs-identifier hs-var">cafList</span></a></span><span>
</span><span id="line-1214"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682951626"><span class="hs-identifier hs-type">decls</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682951627"><span class="hs-identifier hs-type">entry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>            </span><span class="annot"><a href="#local-6989586621682951582"><span class="hs-identifier hs-type">updateSRTMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682951623"><span class="hs-identifier hs-type">srtEntry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951630"><span class="annot"><a href="#local-6989586621682951630"><span class="hs-identifier hs-var hs-var">allBelowThis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set SRTEntry -&gt; Set SRTEntry -&gt; Set SRTEntry
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951576"><span class="hs-identifier hs-var">allBelow</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951601"><span class="hs-identifier hs-var">filtered</span></a></span><span>
</span><span id="line-1217"></span><span>                </span><span id="local-6989586621682951631"><span class="annot"><a href="#local-6989586621682951631"><span class="hs-identifier hs-var hs-var">newFlatSRTs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRTEntry
-&gt; Set SRTEntry
-&gt; Map SRTEntry (Set SRTEntry)
-&gt; Map SRTEntry (Set SRTEntry)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951623"><span class="hs-identifier hs-var">srtEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951630"><span class="hs-identifier hs-var">allBelowThis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Map SRTEntry (Set SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#flatSRTs"><span class="hs-identifier hs-var">flatSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951556"><span class="hs-identifier hs-var">topSRT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>                </span><span class="hs-comment">-- When all definition in this group are static data we don't</span><span>
</span><span id="line-1219"></span><span>                </span><span class="hs-comment">-- generate any SRTs.</span><span>
</span><span id="line-1220"></span><span>                </span><span id="local-6989586621682951632"><span class="annot"><a href="#local-6989586621682951632"><span class="hs-identifier hs-var hs-var">newDedupSRTs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
-&gt; SRTEntry
-&gt; Map (Set SRTEntry) SRTEntry
-&gt; Map (Set SRTEntry) SRTEntry
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Set SRTEntry
</span><a href="#local-6989586621682951601"><span class="hs-identifier hs-var">filtered</span></a></span><span> </span><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951623"><span class="hs-identifier hs-var">srtEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; Map (Set SRTEntry) SRTEntry
</span><a href="GHC.Cmm.Info.Build.html#dedupSRTs"><span class="hs-identifier hs-var">dedupSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951556"><span class="hs-identifier hs-var">topSRT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>            </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.State.Lazy.html#modify%27"><span class="hs-identifier hs-type">modify'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682951633"><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951633"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621682951633"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#dedupSRTs"><span class="hs-identifier hs-var">dedupSRTs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682951632"><span class="hs-identifier hs-type">newDedupSRTs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1222"></span><span>                                      </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#flatSRTs"><span class="hs-identifier hs-var">flatSRTs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682951631"><span class="hs-identifier hs-type">newFlatSRTs</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>            </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-type">srtTraceM</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oneSRT: new&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;caf_lbls:&quot;</span></span><span>      </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951552"><span class="hs-identifier hs-type">caf_lbls</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1224"></span><span>                                      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;filtered:&quot;</span></span><span>     </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951601"><span class="hs-identifier hs-type">filtered</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1225"></span><span>                                      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;srtEntry:&quot;</span></span><span>     </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951623"><span class="hs-identifier hs-type">srtEntry</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1226"></span><span>                                      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newDedupSRTs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951632"><span class="hs-identifier hs-type">newDedupSRTs</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1227"></span><span>                                      </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newFlatSRTs:&quot;</span></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951560"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951631"><span class="hs-identifier hs-type">newFlatSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span id="local-6989586621682951634"><span class="annot"><a href="#local-6989586621682951634"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682951623"><span class="hs-identifier hs-type">srtEntry</span></a></span><span>
</span><span id="line-1229"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682951621"><span class="hs-identifier hs-type">decls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682951634"><span class="hs-identifier hs-type">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682951563"><span class="hs-identifier hs-type">blockids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682951622"><span class="hs-identifier hs-type">funSRTs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#MayHaveCafRefs"><span class="hs-identifier hs-type">MayHaveCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>
</span><span id="line-1231"></span><span>
</span><span id="line-1232"></span><span class="hs-comment">-- | Build a static SRT object (or a chain of objects) from a list of</span><span>
</span><span id="line-1233"></span><span class="hs-comment">-- 'SRTEntry's.</span><span>
</span><span id="line-1234"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#buildSRTChain"><span class="hs-identifier hs-type">buildSRTChain</span></a></span><span>
</span><span id="line-1235"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-1236"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1237"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span>
</span><span id="line-1238"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- The SRT object(s)</span><span>
</span><span id="line-1239"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span>      </span><span class="hs-comment">-- label to use in the info table</span><span>
</span><span id="line-1240"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span id="buildSRTChain"><span class="annot"><span class="annottext">buildSRTChain :: Profile -&gt; [SRTEntry] -&gt; UniqDSM ([CmmDeclSRTs], SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#buildSRTChain"><span class="hs-identifier hs-var hs-var">buildSRTChain</span></a></span></span><span> </span><span id="local-6989586621682951635"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951635"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621682951636"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951636"><span class="hs-identifier hs-var">cafSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1242"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; [SRTEntry] -&gt; ([SRTEntry], [SRTEntry])
forall a. WordOff -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682951638"><span class="hs-identifier hs-var">mAX_SRT_SIZE</span></a></span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951636"><span class="hs-identifier hs-var">cafSet</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1243"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSM ([CmmDeclSRTs], SRTEntry)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;buildSRT: empty&quot;</span></span><span>
</span><span id="line-1244"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682951640"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951640"><span class="hs-identifier hs-var">these</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1245"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682951641"><span class="annot"><a href="#local-6989586621682951641"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682951642"><span class="annot"><a href="#local-6989586621682951642"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; [SRTEntry] -&gt; UniqDSM (CmmDeclSRTs, SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#buildSRT"><span class="hs-identifier hs-var">buildSRT</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951635"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951640"><span class="hs-identifier hs-var">these</span></a></span><span>
</span><span id="line-1246"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682951641"><span class="hs-identifier hs-type">decl</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682951642"><span class="hs-identifier hs-type">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1247"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682951644"><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951644"><span class="hs-identifier hs-var">this</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682951645"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951645"><span class="hs-identifier hs-var">these</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682951646"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951646"><span class="hs-identifier hs-var">those</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1248"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682951647"><span class="annot"><a href="#local-6989586621682951647"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951648"><span class="annot"><a href="#local-6989586621682951648"><span class="hs-identifier hs-var">rest_lbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; [SRTEntry] -&gt; UniqDSM ([CmmDeclSRTs], SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#buildSRTChain"><span class="hs-identifier hs-var">buildSRTChain</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951635"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRTEntry
</span><a href="#local-6989586621682951644"><span class="hs-identifier hs-var">this</span></a></span><span> </span><span class="annot"><span class="annottext">SRTEntry -&gt; [SRTEntry] -&gt; [SRTEntry]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951646"><span class="hs-identifier hs-var">those</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1249"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682951649"><span class="annot"><a href="#local-6989586621682951649"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682951650"><span class="annot"><a href="#local-6989586621682951650"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#buildSRT"><span class="hs-identifier hs-type">buildSRT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951635"><span class="hs-identifier hs-type">profile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682951648"><span class="hs-identifier hs-type">rest_lbl</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682951645"><span class="hs-identifier hs-type">these</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1250"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682951649"><span class="hs-identifier hs-type">decl</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682951647"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682951650"><span class="hs-identifier hs-type">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1252"></span><span>    </span><span id="local-6989586621682951638"><span class="annot"><span class="annottext">mAX_SRT_SIZE :: WordOff
</span><a href="#local-6989586621682951638"><span class="hs-identifier hs-var hs-var">mAX_SRT_SIZE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">16</span></span><span>
</span><span id="line-1253"></span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#buildSRT"><span class="hs-identifier hs-type">buildSRT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span id="buildSRT"><span class="annot"><span class="annottext">buildSRT :: Profile -&gt; [SRTEntry] -&gt; UniqDSM (CmmDeclSRTs, SRTEntry)
</span><a href="GHC.Cmm.Info.Build.html#buildSRT"><span class="hs-identifier hs-var hs-var">buildSRT</span></a></span></span><span> </span><span id="local-6989586621682951652"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951652"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621682951653"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951653"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1257"></span><span>  </span><span id="local-6989586621682951654"><span class="annot"><a href="#local-6989586621682951654"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqDSM Unique
</span><a href="GHC.Types.Unique.DSM.html#getUniqueDSM"><span class="hs-identifier hs-var">getUniqueDSM</span></a></span><span>
</span><span id="line-1258"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1259"></span><span>    </span><span id="local-6989586621682951656"><span class="annot"><a href="#local-6989586621682951656"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkSRTLabel"><span class="hs-identifier hs-var">mkSRTLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682951654"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1260"></span><span>    </span><span id="local-6989586621682951658"><span class="annot"><a href="#local-6989586621682951658"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951652"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1261"></span><span>    </span><span id="local-6989586621682951659"><span class="annot"><a href="#local-6989586621682951659"><span class="hs-identifier hs-var hs-var">srt_n_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkSRTInfoLabel"><span class="hs-identifier hs-var">mkSRTInfoLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SRTEntry] -&gt; WordOff
forall a. [a] -&gt; WordOff
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; WordOff
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951653"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1262"></span><span>    </span><span id="local-6989586621682951662"><span class="annot"><a href="#local-6989586621682951662"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1263"></span><span>      </span><span class="annot"><span class="annottext">Profile
-&gt; CLabel
-&gt; CostCentreStack
-&gt; [CmmLit]
-&gt; [CmmLit]
-&gt; [CmmLit]
-&gt; [CmmLit]
-&gt; [CmmLit]
-&gt; [CmmLit]
</span><a href="GHC.StgToCmm.Heap.html#mkStaticClosure"><span class="hs-identifier hs-var">mkStaticClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951652"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951659"><span class="hs-identifier hs-var">srt_n_info</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#dontCareCCS"><span class="hs-identifier hs-var">dontCareCCS</span></a></span><span>
</span><span id="line-1264"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951665"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span id="local-6989586621682951665"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951665"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951653"><span class="hs-identifier hs-var">refs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1265"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- no padding</span><span>
</span><span id="line-1266"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#mkIntCLit"><span class="hs-identifier hs-var">mkIntCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682951658"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- link field</span><span>
</span><span id="line-1267"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- no saved info</span><span>
</span><span id="line-1268"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- no extras</span><span>
</span><span id="line-1269"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#mkDataLits"><span class="hs-identifier hs-type">mkDataLits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#Section"><span class="hs-identifier hs-type">Section</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951656"><span class="hs-identifier hs-type">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682951656"><span class="hs-identifier hs-type">lbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951662"><span class="hs-identifier hs-type">fields</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951656"><span class="hs-identifier hs-type">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span class="hs-comment">-- | Update info tables with references to their SRTs. Also generate</span><span>
</span><span id="line-1272"></span><span class="hs-comment">-- static closures, splicing in SRT fields as necessary.</span><span>
</span><span id="line-1273"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#updInfoSRTs"><span class="hs-identifier hs-type">updInfoSRTs</span></a></span><span>
</span><span id="line-1274"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-1275"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ SRT labels for each block</span></span><span>
</span><span id="line-1276"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span class="hs-special">]</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ SRTs to merge into FUN_STATIC closures</span></span><span>
</span><span id="line-1277"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a></span><span>                       </span><span class="annot"><span class="hs-comment">-- ^ Whether the CmmDecl's group has CAF references</span></span><span>
</span><span id="line-1278"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmDecl"><span class="hs-identifier hs-type">CmmDecl</span></a></span><span>
</span><span id="line-1279"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span id="updInfoSRTs"><span class="annot"><span class="annottext">updInfoSRTs :: Profile
-&gt; LabelMap CLabel
-&gt; LabelMap [SRTEntry]
-&gt; CafInfo
-&gt; CmmDecl
-&gt; [CmmDeclSRTs]
</span><a href="GHC.Cmm.Info.Build.html#updInfoSRTs"><span class="hs-identifier hs-var hs-var">updInfoSRTs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Profile
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LabelMap CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LabelMap [SRTEntry]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span id="local-6989586621682951670"><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682951670"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-type">CmmStaticsRaw</span></a></span><span> </span><span id="local-6989586621682951671"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951671"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682951672"><span class="annot"><span class="annottext">[CmmStatic]
</span><a href="#local-6989586621682951672"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1282"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Section -&gt; RawCmmStatics -&gt; CmmDeclSRTs
forall d h g. Section -&gt; d -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682951670"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; [CmmStatic] -&gt; RawCmmStatics
forall (rawOnly :: Bool).
CLabel -&gt; [CmmStatic] -&gt; GenCmmStatics rawOnly
</span><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-var">CmmStaticsRaw</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951671"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmStatic]
</span><a href="#local-6989586621682951672"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1283"></span><span>
</span><span id="line-1284"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#updInfoSRTs"><span class="hs-identifier hs-var">updInfoSRTs</span></a></span><span> </span><span id="local-6989586621682951673"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951673"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="annot"><span class="annottext">LabelMap CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LabelMap [SRTEntry]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951674"><span class="annot"><span class="annottext">CafInfo
</span><a href="#local-6989586621682951674"><span class="hs-identifier hs-var">caffy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span id="local-6989586621682951675"><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682951675"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a></span><span> </span><span id="local-6989586621682951677"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951677"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682951678"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951678"><span class="hs-identifier hs-var">itbl</span></a></span></span><span> </span><span id="local-6989586621682951679"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682951679"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span id="local-6989586621682951680"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951680"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span id="local-6989586621682951681"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951681"><span class="hs-identifier hs-var">extras</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Section -&gt; RawCmmStatics -&gt; CmmDeclSRTs
forall d h g. Section -&gt; d -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682951675"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; [CmmStatic] -&gt; RawCmmStatics
forall (rawOnly :: Bool).
CLabel -&gt; [CmmStatic] -&gt; GenCmmStatics rawOnly
</span><a href="GHC.Cmm.html#CmmStaticsRaw"><span class="hs-identifier hs-var">CmmStaticsRaw</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951677"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmStatic) -&gt; [CmmLit] -&gt; [CmmStatic]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmStatic
</span><a href="GHC.Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951683"><span class="hs-identifier hs-var">field_lits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1286"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1287"></span><span>    </span><span id="local-6989586621682951683"><span class="annot"><span class="annottext">field_lits :: [CmmLit]
</span><a href="#local-6989586621682951683"><span class="hs-identifier hs-var hs-var">field_lits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile
-&gt; CmmInfoTable
-&gt; CostCentreStack
-&gt; CafInfo
-&gt; [CmmLit]
-&gt; [CmmLit]
-&gt; [CmmLit]
</span><a href="GHC.StgToCmm.Heap.html#mkStaticClosureFields"><span class="hs-identifier hs-var">mkStaticClosureFields</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951673"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951678"><span class="hs-identifier hs-var">itbl</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682951679"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="#local-6989586621682951674"><span class="hs-identifier hs-var">caffy</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951680"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951681"><span class="hs-identifier hs-var">extras</span></a></span><span>
</span><span id="line-1288"></span><span>
</span><span id="line-1289"></span><span class="annot"><a href="GHC.Cmm.Info.Build.html#updInfoSRTs"><span class="hs-identifier hs-var">updInfoSRTs</span></a></span><span> </span><span id="local-6989586621682951685"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951685"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621682951686"><span class="annot"><span class="annottext">LabelMap CLabel
</span><a href="#local-6989586621682951686"><span class="hs-identifier hs-var">srt_env</span></a></span></span><span> </span><span id="local-6989586621682951687"><span class="annot"><span class="annottext">LabelMap [SRTEntry]
</span><a href="#local-6989586621682951687"><span class="hs-identifier hs-var">funSRTEnv</span></a></span></span><span> </span><span id="local-6989586621682951688"><span class="annot"><span class="annottext">CafInfo
</span><a href="#local-6989586621682951688"><span class="hs-identifier hs-var">caffy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682951689"><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951689"><span class="hs-identifier hs-var">top_info</span></a></span></span><span> </span><span id="local-6989586621682951690"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951690"><span class="hs-identifier hs-var">top_l</span></a></span></span><span> </span><span id="local-6989586621682951691"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682951691"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span id="local-6989586621682951692"><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951692"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682951693"><span class="annot"><span class="annottext">CmmDeclSRTs
</span><a href="#local-6989586621682951693"><span class="hs-identifier hs-var">closure</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (CmmInfoTable, CmmDeclSRTs)
</span><a href="#local-6989586621682951694"><span class="hs-identifier hs-var">maybeStaticClosure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmDeclSRTs
</span><a href="#local-6989586621682951695"><span class="hs-identifier hs-var">proc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmDeclSRTs
</span><a href="#local-6989586621682951693"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1291"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmDeclSRTs
</span><a href="#local-6989586621682951695"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1293"></span><span>    </span><span id="local-6989586621682951695"><span class="annot"><span class="annottext">proc :: CmmDeclSRTs
</span><a href="#local-6989586621682951695"><span class="hs-identifier hs-var hs-var">proc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
-&gt; CLabel
-&gt; [GlobalRegUse]
-&gt; GenGenCmmGraph LabelMap CmmNode
-&gt; CmmDeclSRTs
forall d h g.
h -&gt; CLabel -&gt; [GlobalRegUse] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951689"><span class="hs-identifier hs-var">top_info</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682951696"><span class="hs-identifier hs-type">newTopInfo</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951690"><span class="hs-identifier hs-var">top_l</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682951691"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951692"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1294"></span><span>    </span><span id="local-6989586621682951696"><span class="annot"><span class="annottext">newTopInfo :: LabelMap CmmInfoTable
</span><a href="#local-6989586621682951696"><span class="hs-identifier hs-var hs-var">newTopInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; CmmInfoTable -&gt; CmmInfoTable)
-&gt; LabelMap CmmInfoTable -&gt; LabelMap CmmInfoTable
forall a v. (BlockId -&gt; a -&gt; v) -&gt; LabelMap a -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapMapWithKey"><span class="hs-identifier hs-var">mapMapWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CmmInfoTable -&gt; CmmInfoTable
</span><a href="#local-6989586621682951698"><span class="hs-identifier hs-var">updInfoTbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap -&gt; LabelMap CmmInfoTable
forall (f :: * -&gt; *). GenCmmTopInfo f -&gt; f CmmInfoTable
</span><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951689"><span class="hs-identifier hs-var">top_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1295"></span><span>    </span><span id="local-6989586621682951698"><span class="annot"><span class="annottext">updInfoTbl :: BlockId -&gt; CmmInfoTable -&gt; CmmInfoTable
</span><a href="#local-6989586621682951698"><span class="hs-identifier hs-var hs-var">updInfoTbl</span></a></span></span><span> </span><span id="local-6989586621682951699"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951699"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682951700"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951700"><span class="hs-identifier hs-var">info_tbl</span></a></span></span><span>
</span><span id="line-1296"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682951699"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951692"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951701"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951701"><span class="hs-identifier hs-var">inf</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmDeclSRTs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (CmmInfoTable, CmmDeclSRTs)
</span><a href="#local-6989586621682951694"><span class="hs-identifier hs-var">maybeStaticClosure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951701"><span class="hs-identifier hs-var">inf</span></a></span><span>
</span><span id="line-1297"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951700"><span class="hs-identifier hs-var">info_tbl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.html#cit_srt"><span class="hs-identifier hs-var">cit_srt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-type">mapLookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951699"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951686"><span class="hs-identifier hs-type">srt_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1298"></span><span>
</span><span id="line-1299"></span><span>    </span><span class="hs-comment">-- Generate static closures [FUN].  Note that this also generates</span><span>
</span><span id="line-1300"></span><span>    </span><span class="hs-comment">-- static closures for thunks (CAFs), because it's easier to treat</span><span>
</span><span id="line-1301"></span><span>    </span><span class="hs-comment">-- them uniformly in the code generator.</span><span>
</span><span id="line-1302"></span><span>    </span><span class="annot"><a href="#local-6989586621682951694"><span class="hs-identifier hs-type">maybeStaticClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmDeclSRTs"><span class="hs-identifier hs-type">CmmDeclSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1303"></span><span>    </span><span id="local-6989586621682951694"><span class="annot"><span class="annottext">maybeStaticClosure :: Maybe (CmmInfoTable, CmmDeclSRTs)
</span><a href="#local-6989586621682951694"><span class="hs-identifier hs-var hs-var">maybeStaticClosure</span></a></span></span><span>
</span><span id="line-1304"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951703"><span class="annot"><span class="annottext">info_tbl :: CmmInfoTable
</span><a href="#local-6989586621682951703"><span class="hs-identifier hs-var">info_tbl</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621682951705"><span id="local-6989586621682951706"><span id="local-6989586621682951707"><span id="local-6989586621682951708"><span id="local-6989586621682951709"><span class="annot"><span class="annottext">Maybe (Id, CostCentreStack)
Maybe CLabel
CLabel
SMRep
ProfilingInfo
cit_rep :: CmmInfoTable -&gt; SMRep
cit_lbl :: CmmInfoTable -&gt; CLabel
cit_clo :: CmmInfoTable -&gt; Maybe (Id, CostCentreStack)
cit_srt :: CmmInfoTable -&gt; Maybe CLabel
cit_lbl :: CLabel
cit_rep :: SMRep
cit_prof :: ProfilingInfo
cit_srt :: Maybe CLabel
cit_clo :: Maybe (Id, CostCentreStack)
cit_prof :: CmmInfoTable -&gt; ProfilingInfo
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1305"></span><span>           </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap CmmInfoTable -&gt; Maybe CmmInfoTable
forall f. BlockId -&gt; FactBase f -&gt; Maybe f
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951692"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap -&gt; LabelMap CmmInfoTable
forall (f :: * -&gt; *). GenCmmTopInfo f -&gt; f CmmInfoTable
</span><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmTopInfo LabelMap
</span><a href="#local-6989586621682951689"><span class="hs-identifier hs-var">top_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1306"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951711"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682951711"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951712"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682951712"><span class="hs-identifier hs-var">ccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, CostCentreStack)
</span><a href="#local-6989586621682951709"><span class="hs-identifier hs-var">cit_clo</span></a></span><span>
</span><span id="line-1307"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isStaticRep"><span class="hs-identifier hs-var">isStaticRep</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951706"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1308"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1309"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682951713"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951713"><span class="hs-identifier hs-var">newInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951714"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951714"><span class="hs-identifier hs-var">srtEntries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap [SRTEntry] -&gt; Maybe [SRTEntry]
forall f. BlockId -&gt; FactBase f -&gt; Maybe f
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">GenGenCmmGraph LabelMap CmmNode
</span><a href="#local-6989586621682951692"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LabelMap [SRTEntry]
</span><a href="#local-6989586621682951687"><span class="hs-identifier hs-var">funSRTEnv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1310"></span><span>            </span><span class="annot"><span class="annottext">Maybe [SRTEntry]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1311"></span><span>              </span><span class="hs-comment">-- if we don't add SRT entries to this closure, then we</span><span>
</span><span id="line-1312"></span><span>              </span><span class="hs-comment">-- want to set the srt field in its info table as usual</span><span>
</span><span id="line-1313"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951703"><span class="hs-identifier hs-var">info_tbl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.html#cit_srt"><span class="hs-identifier hs-var">cit_srt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-type">mapLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951692"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682951686"><span class="hs-identifier hs-type">srt_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1314"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682951715"><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951715"><span class="hs-identifier hs-var">srtEntries</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc -&gt; (CmmInfoTable, [CmmLit]) -&gt; (CmmInfoTable, [CmmLit])
forall b. String -&gt; SDoc -&gt; b -&gt; b
</span><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-var">srtTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;maybeStaticFun&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [CmmLit] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951685"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951716"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1315"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951703"><span class="hs-identifier hs-var">info_tbl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682951717"><span class="hs-identifier hs-type">new_rep</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951716"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1316"></span><span>              </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682951716"><span class="annot"><span class="annottext">res :: [CmmLit]
</span><a href="#local-6989586621682951716"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951718"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html#SRTEntry"><span class="hs-identifier hs-type">SRTEntry</span></a></span><span> </span><span id="local-6989586621682951718"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951718"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SRTEntry]
</span><a href="#local-6989586621682951715"><span class="hs-identifier hs-var">srtEntries</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1317"></span><span>          </span><span id="local-6989586621682951719"><span class="annot"><span class="annottext">fields :: [CmmLit]
</span><a href="#local-6989586621682951719"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile
-&gt; CmmInfoTable
-&gt; CostCentreStack
-&gt; CafInfo
-&gt; [CmmLit]
-&gt; [CmmLit]
-&gt; [CmmLit]
</span><a href="GHC.StgToCmm.Heap.html#mkStaticClosureFields"><span class="hs-identifier hs-var">mkStaticClosureFields</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682951685"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951703"><span class="hs-identifier hs-var">info_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682951712"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="#local-6989586621682951688"><span class="hs-identifier hs-var">caffy</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951714"><span class="hs-identifier hs-var">srtEntries</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1318"></span><span>          </span><span id="local-6989586621682951717"><span class="annot"><span class="annottext">new_rep :: SMRep
</span><a href="#local-6989586621682951717"><span class="hs-identifier hs-var hs-var">new_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951706"><span class="hs-identifier hs-var">cit_rep</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1319"></span><span>             </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#HeapRep"><span class="hs-identifier hs-type">HeapRep</span></a></span><span> </span><span id="local-6989586621682951721"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951721"><span class="hs-identifier hs-var">sta</span></a></span></span><span> </span><span id="local-6989586621682951722"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682951722"><span class="hs-identifier hs-var">ptrs</span></a></span></span><span> </span><span id="local-6989586621682951723"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682951723"><span class="hs-identifier hs-var">nptrs</span></a></span></span><span> </span><span id="local-6989586621682951724"><span class="annot"><span class="annottext">ClosureTypeInfo
</span><a href="#local-6989586621682951724"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1320"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; WordOff -&gt; WordOff -&gt; ClosureTypeInfo -&gt; SMRep
</span><a href="GHC.Runtime.Heap.Layout.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682951721"><span class="hs-identifier hs-var">sta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682951722"><span class="hs-identifier hs-var">ptrs</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">[CmmLit] -&gt; WordOff
forall a. [a] -&gt; WordOff
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; WordOff
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951714"><span class="hs-identifier hs-var">srtEntries</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682951723"><span class="hs-identifier hs-var">nptrs</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureTypeInfo
</span><a href="#local-6989586621682951724"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1321"></span><span>             </span><span id="local-6989586621682951726"><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682951726"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SMRep
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;maybeStaticFun&quot;</span></span><span>
</span><span id="line-1322"></span><span>          </span><span id="local-6989586621682951727"><span class="annot"><span class="annottext">lbl :: CLabel
</span><a href="#local-6989586621682951727"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CafInfo -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkClosureLabel"><span class="hs-identifier hs-var">mkClosureLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682951711"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="#local-6989586621682951688"><span class="hs-identifier hs-var">caffy</span></a></span><span>
</span><span id="line-1323"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-1324"></span><span>          </span><span class="annot"><span class="annottext">(CmmInfoTable, CmmDeclSRTs) -&gt; Maybe (CmmInfoTable, CmmDeclSRTs)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621682951713"><span class="hs-identifier hs-var">newInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Section -&gt; CLabel -&gt; [CmmLit] -&gt; CmmDeclSRTs
forall (raw :: Bool) info stmt.
Section
-&gt; CLabel -&gt; [CmmLit] -&gt; GenCmmDecl (GenCmmStatics raw) info stmt
</span><a href="GHC.Cmm.Utils.html#mkDataLits"><span class="hs-identifier hs-var">mkDataLits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SectionType -&gt; CLabel -&gt; Section
</span><a href="GHC.Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a></span><span> </span><span class="annot"><span class="annottext">SectionType
</span><a href="GHC.Cmm.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951727"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682951727"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682951719"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1325"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CmmInfoTable, CmmDeclSRTs)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1326"></span><span>
</span><span id="line-1327"></span><span>
</span><span id="line-1328"></span><span id="local-6989586621682950566"><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-type">srtTrace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682950566"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682950566"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1329"></span><span class="hs-comment">-- srtTrace = pprTrace</span><span>
</span><span id="line-1330"></span><span id="srtTrace"><span class="annot"><span class="annottext">srtTrace :: forall b. String -&gt; SDoc -&gt; b -&gt; b
</span><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-var hs-var">srtTrace</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951728"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682951728"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682951728"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1331"></span><span>
</span><span id="line-1332"></span><span id="local-6989586621682950644"><span class="annot"><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-type">srtTraceM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621682950644"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682950644"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1333"></span><span id="srtTraceM"><span class="annot"><span class="annottext">srtTraceM :: forall (f :: * -&gt; *). Applicative f =&gt; String -&gt; SDoc -&gt; f ()
</span><a href="GHC.Cmm.Info.Build.html#srtTraceM"><span class="hs-identifier hs-var hs-var">srtTraceM</span></a></span></span><span> </span><span id="local-6989586621682951731"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682951731"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621682951732"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682951732"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; f () -&gt; f ()
forall b. String -&gt; SDoc -&gt; b -&gt; b
</span><a href="GHC.Cmm.Info.Build.html#srtTrace"><span class="hs-identifier hs-var">srtTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682951731"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682951732"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1334"></span></pre></body></html>