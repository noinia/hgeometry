<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- The transition from Int to Word64 for uniques makes functions slightly larger</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- without this GHC option some optimizations fail to fire.</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- See https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10568#note_505751</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -fspec-constr-threshold=10000 #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html"><span class="hs-identifier">GHC.Linker.Deps</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier">LinkDepsOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDeps"><span class="hs-identifier">LinkDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#getLinkDeps"><span class="hs-identifier">getLinkDeps</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html"><span class="hs-identifier">GHC.Unit.Finder</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html"><span class="hs-identifier">GHC.Unit.Module.WholeCoreBindings</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html"><span class="hs-identifier">GHC.Unit.Module.Deps</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html"><span class="hs-identifier">GHC.Unit.Module.Graph</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Types.html"><span class="hs-identifier">GHC.Iface.Errors.Types</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Ppr.html"><span class="hs-identifier">GHC.Iface.Errors.Ppr</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html"><span class="hs-identifier">GHC.Unit.Home</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isSuffixOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">data</span><span> </span><span id="LinkDepsOpts"><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-var">LinkDepsOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LinkDepsOpts"><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-var">LinkDepsOpts</span></a></span></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="ldObjSuffix"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; String
</span><a href="GHC.Linker.Deps.html#ldObjSuffix"><span class="hs-identifier hs-var hs-var">ldObjSuffix</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                        </span><span class="annot"><span class="hs-comment">-- ^ Suffix of .o files</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldForceDyn"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Bool
</span><a href="GHC.Linker.Deps.html#ldForceDyn"><span class="hs-identifier hs-var hs-var">ldForceDyn</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                          </span><span class="annot"><span class="hs-comment">-- ^ Always use .dyn_o?</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldOneShotMode"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Bool
</span><a href="GHC.Linker.Deps.html#ldOneShotMode"><span class="hs-identifier hs-var hs-var">ldOneShotMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                          </span><span class="annot"><span class="hs-comment">-- ^ Is the driver in one-shot mode?</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldModuleGraph"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; ModuleGraph
</span><a href="GHC.Linker.Deps.html#ldModuleGraph"><span class="hs-identifier hs-var hs-var">ldModuleGraph</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldUnitEnv"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; UnitEnv
</span><a href="GHC.Linker.Deps.html#ldUnitEnv"><span class="hs-identifier hs-var hs-var">ldUnitEnv</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldPprOpts"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SDocContext
</span><a href="GHC.Linker.Deps.html#ldPprOpts"><span class="hs-identifier hs-var hs-var">ldPprOpts</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDocContext"><span class="hs-identifier hs-type">SDocContext</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Rendering options for error messages</span></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldUseByteCode"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Bool
</span><a href="GHC.Linker.Deps.html#ldUseByteCode"><span class="hs-identifier hs-var hs-var">ldUseByteCode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                          </span><span class="annot"><span class="hs-comment">-- ^ Use bytecode rather than objects</span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldMsgOpts"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; DiagnosticOpts IfaceMessage
</span><a href="GHC.Linker.Deps.html#ldMsgOpts"><span class="hs-identifier hs-var hs-var">ldMsgOpts</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#DiagnosticOpts"><span class="hs-identifier hs-type">DiagnosticOpts</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Types.html#IfaceMessage"><span class="hs-identifier hs-type">IfaceMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Options for diagnostics</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldWays"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Ways
</span><a href="GHC.Linker.Deps.html#ldWays"><span class="hs-identifier hs-var hs-var">ldWays</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Platform.Ways.html#Ways"><span class="hs-identifier hs-type">Ways</span></a></span><span>                          </span><span class="annot"><span class="hs-comment">-- ^ Enabled ways</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldFinderCache"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; FinderCache
</span><a href="GHC.Linker.Deps.html#ldFinderCache"><span class="hs-identifier hs-var hs-var">ldFinderCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FinderCache"><span class="hs-identifier hs-type">FinderCache</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldFinderOpts"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; FinderOpts
</span><a href="GHC.Linker.Deps.html#ldFinderOpts"><span class="hs-identifier hs-var hs-var">ldFinderOpts</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FinderOpts"><span class="hs-identifier hs-type">FinderOpts</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldLoadIface"><span class="annot"><span class="annottext">LinkDepsOpts
-&gt; SDoc -&gt; Module -&gt; IO (MaybeErr MissingInterfaceError ModIface)
</span><a href="GHC.Linker.Deps.html#ldLoadIface"><span class="hs-identifier hs-var hs-var">ldLoadIface</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Types.html#MissingInterfaceError"><span class="hs-identifier hs-type">MissingInterfaceError</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldLoadByteCode"><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Module -&gt; IO (Maybe Linkable)
</span><a href="GHC.Linker.Deps.html#ldLoadByteCode"><span class="hs-identifier hs-var hs-var">ldLoadByteCode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">data</span><span> </span><span id="LinkDeps"><span class="annot"><a href="GHC.Linker.Deps.html#LinkDeps"><span class="hs-identifier hs-var">LinkDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LinkDeps"><span class="annot"><a href="GHC.Linker.Deps.html#LinkDeps"><span class="hs-identifier hs-var">LinkDeps</span></a></span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="ldNeededLinkables"><span class="annot"><span class="annottext">LinkDeps -&gt; [Linkable]
</span><a href="GHC.Linker.Deps.html#ldNeededLinkables"><span class="hs-identifier hs-var hs-var">ldNeededLinkables</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldAllLinkables"><span class="annot"><span class="annottext">LinkDeps -&gt; [Linkable]
</span><a href="GHC.Linker.Deps.html#ldAllLinkables"><span class="hs-identifier hs-var hs-var">ldAllLinkables</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldUnits"><span class="annot"><span class="annottext">LinkDeps -&gt; [UnitId]
</span><a href="GHC.Linker.Deps.html#ldUnits"><span class="hs-identifier hs-var hs-var">ldUnits</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ldNeededUnits"><span class="annot"><span class="annottext">LinkDeps -&gt; UniqDSet UnitId
</span><a href="GHC.Linker.Deps.html#ldNeededUnits"><span class="hs-identifier hs-var hs-var">ldNeededUnits</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Find all the packages and linkables that a set of modules depends on</span><span>
</span><span id="line-84"></span><span class="hs-comment">--</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- Return the module and package dependencies for the needed modules.</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- See Note [Object File Dependencies]</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- Fails with an IO exception if it can't find enough files</span><span>
</span><span id="line-89"></span><span class="hs-comment">--</span><span>
</span><span id="line-90"></span><span class="annot"><a href="GHC.Linker.Deps.html#getLinkDeps"><span class="hs-identifier hs-type">getLinkDeps</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-type">LinkDepsOpts</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#LoaderState"><span class="hs-identifier hs-type">LoaderState</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>      </span><span class="hs-comment">-- for error messages</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- If you need these</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDeps"><span class="hs-identifier hs-type">LinkDeps</span></a></span><span>  </span><span class="hs-comment">-- ... then link these first</span><span>
</span><span id="line-97"></span><span id="getLinkDeps"><span class="annot"><span class="annottext">getLinkDeps :: LinkDepsOpts
-&gt; Interp -&gt; LoaderState -&gt; SrcSpan -&gt; [Module] -&gt; IO LinkDeps
</span><a href="GHC.Linker.Deps.html#getLinkDeps"><span class="hs-identifier hs-var hs-var">getLinkDeps</span></a></span></span><span> </span><span id="local-6989586621682962588"><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962588"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682962589"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682962589"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682962590"><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621682962590"><span class="hs-identifier hs-var">pls</span></a></span></span><span> </span><span id="local-6989586621682962591"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962591"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621682962592"><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962592"><span class="hs-identifier hs-var">mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-comment">-- The interpreter and dynamic linker can only handle object code built</span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-comment">-- the &quot;normal&quot; way, i.e. no non-std ways like profiling or ticky-ticky.</span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-comment">-- So here we check the build tag: if we're building a non-standard way</span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-comment">-- then we need to find &amp; link object files built the &quot;normal&quot; way.</span><span>
</span><span id="line-102"></span><span>      </span><span id="local-6989586621682962593"><span class="annot"><a href="#local-6989586621682962593"><span class="hs-identifier hs-var">maybe_normal_osuf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Interp -&gt; SrcSpan -&gt; IO (Maybe String)
</span><a href="GHC.Linker.Deps.html#checkNonStdWay"><span class="hs-identifier hs-var">checkNonStdWay</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962588"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682962589"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962591"><span class="hs-identifier hs-var">span</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><a href="GHC.Linker.Deps.html#get_link_deps"><span class="hs-identifier hs-type">get_link_deps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962588"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962590"><span class="hs-identifier hs-type">pls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962593"><span class="hs-identifier hs-type">maybe_normal_osuf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962591"><span class="hs-identifier hs-type">span</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962592"><span class="hs-identifier hs-type">mods</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="GHC.Linker.Deps.html#get_link_deps"><span class="hs-identifier hs-type">get_link_deps</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-type">LinkDepsOpts</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#LoaderState"><span class="hs-identifier hs-type">LoaderState</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>  </span><span class="hs-comment">-- replace object suffixes?</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDeps"><span class="hs-identifier hs-type">LinkDeps</span></a></span><span>
</span><span id="line-114"></span><span id="get_link_deps"><span class="annot"><span class="annottext">get_link_deps :: LinkDepsOpts
-&gt; LoaderState
-&gt; Maybe String
-&gt; SrcSpan
-&gt; [Module]
-&gt; IO LinkDeps
</span><a href="GHC.Linker.Deps.html#get_link_deps"><span class="hs-identifier hs-var hs-var">get_link_deps</span></a></span></span><span> </span><span id="local-6989586621682962597"><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682962598"><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621682962598"><span class="hs-identifier hs-var">pls</span></a></span></span><span> </span><span id="local-6989586621682962599"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682962599"><span class="hs-identifier hs-var">maybe_normal_osuf</span></a></span></span><span> </span><span id="local-6989586621682962600"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962600"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621682962601"><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962601"><span class="hs-identifier hs-var">mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-comment">-- 1.  Find the dependent home-pkg-modules/packages from each iface</span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-comment">-- (omitting modules from the interactive package, which is already linked)</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682962602"><span class="annot"><a href="#local-6989586621682962602"><span class="hs-identifier hs-var">mods_s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682962603"><span class="annot"><a href="#local-6989586621682962603"><span class="hs-identifier hs-var">pkgs_s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-118"></span><span>          </span><span class="hs-comment">-- Why two code paths here? There is a significant amount of repeated work</span><span>
</span><span id="line-119"></span><span>          </span><span class="hs-comment">-- performed calculating transitive dependencies</span><span>
</span><span id="line-120"></span><span>          </span><span class="hs-comment">-- if --make uses the oneShot code path (see MultiLayerModulesTH_* tests)</span><span>
</span><span id="line-121"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Bool
</span><a href="GHC.Linker.Deps.html#ldOneShotMode"><span class="hs-identifier hs-var">ldOneShotMode</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-122"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Module]
-&gt; UniqDSet Module
-&gt; UniqDSet UnitId
-&gt; IO ([Module], UniqDSet UnitId)
</span><a href="#local-6989586621682962604"><span class="hs-identifier hs-var">follow_deps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module -&gt; Bool) -&gt; [Module] -&gt; [Module]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-var">isInteractiveModule</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962601"><span class="hs-identifier hs-var">mods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>                              </span><span class="annot"><span class="annottext">UniqDSet Module
forall a. UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#emptyUniqDSet"><span class="hs-identifier hs-var">emptyUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId
forall a. UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#emptyUniqDSet"><span class="hs-identifier hs-var">emptyUniqDSet</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682962608"><span class="annot"><a href="#local-6989586621682962608"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682962609"><span class="annot"><a href="#local-6989586621682962609"><span class="hs-identifier hs-var">mmods</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UniqDSet UnitId, Maybe Module)]
-&gt; ([UniqDSet UnitId], [Maybe Module])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(UniqDSet UnitId, Maybe Module)]
 -&gt; ([UniqDSet UnitId], [Maybe Module]))
-&gt; IO [(UniqDSet UnitId, Maybe Module)]
-&gt; IO ([UniqDSet UnitId], [Maybe Module])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ModNodeKeyWithUid -&gt; IO (UniqDSet UnitId, Maybe Module))
-&gt; [ModNodeKeyWithUid] -&gt; IO [(UniqDSet UnitId, Maybe Module)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; IO (UniqDSet UnitId, Maybe Module)
</span><a href="#local-6989586621682962613"><span class="hs-identifier hs-var">get_mod_info</span></a></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621682962614"><span class="hs-identifier hs-var">all_home_mods</span></a></span><span>
</span><span id="line-126"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">catMaybes</span></span><span> </span><span class="annot"><a href="#local-6989586621682962609"><span class="hs-identifier hs-type">mmods</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html#unionManyUniqDSets"><span class="hs-identifier hs-type">unionManyUniqDSets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682962617"><span class="hs-identifier hs-type">init_pkg_set</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682962608"><span class="hs-identifier hs-type">pkgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-comment">-- 2.  Exclude ones already linked</span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-comment">--      Main reason: avoid findModule calls in get_linkable</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682962618"><span class="annot"><a href="#local-6989586621682962618"><span class="hs-identifier hs-var">mods_needed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682962619"><span class="annot"><a href="#local-6989586621682962619"><span class="hs-identifier hs-var">links_got</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-type">partitionWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962621"><span class="hs-identifier hs-type">split_mods</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962602"><span class="hs-identifier hs-type">mods_s</span></a></span><span>
</span><span id="line-132"></span><span>            </span><span id="local-6989586621682962622"><span class="annot"><a href="#local-6989586621682962622"><span class="hs-identifier hs-var hs-var">pkgs_needed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqDFM UnitId UnitId -&gt; [UnitId]
forall {k} (key :: k) elt. UniqDFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.DFM.html#eltsUDFM"><span class="hs-identifier hs-var">eltsUDFM</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqDFM UnitId UnitId -&gt; [UnitId])
-&gt; UniqDFM UnitId UnitId -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId -&gt; UniqDFM UnitId UnitId
forall a. UniqDSet a -&gt; UniqDFM a a
</span><a href="GHC.Types.Unique.DSet.html#getUniqDSet"><span class="hs-identifier hs-var">getUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962603"><span class="hs-identifier hs-var">pkgs_s</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDFM UnitId UnitId
-&gt; UniqDFM UnitId LoadedPkgInfo -&gt; UniqDFM UnitId UnitId
forall {k} (key :: k) elt1 elt2.
UniqDFM key elt1 -&gt; UniqDFM key elt2 -&gt; UniqDFM key elt1
</span><a href="GHC.Types.Unique.DFM.html#minusUDFM"><span class="hs-operator hs-var">`minusUDFM`</span></a></span><span> </span><span class="annot"><span class="annottext">LoaderState -&gt; UniqDFM UnitId LoadedPkgInfo
</span><a href="GHC.Linker.Types.html#pkgs_loaded"><span class="hs-identifier hs-var">pkgs_loaded</span></a></span><span> </span><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621682962598"><span class="hs-identifier hs-var">pls</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>            </span><span id="local-6989586621682962621"><span class="annot"><a href="#local-6989586621682962621"><span class="hs-identifier hs-var hs-var">split_mods</span></a></span></span><span> </span><span id="local-6989586621682962627"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962627"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682962628"><span class="annot"><span class="annottext">is_linked :: Maybe Linkable
</span><a href="#local-6989586621682962628"><span class="hs-identifier hs-var hs-var">is_linked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleEnv Linkable -&gt; Module -&gt; Maybe Linkable
forall a. ModuleEnv a -&gt; Module -&gt; Maybe a
</span><a href="GHC.Unit.Module.Env.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoaderState -&gt; ModuleEnv Linkable
</span><a href="GHC.Linker.Types.html#objs_loaded"><span class="hs-identifier hs-var">objs_loaded</span></a></span><span> </span><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621682962598"><span class="hs-identifier hs-var">pls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962627"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-136"></span><span>                                </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; Maybe Linkable -&gt; Maybe Linkable
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleEnv Linkable -&gt; Module -&gt; Maybe Linkable
forall a. ModuleEnv a -&gt; Module -&gt; Maybe a
</span><a href="GHC.Unit.Module.Env.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoaderState -&gt; ModuleEnv Linkable
</span><a href="GHC.Linker.Types.html#bcos_loaded"><span class="hs-identifier hs-var">bcos_loaded</span></a></span><span> </span><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621682962598"><span class="hs-identifier hs-var">pls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962627"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-137"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621682962628"><span class="hs-identifier hs-var">is_linked</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-138"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962633"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682962633"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; Either Module Linkable
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682962633"><span class="hs-identifier hs-var">linkable</span></a></span><span>
</span><span id="line-139"></span><span>                     </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Either Module Linkable
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962627"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-comment">-- 3.  For each dependent module, find its linkable</span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-comment">--     This will either be in the HPT or (in the case of one-shot</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">--     compilation) we may need to use maybe_getFileLinkable</span><span>
</span><span id="line-144"></span><span>      </span><span id="local-6989586621682962634"><span class="annot"><a href="#local-6989586621682962634"><span class="hs-identifier hs-var">lnks_needed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682962635"><span class="hs-identifier hs-type">get_linkable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Deps.html#ldObjSuffix"><span class="hs-identifier hs-var">ldObjSuffix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962597"><span class="hs-identifier hs-type">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682962618"><span class="hs-identifier hs-type">mods_needed</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDeps"><span class="hs-identifier hs-type">LinkDeps</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#ldNeededLinkables"><span class="hs-identifier hs-var">ldNeededLinkables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682962634"><span class="hs-identifier hs-type">lnks_needed</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#ldAllLinkables"><span class="hs-identifier hs-var">ldAllLinkables</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682962619"><span class="hs-identifier hs-type">links_got</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682962634"><span class="hs-identifier hs-type">lnks_needed</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#ldUnits"><span class="hs-identifier hs-var">ldUnits</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682962622"><span class="hs-identifier hs-type">pkgs_needed</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#ldNeededUnits"><span class="hs-identifier hs-var">ldNeededUnits</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682962603"><span class="hs-identifier hs-type">pkgs_s</span></a></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621682962636"><span class="annot"><span class="annottext">mod_graph :: ModuleGraph
</span><a href="#local-6989586621682962636"><span class="hs-identifier hs-var hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; ModuleGraph
</span><a href="GHC.Linker.Deps.html#ldModuleGraph"><span class="hs-identifier hs-var">ldModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621682962637"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621682962637"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; UnitEnv
</span><a href="GHC.Linker.Deps.html#ldUnitEnv"><span class="hs-identifier hs-var">ldUnitEnv</span></a></span><span>     </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- This code is used in `--make` mode to calculate the home package and unit dependencies</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- for a set of modules.</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">-- It is significantly more efficient to use the shared transitive dependency</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">-- calculation than to compute the transitive dependency set in the same manner as oneShot mode.</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- It is also a matter of correctness to use the module graph so that dependencies between home units</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- is resolved correctly.</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="#local-6989586621682962638"><span class="hs-identifier hs-type">make_deps_loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621682962638"><span class="annot"><span class="annottext">make_deps_loop :: (UniqDSet UnitId, Set NodeKey)
-&gt; [ModNodeKeyWithUid] -&gt; (UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962638"><span class="hs-identifier hs-var hs-var">make_deps_loop</span></a></span></span><span> </span><span id="local-6989586621682962639"><span class="annot"><span class="annottext">(UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962639"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962639"><span class="hs-identifier hs-var">found</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="#local-6989586621682962638"><span class="hs-identifier hs-var">make_deps_loop</span></a></span><span> </span><span id="local-6989586621682962640"><span class="annot"><span class="annottext">found :: (UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962640"><span class="hs-identifier hs-var">found</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682962641"><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962641"><span class="hs-identifier hs-var">found_units</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682962642"><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962642"><span class="hs-identifier hs-var">found_mods</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682962643"><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682962643"><span class="hs-identifier hs-var">nk</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682962644"><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621682962644"><span class="hs-identifier hs-var">nexts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682962643"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Set NodeKey -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962642"><span class="hs-identifier hs-var">found_mods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqDSet UnitId, Set NodeKey)
-&gt; [ModNodeKeyWithUid] -&gt; (UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962638"><span class="hs-identifier hs-var">make_deps_loop</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962640"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621682962644"><span class="hs-identifier hs-var">nexts</span></a></span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Map NodeKey (Set NodeKey) -&gt; Maybe (Set NodeKey)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682962643"><span class="hs-identifier hs-var">nk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; Map NodeKey (Set NodeKey)
</span><a href="GHC.Unit.Module.Graph.html#mgTransDeps"><span class="hs-identifier hs-var">mgTransDeps</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682962636"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-170"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962649"><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962649"><span class="hs-identifier hs-var">trans_deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682962650"><span class="annot"><span class="annottext">deps :: Set NodeKey
</span><a href="#local-6989586621682962650"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Set NodeKey -&gt; Set NodeKey
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682962643"><span class="hs-identifier hs-var">nk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962649"><span class="hs-identifier hs-var">trans_deps</span></a></span><span>
</span><span id="line-172"></span><span>                  </span><span class="hs-comment">-- See #936 and the ghci.prog007 test for why we have to continue traversing through</span><span>
</span><span id="line-173"></span><span>                  </span><span class="hs-comment">-- boot modules.</span><span>
</span><span id="line-174"></span><span>                  </span><span id="local-6989586621682962652"><span class="annot"><span class="annottext">todo_boot_mods :: [ModNodeKeyWithUid]
</span><a href="#local-6989586621682962652"><span class="hs-identifier hs-var hs-var">todo_boot_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; UnitId -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-var">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; ModuleNameWithIsBoot
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682962655"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682962657"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-type">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span id="local-6989586621682962655"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682962655"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682962657"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682962657"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set NodeKey -&gt; [NodeKey]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962649"><span class="hs-identifier hs-var">trans_deps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(UniqDSet UnitId, Set NodeKey)
-&gt; [ModNodeKeyWithUid] -&gt; (UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962638"><span class="hs-identifier hs-var">make_deps_loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962641"><span class="hs-identifier hs-var">found_units</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962650"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey -&gt; Set NodeKey -&gt; Set NodeKey
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962642"><span class="hs-identifier hs-var">found_mods</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621682962652"><span class="hs-identifier hs-var">todo_boot_mods</span></a></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621682962644"><span class="hs-identifier hs-var">nexts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Set NodeKey)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682962661"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682962661"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682962643"><span class="hs-identifier hs-var">nk</span></a></span><span>
</span><span id="line-178"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(UniqDSet UnitId, Set NodeKey)
-&gt; [ModNodeKeyWithUid] -&gt; (UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962638"><span class="hs-identifier hs-var">make_deps_loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDSet UnitId -&gt; UnitId -&gt; UniqDSet UnitId
forall a. Uniquable a =&gt; UniqDSet a -&gt; a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#addOneToUniqDSet"><span class="hs-identifier hs-var">addOneToUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962641"><span class="hs-identifier hs-var">found_units</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682962661"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962642"><span class="hs-identifier hs-var">found_mods</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621682962644"><span class="hs-identifier hs-var">nexts</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621682962663"><span class="annot"><span class="annottext">mkNk :: Module -&gt; ModNodeKeyWithUid
</span><a href="#local-6989586621682962663"><span class="hs-identifier hs-var hs-var">mkNk</span></a></span></span><span> </span><span id="local-6989586621682962664"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962664"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; UnitId -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-var">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; ModuleNameWithIsBoot
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962664"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962664"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682962617"><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962617"><span class="hs-identifier hs-var">init_pkg_set</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682962667"><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962667"><span class="hs-identifier hs-var">all_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqDSet UnitId, Set NodeKey)
-&gt; [ModNodeKeyWithUid] -&gt; (UniqDSet UnitId, Set NodeKey)
</span><a href="#local-6989586621682962638"><span class="hs-identifier hs-var">make_deps_loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDSet UnitId
forall a. UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#emptyUniqDSet"><span class="hs-identifier hs-var">emptyUniqDSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set NodeKey
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ModNodeKeyWithUid] -&gt; (UniqDSet UnitId, Set NodeKey))
-&gt; [ModNodeKeyWithUid] -&gt; (UniqDSet UnitId, Set NodeKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModNodeKeyWithUid) -&gt; [Module] -&gt; [ModNodeKeyWithUid]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModNodeKeyWithUid
</span><a href="#local-6989586621682962663"><span class="hs-identifier hs-var">mkNk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module -&gt; Bool) -&gt; [Module] -&gt; [Module]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-var">isInteractiveModule</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962601"><span class="hs-identifier hs-var">mods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621682962614"><span class="annot"><span class="annottext">all_home_mods :: [ModNodeKeyWithUid]
</span><a href="#local-6989586621682962614"><span class="hs-identifier hs-var hs-var">all_home_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682962669"><span class="hs-identifier hs-var">with_uid</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-type">NodeKey_Module</span></a></span><span> </span><span id="local-6989586621682962669"><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682962669"><span class="hs-identifier hs-var">with_uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set NodeKey -&gt; [NodeKey]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682962667"><span class="hs-identifier hs-var">all_deps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621682962613"><span class="annot"><span class="annottext">get_mod_info :: ModNodeKeyWithUid -&gt; IO (UniqDSet UnitId, Maybe Module)
</span><a href="#local-6989586621682962613"><span class="hs-identifier hs-var hs-var">get_mod_info</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span id="local-6989586621682962670"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682962670"><span class="hs-identifier hs-var">gwib</span></a></span></span><span> </span><span id="local-6989586621682962671"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682962671"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph -&gt; UnitId -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Env.html#lookupHug"><span class="hs-identifier hs-var">lookupHug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; HomeUnitGraph
</span><a href="GHC.Unit.Env.html#ue_home_unit_graph"><span class="hs-identifier hs-var">ue_home_unit_graph</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682962637"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682962671"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; ModuleName
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682962670"><span class="hs-identifier hs-var">gwib</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962675"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962675"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682962676"><span class="annot"><span class="annottext">iface :: ModIface
</span><a href="#local-6989586621682962676"><span class="hs-identifier hs-var hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962675"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>              </span><span id="local-6989586621682962678"><span class="annot"><span class="annottext">mmod :: IO (Maybe Module)
</span><a href="#local-6989586621682962678"><span class="hs-identifier hs-var hs-var">mmod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; HscSource
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; HscSource
</span><a href="GHC.Unit.Module.ModIface.html#mi_hsc_src"><span class="hs-identifier hs-var">mi_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682962676"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-190"></span><span>                      </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Module -&gt; IO (Maybe Module)
forall a. Module -&gt; IO a
</span><a href="#local-6989586621682962681"><span class="hs-identifier hs-var">link_boot_mod_error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682962676"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>                      </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Module -&gt; IO (Maybe Module)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Module -&gt; IO (Maybe Module))
-&gt; Maybe Module -&gt; IO (Maybe Module)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Maybe Module
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682962676"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitId] -&gt; UniqDSet UnitId
forall a. Uniquable a =&gt; [a] -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#mkUniqDSet"><span class="hs-identifier hs-var">mkUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; UniqDSet UnitId) -&gt; [UnitId] -&gt; UniqDSet UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set UnitId -&gt; [UnitId]) -&gt; Set UnitId -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#dep_direct_pkgs"><span class="hs-identifier hs-var">dep_direct_pkgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Dependencies
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Dependencies
</span><a href="GHC.Unit.Module.ModIface.html#mi_deps"><span class="hs-identifier hs-var">mi_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682962676"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Module -&gt; (UniqDSet UnitId, Maybe Module))
-&gt; IO (Maybe Module) -&gt; IO (UniqDSet UnitId, Maybe Module)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>  </span><span class="annot"><span class="annottext">IO (Maybe Module)
</span><a href="#local-6989586621682962678"><span class="hs-identifier hs-var">mmod</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SDoc -&gt; IO (UniqDSet UnitId, Maybe Module)
forall a. LinkDepsOpts -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#throwProgramError"><span class="hs-identifier hs-var">throwProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO (UniqDSet UnitId, Maybe Module))
-&gt; SDoc -&gt; IO (UniqDSet UnitId, Maybe Module)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getLinkDeps: Home module not loaded&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; ModuleName
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682962670"><span class="hs-identifier hs-var">gwib</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682962671"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>       </span><span class="hs-comment">-- This code is used in one-shot mode to traverse downwards through the HPT</span><span>
</span><span id="line-199"></span><span>       </span><span class="hs-comment">-- to find all link dependencies.</span><span>
</span><span id="line-200"></span><span>       </span><span class="hs-comment">-- The ModIface contains the transitive closure of the module dependencies</span><span>
</span><span id="line-201"></span><span>       </span><span class="hs-comment">-- within the current package, *except* for boot modules: if we encounter</span><span>
</span><span id="line-202"></span><span>       </span><span class="hs-comment">-- a boot module, we have to find its real interface and discover the</span><span>
</span><span id="line-203"></span><span>       </span><span class="hs-comment">-- dependencies of that.  Hence we need to traverse the dependency</span><span>
</span><span id="line-204"></span><span>       </span><span class="hs-comment">-- tree recursively.  See bug #936, testcase ghci/prog007.</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="#local-6989586621682962604"><span class="hs-identifier hs-type">follow_deps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- modules to follow</span><span>
</span><span id="line-206"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>         </span><span class="hs-comment">-- accum. module dependencies</span><span>
</span><span id="line-207"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>          </span><span class="hs-comment">-- accum. package dependencies</span><span>
</span><span id="line-208"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- result</span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621682962604"><span class="annot"><span class="annottext">follow_deps :: [Module]
-&gt; UniqDSet Module
-&gt; UniqDSet UnitId
-&gt; IO ([Module], UniqDSet UnitId)
</span><a href="#local-6989586621682962604"><span class="hs-identifier hs-var hs-var">follow_deps</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span id="local-6989586621682962690"><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962690"><span class="hs-identifier hs-var">acc_mods</span></a></span></span><span> </span><span id="local-6989586621682962691"><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962691"><span class="hs-identifier hs-var">acc_pkgs</span></a></span></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Module], UniqDSet UnitId) -&gt; IO ([Module], UniqDSet UnitId)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDSet Module -&gt; [Module]
forall a. UniqDSet a -&gt; [a]
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962690"><span class="hs-identifier hs-var">acc_mods</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962691"><span class="hs-identifier hs-var">acc_pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="#local-6989586621682962604"><span class="hs-identifier hs-var">follow_deps</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682962693"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962693"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682962694"><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962694"><span class="hs-identifier hs-var">mods</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682962695"><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962695"><span class="hs-identifier hs-var">acc_mods</span></a></span></span><span> </span><span id="local-6989586621682962696"><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962696"><span class="hs-identifier hs-var">acc_pkgs</span></a></span></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>          </span><span id="local-6989586621682962697"><span class="annot"><a href="#local-6989586621682962697"><span class="hs-identifier hs-var">mb_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
-&gt; SDoc -&gt; Module -&gt; IO (MaybeErr MissingInterfaceError ModIface)
</span><a href="GHC.Linker.Deps.html#ldLoadIface"><span class="hs-identifier hs-var">ldLoadIface</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962698"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962693"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-214"></span><span>          </span><span id="local-6989586621682962699"><span class="annot"><a href="#local-6989586621682962699"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682962697"><span class="hs-identifier hs-type">mb_iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>                    </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621682962701"><span class="annot"><span class="annottext">MissingInterfaceError
</span><a href="#local-6989586621682962701"><span class="hs-identifier hs-var">err</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SDoc -&gt; IO ModIface
forall a. LinkDepsOpts -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#throwProgramError"><span class="hs-identifier hs-var">throwProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ModIface) -&gt; SDoc -&gt; IO ModIface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-216"></span><span>                      </span><span class="annot"><span class="annottext">IfaceMessageOpts -&gt; MissingInterfaceError -&gt; SDoc
</span><a href="GHC.Iface.Errors.Ppr.html#missingInterfaceErrorDiagnostic"><span class="hs-identifier hs-var">missingInterfaceErrorDiagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; DiagnosticOpts IfaceMessage
</span><a href="GHC.Linker.Deps.html#ldMsgOpts"><span class="hs-identifier hs-var">ldMsgOpts</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MissingInterfaceError
</span><a href="#local-6989586621682962701"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-217"></span><span>                    </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621682962704"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682962704"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IO ModIface
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682962704"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_boot"><span class="hs-identifier hs-type">mi_boot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962699"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-type">IsBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682962681"><span class="hs-identifier hs-type">link_boot_mod_error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962693"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-222"></span><span>            </span><span id="local-6989586621682962707"><span class="annot"><a href="#local-6989586621682962707"><span class="hs-identifier hs-var hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962693"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span id="local-6989586621682962709"><span class="annot"><a href="#local-6989586621682962709"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Dependencies
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Dependencies
</span><a href="GHC.Unit.Module.ModIface.html#mi_deps"><span class="hs-identifier hs-var">mi_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682962699"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>            </span><span id="local-6989586621682962710"><span class="annot"><a href="#local-6989586621682962710"><span class="hs-identifier hs-var hs-var">pkg_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#dep_direct_pkgs"><span class="hs-identifier hs-var">dep_direct_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621682962709"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682962711"><span class="annot"><a href="#local-6989586621682962711"><span class="hs-identifier hs-var">boot_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682962712"><span class="annot"><a href="#local-6989586621682962712"><span class="hs-identifier hs-var">mod_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-type">partitionWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-type">Set.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#dep_direct_mods"><span class="hs-identifier hs-var">dep_direct_mods</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962709"><span class="hs-identifier hs-type">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-227"></span><span>              </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span id="local-6989586621682962715"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682962715"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Either ModuleName ModuleName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682962715"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-229"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span id="local-6989586621682962716"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682962716"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Either ModuleName ModuleName
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682962716"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>            </span><span id="local-6989586621682962717"><span class="annot"><a href="#local-6989586621682962717"><span class="hs-identifier hs-var hs-var">mod_deps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Unit.Env.html#ue_homeUnit"><span class="hs-identifier hs-var">ue_homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682962637"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-232"></span><span>                          </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962719"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962719"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Module -&gt; Bool) -&gt; [Module] -&gt; [Module]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Module -&gt; Bool) -&gt; Module -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UniqDSet Module -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqDSet a -&gt; Bool
</span><a href="GHC.Types.Unique.DSet.html#elementOfUniqDSet"><span class="hs-operator hs-var">`elementOfUniqDSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962695"><span class="hs-identifier hs-var">acc_mods</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; Module) -&gt; [ModuleName] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962719"><span class="hs-identifier hs-var">home_unit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ModuleName] -&gt; [Module]) -&gt; [ModuleName] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682962711"><span class="hs-identifier hs-var">boot_deps</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; [ModuleName] -&gt; [ModuleName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682962712"><span class="hs-identifier hs-var">mod_deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>            </span><span id="local-6989586621682962724"><span class="annot"><a href="#local-6989586621682962724"><span class="hs-identifier hs-var hs-var">acc_mods'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Unit.Env.html#ue_homeUnit"><span class="hs-identifier hs-var">ue_homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682962637"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>                          </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962695"><span class="hs-identifier hs-var">acc_mods</span></a></span><span>
</span><span id="line-236"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962725"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962725"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqDSet Module -&gt; [Module] -&gt; UniqDSet Module
forall a. Uniquable a =&gt; UniqDSet a -&gt; [a] -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#addListToUniqDSet"><span class="hs-identifier hs-var">addListToUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962695"><span class="hs-identifier hs-var">acc_mods</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962693"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Module] -&gt; [Module]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; Module) -&gt; [ModuleName] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962725"><span class="hs-identifier hs-var">home_unit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682962712"><span class="hs-identifier hs-var">mod_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>            </span><span id="local-6989586621682962727"><span class="annot"><a href="#local-6989586621682962727"><span class="hs-identifier hs-var hs-var">acc_pkgs'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId -&gt; [UnitId] -&gt; UniqDSet UnitId
forall a. Uniquable a =&gt; UniqDSet a -&gt; [a] -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#addListToUniqDSet"><span class="hs-identifier hs-var">addListToUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962696"><span class="hs-identifier hs-var">acc_pkgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682962710"><span class="hs-identifier hs-var">pkg_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#ue_homeUnit"><span class="hs-identifier hs-type">ue_homeUnit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962637"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-240"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962728"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962728"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; Unit -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeUnit"><span class="hs-identifier hs-var">isHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962728"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621682962707"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">[Module]
-&gt; UniqDSet Module
-&gt; UniqDSet UnitId
-&gt; IO ([Module], UniqDSet UnitId)
</span><a href="#local-6989586621682962604"><span class="hs-identifier hs-var">follow_deps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962717"><span class="hs-identifier hs-var">mod_deps'</span></a></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; [Module] -&gt; [Module]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962694"><span class="hs-identifier hs-var">mods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>                                                                      </span><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962724"><span class="hs-identifier hs-var">acc_mods'</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962727"><span class="hs-identifier hs-var">acc_pkgs'</span></a></span><span>
</span><span id="line-242"></span><span>            </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">[Module]
-&gt; UniqDSet Module
-&gt; UniqDSet UnitId
-&gt; IO ([Module], UniqDSet UnitId)
</span><a href="#local-6989586621682962604"><span class="hs-identifier hs-var">follow_deps</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682962694"><span class="hs-identifier hs-var">mods</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet Module
</span><a href="#local-6989586621682962695"><span class="hs-identifier hs-var">acc_mods</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDSet UnitId -&gt; UnitId -&gt; UniqDSet UnitId
forall a. Uniquable a =&gt; UniqDSet a -&gt; a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#addOneToUniqDSet"><span class="hs-identifier hs-var">addOneToUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet UnitId
</span><a href="#local-6989586621682962727"><span class="hs-identifier hs-var">acc_pkgs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unit -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621682962707"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>           </span><span id="local-6989586621682962698"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621682962698"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;need to link module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962693"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-245"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;due to use of Template Haskell&quot;</span></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621682962377"><span class="annot"><a href="#local-6989586621682962681"><span class="hs-identifier hs-type">link_boot_mod_error</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682962377"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621682962681"><span class="annot"><span class="annottext">link_boot_mod_error :: forall a. Module -&gt; IO a
</span><a href="#local-6989586621682962681"><span class="hs-identifier hs-var hs-var">link_boot_mod_error</span></a></span></span><span> </span><span id="local-6989586621682962736"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962736"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SDoc -&gt; IO a
forall a. LinkDepsOpts -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#throwProgramError"><span class="hs-identifier hs-var">throwProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO a) -&gt; SDoc -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962736"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-252"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot be linked; it is only available as a boot module&quot;</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621682962402"><span id="local-6989586621682962403"><span class="annot"><a href="#local-6989586621682962737"><span class="hs-identifier hs-type">no_obj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962402"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682962402"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682962403"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621682962737"><span class="annot"><span class="annottext">no_obj :: forall a b. Outputable a =&gt; a -&gt; IO b
</span><a href="#local-6989586621682962737"><span class="hs-identifier hs-var hs-var">no_obj</span></a></span></span><span> </span><span id="local-6989586621682962743"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682962743"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SrcSpan -&gt; SDoc -&gt; IO b
forall a. LinkDepsOpts -&gt; SrcSpan -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#dieWith"><span class="hs-identifier hs-var">dieWith</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962600"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO b) -&gt; SDoc -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-256"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot find object file for module &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-257"></span><span>                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682962743"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-258"></span><span>                     </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962748"><span class="hs-identifier hs-var">while_linking_expr</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621682962748"><span class="annot"><span class="annottext">while_linking_expr :: SDoc
</span><a href="#local-6989586621682962748"><span class="hs-identifier hs-var hs-var">while_linking_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;while linking an interpreted expression&quot;</span></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- See Note [Using Byte Code rather than Object Code for Template Haskell]</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621682962752"><span class="hs-identifier hs-type">homeModLinkable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621682962752"><span class="annot"><span class="annottext">homeModLinkable :: HomeModInfo -&gt; Maybe Linkable
</span><a href="#local-6989586621682962752"><span class="hs-identifier hs-var hs-var">homeModLinkable</span></a></span></span><span> </span><span id="local-6989586621682962753"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962753"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Bool
</span><a href="GHC.Linker.Deps.html#ldUseByteCode"><span class="hs-identifier hs-var">ldUseByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeModInfoByteCode"><span class="hs-identifier hs-var">homeModInfoByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962753"><span class="hs-identifier hs-var">hmi</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; Maybe Linkable -&gt; Maybe Linkable
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeModInfoObject"><span class="hs-identifier hs-var">homeModInfoObject</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962753"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeModInfoObject"><span class="hs-identifier hs-var">homeModInfoObject</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962753"><span class="hs-identifier hs-var">hmi</span></a></span><span>   </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; Maybe Linkable -&gt; Maybe Linkable
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeModInfoByteCode"><span class="hs-identifier hs-var">homeModInfoByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962753"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621682962635"><span class="annot"><span class="annottext">get_linkable :: String -&gt; Module -&gt; IO Linkable
</span><a href="#local-6989586621682962635"><span class="hs-identifier hs-var hs-var">get_linkable</span></a></span></span><span> </span><span id="local-6989586621682962756"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962756"><span class="hs-identifier hs-var">osuf</span></a></span></span><span> </span><span id="local-6989586621682962757"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962757"><span class="hs-identifier hs-var">mod</span></a></span></span><span>      </span><span class="hs-comment">-- A home-package module</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962758"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962758"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; HomeUnitGraph -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Env.html#lookupHugByModule"><span class="hs-identifier hs-var">lookupHugByModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962757"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; HomeUnitGraph
</span><a href="GHC.Unit.Env.html#ue_home_unit_graph"><span class="hs-identifier hs-var">ue_home_unit_graph</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682962637"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; IO Linkable
</span><a href="#local-6989586621682962760"><span class="hs-identifier hs-var">adjust_linkable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe Linkable -&gt; Linkable
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getLinkDeps&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="#local-6989586621682962752"><span class="hs-identifier hs-var">homeModLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682962758"><span class="hs-identifier hs-var">mod_info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>    </span><span class="hs-comment">-- It's not in the HPT because we are in one shot mode,</span><span>
</span><span id="line-275"></span><span>                </span><span class="hs-comment">-- so use the Finder to get a ModLocation...</span><span>
</span><span id="line-276"></span><span>             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Unit.Env.html#ue_homeUnit"><span class="hs-identifier hs-var">ue_homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682962637"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>              </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Module -&gt; IO Linkable
forall a b. Outputable a =&gt; a -&gt; IO b
</span><a href="#local-6989586621682962737"><span class="hs-identifier hs-var">no_obj</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962757"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-278"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962762"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962762"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>                </span><span id="local-6989586621682962763"><span class="annot"><a href="#local-6989586621682962763"><span class="hs-identifier hs-var">from_bc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Module -&gt; IO (Maybe Linkable)
</span><a href="GHC.Linker.Deps.html#ldLoadByteCode"><span class="hs-identifier hs-var">ldLoadByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962757"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-280"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682962765"><span class="hs-identifier hs-type">fallback_no_bytecode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962762"><span class="hs-identifier hs-type">home_unit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962757"><span class="hs-identifier hs-type">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682962763"><span class="hs-identifier hs-type">from_bc</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>            </span><span id="local-6989586621682962765"><span class="annot"><span class="annottext">fallback_no_bytecode :: HomeUnit -&gt; Module -&gt; IO Linkable
</span><a href="#local-6989586621682962765"><span class="hs-identifier hs-var hs-var">fallback_no_bytecode</span></a></span></span><span> </span><span id="local-6989586621682962766"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962766"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span id="local-6989586621682962767"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962767"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682962768"><span class="annot"><span class="annottext">fc :: FinderCache
</span><a href="#local-6989586621682962768"><span class="hs-identifier hs-var hs-var hs-var">fc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; FinderCache
</span><a href="GHC.Linker.Deps.html#ldFinderCache"><span class="hs-identifier hs-var">ldFinderCache</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-285"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682962769"><span class="annot"><span class="annottext">fopts :: FinderOpts
</span><a href="#local-6989586621682962769"><span class="hs-identifier hs-var hs-var hs-var">fopts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; FinderOpts
</span><a href="GHC.Linker.Deps.html#ldFinderOpts"><span class="hs-identifier hs-var">ldFinderOpts</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962597"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-286"></span><span>              </span><span id="local-6989586621682962770"><span class="annot"><a href="#local-6989586621682962770"><span class="hs-identifier hs-var">mb_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FinderCache
-&gt; FinderOpts -&gt; HomeUnit -&gt; ModuleName -&gt; IO FindResult
</span><a href="GHC.Unit.Finder.html#findHomeModule"><span class="hs-identifier hs-var">findHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682962768"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621682962769"><span class="hs-identifier hs-var">fopts</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682962766"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962767"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682962770"><span class="hs-identifier hs-type">mb_stuff</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-288"></span><span>                </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span id="local-6989586621682962773"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682962773"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>                  </span><span id="local-6989586621682962774"><span class="annot"><a href="#local-6989586621682962774"><span class="hs-identifier hs-var">mb_lnk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModLocation -&gt; IO (Maybe Linkable)
</span><a href="GHC.Unit.Finder.html#findObjectLinkableMaybe"><span class="hs-identifier hs-var">findObjectLinkableMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962767"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682962773"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-290"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682962774"><span class="hs-identifier hs-type">mb_lnk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-291"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Module -&gt; IO Linkable
forall a b. Outputable a =&gt; a -&gt; IO b
</span><a href="#local-6989586621682962737"><span class="hs-identifier hs-var">no_obj</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962767"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-292"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962776"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682962776"><span class="hs-identifier hs-var">lnk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; IO Linkable
</span><a href="#local-6989586621682962760"><span class="hs-identifier hs-var">adjust_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682962776"><span class="hs-identifier hs-var">lnk</span></a></span><span>
</span><span id="line-293"></span><span>                </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IO Linkable
forall a b. Outputable a =&gt; a -&gt; IO b
</span><a href="#local-6989586621682962737"><span class="hs-identifier hs-var">no_obj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962767"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>            </span><span id="local-6989586621682962760"><span class="annot"><span class="annottext">adjust_linkable :: Linkable -&gt; IO Linkable
</span><a href="#local-6989586621682962760"><span class="hs-identifier hs-var hs-var">adjust_linkable</span></a></span></span><span> </span><span id="local-6989586621682962777"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682962777"><span class="hs-identifier hs-var">lnk</span></a></span></span><span>
</span><span id="line-296"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682962778"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962778"><span class="hs-identifier hs-var">new_osuf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682962599"><span class="hs-identifier hs-var">maybe_normal_osuf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>                        </span><span id="local-6989586621682962779"><span class="annot"><a href="#local-6989586621682962779"><span class="hs-identifier hs-var">new_parts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LinkablePart -&gt; IO LinkablePart)
-&gt; NonEmpty LinkablePart -&gt; IO (NonEmpty LinkablePart)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; NonEmpty a -&gt; m (NonEmpty b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; LinkablePart -&gt; IO LinkablePart
</span><a href="#local-6989586621682962780"><span class="hs-identifier hs-var">adjust_part</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962778"><span class="hs-identifier hs-var">new_osuf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; NonEmpty LinkablePart
</span><a href="GHC.Linker.Types.html#linkableParts"><span class="hs-identifier hs-var">linkableParts</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682962777"><span class="hs-identifier hs-var">lnk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682962777"><span class="hs-identifier hs-type">lnk</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#linkableParts"><span class="hs-identifier hs-var">linkableParts</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="#local-6989586621682962779"><span class="hs-identifier hs-type">new_parts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-300"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>                        </span><span class="annot"><span class="annottext">Linkable -&gt; IO Linkable
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682962777"><span class="hs-identifier hs-var">lnk</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>            </span><span id="local-6989586621682962780"><span class="annot"><span class="annottext">adjust_part :: String -&gt; LinkablePart -&gt; IO LinkablePart
</span><a href="#local-6989586621682962780"><span class="hs-identifier hs-var hs-var">adjust_part</span></a></span></span><span> </span><span id="local-6989586621682962782"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962782"><span class="hs-identifier hs-var">new_osuf</span></a></span></span><span> </span><span id="local-6989586621682962783"><span class="annot"><span class="annottext">LinkablePart
</span><a href="#local-6989586621682962783"><span class="hs-identifier hs-var">part</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LinkablePart
</span><a href="#local-6989586621682962783"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-304"></span><span>              </span><span class="annot"><a href="GHC.Linker.Types.html#DotO"><span class="hs-identifier hs-type">DotO</span></a></span><span> </span><span id="local-6989586621682962785"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962785"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="annot"><span class="annottext">LinkableObjectSort
</span><a href="GHC.Linker.Types.html#ModuleObject"><span class="hs-identifier hs-var">ModuleObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-305"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; IO ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962756"><span class="hs-identifier hs-var">osuf</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isSuffixOf`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962785"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682962788"><span class="annot"><span class="annottext">file_base :: String
</span><a href="#local-6989586621682962788"><span class="hs-identifier hs-var hs-var hs-var">file_base</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; String
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Maybe String
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#stripExtension"><span class="hs-identifier hs-var">stripExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962756"><span class="hs-identifier hs-var">osuf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962785"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>                    </span><span id="local-6989586621682962791"><span class="annot"><span class="annottext">new_file :: String
</span><a href="#local-6989586621682962791"><span class="hs-identifier hs-var hs-var hs-var">new_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962788"><span class="hs-identifier hs-var">file_base</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962782"><span class="hs-identifier hs-var">new_osuf</span></a></span><span>
</span><span id="line-308"></span><span>                </span><span id="local-6989586621682962793"><span class="annot"><a href="#local-6989586621682962793"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962791"><span class="hs-identifier hs-var">new_file</span></a></span><span>
</span><span id="line-309"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682962793"><span class="hs-identifier hs-type">ok</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#dieWith"><span class="hs-identifier hs-type">dieWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962597"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962600"><span class="hs-identifier hs-type">span</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-311"></span><span>                          </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cannot find object file &quot;</span></span><span>
</span><span id="line-312"></span><span>                                </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-type">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962791"><span class="hs-identifier hs-type">new_file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962748"><span class="hs-identifier hs-type">while_linking_expr</span></a></span><span>
</span><span id="line-313"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Types.html#DotO"><span class="hs-identifier hs-type">DotO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682962791"><span class="hs-identifier hs-type">new_file</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#ModuleObject"><span class="hs-identifier hs-type">ModuleObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>              </span><span class="annot"><a href="GHC.Linker.Types.html#DotO"><span class="hs-identifier hs-type">DotO</span></a></span><span> </span><span id="local-6989586621682962795"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962795"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="annot"><span class="annottext">LinkableObjectSort
</span><a href="GHC.Linker.Types.html#ForeignObject"><span class="hs-identifier hs-var">ForeignObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LinkablePart -&gt; IO LinkablePart
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; LinkableObjectSort -&gt; LinkablePart
</span><a href="GHC.Linker.Types.html#DotO"><span class="hs-identifier hs-var">DotO</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962795"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">LinkableObjectSort
</span><a href="GHC.Linker.Types.html#ForeignObject"><span class="hs-identifier hs-var">ForeignObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>              </span><span class="annot"><a href="GHC.Linker.Types.html#DotA"><span class="hs-identifier hs-type">DotA</span></a></span><span> </span><span id="local-6989586621682962798"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962798"><span class="hs-identifier hs-var">fp</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO LinkablePart
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;adjust_ul DotA &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962798"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>              </span><span class="annot"><a href="GHC.Linker.Types.html#DotDLL"><span class="hs-identifier hs-type">DotDLL</span></a></span><span> </span><span id="local-6989586621682962802"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962802"><span class="hs-identifier hs-var">fp</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO LinkablePart
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;adjust_ul DotDLL &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962802"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>              </span><span class="annot"><a href="GHC.Linker.Types.html#BCOs"><span class="hs-identifier hs-type">BCOs</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LinkablePart -&gt; IO LinkablePart
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LinkablePart
</span><a href="#local-6989586621682962783"><span class="hs-identifier hs-var">part</span></a></span><span>
</span><span id="line-318"></span><span>              </span><span class="annot"><a href="GHC.Linker.Types.html#LazyBCOs"><span class="hs-identifier hs-type">LazyBCOs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LinkablePart -&gt; IO LinkablePart
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LinkablePart
</span><a href="#local-6989586621682962783"><span class="hs-identifier hs-var">part</span></a></span><span>
</span><span id="line-319"></span><span>              </span><span class="annot"><a href="GHC.Linker.Types.html#CoreBindings"><span class="hs-identifier hs-type">CoreBindings</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html#WholeCoreBindings"><span class="hs-identifier hs-type">WholeCoreBindings</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682962807"><span class="annot"><span class="annottext">Module
wcb_module :: Module
wcb_module :: WholeCoreBindings -&gt; Module
</span><a href="#local-6989586621682962807"><span class="hs-identifier hs-var hs-var">wcb_module</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO LinkablePart
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unhydrated core bindings&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682962807"><span class="hs-identifier hs-var">wcb_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">{-
Note [Using Byte Code rather than Object Code for Template Haskell]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The `-fprefer-byte-code` flag allows a user to specify that they want to use
byte code (if available) rather than object code for home module dependencies
when executing Template Haskell splices.

Why might you want to use byte code rather than object code?

* Producing object code is much slower than producing byte code (for example if you're using -fno-code)
* Linking many large object files, which happens once per splice, is quite expensive. (#21700)

So we allow the user to choose to use byte code rather than object files if they want to avoid these
two pitfalls.

When using `-fprefer-byte-code` you have to arrange to have the byte code available.
In normal --make mode it will not be produced unless you enable `-fbyte-code-and-object-code`.
See Note [Home module build products] for some more information about that.

The only other place where the flag is consulted is when enabling code generation
with `-fno-code`, which does so to anticipate what decision we will make at the
splice point about what we would prefer.

-}</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span id="local-6989586621682962406"><span class="annot"><a href="GHC.Linker.Deps.html#dieWith"><span class="hs-identifier hs-type">dieWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-type">LinkDepsOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682962406"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-348"></span><span id="dieWith"><span class="annot"><span class="annottext">dieWith :: forall a. LinkDepsOpts -&gt; SrcSpan -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#dieWith"><span class="hs-identifier hs-var hs-var">dieWith</span></a></span></span><span> </span><span id="local-6989586621682962810"><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962810"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682962811"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962811"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621682962812"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962812"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SDoc -&gt; IO a
forall a. LinkDepsOpts -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#throwProgramError"><span class="hs-identifier hs-var">throwProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962810"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Types.Error.html#mkLocMessage"><span class="hs-identifier hs-var">mkLocMessage</span></a></span><span> </span><span class="annot"><span class="annottext">MessageClass
</span><a href="GHC.Types.Error.html#MCFatal"><span class="hs-identifier hs-var">MCFatal</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962811"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962812"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span id="local-6989586621682962382"><span class="annot"><a href="GHC.Linker.Deps.html#throwProgramError"><span class="hs-identifier hs-type">throwProgramError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-type">LinkDepsOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682962382"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-351"></span><span id="throwProgramError"><span class="annot"><span class="annottext">throwProgramError :: forall a. LinkDepsOpts -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#throwProgramError"><span class="hs-identifier hs-var hs-var">throwProgramError</span></a></span></span><span> </span><span id="local-6989586621682962815"><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962815"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682962816"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962816"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SDocContext
</span><a href="GHC.Linker.Deps.html#ldPprOpts"><span class="hs-identifier hs-var">ldPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962815"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962816"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Linker.Deps.html#checkNonStdWay"><span class="hs-identifier hs-type">checkNonStdWay</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-type">LinkDepsOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span id="checkNonStdWay"><span class="annot"><span class="annottext">checkNonStdWay :: LinkDepsOpts -&gt; Interp -&gt; SrcSpan -&gt; IO (Maybe String)
</span><a href="GHC.Linker.Deps.html#checkNonStdWay"><span class="hs-identifier hs-var hs-var">checkNonStdWay</span></a></span></span><span> </span><span id="local-6989586621682962820"><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962820"><span class="hs-identifier hs-var">_opts</span></a></span></span><span> </span><span id="local-6989586621682962821"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682962821"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682962822"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962822"><span class="hs-identifier hs-var">_srcspan</span></a></span></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-comment">-- On some targets (e.g. wasm) the RTS linker only supports loading</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-comment">-- dynamic code, in which case we need to ensure the .dyn_o object</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-comment">-- is picked (instead of .o which is also present because of</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-comment">-- -dynamic-too)</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Bool
</span><a href="GHC.Linker.Deps.html#ldForceDyn"><span class="hs-identifier hs-var">ldForceDyn</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962820"><span class="hs-identifier hs-var">_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682962823"><span class="annot"><span class="annottext">target_ways :: Ways
</span><a href="#local-6989586621682962823"><span class="hs-identifier hs-var hs-var">target_ways</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Ways
</span><a href="GHC.Platform.Ways.html#fullWays"><span class="hs-identifier hs-var">fullWays</span></a></span><span> </span><span class="annot"><span class="annottext">(Ways -&gt; Ways) -&gt; Ways -&gt; Ways
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Ways
</span><a href="GHC.Linker.Deps.html#ldWays"><span class="hs-identifier hs-var">ldWays</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962820"><span class="hs-identifier hs-var">_opts</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; IO (Maybe String))
-&gt; Maybe String -&gt; IO (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Ways
</span><a href="#local-6989586621682962823"><span class="hs-identifier hs-var">target_ways</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-operator hs-var">`hasWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe String) -&gt; String -&gt; Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; String
</span><a href="GHC.Platform.Ways.html#waysTag"><span class="hs-identifier hs-var">waysTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span> </span><span class="annot"><span class="annottext">Way -&gt; Ways -&gt; Ways
</span><a href="GHC.Platform.Ways.html#addWay"><span class="hs-operator hs-var">`addWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Ways
</span><a href="#local-6989586621682962823"><span class="hs-identifier hs-var">target_ways</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_o&quot;</span></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682962821"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-comment">-- with -fexternal-interpreter we load the .o files, whatever way</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-comment">-- they were built.  If they were built for a non-std way, then</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">-- we will use the appropriate variant of the iserv binary to load them.</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">-- #if-guard the following equations otherwise the pattern match checker will</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- complain that they are redundant.</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span class="annot"><a href="GHC.Linker.Deps.html#checkNonStdWay"><span class="hs-identifier hs-var">checkNonStdWay</span></a></span><span> </span><span id="local-6989586621682962831"><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962831"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682962832"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682962832"><span class="hs-identifier hs-var">_interp</span></a></span></span><span> </span><span id="local-6989586621682962833"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962833"><span class="hs-identifier hs-var">srcspan</span></a></span></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ways
</span><a href="GHC.Platform.Ways.html#hostFullWays"><span class="hs-identifier hs-var">hostFullWays</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Ways -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ways
</span><a href="#local-6989586621682962835"><span class="hs-identifier hs-var">targetFullWays</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">-- Only if we are compiling with the same ways as GHC is built</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- with, can we dynamically load those object files. (see #3604)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; String
</span><a href="GHC.Linker.Deps.html#ldObjSuffix"><span class="hs-identifier hs-var">ldObjSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962831"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962836"><span class="hs-identifier hs-var">normalObjectSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ways -&gt; Bool
forall a. Set a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Ways
</span><a href="#local-6989586621682962835"><span class="hs-identifier hs-var">targetFullWays</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SrcSpan -&gt; IO (Maybe String)
</span><a href="GHC.Linker.Deps.html#failNonStd"><span class="hs-identifier hs-var">failNonStd</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962831"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962833"><span class="hs-identifier hs-var">srcspan</span></a></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962840"><span class="hs-identifier hs-var">hostWayTag</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;o&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621682962835"><span class="annot"><span class="annottext">targetFullWays :: Ways
</span><a href="#local-6989586621682962835"><span class="hs-identifier hs-var hs-var">targetFullWays</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Ways
</span><a href="GHC.Platform.Ways.html#fullWays"><span class="hs-identifier hs-var">fullWays</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Ways
</span><a href="GHC.Linker.Deps.html#ldWays"><span class="hs-identifier hs-var">ldWays</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962831"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621682962840"><span class="annot"><span class="annottext">hostWayTag :: String
</span><a href="#local-6989586621682962840"><span class="hs-identifier hs-var hs-var">hostWayTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ways -&gt; String
</span><a href="GHC.Platform.Ways.html#waysTag"><span class="hs-identifier hs-var">waysTag</span></a></span><span> </span><span class="annot"><span class="annottext">Ways
</span><a href="GHC.Platform.Ways.html#hostFullWays"><span class="hs-identifier hs-var">hostFullWays</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-385"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-386"></span><span>                  </span><span id="local-6989586621682962841"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962841"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682962841"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><a href="#local-6989586621682962836"><span class="hs-identifier hs-type">normalObjectSuffix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621682962836"><span class="annot"><span class="annottext">normalObjectSuffix :: String
</span><a href="#local-6989586621682962836"><span class="hs-identifier hs-var hs-var">normalObjectSuffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;o&quot;</span></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-keyword">data</span><span> </span><span id="Way%27"><span class="annot"><a href="GHC.Linker.Deps.html#Way%27"><span class="hs-identifier hs-var">Way'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Normal"><span class="annot"><a href="GHC.Linker.Deps.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Prof"><span class="annot"><a href="GHC.Linker.Deps.html#Prof"><span class="hs-identifier hs-var">Prof</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Dyn"><span class="annot"><a href="GHC.Linker.Deps.html#Dyn"><span class="hs-identifier hs-var">Dyn</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ProfDyn"><span class="annot"><a href="GHC.Linker.Deps.html#ProfDyn"><span class="hs-identifier hs-var">ProfDyn</span></a></span></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.Linker.Deps.html#failNonStd"><span class="hs-identifier hs-type">failNonStd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#LinkDepsOpts"><span class="hs-identifier hs-type">LinkDepsOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span id="failNonStd"><span class="annot"><span class="annottext">failNonStd :: LinkDepsOpts -&gt; SrcSpan -&gt; IO (Maybe String)
</span><a href="GHC.Linker.Deps.html#failNonStd"><span class="hs-identifier hs-var hs-var">failNonStd</span></a></span></span><span> </span><span id="local-6989586621682962846"><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962846"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682962847"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962847"><span class="hs-identifier hs-var">srcspan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; SrcSpan -&gt; SDoc -&gt; IO (Maybe String)
forall a. LinkDepsOpts -&gt; SrcSpan -&gt; SDoc -&gt; IO a
</span><a href="GHC.Linker.Deps.html#dieWith"><span class="hs-identifier hs-var">dieWith</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962846"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682962847"><span class="hs-identifier hs-var">srcspan</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO (Maybe String)) -&gt; SDoc -&gt; IO (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot load&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Way' -&gt; SDoc
</span><a href="#local-6989586621682962848"><span class="hs-identifier hs-var">pprWay'</span></a></span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962849"><span class="hs-identifier hs-var">compWay</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-396"></span><span>     </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;objects when GHC is built&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Way' -&gt; SDoc
</span><a href="#local-6989586621682962848"><span class="hs-identifier hs-var">pprWay'</span></a></span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962850"><span class="hs-identifier hs-var">ghciWay</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-397"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;To fix this, either:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  (1) Use -fexternal-interpreter, or&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962851"><span class="hs-identifier hs-var">buildTwiceMsg</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682962849"><span class="annot"><span class="annottext">compWay :: Way'
</span><a href="#local-6989586621682962849"><span class="hs-identifier hs-var hs-var">compWay</span></a></span></span><span>
</span><span id="line-401"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Ways
</span><a href="GHC.Linker.Deps.html#ldWays"><span class="hs-identifier hs-var">ldWays</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962846"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-operator hs-var">`hasWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Ways
</span><a href="GHC.Linker.Deps.html#ldWays"><span class="hs-identifier hs-var">ldWays</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962846"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-operator hs-var">`hasWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayProf"><span class="hs-identifier hs-var">WayProf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#ProfDyn"><span class="hs-identifier hs-var">ProfDyn</span></a></span><span>
</span><span id="line-402"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Ways
</span><a href="GHC.Linker.Deps.html#ldWays"><span class="hs-identifier hs-var">ldWays</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962846"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-operator hs-var">`hasWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Dyn"><span class="hs-identifier hs-var">Dyn</span></a></span><span>
</span><span id="line-403"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts -&gt; Ways
</span><a href="GHC.Linker.Deps.html#ldWays"><span class="hs-identifier hs-var">ldWays</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621682962846"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-operator hs-var">`hasWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayProf"><span class="hs-identifier hs-var">WayProf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Prof"><span class="hs-identifier hs-var">Prof</span></a></span><span>
</span><span id="line-404"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span>
</span><span id="line-405"></span><span>          </span><span id="local-6989586621682962850"><span class="annot"><span class="annottext">ghciWay :: Way'
</span><a href="#local-6989586621682962850"><span class="hs-identifier hs-var hs-var">ghciWay</span></a></span></span><span>
</span><span id="line-406"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Platform.Ways.html#hostIsDynamic"><span class="hs-identifier hs-var">hostIsDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Platform.Ways.html#hostIsProfiled"><span class="hs-identifier hs-var">hostIsProfiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#ProfDyn"><span class="hs-identifier hs-var">ProfDyn</span></a></span><span>
</span><span id="line-407"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Platform.Ways.html#hostIsDynamic"><span class="hs-identifier hs-var">hostIsDynamic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Dyn"><span class="hs-identifier hs-var">Dyn</span></a></span><span>
</span><span id="line-408"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Platform.Ways.html#hostIsProfiled"><span class="hs-identifier hs-var">hostIsProfiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Prof"><span class="hs-identifier hs-var">Prof</span></a></span><span>
</span><span id="line-409"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span>
</span><span id="line-410"></span><span>          </span><span id="local-6989586621682962851"><span class="annot"><span class="annottext">buildTwiceMsg :: SDoc
</span><a href="#local-6989586621682962851"><span class="hs-identifier hs-var hs-var">buildTwiceMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962850"><span class="hs-identifier hs-var">ghciWay</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962849"><span class="hs-identifier hs-var">compWay</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-411"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Dyn"><span class="hs-identifier hs-var">Dyn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962855"><span class="hs-identifier hs-var">dynamicTooMsg</span></a></span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Dyn"><span class="hs-identifier hs-var">Dyn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682962855"><span class="hs-identifier hs-var">dynamicTooMsg</span></a></span><span>
</span><span id="line-413"></span><span>            </span><span class="annot"><span class="annottext">(Way', Way')
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  (2) Build the program twice: once&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-415"></span><span>                </span><span class="annot"><span class="annottext">Way' -&gt; SDoc
</span><a href="#local-6989586621682962848"><span class="hs-identifier hs-var">pprWay'</span></a></span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962850"><span class="hs-identifier hs-var">ghciWay</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, and then&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-416"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;      &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Way' -&gt; SDoc
</span><a href="#local-6989586621682962848"><span class="hs-identifier hs-var">pprWay'</span></a></span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962849"><span class="hs-identifier hs-var">compWay</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-417"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;using -osuf to set a different object file suffix.&quot;</span></span><span>
</span><span id="line-418"></span><span>          </span><span id="local-6989586621682962855"><span class="annot"><span class="annottext">dynamicTooMsg :: SDoc
</span><a href="#local-6989586621682962855"><span class="hs-identifier hs-var hs-var">dynamicTooMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  (2) Use -dynamic-too,&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-419"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and use -osuf and -dynosuf to set object file suffixes as needed.&quot;</span></span><span>
</span><span id="line-420"></span><span>          </span><span class="annot"><a href="#local-6989586621682962848"><span class="hs-identifier hs-type">pprWay'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html#Way%27"><span class="hs-identifier hs-type">Way'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-421"></span><span>          </span><span id="local-6989586621682962848"><span class="annot"><span class="annottext">pprWay' :: Way' -&gt; SDoc
</span><a href="#local-6989586621682962848"><span class="hs-identifier hs-var hs-var">pprWay'</span></a></span></span><span> </span><span id="local-6989586621682962860"><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962860"><span class="hs-identifier hs-var">way</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Way'
</span><a href="#local-6989586621682962860"><span class="hs-identifier hs-var">way</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-422"></span><span>            </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;the normal way&quot;</span></span><span>
</span><span id="line-423"></span><span>            </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Prof"><span class="hs-identifier hs-var">Prof</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with -prof&quot;</span></span><span>
</span><span id="line-424"></span><span>            </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#Dyn"><span class="hs-identifier hs-var">Dyn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with -dynamic&quot;</span></span><span>
</span><span id="line-425"></span><span>            </span><span class="annot"><span class="annottext">Way'
</span><a href="GHC.Linker.Deps.html#ProfDyn"><span class="hs-identifier hs-var">ProfDyn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with -prof and -dynamic&quot;</span></span><span class="hs-cpp">
#endif
</span></pre></body></html>