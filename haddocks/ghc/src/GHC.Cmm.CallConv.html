<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html"><span class="hs-identifier">GHC.Cmm.CallConv</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-2"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#ParamLocation"><span class="hs-identifier">ParamLocation</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#assignArgumentsPos"><span class="hs-identifier">assignArgumentsPos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#assignStack"><span class="hs-identifier">assignStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#realArgRegsCover"><span class="hs-identifier">realArgRegsCover</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#allArgRegsCover"><span class="hs-identifier">allArgRegsCover</span></a></span><span>
</span><span id="line-7"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html"><span class="hs-identifier">GHC.Cmm.Expr</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html"><span class="hs-identifier">GHC.Cmm.Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalArgRegs"><span class="hs-identifier">GlobalArgRegs</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#Convention"><span class="hs-identifier">Convention</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.Class.html"><span class="hs-identifier">GHC.Platform.Reg.Class</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html"><span class="hs-identifier">GHC.Platform.Profile</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">maybeToList</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-comment">-- Calculate the 'GlobalReg' or stack locations for function call</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- parameters as used by the Cmm calling convention.</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">data</span><span> </span><span id="ParamLocation"><span class="annot"><a href="GHC.Cmm.CallConv.html#ParamLocation"><span class="hs-identifier hs-var">ParamLocation</span></a></span></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RegisterParam"><span class="annot"><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="StackParam"><span class="annot"><a href="GHC.Cmm.CallConv.html#StackParam"><span class="hs-identifier hs-var">StackParam</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#ParamLocation"><span class="hs-identifier hs-type">ParamLocation</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-33"></span><span>  </span><span id="local-6989586621682884245"><span class="annot"><span class="annottext">ppr :: ParamLocation -&gt; SDoc
</span><a href="#local-6989586621682884245"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-type">RegisterParam</span></a></span><span> </span><span id="local-6989586621682884247"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884247"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884247"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CallConv.html#StackParam"><span class="hs-identifier hs-type">StackParam</span></a></span><span> </span><span id="local-6989586621682884248"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884248"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884248"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- Given a list of arguments, and a function that tells their types,</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- return a list showing where each argument is passed</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span id="local-6989586621682884182"><span class="annot"><a href="GHC.Cmm.CallConv.html#assignArgumentsPos"><span class="hs-identifier hs-type">assignArgumentsPos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-41"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>           </span><span class="hs-comment">-- stack offset to start with</span><span>
</span><span id="line-42"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#Convention"><span class="hs-identifier hs-type">Convention</span></a></span><span>
</span><span id="line-43"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682884182"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- how to get a type from an arg</span><span>
</span><span id="line-44"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682884182"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- args</span><span>
</span><span id="line-45"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-46"></span><span>                        </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>              </span><span class="hs-comment">-- bytes of stack args</span><span>
</span><span id="line-47"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682884182"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#ParamLocation"><span class="hs-identifier hs-type">ParamLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- args and locations</span><span>
</span><span id="line-48"></span><span>                      </span><span class="hs-special">)</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span id="assignArgumentsPos"><span class="annot"><span class="annottext">assignArgumentsPos :: forall a.
Profile
-&gt; Int
-&gt; Convention
-&gt; (a -&gt; CmmType)
-&gt; [a]
-&gt; (Int, [(a, ParamLocation)])
</span><a href="GHC.Cmm.CallConv.html#assignArgumentsPos"><span class="hs-identifier hs-var hs-var">assignArgumentsPos</span></a></span></span><span> </span><span id="local-6989586621682884256"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682884256"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621682884257"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884257"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621682884258"><span class="annot"><span class="annottext">Convention
</span><a href="#local-6989586621682884258"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621682884259"><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621682884259"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span id="local-6989586621682884260"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884260"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884261"><span class="hs-identifier hs-var">stk_off</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884262"><span class="hs-identifier hs-var">assignments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-52"></span><span>      </span><span id="local-6989586621682884263"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682884256"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-53"></span><span>      </span><span id="local-6989586621682884265"><span class="annot"><span class="annottext">regs :: AvailRegs
</span><a href="#local-6989586621682884265"><span class="hs-identifier hs-var hs-var">regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884260"><span class="hs-identifier hs-var">reps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Convention
</span><a href="#local-6989586621682884258"><span class="hs-identifier hs-var">conv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-54"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#NativeNodeCall"><span class="hs-identifier hs-var">NativeNodeCall</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#getRegsWithNode"><span class="hs-identifier hs-var">getRegsWithNode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-55"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#NativeDirectCall"><span class="hs-identifier hs-var">NativeDirectCall</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#getRegsWithoutNode"><span class="hs-identifier hs-var">getRegsWithoutNode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-56"></span><span>               </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#NativeReturn"><span class="hs-identifier hs-var">NativeReturn</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#allRegs"><span class="hs-identifier hs-var">allRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-57"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#NativeReturn"><span class="hs-identifier hs-var">NativeReturn</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#getRegsWithNode"><span class="hs-identifier hs-var">getRegsWithNode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-58"></span><span>               </span><span class="hs-comment">-- GC calling convention *must* put values in registers</span><span>
</span><span id="line-59"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#GC"><span class="hs-identifier hs-var">GC</span></a></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#allRegs"><span class="hs-identifier hs-var">allRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-60"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#Slow"><span class="hs-identifier hs-var">Slow</span></a></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><a href="GHC.Cmm.CallConv.html#nodeOnly"><span class="hs-identifier hs-var">nodeOnly</span></a></span><span>
</span><span id="line-61"></span><span>      </span><span class="hs-comment">-- The calling conventions first assign arguments to registers,</span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-comment">-- then switch to the stack when we first run out of registers</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-comment">-- (even if there are still available registers for args of a</span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-comment">-- different type).  When returning an unboxed tuple, we also</span><span>
</span><span id="line-65"></span><span>      </span><span class="hs-comment">-- separate the stack arguments by pointerhood.</span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682884275"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884275"><span class="hs-identifier hs-var">reg_assts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682884276"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884276"><span class="hs-identifier hs-var">stk_args</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
-&gt; [a] -&gt; AvailRegs -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884277"><span class="hs-identifier hs-var">assign_regs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884260"><span class="hs-identifier hs-var">reps</span></a></span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><a href="#local-6989586621682884265"><span class="hs-identifier hs-var">regs</span></a></span><span>
</span><span id="line-67"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682884261"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884261"><span class="hs-identifier hs-var">stk_off</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621682884278"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884278"><span class="hs-identifier hs-var">stk_assts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; Int -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
forall a.
Platform
-&gt; Int -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
</span><a href="GHC.Cmm.CallConv.html#assignStack"><span class="hs-identifier hs-var">assignStack</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884257"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621682884259"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884276"><span class="hs-identifier hs-var">stk_args</span></a></span><span>
</span><span id="line-68"></span><span>      </span><span id="local-6989586621682884262"><span class="annot"><span class="annottext">assignments :: [(a, ParamLocation)]
</span><a href="#local-6989586621682884262"><span class="hs-identifier hs-var hs-var">assignments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884275"><span class="hs-identifier hs-var">reg_assts</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
-&gt; [(a, ParamLocation)] -&gt; [(a, ParamLocation)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884278"><span class="hs-identifier hs-var">stk_assts</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>      </span><span id="local-6989586621682884277"><span class="annot"><span class="annottext">assign_regs :: [(a, ParamLocation)]
-&gt; [a] -&gt; AvailRegs -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884277"><span class="hs-identifier hs-var hs-var">assign_regs</span></a></span></span><span> </span><span id="local-6989586621682884279"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884279"><span class="hs-identifier hs-var">assts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="annottext">AvailRegs
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884279"><span class="hs-identifier hs-var">assts</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><a href="#local-6989586621682884277"><span class="hs-identifier hs-var">assign_regs</span></a></span><span> </span><span id="local-6989586621682884280"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884280"><span class="hs-identifier hs-var">assts</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884281"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884281"><span class="hs-identifier hs-var">r</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884282"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884282"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682884283"><span class="annot"><span class="annottext">AvailRegs
</span><a href="#local-6989586621682884283"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Bool
</span><a href="GHC.Cmm.Type.html#isVecType"><span class="hs-identifier hs-var">isVecType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682884285"><span class="hs-identifier hs-var">ty</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884286"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-72"></span><span>                                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Bool
</span><a href="GHC.Cmm.Type.html#isFloatType"><span class="hs-identifier hs-var">isFloatType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682884285"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884288"><span class="hs-identifier hs-var">float</span></a></span><span>
</span><span id="line-73"></span><span>                                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884289"><span class="hs-identifier hs-var">int</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682884286"><span class="annot"><span class="annottext">vec :: ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884286"><span class="hs-identifier hs-var hs-var">vec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><a href="#local-6989586621682884283"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-75"></span><span>                      </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span> </span><span id="local-6989586621682884291"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884291"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682884292"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884292"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682884293"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884293"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682884294"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884294"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884295"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884295"><span class="hs-identifier hs-var">s</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884296"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884296"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Profile -&gt; Bool
</span><a href="GHC.Cmm.CallConv.html#passVectorInReg"><span class="hs-identifier hs-var">passVectorInReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682884298"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682884256"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-77"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682884299"><span class="annot"><span class="annottext">reg_class :: Int -&gt; GlobalReg
</span><a href="#local-6989586621682884299"><span class="hs-identifier hs-var hs-var">reg_class</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682884298"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-78"></span><span>                                    </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W128"><span class="hs-identifier hs-var">W128</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#XmmReg"><span class="hs-identifier hs-var">XmmReg</span></a></span><span>
</span><span id="line-79"></span><span>                                    </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W256"><span class="hs-identifier hs-var">W256</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#YmmReg"><span class="hs-identifier hs-var">YmmReg</span></a></span><span>
</span><span id="line-80"></span><span>                                    </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W512"><span class="hs-identifier hs-var">W512</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#ZmmReg"><span class="hs-identifier hs-var">ZmmReg</span></a></span><span>
</span><span id="line-81"></span><span>                                    </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; GlobalReg
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CmmCallConv.assignArgumentsPos: Invalid vector width&quot;</span></span><span>
</span><span id="line-82"></span><span>                              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="#local-6989586621682884299"><span class="hs-identifier hs-var">reg_class</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884295"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884291"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884292"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884293"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884294"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884296"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>                      </span><span class="annot"><span class="annottext">AvailRegs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884280"><span class="hs-identifier hs-var">assts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884281"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884282"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>              </span><span id="local-6989586621682884288"><span class="annot"><span class="annottext">float :: ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884288"><span class="hs-identifier hs-var hs-var">float</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682884298"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><a href="#local-6989586621682884283"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span> </span><span id="local-6989586621682884309"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884309"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682884310"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884310"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682884311"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884311"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682884312"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884312"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884313"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884313"><span class="hs-identifier hs-var">s</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884314"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884314"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682884315"><span class="hs-identifier hs-var">passFloatInXmm</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#FloatReg"><span class="hs-identifier hs-var">FloatReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884313"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884309"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884310"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884311"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884312"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884314"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span> </span><span id="local-6989586621682884317"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884317"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884318"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884318"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884319"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884319"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682884320"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884320"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682884321"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884321"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621682884322"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884322"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682884315"><span class="hs-identifier hs-var">passFloatInXmm</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884318"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884317"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884319"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884320"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884321"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884322"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span> </span><span id="local-6989586621682884325"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884325"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682884326"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884326"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682884327"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884327"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682884328"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884328"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884329"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884329"><span class="hs-identifier hs-var">s</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884330"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884330"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682884315"><span class="hs-identifier hs-var">passFloatInXmm</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#DoubleReg"><span class="hs-identifier hs-var">DoubleReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884329"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884325"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884326"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884327"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884328"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884330"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span> </span><span id="local-6989586621682884332"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884332"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682884333"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884333"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884334"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884334"><span class="hs-identifier hs-var">d</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884335"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884335"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682884336"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884336"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621682884337"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884337"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682884315"><span class="hs-identifier hs-var">passFloatInXmm</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884334"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884332"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884333"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884335"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884336"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884337"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>                        </span><span class="annot"><span class="annottext">(Width, AvailRegs)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884280"><span class="hs-identifier hs-var">assts</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884281"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884282"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>              </span><span id="local-6989586621682884289"><span class="annot"><span class="annottext">int :: ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884289"><span class="hs-identifier hs-var hs-var">int</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682884298"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><a href="#local-6989586621682884283"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-95"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W128"><span class="hs-identifier hs-var">W128</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ([(a, ParamLocation)], [a])
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;W128 unsupported register type&quot;</span></span><span>
</span><span id="line-96"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884338"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884338"><span class="hs-identifier hs-var">v</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884339"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884339"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682884340"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884340"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682884341"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884341"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682884342"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884342"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621682884343"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884343"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682884298"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884338"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884339"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884340"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884341"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884342"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884343"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span> </span><span id="local-6989586621682884347"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884347"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682884348"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884348"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682884349"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884349"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884350"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884350"><span class="hs-identifier hs-var">l</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884351"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884351"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682884352"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884352"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682884298"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-var">RegisterParam</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884350"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884347"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884348"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884349"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682884351"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682884352"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>                      </span><span class="annot"><span class="annottext">(Width, AvailRegs)
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884280"><span class="hs-identifier hs-var">assts</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884281"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884282"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>              </span><span id="local-6989586621682884307"><span class="annot"><span class="annottext">k :: (ParamLocation, AvailRegs) -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884307"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884354"><span class="annot"><span class="annottext">ParamLocation
</span><a href="#local-6989586621682884354"><span class="hs-identifier hs-var">asst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682884355"><span class="annot"><span class="annottext">AvailRegs
</span><a href="#local-6989586621682884355"><span class="hs-identifier hs-var">regs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
-&gt; [a] -&gt; AvailRegs -&gt; ([(a, ParamLocation)], [a])
</span><a href="#local-6989586621682884277"><span class="hs-identifier hs-var">assign_regs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884281"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ParamLocation
</span><a href="#local-6989586621682884354"><span class="hs-identifier hs-var">asst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, ParamLocation) -&gt; [(a, ParamLocation)] -&gt; [(a, ParamLocation)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884280"><span class="hs-identifier hs-var">assts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884282"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><a href="#local-6989586621682884355"><span class="hs-identifier hs-var">regs'</span></a></span><span>
</span><span id="line-102"></span><span>              </span><span id="local-6989586621682884285"><span class="annot"><span class="annottext">ty :: CmmType
</span><a href="#local-6989586621682884285"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621682884259"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884281"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-103"></span><span>              </span><span id="local-6989586621682884298"><span class="annot"><span class="annottext">w :: Width
</span><a href="#local-6989586621682884298"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682884285"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-104"></span><span>              </span><span id="local-6989586621682884315"><span class="annot"><span class="annottext">passFloatInXmm :: Bool
</span><a href="#local-6989586621682884315"><span class="hs-identifier hs-var hs-var">passFloatInXmm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Cmm.CallConv.html#passFloatArgsInXmm"><span class="hs-identifier hs-var">passFloatArgsInXmm</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884263"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#passFloatArgsInXmm"><span class="hs-identifier hs-type">passFloatArgsInXmm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-107"></span><span id="passFloatArgsInXmm"><span class="annot"><span class="annottext">passFloatArgsInXmm :: Platform -&gt; Bool
</span><a href="GHC.Cmm.CallConv.html#passFloatArgsInXmm"><span class="hs-identifier hs-var hs-var">passFloatArgsInXmm</span></a></span></span><span> </span><span id="local-6989586621682884358"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884358"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">-- TODO: replace the following logic by casing on @registerArch (platformArch platform)@.</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- This will mean we start saying &quot;True&quot; for AArch64, which the rest of the AArch64</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- compilation pipeline will need to be able to handle (e.g. the AArch64 NCG).</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884358"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchX86_64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchX86</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- We used to spill vector registers to the stack since the LLVM backend didn't</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- support vector registers in its calling convention. However, this has now</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- been fixed. This function remains only as a convenient way to re-enable</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- spilling when debugging code generation.</span><span>
</span><span id="line-121"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#passVectorInReg"><span class="hs-identifier hs-type">passVectorInReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-122"></span><span id="passVectorInReg"><span class="annot"><span class="annottext">passVectorInReg :: Width -&gt; Profile -&gt; Bool
</span><a href="GHC.Cmm.CallConv.html#passVectorInReg"><span class="hs-identifier hs-var hs-var">passVectorInReg</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Profile
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span id="local-6989586621682884189"><span class="annot"><a href="GHC.Cmm.CallConv.html#assignStack"><span class="hs-identifier hs-type">assignStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682884189"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682884189"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-126"></span><span>                 </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>              </span><span class="hs-comment">-- bytes of stack args</span><span>
</span><span id="line-127"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682884189"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#ParamLocation"><span class="hs-identifier hs-type">ParamLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- args and locations</span><span>
</span><span id="line-128"></span><span>               </span><span class="hs-special">)</span></span><span>
</span><span id="line-129"></span><span id="assignStack"><span class="annot"><span class="annottext">assignStack :: forall a.
Platform
-&gt; Int -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
</span><a href="GHC.Cmm.CallConv.html#assignStack"><span class="hs-identifier hs-var hs-var">assignStack</span></a></span></span><span> </span><span id="local-6989586621682884364"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884364"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682884365"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884365"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621682884366"><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621682884366"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span id="local-6989586621682884367"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884367"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(a, ParamLocation)] -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
</span><a href="#local-6989586621682884368"><span class="hs-identifier hs-var">assign_stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884365"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884367"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-131"></span><span>      </span><span id="local-6989586621682884368"><span class="annot"><span class="annottext">assign_stk :: Int -&gt; [(a, ParamLocation)] -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
</span><a href="#local-6989586621682884368"><span class="hs-identifier hs-var hs-var">assign_stk</span></a></span></span><span> </span><span id="local-6989586621682884370"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884370"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621682884371"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884371"><span class="hs-identifier hs-var">assts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884370"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884371"><span class="hs-identifier hs-var">assts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><a href="#local-6989586621682884368"><span class="hs-identifier hs-var">assign_stk</span></a></span><span> </span><span id="local-6989586621682884372"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884372"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621682884373"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884373"><span class="hs-identifier hs-var">assts</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682884374"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884374"><span class="hs-identifier hs-var">r</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682884375"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884375"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(a, ParamLocation)] -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
</span><a href="#local-6989586621682884368"><span class="hs-identifier hs-var">assign_stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884376"><span class="hs-identifier hs-var">off'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884374"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ParamLocation
</span><a href="GHC.Cmm.CallConv.html#StackParam"><span class="hs-identifier hs-var">StackParam</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884376"><span class="hs-identifier hs-var">off'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, ParamLocation) -&gt; [(a, ParamLocation)] -&gt; [(a, ParamLocation)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682884373"><span class="hs-identifier hs-var">assts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884375"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682884377"><span class="annot"><span class="annottext">w :: Width
</span><a href="#local-6989586621682884377"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621682884366"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884374"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>              </span><span id="local-6989586621682884376"><span class="annot"><span class="annottext">off' :: Int
</span><a href="#local-6989586621682884376"><span class="hs-identifier hs-var hs-var">off'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884372"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884379"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-136"></span><span>              </span><span class="hs-comment">-- Stack arguments always take a whole number of words, we never</span><span>
</span><span id="line-137"></span><span>              </span><span class="hs-comment">-- pack them unlike constructor fields.</span><span>
</span><span id="line-138"></span><span>              </span><span id="local-6989586621682884379"><span class="annot"><span class="annottext">size :: Int
</span><a href="#local-6989586621682884379"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#roundUpToWords"><span class="hs-identifier hs-var">roundUpToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884364"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682884377"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- Local information about the registers available</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><span class="hs-comment">-- | Keep track of locally available registers.</span></span><span>
</span><span id="line-144"></span><span class="hs-keyword">data</span><span> </span><span id="AvailRegs"><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="AvailRegs"><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="availVanillaRegs"><span class="annot"><span class="annottext">AvailRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availVanillaRegs"><span class="hs-identifier hs-var hs-var">availVanillaRegs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Available vanilla registers</span></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="availFloatRegs"><span class="annot"><span class="annottext">AvailRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availFloatRegs"><span class="hs-identifier hs-var hs-var">availFloatRegs</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Available float registers</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="availDoubleRegs"><span class="annot"><span class="annottext">AvailRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availDoubleRegs"><span class="hs-identifier hs-var hs-var">availDoubleRegs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-151"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Available double registers</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="availLongRegs"><span class="annot"><span class="annottext">AvailRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availLongRegs"><span class="hs-identifier hs-var hs-var">availLongRegs</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-153"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Available long registers</span></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="availXMMRegs"><span class="annot"><span class="annottext">AvailRegs -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#availXMMRegs"><span class="hs-identifier hs-var hs-var">availXMMRegs</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Available vector XMM registers</span></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#noAvailRegs"><span class="hs-identifier hs-type">noAvailRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span>
</span><span id="line-159"></span><span id="noAvailRegs"><span class="annot"><span class="annottext">noAvailRegs :: AvailRegs
</span><a href="GHC.Cmm.CallConv.html#noAvailRegs"><span class="hs-identifier hs-var hs-var">noAvailRegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
-&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg] -&gt; [Int] -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-var">AvailRegs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- Vanilla registers can contain pointers, Ints, Chars.</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- Floats and doubles have separate register supplies.</span><span>
</span><span id="line-163"></span><span class="hs-comment">--</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- We take these register supplies from the *real* registers, i.e. those</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- that are guaranteed to map to machine registers.</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#getRegsWithoutNode"><span class="hs-identifier hs-type">getRegsWithoutNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#getRegsWithNode"><span class="hs-identifier hs-type">getRegsWithNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span>
</span><span id="line-168"></span><span id="getRegsWithoutNode"><span class="annot"><span class="annottext">getRegsWithoutNode :: Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#getRegsWithoutNode"><span class="hs-identifier hs-var hs-var">getRegsWithoutNode</span></a></span></span><span> </span><span id="local-6989586621682884388"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884388"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span>
</span><span id="line-170"></span><span>   </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">availVanillaRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availVanillaRegs"><span class="hs-identifier hs-var">availVanillaRegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalReg -&gt; Bool) -&gt; [GlobalReg] -&gt; [GlobalReg]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682884389"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884389"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884389"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; GlobalReg -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#node"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realVanillaRegs"><span class="hs-identifier hs-var">realVanillaRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884388"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availFloatRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availFloatRegs"><span class="hs-identifier hs-var">availFloatRegs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realFloatRegs"><span class="hs-identifier hs-var">realFloatRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884388"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-172"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availDoubleRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availDoubleRegs"><span class="hs-identifier hs-var">availDoubleRegs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realDoubleRegs"><span class="hs-identifier hs-var">realDoubleRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884388"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-173"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availLongRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availLongRegs"><span class="hs-identifier hs-var">availLongRegs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realLongRegs"><span class="hs-identifier hs-var">realLongRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884388"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-174"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availXMMRegs :: [Int]
</span><a href="GHC.Cmm.CallConv.html#availXMMRegs"><span class="hs-identifier hs-var">availXMMRegs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#realXmmRegNos"><span class="hs-identifier hs-var">realXmmRegNos</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884388"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- getRegsWithNode uses R1/node even if it isn't a register</span><span>
</span><span id="line-177"></span><span id="getRegsWithNode"><span class="annot"><span class="annottext">getRegsWithNode :: Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#getRegsWithNode"><span class="hs-identifier hs-var hs-var">getRegsWithNode</span></a></span></span><span> </span><span id="local-6989586621682884397"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884397"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span>
</span><span id="line-179"></span><span>   </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">availVanillaRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availVanillaRegs"><span class="hs-identifier hs-var">availVanillaRegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[GlobalReg] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realVanillaRegs"><span class="hs-identifier hs-var">realVanillaRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884397"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#VanillaReg"><span class="hs-identifier hs-var">VanillaReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-181"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realVanillaRegs"><span class="hs-identifier hs-var">realVanillaRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884397"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-182"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availFloatRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availFloatRegs"><span class="hs-identifier hs-var">availFloatRegs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realFloatRegs"><span class="hs-identifier hs-var">realFloatRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884397"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-183"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availDoubleRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availDoubleRegs"><span class="hs-identifier hs-var">availDoubleRegs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realDoubleRegs"><span class="hs-identifier hs-var">realDoubleRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884397"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-184"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availLongRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availLongRegs"><span class="hs-identifier hs-var">availLongRegs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realLongRegs"><span class="hs-identifier hs-var">realLongRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884397"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-185"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availXMMRegs :: [Int]
</span><a href="GHC.Cmm.CallConv.html#availXMMRegs"><span class="hs-identifier hs-var">availXMMRegs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#realXmmRegNos"><span class="hs-identifier hs-var">realXmmRegNos</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884397"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#allFloatRegs"><span class="hs-identifier hs-type">allFloatRegs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#allDoubleRegs"><span class="hs-identifier hs-type">allDoubleRegs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#allLongRegs"><span class="hs-identifier hs-type">allLongRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-188"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#allVanillaRegs"><span class="hs-identifier hs-type">allVanillaRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#allXmmRegs"><span class="hs-identifier hs-type">allXmmRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span id="allVanillaRegs"><span class="annot"><span class="annottext">allVanillaRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allVanillaRegs"><span class="hs-identifier hs-var hs-var">allVanillaRegs</span></a></span></span><span> </span><span id="local-6989586621682884405"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884405"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#VanillaReg"><span class="hs-identifier hs-var">VanillaReg</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Vanilla_REG"><span class="hs-identifier hs-var">pc_MAX_Vanilla_REG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884405"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span id="allFloatRegs"><span class="annot"><span class="annottext">allFloatRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allFloatRegs"><span class="hs-identifier hs-var hs-var">allFloatRegs</span></a></span></span><span>   </span><span id="local-6989586621682884409"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884409"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#FloatReg"><span class="hs-identifier hs-var">FloatReg</span></a></span><span>   </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Float_REG"><span class="hs-identifier hs-var">pc_MAX_Float_REG</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884409"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span id="allDoubleRegs"><span class="annot"><span class="annottext">allDoubleRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allDoubleRegs"><span class="hs-identifier hs-var hs-var">allDoubleRegs</span></a></span></span><span>  </span><span id="local-6989586621682884411"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884411"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#DoubleReg"><span class="hs-identifier hs-var">DoubleReg</span></a></span><span>  </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Double_REG"><span class="hs-identifier hs-var">pc_MAX_Double_REG</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884411"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span id="allLongRegs"><span class="annot"><span class="annottext">allLongRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allLongRegs"><span class="hs-identifier hs-var hs-var">allLongRegs</span></a></span></span><span>    </span><span id="local-6989586621682884413"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884413"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#LongReg"><span class="hs-identifier hs-var">LongReg</span></a></span><span>    </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Long_REG"><span class="hs-identifier hs-var">pc_MAX_Long_REG</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884413"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span id="allXmmRegs"><span class="annot"><span class="annottext">allXmmRegs :: Platform -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#allXmmRegs"><span class="hs-identifier hs-var hs-var">allXmmRegs</span></a></span></span><span>     </span><span id="local-6989586621682884416"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884416"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>                  </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_XMM_REG"><span class="hs-identifier hs-var">pc_MAX_XMM_REG</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884416"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#realFloatRegs"><span class="hs-identifier hs-type">realFloatRegs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#realDoubleRegs"><span class="hs-identifier hs-type">realDoubleRegs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#realLongRegs"><span class="hs-identifier hs-type">realLongRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#realVanillaRegs"><span class="hs-identifier hs-type">realVanillaRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="realVanillaRegs"><span class="annot"><span class="annottext">realVanillaRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realVanillaRegs"><span class="hs-identifier hs-var hs-var">realVanillaRegs</span></a></span></span><span> </span><span id="local-6989586621682884418"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884418"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#VanillaReg"><span class="hs-identifier hs-var">VanillaReg</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Real_Vanilla_REG"><span class="hs-identifier hs-var">pc_MAX_Real_Vanilla_REG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884418"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span id="realFloatRegs"><span class="annot"><span class="annottext">realFloatRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realFloatRegs"><span class="hs-identifier hs-var hs-var">realFloatRegs</span></a></span></span><span>   </span><span id="local-6989586621682884420"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884420"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#FloatReg"><span class="hs-identifier hs-var">FloatReg</span></a></span><span>   </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Real_Float_REG"><span class="hs-identifier hs-var">pc_MAX_Real_Float_REG</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884420"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span id="realDoubleRegs"><span class="annot"><span class="annottext">realDoubleRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realDoubleRegs"><span class="hs-identifier hs-var hs-var">realDoubleRegs</span></a></span></span><span>  </span><span id="local-6989586621682884422"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884422"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#DoubleReg"><span class="hs-identifier hs-var">DoubleReg</span></a></span><span>  </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Real_Double_REG"><span class="hs-identifier hs-var">pc_MAX_Real_Double_REG</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884422"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span id="realLongRegs"><span class="annot"><span class="annottext">realLongRegs :: Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realLongRegs"><span class="hs-identifier hs-var hs-var">realLongRegs</span></a></span></span><span>    </span><span id="local-6989586621682884424"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884424"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#LongReg"><span class="hs-identifier hs-var">LongReg</span></a></span><span>    </span><span class="annot"><span class="annottext">([Int] -&gt; [GlobalReg]) -&gt; [Int] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Real_Long_REG"><span class="hs-identifier hs-var">pc_MAX_Real_Long_REG</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884424"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#realXmmRegNos"><span class="hs-identifier hs-type">realXmmRegNos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span id="realXmmRegNos"><span class="annot"><span class="annottext">realXmmRegNos :: Platform -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#realXmmRegNos"><span class="hs-identifier hs-var hs-var">realXmmRegNos</span></a></span></span><span> </span><span id="local-6989586621682884426"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884426"><span class="hs-identifier hs-var">platform</span></a></span></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#isSse2Enabled"><span class="hs-identifier hs-var">isSse2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884426"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884426"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchAArch64</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var">regList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_MAX_Real_XMM_REG"><span class="hs-identifier hs-var">pc_MAX_Real_XMM_REG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884426"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-type">regList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span id="regList"><span class="annot"><span class="annottext">regList :: Int -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#regList"><span class="hs-identifier hs-var hs-var">regList</span></a></span></span><span> </span><span id="local-6989586621682884431"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884431"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884431"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#allRegs"><span class="hs-identifier hs-type">allRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span>
</span><span id="line-216"></span><span id="allRegs"><span class="annot"><span class="annottext">allRegs :: Platform -&gt; AvailRegs
</span><a href="GHC.Cmm.CallConv.html#allRegs"><span class="hs-identifier hs-var hs-var">allRegs</span></a></span></span><span> </span><span id="local-6989586621682884432"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884432"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span>
</span><span id="line-218"></span><span>   </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">availVanillaRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availVanillaRegs"><span class="hs-identifier hs-var">availVanillaRegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allVanillaRegs"><span class="hs-identifier hs-var">allVanillaRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884432"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-219"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availFloatRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availFloatRegs"><span class="hs-identifier hs-var">availFloatRegs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allFloatRegs"><span class="hs-identifier hs-var">allFloatRegs</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884432"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-220"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availDoubleRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availDoubleRegs"><span class="hs-identifier hs-var">availDoubleRegs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allDoubleRegs"><span class="hs-identifier hs-var">allDoubleRegs</span></a></span><span>  </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884432"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-221"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availLongRegs :: [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#availLongRegs"><span class="hs-identifier hs-var">availLongRegs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allLongRegs"><span class="hs-identifier hs-var">allLongRegs</span></a></span><span>    </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884432"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-222"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availXMMRegs :: [Int]
</span><a href="GHC.Cmm.CallConv.html#availXMMRegs"><span class="hs-identifier hs-var">availXMMRegs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#allXmmRegs"><span class="hs-identifier hs-var">allXmmRegs</span></a></span><span>     </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884432"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#nodeOnly"><span class="hs-identifier hs-type">nodeOnly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#AvailRegs"><span class="hs-identifier hs-type">AvailRegs</span></a></span><span>
</span><span id="line-225"></span><span id="nodeOnly"><span class="annot"><span class="annottext">nodeOnly :: AvailRegs
</span><a href="GHC.Cmm.CallConv.html#nodeOnly"><span class="hs-identifier hs-var hs-var">nodeOnly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AvailRegs
</span><a href="GHC.Cmm.CallConv.html#noAvailRegs"><span class="hs-identifier hs-var">noAvailRegs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#availVanillaRegs"><span class="hs-identifier hs-var">availVanillaRegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#VanillaReg"><span class="hs-identifier hs-type">VanillaReg</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- | A set of global registers that cover the machine registers used</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- for argument passing.</span><span>
</span><span id="line-229"></span><span class="hs-comment">--</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- See Note [realArgRegsCover].</span><span>
</span><span id="line-231"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#realArgRegsCover"><span class="hs-identifier hs-type">realArgRegsCover</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-232"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalArgRegs"><span class="hs-identifier hs-type">GlobalArgRegs</span></a></span><span>
</span><span id="line-233"></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ which kinds of registers do we want to cover?</span></span><span>
</span><span id="line-234"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-235"></span><span id="realArgRegsCover"><span class="annot"><span class="annottext">realArgRegsCover :: Platform -&gt; GlobalArgRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realArgRegsCover"><span class="hs-identifier hs-var hs-var">realArgRegsCover</span></a></span></span><span> </span><span id="local-6989586621682884433"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682884434"><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="#local-6989586621682884434"><span class="hs-identifier hs-var">argRegs</span></a></span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realVanillaRegs"><span class="hs-identifier hs-var">realVanillaRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><span class="annottext">[GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realLongRegs"><span class="hs-identifier hs-var">realLongRegs</span></a></span><span>    </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="annottext">[GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[GlobalReg]] -&gt; [GlobalReg]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-special">(</span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realFloatRegs"><span class="hs-identifier hs-var">realFloatRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682884436"><span class="hs-identifier hs-var">wantFP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Cmm.CallConv.html#passFloatArgsInXmm"><span class="hs-identifier hs-var">passFloatArgsInXmm</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>           </span><span class="hs-comment">-- TODO: the line above is legacy logic, but removing it breaks</span><span>
</span><span id="line-241"></span><span>           </span><span class="hs-comment">-- the bytecode interpreter on AArch64. Probably easy to fix.</span><span>
</span><span id="line-242"></span><span>           </span><span class="hs-comment">-- AK: I believe this might be because we map REG_F1..4 and REG_D1..4 to different</span><span>
</span><span id="line-243"></span><span>           </span><span class="hs-comment">-- machine registers on AArch64.</span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><span class="annottext">[[GlobalReg]] -&gt; [[GlobalReg]] -&gt; [[GlobalReg]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realDoubleRegs"><span class="hs-identifier hs-var">realDoubleRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682884436"><span class="hs-identifier hs-var">wantFP</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><span class="annottext">[GlobalReg] -&gt; [GlobalReg] -&gt; [GlobalReg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="#local-6989586621682884437"><span class="hs-identifier hs-var">mkVecReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884438"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682884437"><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="#local-6989586621682884437"><span class="hs-identifier hs-var">mkVecReg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; GlobalReg) -&gt; [Int -&gt; GlobalReg]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; GlobalReg)
</span><a href="#local-6989586621682884439"><span class="hs-identifier hs-var">mbMkVecReg</span></a></span><span>
</span><span id="line-247"></span><span>                  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682884438"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884438"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [Int]
</span><a href="GHC.Cmm.CallConv.html#realXmmRegNos"><span class="hs-identifier hs-var">realXmmRegNos</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621682884436"><span class="annot"><span class="annottext">wantFP :: Bool
</span><a href="#local-6989586621682884436"><span class="hs-identifier hs-var hs-var">wantFP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Arch -&gt; RegArch
</span><a href="GHC.Platform.Reg.Class.html#registerArch"><span class="hs-identifier hs-var">registerArch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">RegArch
</span><a href="GHC.Platform.Reg.Class.html#Unified"><span class="hs-identifier hs-var">Unified</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="#local-6989586621682884434"><span class="hs-identifier hs-var">argRegs</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs -&gt; GlobalArgRegs -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="GHC.Cmm.Reg.html#SCALAR_ARG_REGS"><span class="hs-identifier hs-var">SCALAR_ARG_REGS</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><span class="annottext">RegArch
</span><a href="GHC.Platform.Reg.Class.html#Separate"><span class="hs-identifier hs-var">Separate</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="#local-6989586621682884434"><span class="hs-identifier hs-var">argRegs</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs -&gt; GlobalArgRegs -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="GHC.Cmm.Reg.html#SCALAR_ARG_REGS"><span class="hs-identifier hs-var">SCALAR_ARG_REGS</span></a></span><span>
</span><span id="line-253"></span><span>      </span><span class="annot"><span class="annottext">RegArch
</span><a href="GHC.Platform.Reg.Class.html#NoVectors"><span class="hs-identifier hs-var">NoVectors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="#local-6989586621682884434"><span class="hs-identifier hs-var">argRegs</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs -&gt; GlobalArgRegs -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="GHC.Cmm.Reg.html#SCALAR_ARG_REGS"><span class="hs-identifier hs-var">SCALAR_ARG_REGS</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621682884439"><span class="annot"><span class="annottext">mbMkVecReg :: Maybe (Int -&gt; GlobalReg)
</span><a href="#local-6989586621682884439"><span class="hs-identifier hs-var hs-var">mbMkVecReg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Arch -&gt; RegArch
</span><a href="GHC.Platform.Reg.Class.html#registerArch"><span class="hs-identifier hs-var">registerArch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884433"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><span class="annottext">RegArch
</span><a href="GHC.Platform.Reg.Class.html#Unified"><span class="hs-identifier hs-var">Unified</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; GlobalReg)
</span><a href="#local-6989586621682884445"><span class="hs-identifier hs-var">mb_xyzmm</span></a></span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">RegArch
</span><a href="GHC.Platform.Reg.Class.html#Separate"><span class="hs-identifier hs-var">Separate</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; GlobalReg)
</span><a href="#local-6989586621682884445"><span class="hs-identifier hs-var">mb_xyzmm</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">RegArch
</span><a href="GHC.Platform.Reg.Class.html#NoVectors"><span class="hs-identifier hs-var">NoVectors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; GlobalReg)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621682884445"><span class="annot"><span class="annottext">mb_xyzmm :: Maybe (Int -&gt; GlobalReg)
</span><a href="#local-6989586621682884445"><span class="hs-identifier hs-var hs-var">mb_xyzmm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="#local-6989586621682884434"><span class="hs-identifier hs-var">argRegs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="GHC.Cmm.Reg.html#V16_ARG_REGS"><span class="hs-identifier hs-var">V16_ARG_REGS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; Maybe (Int -&gt; GlobalReg)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#XmmReg"><span class="hs-identifier hs-var">XmmReg</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="GHC.Cmm.Reg.html#V32_ARG_REGS"><span class="hs-identifier hs-var">V32_ARG_REGS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; Maybe (Int -&gt; GlobalReg)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#YmmReg"><span class="hs-identifier hs-var">YmmReg</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="GHC.Cmm.Reg.html#V64_ARG_REGS"><span class="hs-identifier hs-var">V64_ARG_REGS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GlobalReg) -&gt; Maybe (Int -&gt; GlobalReg)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#ZmmReg"><span class="hs-identifier hs-var">ZmmReg</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; GlobalReg)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Like &quot;realArgRegsCover&quot;, but always includes the node.</span><span>
</span><span id="line-265"></span><span class="hs-comment">--</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- See Note [realArgRegsCover].</span><span>
</span><span id="line-267"></span><span class="annot"><a href="GHC.Cmm.CallConv.html#allArgRegsCover"><span class="hs-identifier hs-type">allArgRegsCover</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-268"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalArgRegs"><span class="hs-identifier hs-type">GlobalArgRegs</span></a></span><span>
</span><span id="line-269"></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ which kinds of registers do we want to cover?</span></span><span>
</span><span id="line-270"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span id="allArgRegsCover"><span class="annot"><span class="annottext">allArgRegsCover :: Platform -&gt; GlobalArgRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allArgRegsCover"><span class="hs-identifier hs-var hs-var">allArgRegsCover</span></a></span></span><span> </span><span id="local-6989586621682884449"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884449"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682884450"><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="#local-6989586621682884450"><span class="hs-identifier hs-var">argRegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="annottext">[GlobalReg] -&gt; [GlobalReg]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682884451"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; [GlobalReg] -&gt; [GlobalReg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; GlobalArgRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#realArgRegsCover"><span class="hs-identifier hs-var">realArgRegsCover</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682884449"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="#local-6989586621682884450"><span class="hs-identifier hs-var">argRegs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621682884451"><span class="annot"><span class="annottext">node :: GlobalReg
</span><a href="#local-6989586621682884451"><span class="hs-identifier hs-var hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#VanillaReg"><span class="hs-identifier hs-var">VanillaReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">{- Note [realArgRegsCover]
~~~~~~~~~~~~~~~~~~~~~~~~~~
In low-level Cmm, jumps must be annotated with a set of live registers,
allowing precise control of global STG register contents across function calls.
However, in some places (in particular in the RTS), the registers we want to
preserve depend on the *caller*. For example, if we intercept a function call
via a stack underflow frame, we want to preserve exactly those registers
containing function arguments.
Since we can't know exactly how many arguments the caller passed, we settle on
simply preserving all global regs which might be used for argument passing.
To do this, we specify a collection of registers that *covers* all the registers
we want to preserve; this is done by &quot;realArgRegsCover&quot;.

The situation is made somewhat tricky by the need to handle vector registers.
For example, on X86_64, the F, D, XMM, YMM, ZMM overlap in the following way
          &#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
          &#9474;F&#9478;D&#9478;XMM&#9478;  YMM  &#9478;     ZMM       &#9474;
          &#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
where each register extends all the way to the left.

Based on this register architecture, on X86_64 we might want to annotate a jump
in which we (might) want to preserve the contents of all argument-passing
registers with [R1, ..., R6, ZMM1, ..., ZMM6]. This, however, is not possible
in general, because preserving e.g. a ZMM register across a C call requires the
availability of the AVX-512F instruction set. If we did this, the RTS would
crash at runtime with an &quot;invalid instruction&quot; error on X86_64 machines which
do not support AVX-512F.

Instead, we parametrise &quot;realArgRegsCover&quot; on the 'GlobalArgRegs' datatype, which
specifies which registers it is sufficient to preserve. For example, it might
suffice to only preserve general-purpose registers, or to only preserve up to
XMM (not YMM or ZMM).

Then, to handle certain functions in the RTS such as &quot;stack_underflow_frame&quot;, we
proceed by defining 4 variants, stack_underflow_frame_{d,v16,v32,v64}, which
respectively annotate the jump at the end of the function with SCALAR_ARG_REGS,
V16_ARG_REGS, V32_ARG_REGS and V64_ARG_REGS. Compiling these variants, in effect,
amounts to compiling &quot;stack_underflow_frame&quot; four times, once for each level of
vector support. Then, in the RTS, we dispatch at runtime based on the support
for vectors provided by the architecture on the current machine (see e.g.
'threadStackOverflow' and its 'switch (vectorSupportGlobalVar)'.)

Note that, like in Note [AutoApply.cmm for vectors], it is **critical** that we
compile e.g. stack_underflow_frame_v64 with -mavx512f. If we don't, the LLVM
backend is liable to compile code using e.g. the ZMM1 STG register to uses of
X86 machine registers xmm1, xmm2, xmm3, xmm4, instead of just zmm1. This would
mean that LLVM produces ABI-incompatible code that would result in segfaults in
the RTS.
-}</span></pre></body></html>