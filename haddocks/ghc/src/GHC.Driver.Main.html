<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -fprof-auto-top #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- | Main API for compiling plain Haskell source code.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- This module implements compilation of a Haskell source. It is</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- /not/ concerned with preprocessing of source files; this is handled</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- in &quot;GHC.Driver.Pipeline&quot;</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- There are various entry points depending on what mode we're in:</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- &quot;batch&quot; mode (@--make@), &quot;one-shot&quot; mode (@-c@, @-S@ etc.), and</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- &quot;interactive&quot; mode (GHCi). There are also entry points for</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- individual passes: parsing, typechecking/renaming, desugaring, and</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- simplification.</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- All the functions here take an 'HscEnv' as a parameter, but none of</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- them return a new one: 'HscEnv' is treated as an immutable value</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- from here on in (although it has mutable components, for the</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- caches).</span><span>
</span><span id="line-26"></span><span class="hs-comment">--</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- We use the Hsc monad to deal with warning messages consistently:</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- specifically, while executing within an Hsc monad, warnings are</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- collected. When a Hsc monad returns to an IO monad, the</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- warnings are printed, or compilation aborts if the @-Werror@</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- flag is enabled.</span><span>
</span><span id="line-32"></span><span class="hs-comment">--</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- (c) The GRASP/AQUA Project, Glasgow University, 1993-2000</span><span>
</span><span id="line-34"></span><span class="hs-comment">--</span><span>
</span><span id="line-35"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html"><span class="hs-identifier">GHC.Driver.Main</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Making an HscEnv</span></span><span>
</span><span id="line-40"></span><span>      </span><span class="annot"><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier">newHscEnv</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#newHscEnvWithHUG"><span class="hs-identifier">newHscEnvWithHUG</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#initHscEnv"><span class="hs-identifier">initHscEnv</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Compiling complete source files</span></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier">Messager</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier">batchMsg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#batchMultiMsg"><span class="hs-identifier">batchMultiMsg</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscBackendAction"><span class="hs-identifier">HscBackendAction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscRecompStatus"><span class="hs-identifier">HscRecompStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier">initModDetails</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#initWholeCoreBindings"><span class="hs-identifier">initWholeCoreBindings</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#loadIfaceByteCode"><span class="hs-identifier">loadIfaceByteCode</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier">hscMaybeWriteIface</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier">hscCompileCmmFile</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier">hscGenHardCode</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier">hscInteractive</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#mkCgInteractiveGuts"><span class="hs-identifier">mkCgInteractiveGuts</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier">CgInteractiveGuts</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#generateByteCode"><span class="hs-identifier">generateByteCode</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#generateFreshByteCode"><span class="hs-identifier">generateFreshByteCode</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Running passes separately</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscRecompStatus"><span class="hs-identifier">hscRecompStatus</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParse"><span class="hs-identifier">hscParse</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckRename"><span class="hs-identifier">hscTypecheckRename</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckRenameWithDiagnostics"><span class="hs-identifier">hscTypecheckRenameWithDiagnostics</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckAndGetWarnings"><span class="hs-identifier">hscTypecheckAndGetWarnings</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar"><span class="hs-identifier">hscDesugar</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#makeSimpleDetails"><span class="hs-identifier">makeSimpleDetails</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier">hscSimplify</span></a></span><span> </span><span class="hs-comment">-- ToDo, shouldn't really export this</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugarAndSimplify"><span class="hs-identifier">hscDesugarAndSimplify</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Safe Haskell</span></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafe"><span class="hs-identifier">hscCheckSafe</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscGetSafe"><span class="hs-identifier">hscGetSafe</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Support for interactive evaluation</span></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseIdentifier"><span class="hs-identifier">hscParseIdentifier</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRcLookupName"><span class="hs-identifier">hscTcRcLookupName</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnGetInfo"><span class="hs-identifier">hscTcRnGetInfo</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscIsGHCiMonad"><span class="hs-identifier">hscIsGHCiMonad</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscGetModuleInterface"><span class="hs-identifier">hscGetModuleInterface</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscRnImportDecls"><span class="hs-identifier">hscRnImportDecls</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnLookupRdrName"><span class="hs-identifier">hscTcRnLookupRdrName</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscStmt"><span class="hs-identifier">hscStmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier">hscParseStmtWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier">hscStmtWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier">hscParsedStmt</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDecls"><span class="hs-identifier">hscDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseDeclsWithLocation"><span class="hs-identifier">hscParseDeclsWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier">hscDeclsWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier">hscParsedDecls</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseModuleWithLocation"><span class="hs-identifier">hscParseModuleWithLocation</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcExpr"><span class="hs-identifier">hscTcExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#TcRnExprMode"><span class="hs-identifier">TcRnExprMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscImport"><span class="hs-identifier">hscImport</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscKcType"><span class="hs-identifier">hscKcType</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier">hscParseExpr</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier">hscParseType</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier">hscCompileCoreExpr</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTidy"><span class="hs-identifier">hscTidy</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Low-level exports for hooks</span></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier">hscCompileCoreExpr'</span></a></span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-comment">-- We want to make sure that we export enough to be able to redefine</span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-comment">-- hsc_typecheck in client code</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier">hscParse'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier">hscSimplify'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier">hscDesugar'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier">tcRnModule'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier">doCodeGen</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier">getHscEnv</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier">hscSimpleIface'</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier">oneShotMsg</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier">dumpIfaceStats</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier">ioMsgMaybe</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier">showModuleIndex</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier">hscAddSptEntries</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#writeInterfaceOnlyMode"><span class="hs-identifier">writeInterfaceOnlyMode</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#loadByteCode"><span class="hs-identifier">loadByteCode</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html"><span class="hs-identifier">GHC.Driver.Backend</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html"><span class="hs-identifier">GHC.Driver.Env.KnotVars</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html"><span class="hs-identifier">GHC.Driver.Errors</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html"><span class="hs-identifier">GHC.Driver.Errors.Types</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.CodeOutput.html"><span class="hs-identifier">GHC.Driver.CodeOutput</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Cmm.Parser.html"><span class="hs-identifier">GHC.Driver.Config.Cmm.Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Cmm.Parser.html#initCmmParserConfig"><span class="hs-identifier">initCmmParserConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.Simplify.html"><span class="hs-identifier">GHC.Driver.Config.Core.Opt.Simplify</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initSimplifyExprOpts"><span class="hs-identifier">initSimplifyExprOpts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.html"><span class="hs-identifier">GHC.Driver.Config.Core.Lint</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.html#endPassHscEnvIO"><span class="hs-identifier">endPassHscEnvIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.Interactive.html"><span class="hs-identifier">GHC.Driver.Config.Core.Lint.Interactive</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.Interactive.html#lintInteractiveExpr"><span class="hs-identifier">lintInteractiveExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.CoreToStg.html"><span class="hs-identifier">GHC.Driver.Config.CoreToStg</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.CoreToStg.Prep.html"><span class="hs-identifier">GHC.Driver.Config.CoreToStg.Prep</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Logger.html"><span class="hs-identifier">GHC.Driver.Config.Logger</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Logger.html#initLogFlags"><span class="hs-identifier">initLogFlags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Parser.html"><span class="hs-identifier">GHC.Driver.Config.Parser</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Parser.html#initParserOpts"><span class="hs-identifier">initParserOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Stg.Ppr.html"><span class="hs-identifier">GHC.Driver.Config.Stg.Ppr</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Stg.Ppr.html#initStgPprOpts"><span class="hs-identifier">initStgPprOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Stg.Pipeline.html"><span class="hs-identifier">GHC.Driver.Config.Stg.Pipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Stg.Pipeline.html#initStgPipelineOpts"><span class="hs-identifier">initStgPipelineOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.StgToCmm.html"><span class="hs-identifier">GHC.Driver.Config.StgToCmm</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.StgToCmm.html#initStgToCmmConfig"><span class="hs-identifier">initStgToCmmConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Cmm.html"><span class="hs-identifier">GHC.Driver.Config.Cmm</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Cmm.html#initCmmConfig"><span class="hs-identifier">initCmmConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.LlvmConfigCache.html"><span class="hs-identifier">GHC.Driver.LlvmConfigCache</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.LlvmConfigCache.html#initLlvmConfigCache"><span class="hs-identifier">initLlvmConfigCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.StgToJS.html"><span class="hs-identifier">GHC.Driver.Config.StgToJS</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.StgToJS.html#initStgToJSConfig"><span class="hs-identifier">initStgToJSConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Tidy.html"><span class="hs-identifier">GHC.Driver.Config.Tidy</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html"><span class="hs-identifier">GHC.Driver.GenerateCgIPEStub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier">generateCgIPEStub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#lookupEstimatedTicks"><span class="hs-identifier">lookupEstimatedTicks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html"><span class="hs-identifier">GHC.Runtime.Context</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.JS.html"><span class="hs-identifier">GHC.Runtime.Interpreter.JS</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html"><span class="hs-identifier">GHC.Runtime.Loader</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier">initializePlugins</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html"><span class="hs-identifier">GHC.ByteCode.Types</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html"><span class="hs-identifier">GHC.Linker.Loader</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Deps.html"><span class="hs-identifier">GHC.Linker.Deps</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html"><span class="hs-identifier">GHC.Hs.Dump</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Stats.html"><span class="hs-identifier">GHC.Hs.Stats</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Stats.html#ppSourceStats"><span class="hs-identifier">ppSourceStats</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.html"><span class="hs-identifier">GHC.HsToCore</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html"><span class="hs-identifier">GHC.StgToByteCode</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier">byteCodeGen</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.html"><span class="hs-identifier">GHC.StgToJS</span></a></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#stgToJS"><span class="hs-identifier">stgToJS</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html"><span class="hs-identifier">GHC.StgToJS.Ids</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html"><span class="hs-identifier">GHC.StgToJS.Types</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Syntax.html"><span class="hs-identifier">GHC.JS.Syntax</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier">typecheckIface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html#typecheckWholeCoreBindings"><span class="hs-identifier">typecheckWholeCoreBindings</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#ifaceStats"><span class="hs-identifier">ifaceStats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#writeIface"><span class="hs-identifier">writeIface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#flagsToIfCompression"><span class="hs-identifier">flagsToIfCompression</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html"><span class="hs-identifier">GHC.Iface.Make</span></a></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html"><span class="hs-identifier">GHC.Iface.Recomp</span></a></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Tidy.html"><span class="hs-identifier">GHC.Iface.Tidy</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Ast.html"><span class="hs-identifier">GHC.Iface.Ext.Ast</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Ast.html#mkHieFile"><span class="hs-identifier">mkHieFile</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html"><span class="hs-identifier">GHC.Iface.Ext.Types</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#getAsts"><span class="hs-identifier">getAsts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#hie_asts"><span class="hs-identifier">hie_asts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#hie_module"><span class="hs-identifier">hie_module</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html"><span class="hs-identifier">GHC.Iface.Ext.Binary</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#readHieFile"><span class="hs-identifier">readHieFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#writeHieFile"><span class="hs-identifier">writeHieFile</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#hie_file_result"><span class="hs-identifier">hie_file_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html"><span class="hs-identifier">GHC.Iface.Ext.Debug</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html#diffFile"><span class="hs-identifier">diffFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html#validateScopes"><span class="hs-identifier">validateScopes</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Lint.Interactive.html"><span class="hs-identifier">GHC.Core.Lint.Interactive</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier">interactiveInScope</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html"><span class="hs-identifier">GHC.Core.Tidy</span></a></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier">tidyExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier">exprType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html"><span class="hs-identifier">GHC.Core.Opt.Pipeline</span></a></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html"><span class="hs-identifier">GHC.Core.Opt.Pipeline.Types</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier">CoreToDo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html"><span class="hs-identifier">GHC.Core.Rules</span></a></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Stats.html"><span class="hs-identifier">GHC.Core.Stats</span></a></span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.LateCC.html"><span class="hs-identifier">GHC.Core.LateCC</span></a></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.LateCC.Types.html"><span class="hs-identifier">GHC.Core.LateCC.Types</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CoreToStg.Prep.html"><span class="hs-identifier">GHC.CoreToStg.Prep</span></a></span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html"><span class="hs-identifier">GHC.CoreToStg</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#coreToStg"><span class="hs-identifier">coreToStg</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Errors.Types.html"><span class="hs-identifier">GHC.Parser.Errors.Types</span></a></span><span>
</span><span id="line-194"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.html"><span class="hs-identifier">GHC.Parser</span></a></span><span>
</span><span id="line-195"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html"><span class="hs-identifier">GHC.Parser.Lexer</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lexer</span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html"><span class="hs-identifier">GHC.Tc.Module</span></a></span><span>
</span><span id="line-198"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-199"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Env.html"><span class="hs-identifier">GHC.Tc.Zonk.Env</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Env.html#ZonkFlexi"><span class="hs-identifier">ZonkFlexi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Zonk.Env.html#DefaultFlexi"><span class="hs-identifier">DefaultFlexi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-203"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Pipeline.html"><span class="hs-identifier">GHC.Stg.Pipeline</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Stg.Pipeline.html#stg2stg"><span class="hs-identifier">stg2stg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#StgCgInfos"><span class="hs-identifier">StgCgInfos</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html"><span class="hs-identifier">GHC.Builtin.Utils</span></a></span><span>
</span><span id="line-206"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.StgToCmm.html"><span class="hs-identifier">GHC.StgToCmm</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">StgToCmm</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier">codeGen</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier">CmmCgInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier">ModuleLFInfos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LambdaFormInfo"><span class="hs-identifier">LambdaFormInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html"><span class="hs-identifier">GHC.StgToCmm.CgUtils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier">CgStream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-213"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html"><span class="hs-identifier">GHC.Cmm.Info.Build</span></a></span><span>
</span><span id="line-214"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Pipeline.html"><span class="hs-identifier">GHC.Cmm.Pipeline</span></a></span><span>
</span><span id="line-215"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.html"><span class="hs-identifier">GHC.Cmm.Info</span></a></span><span>
</span><span id="line-216"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Parser.html"><span class="hs-identifier">GHC.Cmm.Parser</span></a></span><span>
</span><span id="line-217"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.UniqueRenamer.html"><span class="hs-identifier">GHC.Cmm.UniqueRenamer</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-220"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-221"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html"><span class="hs-identifier">GHC.Unit.Finder</span></a></span><span>
</span><span id="line-222"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.External.html"><span class="hs-identifier">GHC.Unit.External</span></a></span><span>
</span><span id="line-223"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html"><span class="hs-identifier">GHC.Unit.Module.ModDetails</span></a></span><span>
</span><span id="line-224"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html"><span class="hs-identifier">GHC.Unit.Module.ModGuts</span></a></span><span>
</span><span id="line-225"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-226"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html"><span class="hs-identifier">GHC.Unit.Module.ModSummary</span></a></span><span>
</span><span id="line-227"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html"><span class="hs-identifier">GHC.Unit.Module.Graph</span></a></span><span>
</span><span id="line-228"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html"><span class="hs-identifier">GHC.Unit.Module.Imported</span></a></span><span>
</span><span id="line-229"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html"><span class="hs-identifier">GHC.Unit.Module.Deps</span></a></span><span>
</span><span id="line-230"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html"><span class="hs-identifier">GHC.Unit.Module.Status</span></a></span><span>
</span><span id="line-231"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-234"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceError.html"><span class="hs-identifier">GHC.Types.SourceError</span></a></span><span>
</span><span id="line-235"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html"><span class="hs-identifier">GHC.Types.SafeHaskell</span></a></span><span>
</span><span id="line-236"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html"><span class="hs-identifier">GHC.Types.ForeignStubs</span></a></span><span>
</span><span id="line-237"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier">mkNameEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#mkEmptyTidyEnv"><span class="hs-identifier">mkEmptyTidyEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-240"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-241"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html"><span class="hs-identifier">GHC.Types.Fixity.Env</span></a></span><span>
</span><span id="line-242"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-243"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html"><span class="hs-identifier">GHC.Types.IPE</span></a></span><span>
</span><span id="line-244"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-245"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-246"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-247"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html"><span class="hs-identifier">GHC.Types.Name.Cache</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#initNameCache"><span class="hs-identifier">initNameCache</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-249"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Ppr.html"><span class="hs-identifier">GHC.Types.Name.Ppr</span></a></span><span>
</span><span id="line-250"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-251"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-identifier">uniqFromTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Fingerprint.html"><span class="hs-identifier">GHC.Utils.Fingerprint</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Fingerprint</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-256"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-257"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-258"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-259"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-260"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span>
</span><span id="line-261"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Touch.html"><span class="hs-identifier">GHC.Utils.Touch</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-266"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-267"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OsPath.html"><span class="hs-identifier">GHC.Data.OsPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.OsPath.Internal.html#unsafeEncodeUtf"><span class="hs-identifier">unsafeEncodeUtf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html"><span class="hs-identifier">GHC.Data.StringBuffer</span></a></span><span>
</span><span id="line-269"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Stream</span></span><span>
</span><span id="line-270"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.html"><span class="hs-identifier">GHC.SysTools</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.SysTools.html#initSysTools"><span class="hs-identifier">initSysTools</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.BaseDir.html"><span class="hs-identifier">GHC.SysTools.BaseDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.SysTools.BaseDir.html#findTopDir"><span class="hs-identifier">findTopDir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Data.html"><span class="hs-identifier">Data.Data</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Fixity</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TyCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Functor.html"><span class="hs-identifier">Data.Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;&amp;&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isPrefixOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-279"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-280"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-281"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath</span></span><span>
</span><span id="line-282"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-283"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-284"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-286"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#force"><span class="hs-identifier">force</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html"><span class="hs-identifier">GHC.Unit.Module.WholeCoreBindings</span></a></span><span>
</span><span id="line-290"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html"><span class="hs-identifier">GHC.Types.TypeEnv</span></a></span><span>
</span><span id="line-291"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-292"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html"><span class="hs-identifier">GHC.Driver.Pipeline</span></a></span><span>
</span><span id="line-293"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../time-1.14-9bf8/src/Data.Time.html"><span class="hs-identifier">Data.Time</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">unsafeInterleaveIO</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html"><span class="hs-identifier">GHC.Iface.Env</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html#trace_if"><span class="hs-identifier">trace_if</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span>
</span><span id="line-298"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html"><span class="hs-identifier">GHC.Stg.InferTags.TagSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#seqTagSig"><span class="hs-identifier">seqTagSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html"><span class="hs-identifier">GHC.StgToCmm.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier">IPEStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-301"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span>
</span><span id="line-302"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Config.html"><span class="hs-identifier">GHC.Cmm.Config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Config.html#CmmConfig"><span class="hs-identifier">CmmConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Bifunctor.html"><span class="hs-identifier">Data.Bifunctor</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="annot"><span class="hs-comment">{- **********************************************************************
%*                                                                      *
                Initialisation
%*                                                                      *
%********************************************************************* -}</span></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier hs-type">newHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-312"></span><span id="newHscEnv"><span class="annot"><span class="annottext">newHscEnv :: [Char] -&gt; DynFlags -&gt; IO HscEnv
</span><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier hs-var hs-var">newHscEnv</span></a></span></span><span> </span><span id="local-6989586621683156211"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156211"><span class="hs-identifier hs-var">top_dir</span></a></span></span><span> </span><span id="local-6989586621683156212"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156212"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DynFlags -&gt; UnitId -&gt; HomeUnitGraph -&gt; IO HscEnv
</span><a href="GHC.Driver.Main.html#newHscEnvWithHUG"><span class="hs-identifier hs-var">newHscEnvWithHUG</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156211"><span class="hs-identifier hs-var">top_dir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156212"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.DynFlags.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156212"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621683156214"><span class="hs-identifier hs-var">home_unit_graph</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621683156214"><span class="annot"><span class="annottext">home_unit_graph :: HomeUnitGraph
</span><a href="#local-6989586621683156214"><span class="hs-identifier hs-var hs-var">home_unit_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; HomeUnitEnv -&gt; HomeUnitGraph
forall v. UnitId -&gt; v -&gt; UnitEnvGraph v
</span><a href="GHC.Unit.Env.html#unitEnv_singleton"><span class="hs-identifier hs-var">unitEnv_singleton</span></a></span><span>
</span><span id="line-315"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.DynFlags.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156212"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; HomePackageTable -&gt; Maybe HomeUnit -&gt; HomeUnitEnv
</span><a href="GHC.Unit.Env.html#mkHomeUnitEnv"><span class="hs-identifier hs-var">mkHomeUnitEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156212"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomePackageTable"><span class="hs-identifier hs-var">emptyHomePackageTable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnit
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><a href="GHC.Driver.Main.html#newHscEnvWithHUG"><span class="hs-identifier hs-type">newHscEnvWithHUG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-319"></span><span id="newHscEnvWithHUG"><span class="annot"><span class="annottext">newHscEnvWithHUG :: [Char] -&gt; DynFlags -&gt; UnitId -&gt; HomeUnitGraph -&gt; IO HscEnv
</span><a href="GHC.Driver.Main.html#newHscEnvWithHUG"><span class="hs-identifier hs-var hs-var">newHscEnvWithHUG</span></a></span></span><span> </span><span id="local-6989586621683156218"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156218"><span class="hs-identifier hs-var">top_dir</span></a></span></span><span> </span><span id="local-6989586621683156219"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156219"><span class="hs-identifier hs-var">top_dynflags</span></a></span></span><span> </span><span id="local-6989586621683156220"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683156220"><span class="hs-identifier hs-var">cur_unit</span></a></span></span><span> </span><span id="local-6989586621683156221"><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621683156221"><span class="hs-identifier hs-var">home_unit_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621683156222"><span class="annot"><a href="#local-6989586621683156222"><span class="hs-identifier hs-var">nc_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [Name] -&gt; IO NameCache
</span><a href="GHC.Types.Name.Cache.html#initNameCache"><span class="hs-identifier hs-var">initNameCache</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'r'</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="GHC.Builtin.Utils.html#knownKeyNames"><span class="hs-identifier hs-var">knownKeyNames</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621683156224"><span class="annot"><a href="#local-6989586621683156224"><span class="hs-identifier hs-var">fc_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html#initFinderCache"><span class="hs-identifier hs-type">initFinderCache</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621683156226"><span class="annot"><a href="#local-6989586621683156226"><span class="hs-identifier hs-var">logger</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#initLogger"><span class="hs-identifier hs-type">initLogger</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621683156228"><span class="annot"><a href="#local-6989586621683156228"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#initTmpFs"><span class="hs-identifier hs-type">initTmpFs</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156230"><span class="annot"><a href="#local-6989586621683156230"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeUnitEnv -&gt; DynFlags) -&gt; HomeUnitEnv -&gt; DynFlags
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; HomeUnitGraph -&gt; HomeUnitEnv
forall v. UnitId -&gt; UnitEnvGraph v -&gt; v
</span><a href="GHC.Unit.Env.html#unitEnv_lookup"><span class="hs-identifier hs-var">unitEnv_lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683156220"><span class="hs-identifier hs-var">cur_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621683156221"><span class="hs-identifier hs-var">home_unit_graph</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621683156233"><span class="annot"><a href="#local-6989586621683156233"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#initUnitEnv"><span class="hs-identifier hs-type">initUnitEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156220"><span class="hs-identifier hs-type">cur_unit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156221"><span class="hs-identifier hs-type">home_unit_graph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#ghcNameVersion"><span class="hs-identifier hs-var">ghcNameVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156230"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156230"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621683156237"><span class="annot"><a href="#local-6989586621683156237"><span class="hs-identifier hs-var">llvm_config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.LlvmConfigCache.html#initLlvmConfigCache"><span class="hs-identifier hs-type">initLlvmConfigCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156218"><span class="hs-identifier hs-type">top_dir</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156219"><span class="hs-identifier hs-type">top_dynflags</span></a></span><span>
</span><span id="line-328"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#setLogFlags"><span class="hs-identifier hs-type">setLogFlags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156226"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Logger.html#initLogFlags"><span class="hs-identifier hs-type">initLogFlags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156219"><span class="hs-identifier hs-type">top_dynflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_targets"><span class="hs-identifier hs-var">hsc_targets</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-330"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#emptyMG"><span class="hs-identifier hs-type">emptyMG</span></a></span><span>
</span><span id="line-331"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#emptyInteractiveContext"><span class="hs-identifier hs-type">emptyInteractiveContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156230"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-332"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_NC"><span class="hs-identifier hs-var">hsc_NC</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156222"><span class="hs-identifier hs-type">nc_var</span></a></span><span>
</span><span id="line-333"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156224"><span class="hs-identifier hs-type">fc_var</span></a></span><span>
</span><span id="line-334"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html#emptyKnotVars"><span class="hs-identifier hs-type">emptyKnotVars</span></a></span><span>
</span><span id="line-335"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-336"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156233"><span class="hs-identifier hs-type">unit_env</span></a></span><span>
</span><span id="line-337"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#emptyPlugins"><span class="hs-identifier hs-type">emptyPlugins</span></a></span><span>
</span><span id="line-338"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html#emptyHooks"><span class="hs-identifier hs-type">emptyHooks</span></a></span><span>
</span><span id="line-339"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156228"><span class="hs-identifier hs-type">tmpfs</span></a></span><span>
</span><span id="line-340"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_llvm_config"><span class="hs-identifier hs-var">hsc_llvm_config</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156237"><span class="hs-identifier hs-type">llvm_config</span></a></span><span>
</span><span id="line-341"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><span class="hs-comment">-- | Initialize HscEnv from an optional top_dir path</span></span><span>
</span><span id="line-344"></span><span class="annot"><a href="GHC.Driver.Main.html#initHscEnv"><span class="hs-identifier hs-type">initHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-345"></span><span id="initHscEnv"><span class="annot"><span class="annottext">initHscEnv :: Maybe [Char] -&gt; IO HscEnv
</span><a href="GHC.Driver.Main.html#initHscEnv"><span class="hs-identifier hs-var hs-var">initHscEnv</span></a></span></span><span> </span><span id="local-6989586621683156258"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621683156258"><span class="hs-identifier hs-var">mb_top_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>  </span><span id="local-6989586621683156259"><span class="annot"><a href="#local-6989586621683156259"><span class="hs-identifier hs-var">top_dir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; IO [Char]
</span><a href="GHC.SysTools.BaseDir.html#findTopDir"><span class="hs-identifier hs-var">findTopDir</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621683156258"><span class="hs-identifier hs-var">mb_top_dir</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span id="local-6989586621683156260"><span class="annot"><a href="#local-6989586621683156260"><span class="hs-identifier hs-var">mySettings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.SysTools.html#initSysTools"><span class="hs-identifier hs-type">initSysTools</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156259"><span class="hs-identifier hs-type">top_dir</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span id="local-6989586621683156261"><span class="annot"><a href="#local-6989586621683156261"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#initDynFlags"><span class="hs-identifier hs-type">initDynFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#defaultDynFlags"><span class="hs-identifier hs-type">defaultDynFlags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156260"><span class="hs-identifier hs-type">mySettings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span id="local-6989586621683156264"><span class="annot"><a href="#local-6989586621683156264"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier hs-type">newHscEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156259"><span class="hs-identifier hs-type">top_dir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156261"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><a href="GHC.Driver.Session.html#setUnsafeGlobalDynFlags"><span class="hs-identifier hs-type">setUnsafeGlobalDynFlags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156261"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-351"></span><span>   </span><span class="hs-comment">-- c.f. DynFlags.parseDynamicFlagsFull, which</span><span>
</span><span id="line-352"></span><span>   </span><span class="hs-comment">-- creates DynFlags and sets the UnsafeGlobalDynFlags</span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156264"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span id="getDiagnostics"><span class="annot"><span class="annottext">getDiagnostics :: Hsc (Messages GhcMessage)
</span><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-var hs-var">getDiagnostics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv
 -&gt; Messages GhcMessage
 -&gt; IO (Messages GhcMessage, Messages GhcMessage))
-&gt; Hsc (Messages GhcMessage)
forall a.
(HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage))
-&gt; Hsc a
</span><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv
  -&gt; Messages GhcMessage
  -&gt; IO (Messages GhcMessage, Messages GhcMessage))
 -&gt; Hsc (Messages GhcMessage))
-&gt; (HscEnv
    -&gt; Messages GhcMessage
    -&gt; IO (Messages GhcMessage, Messages GhcMessage))
-&gt; Hsc (Messages GhcMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683156268"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156268"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Messages GhcMessage, Messages GhcMessage)
-&gt; IO (Messages GhcMessage, Messages GhcMessage)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156268"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156268"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-type">clearDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span id="clearDiagnostics"><span class="annot"><span class="annottext">clearDiagnostics :: Hsc ()
</span><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-var hs-var">clearDiagnostics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; Messages GhcMessage -&gt; IO ((), Messages GhcMessage))
-&gt; Hsc ()
forall a.
(HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage))
-&gt; Hsc a
</span><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; Messages GhcMessage -&gt; IO ((), Messages GhcMessage))
 -&gt; Hsc ())
-&gt; (HscEnv -&gt; Messages GhcMessage -&gt; IO ((), Messages GhcMessage))
-&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((), Messages GhcMessage) -&gt; IO ((), Messages GhcMessage)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span id="logDiagnostics"><span class="annot"><span class="annottext">logDiagnostics :: Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var hs-var">logDiagnostics</span></a></span></span><span> </span><span id="local-6989586621683156272"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156272"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; Messages GhcMessage -&gt; IO ((), Messages GhcMessage))
-&gt; Hsc ()
forall a.
(HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage))
-&gt; Hsc a
</span><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; Messages GhcMessage -&gt; IO ((), Messages GhcMessage))
 -&gt; Hsc ())
-&gt; (HscEnv -&gt; Messages GhcMessage -&gt; IO ((), Messages GhcMessage))
-&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683156273"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156273"><span class="hs-identifier hs-var">w0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((), Messages GhcMessage) -&gt; IO ((), Messages GhcMessage)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156273"><span class="hs-identifier hs-var">w0</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Messages GhcMessage -&gt; Messages GhcMessage
forall e. Messages e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-var">`unionMessages`</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156272"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="annot"><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-367"></span><span id="getHscEnv"><span class="annot"><span class="annottext">getHscEnv :: Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var hs-var">getHscEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; Messages GhcMessage -&gt; IO (HscEnv, Messages GhcMessage))
-&gt; Hsc HscEnv
forall a.
(HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage))
-&gt; Hsc a
</span><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv
  -&gt; Messages GhcMessage -&gt; IO (HscEnv, Messages GhcMessage))
 -&gt; Hsc HscEnv)
-&gt; (HscEnv
    -&gt; Messages GhcMessage -&gt; IO (HscEnv, Messages GhcMessage))
-&gt; Hsc HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683156275"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156275"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683156276"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156276"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HscEnv, Messages GhcMessage) -&gt; IO (HscEnv, Messages GhcMessage)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156275"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156276"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><a href="GHC.Driver.Main.html#handleWarnings"><span class="hs-identifier hs-type">handleWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span id="handleWarnings"><span class="annot"><span class="annottext">handleWarnings :: Hsc ()
</span><a href="GHC.Driver.Main.html#handleWarnings"><span class="hs-identifier hs-var hs-var">handleWarnings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621683156278"><span class="annot"><a href="#local-6989586621683156278"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DiagOpts) -&gt; Hsc DynFlags -&gt; Hsc DiagOpts
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621683156282"><span class="annot"><a href="#local-6989586621683156282"><span class="hs-identifier hs-var">print_config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initPrintConfig"><span class="hs-identifier hs-type">initPrintConfig</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621683156284"><span class="annot"><a href="#local-6989586621683156284"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span id="local-6989586621683156286"><span class="annot"><a href="#local-6989586621683156286"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html#printOrThrowDiagnostics"><span class="hs-identifier hs-type">printOrThrowDiagnostics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156284"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156282"><span class="hs-identifier hs-type">print_config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156278"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156286"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-type">clearDiagnostics</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | log warning in the monad, and if there are errors then</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- throw a SourceError exception.</span><span>
</span><span id="line-380"></span><span class="annot"><a href="GHC.Driver.Main.html#logWarningsReportErrors"><span class="hs-identifier hs-type">logWarningsReportErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Errors.Types.html#PsWarning"><span class="hs-identifier hs-type">PsWarning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Errors.Types.html#PsError"><span class="hs-identifier hs-type">PsError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span id="logWarningsReportErrors"><span class="annot"><span class="annottext">logWarningsReportErrors :: (Messages PsWarning, Messages PsWarning) -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarningsReportErrors"><span class="hs-identifier hs-var hs-var">logWarningsReportErrors</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683156291"><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683156291"><span class="hs-identifier hs-var">warnings</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683156292"><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683156292"><span class="hs-identifier hs-var">errors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsWarning -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-var">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(PsWarning -&gt; GhcMessage)
-&gt; Messages PsWarning -&gt; Messages GhcMessage
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683156291"><span class="hs-identifier hs-var">warnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Messages PsWarning -&gt; Bool
forall e. Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-var">isEmptyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683156292"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
forall (io :: * -&gt; *) a. MonadIO io =&gt; Messages GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsWarning -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-var">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(PsWarning -&gt; GhcMessage)
-&gt; Messages PsWarning -&gt; Messages GhcMessage
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683156292"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | Log warnings and throw errors, assuming the messages</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- contain at least one error (e.g. coming from PFailed)</span><span>
</span><span id="line-387"></span><span id="local-6989586621683154644"><span class="annot"><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-type">handleWarningsThrowErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Errors.Types.html#PsWarning"><span class="hs-identifier hs-type">PsWarning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Errors.Types.html#PsError"><span class="hs-identifier hs-type">PsError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683154644"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-388"></span><span id="handleWarningsThrowErrors"><span class="annot"><span class="annottext">handleWarningsThrowErrors :: forall a. (Messages PsWarning, Messages PsWarning) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-var hs-var">handleWarningsThrowErrors</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683156313"><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683156313"><span class="hs-identifier hs-var">warnings</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156314"><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683156314"><span class="hs-identifier hs-var">errors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621683156315"><span class="annot"><a href="#local-6989586621683156315"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DiagOpts) -&gt; Hsc DynFlags -&gt; Hsc DiagOpts
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-type">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683156313"><span class="hs-identifier hs-type">warnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621683156316"><span class="annot"><a href="#local-6989586621683156316"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683156317"><span class="annot"><a href="#local-6989586621683156317"><span class="hs-identifier hs-var">wWarns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156318"><span class="annot"><a href="#local-6989586621683156318"><span class="hs-identifier hs-var">wErrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#partitionMessages"><span class="hs-identifier hs-type">partitionMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156313"><span class="hs-identifier hs-type">warnings</span></a></span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html#printMessages"><span class="hs-identifier hs-type">printMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156316"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#NoDiagnosticOpts"><span class="hs-identifier hs-type">NoDiagnosticOpts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156315"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156317"><span class="hs-identifier hs-type">wWarns</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-type">throwErrors</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-type">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683156314"><span class="hs-identifier hs-type">errors</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-type">`unionMessages`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156318"><span class="hs-identifier hs-type">wErrs</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">-- | Deal with errors and warnings returned by a compilation step</span><span>
</span><span id="line-397"></span><span class="hs-comment">--</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- In order to reduce dependencies to other parts of the compiler, functions</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- outside the &quot;main&quot; parts of GHC return warnings and errors as a parameter</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- and signal success via by wrapping the result in a 'Maybe' type. This</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- function logs the returned warnings and propagates errors as exceptions</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- (of type 'SourceError').</span><span>
</span><span id="line-403"></span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- This function assumes the following invariants:</span><span>
</span><span id="line-405"></span><span class="hs-comment">--</span><span>
</span><span id="line-406"></span><span class="hs-comment">--  1. If the second result indicates success (is of the form 'Just x'),</span><span>
</span><span id="line-407"></span><span class="hs-comment">--     there must be no error messages in the first result.</span><span>
</span><span id="line-408"></span><span class="hs-comment">--</span><span>
</span><span id="line-409"></span><span class="hs-comment">--  2. If there are no error messages, but the second result indicates failure</span><span>
</span><span id="line-410"></span><span class="hs-comment">--     there should be warnings in the first result. That is, if the action</span><span>
</span><span id="line-411"></span><span class="hs-comment">--     failed, it must have been due to the warnings (i.e., @-Werror@).</span><span>
</span><span id="line-412"></span><span id="local-6989586621683154651"><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683154651"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683154651"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-413"></span><span id="ioMsgMaybe"><span class="annot"><span class="annottext">ioMsgMaybe :: forall a. IO (Messages GhcMessage, Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var hs-var">ioMsgMaybe</span></a></span></span><span> </span><span id="local-6989586621683156332"><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe a)
</span><a href="#local-6989586621683156332"><span class="hs-identifier hs-var">ioA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683156333"><span class="annot"><a href="#local-6989586621683156333"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156334"><span class="annot"><a href="#local-6989586621683156334"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe a)
-&gt; Hsc (Messages GhcMessage, Maybe a)
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe a)
</span><a href="#local-6989586621683156332"><span class="hs-identifier hs-var">ioA</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683156335"><span class="annot"><a href="#local-6989586621683156335"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156336"><span class="annot"><a href="#local-6989586621683156336"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#partitionMessages"><span class="hs-identifier hs-type">partitionMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156333"><span class="hs-identifier hs-type">msgs</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156335"><span class="hs-identifier hs-type">warns</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683156334"><span class="hs-identifier hs-type">mb_r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc a
forall (io :: * -&gt; *) a. MonadIO io =&gt; Messages GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156336"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156337"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683156337"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (a -&gt; Hsc a) -&gt; a -&gt; Hsc a
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Bool
forall e. Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-var">isEmptyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156336"><span class="hs-identifier hs-var">errs</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; Hsc a
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683156337"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">-- | like ioMsgMaybe, except that we ignore error messages and return</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- 'Nothing' instead.</span><span>
</span><span id="line-423"></span><span id="local-6989586621683154654"><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-type">ioMsgMaybe'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683154654"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683154654"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-424"></span><span id="ioMsgMaybe%27"><span class="annot"><span class="annottext">ioMsgMaybe' :: forall a. IO (Messages GhcMessage, Maybe a) -&gt; Hsc (Maybe a)
</span><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-var hs-var">ioMsgMaybe'</span></a></span></span><span> </span><span id="local-6989586621683156345"><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe a)
</span><a href="#local-6989586621683156345"><span class="hs-identifier hs-var">ioA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683156346"><span class="annot"><a href="#local-6989586621683156346"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156347"><span class="annot"><a href="#local-6989586621683156347"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe a)
-&gt; Hsc (Messages GhcMessage, Maybe a)
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Messages GhcMessage, Maybe a)
 -&gt; Hsc (Messages GhcMessage, Maybe a))
-&gt; IO (Messages GhcMessage, Maybe a)
-&gt; Hsc (Messages GhcMessage, Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe a)
</span><a href="#local-6989586621683156345"><span class="hs-identifier hs-var">ioA</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#mkMessages"><span class="hs-identifier hs-type">mkMessages</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#getWarningMessages"><span class="hs-identifier hs-type">getWarningMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156346"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156347"><span class="hs-identifier hs-type">mb_r</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-430"></span><span class="annot"><span class="hs-comment">-- | Lookup things in the compiler's environment</span></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnLookupRdrName"><span class="hs-identifier hs-type">hscTcRnLookupRdrName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span id="hscTcRnLookupRdrName"><span class="annot"><span class="annottext">hscTcRnLookupRdrName :: HscEnv -&gt; LocatedN RdrName -&gt; IO (NonEmpty Name)
</span><a href="GHC.Driver.Main.html#hscTcRnLookupRdrName"><span class="hs-identifier hs-var hs-var">hscTcRnLookupRdrName</span></a></span></span><span> </span><span id="local-6989586621683156350"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156350"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683156351"><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621683156351"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (NonEmpty Name) -&gt; IO (NonEmpty Name)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156350"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (NonEmpty Name) -&gt; IO (NonEmpty Name))
-&gt; Hsc (NonEmpty Name) -&gt; IO (NonEmpty Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683156353"><span class="annot"><a href="#local-6989586621683156353"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-comment">-- tcRnLookupRdrName can return empty list only together with TcRnUnknownMessage.</span><span>
</span><span id="line-437"></span><span>       </span><span class="hs-comment">-- Once errors has been dealt with in hoistTcRnMessage, we can enforce</span><span>
</span><span id="line-438"></span><span>       </span><span class="hs-comment">-- this invariant in types by converting to NonEmpty.</span><span>
</span><span id="line-439"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="hs-identifier">NE.nonEmpty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-440"></span><span>          </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnLookupRdrName"><span class="hs-identifier hs-type">tcRnLookupRdrName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156353"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156351"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRcLookupName"><span class="hs-identifier hs-type">hscTcRcLookupName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span id="hscTcRcLookupName"><span class="annot"><span class="annottext">hscTcRcLookupName :: HscEnv -&gt; Name -&gt; IO (Maybe TyThing)
</span><a href="GHC.Driver.Main.html#hscTcRcLookupName"><span class="hs-identifier hs-var hs-var">hscTcRcLookupName</span></a></span></span><span> </span><span id="local-6989586621683156357"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156357"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683156358"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683156358"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Maybe TyThing) -&gt; IO (Maybe TyThing)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156357"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe TyThing) -&gt; IO (Maybe TyThing))
-&gt; Hsc (Maybe TyThing) -&gt; IO (Maybe TyThing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>  </span><span id="local-6989586621683156359"><span class="annot"><a href="#local-6989586621683156359"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-type">ioMsgMaybe'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnLookupName"><span class="hs-identifier hs-type">tcRnLookupName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156359"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156358"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-446"></span><span>      </span><span class="hs-comment">-- ignore errors: the only error we're likely to get is</span><span>
</span><span id="line-447"></span><span>      </span><span class="hs-comment">-- &quot;name not found&quot;, and the Maybe in the return type</span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-comment">-- is used to indicate that.</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnGetInfo"><span class="hs-identifier hs-type">hscTcRnGetInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-451"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span id="hscTcRnGetInfo"><span class="annot"><span class="annottext">hscTcRnGetInfo :: HscEnv
-&gt; Name -&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
</span><a href="GHC.Driver.Main.html#hscTcRnGetInfo"><span class="hs-identifier hs-var hs-var">hscTcRnGetInfo</span></a></span></span><span> </span><span id="local-6989586621683156361"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156361"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683156362"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683156362"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
-&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156361"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
 -&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc)))
-&gt; Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
-&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683156363"><span class="annot"><a href="#local-6989586621683156363"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-455"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-type">ioMsgMaybe'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnGetInfo"><span class="hs-identifier hs-type">tcRnGetInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156363"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156362"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="annot"><a href="GHC.Driver.Main.html#hscIsGHCiMonad"><span class="hs-identifier hs-type">hscIsGHCiMonad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-458"></span><span id="hscIsGHCiMonad"><span class="annot"><span class="annottext">hscIsGHCiMonad :: HscEnv -&gt; [Char] -&gt; IO Name
</span><a href="GHC.Driver.Main.html#hscIsGHCiMonad"><span class="hs-identifier hs-var hs-var">hscIsGHCiMonad</span></a></span></span><span> </span><span id="local-6989586621683156365"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156365"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156366"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156366"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc Name -&gt; IO Name
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156365"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc Name -&gt; IO Name) -&gt; Hsc Name -&gt; IO Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe Name) -&gt; Hsc Name
forall a. IO (Messages GhcMessage, Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages GhcMessage, Maybe Name) -&gt; Hsc Name)
-&gt; IO (Messages GhcMessage, Maybe Name) -&gt; Hsc Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Messages TcRnMessage, Maybe Name)
-&gt; IO (Messages GhcMessage, Maybe Name)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Messages TcRnMessage, a) -&gt; m (Messages GhcMessage, a)
</span><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-var">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages TcRnMessage, Maybe Name)
 -&gt; IO (Messages GhcMessage, Maybe Name))
-&gt; IO (Messages TcRnMessage, Maybe Name)
-&gt; IO (Messages GhcMessage, Maybe Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Char] -&gt; IO (Messages TcRnMessage, Maybe Name)
</span><a href="GHC.Tc.Module.html#isGHCiMonad"><span class="hs-identifier hs-var">isGHCiMonad</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156365"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156366"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGetModuleInterface"><span class="hs-identifier hs-type">hscGetModuleInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-462"></span><span id="hscGetModuleInterface"><span class="annot"><span class="annottext">hscGetModuleInterface :: HscEnv -&gt; Module -&gt; IO ModIface
</span><a href="GHC.Driver.Main.html#hscGetModuleInterface"><span class="hs-identifier hs-var hs-var">hscGetModuleInterface</span></a></span></span><span> </span><span id="local-6989586621683156369"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156369"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683156370"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156370"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc ModIface -&gt; IO ModIface
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156369"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ModIface -&gt; IO ModIface) -&gt; Hsc ModIface -&gt; IO ModIface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-463"></span><span>  </span><span id="local-6989586621683156371"><span class="annot"><a href="#local-6989586621683156371"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#getModuleInterface"><span class="hs-identifier hs-type">getModuleInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156371"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156370"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-467"></span><span class="annot"><span class="hs-comment">-- | Rename some import declarations</span></span><span>
</span><span id="line-468"></span><span class="annot"><a href="GHC.Driver.Main.html#hscRnImportDecls"><span class="hs-identifier hs-type">hscRnImportDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-469"></span><span id="hscRnImportDecls"><span class="annot"><span class="annottext">hscRnImportDecls :: HscEnv -&gt; [LImportDecl GhcPs] -&gt; IO GlobalRdrEnv
</span><a href="GHC.Driver.Main.html#hscRnImportDecls"><span class="hs-identifier hs-var hs-var">hscRnImportDecls</span></a></span></span><span> </span><span id="local-6989586621683156373"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156373"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683156374"><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621683156374"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc GlobalRdrEnv -&gt; IO GlobalRdrEnv
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156373"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc GlobalRdrEnv -&gt; IO GlobalRdrEnv)
-&gt; Hsc GlobalRdrEnv -&gt; IO GlobalRdrEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621683156375"><span class="annot"><a href="#local-6989586621683156375"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnImportDecls"><span class="hs-identifier hs-type">tcRnImportDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156375"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156374"><span class="hs-identifier hs-type">import_decls</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-474"></span><span class="annot"><span class="hs-comment">-- | parse a file, returning the abstract syntax</span></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParse"><span class="hs-identifier hs-type">hscParse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-477"></span><span id="hscParse"><span class="annot"><span class="annottext">hscParse :: HscEnv -&gt; ModSummary -&gt; IO HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse"><span class="hs-identifier hs-var hs-var">hscParse</span></a></span></span><span> </span><span id="local-6989586621683156377"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156377"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156378"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156378"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc HsParsedModule -&gt; IO HsParsedModule
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156377"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc HsParsedModule -&gt; IO HsParsedModule)
-&gt; Hsc HsParsedModule -&gt; IO HsParsedModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Hsc HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-var">hscParse'</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156378"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="hs-comment">-- internal version, that doesn't fail due to -Werror</span><span>
</span><span id="line-480"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-type">hscParse'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-481"></span><span id="hscParse%27"><span class="annot"><span class="annottext">hscParse' :: ModSummary -&gt; Hsc HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-var hs-var">hscParse'</span></a></span></span><span> </span><span id="local-6989586621683156379"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156379"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span>
</span><span id="line-482"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156380"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156380"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe HsParsedModule
</span><a href="GHC.Unit.Module.ModSummary.html#ms_parsed_mod"><span class="hs-identifier hs-var">ms_parsed_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156379"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsParsedModule -&gt; Hsc HsParsedModule
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156380"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-483"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-484"></span><span>    </span><span id="local-6989586621683156382"><span class="annot"><a href="#local-6989586621683156382"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-485"></span><span>    </span><span id="local-6989586621683156383"><span class="annot"><a href="#local-6989586621683156383"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Parser&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-type">withTiming</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156383"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-487"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Parser&quot;</span></span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156379"><span class="hs-identifier hs-type">mod_summary</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156391"><span class="annot"><a href="#local-6989586621683156391"><span class="hs-identifier hs-var hs-var">src_filename</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [Char]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_file"><span class="hs-identifier hs-var">ms_hspp_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156379"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-490"></span><span>        </span><span id="local-6989586621683156393"><span class="annot"><a href="#local-6989586621683156393"><span class="hs-identifier hs-var hs-var">maybe_src_buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe StringBuffer
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_buf"><span class="hs-identifier hs-var">ms_hspp_buf</span></a></span><span>  </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156379"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-comment">--------------------------  Parser  ----------------</span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-comment">-- sometimes we already have the buffer in memory, perhaps</span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-comment">-- because we needed to parse the imports out of it, or get the</span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-comment">-- module name.</span><span>
</span><span id="line-496"></span><span>    </span><span id="local-6989586621683156395"><span class="annot"><a href="#local-6989586621683156395"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683156393"><span class="hs-identifier hs-type">maybe_src_buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-497"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156396"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156396"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; Hsc StringBuffer
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156396"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-498"></span><span>               </span><span class="annot"><span class="annottext">Maybe StringBuffer
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO StringBuffer -&gt; Hsc StringBuffer
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO StringBuffer -&gt; Hsc StringBuffer)
-&gt; IO StringBuffer -&gt; Hsc StringBuffer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO StringBuffer
</span><a href="GHC.Data.StringBuffer.html#hGetStringBuffer"><span class="hs-identifier hs-var">hGetStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156391"><span class="hs-identifier hs-var">src_filename</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156398"><span class="annot"><a href="#local-6989586621683156398"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156391"><span class="hs-identifier hs-var">src_filename</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156401"><span class="annot"><a href="#local-6989586621683156401"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156382"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#wopt"><span class="hs-identifier hs-type">wopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_WarnUnicodeBidirectionalFormatCharacters"><span class="hs-identifier hs-type">Opt_WarnUnicodeBidirectionalFormatCharacters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156382"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#checkBidirectionFormatChars"><span class="hs-identifier hs-type">checkBidirectionFormatChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156398"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#BufPos"><span class="hs-identifier hs-type">BufPos</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156395"><span class="hs-identifier hs-type">buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-505"></span><span>        </span><span class="annot"><span class="annottext">Maybe (NonEmpty (PsLoc, Char, [Char]))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Hsc ()
forall a. a -&gt; Hsc a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156407"><span class="annot"><span class="annottext">chars :: NonEmpty (PsLoc, Char, [Char])
</span><a href="#local-6989586621683156407"><span class="hs-identifier hs-var">chars</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683156408"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156408"><span class="hs-identifier hs-var">eloc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683156409"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156409"><span class="hs-identifier hs-var">chr</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[(PsLoc, Char, [Char])]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-507"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156410"><span class="annot"><span class="annottext">span :: SrcSpan
</span><a href="#local-6989586621683156410"><span class="hs-identifier hs-var hs-var">span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PsSpan -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#mkSrcSpanPs"><span class="hs-identifier hs-var">mkSrcSpanPs</span></a></span><span> </span><span class="annot"><span class="annottext">(PsSpan -&gt; SrcSpan) -&gt; PsSpan -&gt; SrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; PsLoc -&gt; PsSpan
</span><a href="GHC.Types.SrcLoc.html#mkPsSpan"><span class="hs-identifier hs-var">mkPsSpan</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156408"><span class="hs-identifier hs-var">eloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156408"><span class="hs-identifier hs-var">eloc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156409"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages GhcMessage -&gt; Hsc ()) -&gt; Messages GhcMessage -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Messages GhcMessage)
-&gt; MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-509"></span><span>               </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156401"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683156410"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-510"></span><span>               </span><span class="annot"><span class="annottext">PsWarning -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-var">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(PsWarning -&gt; GhcMessage) -&gt; PsWarning -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PsLoc, Char, [Char]) -&gt; PsWarning
</span><a href="GHC.Parser.Errors.Types.html#PsWarnBidirectionalFormatChars"><span class="hs-identifier hs-var">PsWarnBidirectionalFormatChars</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PsLoc, Char, [Char])
</span><a href="#local-6989586621683156407"><span class="hs-identifier hs-var">chars</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156417"><span class="annot"><a href="#local-6989586621683156417"><span class="hs-identifier hs-var hs-var">parseMod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156379"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-513"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (Located (HsModule GhcPs))
</span><a href="GHC.Parser.html#parseSignature"><span class="hs-identifier hs-var">parseSignature</span></a></span><span>
</span><span id="line-514"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (Located (HsModule GhcPs))
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156417"><span class="hs-identifier hs-type">parseMod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Lexer.html#initParserState"><span class="hs-identifier hs-type">initParserState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Parser.html#initParserOpts"><span class="hs-identifier hs-type">initParserOpts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156382"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156395"><span class="hs-identifier hs-type">buf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156398"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><a href="GHC.Parser.Lexer.html#PFailed"><span class="hs-identifier hs-type">PFailed</span></a></span><span> </span><span id="local-6989586621683156425"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683156425"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-518"></span><span>            </span><span class="annot"><span class="annottext">(Messages PsWarning, Messages PsWarning) -&gt; Hsc HsParsedModule
forall a. (Messages PsWarning, Messages PsWarning) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-var">handleWarningsThrowErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState -&gt; (Messages PsWarning, Messages PsWarning)
</span><a href="GHC.Parser.Lexer.html#getPsMessages"><span class="hs-identifier hs-var">getPsMessages</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683156425"><span class="hs-identifier hs-var">pst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>        </span><span class="annot"><a href="GHC.Parser.Lexer.html#POk"><span class="hs-identifier hs-type">POk</span></a></span><span> </span><span id="local-6989586621683156428"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683156428"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span id="local-6989586621683156429"><span class="annot"><span class="annottext">Located (HsModule GhcPs)
</span><a href="#local-6989586621683156429"><span class="hs-identifier hs-var">rdr_module</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-520"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156383"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed"><span class="hs-identifier hs-var">Opt_D_dump_parsed</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Parser&quot;</span></span><span>
</span><span id="line-521"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (HsModule GhcPs) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Located (HsModule GhcPs)
</span><a href="#local-6989586621683156429"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156383"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed_ast"><span class="hs-identifier hs-var">Opt_D_dump_parsed_ast</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Parser AST&quot;</span></span><span>
</span><span id="line-523"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlankSrcSpan
-&gt; BlankEpAnnotations -&gt; Located (HsModule GhcPs) -&gt; SDoc
forall a. Data a =&gt; BlankSrcSpan -&gt; BlankEpAnnotations -&gt; a -&gt; SDoc
</span><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-var">showAstData</span></a></span><span> </span><span class="annot"><span class="annottext">BlankSrcSpan
</span><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-var">NoBlankSrcSpan</span></a></span><span>
</span><span id="line-524"></span><span>                                                   </span><span class="annot"><span class="annottext">BlankEpAnnotations
</span><a href="GHC.Hs.Dump.html#NoBlankEpAnnotations"><span class="hs-identifier hs-var">NoBlankEpAnnotations</span></a></span><span>
</span><span id="line-525"></span><span>                                                   </span><span class="annot"><span class="annottext">Located (HsModule GhcPs)
</span><a href="#local-6989586621683156429"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156383"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_source_stats"><span class="hs-identifier hs-var">Opt_D_source_stats</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Source Statistics&quot;</span></span><span>
</span><span id="line-527"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Located (HsModule GhcPs) -&gt; SDoc
</span><a href="GHC.Hs.Stats.html#ppSourceStats"><span class="hs-identifier hs-var">ppSourceStats</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Located (HsModule GhcPs)
</span><a href="#local-6989586621683156429"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>            </span><span class="hs-comment">-- To get the list of extra source files, we take the list</span><span>
</span><span id="line-530"></span><span>            </span><span class="hs-comment">-- that the parser gave us,</span><span>
</span><span id="line-531"></span><span>            </span><span class="hs-comment">--   - eliminate files beginning with '&lt;'.  gcc likes to use</span><span>
</span><span id="line-532"></span><span>            </span><span class="hs-comment">--     pseudo-filenames like &quot;&lt;built-in&gt;&quot; and &quot;&lt;command-line&gt;&quot;</span><span>
</span><span id="line-533"></span><span>            </span><span class="hs-comment">--   - normalise them (eliminate differences between ./f and f)</span><span>
</span><span id="line-534"></span><span>            </span><span class="hs-comment">--   - filter out the preprocessed source file</span><span>
</span><span id="line-535"></span><span>            </span><span class="hs-comment">--   - filter out anything beginning with tmpdir</span><span>
</span><span id="line-536"></span><span>            </span><span class="hs-comment">--   - remove duplicates</span><span>
</span><span id="line-537"></span><span>            </span><span class="hs-comment">--   - filter out the .hs/.lhs source filename if we have one</span><span>
</span><span id="line-538"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-539"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156439"><span class="annot"><span class="annottext">n_hspp :: [Char]
</span><a href="#local-6989586621683156439"><span class="hs-identifier hs-var hs-var hs-var">n_hspp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#normalise"><span class="hs-identifier hs-var">FilePath.normalise</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156391"><span class="hs-identifier hs-var">src_filename</span></a></span><span>
</span><span id="line-540"></span><span>                </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempDir"><span class="hs-identifier hs-type">TempDir</span></a></span><span> </span><span id="local-6989586621683156442"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156442"><span class="hs-identifier hs-var hs-var">tmp_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156382"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-541"></span><span>                </span><span id="local-6989586621683156444"><span class="annot"><span class="annottext">srcs0 :: [[Char]]
</span><a href="#local-6989586621683156444"><span class="hs-identifier hs-var hs-var hs-var">srcs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [[Char]]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; [[Char]]) -&gt; [[Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool) -&gt; [[Char]] -&gt; [[Char]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ([Char] -&gt; Bool) -&gt; [Char] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156442"><span class="hs-identifier hs-var">tmp_dir</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isPrefixOf`</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>                            </span><span class="annot"><span class="annottext">([[Char]] -&gt; [[Char]]) -&gt; [[Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool) -&gt; [[Char]] -&gt; [[Char]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ([Char] -&gt; Bool) -&gt; [Char] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156439"><span class="hs-identifier hs-var">n_hspp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>                            </span><span class="annot"><span class="annottext">([[Char]] -&gt; [[Char]]) -&gt; [[Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Char]) -&gt; [[Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#normalise"><span class="hs-identifier hs-var">FilePath.normalise</span></a></span><span>
</span><span id="line-544"></span><span>                            </span><span class="annot"><span class="annottext">([[Char]] -&gt; [[Char]]) -&gt; [[Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool) -&gt; [[Char]] -&gt; [[Char]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ([Char] -&gt; Bool) -&gt; [Char] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-identifier hs-var">isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>                            </span><span class="annot"><span class="annottext">([[Char]] -&gt; [[Char]]) -&gt; [[Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; [Char]) -&gt; [FastString] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [Char]
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span>
</span><span id="line-546"></span><span>                            </span><span class="annot"><span class="annottext">([FastString] -&gt; [[Char]]) -&gt; [FastString] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PState -&gt; [FastString]
</span><a href="GHC.Parser.Lexer.html#srcfiles"><span class="hs-identifier hs-var">srcfiles</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683156428"><span class="hs-identifier hs-var">pst</span></a></span><span>
</span><span id="line-547"></span><span>                </span><span id="local-6989586621683156448"><span class="annot"><span class="annottext">srcs1 :: [[Char]]
</span><a href="#local-6989586621683156448"><span class="hs-identifier hs-var hs-var hs-var">srcs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156379"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-548"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156451"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156451"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool) -&gt; [[Char]] -&gt; [[Char]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#normalise"><span class="hs-identifier hs-var">FilePath.normalise</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156451"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683156444"><span class="hs-identifier hs-var">srcs0</span></a></span><span>
</span><span id="line-549"></span><span>                          </span><span class="annot"><span class="annottext">Maybe [Char]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683156444"><span class="hs-identifier hs-var">srcs0</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>            </span><span class="hs-comment">-- sometimes we see source files from earlier</span><span>
</span><span id="line-552"></span><span>            </span><span class="hs-comment">-- preprocessing stages that cannot be found, so just</span><span>
</span><span id="line-553"></span><span>            </span><span class="hs-comment">-- filter them out:</span><span>
</span><span id="line-554"></span><span>            </span><span id="local-6989586621683156453"><span class="annot"><a href="#local-6989586621683156453"><span class="hs-identifier hs-var">srcs2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [[Char]] -&gt; Hsc [[Char]]
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [[Char]] -&gt; Hsc [[Char]]) -&gt; IO [[Char]] -&gt; Hsc [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO Bool) -&gt; [[Char]] -&gt; IO [[Char]]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683156448"><span class="hs-identifier hs-var">srcs1</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156456"><span class="annot"><a href="#local-6989586621683156456"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-557"></span><span>                      </span><span class="annot"><span class="annottext">hpm_module :: Located (HsModule GhcPs)
</span><a href="GHC.Hs.html#hpm_module"><span class="hs-identifier hs-var">hpm_module</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Located (HsModule GhcPs)
</span><a href="#local-6989586621683156429"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-558"></span><span>                      </span><span class="annot"><span class="annottext">hpm_src_files :: [[Char]]
</span><a href="GHC.Hs.html#hpm_src_files"><span class="hs-identifier hs-var">hpm_src_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683156453"><span class="hs-identifier hs-var">srcs2</span></a></span><span>
</span><span id="line-559"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span>            </span><span class="hs-comment">-- apply parse transformation of plugins</span><span>
</span><span id="line-562"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156460"><span class="annot"><a href="#local-6989586621683156460"><span class="hs-identifier hs-var hs-var">applyPluginAction</span></a></span></span><span> </span><span id="local-6989586621683156461"><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683156461"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683156462"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683156462"><span class="hs-identifier hs-var">opts</span></a></span></span><span>
</span><span id="line-563"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Plugin
-&gt; [[Char]] -&gt; ModSummary -&gt; ParsedResult -&gt; Hsc ParsedResult
</span><a href="GHC.Driver.Plugins.html#parsedResultAction"><span class="hs-identifier hs-var">parsedResultAction</span></a></span><span> </span><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683156461"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683156462"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156379"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-564"></span><span>            </span><span id="local-6989586621683156464"><span class="annot"><a href="#local-6989586621683156464"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span>
</span><span id="line-565"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Plugins.html#ParsedResult"><span class="hs-identifier hs-type">ParsedResult</span></a></span><span> </span><span id="local-6989586621683156466"><span class="annot"><a href="#local-6989586621683156466"><span class="hs-identifier hs-var">transformed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Plugins.html#PsMessages"><span class="hs-identifier hs-type">PsMessages</span></a></span><span> </span><span id="local-6989586621683156468"><span class="annot"><a href="#local-6989586621683156468"><span class="hs-identifier hs-var">warns</span></a></span></span><span> </span><span id="local-6989586621683156469"><span class="annot"><a href="#local-6989586621683156469"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-566"></span><span>              </span><span class="annot"><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-type">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156464"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156460"><span class="hs-identifier hs-type">applyPluginAction</span></a></span><span>
</span><span id="line-567"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Plugins.html#ParsedResult"><span class="hs-identifier hs-type">ParsedResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156456"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">uncurry</span></span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#PsMessages"><span class="hs-identifier hs-type">PsMessages</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html#getPsMessages"><span class="hs-identifier hs-type">getPsMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156428"><span class="hs-identifier hs-type">pst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>            </span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-type">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683156468"><span class="hs-identifier hs-type">warns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-type">isEmptyMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156469"><span class="hs-identifier hs-type">errs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-type">throwErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-type">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683156469"><span class="hs-identifier hs-type">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156466"><span class="hs-identifier hs-type">transformed</span></a></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.Driver.Main.html#checkBidirectionFormatChars"><span class="hs-identifier hs-type">checkBidirectionFormatChars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span id="checkBidirectionFormatChars"><span class="annot"><span class="annottext">checkBidirectionFormatChars :: PsLoc -&gt; StringBuffer -&gt; Maybe (NonEmpty (PsLoc, Char, [Char]))
</span><a href="GHC.Driver.Main.html#checkBidirectionFormatChars"><span class="hs-identifier hs-var hs-var">checkBidirectionFormatChars</span></a></span></span><span> </span><span id="local-6989586621683156473"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156473"><span class="hs-identifier hs-var">start_loc</span></a></span></span><span> </span><span id="local-6989586621683156474"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156474"><span class="hs-identifier hs-var">sb</span></a></span></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; Bool
</span><a href="GHC.Data.StringBuffer.html#containsBidirectionalFormatChar"><span class="hs-identifier hs-var">containsBidirectionalFormatChar</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156474"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (PsLoc, Char, [Char])
-&gt; Maybe (NonEmpty (PsLoc, Char, [Char]))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (PsLoc, Char, [Char])
 -&gt; Maybe (NonEmpty (PsLoc, Char, [Char])))
-&gt; NonEmpty (PsLoc, Char, [Char])
-&gt; Maybe (NonEmpty (PsLoc, Char, [Char]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; NonEmpty (PsLoc, Char, [Char])
</span><a href="#local-6989586621683156476"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156473"><span class="hs-identifier hs-var">start_loc</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156474"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (PsLoc, Char, [Char]))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><a href="#local-6989586621683156476"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621683156476"><span class="annot"><span class="annottext">go :: PsLoc -&gt; StringBuffer -&gt; NonEmpty (PsLoc, Char, [Char])
</span><a href="#local-6989586621683156476"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683156477"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156477"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683156478"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156478"><span class="hs-identifier hs-var">sb</span></a></span></span><span>
</span><span id="line-581"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; Bool
</span><a href="GHC.Data.StringBuffer.html#atEnd"><span class="hs-identifier hs-var">atEnd</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156478"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; NonEmpty (PsLoc, Char, [Char])
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;checkBidirectionFormatChars: no char found&quot;</span></span><span>
</span><span id="line-582"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; (Char, StringBuffer)
</span><a href="GHC.Data.StringBuffer.html#nextChar"><span class="hs-identifier hs-var">nextChar</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156478"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-583"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683156482"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156482"><span class="hs-identifier hs-var">chr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156483"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156483"><span class="hs-identifier hs-var">sb</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156484"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156484"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [(Char, [Char])] -&gt; Maybe [Char]
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156482"><span class="hs-identifier hs-var">chr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Char, [Char])]
</span><a href="GHC.Data.StringBuffer.html#bidirectionalFormatChars"><span class="hs-identifier hs-var">bidirectionalFormatChars</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-585"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156477"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156482"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156484"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PsLoc, Char, [Char])
-&gt; [(PsLoc, Char, [Char])] -&gt; NonEmpty (PsLoc, Char, [Char])
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, [Char])]
</span><a href="#local-6989586621683156487"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156477"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156482"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156483"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-586"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; NonEmpty (PsLoc, Char, [Char])
</span><a href="#local-6989586621683156476"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156477"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156482"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156483"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>    </span><span class="annot"><a href="#local-6989586621683156487"><span class="hs-identifier hs-type">go1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-589"></span><span>    </span><span id="local-6989586621683156487"><span class="annot"><span class="annottext">go1 :: PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, [Char])]
</span><a href="#local-6989586621683156487"><span class="hs-identifier hs-var hs-var">go1</span></a></span></span><span> </span><span id="local-6989586621683156488"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156488"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683156489"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156489"><span class="hs-identifier hs-var">sb</span></a></span></span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; Bool
</span><a href="GHC.Data.StringBuffer.html#atEnd"><span class="hs-identifier hs-var">atEnd</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156489"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-591"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; (Char, StringBuffer)
</span><a href="GHC.Data.StringBuffer.html#nextChar"><span class="hs-identifier hs-var">nextChar</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156489"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-592"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683156490"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156490"><span class="hs-identifier hs-var">chr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156491"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156491"><span class="hs-identifier hs-var">sb</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156492"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156492"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [(Char, [Char])] -&gt; Maybe [Char]
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156490"><span class="hs-identifier hs-var">chr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Char, [Char])]
</span><a href="GHC.Data.StringBuffer.html#bidirectionalFormatChars"><span class="hs-identifier hs-var">bidirectionalFormatChars</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-594"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156488"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156490"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156492"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PsLoc, Char, [Char])
-&gt; [(PsLoc, Char, [Char])] -&gt; [(PsLoc, Char, [Char])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, [Char])]
</span><a href="#local-6989586621683156487"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156488"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156490"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156491"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-595"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, [Char])]
</span><a href="#local-6989586621683156487"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621683156488"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683156490"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621683156491"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-599"></span><span class="annot"><span class="hs-comment">-- | If the renamed source has been kept, extract it. Dump it if requested.</span></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="annot"><a href="GHC.Driver.Main.html#extract_renamed_stuff"><span class="hs-identifier hs-type">extract_renamed_stuff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span>
</span><span id="line-603"></span><span id="extract_renamed_stuff"><span class="annot"><span class="annottext">extract_renamed_stuff :: ModSummary -&gt; TcGblEnv -&gt; Hsc RenamedStuff
</span><a href="GHC.Driver.Main.html#extract_renamed_stuff"><span class="hs-identifier hs-var hs-var">extract_renamed_stuff</span></a></span></span><span> </span><span id="local-6989586621683156494"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156494"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683156495"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156495"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156496"><span class="annot"><span class="annottext">rn_info :: RenamedStuff
</span><a href="#local-6989586621683156496"><span class="hs-identifier hs-var hs-var hs-var">rn_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; RenamedStuff
</span><a href="GHC.Tc.Module.html#getRenamedStuff"><span class="hs-identifier hs-var">getRenamedStuff</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156495"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621683156498"><span class="annot"><a href="#local-6989586621683156498"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-607"></span><span>    </span><span id="local-6989586621683156499"><span class="annot"><a href="#local-6989586621683156499"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156499"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_ast"><span class="hs-identifier hs-type">Opt_D_dump_rn_ast</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Renamer&quot;</span></span><span>
</span><span id="line-609"></span><span>                </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-type">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-type">showAstData</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-type">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html#NoBlankEpAnnotations"><span class="hs-identifier hs-type">NoBlankEpAnnotations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156496"><span class="hs-identifier hs-type">rn_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-comment">-- Create HIE files</span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-type">gopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-type">Opt_WriteHie</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156498"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-comment">-- I assume this fromJust is safe because `-fwrite-hie-file`</span><span>
</span><span id="line-614"></span><span>        </span><span class="hs-comment">-- enables the option which keeps the renamed source.</span><span>
</span><span id="line-615"></span><span>        </span><span id="local-6989586621683156503"><span class="annot"><a href="#local-6989586621683156503"><span class="hs-identifier hs-var">hieFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Ast.html#mkHieFile"><span class="hs-identifier hs-type">mkHieFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156494"><span class="hs-identifier hs-type">mod_summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156495"><span class="hs-identifier hs-type">tc_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromJust</span></span><span> </span><span class="annot"><a href="#local-6989586621683156496"><span class="hs-identifier hs-type">rn_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156505"><span class="annot"><a href="#local-6989586621683156505"><span class="hs-identifier hs-var hs-var">out_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">(ModLocation -&gt; [Char]) -&gt; ModLocation -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156494"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-617"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#writeHieFile"><span class="hs-identifier hs-type">writeHieFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156505"><span class="hs-identifier hs-type">out_file</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156503"><span class="hs-identifier hs-type">hieFile</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156499"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_hie"><span class="hs-identifier hs-type">Opt_D_dump_hie</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;HIE AST&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-type">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#hie_asts"><span class="hs-identifier hs-var">hie_asts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156503"><span class="hs-identifier hs-type">hieFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>        </span><span class="hs-comment">-- Validate HIE files</span><span>
</span><span id="line-621"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-type">gopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_ValidateHie"><span class="hs-identifier hs-type">Opt_ValidateHie</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156498"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-622"></span><span>            </span><span id="local-6989586621683156509"><span class="annot"><a href="#local-6989586621683156509"><span class="hs-identifier hs-var">hs_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span>
</span><span id="line-623"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-624"></span><span>              </span><span class="hs-comment">-- Validate Scopes</span><span>
</span><span id="line-625"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html#validateScopes"><span class="hs-identifier hs-type">validateScopes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Ext.Types.html#hie_module"><span class="hs-identifier hs-var">hie_module</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156503"><span class="hs-identifier hs-type">hieFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#getAsts"><span class="hs-identifier hs-var">getAsts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#hie_asts"><span class="hs-identifier hs-var">hie_asts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156503"><span class="hs-identifier hs-type">hieFile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-626"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156499"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Got valid scopes&quot;</span></span><span>
</span><span id="line-627"></span><span>                  </span><span id="local-6989586621683156511"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621683156511"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-628"></span><span>                    </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156499"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Got invalid scopes&quot;</span></span><span>
</span><span id="line-629"></span><span>                    </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; [SDoc] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156499"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621683156511"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-630"></span><span>              </span><span class="hs-comment">-- Roundtrip testing</span><span>
</span><span id="line-631"></span><span>              </span><span id="local-6989586621683156513"><span class="annot"><a href="#local-6989586621683156513"><span class="hs-identifier hs-var">file'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#readHieFile"><span class="hs-identifier hs-type">readHieFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_NC"><span class="hs-identifier hs-var">hsc_NC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156509"><span class="hs-identifier hs-type">hs_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156505"><span class="hs-identifier hs-type">out_file</span></a></span><span>
</span><span id="line-632"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html#diffFile"><span class="hs-identifier hs-type">diffFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156503"><span class="hs-identifier hs-type">hieFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#hie_file_result"><span class="hs-identifier hs-var">hie_file_result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156513"><span class="hs-identifier hs-type">file'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-633"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-634"></span><span>                  </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156499"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Got no roundtrip errors&quot;</span></span><span>
</span><span id="line-635"></span><span>                </span><span id="local-6989586621683156514"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621683156514"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-636"></span><span>                  </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156499"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Got roundtrip errors&quot;</span></span><span>
</span><span id="line-637"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156515"><span class="annot"><span class="annottext">logger' :: Logger
</span><a href="#local-6989586621683156515"><span class="hs-identifier hs-var hs-var">logger'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; (LogFlags -&gt; LogFlags) -&gt; Logger
</span><a href="GHC.Utils.Logger.html#updateLogFlags"><span class="hs-identifier hs-var">updateLogFlags</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156499"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DumpFlag -&gt; LogFlags -&gt; LogFlags
</span><a href="GHC.Utils.Logger.html#log_set_dopt"><span class="hs-identifier hs-var">log_set_dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_ppr_debug"><span class="hs-identifier hs-var">Opt_D_ppr_debug</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>                  </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; [SDoc] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156515"><span class="hs-identifier hs-var">logger'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621683156514"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156496"><span class="hs-identifier hs-type">rn_info</span></a></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-643"></span><span class="annot"><span class="hs-comment">-- | Rename and typecheck a module, additionally returning the renamed syntax</span></span><span>
</span><span id="line-644"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckRename"><span class="hs-identifier hs-type">hscTypecheckRename</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-645"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span id="hscTypecheckRename"><span class="annot"><span class="annottext">hscTypecheckRename :: HscEnv
-&gt; ModSummary -&gt; HsParsedModule -&gt; IO (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hscTypecheckRename"><span class="hs-identifier hs-var hs-var">hscTypecheckRename</span></a></span></span><span> </span><span id="local-6989586621683156519"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156519"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156520"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156520"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683156521"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156521"><span class="hs-identifier hs-var">rdr_module</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><span class="annottext">((TcGblEnv,
  Maybe
    (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
     Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
     Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName))),
 Messages GhcMessage)
-&gt; (TcGblEnv,
    Maybe
      (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
       Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
       Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName)))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(((TcGblEnv,
   Maybe
     (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
      Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
      Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName))),
  Messages GhcMessage)
 -&gt; (TcGblEnv,
     Maybe
       (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
        Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
        Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName))))
-&gt; IO
     ((TcGblEnv,
       Maybe
         (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
          Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
          Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName))),
      Messages GhcMessage)
-&gt; IO
     (TcGblEnv,
      Maybe
        (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
         Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
         Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModSummary
-&gt; HsParsedModule
-&gt; IO ((TcGblEnv, RenamedStuff), Messages GhcMessage)
</span><a href="GHC.Driver.Main.html#hscTypecheckRenameWithDiagnostics"><span class="hs-identifier hs-var">hscTypecheckRenameWithDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156519"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156520"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156521"><span class="hs-identifier hs-var">rdr_module</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="hs-comment">-- | Rename and typecheck a module, additionally returning the renamed syntax</span><span>
</span><span id="line-650"></span><span class="hs-comment">-- and the diagnostics produced.</span><span>
</span><span id="line-651"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckRenameWithDiagnostics"><span class="hs-identifier hs-type">hscTypecheckRenameWithDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-652"></span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span id="hscTypecheckRenameWithDiagnostics"><span class="annot"><span class="annottext">hscTypecheckRenameWithDiagnostics :: HscEnv
-&gt; ModSummary
-&gt; HsParsedModule
-&gt; IO ((TcGblEnv, RenamedStuff), Messages GhcMessage)
</span><a href="GHC.Driver.Main.html#hscTypecheckRenameWithDiagnostics"><span class="hs-identifier hs-var hs-var">hscTypecheckRenameWithDiagnostics</span></a></span></span><span> </span><span id="local-6989586621683156523"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156523"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156524"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156524"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683156525"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156525"><span class="hs-identifier hs-var">rdr_module</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (TcGblEnv, RenamedStuff)
-&gt; IO ((TcGblEnv, RenamedStuff), Messages GhcMessage)
forall a. HscEnv -&gt; Hsc a -&gt; IO (a, Messages GhcMessage)
</span><a href="GHC.Driver.Env.html#runHsc%27"><span class="hs-identifier hs-var">runHsc'</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156523"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (TcGblEnv, RenamedStuff)
 -&gt; IO ((TcGblEnv, RenamedStuff), Messages GhcMessage))
-&gt; Hsc (TcGblEnv, RenamedStuff)
-&gt; IO ((TcGblEnv, RenamedStuff), Messages GhcMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-654"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ModSummary
-&gt; Maybe HsParsedModule
-&gt; Hsc (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-var">hsc_typecheck</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156524"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsParsedModule -&gt; Maybe HsParsedModule
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156525"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="annot"><span class="hs-comment">-- | Do Typechecking without throwing SourceError exception with -Werror</span></span><span>
</span><span id="line-657"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckAndGetWarnings"><span class="hs-identifier hs-type">hscTypecheckAndGetWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#FrontendResult"><span class="hs-identifier hs-type">FrontendResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span id="hscTypecheckAndGetWarnings"><span class="annot"><span class="annottext">hscTypecheckAndGetWarnings :: HscEnv -&gt; ModSummary -&gt; IO (FrontendResult, Messages GhcMessage)
</span><a href="GHC.Driver.Main.html#hscTypecheckAndGetWarnings"><span class="hs-identifier hs-var hs-var">hscTypecheckAndGetWarnings</span></a></span></span><span> </span><span id="local-6989586621683156529"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156529"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156530"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156530"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc FrontendResult -&gt; IO (FrontendResult, Messages GhcMessage)
forall a. HscEnv -&gt; Hsc a -&gt; IO (a, Messages GhcMessage)
</span><a href="GHC.Driver.Env.html#runHsc%27"><span class="hs-identifier hs-var">runHsc'</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156529"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc FrontendResult -&gt; IO (FrontendResult, Messages GhcMessage))
-&gt; Hsc FrontendResult -&gt; IO (FrontendResult, Messages GhcMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Hooks -&gt; Maybe (ModSummary -&gt; Hsc FrontendResult)
</span><a href="GHC.Driver.Hooks.html#hscFrontendHook"><span class="hs-identifier hs-var">hscFrontendHook</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156529"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ModSummary -&gt; Hsc FrontendResult)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; FrontendResult
</span><a href="GHC.Tc.Types.html#FrontendTypecheck"><span class="hs-identifier hs-var">FrontendTypecheck</span></a></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; FrontendResult)
-&gt; ((TcGblEnv,
     Maybe
       (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
        Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
        Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName)))
    -&gt; TcGblEnv)
-&gt; (TcGblEnv,
    Maybe
      (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
       Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
       Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName)))
-&gt; FrontendResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv,
 Maybe
   (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
    Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
    Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName)))
-&gt; TcGblEnv
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((TcGblEnv,
  Maybe
    (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
     Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
     Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName)))
 -&gt; FrontendResult)
-&gt; Hsc
     (TcGblEnv,
      Maybe
        (HsGroup GhcRn, [GenLocated SrcSpanAnnA (ImportDecl GhcRn)],
         Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), Avails)],
         Maybe (LHsDoc GhcRn), Maybe (GenLocated SrcSpanAnnA ModuleName)))
-&gt; Hsc FrontendResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ModSummary
-&gt; Maybe HsParsedModule
-&gt; Hsc (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-var">hsc_typecheck</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156530"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HsParsedModule
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156533"><span class="annot"><span class="annottext">ModSummary -&gt; Hsc FrontendResult
</span><a href="#local-6989586621683156533"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Hsc FrontendResult
</span><a href="#local-6989586621683156533"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156530"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="hs-comment">-- | A bunch of logic piled around @tcRnModule'@, concerning a) backpack</span><span>
</span><span id="line-664"></span><span class="hs-comment">-- b) concerning dumping rename info and hie files. It would be nice to further</span><span>
</span><span id="line-665"></span><span class="hs-comment">-- separate this stuff out, probably in conjunction better separating renaming</span><span>
</span><span id="line-666"></span><span class="hs-comment">-- and type checking (#17781).</span><span>
</span><span id="line-667"></span><span class="annot"><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-type">hsc_typecheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Keep renamed source?</span></span><span>
</span><span id="line-668"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-669"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span id="hsc_typecheck"><span class="annot"><span class="annottext">hsc_typecheck :: Bool
-&gt; ModSummary
-&gt; Maybe HsParsedModule
-&gt; Hsc (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-var hs-var">hsc_typecheck</span></a></span></span><span> </span><span id="local-6989586621683156534"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156534"><span class="hs-identifier hs-var">keep_rn</span></a></span></span><span> </span><span id="local-6989586621683156535"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156535"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683156536"><span class="annot"><span class="annottext">Maybe HsParsedModule
</span><a href="#local-6989586621683156536"><span class="hs-identifier hs-var">mb_rdr_module</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>    </span><span id="local-6989586621683156537"><span class="annot"><a href="#local-6989586621683156537"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-672"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156538"><span class="annot"><a href="#local-6989586621683156538"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156535"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-673"></span><span>        </span><span id="local-6989586621683156539"><span class="annot"><a href="#local-6989586621683156539"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156537"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-674"></span><span>        </span><span id="local-6989586621683156540"><span class="annot"><a href="#local-6989586621683156540"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156537"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-675"></span><span>        </span><span id="local-6989586621683156542"><span class="annot"><a href="#local-6989586621683156542"><span class="hs-identifier hs-var hs-var">outer_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156535"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-676"></span><span>        </span><span id="local-6989586621683156543"><span class="annot"><a href="#local-6989586621683156543"><span class="hs-identifier hs-var hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156542"><span class="hs-identifier hs-var">outer_mod</span></a></span><span>
</span><span id="line-677"></span><span>        </span><span id="local-6989586621683156545"><span class="annot"><a href="#local-6989586621683156545"><span class="hs-identifier hs-var hs-var">outer_mod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683156540"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683156543"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-678"></span><span>        </span><span id="local-6989586621683156547"><span class="annot"><a href="#local-6989586621683156547"><span class="hs-identifier hs-var hs-var">inner_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#homeModuleNameInstantiation"><span class="hs-identifier hs-var">homeModuleNameInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683156540"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683156543"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-679"></span><span>        </span><span id="local-6989586621683156549"><span class="annot"><a href="#local-6989586621683156549"><span class="hs-identifier hs-var hs-var">src_filename</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [Char]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_file"><span class="hs-identifier hs-var">ms_hspp_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156535"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-680"></span><span>        </span><span id="local-6989586621683156550"><span class="annot"><a href="#local-6989586621683156550"><span class="hs-identifier hs-var hs-var">real_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcLoc -&gt; RealSrcSpan
</span><a href="GHC.Types.SrcLoc.html#realSrcLocSpan"><span class="hs-identifier hs-var">realSrcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(RealSrcLoc -&gt; RealSrcSpan) -&gt; RealSrcLoc -&gt; RealSrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156549"><span class="hs-identifier hs-var">src_filename</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-681"></span><span>        </span><span id="local-6989586621683156552"><span class="annot"><a href="#local-6989586621683156552"><span class="hs-identifier hs-var hs-var">keep_rn'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-var">Opt_WriteHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156539"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156534"><span class="hs-identifier hs-var">keep_rn</span></a></span><span>
</span><span id="line-682"></span><span>    </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.html#isHomeModule"><span class="hs-identifier hs-type">isHomeModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156540"><span class="hs-identifier hs-type">home_unit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156542"><span class="hs-identifier hs-type">outer_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>    </span><span id="local-6989586621683156556"><span class="annot"><a href="#local-6989586621683156556"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683156538"><span class="hs-identifier hs-type">hsc_src</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-type">HsigFile</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.html#isHoleModule"><span class="hs-identifier hs-type">isHoleModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156547"><span class="hs-identifier hs-type">inner_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#tcRnInstantiateSignature"><span class="hs-identifier hs-type">tcRnInstantiateSignature</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156537"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156545"><span class="hs-identifier hs-type">outer_mod'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156550"><span class="hs-identifier hs-type">real_loc</span></a></span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-686"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683156560"><span class="annot"><a href="#local-6989586621683156560"><span class="hs-identifier hs-var">hpm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683156536"><span class="hs-identifier hs-type">mb_rdr_module</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-687"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156561"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156561"><span class="hs-identifier hs-var">hpm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsParsedModule -&gt; Hsc HsParsedModule
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156561"><span class="hs-identifier hs-var">hpm</span></a></span><span>
</span><span id="line-688"></span><span>                    </span><span class="annot"><span class="annottext">Maybe HsParsedModule
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Hsc HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-var">hscParse'</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156535"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-689"></span><span>            </span><span id="local-6989586621683156562"><span class="annot"><a href="#local-6989586621683156562"><span class="hs-identifier hs-var">tc_result0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier hs-type">tcRnModule'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156535"><span class="hs-identifier hs-type">mod_summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156552"><span class="hs-identifier hs-type">keep_rn'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156560"><span class="hs-identifier hs-type">hpm</span></a></span><span>
</span><span id="line-690"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683156538"><span class="hs-identifier hs-type">hsc_src</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-type">HsigFile</span></a></span><span>
</span><span id="line-691"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683156563"><span class="annot"><a href="#local-6989586621683156563"><span class="hs-identifier hs-var">iface</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-type">hscSimpleIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156537"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621683156562"><span class="hs-identifier hs-type">tc_result0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156535"><span class="hs-identifier hs-type">mod_summary</span></a></span><span>
</span><span id="line-692"></span><span>                        </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-693"></span><span>                            </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#tcRnMergeSignatures"><span class="hs-identifier hs-type">tcRnMergeSignatures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156537"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156560"><span class="hs-identifier hs-type">hpm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156562"><span class="hs-identifier hs-type">tc_result0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156563"><span class="hs-identifier hs-type">iface</span></a></span><span>
</span><span id="line-694"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156562"><span class="hs-identifier hs-type">tc_result0</span></a></span><span>
</span><span id="line-695"></span><span>    </span><span class="hs-comment">-- TODO are we extracting anything when we merely instantiate a signature?</span><span>
</span><span id="line-696"></span><span>    </span><span class="hs-comment">-- If not, try to move this into the &quot;else&quot; case above.</span><span>
</span><span id="line-697"></span><span>    </span><span id="local-6989586621683156566"><span class="annot"><a href="#local-6989586621683156566"><span class="hs-identifier hs-var">rn_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#extract_renamed_stuff"><span class="hs-identifier hs-type">extract_renamed_stuff</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156535"><span class="hs-identifier hs-type">mod_summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156556"><span class="hs-identifier hs-type">tc_result</span></a></span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683156556"><span class="hs-identifier hs-type">tc_result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683156566"><span class="hs-identifier hs-type">rn_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="hs-comment">-- wrapper around tcRnModule to handle safe haskell extras</span><span>
</span><span id="line-701"></span><span class="annot"><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier hs-type">tcRnModule'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-702"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-703"></span><span id="tcRnModule%27"><span class="annot"><span class="annottext">tcRnModule' :: ModSummary -&gt; Bool -&gt; HsParsedModule -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier hs-var hs-var">tcRnModule'</span></a></span></span><span> </span><span id="local-6989586621683156567"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156567"><span class="hs-identifier hs-var">sum</span></a></span></span><span> </span><span id="local-6989586621683156568"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156568"><span class="hs-identifier hs-var">save_rn_syntax</span></a></span></span><span> </span><span id="local-6989586621683156569"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683156569"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-704"></span><span>    </span><span id="local-6989586621683156570"><span class="annot"><a href="#local-6989586621683156570"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-705"></span><span>    </span><span id="local-6989586621683156571"><span class="annot"><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156572"><span class="annot"><a href="#local-6989586621683156572"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-comment">-- -Wmissing-safe-haskell-mode</span><span>
</span><span id="line-709"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#safeHaskellModeEnabled"><span class="hs-identifier hs-type">safeHaskellModeEnabled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156571"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>          </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#wopt"><span class="hs-identifier hs-type">wopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_WarnMissingSafeHaskellMode"><span class="hs-identifier hs-type">Opt_WarnMissingSafeHaskellMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156571"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-711"></span><span>        </span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-type">singleMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-712"></span><span>        </span><span class="annot"><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-type">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156572"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-type">getLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.html#hpm_module"><span class="hs-identifier hs-var">hpm_module</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156569"><span class="hs-identifier hs-type">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-713"></span><span>        </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-type">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMissingSafeHaskellMode"><span class="hs-identifier hs-type">DriverMissingSafeHaskellMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156567"><span class="hs-identifier hs-type">sum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>    </span><span id="local-6989586621683156578"><span class="annot"><a href="#local-6989586621683156578"><span class="hs-identifier hs-var">tcg_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Typecheck-Rename&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-716"></span><span>               </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-717"></span><span>                   </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnModule"><span class="hs-identifier hs-type">tcRnModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156570"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156567"><span class="hs-identifier hs-type">sum</span></a></span><span>
</span><span id="line-718"></span><span>                     </span><span class="annot"><a href="#local-6989586621683156568"><span class="hs-identifier hs-type">save_rn_syntax</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156569"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>    </span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation]</span><span>
</span><span id="line-721"></span><span>    </span><span class="hs-comment">-- although this is used for more than just that failure case.</span><span>
</span><span id="line-722"></span><span>    </span><span id="local-6989586621683156580"><span class="annot"><a href="#local-6989586621683156580"><span class="hs-identifier hs-var">tcSafeOK</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_safe_infer"><span class="hs-identifier hs-var">tcg_safe_infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156578"><span class="hs-identifier hs-type">tcg_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>    </span><span id="local-6989586621683156583"><span class="annot"><a href="#local-6989586621683156583"><span class="hs-identifier hs-var">whyUnsafe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_safe_infer_reasons"><span class="hs-identifier hs-var">tcg_safe_infer_reasons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156578"><span class="hs-identifier hs-type">tcg_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156585"><span class="annot"><a href="#local-6989586621683156585"><span class="hs-identifier hs-var hs-var">allSafeOK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#safeInferred"><span class="hs-identifier hs-var">safeInferred</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156580"><span class="hs-identifier hs-var">tcSafeOK</span></a></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span>    </span><span class="hs-comment">-- end of the safe haskell line, how to respond to user?</span><span>
</span><span id="line-727"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#safeHaskellOn"><span class="hs-identifier hs-type">safeHaskellOn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156571"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>         </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-type">safeInferOn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156571"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683156585"><span class="hs-identifier hs-type">allSafeOK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>      </span><span class="hs-comment">-- if safe Haskell off or safe infer failed, mark unsafe</span><span>
</span><span id="line-730"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-type">markUnsafeInfer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156578"><span class="hs-identifier hs-type">tcg_res</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156583"><span class="hs-identifier hs-type">whyUnsafe</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span>      </span><span class="hs-comment">-- module (could be) safe, throw warning if needed</span><span>
</span><span id="line-733"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-734"></span><span>          </span><span id="local-6989586621683156590"><span class="annot"><a href="#local-6989586621683156590"><span class="hs-identifier hs-var">tcg_res'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafeImports"><span class="hs-identifier hs-type">hscCheckSafeImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156578"><span class="hs-identifier hs-type">tcg_res</span></a></span><span>
</span><span id="line-735"></span><span>          </span><span id="local-6989586621683156592"><span class="annot"><a href="#local-6989586621683156592"><span class="hs-keyword hs-var">safe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_safe_infer"><span class="hs-identifier hs-var">tcg_safe_infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156590"><span class="hs-identifier hs-type">tcg_res'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621683156592"><span class="hs-keyword hs-type">safe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-737"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#wopt"><span class="hs-identifier hs-type">wopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_WarnSafe"><span class="hs-identifier hs-type">Opt_WarnSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156571"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-738"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-739"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.DynFlags.html#safeHaskell"><span class="hs-identifier hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Hsc ()
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages GhcMessage -&gt; Hsc ()) -&gt; Messages GhcMessage -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Messages GhcMessage)
-&gt; MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-741"></span><span>                       </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156572"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan
</span><a href="GHC.Driver.DynFlags.html#warnSafeOnLoc"><span class="hs-identifier hs-var">warnSafeOnLoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-742"></span><span>                       </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverInferredSafeModule"><span class="hs-identifier hs-var">DriverInferredSafeModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156590"><span class="hs-identifier hs-var">tcg_res'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.DynFlags.html#safeHaskell"><span class="hs-identifier hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-744"></span><span>                      </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnTrustworthySafe"><span class="hs-identifier hs-var">Opt_WarnTrustworthySafe</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-745"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages GhcMessage -&gt; Hsc ()) -&gt; Messages GhcMessage -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Messages GhcMessage)
-&gt; MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-746"></span><span>                       </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156572"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan
</span><a href="GHC.Driver.DynFlags.html#trustworthyOnLoc"><span class="hs-identifier hs-var">trustworthyOnLoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156571"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-747"></span><span>                       </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverMarkedTrustworthyButInferredSafe"><span class="hs-identifier hs-var">DriverMarkedTrustworthyButInferredSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156590"><span class="hs-identifier hs-var">tcg_res'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Hsc ()
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156590"><span class="hs-identifier hs-type">tcg_res'</span></a></span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span class="annot"><span class="hs-comment">-- | Convert a typechecked module to Core</span></span><span>
</span><span id="line-752"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar"><span class="hs-identifier hs-type">hscDesugar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-753"></span><span id="hscDesugar"><span class="annot"><span class="annottext">hscDesugar :: HscEnv -&gt; ModSummary -&gt; TcGblEnv -&gt; IO ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar"><span class="hs-identifier hs-var hs-var">hscDesugar</span></a></span></span><span> </span><span id="local-6989586621683156603"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156603"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156604"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156604"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683156605"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156605"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156603"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ModGuts -&gt; IO ModGuts) -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; TcGblEnv -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-var">hscDesugar'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156604"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156605"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-type">hscDesugar'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-757"></span><span id="hscDesugar%27"><span class="annot"><span class="annottext">hscDesugar' :: ModLocation -&gt; TcGblEnv -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-var hs-var">hscDesugar'</span></a></span></span><span> </span><span id="local-6989586621683156606"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156606"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span> </span><span id="local-6989586621683156607"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156607"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-758"></span><span>    </span><span id="local-6989586621683156608"><span class="annot"><a href="#local-6989586621683156608"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-759"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistDsMessage"><span class="hs-identifier hs-type">hoistDsMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-760"></span><span>      </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;deSugar&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-761"></span><span>      </span><span class="annot"><a href="GHC.HsToCore.html#deSugar"><span class="hs-identifier hs-type">deSugar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156608"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156606"><span class="hs-identifier hs-type">mod_location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156607"><span class="hs-identifier hs-type">tc_result</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span class="hs-comment">-- | Make a 'ModDetails' from the results of typechecking. Used when</span><span>
</span><span id="line-764"></span><span class="hs-comment">-- typechecking only, as opposed to full compilation.</span><span>
</span><span id="line-765"></span><span class="annot"><a href="GHC.Driver.Main.html#makeSimpleDetails"><span class="hs-identifier hs-type">makeSimpleDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-766"></span><span id="makeSimpleDetails"><span class="annot"><span class="annottext">makeSimpleDetails :: Logger -&gt; TcGblEnv -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#makeSimpleDetails"><span class="hs-identifier hs-var hs-var">makeSimpleDetails</span></a></span></span><span> </span><span id="local-6989586621683156612"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156612"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621683156613"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156613"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; TcGblEnv -&gt; IO ModDetails
</span><a href="GHC.Iface.Tidy.html#mkBootModDetailsTc"><span class="hs-identifier hs-var">mkBootModDetailsTc</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156612"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156613"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span class="annot"><span class="hs-comment">{- **********************************************************************
%*                                                                      *
                The main compiler pipeline
%*                                                                      *
%********************************************************************* -}</span></span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span class="hs-comment">{-
                   --------------------------------
                        The compilation proper
                   --------------------------------

It's the task of the compilation proper to compile Haskell, hs-boot and core
files to either byte-code, hard-code (C, asm, LLVM, etc.) or to nothing at all
(the module is still parsed and type-checked. This feature is mostly used by
IDE's and the likes). Compilation can happen in either 'one-shot', 'batch',
'nothing', or 'interactive' mode. 'One-shot' mode targets hard-code, 'batch'
mode targets hard-code, 'nothing' mode targets nothing and 'interactive' mode
targets byte-code.

The modes are kept separate because of their different types and meanings:

 * In 'one-shot' mode, we're only compiling a single file and can therefore
 discard the new ModIface and ModDetails. This is also the reason it only
 targets hard-code; compiling to byte-code or nothing doesn't make sense when
 we discard the result.

 * 'Batch' mode is like 'one-shot' except that we keep the resulting ModIface
 and ModDetails. 'Batch' mode doesn't target byte-code since that require us to
 return the newly compiled byte-code.

 * 'Nothing' mode has exactly the same type as 'batch' mode but they're still
 kept separate. This is because compiling to nothing is fairly special: We
 don't output any interface files, we don't run the simplifier and we don't
 generate any code.

 * 'Interactive' mode is similar to 'batch' mode except that we return the
 compiled byte-code together with the ModIface and ModDetails.

Trying to compile a hs-boot file to byte-code will result in a run-time error.
This is the only thing that isn't caught by the type-system.
-}</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span class="hs-keyword">type</span><span> </span><span id="Messager"><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-var">Messager</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="hs-comment">-- | Do the recompilation avoidance checks for both one-shot and --make modes</span><span>
</span><span id="line-815"></span><span class="hs-comment">-- This function is the *only* place in the compiler where we decide whether to</span><span>
</span><span id="line-816"></span><span class="hs-comment">-- recompile a module or not!</span><span>
</span><span id="line-817"></span><span class="annot"><a href="GHC.Driver.Main.html#hscRecompStatus"><span class="hs-identifier hs-type">hscRecompStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-818"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-819"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-820"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-821"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModLinkable"><span class="hs-identifier hs-type">HomeModLinkable</span></a></span><span>
</span><span id="line-822"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscRecompStatus"><span class="hs-identifier hs-type">HscRecompStatus</span></a></span><span>
</span><span id="line-824"></span><span id="hscRecompStatus"><span class="annot"><span class="annottext">hscRecompStatus :: Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; Maybe ModIface
-&gt; HomeModLinkable
-&gt; (Int, Int)
-&gt; IO HscRecompStatus
</span><a href="GHC.Driver.Main.html#hscRecompStatus"><span class="hs-identifier hs-var hs-var">hscRecompStatus</span></a></span></span><span>
</span><span id="line-825"></span><span>    </span><span id="local-6989586621683156615"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621683156615"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621683156616"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156616"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156617"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156617"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683156618"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621683156618"><span class="hs-identifier hs-var">mb_old_iface</span></a></span></span><span> </span><span id="local-6989586621683156619"><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621683156619"><span class="hs-identifier hs-var">old_linkable</span></a></span></span><span> </span><span id="local-6989586621683156620"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621683156620"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span>
</span><span id="line-826"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-828"></span><span>        </span><span id="local-6989586621683156621"><span class="annot"><span class="annottext">msg :: RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621683156621"><span class="hs-identifier hs-var hs-var hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621683156622"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156622"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621683156615"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-829"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156623"><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621683156623"><span class="hs-identifier hs-var">hscMessage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621683156623"><span class="hs-identifier hs-var">hscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156616"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621683156620"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156622"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; ModSummary -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-var">ModuleNode</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156617"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>          </span><span class="annot"><span class="annottext">Maybe Messager
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span>    </span><span class="hs-comment">-- First check to see if the interface file agrees with the</span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-comment">-- source file.</span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-835"></span><span>    </span><span class="hs-comment">-- Save the interface that comes back from checkOldIface.</span><span>
</span><span id="line-836"></span><span>    </span><span class="hs-comment">-- In one-shot mode we don't have the old iface until this</span><span>
</span><span id="line-837"></span><span>    </span><span class="hs-comment">-- point, when checkOldIface reads it from the disk.</span><span>
</span><span id="line-838"></span><span>    </span><span id="local-6989586621683156625"><span class="annot"><a href="#local-6989586621683156625"><span class="hs-identifier hs-var">recomp_if_result</span></a></span></span><span>
</span><span id="line-839"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;checkOldIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-840"></span><span>             </span><span class="annot"><span class="annottext">IO (MaybeValidated ModIface) -&gt; IO (MaybeValidated ModIface)
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (MaybeValidated ModIface) -&gt; IO (MaybeValidated ModIface))
-&gt; IO (MaybeValidated ModIface) -&gt; IO (MaybeValidated ModIface)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModSummary -&gt; Maybe ModIface -&gt; IO (MaybeValidated ModIface)
</span><a href="GHC.Iface.Recomp.html#checkOldIface"><span class="hs-identifier hs-var">checkOldIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156616"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156617"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621683156618"><span class="hs-identifier hs-var">mb_old_iface</span></a></span><span>
</span><span id="line-841"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683156625"><span class="hs-identifier hs-type">recomp_if_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-842"></span><span>      </span><span class="annot"><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-type">OutOfDateItem</span></a></span><span> </span><span id="local-6989586621683156628"><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156628"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621683156629"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621683156629"><span class="hs-identifier hs-var">mb_checked_iface</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-843"></span><span>        </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621683156621"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(RecompileRequired -&gt; IO ()) -&gt; RecompileRequired -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompileReason -&gt; RecompileRequired
</span><a href="GHC.Iface.Recomp.html#NeedsRecompile"><span class="hs-identifier hs-var">NeedsRecompile</span></a></span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156628"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-844"></span><span>        </span><span class="annot"><span class="annottext">HscRecompStatus -&gt; IO HscRecompStatus
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HscRecompStatus -&gt; IO HscRecompStatus)
-&gt; HscRecompStatus -&gt; IO HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint -&gt; HscRecompStatus
</span><a href="GHC.Unit.Module.Status.html#HscRecompNeeded"><span class="hs-identifier hs-var">HscRecompNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Fingerprint -&gt; HscRecompStatus)
-&gt; Maybe Fingerprint -&gt; HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; Fingerprint) -&gt; Maybe ModIface -&gt; Maybe Fingerprint
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModIface.html#mi_iface_hash"><span class="hs-identifier hs-var">mi_iface_hash</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIfaceBackend -&gt; Fingerprint)
-&gt; (ModIface -&gt; ModIfaceBackend) -&gt; ModIface -&gt; Fingerprint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
ModIface -&gt; ModIfaceBackend
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_final_exts"><span class="hs-identifier hs-var">mi_final_exts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621683156629"><span class="hs-identifier hs-var">mb_checked_iface</span></a></span><span>
</span><span id="line-845"></span><span>      </span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span id="local-6989586621683156635"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156635"><span class="hs-identifier hs-var">checked_iface</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-846"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156636"><span class="annot"><span class="annottext">lcl_dflags :: DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var hs-var">lcl_dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156617"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-847"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCode"><span class="hs-identifier hs-var">backendGeneratesCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-848"></span><span>               </span><span class="hs-comment">-- No need for a linkable, we're good to go</span><span>
</span><span id="line-849"></span><span>               </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621683156621"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span>
</span><span id="line-850"></span><span>               </span><span class="annot"><span class="annottext">HscRecompStatus -&gt; IO HscRecompStatus
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HscRecompStatus -&gt; IO HscRecompStatus)
-&gt; HscRecompStatus -&gt; IO HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; HomeModLinkable -&gt; HscRecompStatus
</span><a href="GHC.Unit.Module.Status.html#HscUpToDate"><span class="hs-identifier hs-var">HscUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156635"><span class="hs-identifier hs-var">checked_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span>
</span><span id="line-851"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCodeForHsBoot"><span class="hs-identifier hs-var">backendGeneratesCodeForHsBoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Unit.Module.ModSummary.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156617"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-853"></span><span>               </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621683156621"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span>
</span><span id="line-854"></span><span>               </span><span class="annot"><span class="annottext">HscRecompStatus -&gt; IO HscRecompStatus
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HscRecompStatus -&gt; IO HscRecompStatus)
-&gt; HscRecompStatus -&gt; IO HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; HomeModLinkable -&gt; HscRecompStatus
</span><a href="GHC.Unit.Module.Status.html#HscUpToDate"><span class="hs-identifier hs-var">HscUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156635"><span class="hs-identifier hs-var">checked_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span>           </span><span class="hs-comment">-- Always recompile with the JS backend when TH is enabled until</span><span>
</span><span id="line-857"></span><span>           </span><span class="hs-comment">-- #23013 is fixed.</span><span>
</span><span id="line-858"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchJavaScript</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TemplateHaskell</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span>
</span><span id="line-860"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-861"></span><span>              </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621683156621"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(RecompileRequired -&gt; IO ()) -&gt; RecompileRequired -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecompReason -&gt; RecompileRequired
</span><a href="GHC.Iface.Recomp.html#needsRecompileBecause"><span class="hs-identifier hs-var">needsRecompileBecause</span></a></span><span> </span><span class="annot"><span class="annottext">RecompReason
</span><a href="GHC.Iface.Recomp.html#THWithJS"><span class="hs-identifier hs-var">THWithJS</span></a></span><span>
</span><span id="line-862"></span><span>              </span><span class="annot"><span class="annottext">HscRecompStatus -&gt; IO HscRecompStatus
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HscRecompStatus -&gt; IO HscRecompStatus)
-&gt; HscRecompStatus -&gt; IO HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint -&gt; HscRecompStatus
</span><a href="GHC.Unit.Module.Status.html#HscRecompNeeded"><span class="hs-identifier hs-var">HscRecompNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Fingerprint -&gt; HscRecompStatus)
-&gt; Maybe Fingerprint -&gt; HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Maybe Fingerprint
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Fingerprint -&gt; Maybe Fingerprint)
-&gt; Fingerprint -&gt; Maybe Fingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModIface.html#mi_iface_hash"><span class="hs-identifier hs-var">mi_iface_hash</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIfaceBackend -&gt; Fingerprint) -&gt; ModIfaceBackend -&gt; Fingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_final_exts"><span class="hs-identifier hs-var">mi_final_exts</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; IfaceBackendExts 'ModIfaceFinal)
-&gt; ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156635"><span class="hs-identifier hs-var">checked_iface</span></a></span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-865"></span><span>               </span><span class="hs-comment">-- Do need linkable</span><span>
</span><span id="line-866"></span><span>               </span><span class="hs-comment">-- 1. Just check whether we have bytecode/object linkables and then</span><span>
</span><span id="line-867"></span><span>               </span><span class="hs-comment">-- we will decide if we need them or not.</span><span>
</span><span id="line-868"></span><span>               </span><span id="local-6989586621683156652"><span class="annot"><a href="#local-6989586621683156652"><span class="hs-identifier hs-var">bc_linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModIface
-&gt; ModSummary -&gt; Maybe Linkable -&gt; IO (MaybeValidated Linkable)
</span><a href="GHC.Driver.Main.html#checkByteCode"><span class="hs-identifier hs-var">checkByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156635"><span class="hs-identifier hs-var">checked_iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156617"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModLinkable -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeMod_bytecode"><span class="hs-identifier hs-var">homeMod_bytecode</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621683156619"><span class="hs-identifier hs-var">old_linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>               </span><span id="local-6989586621683156655"><span class="annot"><a href="#local-6989586621683156655"><span class="hs-identifier hs-var">obj_linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#checkObjects"><span class="hs-identifier hs-type">checkObjects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156636"><span class="hs-identifier hs-type">lcl_dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#homeMod_object"><span class="hs-identifier hs-var">homeMod_object</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156619"><span class="hs-identifier hs-type">old_linkable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156617"><span class="hs-identifier hs-type">mod_summary</span></a></span><span>
</span><span id="line-870"></span><span>               </span><span class="annot"><a href="GHC.Iface.Env.html#trace_if"><span class="hs-identifier hs-type">trace_if</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156616"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BCO linkable&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156652"><span class="hs-identifier hs-type">bc_linkable</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Object Linkable&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156655"><span class="hs-identifier hs-type">obj_linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156660"><span class="annot"><a href="#local-6989586621683156660"><span class="hs-identifier hs-var hs-var">just_bc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#justBytecode"><span class="hs-identifier hs-var">justBytecode</span></a></span><span> </span><span class="annot"><span class="annottext">(Linkable -&gt; HomeModLinkable)
-&gt; MaybeValidated Linkable -&gt; MaybeValidated HomeModLinkable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156652"><span class="hs-identifier hs-var">bc_linkable</span></a></span><span>
</span><span id="line-873"></span><span>                   </span><span id="local-6989586621683156662"><span class="annot"><a href="#local-6989586621683156662"><span class="hs-identifier hs-var hs-var">just_o</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#justObjects"><span class="hs-identifier hs-var">justObjects</span></a></span><span>  </span><span class="annot"><span class="annottext">(Linkable -&gt; HomeModLinkable)
-&gt; MaybeValidated Linkable -&gt; MaybeValidated HomeModLinkable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156655"><span class="hs-identifier hs-var">obj_linkable</span></a></span><span>
</span><span id="line-874"></span><span>                   </span><span id="local-6989586621683156664"><span class="annot"><a href="#local-6989586621683156664"><span class="hs-identifier hs-var hs-var">_maybe_both_os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156652"><span class="hs-identifier hs-var">bc_linkable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156655"><span class="hs-identifier hs-var">obj_linkable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-875"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span id="local-6989586621683156665"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156665"><span class="hs-identifier hs-var">bc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span id="local-6989586621683156666"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156666"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable -&gt; MaybeValidated HomeModLinkable
forall a. a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-var">UpToDateItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Linkable -&gt; HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#bytecodeAndObjects"><span class="hs-identifier hs-var">bytecodeAndObjects</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156665"><span class="hs-identifier hs-var">bc</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156666"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-876"></span><span>                               </span><span class="hs-comment">-- If missing object code, just say we need to recompile because of object code.</span><span>
</span><span id="line-877"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-type">OutOfDateItem</span></a></span><span> </span><span id="local-6989586621683156668"><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156668"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileReason
-&gt; Maybe HomeModLinkable -&gt; MaybeValidated HomeModLinkable
forall a. CompileReason -&gt; Maybe a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-var">OutOfDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156668"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModLinkable
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-878"></span><span>                               </span><span class="hs-comment">-- If just missing byte code, just use the object code</span><span>
</span><span id="line-879"></span><span>                               </span><span class="hs-comment">-- so you should use -fprefer-byte-code with -fwrite-if-simplified-core or you'll</span><span>
</span><span id="line-880"></span><span>                               </span><span class="hs-comment">-- end up using bytecode on recompilation</span><span>
</span><span id="line-881"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated HomeModLinkable
</span><a href="#local-6989586621683156662"><span class="hs-identifier hs-var">just_o</span></a></span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span>                   </span><span id="local-6989586621683156669"><span class="annot"><a href="#local-6989586621683156669"><span class="hs-identifier hs-var hs-var">definitely_both_os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156652"><span class="hs-identifier hs-var">bc_linkable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156655"><span class="hs-identifier hs-var">obj_linkable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-884"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span id="local-6989586621683156670"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156670"><span class="hs-identifier hs-var">bc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span id="local-6989586621683156671"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156671"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable -&gt; MaybeValidated HomeModLinkable
forall a. a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-var">UpToDateItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Linkable -&gt; HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#bytecodeAndObjects"><span class="hs-identifier hs-var">bytecodeAndObjects</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156670"><span class="hs-identifier hs-var">bc</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156671"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span>                               </span><span class="hs-comment">-- If missing object code, just say we need to recompile because of object code.</span><span>
</span><span id="line-886"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-type">OutOfDateItem</span></a></span><span> </span><span id="local-6989586621683156672"><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156672"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileReason
-&gt; Maybe HomeModLinkable -&gt; MaybeValidated HomeModLinkable
forall a. CompileReason -&gt; Maybe a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-var">OutOfDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156672"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModLinkable
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-887"></span><span>                               </span><span class="hs-comment">-- If just missing byte code, just use the object code</span><span>
</span><span id="line-888"></span><span>                               </span><span class="hs-comment">-- so you should use -fprefer-byte-code with -fwrite-if-simplified-core or you'll</span><span>
</span><span id="line-889"></span><span>                               </span><span class="hs-comment">-- end up using bytecode on recompilation</span><span>
</span><span id="line-890"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-type">OutOfDateItem</span></a></span><span> </span><span id="local-6989586621683156673"><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156673"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileReason
-&gt; Maybe HomeModLinkable -&gt; MaybeValidated HomeModLinkable
forall a. CompileReason -&gt; Maybe a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-var">OutOfDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156673"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModLinkable
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="hs-comment">--               pprTraceM &quot;recomp&quot; (ppr just_bc &lt;+&gt; ppr just_o)</span><span>
</span><span id="line-893"></span><span>               </span><span class="hs-comment">-- 2. Decide which of the products we will need</span><span>
</span><span id="line-894"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156674"><span class="annot"><a href="#local-6989586621683156674"><span class="hs-identifier hs-var hs-var">recomp_linkable_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-895"></span><span>                     </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendCanReuseLoadedCode"><span class="hs-identifier hs-var">backendCanReuseLoadedCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-896"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156652"><span class="hs-identifier hs-var">bc_linkable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-897"></span><span>                             </span><span class="hs-comment">-- If bytecode is available for Interactive then don't load object code</span><span>
</span><span id="line-898"></span><span>                             </span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated HomeModLinkable
</span><a href="#local-6989586621683156660"><span class="hs-identifier hs-var">just_bc</span></a></span><span>
</span><span id="line-899"></span><span>                             </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><a href="#local-6989586621683156655"><span class="hs-identifier hs-var">obj_linkable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-900"></span><span>                                     </span><span class="hs-comment">-- If o is availabe, then just use that</span><span>
</span><span id="line-901"></span><span>                                     </span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated HomeModLinkable
</span><a href="#local-6989586621683156662"><span class="hs-identifier hs-var">just_o</span></a></span><span>
</span><span id="line-902"></span><span>                                     </span><span class="annot"><span class="annottext">MaybeValidated Linkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecompReason
-&gt; Maybe HomeModLinkable -&gt; MaybeValidated HomeModLinkable
forall a. RecompReason -&gt; Maybe a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#outOfDateItemBecause"><span class="hs-identifier hs-var">outOfDateItemBecause</span></a></span><span> </span><span class="annot"><span class="annottext">RecompReason
</span><a href="GHC.Iface.Recomp.html#MissingBytecode"><span class="hs-identifier hs-var">MissingBytecode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModLinkable
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-903"></span><span>                        </span><span class="hs-comment">-- Need object files for making object files</span><span>
</span><span id="line-904"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendWritesFiles"><span class="hs-identifier hs-var">backendWritesFiles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-905"></span><span>                           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ByteCodeAndObjectCode"><span class="hs-identifier hs-var">Opt_ByteCodeAndObjectCode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span>
</span><span id="line-906"></span><span>                             </span><span class="hs-comment">-- We say we are going to write both, so recompile unless we have both</span><span>
</span><span id="line-907"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MaybeValidated HomeModLinkable
</span><a href="#local-6989586621683156669"><span class="hs-identifier hs-var">definitely_both_os</span></a></span><span>
</span><span id="line-908"></span><span>                             </span><span class="hs-comment">-- Only load the object file unless we are saying we need to produce both.</span><span>
</span><span id="line-909"></span><span>                             </span><span class="hs-comment">-- Unless we do this then you can end up using byte-code for a module you specify -fobject-code for.</span><span>
</span><span id="line-910"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MaybeValidated HomeModLinkable
</span><a href="#local-6989586621683156662"><span class="hs-identifier hs-var">just_o</span></a></span><span>
</span><span id="line-911"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; MaybeValidated HomeModLinkable
forall a. HasCallStack =&gt; [Char] -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscRecompStatus&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; SDoc) -&gt; [Char] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Backend -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Backend -&gt; [Char]) -&gt; Backend -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156636"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683156674"><span class="hs-identifier hs-type">recomp_linkable_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-913"></span><span>                 </span><span class="annot"><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-type">UpToDateItem</span></a></span><span> </span><span id="local-6989586621683156682"><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621683156682"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-914"></span><span>                   </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621683156621"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(RecompileRequired -&gt; IO ()) -&gt; RecompileRequired -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span>
</span><span id="line-915"></span><span>                   </span><span class="annot"><span class="annottext">HscRecompStatus -&gt; IO HscRecompStatus
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HscRecompStatus -&gt; IO HscRecompStatus)
-&gt; HscRecompStatus -&gt; IO HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; HomeModLinkable -&gt; HscRecompStatus
</span><a href="GHC.Unit.Module.Status.html#HscUpToDate"><span class="hs-identifier hs-var">HscUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156635"><span class="hs-identifier hs-var">checked_iface</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModLinkable -&gt; HscRecompStatus)
-&gt; HomeModLinkable -&gt; HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621683156682"><span class="hs-identifier hs-var">linkable</span></a></span><span>
</span><span id="line-916"></span><span>                 </span><span class="annot"><a href="GHC.Iface.Recomp.html#OutOfDateItem"><span class="hs-identifier hs-type">OutOfDateItem</span></a></span><span> </span><span id="local-6989586621683156683"><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156683"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModLinkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-917"></span><span>                   </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621683156621"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(RecompileRequired -&gt; IO ()) -&gt; RecompileRequired -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompileReason -&gt; RecompileRequired
</span><a href="GHC.Iface.Recomp.html#NeedsRecompile"><span class="hs-identifier hs-var">NeedsRecompile</span></a></span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156683"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-918"></span><span>                   </span><span class="annot"><span class="annottext">HscRecompStatus -&gt; IO HscRecompStatus
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HscRecompStatus -&gt; IO HscRecompStatus)
-&gt; HscRecompStatus -&gt; IO HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint -&gt; HscRecompStatus
</span><a href="GHC.Unit.Module.Status.html#HscRecompNeeded"><span class="hs-identifier hs-var">HscRecompNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Fingerprint -&gt; HscRecompStatus)
-&gt; Maybe Fingerprint -&gt; HscRecompStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Maybe Fingerprint
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Fingerprint -&gt; Maybe Fingerprint)
-&gt; Fingerprint -&gt; Maybe Fingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModIface.html#mi_iface_hash"><span class="hs-identifier hs-var">mi_iface_hash</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIfaceBackend -&gt; Fingerprint) -&gt; ModIfaceBackend -&gt; Fingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_final_exts"><span class="hs-identifier hs-var">mi_final_exts</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; IfaceBackendExts 'ModIfaceFinal)
-&gt; ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156635"><span class="hs-identifier hs-var">checked_iface</span></a></span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span class="hs-comment">-- | Check that the .o files produced by compilation are already up-to-date</span><span>
</span><span id="line-921"></span><span class="hs-comment">-- or not.</span><span>
</span><span id="line-922"></span><span class="annot"><a href="GHC.Driver.Main.html#checkObjects"><span class="hs-identifier hs-type">checkObjects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Recomp.html#MaybeValidated"><span class="hs-identifier hs-type">MaybeValidated</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span id="checkObjects"><span class="annot"><span class="annottext">checkObjects :: DynFlags
-&gt; Maybe Linkable -&gt; ModSummary -&gt; IO (MaybeValidated Linkable)
</span><a href="GHC.Driver.Main.html#checkObjects"><span class="hs-identifier hs-var hs-var">checkObjects</span></a></span></span><span> </span><span id="local-6989586621683156684"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156684"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683156685"><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621683156685"><span class="hs-identifier hs-var">mb_old_linkable</span></a></span></span><span> </span><span id="local-6989586621683156686"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156686"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-924"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-925"></span><span>    </span><span id="local-6989586621683156687"><span class="annot"><span class="annottext">dt_enabled :: Bool
</span><a href="#local-6989586621683156687"><span class="hs-identifier hs-var hs-var">dt_enabled</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_BuildDynamicToo"><span class="hs-identifier hs-var">Opt_BuildDynamicToo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156684"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-926"></span><span>    </span><span id="local-6989586621683156689"><span class="annot"><span class="annottext">this_mod :: Module
</span><a href="#local-6989586621683156689"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156686"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-927"></span><span>    </span><span id="local-6989586621683156690"><span class="annot"><span class="annottext">mb_obj_date :: Maybe UTCTime
</span><a href="#local-6989586621683156690"><span class="hs-identifier hs-var hs-var">mb_obj_date</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_obj_date"><span class="hs-identifier hs-var">ms_obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156686"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-928"></span><span>    </span><span id="local-6989586621683156692"><span class="annot"><span class="annottext">mb_dyn_obj_date :: Maybe UTCTime
</span><a href="#local-6989586621683156692"><span class="hs-identifier hs-var hs-var">mb_dyn_obj_date</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_dyn_obj_date"><span class="hs-identifier hs-var">ms_dyn_obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156686"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-929"></span><span>    </span><span id="local-6989586621683156694"><span class="annot"><span class="annottext">mb_if_date :: Maybe UTCTime
</span><a href="#local-6989586621683156694"><span class="hs-identifier hs-var hs-var">mb_if_date</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156686"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-930"></span><span>    </span><span id="local-6989586621683156696"><span class="annot"><span class="annottext">obj_fn :: [Char]
</span><a href="#local-6989586621683156696"><span class="hs-identifier hs-var hs-var">obj_fn</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156686"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>    </span><span class="hs-comment">-- dynamic-too *also* produces the dyn_o_file, so have to check</span><span>
</span><span id="line-932"></span><span>    </span><span class="hs-comment">-- that's there, and if it's not, regenerate both .o and</span><span>
</span><span id="line-933"></span><span>    </span><span class="hs-comment">-- .dyn_o</span><span>
</span><span id="line-934"></span><span>    </span><span id="local-6989586621683156698"><span class="annot"><span class="annottext">checkDynamicObj :: IO (MaybeValidated Linkable) -&gt; IO (MaybeValidated Linkable)
</span><a href="#local-6989586621683156698"><span class="hs-identifier hs-var hs-var">checkDynamicObj</span></a></span></span><span> </span><span id="local-6989586621683156699"><span class="annot"><span class="annottext">IO (MaybeValidated Linkable)
</span><a href="#local-6989586621683156699"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156687"><span class="hs-identifier hs-var">dt_enabled</span></a></span><span>
</span><span id="line-935"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&gt;=)</span></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; UTCTime -&gt; Bool)
-&gt; Maybe UTCTime -&gt; Maybe (UTCTime -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621683156692"><span class="hs-identifier hs-var">mb_dyn_obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UTCTime -&gt; Bool) -&gt; Maybe UTCTime -&gt; Maybe Bool
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621683156694"><span class="hs-identifier hs-var">mb_if_date</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-936"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (MaybeValidated Linkable)
</span><a href="#local-6989586621683156699"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-937"></span><span>        </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable))
-&gt; MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecompReason -&gt; Maybe Linkable -&gt; MaybeValidated Linkable
forall a. RecompReason -&gt; Maybe a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#outOfDateItemBecause"><span class="hs-identifier hs-var">outOfDateItemBecause</span></a></span><span> </span><span class="annot"><span class="annottext">RecompReason
</span><a href="GHC.Iface.Recomp.html#MissingDynObjectFile"><span class="hs-identifier hs-var">MissingDynObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-938"></span><span>      </span><span class="hs-comment">-- Not in dynamic-too mode</span><span>
</span><span id="line-939"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO (MaybeValidated Linkable)
</span><a href="#local-6989586621683156699"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>  </span><span class="annot"><span class="annottext">IO (MaybeValidated Linkable) -&gt; IO (MaybeValidated Linkable)
</span><a href="#local-6989586621683156698"><span class="hs-identifier hs-var">checkDynamicObj</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (MaybeValidated Linkable) -&gt; IO (MaybeValidated Linkable))
-&gt; IO (MaybeValidated Linkable) -&gt; IO (MaybeValidated Linkable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; UTCTime -&gt; (UTCTime, UTCTime))
-&gt; Maybe UTCTime -&gt; Maybe (UTCTime -&gt; (UTCTime, UTCTime))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621683156690"><span class="hs-identifier hs-var">mb_obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UTCTime -&gt; (UTCTime, UTCTime))
-&gt; Maybe UTCTime -&gt; Maybe (UTCTime, UTCTime)
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621683156694"><span class="hs-identifier hs-var">mb_if_date</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-943"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683156701"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156701"><span class="hs-identifier hs-var">obj_date</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156702"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156702"><span class="hs-identifier hs-var">if_date</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156701"><span class="hs-identifier hs-var">obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156702"><span class="hs-identifier hs-var">if_date</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-945"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621683156685"><span class="hs-identifier hs-var">mb_old_linkable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-946"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156703"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156703"><span class="hs-identifier hs-var">old_linkable</span></a></span></span><span>
</span><span id="line-947"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; Bool
</span><a href="GHC.Linker.Types.html#linkableIsNativeCodeOnly"><span class="hs-identifier hs-var">linkableIsNativeCodeOnly</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156703"><span class="hs-identifier hs-var">old_linkable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; UTCTime
</span><a href="GHC.Linker.Types.html#linkableTime"><span class="hs-identifier hs-var">linkableTime</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156703"><span class="hs-identifier hs-var">old_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156701"><span class="hs-identifier hs-var">obj_date</span></a></span><span>
</span><span id="line-948"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable))
-&gt; MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; MaybeValidated Linkable
forall a. a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-var">UpToDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156703"><span class="hs-identifier hs-var">old_linkable</span></a></span><span>
</span><span id="line-949"></span><span>              </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; MaybeValidated Linkable
forall a. a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-var">UpToDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">(Linkable -&gt; MaybeValidated Linkable)
-&gt; IO Linkable -&gt; IO (MaybeValidated Linkable)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Char] -&gt; UTCTime -&gt; IO Linkable
</span><a href="GHC.Unit.Finder.html#findObjectLinkable"><span class="hs-identifier hs-var">findObjectLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156689"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156696"><span class="hs-identifier hs-var">obj_fn</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156701"><span class="hs-identifier hs-var">obj_date</span></a></span><span>
</span><span id="line-950"></span><span>      </span><span class="annot"><span class="annottext">Maybe (UTCTime, UTCTime)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable))
-&gt; MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecompReason -&gt; Maybe Linkable -&gt; MaybeValidated Linkable
forall a. RecompReason -&gt; Maybe a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#outOfDateItemBecause"><span class="hs-identifier hs-var">outOfDateItemBecause</span></a></span><span> </span><span class="annot"><span class="annottext">RecompReason
</span><a href="GHC.Iface.Recomp.html#MissingObjectFile"><span class="hs-identifier hs-var">MissingObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span class="hs-comment">-- | Check to see if we can reuse the old linkable, by this point we will</span><span>
</span><span id="line-953"></span><span class="hs-comment">-- have just checked that the old interface matches up with the source hash, so</span><span>
</span><span id="line-954"></span><span class="hs-comment">-- no need to check that again here</span><span>
</span><span id="line-955"></span><span class="annot"><a href="GHC.Driver.Main.html#checkByteCode"><span class="hs-identifier hs-type">checkByteCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Recomp.html#MaybeValidated"><span class="hs-identifier hs-type">MaybeValidated</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span id="checkByteCode"><span class="annot"><span class="annottext">checkByteCode :: ModIface
-&gt; ModSummary -&gt; Maybe Linkable -&gt; IO (MaybeValidated Linkable)
</span><a href="GHC.Driver.Main.html#checkByteCode"><span class="hs-identifier hs-var hs-var">checkByteCode</span></a></span></span><span> </span><span id="local-6989586621683156708"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156708"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683156709"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156709"><span class="hs-identifier hs-var">mod_sum</span></a></span></span><span> </span><span id="local-6989586621683156710"><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621683156710"><span class="hs-identifier hs-var">mb_old_linkable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621683156710"><span class="hs-identifier hs-var">mb_old_linkable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-958"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156711"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156711"><span class="hs-identifier hs-var">old_linkable</span></a></span></span><span>
</span><span id="line-959"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Bool
</span><a href="GHC.Linker.Types.html#linkableIsNativeCodeOnly"><span class="hs-identifier hs-var">linkableIsNativeCodeOnly</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156711"><span class="hs-identifier hs-var">old_linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable))
-&gt; MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; MaybeValidated Linkable
forall a. a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-var">UpToDateItem</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621683156711"><span class="hs-identifier hs-var">old_linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>    </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModSummary -&gt; IO (MaybeValidated Linkable)
</span><a href="GHC.Driver.Main.html#loadByteCode"><span class="hs-identifier hs-var">loadByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156708"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156709"><span class="hs-identifier hs-var">mod_sum</span></a></span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span class="annot"><a href="GHC.Driver.Main.html#loadByteCode"><span class="hs-identifier hs-type">loadByteCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Recomp.html#MaybeValidated"><span class="hs-identifier hs-type">MaybeValidated</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span id="loadByteCode"><span class="annot"><span class="annottext">loadByteCode :: ModIface -&gt; ModSummary -&gt; IO (MaybeValidated Linkable)
</span><a href="GHC.Driver.Main.html#loadByteCode"><span class="hs-identifier hs-var hs-var">loadByteCode</span></a></span></span><span> </span><span id="local-6989586621683156712"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156712"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683156713"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156713"><span class="hs-identifier hs-var">mod_sum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-966"></span><span>      </span><span id="local-6989586621683156714"><span class="annot"><span class="annottext">this_mod :: Module
</span><a href="#local-6989586621683156714"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156713"><span class="hs-identifier hs-var">mod_sum</span></a></span><span>
</span><span id="line-967"></span><span>      </span><span id="local-6989586621683156715"><span class="annot"><span class="annottext">if_date :: UTCTime
</span><a href="#local-6989586621683156715"><span class="hs-identifier hs-var hs-var">if_date</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; UTCTime
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe UTCTime -&gt; UTCTime) -&gt; Maybe UTCTime -&gt; UTCTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156713"><span class="hs-identifier hs-var">mod_sum</span></a></span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
forall (phase :: ModIfacePhase).
ModIface_ phase
-&gt; Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="GHC.Unit.Module.ModIface.html#mi_extra_decls"><span class="hs-identifier hs-var">mi_extra_decls</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156712"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-969"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156717"><span class="annot"><span class="annottext">[IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="#local-6989586621683156717"><span class="hs-identifier hs-var">extra_decls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-970"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156718"><span class="annot"><span class="annottext">fi :: WholeCoreBindings
</span><a href="#local-6989586621683156718"><span class="hs-identifier hs-var hs-var">fi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
-&gt; Module -&gt; ModLocation -&gt; IfaceForeign -&gt; WholeCoreBindings
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#WholeCoreBindings"><span class="hs-identifier hs-var">WholeCoreBindings</span></a></span><span> </span><span class="annot"><span class="annottext">[IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="#local-6989586621683156717"><span class="hs-identifier hs-var">extra_decls</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156714"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156713"><span class="hs-identifier hs-var">mod_sum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfaceForeign
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; IfaceForeign
</span><a href="GHC.Unit.Module.ModIface.html#mi_foreign"><span class="hs-identifier hs-var">mi_foreign</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156712"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-972"></span><span>          </span><span class="annot"><span class="annottext">MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; MaybeValidated Linkable
forall a. a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#UpToDateItem"><span class="hs-identifier hs-var">UpToDateItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; Module -&gt; NonEmpty LinkablePart -&gt; Linkable
</span><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-var">Linkable</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156715"><span class="hs-identifier hs-var">if_date</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156714"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkablePart -&gt; NonEmpty LinkablePart
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WholeCoreBindings -&gt; LinkablePart
</span><a href="GHC.Linker.Types.html#CoreBindings"><span class="hs-identifier hs-var">CoreBindings</span></a></span><span> </span><span class="annot"><span class="annottext">WholeCoreBindings
</span><a href="#local-6989586621683156718"><span class="hs-identifier hs-var">fi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>      </span><span class="annot"><span class="annottext">Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable))
-&gt; MaybeValidated Linkable -&gt; IO (MaybeValidated Linkable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecompReason -&gt; Maybe Linkable -&gt; MaybeValidated Linkable
forall a. RecompReason -&gt; Maybe a -&gt; MaybeValidated a
</span><a href="GHC.Iface.Recomp.html#outOfDateItemBecause"><span class="hs-identifier hs-var">outOfDateItemBecause</span></a></span><span> </span><span class="annot"><span class="annottext">RecompReason
</span><a href="GHC.Iface.Recomp.html#MissingBytecode"><span class="hs-identifier hs-var">MissingBytecode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-976"></span><span class="hs-comment">-- Compilers</span><span>
</span><span id="line-977"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span class="annot"><a href="GHC.Driver.Main.html#add_iface_to_hpt"><span class="hs-identifier hs-type">add_iface_to_hpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-980"></span><span id="add_iface_to_hpt"><span class="annot"><span class="annottext">add_iface_to_hpt :: ModIface -&gt; ModDetails -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Main.html#add_iface_to_hpt"><span class="hs-identifier hs-var hs-var">add_iface_to_hpt</span></a></span></span><span> </span><span id="local-6989586621683156725"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156725"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683156726"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156726"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-981"></span><span>  </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHPT"><span class="hs-identifier hs-var">hscUpdateHPT</span></a></span><span> </span><span class="annot"><span class="annottext">((HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv)
-&gt; (HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683156728"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621683156728"><span class="hs-identifier hs-var">hpt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-982"></span><span>    </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomeModInfo -&gt; HomePackageTable
</span><a href="GHC.Unit.Home.ModInfo.html#addToHpt"><span class="hs-identifier hs-var">addToHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621683156728"><span class="hs-identifier hs-var">hpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156725"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HomeModLinkable -&gt; HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156725"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156726"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span class="hs-comment">-- Knot tying!  See Note [Knot-tying typecheckIface]</span><span>
</span><span id="line-986"></span><span class="hs-comment">-- See Note [ModDetails and --make mode]</span><span>
</span><span id="line-987"></span><span class="annot"><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier hs-type">initModDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-988"></span><span id="initModDetails"><span class="annot"><span class="annottext">initModDetails :: HscEnv -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier hs-var hs-var">initModDetails</span></a></span></span><span> </span><span id="local-6989586621683156732"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156732"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156733"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156733"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-989"></span><span>  </span><span class="annot"><span class="annottext">(ModDetails -&gt; IO ModDetails) -&gt; IO ModDetails
forall a. (a -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">fixIO</span></span><span> </span><span class="annot"><span class="annottext">((ModDetails -&gt; IO ModDetails) -&gt; IO ModDetails)
-&gt; (ModDetails -&gt; IO ModDetails) -&gt; IO ModDetails
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683156735"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156735"><span class="hs-identifier hs-var">details'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-990"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683156736"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621683156736"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Main.html#add_iface_to_hpt"><span class="hs-identifier hs-var">add_iface_to_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156733"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156735"><span class="hs-identifier hs-var">details'</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156732"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-991"></span><span>    </span><span class="hs-comment">-- NB: This result is actually not that useful</span><span>
</span><span id="line-992"></span><span>    </span><span class="hs-comment">-- in one-shot mode, since we're not going to do</span><span>
</span><span id="line-993"></span><span>    </span><span class="hs-comment">-- any further typechecking.  It's much more useful</span><span>
</span><span id="line-994"></span><span>    </span><span class="hs-comment">-- in make mode, since this HMI will go into the HPT.</span><span>
</span><span id="line-995"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#genModDetails"><span class="hs-identifier hs-var">genModDetails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156736"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156733"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span class="hs-comment">-- | Modify flags such that objects are compiled for the interpreter's way.</span><span>
</span><span id="line-998"></span><span class="hs-comment">-- This is necessary when building foreign objects for Template Haskell, since</span><span>
</span><span id="line-999"></span><span class="hs-comment">-- those are object code built outside of the pipeline, which means they aren't</span><span>
</span><span id="line-1000"></span><span class="hs-comment">-- subject to the mechanism in 'enableCodeGenWhen' that requests dynamic build</span><span>
</span><span id="line-1001"></span><span class="hs-comment">-- outputs for dependencies when the interpreter used for TH is dynamic but the</span><span>
</span><span id="line-1002"></span><span class="hs-comment">-- main outputs aren't.</span><span>
</span><span id="line-1003"></span><span class="hs-comment">-- Furthermore, the HPT only stores one set of objects with different names for</span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- bytecode linking in 'HomeModLinkable', so the usual hack for switching</span><span>
</span><span id="line-1005"></span><span class="hs-comment">-- between ways in 'get_link_deps' doesn't work.</span><span>
</span><span id="line-1006"></span><span id="local-6989586621683154796"><span class="annot"><a href="GHC.Driver.Main.html#compile_for_interpreter"><span class="hs-identifier hs-type">compile_for_interpreter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683154796"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683154796"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1007"></span><span id="compile_for_interpreter"><span class="annot"><span class="annottext">compile_for_interpreter :: forall a. HscEnv -&gt; (HscEnv -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Main.html#compile_for_interpreter"><span class="hs-identifier hs-var hs-var">compile_for_interpreter</span></a></span></span><span> </span><span id="local-6989586621683156740"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156740"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156741"><span class="annot"><span class="annottext">HscEnv -&gt; IO a
</span><a href="#local-6989586621683156741"><span class="hs-identifier hs-var">use</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1008"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; IO a
</span><a href="#local-6989586621683156741"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateFlags"><span class="hs-identifier hs-var">hscUpdateFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="#local-6989586621683156743"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156740"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1010"></span><span>    </span><span id="local-6989586621683156743"><span class="annot"><span class="annottext">update :: DynFlags -&gt; DynFlags
</span><a href="#local-6989586621683156743"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span id="local-6989586621683156744"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156744"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156744"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1011"></span><span>      </span><span class="annot"><a href="GHC.Driver.DynFlags.html#targetWays_"><span class="hs-identifier hs-var">targetWays_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156746"><span class="hs-identifier hs-type">adapt_way</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpreterDynamic"><span class="hs-identifier hs-type">interpreterDynamic</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html#WayDyn"><span class="hs-identifier hs-type">WayDyn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1012"></span><span>                    </span><span class="annot"><a href="#local-6989586621683156746"><span class="hs-identifier hs-type">adapt_way</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier hs-type">interpreterProfiled</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html#WayProf"><span class="hs-identifier hs-type">WayProf</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1013"></span><span>                    </span><span class="annot"><a href="GHC.Driver.DynFlags.html#targetWays_"><span class="hs-identifier hs-var">targetWays_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156744"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-1014"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span>    </span><span id="local-6989586621683156746"><span class="annot"><span class="annottext">adapt_way :: (Interp -&gt; Bool) -&gt; Way -&gt; Ways -&gt; Ways
</span><a href="#local-6989586621683156746"><span class="hs-identifier hs-var hs-var">adapt_way</span></a></span></span><span> </span><span id="local-6989586621683156751"><span class="annot"><span class="annottext">Interp -&gt; Bool
</span><a href="#local-6989586621683156751"><span class="hs-identifier hs-var">want</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Bool
</span><a href="#local-6989586621683156751"><span class="hs-identifier hs-var">want</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156740"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Way -&gt; Ways -&gt; Ways
</span><a href="GHC.Platform.Ways.html#addWay"><span class="hs-identifier hs-var">addWay</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Way -&gt; Ways -&gt; Ways
</span><a href="GHC.Platform.Ways.html#removeWay"><span class="hs-identifier hs-var">removeWay</span></a></span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span class="annot"><span class="hs-comment">-- | Assemble 'WholeCoreBindings' if the interface contains Core bindings.</span></span><span>
</span><span id="line-1019"></span><span class="annot"><a href="GHC.Driver.Main.html#iface_core_bindings"><span class="hs-identifier hs-type">iface_core_bindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html#WholeCoreBindings"><span class="hs-identifier hs-type">WholeCoreBindings</span></a></span><span>
</span><span id="line-1020"></span><span id="iface_core_bindings"><span class="annot"><span class="annottext">iface_core_bindings :: ModIface -&gt; ModLocation -&gt; Maybe WholeCoreBindings
</span><a href="GHC.Driver.Main.html#iface_core_bindings"><span class="hs-identifier hs-var hs-var">iface_core_bindings</span></a></span></span><span> </span><span id="local-6989586621683156756"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156756"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683156757"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156757"><span class="hs-identifier hs-var">wcb_mod_location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1021"></span><span>  </span><span class="annot"><span class="annottext">Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="#local-6989586621683156758"><span class="hs-identifier hs-var">mi_extra_decls</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
-&gt; ([IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
    -&gt; WholeCoreBindings)
-&gt; Maybe WholeCoreBindings
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683156759"><span class="annot"><span class="annottext">[IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="#local-6989586621683156759"><span class="hs-identifier hs-var">wcb_bindings</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1022"></span><span>    </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html#WholeCoreBindings"><span class="hs-identifier hs-type">WholeCoreBindings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1023"></span><span>      </span><span class="annot"><span class="annottext">[IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
wcb_bindings :: [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
wcb_bindings :: [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="#local-6989586621683156759"><span class="hs-identifier hs-var hs-var">wcb_bindings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1024"></span><span>      </span><span class="annot"><span class="annottext">wcb_module :: Module
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#wcb_module"><span class="hs-identifier hs-var">wcb_module</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156762"><span class="hs-identifier hs-var">mi_module</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1025"></span><span>      </span><span class="annot"><span class="annottext">ModLocation
wcb_mod_location :: ModLocation
wcb_mod_location :: ModLocation
</span><a href="#local-6989586621683156757"><span class="hs-identifier hs-var hs-var">wcb_mod_location</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1026"></span><span>      </span><span class="annot"><span class="annottext">wcb_foreign :: IfaceForeign
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#wcb_foreign"><span class="hs-identifier hs-var">wcb_foreign</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceForeign
</span><a href="#local-6989586621683156765"><span class="hs-identifier hs-var">mi_foreign</span></a></span><span>
</span><span id="line-1027"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1029"></span><span>    </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621683156762"><span class="annot"><span class="annottext">Module
mi_module :: forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
mi_module :: Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var hs-var">mi_module</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156758"><span class="annot"><span class="annottext">Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
mi_extra_decls :: forall (phase :: ModIfacePhase).
ModIface_ phase
-&gt; Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
mi_extra_decls :: Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="GHC.Unit.Module.ModIface.html#mi_extra_decls"><span class="hs-identifier hs-var hs-var">mi_extra_decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156765"><span class="annot"><span class="annottext">IfaceForeign
mi_foreign :: forall (phase :: ModIfacePhase). ModIface_ phase -&gt; IfaceForeign
mi_foreign :: IfaceForeign
</span><a href="GHC.Unit.Module.ModIface.html#mi_foreign"><span class="hs-identifier hs-var hs-var">mi_foreign</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156756"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span class="hs-comment">-- | Return an 'IO' that hydrates Core bindings and compiles them to bytecode if</span><span>
</span><span id="line-1032"></span><span class="hs-comment">-- the interface contains any, using the supplied type env for typechecking.</span><span>
</span><span id="line-1033"></span><span class="hs-comment">--</span><span>
</span><span id="line-1034"></span><span class="hs-comment">-- Unlike 'initWholeCoreBindings', this does not use lazy IO.</span><span>
</span><span id="line-1035"></span><span class="hs-comment">-- Instead, the 'IO' is only evaluated (in @get_link_deps@) when it is clear</span><span>
</span><span id="line-1036"></span><span class="hs-comment">-- that it will be used immediately (because we're linking TH with</span><span>
</span><span id="line-1037"></span><span class="hs-comment">-- @-fprefer-byte-code@ in oneshot mode), and the result is cached in</span><span>
</span><span id="line-1038"></span><span class="hs-comment">-- 'LoaderState'.</span><span>
</span><span id="line-1039"></span><span class="hs-comment">--</span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- 'initWholeCoreBindings' needs the laziness because it is used to populate</span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- 'HomeModInfo', which is done preemptively, in anticipation of downstream</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- modules using the bytecode for TH in make mode, which might never happen.</span><span>
</span><span id="line-1043"></span><span class="annot"><a href="GHC.Driver.Main.html#loadIfaceByteCode"><span class="hs-identifier hs-type">loadIfaceByteCode</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1044"></span><span>  </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1045"></span><span>  </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1046"></span><span>  </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1047"></span><span>  </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1048"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span id="loadIfaceByteCode"><span class="annot"><span class="annottext">loadIfaceByteCode :: HscEnv -&gt; ModIface -&gt; ModLocation -&gt; TypeEnv -&gt; Maybe (IO Linkable)
</span><a href="GHC.Driver.Main.html#loadIfaceByteCode"><span class="hs-identifier hs-var hs-var">loadIfaceByteCode</span></a></span></span><span> </span><span id="local-6989586621683156768"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156768"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156769"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156769"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683156770"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156770"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621683156771"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683156771"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1050"></span><span>  </span><span class="annot"><span class="annottext">WholeCoreBindings -&gt; IO Linkable
</span><a href="#local-6989586621683156772"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">(WholeCoreBindings -&gt; IO Linkable)
-&gt; Maybe WholeCoreBindings -&gt; Maybe (IO Linkable)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModLocation -&gt; Maybe WholeCoreBindings
</span><a href="GHC.Driver.Main.html#iface_core_bindings"><span class="hs-identifier hs-var">iface_core_bindings</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156769"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156770"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1051"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1052"></span><span>    </span><span id="local-6989586621683156772"><span class="annot"><span class="annottext">compile :: WholeCoreBindings -&gt; IO Linkable
</span><a href="#local-6989586621683156772"><span class="hs-identifier hs-var hs-var">compile</span></a></span></span><span> </span><span id="local-6989586621683156773"><span class="annot"><span class="annottext">WholeCoreBindings
</span><a href="#local-6989586621683156773"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1053"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683156774"><span class="annot"><a href="#local-6989586621683156774"><span class="hs-identifier hs-var">bcos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156775"><span class="annot"><a href="#local-6989586621683156775"><span class="hs-identifier hs-var">fos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; TypeEnv -&gt; WholeCoreBindings -&gt; IO (CompiledByteCode, [[Char]])
</span><a href="GHC.Driver.Main.html#compileWholeCoreBindings"><span class="hs-identifier hs-var">compileWholeCoreBindings</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156768"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683156771"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">WholeCoreBindings
</span><a href="#local-6989586621683156773"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-1054"></span><span>      </span><span class="annot"><a href="#local-6989586621683156777"><span class="hs-identifier hs-type">linkable</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#BCOs"><span class="hs-identifier hs-type">BCOs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156774"><span class="hs-identifier hs-type">bcos</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#DotO"><span class="hs-identifier hs-type">DotO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156780"><span class="hs-identifier hs-type">fo</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#ForeignObject"><span class="hs-identifier hs-type">ForeignObject</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683156780"><span class="annot"><a href="#local-6989586621683156780"><span class="hs-identifier hs-var">fo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683156775"><span class="hs-identifier hs-type">fos</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>    </span><span id="local-6989586621683156777"><span class="annot"><span class="annottext">linkable :: NonEmpty LinkablePart -&gt; IO Linkable
</span><a href="#local-6989586621683156777"><span class="hs-identifier hs-var hs-var">linkable</span></a></span></span><span> </span><span id="local-6989586621683156782"><span class="annot"><span class="annottext">NonEmpty LinkablePart
</span><a href="#local-6989586621683156782"><span class="hs-identifier hs-var">parts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1057"></span><span>      </span><span id="local-6989586621683156783"><span class="annot"><a href="#local-6989586621683156783"><span class="hs-identifier hs-var">if_time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156770"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1058"></span><span>      </span><span id="local-6989586621683156786"><span class="annot"><a href="#local-6989586621683156786"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="annot"><a href="../../time-1.14-9bf8/src/Data.Time.Clock.POSIX.html#getCurrentTime"><span class="hs-identifier hs-type">getCurrentTime</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621683156783"><span class="hs-identifier hs-type">if_time</span></a></span><span>
</span><span id="line-1059"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156786"><span class="hs-identifier hs-type">time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156769"><span class="hs-identifier hs-type">iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156782"><span class="hs-identifier hs-type">parts</span></a></span><span>
</span><span id="line-1060"></span><span>
</span><span id="line-1061"></span><span class="hs-comment">-- | If the 'Linkable' contains Core bindings loaded from an interface, replace</span><span>
</span><span id="line-1062"></span><span class="hs-comment">-- them with a lazy IO thunk that compiles them to bytecode and foreign objects,</span><span>
</span><span id="line-1063"></span><span class="hs-comment">-- using the supplied environment for type checking.</span><span>
</span><span id="line-1064"></span><span class="hs-comment">--</span><span>
</span><span id="line-1065"></span><span class="hs-comment">-- The laziness is necessary because this value is stored purely in a</span><span>
</span><span id="line-1066"></span><span class="hs-comment">-- 'HomeModLinkable' in the home package table, rather than some dedicated</span><span>
</span><span id="line-1067"></span><span class="hs-comment">-- mutable state that would generate bytecode on demand, so we have to call this</span><span>
</span><span id="line-1068"></span><span class="hs-comment">-- function even when we don't know that we'll need the bytecode.</span><span>
</span><span id="line-1069"></span><span class="hs-comment">--</span><span>
</span><span id="line-1070"></span><span class="hs-comment">-- In addition, the laziness has to be hidden inside 'LazyBCOs' because</span><span>
</span><span id="line-1071"></span><span class="hs-comment">-- 'Linkable' is used too generally, so that looking at the constructor to</span><span>
</span><span id="line-1072"></span><span class="hs-comment">-- decide whether to discard it when linking native code would force the thunk</span><span>
</span><span id="line-1073"></span><span class="hs-comment">-- otherwise, incurring a significant performance penalty.</span><span>
</span><span id="line-1074"></span><span class="hs-comment">--</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- This is sound because generateByteCode just depends on things already loaded</span><span>
</span><span id="line-1076"></span><span class="hs-comment">-- in the interface file.</span><span>
</span><span id="line-1077"></span><span class="annot"><a href="GHC.Driver.Main.html#initWholeCoreBindings"><span class="hs-identifier hs-type">initWholeCoreBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1078"></span><span>  </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1079"></span><span>  </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1080"></span><span>  </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1081"></span><span>  </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1082"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span>
</span><span id="line-1083"></span><span id="initWholeCoreBindings"><span class="annot"><span class="annottext">initWholeCoreBindings :: HscEnv -&gt; ModIface -&gt; ModDetails -&gt; Linkable -&gt; IO Linkable
</span><a href="GHC.Driver.Main.html#initWholeCoreBindings"><span class="hs-identifier hs-var hs-var">initWholeCoreBindings</span></a></span></span><span> </span><span id="local-6989586621683156791"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156791"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156792"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156792"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683156793"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156793"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span id="local-6989586621683156794"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156794"><span class="hs-identifier hs-var">utc_time</span></a></span></span><span> </span><span id="local-6989586621683156795"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156795"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621683156796"><span class="annot"><span class="annottext">NonEmpty LinkablePart
</span><a href="#local-6989586621683156796"><span class="hs-identifier hs-var">uls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1084"></span><span>  </span><span class="annot"><span class="annottext">UTCTime -&gt; Module -&gt; NonEmpty LinkablePart -&gt; Linkable
</span><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-var">Linkable</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621683156794"><span class="hs-identifier hs-var">utc_time</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156795"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty LinkablePart -&gt; Linkable)
-&gt; IO (NonEmpty LinkablePart) -&gt; IO Linkable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(LinkablePart -&gt; IO LinkablePart)
-&gt; NonEmpty LinkablePart -&gt; IO (NonEmpty LinkablePart)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; NonEmpty a -&gt; m (NonEmpty b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">LinkablePart -&gt; IO LinkablePart
</span><a href="#local-6989586621683156798"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty LinkablePart
</span><a href="#local-6989586621683156796"><span class="hs-identifier hs-var">uls</span></a></span><span>
</span><span id="line-1085"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1086"></span><span>    </span><span id="local-6989586621683156798"><span class="annot"><span class="annottext">go :: LinkablePart -&gt; IO LinkablePart
</span><a href="#local-6989586621683156798"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1087"></span><span>      </span><span class="annot"><a href="GHC.Linker.Types.html#CoreBindings"><span class="hs-identifier hs-type">CoreBindings</span></a></span><span> </span><span id="local-6989586621683156799"><span class="annot"><span class="annottext">WholeCoreBindings
</span><a href="#local-6989586621683156799"><span class="hs-identifier hs-var">wcb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1088"></span><span>        </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span id="local-6989586621683156800"><span class="annot"><a href="#local-6989586621683156800"><span class="hs-identifier hs-var">bco</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156801"><span class="annot"><a href="#local-6989586621683156801"><span class="hs-identifier hs-var">fos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (CompiledByteCode, [[Char]]) -&gt; IO (CompiledByteCode, [[Char]])
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">unsafeInterleaveIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (CompiledByteCode, [[Char]])
 -&gt; IO (CompiledByteCode, [[Char]]))
-&gt; IO (CompiledByteCode, [[Char]])
-&gt; IO (CompiledByteCode, [[Char]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1089"></span><span>                       </span><span class="annot"><span class="annottext">HscEnv
-&gt; TypeEnv -&gt; WholeCoreBindings -&gt; IO (CompiledByteCode, [[Char]])
</span><a href="GHC.Driver.Main.html#compileWholeCoreBindings"><span class="hs-identifier hs-var">compileWholeCoreBindings</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156802"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683156803"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">WholeCoreBindings
</span><a href="#local-6989586621683156799"><span class="hs-identifier hs-var">wcb</span></a></span><span>
</span><span id="line-1090"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Types.html#LazyBCOs"><span class="hs-identifier hs-type">LazyBCOs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156800"><span class="hs-identifier hs-type">bco</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156801"><span class="hs-identifier hs-type">fos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>      </span><span id="local-6989586621683156804"><span class="annot"><span class="annottext">LinkablePart
</span><a href="#local-6989586621683156804"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LinkablePart -&gt; IO LinkablePart
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LinkablePart
</span><a href="#local-6989586621683156804"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span>    </span><span id="local-6989586621683156802"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621683156802"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Main.html#add_iface_to_hpt"><span class="hs-identifier hs-var">add_iface_to_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156792"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156793"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156791"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1094"></span><span>    </span><span id="local-6989586621683156803"><span class="annot"><span class="annottext">type_env :: TypeEnv
</span><a href="#local-6989586621683156803"><span class="hs-identifier hs-var hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModDetails -&gt; TypeEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_types"><span class="hs-identifier hs-var">md_types</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156793"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span class="hs-comment">-- | Hydrate interface Core bindings and compile them to bytecode.</span><span>
</span><span id="line-1097"></span><span class="hs-comment">--</span><span>
</span><span id="line-1098"></span><span class="hs-comment">-- This consists of:</span><span>
</span><span id="line-1099"></span><span class="hs-comment">--</span><span>
</span><span id="line-1100"></span><span class="hs-comment">-- 1. Running a typechecking step to insert the global names that were removed</span><span>
</span><span id="line-1101"></span><span class="hs-comment">--    when the interface was written or were unavailable due to boot import</span><span>
</span><span id="line-1102"></span><span class="hs-comment">--    cycles, converting the bindings to 'CoreBind'.</span><span>
</span><span id="line-1103"></span><span class="hs-comment">--</span><span>
</span><span id="line-1104"></span><span class="hs-comment">-- 2. Restoring the foreign build inputs from their serialized format, resulting</span><span>
</span><span id="line-1105"></span><span class="hs-comment">--    in a set of foreign import stubs and source files added via</span><span>
</span><span id="line-1106"></span><span class="hs-comment">--    'qAddForeignFilePath'.</span><span>
</span><span id="line-1107"></span><span class="hs-comment">--</span><span>
</span><span id="line-1108"></span><span class="hs-comment">-- 3. Generating bytecode and foreign objects from the results of the previous</span><span>
</span><span id="line-1109"></span><span class="hs-comment">--    steps using the usual pipeline actions.</span><span>
</span><span id="line-1110"></span><span class="annot"><a href="GHC.Driver.Main.html#compileWholeCoreBindings"><span class="hs-identifier hs-type">compileWholeCoreBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1111"></span><span>  </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1112"></span><span>  </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1113"></span><span>  </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html#WholeCoreBindings"><span class="hs-identifier hs-type">WholeCoreBindings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1114"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span id="compileWholeCoreBindings"><span class="annot"><span class="annottext">compileWholeCoreBindings :: HscEnv
-&gt; TypeEnv -&gt; WholeCoreBindings -&gt; IO (CompiledByteCode, [[Char]])
</span><a href="GHC.Driver.Main.html#compileWholeCoreBindings"><span class="hs-identifier hs-var hs-var">compileWholeCoreBindings</span></a></span></span><span> </span><span id="local-6989586621683156806"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156806"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156807"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683156807"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621683156808"><span class="annot"><span class="annottext">WholeCoreBindings
</span><a href="#local-6989586621683156808"><span class="hs-identifier hs-var">wcb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1116"></span><span>  </span><span id="local-6989586621683156809"><span class="annot"><a href="#local-6989586621683156809"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CoreProgram
</span><a href="#local-6989586621683156810"><span class="hs-identifier hs-var">typecheck</span></a></span><span>
</span><span id="line-1117"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683156811"><span class="annot"><a href="#local-6989586621683156811"><span class="hs-identifier hs-var">stubs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156812"><span class="annot"><a href="#local-6989586621683156812"><span class="hs-identifier hs-var">foreign_files</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683156813"><span class="hs-identifier hs-type">decode_foreign</span></a></span><span>
</span><span id="line-1118"></span><span>  </span><span class="annot"><a href="#local-6989586621683156814"><span class="hs-identifier hs-type">gen_bytecode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156809"><span class="hs-identifier hs-type">core_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156811"><span class="hs-identifier hs-type">stubs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156812"><span class="hs-identifier hs-type">foreign_files</span></a></span><span>
</span><span id="line-1119"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1120"></span><span>    </span><span id="local-6989586621683156810"><span class="annot"><span class="annottext">typecheck :: IO CoreProgram
</span><a href="#local-6989586621683156810"><span class="hs-identifier hs-var hs-var">typecheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1121"></span><span>      </span><span id="local-6989586621683156815"><span class="annot"><a href="#local-6989586621683156815"><span class="hs-identifier hs-var">types_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; IO (IORef TypeEnv)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683156807"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-1122"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-1123"></span><span>        </span><span id="local-6989586621683156817"><span class="annot"><a href="#local-6989586621683156817"><span class="hs-identifier hs-var hs-var">tc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156806"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1124"></span><span>          </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1125"></span><span>            </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html#knotVarsFromModuleEnv"><span class="hs-identifier hs-type">knotVarsFromModuleEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Env.html#mkModuleEnv"><span class="hs-identifier hs-type">mkModuleEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683156820"><span class="hs-identifier hs-type">wcb_module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683156815"><span class="hs-identifier hs-type">types_var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1127"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier hs-type">initIfaceCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;l&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156817"><span class="hs-identifier hs-type">tc_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1128"></span><span>        </span><span class="annot"><a href="GHC.IfaceToCore.html#typecheckWholeCoreBindings"><span class="hs-identifier hs-type">typecheckWholeCoreBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156815"><span class="hs-identifier hs-type">types_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156808"><span class="hs-identifier hs-type">wcb</span></a></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span>    </span><span id="local-6989586621683156813"><span class="annot"><span class="annottext">decode_foreign :: IO (ForeignStubs, [(ForeignSrcLang, [Char])])
</span><a href="#local-6989586621683156813"><span class="hs-identifier hs-var hs-var">decode_foreign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1131"></span><span>      </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs
-&gt; TempDir
-&gt; IfaceForeign
-&gt; IO (ForeignStubs, [(ForeignSrcLang, [Char])])
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#decodeIfaceForeign"><span class="hs-identifier hs-var">decodeIfaceForeign</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156823"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156806"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1132"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156806"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfaceForeign
</span><a href="#local-6989586621683156824"><span class="hs-identifier hs-var">wcb_foreign</span></a></span><span>
</span><span id="line-1133"></span><span>
</span><span id="line-1134"></span><span>    </span><span id="local-6989586621683156814"><span class="annot"><span class="annottext">gen_bytecode :: CoreProgram
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, [Char])]
-&gt; IO (CompiledByteCode, [[Char]])
</span><a href="#local-6989586621683156814"><span class="hs-identifier hs-var hs-var">gen_bytecode</span></a></span></span><span> </span><span id="local-6989586621683156825"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683156825"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span> </span><span id="local-6989586621683156826"><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683156826"><span class="hs-identifier hs-var">stubs</span></a></span></span><span> </span><span id="local-6989586621683156827"><span class="annot"><span class="annottext">[(ForeignSrcLang, [Char])]
</span><a href="#local-6989586621683156827"><span class="hs-identifier hs-var">foreign_files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1135"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156828"><span class="annot"><span class="annottext">cgi_guts :: CgInteractiveGuts
</span><a href="#local-6989586621683156828"><span class="hs-identifier hs-var hs-var hs-var">cgi_guts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
-&gt; CoreProgram
-&gt; [TyCon]
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, [Char])]
-&gt; Maybe ModBreaks
-&gt; [SptEntry]
-&gt; CgInteractiveGuts
</span><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-var">CgInteractiveGuts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156820"><span class="hs-identifier hs-var">wcb_module</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683156825"><span class="hs-identifier hs-var">core_binds</span></a></span><span>
</span><span id="line-1136"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeEnv -&gt; [TyCon]
</span><a href="GHC.Types.TypeEnv.html#typeEnvTyCons"><span class="hs-identifier hs-var">typeEnvTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683156807"><span class="hs-identifier hs-var">type_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683156826"><span class="hs-identifier hs-var">stubs</span></a></span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, [Char])]
</span><a href="#local-6989586621683156827"><span class="hs-identifier hs-var">foreign_files</span></a></span><span>
</span><span id="line-1137"></span><span>                      </span><span class="annot"><span class="annottext">Maybe ModBreaks
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1138"></span><span>      </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Iface.Env.html#trace_if"><span class="hs-identifier hs-var">trace_if</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156823"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Generating ByteCode for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683156820"><span class="hs-identifier hs-var">wcb_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1139"></span><span>      </span><span class="annot"><span class="annottext">HscEnv
-&gt; CgInteractiveGuts
-&gt; ModLocation
-&gt; IO (CompiledByteCode, [[Char]])
</span><a href="GHC.Driver.Main.html#generateByteCode"><span class="hs-identifier hs-var">generateByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156806"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">CgInteractiveGuts
</span><a href="#local-6989586621683156828"><span class="hs-identifier hs-var">cgi_guts</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156831"><span class="hs-identifier hs-var">wcb_mod_location</span></a></span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>    </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html#WholeCoreBindings"><span class="hs-identifier hs-type">WholeCoreBindings</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621683156820"><span class="annot"><span class="annottext">Module
wcb_module :: WholeCoreBindings -&gt; Module
wcb_module :: Module
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#wcb_module"><span class="hs-identifier hs-var hs-var">wcb_module</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156831"><span class="annot"><span class="annottext">ModLocation
wcb_mod_location :: WholeCoreBindings -&gt; ModLocation
wcb_mod_location :: ModLocation
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#wcb_mod_location"><span class="hs-identifier hs-var hs-var">wcb_mod_location</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156824"><span class="annot"><span class="annottext">IfaceForeign
wcb_foreign :: WholeCoreBindings -&gt; IfaceForeign
wcb_foreign :: IfaceForeign
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#wcb_foreign"><span class="hs-identifier hs-var hs-var">wcb_foreign</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WholeCoreBindings
</span><a href="#local-6989586621683156808"><span class="hs-identifier hs-var">wcb</span></a></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>    </span><span id="local-6989586621683156823"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683156823"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156806"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span class="hs-comment">{-
Note [ModDetails and --make mode]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
An interface file consists of two parts

* The `ModIface` which ends up getting written to disk.
  The `ModIface` is a completely acyclic tree, which can be serialised
  and de-serialised completely straightforwardly.  The `ModIface` is
  also the structure that is finger-printed for recompilation control.

* The `ModDetails` which provides a more structured view that is suitable
  for usage during compilation.  The `ModDetails` is heavily cyclic:
  An `Id` contains a `Type`, which mentions a `TyCon` that contains kind
  that mentions other `TyCons`; the `Id` also includes an unfolding that
  in turn mentions more `Id`s;  And so on.

The `ModIface` can be created from the `ModDetails` and the `ModDetails` from
a `ModIface`.

During tidying, just before interfaces are written to disk,
the ModDetails is calculated and then converted into a ModIface (see GHC.Iface.Make.mkIface_).
Then when GHC needs to restart typechecking from a certain point it can read the
interface file, and regenerate the ModDetails from the ModIface (see GHC.IfaceToCore.typecheckIface).
The key part about the loading is that the ModDetails is regenerated lazily
from the ModIface, so that there's only a detailed in-memory representation
for declarations which are actually used from the interface. This mode is
also used when reading interface files from external packages.

In the old --make mode implementation, the interface was written after compiling a module
but the in-memory ModDetails which was used to compute the ModIface was retained.
The result was that --make mode used much more memory than `-c` mode, because a large amount of
information about a module would be kept in the ModDetails but never used.

The new idea is that even in `--make` mode, when there is an in-memory `ModDetails`
at hand, we re-create the `ModDetails` from the `ModIface`. Doing this means that
we only have to keep the `ModIface` decls in memory and then lazily load
detailed representations if needed. It turns out this makes a really big difference
to memory usage, halving maximum memory used in some cases.

See !5492 and #13586
-}</span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span class="hs-comment">-- Runs the post-typechecking frontend (desugar and simplify). We want to</span><span>
</span><span id="line-1188"></span><span class="hs-comment">-- generate most of the interface as late as possible. This gets us up-to-date</span><span>
</span><span id="line-1189"></span><span class="hs-comment">-- and good unfoldings and other info in the interface file.</span><span>
</span><span id="line-1190"></span><span class="hs-comment">--</span><span>
</span><span id="line-1191"></span><span class="hs-comment">-- We might create a interface right away, in which case we also return the</span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- updated HomeModInfo. But we might also need to run the backend first. In the</span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- later case Status will be HscRecomp and we return a function from ModIface -&gt;</span><span>
</span><span id="line-1194"></span><span class="hs-comment">-- HomeModInfo.</span><span>
</span><span id="line-1195"></span><span class="hs-comment">--</span><span>
</span><span id="line-1196"></span><span class="hs-comment">-- HscRecomp in turn will carry the information required to compute a interface</span><span>
</span><span id="line-1197"></span><span class="hs-comment">-- when passed the result of the code generator. So all this can and is done at</span><span>
</span><span id="line-1198"></span><span class="hs-comment">-- the call site of the backend code gen if it is run.</span><span>
</span><span id="line-1199"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugarAndSimplify"><span class="hs-identifier hs-type">hscDesugarAndSimplify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1200"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#FrontendResult"><span class="hs-identifier hs-type">FrontendResult</span></a></span><span>
</span><span id="line-1201"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span>
</span><span id="line-1202"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span>
</span><span id="line-1203"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscBackendAction"><span class="hs-identifier hs-type">HscBackendAction</span></a></span><span>
</span><span id="line-1204"></span><span id="hscDesugarAndSimplify"><span class="annot"><span class="annottext">hscDesugarAndSimplify :: ModSummary
-&gt; FrontendResult
-&gt; Messages GhcMessage
-&gt; Maybe Fingerprint
-&gt; Hsc HscBackendAction
</span><a href="GHC.Driver.Main.html#hscDesugarAndSimplify"><span class="hs-identifier hs-var hs-var">hscDesugarAndSimplify</span></a></span></span><span> </span><span id="local-6989586621683156832"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156832"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#FrontendTypecheck"><span class="hs-identifier hs-type">FrontendTypecheck</span></a></span><span> </span><span id="local-6989586621683156833"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156833"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683156834"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156834"><span class="hs-identifier hs-var">tc_warnings</span></a></span></span><span> </span><span id="local-6989586621683156835"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621683156835"><span class="hs-identifier hs-var">mb_old_hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1205"></span><span>  </span><span id="local-6989586621683156836"><span class="annot"><a href="#local-6989586621683156836"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1206"></span><span>  </span><span id="local-6989586621683156837"><span class="annot"><a href="#local-6989586621683156837"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-1207"></span><span>  </span><span id="local-6989586621683156838"><span class="annot"><a href="#local-6989586621683156838"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-1208"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156839"><span class="annot"><a href="#local-6989586621683156839"><span class="hs-identifier hs-var hs-var">bcknd</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156837"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1209"></span><span>      </span><span id="local-6989586621683156840"><span class="annot"><a href="#local-6989586621683156840"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156832"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1210"></span><span>      </span><span id="local-6989586621683156841"><span class="annot"><a href="#local-6989586621683156841"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156837"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1211"></span><span>      </span><span id="local-6989586621683156842"><span class="annot"><a href="#local-6989586621683156842"><span class="hs-identifier hs-var hs-var">print_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagnosticOpts GhcMessage
</span><a href="GHC.Driver.Config.Diagnostic.html#initPrintConfig"><span class="hs-identifier hs-var">initPrintConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156837"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span>  </span><span class="hs-comment">-- Desugar, if appropriate</span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1215"></span><span>  </span><span class="hs-comment">-- We usually desugar even when we are not generating code, otherwise we</span><span>
</span><span id="line-1216"></span><span>  </span><span class="hs-comment">-- would miss errors thrown by the desugaring (see #10600). The only</span><span>
</span><span id="line-1217"></span><span>  </span><span class="hs-comment">-- exceptions are when the Module is Ghc.Prim or when it is not a</span><span>
</span><span id="line-1218"></span><span>  </span><span class="hs-comment">-- HsSrcFile Module.</span><span>
</span><span id="line-1219"></span><span>  </span><span id="local-6989586621683156843"><span class="annot"><a href="#local-6989586621683156843"><span class="hs-identifier hs-var">mb_desugar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1220"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156832"><span class="hs-identifier hs-type">summary</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#gHC_PRIM"><span class="hs-identifier hs-type">gHC_PRIM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621683156840"><span class="hs-identifier hs-type">hsc_src</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-type">HsSrcFile</span></a></span><span>
</span><span id="line-1221"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-type">hscDesugar'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156832"><span class="hs-identifier hs-type">summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156833"><span class="hs-identifier hs-type">tc_result</span></a></span><span>
</span><span id="line-1222"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span>  </span><span class="hs-comment">-- Report the warnings from both typechecking and desugar together</span><span>
</span><span id="line-1225"></span><span>  </span><span id="local-6989586621683156846"><span class="annot"><a href="#local-6989586621683156846"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span>
</span><span id="line-1226"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html#printOrThrowDiagnostics"><span class="hs-identifier hs-type">printOrThrowDiagnostics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156838"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156842"><span class="hs-identifier hs-type">print_config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156841"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#unionMessages"><span class="hs-identifier hs-type">unionMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156834"><span class="hs-identifier hs-type">tc_warnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156846"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1227"></span><span>  </span><span class="annot"><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-type">clearDiagnostics</span></a></span><span>
</span><span id="line-1228"></span><span>
</span><span id="line-1229"></span><span>  </span><span class="hs-comment">-- Simplify, if appropriate, and (whether we simplified or not) generate an</span><span>
</span><span id="line-1230"></span><span>  </span><span class="hs-comment">-- interface file.</span><span>
</span><span id="line-1231"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683156843"><span class="hs-identifier hs-type">mb_desugar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1232"></span><span>      </span><span class="hs-comment">-- Just cause we desugared doesn't mean we are generating code, see above.</span><span>
</span><span id="line-1233"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156847"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683156847"><span class="hs-identifier hs-var">desugared_guts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCode"><span class="hs-identifier hs-var">backendGeneratesCode</span></a></span><span> </span><span class="annot"><span class="annottext">Backend
</span><a href="#local-6989586621683156839"><span class="hs-identifier hs-var">bcknd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1234"></span><span>          </span><span id="local-6989586621683156848"><span class="annot"><a href="#local-6989586621683156848"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [[Char]] -&gt; Hsc [[Char]]
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [[Char]] -&gt; Hsc [[Char]]) -&gt; IO [[Char]] -&gt; Hsc [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef [[Char]] -&gt; IO [[Char]]
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [[Char]]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156833"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span>          </span><span id="local-6989586621683156850"><span class="annot"><a href="#local-6989586621683156850"><span class="hs-identifier hs-var">simplified_guts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-type">hscSimplify'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156848"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156847"><span class="hs-identifier hs-type">desugared_guts</span></a></span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683156851"><span class="annot"><a href="#local-6989586621683156851"><span class="hs-identifier hs-var">cg_guts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156852"><span class="annot"><a href="#local-6989586621683156852"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1238"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTidy"><span class="hs-identifier hs-type">hscTidy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156836"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156850"><span class="hs-identifier hs-type">simplified_guts</span></a></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683156853"><span class="annot"><a href="#local-6989586621683156853"><span class="hs-identifier hs-var hs-var">partial_iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1241"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;GHC.Driver.Main.mkPartialIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1242"></span><span>                </span><span class="hs-comment">-- This `force` saves 2M residency in test T10370</span><span>
</span><span id="line-1243"></span><span>                </span><span class="hs-comment">-- See Note [Avoiding space leaks in toIface*] for details.</span><span>
</span><span id="line-1244"></span><span>                </span><span class="annot"><span class="annottext">PartialModIface -&gt; PartialModIface
forall a. NFData a =&gt; a -&gt; a
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#force"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
-&gt; CoreProgram
-&gt; ModDetails
-&gt; ModSummary
-&gt; [ImportUserSpec]
-&gt; ModGuts
-&gt; PartialModIface
</span><a href="GHC.Iface.Make.html#mkPartialIface"><span class="hs-identifier hs-var">mkPartialIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156836"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621683156851"><span class="hs-identifier hs-var">cg_guts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156852"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156832"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [ImportUserSpec]
</span><a href="GHC.Tc.Types.html#tcg_import_decls"><span class="hs-identifier hs-var">tcg_import_decls</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156833"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683156850"><span class="hs-identifier hs-var">simplified_guts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>
</span><span id="line-1246"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscRecomp"><span class="hs-identifier hs-type">HscRecomp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#hscs_guts"><span class="hs-identifier hs-var">hscs_guts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156851"><span class="hs-identifier hs-type">cg_guts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1247"></span><span>                             </span><span class="annot"><a href="GHC.Unit.Module.Status.html#hscs_mod_location"><span class="hs-identifier hs-var">hscs_mod_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156832"><span class="hs-identifier hs-type">summary</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1248"></span><span>                             </span><span class="annot"><a href="GHC.Unit.Module.Status.html#hscs_partial_iface"><span class="hs-identifier hs-var">hscs_partial_iface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156853"><span class="hs-identifier hs-type">partial_iface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1249"></span><span>                             </span><span class="annot"><a href="GHC.Unit.Module.Status.html#hscs_old_iface_hash"><span class="hs-identifier hs-var">hscs_old_iface_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683156835"><span class="hs-identifier hs-type">mb_old_hash</span></a></span><span>
</span><span id="line-1250"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-1251"></span><span>
</span><span id="line-1252"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156862"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683156862"><span class="hs-identifier hs-var">desugared_guts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteIfSimplifiedCore"><span class="hs-identifier hs-var">Opt_WriteIfSimplifiedCore</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156837"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1253"></span><span>          </span><span class="hs-comment">-- If -fno-code is enabled (hence we fall through to this case)</span><span>
</span><span id="line-1254"></span><span>          </span><span class="hs-comment">-- Running the simplifier once is necessary before doing byte code generation</span><span>
</span><span id="line-1255"></span><span>          </span><span class="hs-comment">-- in order to inline data con wrappers but we honour whatever level of simplificication the</span><span>
</span><span id="line-1256"></span><span>          </span><span class="hs-comment">-- user requested. See #22008 for some discussion.</span><span>
</span><span id="line-1257"></span><span>          </span><span id="local-6989586621683156864"><span class="annot"><a href="#local-6989586621683156864"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [[Char]] -&gt; Hsc [[Char]]
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [[Char]] -&gt; Hsc [[Char]]) -&gt; IO [[Char]] -&gt; Hsc [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef [[Char]] -&gt; IO [[Char]]
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [[Char]]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156833"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>          </span><span id="local-6989586621683156865"><span class="annot"><a href="#local-6989586621683156865"><span class="hs-identifier hs-var">simplified_guts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-type">hscSimplify'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156864"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156862"><span class="hs-identifier hs-type">desugared_guts</span></a></span><span>
</span><span id="line-1259"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683156866"><span class="annot"><a href="#local-6989586621683156866"><span class="hs-identifier hs-var">cg_guts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1260"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTidy"><span class="hs-identifier hs-type">hscTidy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156836"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156865"><span class="hs-identifier hs-type">simplified_guts</span></a></span><span>
</span><span id="line-1261"></span><span>
</span><span id="line-1262"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683156867"><span class="annot"><a href="#local-6989586621683156867"><span class="hs-identifier hs-var">iface</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156868"><span class="annot"><a href="#local-6989586621683156868"><span class="hs-identifier hs-var">_details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1263"></span><span>            </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-type">hscSimpleIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156836"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156866"><span class="hs-identifier hs-type">cg_guts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156833"><span class="hs-identifier hs-type">tc_result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156832"><span class="hs-identifier hs-type">summary</span></a></span><span>
</span><span id="line-1264"></span><span>
</span><span id="line-1265"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-type">hscMaybeWriteIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156838"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156837"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683156867"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156835"><span class="hs-identifier hs-type">mb_old_hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156832"><span class="hs-identifier hs-type">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscUpdate"><span class="hs-identifier hs-type">HscUpdate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156867"><span class="hs-identifier hs-type">iface</span></a></span><span>
</span><span id="line-1268"></span><span>
</span><span id="line-1269"></span><span>
</span><span id="line-1270"></span><span>      </span><span class="hs-comment">-- We are not generating code or writing an interface with simplified core so we can skip simplification</span><span>
</span><span id="line-1271"></span><span>      </span><span class="hs-comment">-- and generate a simple interface.</span><span>
</span><span id="line-1272"></span><span>      </span><span class="annot"><span class="annottext">Maybe ModGuts
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1273"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683156870"><span class="annot"><a href="#local-6989586621683156870"><span class="hs-identifier hs-var">iface</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156871"><span class="annot"><a href="#local-6989586621683156871"><span class="hs-identifier hs-var">_details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ModIface, ModDetails) -&gt; Hsc (ModIface, ModDetails)
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (ModIface, ModDetails) -&gt; Hsc (ModIface, ModDetails))
-&gt; IO (ModIface, ModDetails) -&gt; Hsc (ModIface, ModDetails)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1274"></span><span>          </span><span class="annot"><span class="annottext">HscEnv
-&gt; Maybe CoreProgram
-&gt; TcGblEnv
-&gt; ModSummary
-&gt; IO (ModIface, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-var">hscSimpleIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156836"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CoreProgram
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156833"><span class="hs-identifier hs-var">tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683156832"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1275"></span><span>
</span><span id="line-1276"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-type">hscMaybeWriteIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156838"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156837"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683156870"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156835"><span class="hs-identifier hs-type">mb_old_hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156832"><span class="hs-identifier hs-type">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscUpdate"><span class="hs-identifier hs-type">HscUpdate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156870"><span class="hs-identifier hs-type">iface</span></a></span><span>
</span><span id="line-1279"></span><span>
</span><span id="line-1280"></span><span class="hs-comment">{-
Note [Writing interface files]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We write one interface file per module and per compilation, except with
-dynamic-too where we write two interface files (non-dynamic and dynamic).

We can write two kinds of interfaces (see Note [Interface file stages] in
&quot;GHC.Driver.Types&quot;):

   * simple interface: interface generated after the core pipeline

   * full interface: simple interface completed with information from the
     backend

Depending on the situation, we write one or the other (using
`hscMaybeWriteIface`). We must be careful with `-dynamic-too` because only the
backend is run twice, so if we write a simple interface we need to write both
the non-dynamic and the dynamic interfaces at the same time (with the same
contents).

Cases for which we generate simple interfaces:

   * GHC.Driver.Main.hscDesugarAndSimplify: when a compilation does NOT require (re)compilation
   of the hard code

   * GHC.Driver.Pipeline.compileOne': when we run in One Shot mode and target
   bytecode (if interface writing is forced).

   * GHC.Driver.Backpack uses simple interfaces for indefinite units
   (units with module holes). It writes them indirectly by forcing the
   -fwrite-interface flag while setting backend to NoBackend.

Cases for which we generate full interfaces:

   * GHC.Driver.Pipeline.runPhase: when we must be compiling to regular hard
   code and/or require recompilation.

By default interface file names are derived from module file names by adding
suffixes. The interface file name can be overloaded with &quot;-ohi&quot;, except when
`-dynamic-too` is used.

-}</span><span>
</span><span id="line-1322"></span><span>
</span><span id="line-1323"></span><span class="annot"><span class="hs-comment">-- | Write interface files</span></span><span>
</span><span id="line-1324"></span><span class="annot"><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-type">hscMaybeWriteIface</span></a></span><span>
</span><span id="line-1325"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-1326"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-1327"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1328"></span><span>  </span><span class="hs-comment">-- ^ Is this a simple interface generated after the core pipeline, or one</span><span>
</span><span id="line-1329"></span><span>  </span><span class="hs-comment">-- with information from the backend? See: Note [Writing interface files]</span><span>
</span><span id="line-1330"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-1331"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span>
</span><span id="line-1332"></span><span>  </span><span class="hs-comment">-- ^ The old interface hash, used to decide if we need to actually write the</span><span>
</span><span id="line-1333"></span><span>  </span><span class="hs-comment">-- new interface.</span><span>
</span><span id="line-1334"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-1335"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1336"></span><span id="hscMaybeWriteIface"><span class="annot"><span class="annottext">hscMaybeWriteIface :: Logger
-&gt; DynFlags
-&gt; Bool
-&gt; ModIface
-&gt; Maybe Fingerprint
-&gt; ModLocation
-&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-var hs-var">hscMaybeWriteIface</span></a></span></span><span> </span><span id="local-6989586621683156872"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156872"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621683156873"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683156874"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156874"><span class="hs-identifier hs-var">is_simple</span></a></span></span><span> </span><span id="local-6989586621683156875"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683156876"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621683156876"><span class="hs-identifier hs-var">old_iface</span></a></span></span><span> </span><span id="local-6989586621683156877"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156877"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1337"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156878"><span class="annot"><span class="annottext">force_write_interface :: Bool
</span><a href="#local-6989586621683156878"><span class="hs-identifier hs-var hs-var">force_write_interface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteInterface"><span class="hs-identifier hs-var">Opt_WriteInterface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1338"></span><span>        </span><span id="local-6989586621683156880"><span class="annot"><span class="annottext">write_interface :: Bool
</span><a href="#local-6989586621683156880"><span class="hs-identifier hs-var hs-var">write_interface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendWritesFiles"><span class="hs-identifier hs-var">backendWritesFiles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1339"></span><span>
</span><span id="line-1340"></span><span>        </span><span id="local-6989586621683156881"><span class="annot"><span class="annottext">write_iface :: DynFlags -&gt; ModIface -&gt; IO ()
</span><a href="#local-6989586621683156881"><span class="hs-identifier hs-var hs-var">write_iface</span></a></span></span><span> </span><span id="local-6989586621683156882"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156882"><span class="hs-identifier hs-var">dflags'</span></a></span></span><span> </span><span id="local-6989586621683156883"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156883"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1341"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683156884"><span class="annot"><span class="annottext">iface_name :: [Char]
</span><a href="#local-6989586621683156884"><span class="hs-identifier hs-var hs-var">iface_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#dynamicNow"><span class="hs-identifier hs-var">dynamicNow</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156882"><span class="hs-identifier hs-var">dflags'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_hi_file"><span class="hs-identifier hs-var">ml_dyn_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156877"><span class="hs-identifier hs-var">mod_location</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156877"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-1342"></span><span>              </span><span id="local-6989586621683156887"><span class="annot"><span class="annottext">profile :: Profile
</span><a href="#local-6989586621683156887"><span class="hs-identifier hs-var hs-var">profile</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Profile
</span><a href="GHC.Driver.DynFlags.html#targetProfile"><span class="hs-identifier hs-var">targetProfile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156882"><span class="hs-identifier hs-var">dflags'</span></a></span><span>
</span><span id="line-1343"></span><span>          </span><span class="hs-keyword">in</span><span>
</span><span id="line-1344"></span><span>          </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;writeIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1345"></span><span>          </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; (() -&gt; ()) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156872"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1346"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WriteIface&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156884"><span class="hs-identifier hs-var">iface_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1347"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1348"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger
-&gt; Profile -&gt; CompressionIFace -&gt; [Char] -&gt; ModIface -&gt; IO ()
</span><a href="GHC.Iface.Load.html#writeIface"><span class="hs-identifier hs-var">writeIface</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156872"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683156887"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; CompressionIFace
</span><a href="GHC.Iface.Load.html#flagsToIfCompression"><span class="hs-identifier hs-var">flagsToIfCompression</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156884"><span class="hs-identifier hs-var">iface_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156883"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156880"><span class="hs-identifier hs-var">write_interface</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156878"><span class="hs-identifier hs-var">force_write_interface</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1351"></span><span>
</span><span id="line-1352"></span><span>      </span><span class="hs-comment">-- FIXME: with -dynamic-too, &quot;change&quot; is only meaningful for the</span><span>
</span><span id="line-1353"></span><span>      </span><span class="hs-comment">-- non-dynamic interface, not for the dynamic one. We should have another</span><span>
</span><span id="line-1354"></span><span>      </span><span class="hs-comment">-- flag for the dynamic interface. In the meantime:</span><span>
</span><span id="line-1355"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1356"></span><span>      </span><span class="hs-comment">--    * when we write a single full interface, we check if we are</span><span>
</span><span id="line-1357"></span><span>      </span><span class="hs-comment">--    currently writing the dynamic interface due to -dynamic-too, in</span><span>
</span><span id="line-1358"></span><span>      </span><span class="hs-comment">--    which case we ignore &quot;change&quot;.</span><span>
</span><span id="line-1359"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1360"></span><span>      </span><span class="hs-comment">--    * when we write two simple interfaces at once because of</span><span>
</span><span id="line-1361"></span><span>      </span><span class="hs-comment">--    dynamic-too, we use &quot;change&quot; both for the non-dynamic and the</span><span>
</span><span id="line-1362"></span><span>      </span><span class="hs-comment">--    dynamic interfaces. Hopefully both the dynamic and the non-dynamic</span><span>
</span><span id="line-1363"></span><span>      </span><span class="hs-comment">--    interfaces stay in sync...</span><span>
</span><span id="line-1364"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1365"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156889"><span class="annot"><span class="annottext">change :: Bool
</span><a href="#local-6989586621683156889"><span class="hs-identifier hs-var hs-var hs-var">change</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621683156876"><span class="hs-identifier hs-var">old_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint -&gt; Maybe Fingerprint -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Maybe Fingerprint
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModIface.html#mi_iface_hash"><span class="hs-identifier hs-var">mi_iface_hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_final_exts"><span class="hs-identifier hs-var">mi_final_exts</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156890"><span class="annot"><span class="annottext">dt :: DynamicTooState
</span><a href="#local-6989586621683156890"><span class="hs-identifier hs-var hs-var hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DynamicTooState
</span><a href="GHC.Driver.DynFlags.html#dynamicTooState"><span class="hs-identifier hs-var">dynamicTooState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1368"></span><span>
</span><span id="line-1369"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-var">logHasDumpFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156872"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_if_trace"><span class="hs-identifier hs-var">Opt_D_dump_if_trace</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156872"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1370"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Writing interface(s):&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1371"></span><span>         </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Kind:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156874"><span class="hs-identifier hs-var">is_simple</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;simple&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;full&quot;</span></span><span>
</span><span id="line-1372"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Hash change:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156889"><span class="hs-identifier hs-var">change</span></a></span><span>
</span><span id="line-1373"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;DynamicToo state:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicTooState -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="#local-6989586621683156890"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1374"></span><span>         </span><span class="hs-special">]</span><span>
</span><span id="line-1375"></span><span>
</span><span id="line-1376"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156874"><span class="hs-identifier hs-var">is_simple</span></a></span><span>
</span><span id="line-1377"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156889"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- FIXME: see 'change' comment above</span><span>
</span><span id="line-1378"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; IO ()
</span><a href="#local-6989586621683156881"><span class="hs-identifier hs-var">write_iface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1379"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="#local-6989586621683156890"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1380"></span><span>               </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="GHC.Driver.DynFlags.html#DT_Dont"><span class="hs-identifier hs-var">DT_Dont</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1381"></span><span>               </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="GHC.Driver.DynFlags.html#DT_Dyn"><span class="hs-identifier hs-var">DT_Dyn</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unexpected DT_Dyn state when writing simple interface&quot;</span></span><span>
</span><span id="line-1382"></span><span>               </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="GHC.Driver.DynFlags.html#DT_OK"><span class="hs-identifier hs-var">DT_OK</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; IO ()
</span><a href="#local-6989586621683156881"><span class="hs-identifier hs-var">write_iface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.DynFlags.html#setDynamicNow"><span class="hs-identifier hs-var">setDynamicNow</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1383"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="#local-6989586621683156890"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1384"></span><span>               </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="GHC.Driver.DynFlags.html#DT_Dont"><span class="hs-identifier hs-var">DT_Dont</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156889"><span class="hs-identifier hs-var">change</span></a></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; IO ()
</span><a href="#local-6989586621683156881"><span class="hs-identifier hs-var">write_iface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1385"></span><span>               </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="GHC.Driver.DynFlags.html#DT_OK"><span class="hs-identifier hs-var">DT_OK</span></a></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156889"><span class="hs-identifier hs-var">change</span></a></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; IO ()
</span><a href="#local-6989586621683156881"><span class="hs-identifier hs-var">write_iface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1386"></span><span>               </span><span class="hs-comment">-- FIXME: see change' comment above</span><span>
</span><span id="line-1387"></span><span>               </span><span class="annot"><span class="annottext">DynamicTooState
</span><a href="GHC.Driver.DynFlags.html#DT_Dyn"><span class="hs-identifier hs-var">DT_Dyn</span></a></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; IO ()
</span><a href="#local-6989586621683156881"><span class="hs-identifier hs-var">write_iface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1388"></span><span>               </span><span class="annot"><span class="annottext">DynamicTooState
</span><span class="hs-identifier">_</span></span><span>                                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1389"></span><span>
</span><span id="line-1390"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-var">Opt_WriteHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156873"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1391"></span><span>          </span><span class="hs-comment">-- This is slightly hacky. A hie file is considered to be up to date</span><span>
</span><span id="line-1392"></span><span>          </span><span class="hs-comment">-- if its modification time on disk is greater than or equal to that</span><span>
</span><span id="line-1393"></span><span>          </span><span class="hs-comment">-- of the .hi file (since we should always write a .hi file if we are</span><span>
</span><span id="line-1394"></span><span>          </span><span class="hs-comment">-- writing a .hie file). However, with the way this code is</span><span>
</span><span id="line-1395"></span><span>          </span><span class="hs-comment">-- structured at the moment, the .hie file is often written before</span><span>
</span><span id="line-1396"></span><span>          </span><span class="hs-comment">-- the .hi file; by touching the file here, we ensure that it is</span><span>
</span><span id="line-1397"></span><span>          </span><span class="hs-comment">-- correctly considered up-to-date.</span><span>
</span><span id="line-1398"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-1399"></span><span>          </span><span class="hs-comment">-- The file should exist by the time we get here, but we check for</span><span>
</span><span id="line-1400"></span><span>          </span><span class="hs-comment">-- existence just in case, so that we don't accidentally create empty</span><span>
</span><span id="line-1401"></span><span>          </span><span class="hs-comment">-- .hie files.</span><span>
</span><span id="line-1402"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156899"><span class="annot"><span class="annottext">hie_file :: [Char]
</span><a href="#local-6989586621683156899"><span class="hs-identifier hs-var hs-var">hie_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683156877"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-1403"></span><span>          </span><span class="annot"><span class="annottext">IO Bool -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="GHC.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156899"><span class="hs-identifier hs-var">hie_file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1404"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><a href="GHC.Utils.Touch.html#touch"><span class="hs-identifier hs-var">GHC.Utils.Touch.touch</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156899"><span class="hs-identifier hs-var">hie_file</span></a></span><span>
</span><span id="line-1405"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-1406"></span><span>        </span><span class="hs-comment">-- See Note [Strictness in ModIface]</span><span>
</span><span id="line-1407"></span><span>        </span><span class="annot"><span class="annottext">ModIface -&gt; IO ()
</span><a href="GHC.Unit.Module.ModIface.html#forceModIface"><span class="hs-identifier hs-var">forceModIface</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156875"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1408"></span><span>
</span><span id="line-1409"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1410"></span><span class="hs-comment">-- NoRecomp handlers</span><span>
</span><span id="line-1411"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1412"></span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span class="hs-comment">-- | genModDetails is used to initialise 'ModDetails' at the end of compilation.</span><span>
</span><span id="line-1415"></span><span class="hs-comment">-- This has two main effects:</span><span>
</span><span id="line-1416"></span><span class="hs-comment">-- 1. Increases memory usage by unloading a lot of the TypeEnv</span><span>
</span><span id="line-1417"></span><span class="hs-comment">-- 2. Globalising certain parts (DFunIds) in the TypeEnv (which used to be achieved using UpdateIdInfos)</span><span>
</span><span id="line-1418"></span><span class="hs-comment">-- For the second part to work, it's critical that we use 'initIfaceLoadModule' here rather than</span><span>
</span><span id="line-1419"></span><span class="hs-comment">-- 'initIfaceCheck' as 'initIfaceLoadModule' removes the module from the KnotVars, otherwise name lookups</span><span>
</span><span id="line-1420"></span><span class="hs-comment">-- succeed by hitting the old TypeEnv, which missing out the critical globalisation step for DFuns.</span><span>
</span><span id="line-1421"></span><span>
</span><span id="line-1422"></span><span class="hs-comment">-- After the DFunIds are globalised, it's critical to overwrite the old TypeEnv with the new</span><span>
</span><span id="line-1423"></span><span class="hs-comment">-- more compact and more correct version. This reduces memory usage whilst compiling the rest of</span><span>
</span><span id="line-1424"></span><span class="hs-comment">-- the module loop.</span><span>
</span><span id="line-1425"></span><span class="annot"><a href="GHC.Driver.Main.html#genModDetails"><span class="hs-identifier hs-type">genModDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-1426"></span><span id="genModDetails"><span class="annot"><span class="annottext">genModDetails :: HscEnv -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#genModDetails"><span class="hs-identifier hs-var hs-var">genModDetails</span></a></span></span><span> </span><span id="local-6989586621683156904"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156904"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683156905"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156905"><span class="hs-identifier hs-var">old_iface</span></a></span></span><span>
</span><span id="line-1427"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1428"></span><span>    </span><span class="hs-comment">-- CRITICAL: To use initIfaceLoadModule as that removes the current module from the KnotVars and</span><span>
</span><span id="line-1429"></span><span>    </span><span class="hs-comment">-- hence properly globalises DFunIds.</span><span>
</span><span id="line-1430"></span><span>    </span><span id="local-6989586621683156906"><span class="annot"><a href="#local-6989586621683156906"><span class="hs-identifier hs-var">new_details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;tcRnIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1431"></span><span>                  </span><span class="annot"><span class="annottext">HscEnv -&gt; Module -&gt; IfG ModDetails -&gt; IO ModDetails
forall a. HscEnv -&gt; Module -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLoadModule"><span class="hs-identifier hs-var">initIfaceLoadModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156904"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156905"><span class="hs-identifier hs-var">old_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfG ModDetails
</span><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier hs-var">typecheckIface</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683156905"><span class="hs-identifier hs-var">old_iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1432"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html#lookupKnotVars"><span class="hs-identifier hs-type">lookupKnotVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156904"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156905"><span class="hs-identifier hs-type">old_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1433"></span><span>      </span><span class="annot"><span class="annottext">Maybe (IORef TypeEnv)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683156908"><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621683156908"><span class="hs-identifier hs-var">te_var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv -&gt; TypeEnv -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621683156908"><span class="hs-identifier hs-var">te_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; TypeEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_types"><span class="hs-identifier hs-var">md_types</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683156906"><span class="hs-identifier hs-var">new_details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1435"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-type">dumpIfaceStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156904"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-1436"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156906"><span class="hs-identifier hs-type">new_details</span></a></span><span>
</span><span id="line-1437"></span><span>
</span><span id="line-1438"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1439"></span><span class="hs-comment">-- Progress displayers.</span><span>
</span><span id="line-1440"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1441"></span><span>
</span><span id="line-1442"></span><span class="annot"><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier hs-type">oneShotMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1443"></span><span id="oneShotMsg"><span class="annot"><span class="annottext">oneShotMsg :: Logger -&gt; RecompileRequired -&gt; IO ()
</span><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier hs-var hs-var">oneShotMsg</span></a></span></span><span> </span><span id="local-6989586621683156910"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156910"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621683156911"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156911"><span class="hs-identifier hs-var">recomp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1444"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156911"><span class="hs-identifier hs-var">recomp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1445"></span><span>        </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#compilationProgressMsg"><span class="hs-identifier hs-var">compilationProgressMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156910"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;compilation IS NOT required&quot;</span></span><span>
</span><span id="line-1446"></span><span>        </span><span class="annot"><a href="GHC.Iface.Recomp.html#NeedsRecompile"><span class="hs-identifier hs-type">NeedsRecompile</span></a></span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span class="annot"><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier hs-type">batchMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1449"></span><span id="batchMsg"><span class="annot"><span class="annottext">batchMsg :: Messager
</span><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier hs-var hs-var">batchMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv
 -&gt; (Int, Int) -&gt; RecompileRequired -&gt; ModuleGraphNode -&gt; SDoc)
-&gt; Messager
</span><a href="GHC.Driver.Main.html#batchMsgWith"><span class="hs-identifier hs-var">batchMsgWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span class="annot"><a href="GHC.Driver.Main.html#batchMultiMsg"><span class="hs-identifier hs-type">batchMultiMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1451"></span><span id="batchMultiMsg"><span class="annot"><span class="annottext">batchMultiMsg :: Messager
</span><a href="GHC.Driver.Main.html#batchMultiMsg"><span class="hs-identifier hs-var hs-var">batchMultiMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv
 -&gt; (Int, Int) -&gt; RecompileRequired -&gt; ModuleGraphNode -&gt; SDoc)
-&gt; Messager
</span><a href="GHC.Driver.Main.html#batchMsgWith"><span class="hs-identifier hs-var">batchMsgWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683156915"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621683156915"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodeUnitId"><span class="hs-identifier hs-var">moduleGraphNodeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621683156915"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>
</span><span id="line-1453"></span><span class="annot"><a href="GHC.Driver.Main.html#batchMsgWith"><span class="hs-identifier hs-type">batchMsgWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1454"></span><span id="batchMsgWith"><span class="annot"><span class="annottext">batchMsgWith :: (HscEnv
 -&gt; (Int, Int) -&gt; RecompileRequired -&gt; ModuleGraphNode -&gt; SDoc)
-&gt; Messager
</span><a href="GHC.Driver.Main.html#batchMsgWith"><span class="hs-identifier hs-var hs-var">batchMsgWith</span></a></span></span><span> </span><span id="local-6989586621683156917"><span class="annot"><span class="annottext">HscEnv
-&gt; (Int, Int) -&gt; RecompileRequired -&gt; ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621683156917"><span class="hs-identifier hs-var">extra</span></a></span></span><span> </span><span id="local-6989586621683156918"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156918"><span class="hs-identifier hs-var">hsc_env_start</span></a></span></span><span> </span><span id="local-6989586621683156919"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621683156919"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621683156920"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156920"><span class="hs-identifier hs-var">recomp</span></a></span></span><span> </span><span id="local-6989586621683156921"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621683156921"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1455"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156920"><span class="hs-identifier hs-var">recomp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1456"></span><span>        </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span>
</span><span id="line-1457"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logVerbAtLeast"><span class="hs-identifier hs-var">logVerbAtLeast</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156923"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; IO ()
</span><a href="#local-6989586621683156924"><span class="hs-identifier hs-var">showMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Skipping&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1458"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span>        </span><span class="annot"><a href="GHC.Iface.Recomp.html#NeedsRecompile"><span class="hs-identifier hs-type">NeedsRecompile</span></a></span><span> </span><span id="local-6989586621683156925"><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156925"><span class="hs-identifier hs-var">reason0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; IO ()
</span><a href="#local-6989586621683156924"><span class="hs-identifier hs-var">showMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683156926"><span class="hs-identifier hs-var">herald</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><a href="#local-6989586621683156925"><span class="hs-identifier hs-var">reason0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1460"></span><span>          </span><span class="annot"><span class="annottext">CompileReason
</span><a href="GHC.Iface.Recomp.html#MustCompile"><span class="hs-identifier hs-var">MustCompile</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1461"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompBecause"><span class="hs-identifier hs-type">RecompBecause</span></a></span><span> </span><span id="local-6989586621683156929"><span class="annot"><span class="annottext">RecompReason
</span><a href="#local-6989586621683156929"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; [&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprWithUnitState"><span class="hs-identifier hs-var">pprWithUnitState</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683156932"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecompReason -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RecompReason
</span><a href="#local-6989586621683156929"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-1462"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1463"></span><span>        </span><span id="local-6989586621683156926"><span class="annot"><span class="annottext">herald :: [Char]
</span><a href="#local-6989586621683156926"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621683156921"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1464"></span><span>                    </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#LinkNode"><span class="hs-identifier hs-type">LinkNode</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Linking&quot;</span></span><span>
</span><span id="line-1465"></span><span>                    </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#InstantiationNode"><span class="hs-identifier hs-type">InstantiationNode</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Instantiating&quot;</span></span><span>
</span><span id="line-1466"></span><span>                    </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Compiling&quot;</span></span><span>
</span><span id="line-1467"></span><span>        </span><span id="local-6989586621683156935"><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="#local-6989586621683156935"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitId -&gt; HscEnv -&gt; HscEnv
UnitId -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-var">hscSetActiveUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodeUnitId"><span class="hs-identifier hs-var">moduleGraphNodeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621683156921"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156918"><span class="hs-identifier hs-var">hsc_env_start</span></a></span><span>
</span><span id="line-1468"></span><span>        </span><span id="local-6989586621683156937"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683156937"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156935"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1469"></span><span>        </span><span id="local-6989586621683156923"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683156923"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156935"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1470"></span><span>        </span><span id="local-6989586621683156932"><span class="annot"><span class="annottext">state :: UnitState
</span><a href="#local-6989586621683156932"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156935"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1471"></span><span>        </span><span id="local-6989586621683156924"><span class="annot"><span class="annottext">showMsg :: SDoc -&gt; SDoc -&gt; IO ()
</span><a href="#local-6989586621683156924"><span class="hs-identifier hs-var hs-var">showMsg</span></a></span></span><span> </span><span id="local-6989586621683156939"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683156939"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621683156940"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683156940"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1472"></span><span>            </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#compilationProgressMsg"><span class="hs-identifier hs-var">compilationProgressMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683156923"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1473"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; SDoc
</span><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier hs-var">showModuleIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621683156919"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-1474"></span><span>            </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683156939"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; ModuleGraphNode -&gt; SDoc
</span><a href="GHC.Unit.Module.Graph.html#showModMsg"><span class="hs-identifier hs-var">showModMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156937"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecompileRequired -&gt; Bool
</span><a href="GHC.Iface.Recomp.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156920"><span class="hs-identifier hs-var">recomp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621683156921"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1475"></span><span>                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; (Int, Int) -&gt; RecompileRequired -&gt; ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621683156917"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683156935"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621683156919"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621683156920"><span class="hs-identifier hs-var">recomp</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621683156921"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1476"></span><span>                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683156940"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1479"></span><span class="hs-comment">-- Safe Haskell</span><span>
</span><span id="line-1480"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1481"></span><span>
</span><span id="line-1482"></span><span class="hs-comment">-- Note [Safe Haskell Trust Check]</span><span>
</span><span id="line-1483"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1484"></span><span class="hs-comment">-- Safe Haskell checks that an import is trusted according to the following</span><span>
</span><span id="line-1485"></span><span class="hs-comment">-- rules for an import of module M that resides in Package P:</span><span>
</span><span id="line-1486"></span><span class="hs-comment">--</span><span>
</span><span id="line-1487"></span><span class="hs-comment">--   * If M is recorded as Safe and all its trust dependencies are OK</span><span>
</span><span id="line-1488"></span><span class="hs-comment">--     then M is considered safe.</span><span>
</span><span id="line-1489"></span><span class="hs-comment">--   * If M is recorded as Trustworthy and P is considered trusted and</span><span>
</span><span id="line-1490"></span><span class="hs-comment">--     all M's trust dependencies are OK then M is considered safe.</span><span>
</span><span id="line-1491"></span><span class="hs-comment">--</span><span>
</span><span id="line-1492"></span><span class="hs-comment">-- By trust dependencies we mean that the check is transitive. So if</span><span>
</span><span id="line-1493"></span><span class="hs-comment">-- a module M that is Safe relies on a module N that is trustworthy,</span><span>
</span><span id="line-1494"></span><span class="hs-comment">-- importing module M will first check (according to the second case)</span><span>
</span><span id="line-1495"></span><span class="hs-comment">-- that N is trusted before checking M is trusted.</span><span>
</span><span id="line-1496"></span><span class="hs-comment">--</span><span>
</span><span id="line-1497"></span><span class="hs-comment">-- This is a minimal description, so please refer to the user guide</span><span>
</span><span id="line-1498"></span><span class="hs-comment">-- for more details. The user guide is also considered the authoritative</span><span>
</span><span id="line-1499"></span><span class="hs-comment">-- source in this matter, not the comments or code.</span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span>
</span><span id="line-1502"></span><span class="hs-comment">-- Note [Safe Haskell Inference]</span><span>
</span><span id="line-1503"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1504"></span><span class="hs-comment">-- Safe Haskell does Safe inference on modules that don't have any specific</span><span>
</span><span id="line-1505"></span><span class="hs-comment">-- safe haskell mode flag. The basic approach to this is:</span><span>
</span><span id="line-1506"></span><span class="hs-comment">--   * When deciding if we need to do a Safe language check, treat</span><span>
</span><span id="line-1507"></span><span class="hs-comment">--     an unmarked module as having -XSafe mode specified.</span><span>
</span><span id="line-1508"></span><span class="hs-comment">--   * For checks, don't throw errors but return them to the caller.</span><span>
</span><span id="line-1509"></span><span class="hs-comment">--   * Caller checks if there are errors:</span><span>
</span><span id="line-1510"></span><span class="hs-comment">--     * For modules explicitly marked -XSafe, we throw the errors.</span><span>
</span><span id="line-1511"></span><span class="hs-comment">--     * For unmarked modules (inference mode), we drop the errors</span><span>
</span><span id="line-1512"></span><span class="hs-comment">--       and mark the module as being Unsafe.</span><span>
</span><span id="line-1513"></span><span class="hs-comment">--</span><span>
</span><span id="line-1514"></span><span class="hs-comment">-- It used to be that we only did safe inference on modules that had no Safe</span><span>
</span><span id="line-1515"></span><span class="hs-comment">-- Haskell flags, but now we perform safe inference on all modules as we want</span><span>
</span><span id="line-1516"></span><span class="hs-comment">-- to allow users to set the `-Wsafe`, `-Wunsafe` and</span><span>
</span><span id="line-1517"></span><span class="hs-comment">-- `-Wtrustworthy-safe` flags on Trustworthy and Unsafe modules so that a</span><span>
</span><span id="line-1518"></span><span class="hs-comment">-- user can ensure their assumptions are correct and see reasons for why a</span><span>
</span><span id="line-1519"></span><span class="hs-comment">-- module is safe or unsafe.</span><span>
</span><span id="line-1520"></span><span class="hs-comment">--</span><span>
</span><span id="line-1521"></span><span class="hs-comment">-- This is tricky as we must be careful when we should throw an error compared</span><span>
</span><span id="line-1522"></span><span class="hs-comment">-- to just warnings. For checking safe imports we manage it as two steps. First</span><span>
</span><span id="line-1523"></span><span class="hs-comment">-- we check any imports that are required to be safe, then we check all other</span><span>
</span><span id="line-1524"></span><span class="hs-comment">-- imports to see if we can infer them to be safe.</span><span>
</span><span id="line-1525"></span><span>
</span><span id="line-1526"></span><span>
</span><span id="line-1527"></span><span class="hs-comment">-- | Check that the safe imports of the module being compiled are valid.</span><span>
</span><span id="line-1528"></span><span class="hs-comment">-- If not we either issue a compilation error if the module is explicitly</span><span>
</span><span id="line-1529"></span><span class="hs-comment">-- using Safe Haskell, or mark the module as unsafe if we're in safe</span><span>
</span><span id="line-1530"></span><span class="hs-comment">-- inference mode.</span><span>
</span><span id="line-1531"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafeImports"><span class="hs-identifier hs-type">hscCheckSafeImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1532"></span><span id="hscCheckSafeImports"><span class="annot"><span class="annottext">hscCheckSafeImports :: TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#hscCheckSafeImports"><span class="hs-identifier hs-var hs-var">hscCheckSafeImports</span></a></span></span><span> </span><span id="local-6989586621683156943"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156943"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1533"></span><span>    </span><span id="local-6989586621683156944"><span class="annot"><a href="#local-6989586621683156944"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1534"></span><span>    </span><span id="local-6989586621683156945"><span class="annot"><a href="#local-6989586621683156945"><span class="hs-identifier hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#checkSafeImports"><span class="hs-identifier hs-type">checkSafeImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156943"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-1535"></span><span>    </span><span class="annot"><a href="#local-6989586621683156947"><span class="hs-identifier hs-type">checkRULES</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156944"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156945"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span>
</span><span id="line-1536"></span><span>
</span><span id="line-1537"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1538"></span><span>    </span><span id="local-6989586621683156947"><span class="annot"><span class="annottext">checkRULES :: DynFlags -&gt; TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="#local-6989586621683156947"><span class="hs-identifier hs-var hs-var">checkRULES</span></a></span></span><span> </span><span id="local-6989586621683156954"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156954"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683156955"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156955"><span class="hs-identifier hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1539"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156956"><span class="annot"><span class="annottext">diag_opts :: DiagOpts
</span><a href="#local-6989586621683156956"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156954"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1540"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeLanguageOn"><span class="hs-identifier hs-var">safeLanguageOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156954"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1541"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1542"></span><span>              </span><span class="hs-comment">-- XSafe: we nuke user written RULES</span><span>
</span><span id="line-1543"></span><span>              </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages GhcMessage -&gt; Hsc ()) -&gt; Messages GhcMessage -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage)
-&gt; Messages DriverMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; Messages a -&gt; Messages b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages DriverMessage -&gt; Messages GhcMessage)
-&gt; Messages DriverMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiagOpts
-&gt; [GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
-&gt; Messages DriverMessage
</span><a href="#local-6989586621683156958"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156956"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [LRuleDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156955"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1544"></span><span>              </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156955"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1545"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1546"></span><span>                </span><span class="hs-comment">-- SafeInferred: user defined RULES, so not safe</span><span>
</span><span id="line-1547"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156954"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LRuleDecl GhcTc] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([LRuleDecl GhcTc] -&gt; Bool) -&gt; [LRuleDecl GhcTc] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [LRuleDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156955"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1548"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Messages DriverMessage -&gt; Hsc TcGblEnv
forall e. Diagnostic e =&gt; TcGblEnv -&gt; Messages e -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-var">markUnsafeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156955"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages DriverMessage -&gt; Hsc TcGblEnv)
-&gt; Messages DriverMessage -&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiagOpts
-&gt; [GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
-&gt; Messages DriverMessage
</span><a href="#local-6989586621683156958"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156956"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [LRuleDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156955"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>                </span><span class="hs-comment">-- Trustworthy OR SafeInferred: with no RULES</span><span>
</span><span id="line-1551"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1552"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156955"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span>
</span><span id="line-1553"></span><span>
</span><span id="line-1554"></span><span>    </span><span id="local-6989586621683156958"><span class="annot"><span class="annottext">warns :: DiagOpts
-&gt; [GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
-&gt; Messages DriverMessage
</span><a href="#local-6989586621683156958"><span class="hs-identifier hs-var hs-var">warns</span></a></span></span><span> </span><span id="local-6989586621683156961"><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156961"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span id="local-6989586621683156962"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
</span><a href="#local-6989586621683156962"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope DriverMessage) -&gt; Messages DriverMessage
forall e. Bag (MsgEnvelope e) -&gt; Messages e
</span><a href="GHC.Types.Error.html#mkMessages"><span class="hs-identifier hs-var">mkMessages</span></a></span><span> </span><span class="annot"><span class="annottext">(Bag (MsgEnvelope DriverMessage) -&gt; Messages DriverMessage)
-&gt; Bag (MsgEnvelope DriverMessage) -&gt; Messages DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[MsgEnvelope DriverMessage] -&gt; Bag (MsgEnvelope DriverMessage)
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">([MsgEnvelope DriverMessage] -&gt; Bag (MsgEnvelope DriverMessage))
-&gt; [MsgEnvelope DriverMessage] -&gt; Bag (MsgEnvelope DriverMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (RuleDecl GhcTc)
 -&gt; MsgEnvelope DriverMessage)
-&gt; [GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
-&gt; [MsgEnvelope DriverMessage]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiagOpts -&gt; LRuleDecl GhcTc -&gt; MsgEnvelope DriverMessage
</span><a href="#local-6989586621683156964"><span class="hs-identifier hs-var">warnRules</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156961"><span class="hs-identifier hs-var">diag_opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
</span><a href="#local-6989586621683156962"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-1555"></span><span>
</span><span id="line-1556"></span><span>    </span><span class="annot"><a href="#local-6989586621683156964"><span class="hs-identifier hs-type">warnRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#DiagOpts"><span class="hs-identifier hs-type">DiagOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LRuleDecl"><span class="hs-identifier hs-type">LRuleDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#MsgEnvelope"><span class="hs-identifier hs-type">MsgEnvelope</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessage"><span class="hs-identifier hs-type">DriverMessage</span></a></span><span>
</span><span id="line-1557"></span><span>    </span><span id="local-6989586621683156964"><span class="annot"><span class="annottext">warnRules :: DiagOpts -&gt; LRuleDecl GhcTc -&gt; MsgEnvelope DriverMessage
</span><a href="#local-6989586621683156964"><span class="hs-identifier hs-var hs-var">warnRules</span></a></span></span><span> </span><span id="local-6989586621683156965"><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156965"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683156967"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683156967"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683156968"><span class="annot"><span class="annottext">RuleDecl GhcTc
</span><a href="#local-6989586621683156968"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1558"></span><span>        </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683156965"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683156967"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; MsgEnvelope DriverMessage)
-&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RuleDecl GhcTc -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverUserDefinedRuleIgnored"><span class="hs-identifier hs-var">DriverUserDefinedRuleIgnored</span></a></span><span> </span><span class="annot"><span class="annottext">RuleDecl GhcTc
</span><a href="#local-6989586621683156968"><span class="hs-identifier hs-var">rule</span></a></span><span>
</span><span id="line-1559"></span><span>
</span><span id="line-1560"></span><span class="hs-comment">-- | Validate that safe imported modules are actually safe.  For modules in the</span><span>
</span><span id="line-1561"></span><span class="hs-comment">-- HomePackage (the package the module we are compiling in resides) this just</span><span>
</span><span id="line-1562"></span><span class="hs-comment">-- involves checking its trust type is 'Safe' or 'Trustworthy'. For modules</span><span>
</span><span id="line-1563"></span><span class="hs-comment">-- that reside in another package we also must check that the external package</span><span>
</span><span id="line-1564"></span><span class="hs-comment">-- is trusted. See the Note [Safe Haskell Trust Check] above for more</span><span>
</span><span id="line-1565"></span><span class="hs-comment">-- information.</span><span>
</span><span id="line-1566"></span><span class="hs-comment">--</span><span>
</span><span id="line-1567"></span><span class="hs-comment">-- The code for this is quite tricky as the whole algorithm is done in a few</span><span>
</span><span id="line-1568"></span><span class="hs-comment">-- distinct phases in different parts of the code base. See</span><span>
</span><span id="line-1569"></span><span class="hs-comment">-- 'GHC.Rename.Names.rnImportDecl' for where package trust dependencies for a</span><span>
</span><span id="line-1570"></span><span class="hs-comment">-- module are collected and unioned.  Specifically see the Note [Tracking Trust</span><span>
</span><span id="line-1571"></span><span class="hs-comment">-- Transitively] in &quot;GHC.Rename.Names&quot; and the Note [Trust Own Package] in</span><span>
</span><span id="line-1572"></span><span class="hs-comment">-- &quot;GHC.Rename.Names&quot;.</span><span>
</span><span id="line-1573"></span><span class="annot"><a href="GHC.Driver.Main.html#checkSafeImports"><span class="hs-identifier hs-type">checkSafeImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1574"></span><span id="checkSafeImports"><span class="annot"><span class="annottext">checkSafeImports :: TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#checkSafeImports"><span class="hs-identifier hs-var hs-var">checkSafeImports</span></a></span></span><span> </span><span id="local-6989586621683156971"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156971"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span>
</span><span id="line-1575"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1576"></span><span>        </span><span id="local-6989586621683156972"><span class="annot"><a href="#local-6989586621683156972"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1577"></span><span>        </span><span id="local-6989586621683156973"><span class="annot"><a href="#local-6989586621683156973"><span class="hs-identifier hs-var">imps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="#local-6989586621683156974"><span class="hs-identifier hs-type">condense</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156975"><span class="hs-identifier hs-type">imports'</span></a></span><span>
</span><span id="line-1578"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683156976"><span class="annot"><a href="#local-6989586621683156976"><span class="hs-identifier hs-var">safeImps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156977"><span class="annot"><a href="#local-6989586621683156977"><span class="hs-identifier hs-var">regImps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683156978"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156978"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156978"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683156973"><span class="hs-identifier hs-type">imps</span></a></span><span>
</span><span id="line-1579"></span><span>
</span><span id="line-1580"></span><span>        </span><span class="hs-comment">-- We want to use the warning state specifically for detecting if safe</span><span>
</span><span id="line-1581"></span><span>        </span><span class="hs-comment">-- inference has failed, so store and clear any existing warnings.</span><span>
</span><span id="line-1582"></span><span>        </span><span id="local-6989586621683156979"><span class="annot"><a href="#local-6989586621683156979"><span class="hs-identifier hs-var">oldErrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span>
</span><span id="line-1583"></span><span>        </span><span class="annot"><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-type">clearDiagnostics</span></a></span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span>        </span><span class="hs-comment">-- Check safe imports are correct</span><span>
</span><span id="line-1586"></span><span>        </span><span id="local-6989586621683156980"><span class="annot"><a href="#local-6989586621683156980"><span class="hs-identifier hs-var">safePkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-type">S.fromList</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-type">mapMaybeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156983"><span class="hs-identifier hs-type">checkSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156976"><span class="hs-identifier hs-type">safeImps</span></a></span><span>
</span><span id="line-1587"></span><span>        </span><span id="local-6989586621683156984"><span class="annot"><a href="#local-6989586621683156984"><span class="hs-identifier hs-var">safeErrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span>
</span><span id="line-1588"></span><span>        </span><span class="annot"><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-type">clearDiagnostics</span></a></span><span>
</span><span id="line-1589"></span><span>
</span><span id="line-1590"></span><span>        </span><span class="hs-comment">-- Check non-safe imports are correct if inferring safety</span><span>
</span><span id="line-1591"></span><span>        </span><span class="hs-comment">-- See the Note [Safe Haskell Inference]</span><span>
</span><span id="line-1592"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683156985"><span class="annot"><a href="#local-6989586621683156985"><span class="hs-identifier hs-var">infErrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683156986"><span class="annot"><a href="#local-6989586621683156986"><span class="hs-identifier hs-var">infPkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-type">safeInferOn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156972"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1593"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Messages GhcMessage, Set UnitId)
-&gt; Hsc (Messages GhcMessage, Set UnitId)
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages GhcMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1594"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683156988"><span class="annot"><a href="#local-6989586621683156988"><span class="hs-identifier hs-var">infPkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId) -&gt; Hsc [UnitId] -&gt; Hsc (Set UnitId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Module, SrcSpan, Bool) -&gt; Hsc (Maybe UnitId))
-&gt; [(Module, SrcSpan, Bool)] -&gt; Hsc [UnitId]
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, SrcSpan, Bool) -&gt; Hsc (Maybe UnitId)
forall a. (Module, SrcSpan, a) -&gt; Hsc (Maybe UnitId)
</span><a href="#local-6989586621683156983"><span class="hs-identifier hs-var">checkSafe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, SrcSpan, Bool)]
</span><a href="#local-6989586621683156977"><span class="hs-identifier hs-var">regImps</span></a></span><span>
</span><span id="line-1595"></span><span>                     </span><span id="local-6989586621683156989"><span class="annot"><a href="#local-6989586621683156989"><span class="hs-identifier hs-var">infErrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span>
</span><span id="line-1596"></span><span>                     </span><span class="annot"><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-type">clearDiagnostics</span></a></span><span>
</span><span id="line-1597"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683156989"><span class="hs-identifier hs-type">infErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683156988"><span class="hs-identifier hs-type">infPkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1598"></span><span>
</span><span id="line-1599"></span><span>        </span><span class="hs-comment">-- restore old errors</span><span>
</span><span id="line-1600"></span><span>        </span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156979"><span class="hs-identifier hs-type">oldErrs</span></a></span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span>        </span><span id="local-6989586621683156990"><span class="annot"><a href="#local-6989586621683156990"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-type">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-1603"></span><span>        </span><span id="local-6989586621683156991"><span class="annot"><a href="#local-6989586621683156991"><span class="hs-identifier hs-var">print_config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initPrintConfig"><span class="hs-identifier hs-type">initPrintConfig</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-1604"></span><span>        </span><span id="local-6989586621683156992"><span class="annot"><a href="#local-6989586621683156992"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-1605"></span><span>
</span><span id="line-1606"></span><span>        </span><span class="hs-comment">-- Will throw if failed safe check</span><span>
</span><span id="line-1607"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html#printOrThrowDiagnostics"><span class="hs-identifier hs-type">printOrThrowDiagnostics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156992"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156991"><span class="hs-identifier hs-type">print_config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156990"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156984"><span class="hs-identifier hs-type">safeErrs</span></a></span><span>
</span><span id="line-1608"></span><span>
</span><span id="line-1609"></span><span>        </span><span class="hs-comment">-- No fatal warnings or errors: passed safe check</span><span>
</span><span id="line-1610"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156993"><span class="annot"><a href="#local-6989586621683156993"><span class="hs-identifier hs-var hs-var">infPassed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Bool
forall e. Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-var">isEmptyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156985"><span class="hs-identifier hs-var">infErrs</span></a></span><span>
</span><span id="line-1611"></span><span>        </span><span id="local-6989586621683156994"><span class="annot"><a href="#local-6989586621683156994"><span class="hs-identifier hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683156993"><span class="hs-identifier hs-type">infPassed</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1612"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Messages GhcMessage -&gt; Hsc TcGblEnv
forall e. Diagnostic e =&gt; TcGblEnv -&gt; Messages e -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-var">markUnsafeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156971"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683156985"><span class="hs-identifier hs-var">infErrs</span></a></span><span>
</span><span id="line-1613"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156971"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1614"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#packageTrustOn"><span class="hs-identifier hs-type">packageTrustOn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156972"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-type">checkPkgTrust</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156997"><span class="hs-identifier hs-type">pkgReqs</span></a></span><span>
</span><span id="line-1615"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683156998"><span class="annot"><a href="#local-6989586621683156998"><span class="hs-identifier hs-var hs-var">newTrust</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Set UnitId -&gt; Set UnitId -&gt; Bool -&gt; ImportAvails
</span><a href="#local-6989586621683156999"><span class="hs-identifier hs-var">pkgTrustReqs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683156972"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683156980"><span class="hs-identifier hs-var">safePkgs</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683156986"><span class="hs-identifier hs-var">infPkgs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683156993"><span class="hs-identifier hs-var">infPassed</span></a></span><span>
</span><span id="line-1616"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683156994"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157001"><span class="hs-identifier hs-type">impInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#plusImportAvails"><span class="hs-operator hs-type">`plusImportAvails`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683156998"><span class="hs-identifier hs-type">newTrust</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1617"></span><span>
</span><span id="line-1618"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1619"></span><span>    </span><span id="local-6989586621683157001"><span class="annot"><span class="annottext">impInfo :: ImportAvails
</span><a href="#local-6989586621683157001"><span class="hs-identifier hs-var hs-var">impInfo</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683156971"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>     </span><span class="hs-comment">-- ImportAvails</span><span>
</span><span id="line-1620"></span><span>    </span><span id="local-6989586621683157003"><span class="annot"><span class="annottext">imports :: ImportedMods
</span><a href="#local-6989586621683157003"><span class="hs-identifier hs-var hs-var">imports</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; ImportedMods
</span><a href="GHC.Unit.Module.Deps.html#imp_mods"><span class="hs-identifier hs-var">imp_mods</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683157001"><span class="hs-identifier hs-var">impInfo</span></a></span><span>        </span><span class="hs-comment">-- ImportedMods</span><span>
</span><span id="line-1621"></span><span>    </span><span id="local-6989586621683157005"><span class="annot"><span class="annottext">imports1 :: [(Module, [ImportedBy])]
</span><a href="#local-6989586621683157005"><span class="hs-identifier hs-var hs-var">imports1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportedMods -&gt; [(Module, [ImportedBy])]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedMods
</span><a href="#local-6989586621683157003"><span class="hs-identifier hs-var">imports</span></a></span><span> </span><span class="hs-comment">-- (Module, [ImportedBy])</span><span>
</span><span id="line-1622"></span><span>    </span><span id="local-6989586621683156975"><span class="annot"><span class="annottext">imports' :: [(Module, [ImportedModsVal])]
</span><a href="#local-6989586621683156975"><span class="hs-identifier hs-var hs-var">imports'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Module, [ImportedBy]) -&gt; (Module, [ImportedModsVal]))
-&gt; [(Module, [ImportedBy])] -&gt; [(Module, [ImportedModsVal])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([ImportedBy] -&gt; [ImportedModsVal])
-&gt; (Module, [ImportedBy]) -&gt; (Module, [ImportedModsVal])
forall a b. (a -&gt; b) -&gt; (Module, a) -&gt; (Module, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[ImportedBy] -&gt; [ImportedModsVal]
</span><a href="GHC.Unit.Module.Imported.html#importedByUser"><span class="hs-identifier hs-var">importedByUser</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Module, [ImportedBy])]
</span><a href="#local-6989586621683157005"><span class="hs-identifier hs-var">imports1</span></a></span><span> </span><span class="hs-comment">-- (Module, [ImportedModsVal])</span><span>
</span><span id="line-1623"></span><span>    </span><span id="local-6989586621683156997"><span class="annot"><span class="annottext">pkgReqs :: Set UnitId
</span><a href="#local-6989586621683156997"><span class="hs-identifier hs-var hs-var">pkgReqs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683157001"><span class="hs-identifier hs-var">impInfo</span></a></span><span>  </span><span class="hs-comment">-- [Unit]</span><span>
</span><span id="line-1624"></span><span>
</span><span id="line-1625"></span><span>    </span><span class="annot"><a href="#local-6989586621683156974"><span class="hs-identifier hs-type">condense</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Imported.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#IsSafeImport"><span class="hs-identifier hs-type">IsSafeImport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1626"></span><span>    </span><span id="local-6989586621683156974"><span class="annot"><span class="annottext">condense :: (Module, [ImportedModsVal]) -&gt; Hsc (Module, SrcSpan, Bool)
</span><a href="#local-6989586621683156974"><span class="hs-identifier hs-var hs-var">condense</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Hsc (Module, SrcSpan, Bool)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;GHC.Driver.Main.condense: Pattern match failure!&quot;</span></span><span>
</span><span id="line-1627"></span><span>    </span><span class="annot"><a href="#local-6989586621683156974"><span class="hs-identifier hs-var">condense</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157010"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157010"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157011"><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157011"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683157012"><span class="annot"><span class="annottext">[ImportedModsVal]
</span><a href="#local-6989586621683157012"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683157013"><span class="annot"><a href="#local-6989586621683157013"><span class="hs-identifier hs-var">imv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImportedModsVal -&gt; ImportedModsVal -&gt; Hsc ImportedModsVal)
-&gt; ImportedModsVal -&gt; [ImportedModsVal] -&gt; Hsc ImportedModsVal
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; ImportedModsVal -&gt; Hsc ImportedModsVal
</span><a href="#local-6989586621683157015"><span class="hs-identifier hs-var">cond'</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157011"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedModsVal]
</span><a href="#local-6989586621683157012"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1628"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157010"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html#imv_span"><span class="hs-identifier hs-var">imv_span</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157013"><span class="hs-identifier hs-type">imv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html#imv_is_safe"><span class="hs-identifier hs-var">imv_is_safe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157013"><span class="hs-identifier hs-type">imv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1629"></span><span>
</span><span id="line-1630"></span><span>    </span><span class="hs-comment">-- ImportedModsVal = (ModuleName, Bool, SrcSpan, IsSafeImport)</span><span>
</span><span id="line-1631"></span><span>    </span><span class="annot"><a href="#local-6989586621683157015"><span class="hs-identifier hs-type">cond'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span>
</span><span id="line-1632"></span><span>    </span><span id="local-6989586621683157015"><span class="annot"><span class="annottext">cond' :: ImportedModsVal -&gt; ImportedModsVal -&gt; Hsc ImportedModsVal
</span><a href="#local-6989586621683157015"><span class="hs-identifier hs-var hs-var">cond'</span></a></span></span><span> </span><span id="local-6989586621683157018"><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157018"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span id="local-6989586621683157019"><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157019"><span class="hs-identifier hs-var">v2</span></a></span></span><span>
</span><span id="line-1633"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; Bool
</span><a href="GHC.Unit.Module.Imported.html#imv_is_safe"><span class="hs-identifier hs-var">imv_is_safe</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157018"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; Bool
</span><a href="GHC.Unit.Module.Imported.html#imv_is_safe"><span class="hs-identifier hs-var">imv_is_safe</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157019"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-1634"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Hsc ImportedModsVal
forall (io :: * -&gt; *) a.
MonadIO io =&gt;
MsgEnvelope GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Hsc ImportedModsVal)
-&gt; MsgEnvelope GhcMessage -&gt; Hsc ImportedModsVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1635"></span><span>            </span><span class="annot"><span class="annottext">SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedModsVal -&gt; SrcSpan
</span><a href="GHC.Unit.Module.Imported.html#imv_span"><span class="hs-identifier hs-var">imv_span</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157018"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1636"></span><span>            </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverMixedSafetyImport"><span class="hs-identifier hs-var">DriverMixedSafetyImport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedModsVal -&gt; ModuleName
</span><a href="GHC.Unit.Module.Imported.html#imv_name"><span class="hs-identifier hs-var">imv_name</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157018"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1638"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; Hsc ImportedModsVal
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683157018"><span class="hs-identifier hs-var">v1</span></a></span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span>    </span><span class="hs-comment">-- easier interface to work with</span><span>
</span><span id="line-1641"></span><span>    </span><span id="local-6989586621683154852"><span class="annot"><a href="#local-6989586621683156983"><span class="hs-identifier hs-type">checkSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683154852"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1642"></span><span>    </span><span id="local-6989586621683156983"><span class="annot"><span class="annottext">checkSafe :: forall a. (Module, SrcSpan, a) -&gt; Hsc (Maybe UnitId)
</span><a href="#local-6989586621683156983"><span class="hs-identifier hs-var hs-var">checkSafe</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157025"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157025"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157026"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157026"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Maybe UnitId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Maybe UnitId, Set UnitId) -&gt; Maybe UnitId)
-&gt; Hsc (Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId)
forall a b. (a -&gt; b) -&gt; Hsc a -&gt; Hsc b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SrcSpan -&gt; Hsc (Maybe UnitId, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-var">hscCheckSafe'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157025"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157026"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1643"></span><span>
</span><span id="line-1644"></span><span>    </span><span class="hs-comment">-- what pkg's to add to our trust requirements</span><span>
</span><span id="line-1645"></span><span>    </span><span class="annot"><a href="#local-6989586621683156999"><span class="hs-identifier hs-type">pkgTrustReqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1646"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span>
</span><span id="line-1647"></span><span>    </span><span id="local-6989586621683156999"><span class="annot"><span class="annottext">pkgTrustReqs :: DynFlags -&gt; Set UnitId -&gt; Set UnitId -&gt; Bool -&gt; ImportAvails
</span><a href="#local-6989586621683156999"><span class="hs-identifier hs-var hs-var">pkgTrustReqs</span></a></span></span><span> </span><span id="local-6989586621683157028"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157028"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683157029"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157029"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621683157030"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157030"><span class="hs-identifier hs-var">inf</span></a></span></span><span> </span><span id="local-6989586621683157031"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157031"><span class="hs-identifier hs-var">infPassed</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157028"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1648"></span><span>                                  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeHaskellModeEnabled"><span class="hs-identifier hs-var">safeHaskellModeEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157028"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157031"><span class="hs-identifier hs-var">infPassed</span></a></span><span>
</span><span id="line-1649"></span><span>                                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1650"></span><span>                                       </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157029"><span class="hs-identifier hs-type">req</span></a></span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-type">`S.union`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157030"><span class="hs-identifier hs-type">inf</span></a></span><span>
</span><span id="line-1651"></span><span>                                   </span><span class="hs-special">}</span><span>
</span><span id="line-1652"></span><span>    </span><span class="annot"><a href="#local-6989586621683156999"><span class="hs-identifier hs-var">pkgTrustReqs</span></a></span><span> </span><span id="local-6989586621683157034"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157034"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Set UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.DynFlags.html#safeHaskell"><span class="hs-identifier hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157034"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Unsafe"><span class="hs-identifier hs-var">Sf_Unsafe</span></a></span><span>
</span><span id="line-1653"></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span>
</span><span id="line-1654"></span><span>    </span><span class="annot"><a href="#local-6989586621683156999"><span class="hs-identifier hs-var">pkgTrustReqs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683157036"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157036"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157036"><span class="hs-identifier hs-type">req</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1655"></span><span>
</span><span id="line-1656"></span><span class="hs-comment">-- | Check that a module is safe to import.</span><span>
</span><span id="line-1657"></span><span class="hs-comment">--</span><span>
</span><span id="line-1658"></span><span class="hs-comment">-- We return True to indicate the import is safe and False otherwise</span><span>
</span><span id="line-1659"></span><span class="hs-comment">-- although in the False case an exception may be thrown first.</span><span>
</span><span id="line-1660"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafe"><span class="hs-identifier hs-type">hscCheckSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1661"></span><span id="hscCheckSafe"><span class="annot"><span class="annottext">hscCheckSafe :: HscEnv -&gt; Module -&gt; SrcSpan -&gt; IO Bool
</span><a href="GHC.Driver.Main.html#hscCheckSafe"><span class="hs-identifier hs-var hs-var">hscCheckSafe</span></a></span></span><span> </span><span id="local-6989586621683157037"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157037"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157038"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157038"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683157039"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157039"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc Bool -&gt; IO Bool
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157037"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc Bool -&gt; IO Bool) -&gt; Hsc Bool -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1662"></span><span>    </span><span id="local-6989586621683157040"><span class="annot"><a href="#local-6989586621683157040"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1663"></span><span>    </span><span id="local-6989586621683157041"><span class="annot"><a href="#local-6989586621683157041"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`fmap`</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-type">hscCheckSafe'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157038"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157039"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-1664"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#packageTrustOn"><span class="hs-identifier hs-type">packageTrustOn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157040"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-type">checkPkgTrust</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157041"><span class="hs-identifier hs-type">pkgs</span></a></span><span>
</span><span id="line-1665"></span><span>    </span><span id="local-6989586621683157043"><span class="annot"><a href="#local-6989586621683157043"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span>
</span><span id="line-1666"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-type">isEmptyMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157043"><span class="hs-identifier hs-type">errs</span></a></span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span class="annot"><span class="hs-comment">-- | Return if a module is trusted and the pkgs it depends on to be trusted.</span></span><span>
</span><span id="line-1669"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGetSafe"><span class="hs-identifier hs-type">hscGetSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span id="hscGetSafe"><span class="annot"><span class="annottext">hscGetSafe :: HscEnv -&gt; Module -&gt; SrcSpan -&gt; IO (Bool, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscGetSafe"><span class="hs-identifier hs-var hs-var">hscGetSafe</span></a></span></span><span> </span><span id="local-6989586621683157044"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157044"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157045"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157045"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683157046"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157046"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Bool, Set UnitId) -&gt; IO (Bool, Set UnitId)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157044"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Bool, Set UnitId) -&gt; IO (Bool, Set UnitId))
-&gt; Hsc (Bool, Set UnitId) -&gt; IO (Bool, Set UnitId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1671"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157047"><span class="annot"><a href="#local-6989586621683157047"><span class="hs-identifier hs-var">self</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157048"><span class="annot"><a href="#local-6989586621683157048"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; SrcSpan -&gt; Hsc (Maybe UnitId, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-var">hscCheckSafe'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157045"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157046"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1672"></span><span>    </span><span id="local-6989586621683157049"><span class="annot"><a href="#local-6989586621683157049"><span class="hs-identifier hs-var">good</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-type">isEmptyMessages</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`fmap`</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getDiagnostics"><span class="hs-identifier hs-type">getDiagnostics</span></a></span><span>
</span><span id="line-1673"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#clearDiagnostics"><span class="hs-identifier hs-type">clearDiagnostics</span></a></span><span> </span><span class="hs-comment">-- don't want them printed...</span><span>
</span><span id="line-1674"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157050"><span class="annot"><a href="#local-6989586621683157050"><span class="hs-identifier hs-var hs-var">pkgs'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157051"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683157051"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621683157047"><span class="hs-identifier hs-var">self</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683157051"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157048"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1675"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157048"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1676"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157049"><span class="hs-identifier hs-type">good</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157050"><span class="hs-identifier hs-type">pkgs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>
</span><span id="line-1678"></span><span class="hs-comment">-- | Is a module trusted? If not, throw or log errors depending on the type.</span><span>
</span><span id="line-1679"></span><span class="hs-comment">-- Return (regardless of trusted or not) if the trust type requires the modules</span><span>
</span><span id="line-1680"></span><span class="hs-comment">-- own package be trusted and a list of other packages required to be trusted</span><span>
</span><span id="line-1681"></span><span class="hs-comment">-- (these later ones haven't been checked) but the own package trust has been.</span><span>
</span><span id="line-1682"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-type">hscCheckSafe'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1683"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span id="hscCheckSafe%27"><span class="annot"><span class="annottext">hscCheckSafe' :: Module -&gt; SrcSpan -&gt; Hsc (Maybe UnitId, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-var hs-var">hscCheckSafe'</span></a></span></span><span> </span><span id="local-6989586621683157053"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157053"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683157054"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157054"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1685"></span><span>    </span><span id="local-6989586621683157055"><span class="annot"><a href="#local-6989586621683157055"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1686"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157056"><span class="annot"><a href="#local-6989586621683157056"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157055"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1687"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157057"><span class="annot"><a href="#local-6989586621683157057"><span class="hs-identifier hs-var">tw</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157058"><span class="annot"><a href="#local-6989586621683157058"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683157059"><span class="hs-identifier hs-type">isModSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157056"><span class="hs-identifier hs-type">home_unit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157053"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157054"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-1688"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683157057"><span class="hs-identifier hs-type">tw</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1689"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId, Set UnitId)
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157058"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1690"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; Module -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeModule"><span class="hs-identifier hs-var">isHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683157056"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157053"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId, Set UnitId)
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157058"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1691"></span><span>             </span><span class="hs-comment">-- TODO: do we also have to check the trust of the instantiation?</span><span>
</span><span id="line-1692"></span><span>             </span><span class="hs-comment">-- Not necessary if that is reflected in dependencies</span><span>
</span><span id="line-1693"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId, Set UnitId)
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Maybe UnitId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Maybe UnitId) -&gt; UnitId -&gt; Maybe UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157053"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157058"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1694"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1695"></span><span>    </span><span class="annot"><a href="#local-6989586621683157059"><span class="hs-identifier hs-type">isModSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1696"></span><span>    </span><span id="local-6989586621683157059"><span class="annot"><span class="annottext">isModSafe :: HomeUnit -&gt; Module -&gt; SrcSpan -&gt; Hsc (Bool, Set UnitId)
</span><a href="#local-6989586621683157059"><span class="hs-identifier hs-var hs-var">isModSafe</span></a></span></span><span> </span><span id="local-6989586621683157062"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683157062"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span id="local-6989586621683157063"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157063"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683157064"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157064"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1697"></span><span>        </span><span id="local-6989586621683157065"><span class="annot"><a href="#local-6989586621683157065"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1698"></span><span>        </span><span id="local-6989586621683157066"><span class="annot"><a href="#local-6989586621683157066"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-1699"></span><span>        </span><span id="local-6989586621683157067"><span class="annot"><a href="#local-6989586621683157067"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683157068"><span class="hs-identifier hs-type">lookup'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157063"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1700"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157069"><span class="annot"><a href="#local-6989586621683157069"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157066"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1701"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683157067"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1702"></span><span>            </span><span class="hs-comment">-- can't load iface to check trust!</span><span>
</span><span id="line-1703"></span><span>            </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Hsc (Bool, Set UnitId)
forall (io :: * -&gt; *) a.
MonadIO io =&gt;
MsgEnvelope GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Hsc (Bool, Set UnitId))
-&gt; MsgEnvelope GhcMessage -&gt; Hsc (Bool, Set UnitId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1704"></span><span>                         </span><span class="annot"><span class="annottext">SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157064"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1705"></span><span>                         </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverCannotLoadInterfaceFile"><span class="hs-identifier hs-var">DriverCannotLoadInterfaceFile</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157063"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1706"></span><span>
</span><span id="line-1707"></span><span>            </span><span class="hs-comment">-- got iface, check trust</span><span>
</span><span id="line-1708"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157071"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683157071"><span class="hs-identifier hs-var">iface'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1709"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157072"><span class="annot"><span class="annottext">trust :: SafeHaskellMode
</span><a href="#local-6989586621683157072"><span class="hs-identifier hs-var hs-var">trust</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceTrustInfo -&gt; SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#getSafeMode"><span class="hs-identifier hs-var">getSafeMode</span></a></span><span> </span><span class="annot"><span class="annottext">(IfaceTrustInfo -&gt; SafeHaskellMode)
-&gt; IfaceTrustInfo -&gt; SafeHaskellMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IfaceTrustInfo
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; IfaceTrustInfo
</span><a href="GHC.Unit.Module.ModIface.html#mi_trust"><span class="hs-identifier hs-var">mi_trust</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683157071"><span class="hs-identifier hs-var">iface'</span></a></span><span>
</span><span id="line-1710"></span><span>                    </span><span id="local-6989586621683157075"><span class="annot"><span class="annottext">trust_own_pkg :: Bool
</span><a href="#local-6989586621683157075"><span class="hs-identifier hs-var hs-var">trust_own_pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Bool
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Bool
</span><a href="GHC.Unit.Module.ModIface.html#mi_trust_pkg"><span class="hs-identifier hs-var">mi_trust_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683157071"><span class="hs-identifier hs-var">iface'</span></a></span><span>
</span><span id="line-1711"></span><span>                    </span><span class="hs-comment">-- check module is trusted</span><span>
</span><span id="line-1712"></span><span>                    </span><span id="local-6989586621683157077"><span class="annot"><span class="annottext">safeM :: Bool
</span><a href="#local-6989586621683157077"><span class="hs-identifier hs-var hs-var">safeM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683157072"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; [SafeHaskellMode] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1713"></span><span>                    </span><span class="hs-comment">-- check package is trusted</span><span>
</span><span id="line-1714"></span><span>                    </span><span id="local-6989586621683157080"><span class="annot"><span class="annottext">safeP :: Bool
</span><a href="#local-6989586621683157080"><span class="hs-identifier hs-var hs-var">safeP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; UnitState
-&gt; HomeUnit
-&gt; SafeHaskellMode
-&gt; Bool
-&gt; Module
-&gt; Bool
</span><a href="#local-6989586621683157081"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157066"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157065"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683157062"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683157072"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157075"><span class="hs-identifier hs-var">trust_own_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157063"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1715"></span><span>                    </span><span class="hs-comment">-- pkg trust reqs</span><span>
</span><span id="line-1716"></span><span>                    </span><span id="local-6989586621683157082"><span class="annot"><span class="annottext">pkgRs :: Set UnitId
</span><a href="#local-6989586621683157082"><span class="hs-identifier hs-var hs-var">pkgRs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#dep_trusted_pkgs"><span class="hs-identifier hs-var">dep_trusted_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">(Dependencies -&gt; Set UnitId) -&gt; Dependencies -&gt; Set UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Dependencies
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Dependencies
</span><a href="GHC.Unit.Module.ModIface.html#mi_deps"><span class="hs-identifier hs-var">mi_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683157071"><span class="hs-identifier hs-var">iface'</span></a></span><span>
</span><span id="line-1717"></span><span>                    </span><span class="hs-comment">-- warn if Safe module imports Safe-Inferred module.</span><span>
</span><span id="line-1718"></span><span>                    </span><span id="local-6989586621683157085"><span class="annot"><span class="annottext">warns :: Messages GhcMessage
</span><a href="#local-6989586621683157085"><span class="hs-identifier hs-var hs-var">warns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnInferredSafeImports"><span class="hs-identifier hs-var">Opt_WarnInferredSafeImports</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157066"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1719"></span><span>                                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeLanguageOn"><span class="hs-identifier hs-var">safeLanguageOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157066"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1720"></span><span>                                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683157072"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span>
</span><span id="line-1721"></span><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiagOpts -&gt; Messages GhcMessage
</span><a href="#local-6989586621683157087"><span class="hs-identifier hs-var">inferredImportWarn</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683157069"><span class="hs-identifier hs-var">diag_opts</span></a></span><span>
</span><span id="line-1722"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1723"></span><span>                    </span><span class="hs-comment">-- General errors we throw but Safe errors we log</span><span>
</span><span id="line-1724"></span><span>                    </span><span id="local-6989586621683157088"><span class="annot"><span class="annottext">errs :: Messages GhcMessage
</span><a href="#local-6989586621683157088"><span class="hs-identifier hs-var hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157077"><span class="hs-identifier hs-var">safeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157080"><span class="hs-identifier hs-var">safeP</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1725"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1726"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683157089"><span class="hs-identifier hs-var">pkgTrustErr</span></a></span><span>
</span><span id="line-1727"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683157090"><span class="hs-identifier hs-var">modTrustErr</span></a></span><span>
</span><span id="line-1728"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1729"></span><span>                    </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683157085"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-1730"></span><span>                    </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621683157088"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-1731"></span><span>                    </span><span class="annot"><span class="annottext">(Bool, Set UnitId) -&gt; Hsc (Bool, Set UnitId)
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683157072"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157082"><span class="hs-identifier hs-var">pkgRs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>
</span><span id="line-1733"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-1734"></span><span>                    </span><span id="local-6989586621683157091"><span class="annot"><span class="annottext">state :: UnitState
</span><a href="#local-6989586621683157091"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157065"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1735"></span><span>                    </span><span id="local-6989586621683157087"><span class="annot"><span class="annottext">inferredImportWarn :: DiagOpts -&gt; Messages GhcMessage
</span><a href="#local-6989586621683157087"><span class="hs-identifier hs-var hs-var">inferredImportWarn</span></a></span></span><span> </span><span id="local-6989586621683157092"><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683157092"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span>
</span><span id="line-1736"></span><span>                        </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Messages GhcMessage)
-&gt; MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiagOpts
-&gt; SrcSpan -&gt; NamePprCtx -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e.
Diagnostic e =&gt;
DiagOpts -&gt; SrcSpan -&gt; NamePprCtx -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkMsgEnvelope"><span class="hs-identifier hs-var">mkMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683157092"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157064"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157091"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1737"></span><span>                        </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverInferredSafeImport"><span class="hs-identifier hs-var">DriverInferredSafeImport</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157063"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1738"></span><span>                    </span><span id="local-6989586621683157089"><span class="annot"><span class="annottext">pkgTrustErr :: Messages GhcMessage
</span><a href="#local-6989586621683157089"><span class="hs-identifier hs-var hs-var">pkgTrustErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span>
</span><span id="line-1739"></span><span>                      </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Messages GhcMessage)
-&gt; MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; NamePprCtx -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e.
Diagnostic e =&gt;
SrcSpan -&gt; NamePprCtx -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkErrorMsgEnvelope"><span class="hs-identifier hs-var">mkErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157064"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157091"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1740"></span><span>                      </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; Module -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverCannotImportFromUntrustedPackage"><span class="hs-identifier hs-var">DriverCannotImportFromUntrustedPackage</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157091"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157063"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1741"></span><span>                    </span><span id="local-6989586621683157090"><span class="annot"><span class="annottext">modTrustErr :: Messages GhcMessage
</span><a href="#local-6989586621683157090"><span class="hs-identifier hs-var hs-var">modTrustErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span>
</span><span id="line-1742"></span><span>                      </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Messages GhcMessage)
-&gt; MsgEnvelope GhcMessage -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; NamePprCtx -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e.
Diagnostic e =&gt;
SrcSpan -&gt; NamePprCtx -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkErrorMsgEnvelope"><span class="hs-identifier hs-var">mkErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157064"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157091"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1743"></span><span>                      </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverCannotImportUnsafeModule"><span class="hs-identifier hs-var">DriverCannotImportUnsafeModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157063"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1744"></span><span>
</span><span id="line-1745"></span><span>    </span><span class="hs-comment">-- Check the package a module resides in is trusted. Safe compiled</span><span>
</span><span id="line-1746"></span><span>    </span><span class="hs-comment">-- modules are trusted without requiring that their package is trusted. For</span><span>
</span><span id="line-1747"></span><span>    </span><span class="hs-comment">-- trustworthy modules, modules in the home package are trusted but</span><span>
</span><span id="line-1748"></span><span>    </span><span class="hs-comment">-- otherwise we check the package trust flag.</span><span>
</span><span id="line-1749"></span><span>    </span><span class="annot"><a href="#local-6989586621683157081"><span class="hs-identifier hs-type">packageTrusted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1750"></span><span>    </span><span id="local-6989586621683157081"><span class="annot"><span class="annottext">packageTrusted :: DynFlags
-&gt; UnitState
-&gt; HomeUnit
-&gt; SafeHaskellMode
-&gt; Bool
-&gt; Module
-&gt; Bool
</span><a href="#local-6989586621683157081"><span class="hs-identifier hs-var hs-var">packageTrusted</span></a></span></span><span> </span><span id="local-6989586621683157099"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157099"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683157100"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157100"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span id="local-6989586621683157101"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683157101"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span id="local-6989586621683157102"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683157102"><span class="hs-identifier hs-var">safe_mode</span></a></span></span><span> </span><span id="local-6989586621683157103"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157103"><span class="hs-identifier hs-var">trust_own_pkg</span></a></span></span><span> </span><span id="local-6989586621683157104"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157104"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1751"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683157102"><span class="hs-identifier hs-var">safe_mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1752"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- shouldn't hit these cases</span><span>
</span><span id="line-1753"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Ignore"><span class="hs-identifier hs-var">Sf_Ignore</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- shouldn't hit these cases</span><span>
</span><span id="line-1754"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Unsafe"><span class="hs-identifier hs-var">Sf_Unsafe</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- prefer for completeness.</span><span>
</span><span id="line-1755"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#packageTrustOn"><span class="hs-identifier hs-var">packageTrustOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157099"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1756"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157103"><span class="hs-identifier hs-var">trust_own_pkg</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1757"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157103"><span class="hs-identifier hs-var">trust_own_pkg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1758"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; Module -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeModule"><span class="hs-identifier hs-var">isHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683157101"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157104"><span class="hs-identifier hs-var">mod</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1759"></span><span>            </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo PackageId PackageName UnitId ModuleName Module
-&gt; Bool
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Bool
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Unit.Database.html#unitIsTrusted"><span class="hs-identifier hs-var">unitIsTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo PackageId PackageName UnitId ModuleName Module
 -&gt; Bool)
-&gt; GenericUnitInfo PackageId PackageName UnitId ModuleName Module
-&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
UnitState
-&gt; GenUnit UnitId
-&gt; GenericUnitInfo PackageId PackageName UnitId ModuleName Module
UnitState
-&gt; GenUnit UnitId
-&gt; GenericUnitInfo PackageId PackageName UnitId ModuleName Module
</span><a href="GHC.Unit.State.html#unsafeLookupUnit"><span class="hs-identifier hs-var">unsafeLookupUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157100"><span class="hs-identifier hs-var">unit_state</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157053"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1760"></span><span>
</span><span id="line-1761"></span><span>    </span><span class="annot"><a href="#local-6989586621683157068"><span class="hs-identifier hs-type">lookup'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1762"></span><span>    </span><span id="local-6989586621683157068"><span class="annot"><span class="annottext">lookup' :: Module -&gt; Hsc (Maybe ModIface)
</span><a href="#local-6989586621683157068"><span class="hs-identifier hs-var hs-var">lookup'</span></a></span></span><span> </span><span id="local-6989586621683157109"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157109"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1763"></span><span>        </span><span id="local-6989586621683157110"><span class="annot"><a href="#local-6989586621683157110"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1764"></span><span>        </span><span id="local-6989586621683157111"><span class="annot"><a href="#local-6989586621683157111"><span class="hs-identifier hs-var">hsc_eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-type">hscEPS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157110"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-1765"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157113"><span class="annot"><a href="#local-6989586621683157113"><span class="hs-identifier hs-var hs-var">pkgIfaceT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; PackageIfaceTable
</span><a href="GHC.Unit.External.html#eps_PIT"><span class="hs-identifier hs-var">eps_PIT</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621683157111"><span class="hs-identifier hs-var">hsc_eps</span></a></span><span>
</span><span id="line-1766"></span><span>            </span><span id="local-6989586621683157115"><span class="annot"><a href="#local-6989586621683157115"><span class="hs-identifier hs-var hs-var">hug</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnitGraph
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157110"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1767"></span><span>            </span><span id="local-6989586621683157117"><span class="annot"><a href="#local-6989586621683157117"><span class="hs-identifier hs-var hs-var">iface</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph -&gt; PackageIfaceTable -&gt; Module -&gt; Maybe ModIface
</span><a href="GHC.Driver.Env.html#lookupIfaceByModule"><span class="hs-identifier hs-var">lookupIfaceByModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621683157115"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIfaceTable
</span><a href="#local-6989586621683157113"><span class="hs-identifier hs-var">pkgIfaceT</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157109"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1768"></span><span>        </span><span class="hs-comment">-- the 'lookupIfaceByModule' method will always fail when calling from GHCi</span><span>
</span><span id="line-1769"></span><span>        </span><span class="hs-comment">-- as the compiler hasn't filled in the various module tables</span><span>
</span><span id="line-1770"></span><span>        </span><span class="hs-comment">-- so we need to call 'getModuleInterface' to load from disk</span><span>
</span><span id="line-1771"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683157117"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1772"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface -&gt; Hsc (Maybe ModIface)
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621683157117"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1773"></span><span>            </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Messages TcRnMessage, Maybe ModIface) -&gt; Maybe ModIface
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Messages TcRnMessage, Maybe ModIface) -&gt; Maybe ModIface)
-&gt; Hsc (Messages TcRnMessage, Maybe ModIface)
-&gt; Hsc (Maybe ModIface)
forall a b. (a -&gt; b) -&gt; Hsc a -&gt; Hsc b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Messages TcRnMessage, Maybe ModIface)
-&gt; Hsc (Messages TcRnMessage, Maybe ModIface)
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Messages TcRnMessage, Maybe ModIface)
 -&gt; Hsc (Messages TcRnMessage, Maybe ModIface))
-&gt; IO (Messages TcRnMessage, Maybe ModIface)
-&gt; Hsc (Messages TcRnMessage, Maybe ModIface)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Module -&gt; IO (Messages TcRnMessage, Maybe ModIface)
</span><a href="GHC.Tc.Module.html#getModuleInterface"><span class="hs-identifier hs-var">getModuleInterface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157110"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157109"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1774"></span><span>
</span><span id="line-1775"></span><span>
</span><span id="line-1776"></span><span class="annot"><span class="hs-comment">-- | Check the list of packages are trusted.</span></span><span>
</span><span id="line-1777"></span><span class="annot"><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-type">checkPkgTrust</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1778"></span><span id="checkPkgTrust"><span class="annot"><span class="annottext">checkPkgTrust :: Set UnitId -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-var hs-var">checkPkgTrust</span></a></span></span><span> </span><span id="local-6989586621683157119"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157119"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1779"></span><span>    </span><span id="local-6989586621683157120"><span class="annot"><a href="#local-6989586621683157120"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1780"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157121"><span class="annot"><a href="#local-6989586621683157121"><span class="hs-identifier hs-var hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId
 -&gt; Bag (MsgEnvelope GhcMessage) -&gt; Bag (MsgEnvelope GhcMessage))
-&gt; Bag (MsgEnvelope GhcMessage)
-&gt; Set UnitId
-&gt; Bag (MsgEnvelope GhcMessage)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Set a -&gt; b
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#foldr"><span class="hs-identifier hs-var">S.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
-&gt; Bag (MsgEnvelope GhcMessage) -&gt; Bag (MsgEnvelope GhcMessage)
</span><a href="#local-6989586621683157123"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope GhcMessage)
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683157119"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1781"></span><span>        </span><span id="local-6989586621683157125"><span class="annot"><a href="#local-6989586621683157125"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157120"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1782"></span><span>        </span><span id="local-6989586621683157123"><span class="annot"><a href="#local-6989586621683157123"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683157126"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683157126"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span id="local-6989586621683157127"><span class="annot"><span class="annottext">Bag (MsgEnvelope GhcMessage)
</span><a href="#local-6989586621683157127"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-1783"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo PackageId PackageName UnitId ModuleName Module
-&gt; Bool
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Bool
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Unit.Database.html#unitIsTrusted"><span class="hs-identifier hs-var">unitIsTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo PackageId PackageName UnitId ModuleName Module
 -&gt; Bool)
-&gt; GenericUnitInfo PackageId PackageName UnitId ModuleName Module
-&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
UnitState
-&gt; UnitId
-&gt; GenericUnitInfo PackageId PackageName UnitId ModuleName Module
UnitState
-&gt; UnitId
-&gt; GenericUnitInfo PackageId PackageName UnitId ModuleName Module
</span><a href="GHC.Unit.State.html#unsafeLookupUnitId"><span class="hs-identifier hs-var">unsafeLookupUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157125"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683157126"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1784"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope GhcMessage)
</span><a href="#local-6989586621683157127"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1785"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1786"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage
-&gt; Bag (MsgEnvelope GhcMessage) -&gt; Bag (MsgEnvelope GhcMessage)
forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-operator hs-var">`consBag`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope GhcMessage)
</span><a href="#local-6989586621683157127"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1787"></span><span>                     </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; Bag (MsgEnvelope GhcMessage))
-&gt; MsgEnvelope GhcMessage -&gt; Bag (MsgEnvelope GhcMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; NamePprCtx -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e.
Diagnostic e =&gt;
SrcSpan -&gt; NamePprCtx -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkErrorMsgEnvelope"><span class="hs-identifier hs-var">mkErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157125"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1788"></span><span>                     </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span>
</span><span id="line-1789"></span><span>                     </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverPackageNotTrusted"><span class="hs-identifier hs-var">DriverPackageNotTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683157125"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683157126"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1790"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-type">isEmptyBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157121"><span class="hs-identifier hs-type">errors</span></a></span><span>
</span><span id="line-1791"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-type">throwErrors</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#mkMessages"><span class="hs-identifier hs-type">mkMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157121"><span class="hs-identifier hs-type">errors</span></a></span><span>
</span><span id="line-1793"></span><span>
</span><span id="line-1794"></span><span class="hs-comment">-- | Set module to unsafe and (potentially) wipe trust information.</span><span>
</span><span id="line-1795"></span><span class="hs-comment">--</span><span>
</span><span id="line-1796"></span><span class="hs-comment">-- Make sure to call this method to set a module to inferred unsafe, it should</span><span>
</span><span id="line-1797"></span><span class="hs-comment">-- be a central and single failure method. We only wipe the trust information</span><span>
</span><span id="line-1798"></span><span class="hs-comment">-- when we aren't in a specific Safe Haskell mode.</span><span>
</span><span id="line-1799"></span><span class="hs-comment">--</span><span>
</span><span id="line-1800"></span><span class="hs-comment">-- While we only use this for recording that a module was inferred unsafe, we</span><span>
</span><span id="line-1801"></span><span class="hs-comment">-- may call it on modules using Trustworthy or Unsafe flags so as to allow</span><span>
</span><span id="line-1802"></span><span class="hs-comment">-- warning flags for safety to function correctly. See Note [Safe Haskell</span><span>
</span><span id="line-1803"></span><span class="hs-comment">-- Inference].</span><span>
</span><span id="line-1804"></span><span class="annot"><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-type">markUnsafeInfer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683154758"><span class="annot"><a href="#local-6989586621683154758"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Diagnostic"><span class="hs-identifier hs-type">Diagnostic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683154758"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683154758"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1805"></span><span id="markUnsafeInfer"><span class="annot"><span class="annottext">markUnsafeInfer :: forall e. Diagnostic e =&gt; TcGblEnv -&gt; Messages e -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-var hs-var">markUnsafeInfer</span></a></span></span><span> </span><span id="local-6989586621683157162"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157162"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span id="local-6989586621683157163"><span class="annot"><span class="annottext">Messages e
</span><a href="#local-6989586621683157163"><span class="hs-identifier hs-var">whyUnsafe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1806"></span><span>    </span><span id="local-6989586621683157164"><span class="annot"><a href="#local-6989586621683157164"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1807"></span><span>
</span><span id="line-1808"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157165"><span class="annot"><a href="#local-6989586621683157165"><span class="hs-identifier hs-var hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; DiagnosticReason
</span><a href="GHC.Types.Error.html#WarningWithFlag"><span class="hs-identifier hs-var">WarningWithFlag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnsafe"><span class="hs-identifier hs-var">Opt_WarnUnsafe</span></a></span><span>
</span><span id="line-1809"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157168"><span class="annot"><a href="#local-6989586621683157168"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157164"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1810"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#diag_wopt"><span class="hs-identifier hs-type">diag_wopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_WarnUnsafe"><span class="hs-identifier hs-type">Opt_WarnUnsafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157168"><span class="hs-identifier hs-type">diag_opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1811"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Main.html#logDiagnostics"><span class="hs-identifier hs-type">logDiagnostics</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-type">singleMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1812"></span><span>             </span><span class="annot"><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-type">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157168"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#warnUnsafeOnLoc"><span class="hs-identifier hs-var">warnUnsafeOnLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157164"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1813"></span><span>             </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-type">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverUnknownMessage"><span class="hs-identifier hs-type">DriverUnknownMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1814"></span><span>             </span><span class="annot"><a href="GHC.Types.Error.html#mkSimpleUnknownDiagnostic"><span class="hs-identifier hs-type">mkSimpleUnknownDiagnostic</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1815"></span><span>             </span><span class="annot"><a href="GHC.Types.Error.html#mkPlainDiagnostic"><span class="hs-identifier hs-type">mkPlainDiagnostic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157165"><span class="hs-identifier hs-type">reason</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#noHints"><span class="hs-identifier hs-type">noHints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1816"></span><span>             </span><span class="annot"><a href="#local-6989586621683157175"><span class="hs-identifier hs-type">whyUnsafe'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157164"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1817"></span><span>
</span><span id="line-1818"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_safe_infer"><span class="hs-identifier hs-var">tcg_safe_infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157162"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-1819"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_safe_infer_reasons"><span class="hs-identifier hs-var">tcg_safe_infer_reasons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157162"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-type">emptyMessages</span></a></span><span>
</span><span id="line-1820"></span><span>    </span><span class="hs-comment">-- NOTE: Only wipe trust when not in an explicitly safe haskell mode. Other</span><span>
</span><span id="line-1821"></span><span>    </span><span class="hs-comment">-- times inference may be on but we are in Trustworthy mode -- so we want</span><span>
</span><span id="line-1822"></span><span>    </span><span class="hs-comment">-- to record safe-inference failed but not wipe the trust dependencies.</span><span>
</span><span id="line-1823"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#safeHaskellModeEnabled"><span class="hs-identifier hs-type">safeHaskellModeEnabled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157164"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1824"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; Hsc TcGblEnv) -&gt; TcGblEnv -&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157162"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157176"><span class="hs-identifier hs-type">wiped_trust</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1825"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157162"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1826"></span><span>
</span><span id="line-1827"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1828"></span><span>    </span><span id="local-6989586621683157176"><span class="annot"><span class="annottext">wiped_trust :: ImportAvails
</span><a href="#local-6989586621683157176"><span class="hs-identifier hs-var hs-var">wiped_trust</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157162"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-type">S.empty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1829"></span><span>    </span><span id="local-6989586621683157177"><span class="annot"><span class="annottext">pprMod :: SDoc
</span><a href="#local-6989586621683157177"><span class="hs-identifier hs-var hs-var">pprMod</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; SDoc) -&gt; ModuleName -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName) -&gt; Module -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157162"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1830"></span><span>    </span><span id="local-6989586621683157175"><span class="annot"><span class="annottext">whyUnsafe' :: DynFlags -&gt; SDoc
</span><a href="#local-6989586621683157175"><span class="hs-identifier hs-var hs-var">whyUnsafe'</span></a></span></span><span> </span><span id="local-6989586621683157178"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157178"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683157177"><span class="hs-identifier hs-var">pprMod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;has been inferred as unsafe!&quot;</span></span><span>
</span><span id="line-1831"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Reason:&quot;</span></span><span>
</span><span id="line-1832"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [SDoc]
</span><a href="#local-6989586621683157180"><span class="hs-identifier hs-var">badFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157178"><span class="hs-identifier hs-var">df</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a></span><span>
</span><span id="line-1833"></span><span>                                    </span><span class="hs-comment">-- MP: Using defaultDiagnosticOpts here is not right but it's also not right to handle these</span><span>
</span><span id="line-1834"></span><span>                                    </span><span class="hs-comment">-- unsafety error messages in an unstructured manner.</span><span>
</span><span id="line-1835"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiagnosticOpts e -&gt; Bag (MsgEnvelope e) -&gt; [SDoc]
forall e.
Diagnostic e =&gt;
DiagnosticOpts e -&gt; Bag (MsgEnvelope e) -&gt; [SDoc]
</span><a href="GHC.Utils.Error.html#pprMsgEnvelopeBagWithLoc"><span class="hs-identifier hs-var">pprMsgEnvelopeBagWithLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall opts.
HasDefaultDiagnosticOpts (DiagnosticOpts opts) =&gt;
DiagnosticOpts opts
</span><a href="GHC.Types.Error.html#defaultDiagnosticOpts"><span class="hs-identifier hs-var">defaultDiagnosticOpts</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621683154758"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages e -&gt; Bag (MsgEnvelope e)
forall e. Messages e -&gt; Bag (MsgEnvelope e)
</span><a href="GHC.Types.Error.html#getMessages"><span class="hs-identifier hs-var">getMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages e
</span><a href="#local-6989586621683157163"><span class="hs-identifier hs-var">whyUnsafe</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a></span><span>
</span><span id="line-1836"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; [SDoc]
forall {t :: * -&gt; *}. Foldable t =&gt; t ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621683157185"><span class="hs-identifier hs-var">badInsts</span></a></span><span> </span><span class="annot"><span class="annottext">([ClsInst] -&gt; [SDoc]) -&gt; [ClsInst] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157162"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1837"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1838"></span><span>    </span><span id="local-6989586621683157180"><span class="annot"><span class="annottext">badFlags :: DynFlags -&gt; [SDoc]
</span><a href="#local-6989586621683157180"><span class="hs-identifier hs-var hs-var">badFlags</span></a></span></span><span> </span><span id="local-6989586621683157190"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157190"><span class="hs-identifier hs-var">df</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Extension, DynFlags -&gt; SrcSpan, DynFlags -&gt; Bool,
  DynFlags -&gt; DynFlags)
 -&gt; [SDoc])
-&gt; [(Extension, DynFlags -&gt; SrcSpan, DynFlags -&gt; Bool,
     DynFlags -&gt; DynFlags)]
-&gt; [SDoc]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags
-&gt; (Extension, DynFlags -&gt; SrcSpan, DynFlags -&gt; Bool,
    DynFlags -&gt; DynFlags)
-&gt; [SDoc]
forall {a} {t} {d}.
Outputable a =&gt;
t -&gt; (a, t -&gt; SrcSpan, t -&gt; Bool, d) -&gt; [SDoc]
</span><a href="#local-6989586621683157192"><span class="hs-identifier hs-var">badFlag</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157190"><span class="hs-identifier hs-var">df</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Extension, DynFlags -&gt; SrcSpan, DynFlags -&gt; Bool,
  DynFlags -&gt; DynFlags)]
</span><a href="GHC.Driver.Session.html#unsafeFlagsForInfer"><span class="hs-identifier hs-var">unsafeFlagsForInfer</span></a></span><span>
</span><span id="line-1839"></span><span>    </span><span id="local-6989586621683157192"><span class="annot"><span class="annottext">badFlag :: t -&gt; (a, t -&gt; SrcSpan, t -&gt; Bool, d) -&gt; [SDoc]
</span><a href="#local-6989586621683157192"><span class="hs-identifier hs-var hs-var">badFlag</span></a></span></span><span> </span><span id="local-6989586621683157200"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683157200"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157201"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683157201"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157202"><span class="annot"><span class="annottext">t -&gt; SrcSpan
</span><a href="#local-6989586621683157202"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157203"><span class="annot"><span class="annottext">t -&gt; Bool
</span><a href="#local-6989586621683157203"><span class="hs-identifier hs-var">on</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">d
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1840"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t -&gt; Bool
</span><a href="#local-6989586621683157203"><span class="hs-identifier hs-var">on</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683157200"><span class="hs-identifier hs-var">df</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Types.Error.html#mkLocMessage"><span class="hs-identifier hs-var">mkLocMessage</span></a></span><span> </span><span class="annot"><span class="annottext">MessageClass
</span><a href="GHC.Types.Error.html#MCOutput"><span class="hs-identifier hs-var">MCOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; SrcSpan
</span><a href="#local-6989586621683157202"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683157200"><span class="hs-identifier hs-var">df</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1841"></span><span>                            </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-X&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683157201"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;is not allowed in Safe Haskell&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1842"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1843"></span><span>    </span><span id="local-6989586621683157185"><span class="annot"><span class="annottext">badInsts :: t ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621683157185"><span class="hs-identifier hs-var hs-var">badInsts</span></a></span></span><span> </span><span id="local-6989586621683157208"><span class="annot"><span class="annottext">t ClsInst
</span><a href="#local-6989586621683157208"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; [SDoc]) -&gt; t ClsInst -&gt; [SDoc]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621683157209"><span class="hs-identifier hs-var">badInst</span></a></span><span> </span><span class="annot"><span class="annottext">t ClsInst
</span><a href="#local-6989586621683157208"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-1844"></span><span>
</span><span id="line-1845"></span><span>    </span><span id="local-6989586621683157210"><span class="annot"><span class="annottext">checkOverlap :: OverlapMode -&gt; Bool
</span><a href="#local-6989586621683157210"><span class="hs-identifier hs-var hs-var">checkOverlap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#NoOverlap"><span class="hs-identifier hs-type">NoOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1846"></span><span>    </span><span class="annot"><a href="#local-6989586621683157210"><span class="hs-identifier hs-var">checkOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">OverlapMode
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1847"></span><span>
</span><span id="line-1848"></span><span>    </span><span id="local-6989586621683157209"><span class="annot"><span class="annottext">badInst :: ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621683157209"><span class="hs-identifier hs-var hs-var">badInst</span></a></span></span><span> </span><span id="local-6989586621683157218"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683157218"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OverlapMode -&gt; Bool
</span><a href="#local-6989586621683157210"><span class="hs-identifier hs-var">checkOverlap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OverlapFlag -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var">overlapMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683157218"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Types.Error.html#mkLocMessage"><span class="hs-identifier hs-var">mkLocMessage</span></a></span><span> </span><span class="annot"><span class="annottext">MessageClass
</span><a href="GHC.Types.Error.html#MCOutput"><span class="hs-identifier hs-var">MCOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; SrcSpan) -&gt; Name -&gt; SrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; Id -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#is_dfun"><span class="hs-identifier hs-var">is_dfun</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683157218"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1850"></span><span>                      </span><span class="annot"><span class="annottext">OverlapMode -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OverlapFlag -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var">overlapMode</span></a></span><span> </span><span class="annot"><span class="annottext">(OverlapFlag -&gt; OverlapMode) -&gt; OverlapFlag -&gt; OverlapMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683157218"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1851"></span><span>                      </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;overlap mode isn't allowed in Safe Haskell&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1852"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1853"></span><span>
</span><span id="line-1854"></span><span class="annot"><span class="hs-comment">-- | Figure out the final correct safe haskell mode</span></span><span>
</span><span id="line-1855"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGetSafeMode"><span class="hs-identifier hs-type">hscGetSafeMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span>
</span><span id="line-1856"></span><span id="hscGetSafeMode"><span class="annot"><span class="annottext">hscGetSafeMode :: TcGblEnv -&gt; Hsc SafeHaskellMode
</span><a href="GHC.Driver.Main.html#hscGetSafeMode"><span class="hs-identifier hs-var hs-var">hscGetSafeMode</span></a></span></span><span> </span><span id="local-6989586621683157225"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157225"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1857"></span><span>    </span><span id="local-6989586621683157226"><span class="annot"><a href="#local-6989586621683157226"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1858"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier hs-type">finalSafeMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157226"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157225"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-1859"></span><span>
</span><span id="line-1860"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1861"></span><span class="hs-comment">-- Simplifiers</span><span>
</span><span id="line-1862"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1863"></span><span>
</span><span id="line-1864"></span><span class="hs-comment">-- | Run Core2Core simplifier. The list of String is a list of (Core) plugin</span><span>
</span><span id="line-1865"></span><span class="hs-comment">-- module names added via TH (cf 'addCorePlugin').</span><span>
</span><span id="line-1866"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier hs-type">hscSimplify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-1867"></span><span id="hscSimplify"><span class="annot"><span class="annottext">hscSimplify :: HscEnv -&gt; [[Char]] -&gt; ModGuts -&gt; IO ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier hs-var hs-var">hscSimplify</span></a></span></span><span> </span><span id="local-6989586621683157228"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157228"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157229"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683157229"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span id="local-6989586621683157230"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157230"><span class="hs-identifier hs-var">modguts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1868"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157228"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ModGuts -&gt; IO ModGuts) -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; ModGuts -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-var">hscSimplify'</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683157229"><span class="hs-identifier hs-var">plugins</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157230"><span class="hs-identifier hs-var">modguts</span></a></span><span>
</span><span id="line-1869"></span><span>
</span><span id="line-1870"></span><span class="hs-comment">-- | Run Core2Core simplifier. The list of String is a list of (Core) plugin</span><span>
</span><span id="line-1871"></span><span class="hs-comment">-- module names added via TH (cf 'addCorePlugin').</span><span>
</span><span id="line-1872"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-type">hscSimplify'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-1873"></span><span id="hscSimplify%27"><span class="annot"><span class="annottext">hscSimplify' :: [[Char]] -&gt; ModGuts -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-var hs-var">hscSimplify'</span></a></span></span><span> </span><span id="local-6989586621683157231"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683157231"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span id="local-6989586621683157232"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157232"><span class="hs-identifier hs-var">ds_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1874"></span><span>    </span><span id="local-6989586621683157233"><span class="annot"><a href="#local-6989586621683157233"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1875"></span><span>    </span><span id="local-6989586621683157234"><span class="annot"><a href="#local-6989586621683157234"><span class="hs-identifier hs-var">hsc_env_with_plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683157231"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="hs-comment">-- fast path</span><span>
</span><span id="line-1876"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683157233"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-1877"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier hs-type">initializePlugins</span></a></span><span>
</span><span id="line-1878"></span><span>                    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateFlags"><span class="hs-identifier hs-type">hscUpdateFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683157235"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157235"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; DynFlags -&gt; DynFlags)
-&gt; DynFlags -&gt; [[Char]] -&gt; DynFlags
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#addPluginModuleName"><span class="hs-identifier hs-var">addPluginModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157235"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621683157231"><span class="hs-identifier hs-var">plugins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1879"></span><span>                      </span><span class="annot"><a href="#local-6989586621683157233"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-1880"></span><span>    </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Core2Core&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1881"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#core2core"><span class="hs-identifier hs-type">core2core</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157234"><span class="hs-identifier hs-type">hsc_env_with_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157232"><span class="hs-identifier hs-type">ds_result</span></a></span><span>
</span><span id="line-1882"></span><span>
</span><span id="line-1883"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1884"></span><span class="hs-comment">-- Interface generators</span><span>
</span><span id="line-1885"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1886"></span><span>
</span><span id="line-1887"></span><span class="hs-comment">-- | Generate a stripped down interface file, e.g. for boot files or when ghci</span><span>
</span><span id="line-1888"></span><span class="hs-comment">-- generates interface files. See Note [simpleTidyPgm - mkBootModDetailsTc]</span><span>
</span><span id="line-1889"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-type">hscSimpleIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1890"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-1891"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1892"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1893"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span id="hscSimpleIface"><span class="annot"><span class="annottext">hscSimpleIface :: HscEnv
-&gt; Maybe CoreProgram
-&gt; TcGblEnv
-&gt; ModSummary
-&gt; IO (ModIface, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-var hs-var">hscSimpleIface</span></a></span></span><span> </span><span id="local-6989586621683157239"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157239"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157240"><span class="annot"><span class="annottext">Maybe CoreProgram
</span><a href="#local-6989586621683157240"><span class="hs-identifier hs-var">mb_core_program</span></a></span></span><span> </span><span id="local-6989586621683157241"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157241"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span id="local-6989586621683157242"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683157242"><span class="hs-identifier hs-var">summary</span></a></span></span><span>
</span><span id="line-1895"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (ModIface, ModDetails) -&gt; IO (ModIface, ModDetails)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157239"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (ModIface, ModDetails) -&gt; IO (ModIface, ModDetails))
-&gt; Hsc (ModIface, ModDetails) -&gt; IO (ModIface, ModDetails)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe CoreProgram
-&gt; TcGblEnv -&gt; ModSummary -&gt; Hsc (ModIface, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier hs-var">hscSimpleIface'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CoreProgram
</span><a href="#local-6989586621683157240"><span class="hs-identifier hs-var">mb_core_program</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157241"><span class="hs-identifier hs-var">tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683157242"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier hs-type">hscSimpleIface'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-1898"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1899"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1900"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1901"></span><span id="hscSimpleIface%27"><span class="annot"><span class="annottext">hscSimpleIface' :: Maybe CoreProgram
-&gt; TcGblEnv -&gt; ModSummary -&gt; Hsc (ModIface, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier hs-var hs-var">hscSimpleIface'</span></a></span></span><span> </span><span id="local-6989586621683157243"><span class="annot"><span class="annottext">Maybe CoreProgram
</span><a href="#local-6989586621683157243"><span class="hs-identifier hs-var">mb_core_program</span></a></span></span><span> </span><span id="local-6989586621683157244"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157244"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span id="local-6989586621683157245"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683157245"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1902"></span><span>    </span><span id="local-6989586621683157246"><span class="annot"><a href="#local-6989586621683157246"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1903"></span><span>    </span><span id="local-6989586621683157247"><span class="annot"><a href="#local-6989586621683157247"><span class="hs-identifier hs-var">logger</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-1904"></span><span>    </span><span id="local-6989586621683157248"><span class="annot"><a href="#local-6989586621683157248"><span class="hs-identifier hs-var">details</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Iface.Tidy.html#mkBootModDetailsTc"><span class="hs-identifier hs-type">mkBootModDetailsTc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157247"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157244"><span class="hs-identifier hs-type">tc_result</span></a></span><span>
</span><span id="line-1905"></span><span>    </span><span id="local-6989586621683157249"><span class="annot"><a href="#local-6989586621683157249"><span class="hs-identifier hs-var">safe_mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscGetSafeMode"><span class="hs-identifier hs-type">hscGetSafeMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157244"><span class="hs-identifier hs-type">tc_result</span></a></span><span>
</span><span id="line-1906"></span><span>    </span><span id="local-6989586621683157250"><span class="annot"><a href="#local-6989586621683157250"><span class="hs-identifier hs-var">new_iface</span></a></span></span><span>
</span><span id="line-1907"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;MkFinalIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1908"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1909"></span><span>               </span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceTc"><span class="hs-identifier hs-type">mkIfaceTc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157246"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157249"><span class="hs-identifier hs-type">safe_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157248"><span class="hs-identifier hs-type">details</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157245"><span class="hs-identifier hs-type">summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157243"><span class="hs-identifier hs-type">mb_core_program</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157244"><span class="hs-identifier hs-type">tc_result</span></a></span><span>
</span><span id="line-1910"></span><span>    </span><span class="hs-comment">-- And the answer is ...</span><span>
</span><span id="line-1911"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-type">dumpIfaceStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157246"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-1912"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157250"><span class="hs-identifier hs-type">new_iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157248"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1913"></span><span>
</span><span id="line-1914"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1915"></span><span class="hs-comment">-- BackEnd combinators</span><span>
</span><span id="line-1916"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1917"></span><span>
</span><span id="line-1918"></span><span class="annot"><span class="hs-comment">-- | Compile to hard-code.</span></span><span>
</span><span id="line-1919"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier hs-type">hscGenHardCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-1920"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForeignSrcLang</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#StgCgInfos"><span class="hs-identifier hs-type">StgCgInfos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1921"></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ @Just f@ &lt;=&gt; _stub.c is f</span></span><span>
</span><span id="line-1922"></span><span id="hscGenHardCode"><span class="annot"><span class="annottext">hscGenHardCode :: HscEnv
-&gt; CgGuts
-&gt; ModLocation
-&gt; [Char]
-&gt; IO
     ([Char], Maybe [Char], [(ForeignSrcLang, [Char])],
      Maybe StgCgInfos, Maybe CmmCgInfos)
</span><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier hs-var hs-var">hscGenHardCode</span></a></span></span><span> </span><span id="local-6989586621683157252"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157252"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157253"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621683157253"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span> </span><span id="local-6989586621683157254"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157254"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621683157255"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157255"><span class="hs-identifier hs-var">output_filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1923"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cg_module :: CgGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#cg_module"><span class="hs-identifier hs-var">cg_module</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157258"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157258"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1924"></span><span>                    </span><span class="annot"><span class="annottext">cg_binds :: CgGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157259"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157259"><span class="hs-identifier hs-var hs-var">core_binds</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1925"></span><span>                    </span><span class="annot"><span class="annottext">cg_ccs :: CgGuts -&gt; [CostCentre]
</span><a href="GHC.Unit.Module.ModGuts.html#cg_ccs"><span class="hs-identifier hs-var">cg_ccs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157261"><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621683157261"><span class="hs-identifier hs-var hs-var">local_ccs</span></a></span></span><span>
</span><span id="line-1926"></span><span>                    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621683157253"><span class="hs-identifier hs-var">cgguts</span></a></span><span>
</span><span id="line-1927"></span><span>            </span><span id="local-6989586621683157262"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157252"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1928"></span><span>            </span><span id="local-6989586621683157263"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683157263"><span class="hs-identifier hs-var hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157252"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1929"></span><span>
</span><span id="line-1930"></span><span>
</span><span id="line-1931"></span><span>        </span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1932"></span><span>        </span><span class="hs-comment">-- Insert late cost centres based on the provided flags.</span><span>
</span><span id="line-1933"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1934"></span><span>        </span><span class="hs-comment">-- If -fprof-late-inline is enabled, we will skip adding CCs on any</span><span>
</span><span id="line-1935"></span><span>        </span><span class="hs-comment">-- top-level bindings here (via shortcut in `addLateCostCenters`),</span><span>
</span><span id="line-1936"></span><span>        </span><span class="hs-comment">-- since it will have already added a superset of the CCs we would add</span><span>
</span><span id="line-1937"></span><span>        </span><span class="hs-comment">-- here.</span><span>
</span><span id="line-1938"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1939"></span><span>          </span><span class="annot"><a href="#local-6989586621683157264"><span class="hs-identifier hs-type">late_cc_config</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.LateCC.Types.html#LateCCConfig"><span class="hs-identifier hs-type">LateCCConfig</span></a></span><span>
</span><span id="line-1940"></span><span>          </span><span id="local-6989586621683157264"><span class="annot"><span class="annottext">late_cc_config :: LateCCConfig
</span><a href="#local-6989586621683157264"><span class="hs-identifier hs-var hs-var hs-var">late_cc_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1941"></span><span>            </span><span class="annot"><a href="GHC.Core.LateCC.Types.html#LateCCConfig"><span class="hs-identifier hs-type">LateCCConfig</span></a></span><span>
</span><span id="line-1942"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lateCCConfig_whichBinds :: LateCCBindSpec
</span><a href="GHC.Core.LateCC.Types.html#lateCCConfig_whichBinds"><span class="hs-identifier hs-var">lateCCConfig_whichBinds</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1943"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ProfLateInlineCcs"><span class="hs-identifier hs-var">Opt_ProfLateInlineCcs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1944"></span><span>                    </span><span class="annot"><span class="annottext">LateCCBindSpec
</span><a href="GHC.Core.LateCC.Types.html#LateCCNone"><span class="hs-identifier hs-var">LateCCNone</span></a></span><span>
</span><span id="line-1945"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ProfLateCcs"><span class="hs-identifier hs-var">Opt_ProfLateCcs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1946"></span><span>                    </span><span class="annot"><span class="annottext">LateCCBindSpec
</span><a href="GHC.Core.LateCC.Types.html#LateCCBinds"><span class="hs-identifier hs-var">LateCCBinds</span></a></span><span>
</span><span id="line-1947"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ProfLateOverloadedCcs"><span class="hs-identifier hs-var">Opt_ProfLateOverloadedCcs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1948"></span><span>                    </span><span class="annot"><span class="annottext">LateCCBindSpec
</span><a href="GHC.Core.LateCC.Types.html#LateCCOverloadedBinds"><span class="hs-identifier hs-var">LateCCOverloadedBinds</span></a></span><span>
</span><span id="line-1949"></span><span>                  </span><span class="hs-keyword">else</span><span>
</span><span id="line-1950"></span><span>                    </span><span class="annot"><span class="annottext">LateCCBindSpec
</span><a href="GHC.Core.LateCC.Types.html#LateCCNone"><span class="hs-identifier hs-var">LateCCNone</span></a></span><span>
</span><span id="line-1951"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lateCCConfig_overloadedCalls :: Bool
</span><a href="GHC.Core.LateCC.Types.html#lateCCConfig_overloadedCalls"><span class="hs-identifier hs-var">lateCCConfig_overloadedCalls</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1952"></span><span>                  </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ProfLateoverloadedCallsCCs"><span class="hs-identifier hs-var">Opt_ProfLateoverloadedCallsCCs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1953"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lateCCConfig_env :: LateCCEnv
</span><a href="GHC.Core.LateCC.Types.html#lateCCConfig_env"><span class="hs-identifier hs-var">lateCCConfig_env</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1954"></span><span>                  </span><span class="annot"><a href="GHC.Core.LateCC.Types.html#LateCCEnv"><span class="hs-identifier hs-type">LateCCEnv</span></a></span><span>
</span><span id="line-1955"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lateCCEnv_module :: Module
</span><a href="GHC.Core.LateCC.Types.html#lateCCEnv_module"><span class="hs-identifier hs-var">lateCCEnv_module</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157258"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-1956"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lateCCEnv_file :: Maybe FastString
</span><a href="GHC.Core.LateCC.Types.html#lateCCEnv_file"><span class="hs-identifier hs-var">lateCCEnv_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; FastString) -&gt; Maybe [Char] -&gt; Maybe FastString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe [Char]
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157254"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1957"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lateCCEnv_countEntries :: Bool
</span><a href="GHC.Core.LateCC.Types.html#lateCCEnv_countEntries"><span class="hs-identifier hs-var">lateCCEnv_countEntries</span></a></span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ProfCountEntries"><span class="hs-identifier hs-var">Opt_ProfCountEntries</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1958"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lateCCEnv_collectCCs :: Bool
</span><a href="GHC.Core.LateCC.Types.html#lateCCEnv_collectCCs"><span class="hs-identifier hs-var">lateCCEnv_collectCCs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1959"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1960"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1961"></span><span>
</span><span id="line-1962"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683157283"><span class="annot"><a href="#local-6989586621683157283"><span class="hs-identifier hs-var">late_cc_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157284"><span class="annot"><a href="#local-6989586621683157284"><span class="hs-identifier hs-var">late_cc_state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1963"></span><span>          </span><span class="annot"><span class="annottext">Logger
-&gt; LateCCConfig
-&gt; CoreProgram
-&gt; IO (CoreProgram, LateCCState (Maybe SrcSpan))
</span><a href="GHC.Core.LateCC.html#addLateCostCenters"><span class="hs-identifier hs-var">addLateCostCenters</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157263"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LateCCConfig
</span><a href="#local-6989586621683157264"><span class="hs-identifier hs-var">late_cc_config</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157259"><span class="hs-identifier hs-var">core_binds</span></a></span><span>
</span><span id="line-1964"></span><span>
</span><span id="line-1965"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#dopt"><span class="hs-identifier hs-type">dopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_late_cc"><span class="hs-identifier hs-type">Opt_D_dump_late_cc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157262"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#dopt"><span class="hs-identifier hs-type">dopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_verbose_core2core"><span class="hs-identifier hs-type">Opt_D_verbose_core2core</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157262"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1966"></span><span>          </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157263"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_late_cc"><span class="hs-identifier hs-type">Opt_D_dump_late_cc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LateCC&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatCore"><span class="hs-identifier hs-type">FormatCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157283"><span class="hs-identifier hs-type">late_cc_binds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1967"></span><span>
</span><span id="line-1968"></span><span>        </span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1969"></span><span>        </span><span class="hs-comment">-- Run late plugins</span><span>
</span><span id="line-1970"></span><span>        </span><span class="hs-comment">-- This is the last use of the ModGuts in a compilation.</span><span>
</span><span id="line-1971"></span><span>        </span><span class="hs-comment">-- From now on, we just use the bits we need.</span><span>
</span><span id="line-1972"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span>
</span><span id="line-1973"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_tycons"><span class="hs-identifier hs-var">cg_tycons</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157291"><span class="annot"><a href="#local-6989586621683157291"><span class="hs-identifier hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1974"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_foreign"><span class="hs-identifier hs-var">cg_foreign</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157293"><span class="annot"><a href="#local-6989586621683157293"><span class="hs-identifier hs-var">foreign_stubs0</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1975"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_foreign_files"><span class="hs-identifier hs-var">cg_foreign_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157295"><span class="annot"><a href="#local-6989586621683157295"><span class="hs-identifier hs-var">foreign_files</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1976"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_dep_pkgs"><span class="hs-identifier hs-var">cg_dep_pkgs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157297"><span class="annot"><a href="#local-6989586621683157297"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1977"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_spt_entries"><span class="hs-identifier hs-var">cg_spt_entries</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157299"><span class="annot"><a href="#local-6989586621683157299"><span class="hs-identifier hs-var">spt_entries</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1978"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157300"><span class="annot"><a href="#local-6989586621683157300"><span class="hs-identifier hs-var">late_binds</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1979"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_ccs"><span class="hs-identifier hs-var">cg_ccs</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157301"><span class="annot"><a href="#local-6989586621683157301"><span class="hs-identifier hs-var">late_local_ccs</span></a></span></span><span>
</span><span id="line-1980"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-1981"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-1982"></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1983"></span><span>          </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">latePlugins</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1984"></span><span>          </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-type">withTiming</span></a></span><span>
</span><span id="line-1985"></span><span>            </span><span class="annot"><a href="#local-6989586621683157263"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-1986"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LatePlugins&quot;</span></span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157258"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1987"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1988"></span><span>            </span><span class="annot"><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-type">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157252"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1989"></span><span>              </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">$</span></span><span> </span><span class="annot"><span class="hs-identifier">hsc_env</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#latePlugin"><span class="hs-identifier hs-var">latePlugin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1990"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683157253"><span class="hs-identifier hs-type">cgguts</span></a></span><span>
</span><span id="line-1991"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157283"><span class="hs-identifier hs-type">late_cc_binds</span></a></span><span>
</span><span id="line-1992"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_ccs"><span class="hs-identifier hs-var">cg_ccs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-type">S.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.LateCC.Types.html#lateCCState_ccs"><span class="hs-identifier hs-var">lateCCState_ccs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157284"><span class="hs-identifier hs-type">late_cc_state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683157261"><span class="hs-identifier hs-type">local_ccs</span></a></span><span>
</span><span id="line-1993"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1994"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.LateCC.Types.html#lateCCState_ccState"><span class="hs-identifier hs-var">lateCCState_ccState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157284"><span class="hs-identifier hs-type">late_cc_state</span></a></span><span>
</span><span id="line-1995"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1996"></span><span>
</span><span id="line-1997"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1998"></span><span>          </span><span id="local-6989586621683157306"><span class="annot"><a href="#local-6989586621683157306"><span class="hs-identifier hs-var hs-var">hooks</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157252"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1999"></span><span>          </span><span id="local-6989586621683157307"><span class="annot"><a href="#local-6989586621683157307"><span class="hs-identifier hs-var hs-var">tmpfs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157252"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2000"></span><span>          </span><span id="local-6989586621683157308"><span class="annot"><a href="#local-6989586621683157308"><span class="hs-identifier hs-var hs-var">llvm_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; LlvmConfigCache
</span><a href="GHC.Driver.Env.Types.html#hsc_llvm_config"><span class="hs-identifier hs-var">hsc_llvm_config</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157252"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2001"></span><span>          </span><span id="local-6989586621683157309"><span class="annot"><a href="#local-6989586621683157309"><span class="hs-identifier hs-var hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Profile
</span><a href="GHC.Driver.DynFlags.html#targetProfile"><span class="hs-identifier hs-var">targetProfile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2002"></span><span>          </span><span id="local-6989586621683157310"><span class="annot"><a href="#local-6989586621683157310"><span class="hs-identifier hs-var hs-var">data_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Bool) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataTyCon"><span class="hs-identifier hs-var">isDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157291"><span class="hs-identifier hs-var">tycons</span></a></span><span>
</span><span id="line-2003"></span><span>          </span><span class="hs-comment">-- cg_tycons includes newtypes, for the benefit of External Core,</span><span>
</span><span id="line-2004"></span><span>          </span><span class="hs-comment">-- but we don't generate any code for newtypes</span><span>
</span><span id="line-2005"></span><span>
</span><span id="line-2006"></span><span>
</span><span id="line-2007"></span><span>
</span><span id="line-2008"></span><span>        </span><span class="hs-comment">-------------------</span><span>
</span><span id="line-2009"></span><span>        </span><span class="hs-comment">-- PREPARE FOR CODE GENERATION</span><span>
</span><span id="line-2010"></span><span>        </span><span class="hs-comment">-- Do saturation and convert to A-normal form</span><span>
</span><span id="line-2011"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683157312"><span class="annot"><a href="#local-6989586621683157312"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CorePrep&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2012"></span><span>          </span><span id="local-6989586621683157313"><span class="annot"><a href="#local-6989586621683157313"><span class="hs-identifier hs-var">cp_cfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.CoreToStg.Prep.html#initCorePrepConfig"><span class="hs-identifier hs-type">initCorePrepConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157252"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-2013"></span><span>          </span><span class="annot"><a href="GHC.CoreToStg.Prep.html#corePrepPgm"><span class="hs-identifier hs-type">corePrepPgm</span></a></span><span>
</span><span id="line-2014"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157252"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2015"></span><span>            </span><span class="annot"><a href="#local-6989586621683157313"><span class="hs-identifier hs-type">cp_cfg</span></a></span><span>
</span><span id="line-2016"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.CoreToStg.Prep.html#initCorePrepPgmConfig"><span class="hs-identifier hs-type">initCorePrepPgmConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157252"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier hs-type">interactiveInScope</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157252"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2017"></span><span>            </span><span class="annot"><a href="#local-6989586621683157258"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157254"><span class="hs-identifier hs-type">location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157300"><span class="hs-identifier hs-type">late_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157310"><span class="hs-identifier hs-type">data_tycons</span></a></span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span>        </span><span class="hs-comment">-----------------  Convert to STG ------------------</span><span>
</span><span id="line-2020"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683157317"><span class="annot"><a href="#local-6989586621683157317"><span class="hs-identifier hs-var">stg_binds_with_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157318"><span class="annot"><a href="#local-6989586621683157318"><span class="hs-identifier hs-var">denv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157319"><span class="annot"><a href="#local-6989586621683157319"><span class="hs-identifier hs-var">caf_ccs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157320"><span class="annot"><a href="#local-6989586621683157320"><span class="hs-identifier hs-var">caf_cc_stacks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157321"><span class="annot"><a href="#local-6989586621683157321"><span class="hs-identifier hs-var">stg_cg_infos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2021"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CoreToStg&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2022"></span><span>               </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-type">withTiming</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157263"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-2023"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CoreToStg&quot;</span></span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157258"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2024"></span><span>                   </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683157322"><span class="annot"><span class="annottext">[(CgStgTopBinding, IdSet)]
</span><a href="#local-6989586621683157322"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157323"><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157323"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157324"><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621683157324"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157325"><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621683157325"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157326"><span class="annot"><span class="annottext">StgCgInfos
</span><a href="#local-6989586621683157326"><span class="hs-identifier hs-var">tag_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2025"></span><span>                        </span><span class="annot"><span class="annottext">[(CgStgTopBinding, IdSet)]
</span><a href="#local-6989586621683157322"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[(CgStgTopBinding, IdSet)] -&gt; InfoTableProvMap -&gt; InfoTableProvMap
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span>
</span><span id="line-2026"></span><span>                        </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157323"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span>
</span><span id="line-2027"></span><span>                        </span><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621683157324"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[CostCentre] -&gt; [CostCentreStack] -&gt; [CostCentreStack]
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span>
</span><span id="line-2028"></span><span>                        </span><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621683157325"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">[CostCentreStack] -&gt; () -&gt; ()
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span>
</span><span id="line-2029"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TagSig -&gt; ()) -&gt; StgCgInfos -&gt; ()
forall {k} elt (key :: k). (elt -&gt; ()) -&gt; UniqFM key elt -&gt; ()
</span><a href="GHC.Types.Unique.FM.html#seqEltsUFM"><span class="hs-identifier hs-var">seqEltsUFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagSig -&gt; ()
</span><a href="GHC.Stg.InferTags.TagSig.html#seqTagSig"><span class="hs-identifier hs-var">seqTagSig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StgCgInfos
</span><a href="#local-6989586621683157326"><span class="hs-identifier hs-var">tag_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2030"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-type">myCoreToStg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157263"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157262"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier hs-type">interactiveInScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157252"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621683157258"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157254"><span class="hs-identifier hs-type">location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157312"><span class="hs-identifier hs-type">prepd_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2031"></span><span>
</span><span id="line-2032"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157330"><span class="annot"><a href="#local-6989586621683157330"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157331"><span class="annot"><a href="#local-6989586621683157331"><span class="hs-identifier hs-var">_stg_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621683157317"><span class="hs-identifier hs-type">stg_binds_with_deps</span></a></span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157333"><span class="annot"><a href="#local-6989586621683157333"><span class="hs-identifier hs-var hs-var">cost_centre_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2035"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621683157301"><span class="hs-identifier hs-var">late_local_ccs</span></a></span><span> </span><span class="annot"><span class="annottext">[CostCentre] -&gt; [CostCentre] -&gt; [CostCentre]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621683157319"><span class="hs-identifier hs-var">caf_ccs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621683157320"><span class="hs-identifier hs-var">caf_cc_stacks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2036"></span><span>            </span><span id="local-6989586621683157334"><span class="annot"><a href="#local-6989586621683157334"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2037"></span><span>            </span><span id="local-6989586621683157335"><span class="annot"><a href="#local-6989586621683157335"><span class="hs-identifier hs-var hs-var">prof_init</span></a></span></span><span>
</span><span id="line-2038"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#sccProfilingEnabled"><span class="hs-identifier hs-var">sccProfilingEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Module -&gt; ([CostCentre], [CostCentreStack]) -&gt; CStub
</span><a href="GHC.Driver.CodeOutput.html#profilingInitCode"><span class="hs-identifier hs-var">profilingInitCode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683157334"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157258"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157333"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span>
</span><span id="line-2039"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CStub
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2040"></span><span>
</span><span id="line-2041"></span><span>        </span><span class="hs-comment">------------------  Code generation ------------------</span><span>
</span><span id="line-2042"></span><span>        </span><span class="hs-comment">-- The back-end is streamed: each top-level function goes</span><span>
</span><span id="line-2043"></span><span>        </span><span class="hs-comment">-- from Stg all the way to asm before dealing with the next</span><span>
</span><span id="line-2044"></span><span>        </span><span class="hs-comment">-- top-level function, so withTiming isn't very useful here.</span><span>
</span><span id="line-2045"></span><span>        </span><span class="hs-comment">-- Hence we have one withTiming for the whole backend, the</span><span>
</span><span id="line-2046"></span><span>        </span><span class="hs-comment">-- next withTiming after this will be &quot;Assembler&quot; (hard code only).</span><span>
</span><span id="line-2047"></span><span>        </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-type">withTiming</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157263"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CodeGen&quot;</span></span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157258"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2048"></span><span>         </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html#backendCodeOutput"><span class="hs-identifier hs-type">backendCodeOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157262"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2049"></span><span>            </span><span class="annot"><span class="annottext">DefunctionalizedCodeOutput
</span><a href="GHC.Driver.Backend.html#JSCodeOutput"><span class="hs-identifier hs-var">JSCodeOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2050"></span><span>              </span><span class="hs-keyword">do</span><span>
</span><span id="line-2051"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157340"><span class="annot"><span class="annottext">js_config :: StgToJSConfig
</span><a href="#local-6989586621683157340"><span class="hs-identifier hs-var hs-var hs-var">js_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; StgToJSConfig
</span><a href="GHC.Driver.Config.StgToJS.html#initStgToJSConfig"><span class="hs-identifier hs-var">initStgToJSConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2052"></span><span>
</span><span id="line-2053"></span><span>                  </span><span class="hs-comment">-- The JavaScript backend does not create CmmCgInfos like the Cmm backend,</span><span>
</span><span id="line-2054"></span><span>                  </span><span class="hs-comment">-- but it is needed for writing the interface file. Here we compute a very</span><span>
</span><span id="line-2055"></span><span>                  </span><span class="hs-comment">-- conservative but correct value.</span><span>
</span><span id="line-2056"></span><span>                  </span><span id="local-6989586621683157343"><span class="annot"><span class="annottext">lf_infos :: GenStgTopBinding pass -&gt; [(Name, LambdaFormInfo)]
</span><a href="#local-6989586621683157343"><span class="hs-identifier hs-var hs-var hs-var">lf_infos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621683157346"><span class="annot"><span class="annottext">BinderP pass
</span><a href="#local-6989586621683157346"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenStgRhs pass
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
BinderP pass
</span><a href="#local-6989586621683157346"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; LambdaFormInfo
</span><a href="GHC.StgToCmm.Types.html#LFUnknown"><span class="hs-identifier hs-var">LFUnknown</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2057"></span><span>                  </span><span class="annot"><a href="#local-6989586621683157343"><span class="hs-identifier hs-var">lf_infos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621683157350"><span class="annot"><span class="annottext">[(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621683157350"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, GenStgRhs pass) -&gt; (Name, LambdaFormInfo))
-&gt; [(Id, GenStgRhs pass)] -&gt; [(Name, LambdaFormInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683157351"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157351"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GenStgRhs pass
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157351"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; LambdaFormInfo
</span><a href="GHC.StgToCmm.Types.html#LFUnknown"><span class="hs-identifier hs-var">LFUnknown</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Id, GenStgRhs pass)]
[(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621683157350"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-2058"></span><span>                  </span><span class="annot"><a href="#local-6989586621683157343"><span class="hs-identifier hs-var">lf_infos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621683157353"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157353"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157353"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="GHC.StgToCmm.Types.html#LFUnlifted"><span class="hs-identifier hs-var">LFUnlifted</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2059"></span><span>
</span><span id="line-2060"></span><span>                  </span><span id="local-6989586621683157355"><span class="annot"><span class="annottext">cmm_cg_infos :: CmmCgInfos
</span><a href="#local-6989586621683157355"><span class="hs-identifier hs-var hs-var hs-var">cmm_cg_infos</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span>
</span><span id="line-2061"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cgNonCafs :: NonCaffySet
</span><a href="GHC.StgToCmm.Types.html#cgNonCafs"><span class="hs-identifier hs-var">cgNonCafs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonCaffySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2062"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgLFInfos :: ModuleLFInfos
</span><a href="GHC.StgToCmm.Types.html#cgLFInfos"><span class="hs-identifier hs-var">cgLFInfos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, LambdaFormInfo)] -&gt; ModuleLFInfos
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CgStgTopBinding -&gt; [(Name, LambdaFormInfo)])
-&gt; [CgStgTopBinding] -&gt; [(Name, LambdaFormInfo)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">CgStgTopBinding -&gt; [(Name, LambdaFormInfo)]
forall {pass :: StgPass}.
(BinderP pass ~ Id) =&gt;
GenStgTopBinding pass -&gt; [(Name, LambdaFormInfo)]
</span><a href="#local-6989586621683157343"><span class="hs-identifier hs-var">lf_infos</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157330"><span class="hs-identifier hs-var">stg_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2063"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgIPEStub :: CStub
</span><a href="GHC.StgToCmm.Types.html#cgIPEStub"><span class="hs-identifier hs-var">cgIPEStub</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CStub
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2064"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2065"></span><span>                  </span><span id="local-6989586621683157360"><span class="annot"><span class="annottext">stub_c_exists :: Maybe a
</span><a href="#local-6989586621683157360"><span class="hs-identifier hs-var hs-var hs-var">stub_c_exists</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2066"></span><span>                  </span><span id="local-6989586621683157361"><span class="annot"><span class="annottext">foreign_fps :: [a]
</span><a href="#local-6989586621683157361"><span class="hs-identifier hs-var hs-var hs-var">foreign_fps</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2067"></span><span>
</span><span id="line-2068"></span><span>              </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157263"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_stg_final"><span class="hs-identifier hs-var">Opt_D_dump_stg_final</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Final STG:&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatSTG"><span class="hs-identifier hs-var">FormatSTG</span></a></span><span>
</span><span id="line-2069"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgPprOpts -&gt; [CgStgTopBinding] -&gt; SDoc
forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; [GenStgTopBinding pass] -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprGenStgTopBindings"><span class="hs-identifier hs-var">pprGenStgTopBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; StgPprOpts
</span><a href="GHC.Driver.Config.Stg.Ppr.html#initStgPprOpts"><span class="hs-identifier hs-var">initStgPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157330"><span class="hs-identifier hs-var">stg_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2070"></span><span>
</span><span id="line-2071"></span><span>              </span><span class="hs-comment">-- do the unfortunately effectual business</span><span>
</span><span id="line-2072"></span><span>              </span><span class="annot"><span class="annottext">Logger
-&gt; StgToJSConfig
-&gt; [CgStgTopBinding]
-&gt; Module
-&gt; [SptEntry]
-&gt; ForeignStubs
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [Char]
-&gt; IO ()
</span><a href="GHC.StgToJS.CodeGen.html#stgToJS"><span class="hs-identifier hs-var">stgToJS</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157263"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621683157340"><span class="hs-identifier hs-var">js_config</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157330"><span class="hs-identifier hs-var">stg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157258"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621683157299"><span class="hs-identifier hs-var">spt_entries</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683157293"><span class="hs-identifier hs-var">foreign_stubs0</span></a></span><span> </span><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157333"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157255"><span class="hs-identifier hs-var">output_filename</span></a></span><span>
</span><span id="line-2073"></span><span>              </span><span class="annot"><span class="annottext">([Char], Maybe [Char], [(ForeignSrcLang, [Char])],
 Maybe StgCgInfos, Maybe CmmCgInfos)
-&gt; IO
     ([Char], Maybe [Char], [(ForeignSrcLang, [Char])],
      Maybe StgCgInfos, Maybe CmmCgInfos)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157255"><span class="hs-identifier hs-var">output_filename</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
forall a. Maybe a
</span><a href="#local-6989586621683157360"><span class="hs-identifier hs-var">stub_c_exists</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, [Char])]
forall a. [a]
</span><a href="#local-6989586621683157361"><span class="hs-identifier hs-var">foreign_fps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgCgInfos -&gt; Maybe StgCgInfos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">StgCgInfos
</span><a href="#local-6989586621683157321"><span class="hs-identifier hs-var">stg_cg_infos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmCgInfos -&gt; Maybe CmmCgInfos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CmmCgInfos
</span><a href="#local-6989586621683157355"><span class="hs-identifier hs-var">cmm_cg_infos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2074"></span><span>
</span><span id="line-2075"></span><span>            </span><span class="annot"><span class="annottext">DefunctionalizedCodeOutput
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2076"></span><span>              </span><span class="hs-keyword">do</span><span>
</span><span id="line-2077"></span><span>              </span><span id="local-6989586621683157365"><span class="annot"><a href="#local-6989586621683157365"><span class="hs-identifier hs-var">cmms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;StgToCmm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2078"></span><span>                </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [CgStgTopBinding]
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos)
</span><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier hs-var">doCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157252"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157258"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157318"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157310"><span class="hs-identifier hs-var">data_tycons</span></a></span><span>
</span><span id="line-2079"></span><span>                </span><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157333"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span>
</span><span id="line-2080"></span><span>                </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157330"><span class="hs-identifier hs-var">stg_binds</span></a></span><span>
</span><span id="line-2081"></span><span>
</span><span id="line-2082"></span><span>              </span><span class="hs-comment">------------------  Code output -----------------------</span><span>
</span><span id="line-2083"></span><span>              </span><span id="local-6989586621683157366"><span class="annot"><a href="#local-6989586621683157366"><span class="hs-identifier hs-var">rawcmms0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;cmmToRawCmm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2084"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html#cmmToRawCmmHook"><span class="hs-identifier hs-var">cmmToRawCmmHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157306"><span class="hs-identifier hs-type">hooks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2085"></span><span>                  </span><span class="annot"><span class="annottext">Maybe
  (DynFlags
   -&gt; Maybe Module
   -&gt; CgStream
        [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
   -&gt; IO
        (CgStream
           [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
           CmmCgInfos))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; Profile
-&gt; CgStream
     [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
        CmmCgInfos)
forall a.
Logger
-&gt; Profile
-&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] a
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] a)
</span><a href="GHC.Cmm.Info.html#cmmToRawCmm"><span class="hs-identifier hs-var">cmmToRawCmm</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157263"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683157309"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
</span><a href="#local-6989586621683157365"><span class="hs-identifier hs-var">cmms</span></a></span><span>
</span><span id="line-2086"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157369"><span class="annot"><span class="annottext">DynFlags
-&gt; Maybe Module
-&gt; CgStream
     [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
        CmmCgInfos)
</span><a href="#local-6989586621683157369"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Maybe Module
-&gt; CgStream
     [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
        CmmCgInfos)
</span><a href="#local-6989586621683157369"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157262"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Maybe Module
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157258"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
</span><a href="#local-6989586621683157365"><span class="hs-identifier hs-var">cmms</span></a></span><span>
</span><span id="line-2087"></span><span>
</span><span id="line-2088"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157370"><span class="annot"><a href="#local-6989586621683157370"><span class="hs-identifier hs-var hs-var">dump</span></a></span></span><span> </span><span id="local-6989586621683157371"><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157371"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2089"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157371"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157263"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm_raw"><span class="hs-identifier hs-var">Opt_D_dump_cmm_raw</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Raw Cmm&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform
-&gt; [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683157334"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157371"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2090"></span><span>                    </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157371"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2091"></span><span>                  </span><span id="local-6989586621683157375"><span class="annot"><a href="#local-6989586621683157375"><span class="hs-identifier hs-var hs-var">rawcmms1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
 -&gt; UniqDSMT
      IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph])
-&gt; CgStream
     [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
     CmmCgInfos
-&gt; CgStream
     [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
     CmmCgInfos
forall (m :: * -&gt; *) a b x.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream m a x -&gt; Stream m b x
</span><a href="GHC.Data.Stream.html#mapM"><span class="hs-identifier hs-var">Stream.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; UniqDSMT
     IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
forall a. IO a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
 -&gt; UniqDSMT
      IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph])
-&gt; ([GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
    -&gt; IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph])
-&gt; [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; UniqDSMT
     IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157370"><span class="hs-identifier hs-var">dump</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CgStream
  [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
  CmmCgInfos
</span><a href="#local-6989586621683157366"><span class="hs-identifier hs-var">rawcmms0</span></a></span><span>
</span><span id="line-2092"></span><span>
</span><span id="line-2093"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157377"><span class="annot"><a href="#local-6989586621683157377"><span class="hs-identifier hs-var hs-var">foreign_stubs</span></a></span></span><span> </span><span id="local-6989586621683157378"><span class="annot"><span class="annottext">CmmCgInfos
</span><a href="#local-6989586621683157378"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683157293"><span class="hs-identifier hs-var">foreign_stubs0</span></a></span><span>
</span><span id="line-2094"></span><span>                                     </span><span class="annot"><span class="annottext">ForeignStubs -&gt; CStub -&gt; ForeignStubs
</span><a href="GHC.Types.ForeignStubs.html#appendStubC"><span class="hs-operator hs-var">`appendStubC`</span></a></span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621683157335"><span class="hs-identifier hs-var">prof_init</span></a></span><span>
</span><span id="line-2095"></span><span>                                     </span><span class="annot"><span class="annottext">ForeignStubs -&gt; CStub -&gt; ForeignStubs
</span><a href="GHC.Types.ForeignStubs.html#appendStubC"><span class="hs-operator hs-var">`appendStubC`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmCgInfos -&gt; CStub
</span><a href="GHC.StgToCmm.Types.html#cgIPEStub"><span class="hs-identifier hs-var">cgIPEStub</span></a></span><span> </span><span class="annot"><span class="annottext">CmmCgInfos
</span><a href="#local-6989586621683157378"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-2096"></span><span>
</span><span id="line-2097"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621683157380"><span class="annot"><a href="#local-6989586621683157380"><span class="hs-identifier hs-var">output_filename</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157381"><span class="annot"><a href="#local-6989586621683157381"><span class="hs-identifier hs-var">_stub_h_exists</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157382"><span class="annot"><a href="#local-6989586621683157382"><span class="hs-identifier hs-var">stub_c_exists</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157383"><span class="annot"><a href="#local-6989586621683157383"><span class="hs-identifier hs-var">foreign_fps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157384"><span class="annot"><a href="#local-6989586621683157384"><span class="hs-identifier hs-var">cmm_cg_infos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2098"></span><span>                  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;codeOutput&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2099"></span><span>                    </span><span class="annot"><a href="GHC.Driver.CodeOutput.html#codeOutput"><span class="hs-identifier hs-type">codeOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157263"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157307"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157308"><span class="hs-identifier hs-type">llvm_config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157262"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-type">hsc_units</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157252"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157258"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157255"><span class="hs-identifier hs-type">output_filename</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157254"><span class="hs-identifier hs-type">location</span></a></span><span>
</span><span id="line-2100"></span><span>                    </span><span class="annot"><a href="#local-6989586621683157377"><span class="hs-identifier hs-type">foreign_stubs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157295"><span class="hs-identifier hs-type">foreign_files</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157297"><span class="hs-identifier hs-type">dependencies</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DSM.html#initDUniqSupply"><span class="hs-identifier hs-type">initDUniqSupply</span></a></span><span> </span><span class="annot"><span class="hs-char">'n'</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157375"><span class="hs-identifier hs-type">rawcmms1</span></a></span><span>
</span><span id="line-2101"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683157380"><span class="hs-identifier hs-type">output_filename</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157382"><span class="hs-identifier hs-type">stub_c_exists</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157383"><span class="hs-identifier hs-type">foreign_fps</span></a></span><span>
</span><span id="line-2102"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683157321"><span class="hs-identifier hs-type">stg_cg_infos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683157384"><span class="hs-identifier hs-type">cmm_cg_infos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2103"></span><span>
</span><span id="line-2104"></span><span>
</span><span id="line-2105"></span><span class="hs-comment">-- The part of CgGuts that we need for HscInteractive</span><span>
</span><span id="line-2106"></span><span class="hs-keyword">data</span><span> </span><span id="CgInteractiveGuts"><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-var">CgInteractiveGuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CgInteractiveGuts"><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-var">CgInteractiveGuts</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="cgi_module"><span class="annot"><span class="annottext">CgInteractiveGuts -&gt; Module
</span><a href="GHC.Driver.Main.html#cgi_module"><span class="hs-identifier hs-var hs-var">cgi_module</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2107"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span id="cgi_binds"><span class="annot"><span class="annottext">CgInteractiveGuts -&gt; CoreProgram
</span><a href="GHC.Driver.Main.html#cgi_binds"><span class="hs-identifier hs-var hs-var">cgi_binds</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-2108"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span id="cgi_tycons"><span class="annot"><span class="annottext">CgInteractiveGuts -&gt; [TyCon]
</span><a href="GHC.Driver.Main.html#cgi_tycons"><span class="hs-identifier hs-var hs-var">cgi_tycons</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2109"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span id="cgi_foreign"><span class="annot"><span class="annottext">CgInteractiveGuts -&gt; ForeignStubs
</span><a href="GHC.Driver.Main.html#cgi_foreign"><span class="hs-identifier hs-var hs-var">cgi_foreign</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a></span><span>
</span><span id="line-2110"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span id="cgi_foreign_files"><span class="annot"><span class="annottext">CgInteractiveGuts -&gt; [(ForeignSrcLang, [Char])]
</span><a href="GHC.Driver.Main.html#cgi_foreign_files"><span class="hs-identifier hs-var hs-var">cgi_foreign_files</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForeignSrcLang</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2111"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span id="cgi_modBreaks"><span class="annot"><span class="annottext">CgInteractiveGuts -&gt; Maybe ModBreaks
</span><a href="GHC.Driver.Main.html#cgi_modBreaks"><span class="hs-identifier hs-var hs-var">cgi_modBreaks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span>
</span><span id="line-2112"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span id="cgi_spt_entries"><span class="annot"><span class="annottext">CgInteractiveGuts -&gt; [SptEntry]
</span><a href="GHC.Driver.Main.html#cgi_spt_entries"><span class="hs-identifier hs-var hs-var">cgi_spt_entries</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2113"></span><span>                                           </span><span class="hs-special">}</span><span>
</span><span id="line-2114"></span><span>
</span><span id="line-2115"></span><span class="annot"><a href="GHC.Driver.Main.html#mkCgInteractiveGuts"><span class="hs-identifier hs-type">mkCgInteractiveGuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-type">CgInteractiveGuts</span></a></span><span>
</span><span id="line-2116"></span><span id="mkCgInteractiveGuts"><span class="annot"><span class="annottext">mkCgInteractiveGuts :: CgGuts -&gt; CgInteractiveGuts
</span><a href="GHC.Driver.Main.html#mkCgInteractiveGuts"><span class="hs-identifier hs-var hs-var">mkCgInteractiveGuts</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span class="hs-special">{</span><span id="local-6989586621683157394"><span class="annot"><span class="annottext">Module
cg_module :: CgGuts -&gt; Module
cg_module :: Module
</span><a href="GHC.Unit.Module.ModGuts.html#cg_module"><span class="hs-identifier hs-var hs-var">cg_module</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157395"><span class="annot"><span class="annottext">CoreProgram
cg_binds :: CgGuts -&gt; CoreProgram
cg_binds :: CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var hs-var">cg_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157396"><span class="annot"><span class="annottext">[TyCon]
cg_tycons :: CgGuts -&gt; [TyCon]
cg_tycons :: [TyCon]
</span><a href="GHC.Unit.Module.ModGuts.html#cg_tycons"><span class="hs-identifier hs-var hs-var">cg_tycons</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157397"><span class="annot"><span class="annottext">ForeignStubs
cg_foreign :: CgGuts -&gt; ForeignStubs
cg_foreign :: ForeignStubs
</span><a href="GHC.Unit.Module.ModGuts.html#cg_foreign"><span class="hs-identifier hs-var hs-var">cg_foreign</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157398"><span class="annot"><span class="annottext">[(ForeignSrcLang, [Char])]
cg_foreign_files :: CgGuts -&gt; [(ForeignSrcLang, [Char])]
cg_foreign_files :: [(ForeignSrcLang, [Char])]
</span><a href="GHC.Unit.Module.ModGuts.html#cg_foreign_files"><span class="hs-identifier hs-var hs-var">cg_foreign_files</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157399"><span class="annot"><span class="annottext">Maybe ModBreaks
cg_modBreaks :: Maybe ModBreaks
cg_modBreaks :: CgGuts -&gt; Maybe ModBreaks
</span><a href="#local-6989586621683157399"><span class="hs-identifier hs-var hs-var">cg_modBreaks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157401"><span class="annot"><span class="annottext">[SptEntry]
cg_spt_entries :: CgGuts -&gt; [SptEntry]
cg_spt_entries :: [SptEntry]
</span><a href="GHC.Unit.Module.ModGuts.html#cg_spt_entries"><span class="hs-identifier hs-var hs-var">cg_spt_entries</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-2117"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
-&gt; CoreProgram
-&gt; [TyCon]
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, [Char])]
-&gt; Maybe ModBreaks
-&gt; [SptEntry]
-&gt; CgInteractiveGuts
</span><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-var">CgInteractiveGuts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157394"><span class="hs-identifier hs-var">cg_module</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157395"><span class="hs-identifier hs-var">cg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157396"><span class="hs-identifier hs-var">cg_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683157397"><span class="hs-identifier hs-var">cg_foreign</span></a></span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, [Char])]
</span><a href="#local-6989586621683157398"><span class="hs-identifier hs-var">cg_foreign_files</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621683157399"><span class="hs-identifier hs-var">cg_modBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621683157401"><span class="hs-identifier hs-var">cg_spt_entries</span></a></span><span>
</span><span id="line-2118"></span><span>
</span><span id="line-2119"></span><span class="annot"><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier hs-type">hscInteractive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2120"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-type">CgInteractiveGuts</span></a></span><span>
</span><span id="line-2121"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-2122"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ .c stub path (if any) and ByteCode</span></span><span>
</span><span id="line-2123"></span><span id="hscInteractive"><span class="annot"><span class="annottext">hscInteractive :: HscEnv
-&gt; CgInteractiveGuts
-&gt; ModLocation
-&gt; IO (Maybe [Char], CompiledByteCode)
</span><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier hs-var hs-var">hscInteractive</span></a></span></span><span> </span><span id="local-6989586621683157402"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157402"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157403"><span class="annot"><span class="annottext">CgInteractiveGuts
</span><a href="#local-6989586621683157403"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span> </span><span id="local-6989586621683157404"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157404"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2124"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157405"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683157405"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157402"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2125"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157406"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683157406"><span class="hs-identifier hs-var hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157402"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2126"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157407"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621683157407"><span class="hs-identifier hs-var hs-var hs-var">tmpfs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157402"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2127"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-type">CgInteractiveGuts</span></a></span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- This is the last use of the ModGuts in a compilation.</span><span>
</span><span id="line-2128"></span><span>                </span><span class="hs-comment">-- From now on, we just use the bits we need.</span><span>
</span><span id="line-2129"></span><span>               </span><span class="annot"><span class="annottext">cgi_module :: CgInteractiveGuts -&gt; Module
</span><a href="GHC.Driver.Main.html#cgi_module"><span class="hs-identifier hs-var">cgi_module</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157408"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157408"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2130"></span><span>               </span><span class="annot"><span class="annottext">cgi_binds :: CgInteractiveGuts -&gt; CoreProgram
</span><a href="GHC.Driver.Main.html#cgi_binds"><span class="hs-identifier hs-var">cgi_binds</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157409"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157409"><span class="hs-identifier hs-var hs-var">core_binds</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2131"></span><span>               </span><span class="annot"><span class="annottext">cgi_tycons :: CgInteractiveGuts -&gt; [TyCon]
</span><a href="GHC.Driver.Main.html#cgi_tycons"><span class="hs-identifier hs-var">cgi_tycons</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157410"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157410"><span class="hs-identifier hs-var hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2132"></span><span>               </span><span class="annot"><span class="annottext">cgi_foreign :: CgInteractiveGuts -&gt; ForeignStubs
</span><a href="GHC.Driver.Main.html#cgi_foreign"><span class="hs-identifier hs-var">cgi_foreign</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157411"><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683157411"><span class="hs-identifier hs-var hs-var">foreign_stubs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2133"></span><span>               </span><span class="annot"><span class="annottext">cgi_modBreaks :: CgInteractiveGuts -&gt; Maybe ModBreaks
</span><a href="GHC.Driver.Main.html#cgi_modBreaks"><span class="hs-identifier hs-var">cgi_modBreaks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157412"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621683157412"><span class="hs-identifier hs-var hs-var">mod_breaks</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2134"></span><span>               </span><span class="annot"><span class="annottext">cgi_spt_entries :: CgInteractiveGuts -&gt; [SptEntry]
</span><a href="GHC.Driver.Main.html#cgi_spt_entries"><span class="hs-identifier hs-var">cgi_spt_entries</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157413"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621683157413"><span class="hs-identifier hs-var hs-var">spt_entries</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgInteractiveGuts
</span><a href="#local-6989586621683157403"><span class="hs-identifier hs-var">cgguts</span></a></span><span>
</span><span id="line-2135"></span><span>
</span><span id="line-2136"></span><span>        </span><span id="local-6989586621683157414"><span class="annot"><span class="annottext">data_tycons :: [TyCon]
</span><a href="#local-6989586621683157414"><span class="hs-identifier hs-var hs-var hs-var">data_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Bool) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataTyCon"><span class="hs-identifier hs-var">isDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157410"><span class="hs-identifier hs-var">tycons</span></a></span><span>
</span><span id="line-2137"></span><span>        </span><span class="hs-comment">-- cg_tycons includes newtypes, for the benefit of External Core,</span><span>
</span><span id="line-2138"></span><span>        </span><span class="hs-comment">-- but we don't generate any code for newtypes</span><span>
</span><span id="line-2139"></span><span>
</span><span id="line-2140"></span><span>    </span><span class="hs-comment">-------------------</span><span>
</span><span id="line-2141"></span><span>    </span><span class="hs-comment">-- PREPARE FOR CODE GENERATION</span><span>
</span><span id="line-2142"></span><span>    </span><span class="hs-comment">-- Do saturation and convert to A-normal form</span><span>
</span><span id="line-2143"></span><span>    </span><span id="local-6989586621683157415"><span class="annot"><a href="#local-6989586621683157415"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CorePrep&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2144"></span><span>      </span><span id="local-6989586621683157416"><span class="annot"><a href="#local-6989586621683157416"><span class="hs-identifier hs-var">cp_cfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO CorePrepConfig
</span><a href="GHC.Driver.Config.CoreToStg.Prep.html#initCorePrepConfig"><span class="hs-identifier hs-var">initCorePrepConfig</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157402"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2145"></span><span>      </span><span class="annot"><a href="GHC.CoreToStg.Prep.html#corePrepPgm"><span class="hs-identifier hs-type">corePrepPgm</span></a></span><span>
</span><span id="line-2146"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157402"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2147"></span><span>        </span><span class="annot"><a href="#local-6989586621683157416"><span class="hs-identifier hs-type">cp_cfg</span></a></span><span>
</span><span id="line-2148"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.CoreToStg.Prep.html#initCorePrepPgmConfig"><span class="hs-identifier hs-type">initCorePrepPgmConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157402"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier hs-type">interactiveInScope</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157402"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2149"></span><span>        </span><span class="annot"><a href="#local-6989586621683157408"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157404"><span class="hs-identifier hs-type">location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157409"><span class="hs-identifier hs-type">core_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157414"><span class="hs-identifier hs-type">data_tycons</span></a></span><span>
</span><span id="line-2150"></span><span>
</span><span id="line-2151"></span><span>    </span><span class="hs-comment">-- The stg cg info only provides a runtime benfit, but is not requires so we just</span><span>
</span><span id="line-2152"></span><span>    </span><span class="hs-comment">-- omit it here</span><span>
</span><span id="line-2153"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157417"><span class="annot"><a href="#local-6989586621683157417"><span class="hs-identifier hs-var">stg_binds_with_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157418"><span class="annot"><a href="#local-6989586621683157418"><span class="hs-identifier hs-var">_infotable_prov</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157419"><span class="annot"><a href="#local-6989586621683157419"><span class="hs-identifier hs-var">_caf_ccs__caf_cc_stacks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157420"><span class="annot"><a href="#local-6989586621683157420"><span class="hs-identifier hs-var">_ignore_stg_cg_infos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2154"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CoreToStg&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2155"></span><span>          </span><span class="annot"><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-type">myCoreToStg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157406"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157405"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier hs-type">interactiveInScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157402"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683157408"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157404"><span class="hs-identifier hs-type">location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157415"><span class="hs-identifier hs-type">prepd_binds</span></a></span><span>
</span><span id="line-2156"></span><span>
</span><span id="line-2157"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157421"><span class="annot"><a href="#local-6989586621683157421"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157422"><span class="annot"><a href="#local-6989586621683157422"><span class="hs-identifier hs-var">_stg_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621683157417"><span class="hs-identifier hs-type">stg_binds_with_deps</span></a></span><span>
</span><span id="line-2158"></span><span>
</span><span id="line-2159"></span><span>    </span><span class="hs-comment">-----------------  Generate byte code ------------------</span><span>
</span><span id="line-2160"></span><span>    </span><span id="local-6989586621683157423"><span class="annot"><a href="#local-6989586621683157423"><span class="hs-identifier hs-var">comp_bc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier hs-type">byteCodeGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157402"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157408"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157421"><span class="hs-identifier hs-type">stg_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157414"><span class="hs-identifier hs-type">data_tycons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157412"><span class="hs-identifier hs-type">mod_breaks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157413"><span class="hs-identifier hs-type">spt_entries</span></a></span><span>
</span><span id="line-2161"></span><span>
</span><span id="line-2162"></span><span>    </span><span class="hs-comment">------------------ Create f-x-dynamic C-side stuff -----</span><span>
</span><span id="line-2163"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157424"><span class="annot"><a href="#local-6989586621683157424"><span class="hs-identifier hs-var">_istub_h_exists</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157425"><span class="annot"><a href="#local-6989586621683157425"><span class="hs-identifier hs-var">istub_c_exists</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2164"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.CodeOutput.html#outputForeignStubs"><span class="hs-identifier hs-type">outputForeignStubs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157406"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157407"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157405"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-type">hsc_units</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157402"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157408"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157404"><span class="hs-identifier hs-type">location</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157411"><span class="hs-identifier hs-type">foreign_stubs</span></a></span><span>
</span><span id="line-2165"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157425"><span class="hs-identifier hs-type">istub_c_exists</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157423"><span class="hs-identifier hs-type">comp_bc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2166"></span><span>
</span><span id="line-2167"></span><span class="hs-comment">-- | Compile Core bindings and foreign inputs that were loaded from an</span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- interface, to produce bytecode and potential foreign objects for the purpose</span><span>
</span><span id="line-2169"></span><span class="hs-comment">-- of linking splices.</span><span>
</span><span id="line-2170"></span><span class="annot"><a href="GHC.Driver.Main.html#generateByteCode"><span class="hs-identifier hs-type">generateByteCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-type">CgInteractiveGuts</span></a></span><span>
</span><span id="line-2172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-2173"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2174"></span><span id="generateByteCode"><span class="annot"><span class="annottext">generateByteCode :: HscEnv
-&gt; CgInteractiveGuts
-&gt; ModLocation
-&gt; IO (CompiledByteCode, [[Char]])
</span><a href="GHC.Driver.Main.html#generateByteCode"><span class="hs-identifier hs-var hs-var">generateByteCode</span></a></span></span><span> </span><span id="local-6989586621683157427"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157427"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157428"><span class="annot"><span class="annottext">CgInteractiveGuts
</span><a href="#local-6989586621683157428"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span> </span><span id="local-6989586621683157429"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157429"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2175"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683157430"><span class="annot"><a href="#local-6989586621683157430"><span class="hs-identifier hs-var">hasStub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157431"><span class="annot"><a href="#local-6989586621683157431"><span class="hs-identifier hs-var">comp_bc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; CgInteractiveGuts
-&gt; ModLocation
-&gt; IO (Maybe [Char], CompiledByteCode)
</span><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier hs-var">hscInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157427"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">CgInteractiveGuts
</span><a href="#local-6989586621683157428"><span class="hs-identifier hs-var">cgguts</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157429"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-2176"></span><span>  </span><span class="annot"><a href="GHC.Driver.Main.html#compile_for_interpreter"><span class="hs-identifier hs-type">compile_for_interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157427"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683157432"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157432"><span class="hs-identifier hs-var">i_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2177"></span><span>    </span><span id="local-6989586621683157433"><span class="annot"><a href="#local-6989586621683157433"><span class="hs-identifier hs-var">stub_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO [Char]) -&gt; Maybe [Char] -&gt; IO (Maybe [Char])
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; ForeignSrcLang -&gt; [Char] -&gt; IO [Char]
</span><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-var">compileForeign</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157432"><span class="hs-identifier hs-var">i_env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><span class="hs-identifier hs-var">LangC</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621683157430"><span class="hs-identifier hs-var">hasStub</span></a></span><span>
</span><span id="line-2178"></span><span>    </span><span id="local-6989586621683157437"><span class="annot"><a href="#local-6989586621683157437"><span class="hs-identifier hs-var">foreign_files_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-type">compileForeign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157432"><span class="hs-identifier hs-type">i_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Main.html#cgi_foreign_files"><span class="hs-identifier hs-var">cgi_foreign_files</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157428"><span class="hs-identifier hs-type">cgguts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2179"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157431"><span class="hs-identifier hs-type">comp_bc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToList</span></span><span> </span><span class="annot"><a href="#local-6989586621683157433"><span class="hs-identifier hs-type">stub_o</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683157437"><span class="hs-identifier hs-type">foreign_files_o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2180"></span><span>
</span><span id="line-2181"></span><span class="annot"><a href="GHC.Driver.Main.html#generateFreshByteCode"><span class="hs-identifier hs-type">generateFreshByteCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2182"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-2183"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#CgInteractiveGuts"><span class="hs-identifier hs-type">CgInteractiveGuts</span></a></span><span>
</span><span id="line-2184"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-2185"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span>
</span><span id="line-2186"></span><span id="generateFreshByteCode"><span class="annot"><span class="annottext">generateFreshByteCode :: HscEnv
-&gt; ModuleName -&gt; CgInteractiveGuts -&gt; ModLocation -&gt; IO Linkable
</span><a href="GHC.Driver.Main.html#generateFreshByteCode"><span class="hs-identifier hs-var hs-var">generateFreshByteCode</span></a></span></span><span> </span><span id="local-6989586621683157439"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157439"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157440"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683157440"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span id="local-6989586621683157441"><span class="annot"><span class="annottext">CgInteractiveGuts
</span><a href="#local-6989586621683157441"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span> </span><span id="local-6989586621683157442"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157442"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2187"></span><span>  </span><span id="local-6989586621683157443"><span class="annot"><a href="#local-6989586621683157443"><span class="hs-identifier hs-var">bco_time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../../time-1.14-9bf8/src/Data.Time.Clock.POSIX.html#getCurrentTime"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-2188"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683157444"><span class="annot"><a href="#local-6989586621683157444"><span class="hs-identifier hs-var">bcos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157445"><span class="annot"><a href="#local-6989586621683157445"><span class="hs-identifier hs-var">fos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#generateByteCode"><span class="hs-identifier hs-type">generateByteCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157439"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157441"><span class="hs-identifier hs-type">cgguts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157442"><span class="hs-identifier hs-type">mod_location</span></a></span><span>
</span><span id="line-2189"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span>
</span><span id="line-2190"></span><span>    </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157443"><span class="hs-identifier hs-type">bco_time</span></a></span><span>
</span><span id="line-2191"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-type">mkHomeModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-type">hsc_home_unit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157439"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157440"><span class="hs-identifier hs-type">mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2192"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Types.html#BCOs"><span class="hs-identifier hs-type">BCOs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157444"><span class="hs-identifier hs-type">bcos</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#DotO"><span class="hs-identifier hs-type">DotO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157446"><span class="hs-identifier hs-type">fo</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#ForeignObject"><span class="hs-identifier hs-type">ForeignObject</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683157446"><span class="annot"><a href="#local-6989586621683157446"><span class="hs-identifier hs-var">fo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683157445"><span class="hs-identifier hs-type">fos</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2193"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2194"></span><span>
</span><span id="line-2195"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier hs-type">hscCompileCmmFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-2196"></span><span id="hscCompileCmmFile"><span class="annot"><span class="annottext">hscCompileCmmFile :: HscEnv -&gt; [Char] -&gt; [Char] -&gt; [Char] -&gt; IO (Maybe [Char])
</span><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier hs-var hs-var">hscCompileCmmFile</span></a></span></span><span> </span><span id="local-6989586621683157447"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157448"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157448"><span class="hs-identifier hs-var">original_filename</span></a></span></span><span> </span><span id="local-6989586621683157449"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157449"><span class="hs-identifier hs-var">filename</span></a></span></span><span> </span><span id="local-6989586621683157450"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157450"><span class="hs-identifier hs-var">output_filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Maybe [Char]) -&gt; IO (Maybe [Char])
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe [Char]) -&gt; IO (Maybe [Char]))
-&gt; Hsc (Maybe [Char]) -&gt; IO (Maybe [Char])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2197"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157451"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683157451"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2198"></span><span>        </span><span id="local-6989586621683157452"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683157452"><span class="hs-identifier hs-var hs-var hs-var">logger</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2199"></span><span>        </span><span id="local-6989586621683157453"><span class="annot"><span class="annottext">hooks :: Hooks
</span><a href="#local-6989586621683157453"><span class="hs-identifier hs-var hs-var hs-var">hooks</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2200"></span><span>        </span><span id="local-6989586621683157454"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621683157454"><span class="hs-identifier hs-var hs-var hs-var">tmpfs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2201"></span><span>        </span><span id="local-6989586621683157455"><span class="annot"><span class="annottext">profile :: Profile
</span><a href="#local-6989586621683157455"><span class="hs-identifier hs-var hs-var hs-var">profile</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Profile
</span><a href="GHC.Driver.DynFlags.html#targetProfile"><span class="hs-identifier hs-var">targetProfile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157451"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2202"></span><span>        </span><span id="local-6989586621683157456"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621683157456"><span class="hs-identifier hs-var hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2203"></span><span>        </span><span id="local-6989586621683157457"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621683157457"><span class="hs-identifier hs-var hs-var hs-var">platform</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157451"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2204"></span><span>        </span><span id="local-6989586621683157458"><span class="annot"><span class="annottext">llvm_config :: LlvmConfigCache
</span><a href="#local-6989586621683157458"><span class="hs-identifier hs-var hs-var hs-var">llvm_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; LlvmConfigCache
</span><a href="GHC.Driver.Env.Types.html#hsc_llvm_config"><span class="hs-identifier hs-var">hsc_llvm_config</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157447"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2205"></span><span>        </span><span id="local-6989586621683157459"><span class="annot"><span class="annottext">cmm_config :: CmmConfig
</span><a href="#local-6989586621683157459"><span class="hs-identifier hs-var hs-var hs-var">cmm_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; CmmConfig
</span><a href="GHC.Driver.Config.Cmm.html#initCmmConfig"><span class="hs-identifier hs-var">initCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157451"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2206"></span><span>        </span><span id="local-6989586621683157460"><span class="annot"><span class="annottext">do_info_table :: Bool
</span><a href="#local-6989586621683157460"><span class="hs-identifier hs-var hs-var hs-var">do_info_table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_InfoTableMap"><span class="hs-identifier hs-var">Opt_InfoTableMap</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157451"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2207"></span><span>        </span><span class="hs-comment">-- Make up a module name to give the NCG. We can't pass bottom here</span><span>
</span><span id="line-2208"></span><span>        </span><span class="hs-comment">-- lest we reproduce #11784.</span><span>
</span><span id="line-2209"></span><span>        </span><span id="local-6989586621683157462"><span class="annot"><span class="annottext">mod_name :: ModuleName
</span><a href="#local-6989586621683157462"><span class="hs-identifier hs-var hs-var hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ModuleName) -&gt; [Char] -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cmm$&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157448"><span class="hs-identifier hs-var">original_filename</span></a></span><span>
</span><span id="line-2210"></span><span>        </span><span id="local-6989586621683157464"><span class="annot"><span class="annottext">cmm_mod :: Module
</span><a href="#local-6989586621683157464"><span class="hs-identifier hs-var hs-var hs-var">cmm_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683157456"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683157462"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-2211"></span><span>        </span><span id="local-6989586621683157465"><span class="annot"><span class="annottext">cmmpConfig :: CmmParserConfig
</span><a href="#local-6989586621683157465"><span class="hs-identifier hs-var hs-var hs-var">cmmpConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; CmmParserConfig
</span><a href="GHC.Driver.Config.Cmm.Parser.html#initCmmParserConfig"><span class="hs-identifier hs-var">initCmmParserConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157451"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2212"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157466"><span class="annot"><a href="#local-6989586621683157466"><span class="hs-identifier hs-var">dcmm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157467"><span class="annot"><a href="#local-6989586621683157467"><span class="hs-identifier hs-var">ipe_ents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe (DCmmGroup, [InfoProvEnt]))
-&gt; Hsc (DCmmGroup, [InfoProvEnt])
forall a. IO (Messages GhcMessage, Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span>
</span><span id="line-2213"></span><span>               </span><span class="annot"><span class="annottext">(IO (Messages GhcMessage, Maybe (DCmmGroup, [InfoProvEnt]))
 -&gt; Hsc (DCmmGroup, [InfoProvEnt]))
-&gt; IO (Messages GhcMessage, Maybe (DCmmGroup, [InfoProvEnt]))
-&gt; Hsc (DCmmGroup, [InfoProvEnt])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2214"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621683157468"><span class="annot"><a href="#local-6989586621683157468"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157469"><span class="annot"><a href="#local-6989586621683157469"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157470"><span class="annot"><a href="#local-6989586621683157470"><span class="hs-identifier hs-var">cmm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; ((Messages PsWarning, Messages PsWarning,
     Maybe (DCmmGroup, [InfoProvEnt]))
    -&gt; ())
-&gt; IO
     (Messages PsWarning, Messages PsWarning,
      Maybe (DCmmGroup, [InfoProvEnt]))
-&gt; IO
     (Messages PsWarning, Messages PsWarning,
      Maybe (DCmmGroup, [InfoProvEnt]))
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157452"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ParseCmm&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157449"><span class="hs-identifier hs-var">filename</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">(Messages PsWarning, Messages PsWarning,
 Maybe (DCmmGroup, [InfoProvEnt]))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2215"></span><span>                                       </span><span class="annot"><span class="annottext">(IO
   (Messages PsWarning, Messages PsWarning,
    Maybe (DCmmGroup, [InfoProvEnt]))
 -&gt; IO
      (Messages PsWarning, Messages PsWarning,
       Maybe (DCmmGroup, [InfoProvEnt])))
-&gt; IO
     (Messages PsWarning, Messages PsWarning,
      Maybe (DCmmGroup, [InfoProvEnt]))
-&gt; IO
     (Messages PsWarning, Messages PsWarning,
      Maybe (DCmmGroup, [InfoProvEnt]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmParserConfig
-&gt; Module
-&gt; HomeUnit
-&gt; [Char]
-&gt; IO
     (Messages PsWarning, Messages PsWarning,
      Maybe (DCmmGroup, [InfoProvEnt]))
</span><a href="GHC.Cmm.Parser.html#parseCmmFile"><span class="hs-identifier hs-var">parseCmmFile</span></a></span><span> </span><span class="annot"><span class="annottext">CmmParserConfig
</span><a href="#local-6989586621683157465"><span class="hs-identifier hs-var">cmmpConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157464"><span class="hs-identifier hs-var">cmm_mod</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683157456"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157449"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-2216"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157472"><span class="annot"><a href="#local-6989586621683157472"><span class="hs-identifier hs-var hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683157468"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">Messages PsWarning -&gt; Messages PsWarning -&gt; Messages PsWarning
forall e. Messages e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-var">`unionMessages`</span></a></span><span> </span><span class="annot"><span class="annottext">Messages PsWarning
</span><a href="#local-6989586621683157469"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-2217"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-type">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683157472"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157470"><span class="hs-identifier hs-type">cmm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2218"></span><span>    </span><span class="hs-comment">-- Probably need to rename cmm here</span><span>
</span><span id="line-2219"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157473"><span class="annot"><a href="#local-6989586621683157473"><span class="hs-identifier hs-var hs-var">cmm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DCmmGroup -&gt; CmmGroup
</span><a href="GHC.Cmm.html#removeDeterm"><span class="hs-identifier hs-var">removeDeterm</span></a></span><span> </span><span class="annot"><span class="annottext">DCmmGroup
</span><a href="#local-6989586621683157466"><span class="hs-identifier hs-var">dcmm</span></a></span><span>
</span><span id="line-2220"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2221"></span><span>        </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157452"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm_verbose_by_proc"><span class="hs-identifier hs-type">Opt_D_dump_cmm_verbose_by_proc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Parsed Cmm&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-type">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157457"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157473"><span class="hs-identifier hs-type">cmm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2222"></span><span>
</span><span id="line-2223"></span><span>        </span><span class="hs-comment">-- Compile decls in Cmm files one decl at a time, to avoid re-ordering</span><span>
</span><span id="line-2224"></span><span>        </span><span class="hs-comment">-- them in SRT analysis.</span><span>
</span><span id="line-2225"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2226"></span><span>        </span><span class="hs-comment">-- Re-ordering here causes breakage when booting with C backend because</span><span>
</span><span id="line-2227"></span><span>        </span><span class="hs-comment">-- in C we must declare before use, but SRT algorithm is free to</span><span>
</span><span id="line-2228"></span><span>        </span><span class="hs-comment">-- re-order [A, B] (B refers to A) when A is not CAFFY and return [B, A]</span><span>
</span><span id="line-2229"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683157476"><span class="annot"><a href="#local-6989586621683157476"><span class="hs-identifier hs-var">dus1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157477"><span class="annot"><a href="#local-6989586621683157477"><span class="hs-identifier hs-var">cmmgroup</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Bifunctor.html#second"><span class="hs-identifier hs-type">second</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span>
</span><span id="line-2230"></span><span>          </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-type">mapAccumLM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683157481"><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621683157481"><span class="hs-identifier hs-var">msrt0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157482"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621683157482"><span class="hs-identifier hs-var">dus0</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683157483"><span class="annot"><span class="annottext">GenCmmDecl CmmStatics CmmTopInfo CmmGraph
</span><a href="#local-6989586621683157483"><span class="hs-identifier hs-var">cmm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2231"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683157484"><span class="annot"><a href="#local-6989586621683157484"><span class="hs-identifier hs-var">msrt1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157485"><span class="annot"><a href="#local-6989586621683157485"><span class="hs-identifier hs-var">cmm'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157486"><span class="annot"><a href="#local-6989586621683157486"><span class="hs-identifier hs-var">dus1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; CmmConfig
-&gt; ModuleSRTInfo
-&gt; CmmGroup
-&gt; DUniqSupply
-&gt; IO
     ((ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]),
      DUniqSupply)
</span><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier hs-var">cmmPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157452"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621683157459"><span class="hs-identifier hs-var">cmm_config</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621683157481"><span class="hs-identifier hs-var">msrt0</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenCmmDecl CmmStatics CmmTopInfo CmmGraph
</span><a href="#local-6989586621683157483"><span class="hs-identifier hs-var">cmm</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621683157482"><span class="hs-identifier hs-var">dus0</span></a></span><span>
</span><span id="line-2232"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157484"><span class="hs-identifier hs-type">msrt1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157486"><span class="hs-identifier hs-type">dus1</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157485"><span class="hs-identifier hs-type">cmm'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-type">emptySRT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157464"><span class="hs-identifier hs-type">cmm_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#initDUniqSupply"><span class="hs-identifier hs-type">initDUniqSupply</span></a></span><span> </span><span class="annot"><span class="hs-char">'u'</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157473"><span class="hs-identifier hs-type">cmm</span></a></span><span>
</span><span id="line-2233"></span><span>
</span><span id="line-2234"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683157477"><span class="hs-identifier hs-type">cmmgroup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2235"></span><span>          </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157452"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm"><span class="hs-identifier hs-type">Opt_D_dump_cmm</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Output Cmm&quot;</span></span><span>
</span><span id="line-2236"></span><span>            </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-type">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157457"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157477"><span class="hs-identifier hs-type">cmmgroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2237"></span><span>
</span><span id="line-2238"></span><span>        </span><span id="local-6989586621683157490"><span class="annot"><a href="#local-6989586621683157490"><span class="hs-identifier hs-var">rawCmms0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html#cmmToRawCmmHook"><span class="hs-identifier hs-var">cmmToRawCmmHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157453"><span class="hs-identifier hs-type">hooks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2239"></span><span>          </span><span class="annot"><span class="annottext">Maybe
  (DynFlags
   -&gt; Maybe Module
   -&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] ()
   -&gt; IO
        (CgStream
           [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] ()))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; Profile
-&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] ()
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] ())
forall a.
Logger
-&gt; Profile
-&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] a
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] a)
</span><a href="GHC.Cmm.Info.html#cmmToRawCmm"><span class="hs-identifier hs-var">cmmToRawCmm</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157452"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683157455"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
-&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Stream m a ()
</span><a href="GHC.Data.Stream.html#yield"><span class="hs-identifier hs-var">Stream.yield</span></a></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157477"><span class="hs-identifier hs-var">cmmgroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2240"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157492"><span class="annot"><span class="annottext">DynFlags
-&gt; Maybe Module
-&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] ()
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] ())
</span><a href="#local-6989586621683157492"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Maybe Module
-&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] ()
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] ())
</span><a href="#local-6989586621683157492"><span class="hs-identifier hs-var">h</span></a></span><span>           </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157451"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Module
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
-&gt; CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Stream m a ()
</span><a href="GHC.Data.Stream.html#yield"><span class="hs-identifier hs-var">Stream.yield</span></a></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157477"><span class="hs-identifier hs-var">cmmgroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2241"></span><span>
</span><span id="line-2242"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157493"><span class="annot"><a href="#local-6989586621683157493"><span class="hs-identifier hs-var hs-var">dump</span></a></span></span><span> </span><span id="local-6989586621683157494"><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157494"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2243"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157494"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157452"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm_raw"><span class="hs-identifier hs-var">Opt_D_dump_cmm_raw</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Raw Cmm&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform
-&gt; [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683157457"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157494"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2244"></span><span>              </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157494"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2245"></span><span>            </span><span id="local-6989586621683157495"><span class="annot"><a href="#local-6989586621683157495"><span class="hs-identifier hs-var hs-var">rawCmms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
 -&gt; UniqDSMT
      IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph])
-&gt; CgStream
     [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] ()
-&gt; CgStream
     [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] ()
forall (m :: * -&gt; *) a b x.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream m a x -&gt; Stream m b x
</span><a href="GHC.Data.Stream.html#mapM"><span class="hs-identifier hs-var">Stream.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; UniqDSMT
     IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
forall a. IO a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
 -&gt; UniqDSMT
      IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph])
-&gt; ([GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
    -&gt; IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph])
-&gt; [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; UniqDSMT
     IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
-&gt; IO [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph]
</span><a href="#local-6989586621683157493"><span class="hs-identifier hs-var">dump</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CgStream
  [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph] ()
</span><a href="#local-6989586621683157490"><span class="hs-identifier hs-var">rawCmms0</span></a></span><span>
</span><span id="line-2246"></span><span>
</span><span id="line-2247"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157496"><span class="annot"><a href="#local-6989586621683157496"><span class="hs-identifier hs-var hs-var">foreign_stubs</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-2248"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InfoProvEnt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InfoProvEnt]
</span><a href="#local-6989586621683157467"><span class="hs-identifier hs-var">ipe_ents</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2249"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157497"><span class="annot"><span class="annottext">ip_init :: CStub
</span><a href="#local-6989586621683157497"><span class="hs-identifier hs-var hs-var">ip_init</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Platform -&gt; Module -&gt; CStub
</span><a href="GHC.Driver.CodeOutput.html#ipInitCode"><span class="hs-identifier hs-var">ipInitCode</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157460"><span class="hs-identifier hs-var">do_info_table</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683157457"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157464"><span class="hs-identifier hs-var">cmm_mod</span></a></span><span>
</span><span id="line-2250"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="GHC.Types.ForeignStubs.html#NoStubs"><span class="hs-identifier hs-var">NoStubs</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignStubs -&gt; CStub -&gt; ForeignStubs
</span><a href="GHC.Types.ForeignStubs.html#appendStubC"><span class="hs-operator hs-var">`appendStubC`</span></a></span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621683157497"><span class="hs-identifier hs-var">ip_init</span></a></span><span>
</span><span id="line-2251"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="GHC.Types.ForeignStubs.html#NoStubs"><span class="hs-identifier hs-var">NoStubs</span></a></span><span>
</span><span id="line-2252"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683157500"><span class="annot"><a href="#local-6989586621683157500"><span class="hs-identifier hs-var">_output_filename</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157501"><span class="annot"><a href="#local-6989586621683157501"><span class="hs-identifier hs-var">_stub_h_exists</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157502"><span class="annot"><a href="#local-6989586621683157502"><span class="hs-identifier hs-var">stub_c_exists</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157503"><span class="annot"><a href="#local-6989586621683157503"><span class="hs-identifier hs-var">_foreign_fps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157504"><span class="annot"><a href="#local-6989586621683157504"><span class="hs-identifier hs-var">_caf_infos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2253"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.CodeOutput.html#codeOutput"><span class="hs-identifier hs-type">codeOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157452"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157454"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157458"><span class="hs-identifier hs-type">llvm_config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157451"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-type">hsc_units</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157447"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157464"><span class="hs-identifier hs-type">cmm_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157450"><span class="hs-identifier hs-type">output_filename</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157505"><span class="hs-identifier hs-type">no_loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157496"><span class="hs-identifier hs-type">foreign_stubs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-type">S.empty</span></a></span><span>
</span><span id="line-2254"></span><span>             </span><span class="annot"><a href="#local-6989586621683157476"><span class="hs-identifier hs-type">dus1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157495"><span class="hs-identifier hs-type">rawCmms</span></a></span><span>
</span><span id="line-2255"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683157502"><span class="hs-identifier hs-type">stub_c_exists</span></a></span><span>
</span><span id="line-2256"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2257"></span><span>    </span><span id="local-6989586621683157505"><span class="annot"><span class="annottext">no_loc :: ModLocation
</span><a href="#local-6989586621683157505"><span class="hs-identifier hs-var hs-var">no_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#OsPathModLocation"><span class="hs-identifier hs-type">OsPathModLocation</span></a></span><span>
</span><span id="line-2258"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_hs_file_ospath :: Maybe OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file_ospath"><span class="hs-identifier hs-var">ml_hs_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; Maybe OsPath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; Maybe OsPath) -&gt; OsPath -&gt; Maybe OsPath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [Char] -&gt; OsPath
[Char] -&gt; OsPath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.OsPath.Internal.html#unsafeEncodeUtf"><span class="hs-identifier hs-var">unsafeEncodeUtf</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157448"><span class="hs-identifier hs-var">original_filename</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2259"></span><span>          </span><span class="annot"><span class="annottext">ml_hi_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file_ospath"><span class="hs-identifier hs-var">ml_hi_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCmmFile: no hi file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2260"></span><span>          </span><span class="annot"><span class="annottext">ml_obj_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file_ospath"><span class="hs-identifier hs-var">ml_obj_file_ospath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCmmFile: no obj file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2261"></span><span>          </span><span class="annot"><span class="annottext">ml_dyn_obj_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file_ospath"><span class="hs-identifier hs-var">ml_dyn_obj_file_ospath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCmmFile: no dyn obj file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2262"></span><span>          </span><span class="annot"><span class="annottext">ml_dyn_hi_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_hi_file_ospath"><span class="hs-identifier hs-var">ml_dyn_hi_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCmmFile: no dyn obj file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2263"></span><span>          </span><span class="annot"><span class="annottext">ml_hie_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file_ospath"><span class="hs-identifier hs-var">ml_hie_file_ospath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCmmFile: no hie file&quot;</span></span><span class="hs-special">}</span><span>
</span><span id="line-2264"></span><span>
</span><span id="line-2265"></span><span class="hs-comment">-------------------- Stuff for new code gen ---------------------</span><span>
</span><span id="line-2266"></span><span>
</span><span id="line-2267"></span><span class="hs-comment">{-
Note [Forcing of stg_binds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
The two last steps in the STG pipeline are:

* Sorting the bindings in dependency order.
* Annotating them with free variables.

We want to make sure we do not keep references to unannotated STG bindings
alive, nor references to bindings which have already been compiled to Cmm.

We explicitly force the bindings to avoid this.

This reduces residency towards the end of the CodeGen phase significantly
(5-10%).
-}</span><span>
</span><span id="line-2283"></span><span>
</span><span id="line-2284"></span><span class="annot"><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier hs-type">doCodeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2285"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>
</span><span id="line-2286"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Bindings come already annotated with fvs</span></span><span>
</span><span id="line-2287"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2288"></span><span>         </span><span class="hs-comment">-- Note we produce a 'Stream' of CmmGroups, so that the</span><span>
</span><span id="line-2289"></span><span>         </span><span class="hs-comment">-- backend can be run incrementally.  Otherwise it generates all</span><span>
</span><span id="line-2290"></span><span>         </span><span class="hs-comment">-- the C-- up front, which has a significant space cost.</span><span>
</span><span id="line-2291"></span><span id="doCodeGen"><span class="annot"><span class="annottext">doCodeGen :: HscEnv
-&gt; Module
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [CgStgTopBinding]
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos)
</span><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier hs-var hs-var">doCodeGen</span></a></span></span><span> </span><span id="local-6989586621683157515"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157515"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157516"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157516"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621683157517"><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157517"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621683157518"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157518"><span class="hs-identifier hs-var">data_tycons</span></a></span></span><span>
</span><span id="line-2292"></span><span>              </span><span id="local-6989586621683157519"><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157519"><span class="hs-identifier hs-var">cost_centre_info</span></a></span></span><span> </span><span id="local-6989586621683157520"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157520"><span class="hs-identifier hs-var">stg_binds_w_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2293"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157521"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683157521"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157515"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2294"></span><span>        </span><span id="local-6989586621683157522"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683157522"><span class="hs-identifier hs-var hs-var hs-var">logger</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157515"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2295"></span><span>        </span><span id="local-6989586621683157523"><span class="annot"><span class="annottext">hooks :: Hooks
</span><a href="#local-6989586621683157523"><span class="hs-identifier hs-var hs-var hs-var">hooks</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span>  </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157515"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2296"></span><span>        </span><span id="local-6989586621683157524"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621683157524"><span class="hs-identifier hs-var hs-var hs-var">tmpfs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span>  </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157515"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2297"></span><span>        </span><span id="local-6989586621683157525"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621683157525"><span class="hs-identifier hs-var hs-var hs-var">platform</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157521"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2298"></span><span>        </span><span id="local-6989586621683157526"><span class="annot"><span class="annottext">stg_ppr_opts :: StgPprOpts
</span><a href="#local-6989586621683157526"><span class="hs-identifier hs-var hs-var hs-var">stg_ppr_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; StgPprOpts
</span><a href="GHC.Driver.Config.Stg.Ppr.html#initStgPprOpts"><span class="hs-identifier hs-var">initStgPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157521"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2299"></span><span>
</span><span id="line-2300"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157522"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_stg_final"><span class="hs-identifier hs-var">Opt_D_dump_stg_final</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Final STG:&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatSTG"><span class="hs-identifier hs-var">FormatSTG</span></a></span><span>
</span><span id="line-2301"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgPprOpts -&gt; [CgStgTopBinding] -&gt; SDoc
forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; [GenStgTopBinding pass] -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprGenStgTopBindings"><span class="hs-identifier hs-var">pprGenStgTopBindings</span></a></span><span> </span><span class="annot"><span class="annottext">StgPprOpts
</span><a href="#local-6989586621683157526"><span class="hs-identifier hs-var">stg_ppr_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157520"><span class="hs-identifier hs-var">stg_binds_w_fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2302"></span><span>
</span><span id="line-2303"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157527"><span class="annot"><span class="annottext">stg_to_cmm :: DynFlags
-&gt; Module
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [CgStgTopBinding]
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="#local-6989586621683157527"><span class="hs-identifier hs-var hs-var hs-var">stg_to_cmm</span></a></span></span><span> </span><span id="local-6989586621683157528"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157528"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683157529"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157529"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621683157530"><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157530"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621683157531"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157531"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621683157532"><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157532"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621683157533"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157533"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; Maybe
     (StgToCmmConfig
      -&gt; InfoTableProvMap
      -&gt; [TyCon]
      -&gt; ([CostCentre], [CostCentreStack])
      -&gt; [CgStgTopBinding]
      -&gt; CgStream CmmGroup ModuleLFInfos)
</span><a href="GHC.Driver.Hooks.html#stgToCmmHook"><span class="hs-identifier hs-var">stgToCmmHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621683157523"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2304"></span><span>          </span><span class="annot"><span class="annottext">Maybe
  (StgToCmmConfig
   -&gt; InfoTableProvMap
   -&gt; [TyCon]
   -&gt; ([CostCentre], [CostCentreStack])
   -&gt; [CgStgTopBinding]
   -&gt; CgStream CmmGroup ModuleLFInfos)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs
-&gt; StgToCmmConfig
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [CgStgTopBinding]
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier hs-var">StgToCmm.codeGen</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157522"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621683157524"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; StgToCmmConfig
</span><a href="GHC.Driver.Config.StgToCmm.html#initStgToCmmConfig"><span class="hs-identifier hs-var">initStgToCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157528"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157529"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157530"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157531"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157532"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157533"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2305"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157535"><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [CgStgTopBinding]
-&gt; CgStream CmmGroup ModuleLFInfos
</span><a href="#local-6989586621683157535"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">DetUniqFM
</span><a href="GHC.Cmm.UniqueRenamer.html#emptyDetUFM"><span class="hs-identifier hs-var">emptyDetUFM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleLFInfos -&gt; (ModuleLFInfos, DetUniqFM))
-&gt; CgStream CmmGroup ModuleLFInfos
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [CgStgTopBinding]
-&gt; CgStream CmmGroup ModuleLFInfos
</span><a href="#local-6989586621683157535"><span class="hs-identifier hs-var">h</span></a></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; StgToCmmConfig
</span><a href="GHC.Driver.Config.StgToCmm.html#initStgToCmmConfig"><span class="hs-identifier hs-var">initStgToCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157528"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157529"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157530"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157531"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157532"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157533"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2306"></span><span>
</span><span id="line-2307"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683157537"><span class="hs-identifier hs-type">cmm_stream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroup"><span class="hs-identifier hs-type">CmmGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier hs-type">ModuleLFInfos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.UniqueRenamer.html#DetUniqFM"><span class="hs-identifier hs-type">DetUniqFM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2308"></span><span>        </span><span class="hs-comment">-- See Note [Forcing of stg_binds]</span><span>
</span><span id="line-2309"></span><span>        </span><span id="local-6989586621683157537"><span class="annot"><span class="annottext">cmm_stream :: CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="#local-6989586621683157537"><span class="hs-identifier hs-var hs-var hs-var">cmm_stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157520"><span class="hs-identifier hs-var">stg_binds_w_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;StgToCmm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2310"></span><span>            </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; ([CostCentre], [CostCentreStack])
-&gt; [CgStgTopBinding]
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="#local-6989586621683157527"><span class="hs-identifier hs-var">stg_to_cmm</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157521"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157516"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157517"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157518"><span class="hs-identifier hs-var">data_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157519"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157520"><span class="hs-identifier hs-var">stg_binds_w_fvs</span></a></span><span>
</span><span id="line-2311"></span><span>
</span><span id="line-2312"></span><span>        </span><span class="hs-comment">-- codegen consumes a stream of CmmGroup, and produces a new</span><span>
</span><span id="line-2313"></span><span>        </span><span class="hs-comment">-- stream of CmmGroup (not necessarily synchronised: one</span><span>
</span><span id="line-2314"></span><span>        </span><span class="hs-comment">-- CmmGroup on input may produce many CmmGroups on output due</span><span>
</span><span id="line-2315"></span><span>        </span><span class="hs-comment">-- to proc-point splitting).</span><span>
</span><span id="line-2316"></span><span>
</span><span id="line-2317"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157538"><span class="annot"><span class="annottext">dump1 :: CmmGroup -&gt; IO CmmGroup
</span><a href="#local-6989586621683157538"><span class="hs-identifier hs-var hs-var">dump1</span></a></span></span><span> </span><span id="local-6989586621683157539"><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621683157539"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2318"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGroup -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621683157539"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2319"></span><span>            </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157522"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm_from_stg"><span class="hs-identifier hs-var">Opt_D_dump_cmm_from_stg</span></a></span><span>
</span><span id="line-2320"></span><span>              </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cmm produced by codegen&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmGroup -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683157525"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621683157539"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2321"></span><span>          </span><span class="annot"><span class="annottext">CmmGroup -&gt; IO CmmGroup
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621683157539"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2322"></span><span>
</span><span id="line-2323"></span><span>        </span><span id="local-6989586621683157541"><span class="annot"><span class="annottext">ppr_stream1 :: CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="#local-6989586621683157541"><span class="hs-identifier hs-var hs-var">ppr_stream1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmGroup -&gt; UniqDSMT IO CmmGroup)
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
forall (m :: * -&gt; *) a b x.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream m a x -&gt; Stream m b x
</span><a href="GHC.Data.Stream.html#mapM"><span class="hs-identifier hs-var">Stream.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO CmmGroup -&gt; UniqDSMT IO CmmGroup
forall a. IO a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO CmmGroup -&gt; UniqDSMT IO CmmGroup)
-&gt; (CmmGroup -&gt; IO CmmGroup) -&gt; CmmGroup -&gt; UniqDSMT IO CmmGroup
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CmmGroup -&gt; IO CmmGroup
</span><a href="#local-6989586621683157538"><span class="hs-identifier hs-var">dump1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="#local-6989586621683157537"><span class="hs-identifier hs-var">cmm_stream</span></a></span><span>
</span><span id="line-2324"></span><span>
</span><span id="line-2325"></span><span>        </span><span id="local-6989586621683157542"><span class="annot"><span class="annottext">cmm_config :: CmmConfig
</span><a href="#local-6989586621683157542"><span class="hs-identifier hs-var hs-var">cmm_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; CmmConfig
</span><a href="GHC.Driver.Config.Cmm.html#initCmmConfig"><span class="hs-identifier hs-var">initCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157521"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2326"></span><span>
</span><span id="line-2327"></span><span>        </span><span class="annot"><a href="#local-6989586621683157543"><span class="hs-identifier hs-type">pipeline_stream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span>
</span><span id="line-2328"></span><span>        </span><span id="local-6989586621683157543"><span class="annot"><span class="annottext">pipeline_stream :: CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
</span><a href="#local-6989586621683157543"><span class="hs-identifier hs-var hs-var">pipeline_stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2329"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683157544"><span class="annot"><a href="#local-6989586621683157544"><span class="hs-identifier hs-var">mod_srt_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157545"><span class="annot"><a href="#local-6989586621683157545"><span class="hs-identifier hs-var">ipes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157546"><span class="annot"><a href="#local-6989586621683157546"><span class="hs-identifier hs-var">ipe_stats</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157547"><span class="annot"><a href="#local-6989586621683157547"><span class="hs-identifier hs-var">lf_infos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157548"><span class="annot"><a href="#local-6989586621683157548"><span class="hs-identifier hs-var">detRnEnv</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2330"></span><span>            </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;cmmPipeline&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2331"></span><span>            </span><span class="annot"><span class="annottext">((ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
  IPEStats)
 -&gt; CmmGroup
 -&gt; UniqDSMT
      IO
      ((ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
        IPEStats),
       [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]))
-&gt; (ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
    IPEStats)
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
-&gt; Stream
     (UniqDSMT IO)
     [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
     ((ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
       IPEStats),
      (ModuleLFInfos, DetUniqFM))
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
(c -&gt; a -&gt; m (c, b)) -&gt; c -&gt; Stream m a r -&gt; Stream m b (c, r)
</span><a href="GHC.Data.Stream.html#mapAccumL_"><span class="hs-identifier hs-var">Stream.mapAccumL_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger
-&gt; CmmConfig
-&gt; (ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
    IPEStats)
-&gt; CmmGroup
-&gt; UniqDSMT
     IO
     ((ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
       IPEStats),
      [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph])
</span><a href="#local-6989586621683157550"><span class="hs-identifier hs-var">pipeline_action</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157522"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621683157542"><span class="hs-identifier hs-var">cmm_config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleSRTInfo
</span><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-var">emptySRT</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157516"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IPEStats
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="#local-6989586621683157541"><span class="hs-identifier hs-var">ppr_stream1</span></a></span><span>
</span><span id="line-2332"></span><span>
</span><span id="line-2333"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157552"><span class="annot"><a href="#local-6989586621683157552"><span class="hs-identifier hs-var hs-var">nonCaffySet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRTMap -&gt; NonCaffySet
</span><a href="GHC.Cmm.Info.Build.html#srtMapNonCAFs"><span class="hs-identifier hs-var">srtMapNonCAFs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; SRTMap
</span><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var">moduleSRTMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621683157544"><span class="hs-identifier hs-var">mod_srt_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2334"></span><span>
</span><span id="line-2335"></span><span>              </span><span class="hs-comment">-- denv::InfoTableProvMap refers to symbols that no longer exist</span><span>
</span><span id="line-2336"></span><span>              </span><span class="hs-comment">-- if -fobject-determinism is on, since it was created before the</span><span>
</span><span id="line-2337"></span><span>              </span><span class="hs-comment">-- Cmm was renamed. Update all the symbols by renaming them with</span><span>
</span><span id="line-2338"></span><span>              </span><span class="hs-comment">-- the renaming map in that case.</span><span>
</span><span id="line-2339"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621683157555"><span class="annot"><a href="#local-6989586621683157555"><span class="hs-identifier hs-var">_drn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157556"><span class="annot"><a href="#local-6989586621683157556"><span class="hs-identifier hs-var">rn_denv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2340"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-type">gopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_ObjectDeterminism"><span class="hs-identifier hs-type">Opt_ObjectDeterminism</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157521"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.UniqueRenamer.html#detRenameIPEMap"><span class="hs-identifier hs-type">detRenameIPEMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157548"><span class="hs-identifier hs-type">detRnEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157517"><span class="hs-identifier hs-type">denv</span></a></span><span>
</span><span id="line-2341"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157548"><span class="hs-identifier hs-type">detRnEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157517"><span class="hs-identifier hs-type">denv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2342"></span><span>
</span><span id="line-2343"></span><span>          </span><span id="local-6989586621683157559"><span class="annot"><a href="#local-6989586621683157559"><span class="hs-identifier hs-var">cmmCgInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier hs-type">generateCgIPEStub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157515"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157516"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157556"><span class="hs-identifier hs-type">rn_denv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157552"><span class="hs-identifier hs-type">nonCaffySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157547"><span class="hs-identifier hs-type">lf_infos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157545"><span class="hs-identifier hs-type">ipes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157546"><span class="hs-identifier hs-type">ipe_stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2344"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683157559"><span class="hs-identifier hs-type">cmmCgInfos</span></a></span><span>
</span><span id="line-2345"></span><span>
</span><span id="line-2346"></span><span>        </span><span class="annot"><a href="#local-6989586621683157550"><span class="hs-identifier hs-type">pipeline_action</span></a></span><span>
</span><span id="line-2347"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-2348"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Config.html#CmmConfig"><span class="hs-identifier hs-type">CmmConfig</span></a></span><span>
</span><span id="line-2349"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2350"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroup"><span class="hs-identifier hs-type">CmmGroup</span></a></span><span>
</span><span id="line-2351"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#ModuleSRTInfo"><span class="hs-identifier hs-type">ModuleSRTInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2352"></span><span>        </span><span id="local-6989586621683157550"><span class="annot"><span class="annottext">pipeline_action :: Logger
-&gt; CmmConfig
-&gt; (ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
    IPEStats)
-&gt; CmmGroup
-&gt; UniqDSMT
     IO
     ((ModuleSRTInfo, Map CmmInfoTable (Maybe IpeSourceLocation),
       IPEStats),
      [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph])
</span><a href="#local-6989586621683157550"><span class="hs-identifier hs-var hs-var">pipeline_action</span></a></span></span><span> </span><span id="local-6989586621683157560"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157560"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621683157561"><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621683157561"><span class="hs-identifier hs-var">cmm_config</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157562"><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621683157562"><span class="hs-identifier hs-var">mod_srt_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157563"><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621683157563"><span class="hs-identifier hs-var">ipes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157564"><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621683157564"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683157565"><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621683157565"><span class="hs-identifier hs-var">cmm_group</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2353"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683157566"><span class="annot"><a href="#local-6989586621683157566"><span class="hs-identifier hs-var">mod_srt_info'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157567"><span class="annot"><a href="#local-6989586621683157567"><span class="hs-identifier hs-var">cmm_srts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DUniqSupply
 -&gt; IO
      ((ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]),
       DUniqSupply))
-&gt; UniqDSMT
     IO (ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph])
forall a. (DUniqSupply -&gt; IO (a, DUniqSupply)) -&gt; UniqDSMT IO a
</span><a href="GHC.Types.Unique.DSM.html#withDUS"><span class="hs-identifier hs-var">withDUS</span></a></span><span> </span><span class="annot"><span class="annottext">((DUniqSupply
  -&gt; IO
       ((ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]),
        DUniqSupply))
 -&gt; UniqDSMT
      IO (ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]))
-&gt; (DUniqSupply
    -&gt; IO
         ((ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]),
          DUniqSupply))
-&gt; UniqDSMT
     IO (ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; CmmConfig
-&gt; ModuleSRTInfo
-&gt; CmmGroup
-&gt; DUniqSupply
-&gt; IO
     ((ModuleSRTInfo, [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]),
      DUniqSupply)
</span><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier hs-var">cmmPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157560"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621683157561"><span class="hs-identifier hs-var">cmm_config</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><a href="#local-6989586621683157562"><span class="hs-identifier hs-var">mod_srt_info</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621683157565"><span class="hs-identifier hs-var">cmm_group</span></a></span><span>
</span><span id="line-2354"></span><span>
</span><span id="line-2355"></span><span>          </span><span class="hs-comment">-- If -finfo-table-map is enabled, we precompute a map from info</span><span>
</span><span id="line-2356"></span><span>          </span><span class="hs-comment">-- tables to source locations. See Note [Mapping Info Tables to Source</span><span>
</span><span id="line-2357"></span><span>          </span><span class="hs-comment">-- Positions] in GHC.Stg.Debug.</span><span>
</span><span id="line-2358"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683157569"><span class="annot"><a href="#local-6989586621683157569"><span class="hs-identifier hs-var">ipes'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157570"><span class="annot"><a href="#local-6989586621683157570"><span class="hs-identifier hs-var">stats'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2359"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-type">gopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_InfoTableMap"><span class="hs-identifier hs-type">Opt_InfoTableMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157521"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2360"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#lookupEstimatedTicks"><span class="hs-identifier hs-type">lookupEstimatedTicks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157515"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157563"><span class="hs-identifier hs-type">ipes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157564"><span class="hs-identifier hs-type">stats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157567"><span class="hs-identifier hs-type">cmm_srts</span></a></span><span>
</span><span id="line-2361"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-2362"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157563"><span class="hs-identifier hs-type">ipes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157564"><span class="hs-identifier hs-type">stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2363"></span><span>
</span><span id="line-2364"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157566"><span class="hs-identifier hs-type">mod_srt_info'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157569"><span class="hs-identifier hs-type">ipes'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157570"><span class="hs-identifier hs-type">stats'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157567"><span class="hs-identifier hs-type">cmm_srts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2365"></span><span>
</span><span id="line-2366"></span><span>        </span><span id="local-6989586621683157571"><span class="annot"><span class="annottext">dump2 :: [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
-&gt; IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157571"><span class="hs-identifier hs-var hs-var">dump2</span></a></span></span><span> </span><span id="local-6989586621683157572"><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157572"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2367"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157572"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2368"></span><span>            </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157522"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm"><span class="hs-identifier hs-var">Opt_D_dump_cmm</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Output Cmm&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683157525"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157572"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2369"></span><span>          </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
-&gt; IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157572"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2370"></span><span>
</span><span id="line-2371"></span><span>    </span><span class="annot"><span class="annottext">CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
 -&gt; IO
      (CgStream
         [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos))
-&gt; CgStream
     [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
-&gt; IO
     (CgStream
        [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
 -&gt; UniqDSMT IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph])
-&gt; CgStream
     [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
-&gt; CgStream
     [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
forall (m :: * -&gt; *) a b x.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream m a x -&gt; Stream m b x
</span><a href="GHC.Data.Stream.html#mapM"><span class="hs-identifier hs-var">Stream.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
-&gt; UniqDSMT IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
forall a. IO a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
 -&gt; UniqDSMT IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph])
-&gt; ([GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
    -&gt; IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph])
-&gt; [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
-&gt; UniqDSMT IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
-&gt; IO [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph]
</span><a href="#local-6989586621683157571"><span class="hs-identifier hs-var">dump2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CgStream [GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph] CmmCgInfos
</span><a href="#local-6989586621683157543"><span class="hs-identifier hs-var">pipeline_stream</span></a></span><span>
</span><span id="line-2372"></span><span>
</span><span id="line-2373"></span><span class="annot"><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-type">myCoreToStg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2374"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2375"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-2376"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- output program and its dependencies</span><span>
</span><span id="line-2377"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span>
</span><span id="line-2378"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span> </span><span class="hs-comment">-- CAF cost centre info (declared and used)</span><span>
</span><span id="line-2379"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#StgCgInfos"><span class="hs-identifier hs-type">StgCgInfos</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2380"></span><span id="myCoreToStg"><span class="annot"><span class="annottext">myCoreToStg :: Logger
-&gt; DynFlags
-&gt; [Id]
-&gt; Bool
-&gt; Module
-&gt; ModLocation
-&gt; CoreProgram
-&gt; IO
     ([(CgStgTopBinding, IdSet)], InfoTableProvMap,
      ([CostCentre], [CostCentreStack]), StgCgInfos)
</span><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-var hs-var">myCoreToStg</span></a></span></span><span> </span><span id="local-6989586621683157574"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157574"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621683157575"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157575"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683157576"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683157576"><span class="hs-identifier hs-var">ic_inscope</span></a></span></span><span> </span><span id="local-6989586621683157577"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157577"><span class="hs-identifier hs-var">for_bytecode</span></a></span></span><span> </span><span id="local-6989586621683157578"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157578"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621683157579"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157579"><span class="hs-identifier hs-var">ml</span></a></span></span><span> </span><span id="local-6989586621683157580"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157580"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2381"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157581"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621683157581"><span class="hs-identifier hs-var hs-var">stg_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157582"><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621683157582"><span class="hs-identifier hs-var hs-var">denv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157583"><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
</span><a href="#local-6989586621683157583"><span class="hs-identifier hs-var hs-var">cost_centre_info</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2382"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Core2Stg&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2383"></span><span>           </span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; ModLocation
-&gt; CoreProgram
-&gt; ([StgTopBinding], InfoTableProvMap,
    ([CostCentre], [CostCentreStack]))
</span><a href="GHC.CoreToStg.html#coreToStg"><span class="hs-identifier hs-var">coreToStg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; CoreToStgOpts
</span><a href="GHC.Driver.Config.CoreToStg.html#initCoreToStgOpts"><span class="hs-identifier hs-var">initCoreToStgOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157575"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157578"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621683157579"><span class="hs-identifier hs-var">ml</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157580"><span class="hs-identifier hs-var">prepd_binds</span></a></span><span>
</span><span id="line-2384"></span><span>
</span><span id="line-2385"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157585"><span class="annot"><a href="#local-6989586621683157585"><span class="hs-identifier hs-var">stg_binds_with_fvs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157586"><span class="annot"><a href="#local-6989586621683157586"><span class="hs-identifier hs-var">stg_cg_info</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2386"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Stg2Stg&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2387"></span><span>           </span><span class="annot"><span class="annottext">Logger
-&gt; [Id]
-&gt; StgPipelineOpts
-&gt; Module
-&gt; [StgTopBinding]
-&gt; IO ([(CgStgTopBinding, IdSet)], StgCgInfos)
</span><a href="GHC.Stg.Pipeline.html#stg2stg"><span class="hs-identifier hs-var">stg2stg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157574"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683157576"><span class="hs-identifier hs-var">ic_inscope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; StgPipelineOpts
</span><a href="GHC.Driver.Config.Stg.Pipeline.html#initStgPipelineOpts"><span class="hs-identifier hs-var">initStgPipelineOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157575"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157577"><span class="hs-identifier hs-var">for_bytecode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2388"></span><span>                   </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157578"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621683157581"><span class="hs-identifier hs-var">stg_binds</span></a></span><span>
</span><span id="line-2389"></span><span>
</span><span id="line-2390"></span><span>    </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157574"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_stg_cg"><span class="hs-identifier hs-type">Opt_D_dump_stg_cg</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CodeGenInput STG:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatSTG"><span class="hs-identifier hs-type">FormatSTG</span></a></span><span>
</span><span id="line-2391"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#pprGenStgTopBindings"><span class="hs-identifier hs-type">pprGenStgTopBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Stg.Ppr.html#initStgPprOpts"><span class="hs-identifier hs-type">initStgPprOpts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157575"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621683157585"><span class="hs-identifier hs-type">stg_binds_with_fvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2392"></span><span>
</span><span id="line-2393"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157585"><span class="hs-identifier hs-type">stg_binds_with_fvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157582"><span class="hs-identifier hs-type">denv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157583"><span class="hs-identifier hs-type">cost_centre_info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157586"><span class="hs-identifier hs-type">stg_cg_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2394"></span><span>
</span><span id="line-2395"></span><span class="annot"><span class="hs-comment">{- **********************************************************************
%*                                                                      *
\subsection{Compiling a do-statement}
%*                                                                      *
%********************************************************************* -}</span></span><span>
</span><span id="line-2400"></span><span>
</span><span id="line-2401"></span><span class="hs-comment">{-
When the UnlinkedBCOExpr is linked you get an HValue of type *IO [HValue]* When
you run it you get a list of HValues that should be the same length as the list
of names; add them to the ClosureEnv.

A naked expression returns a singleton Name [it]. The stmt is lifted into the
IO monad as explained in Note [Interactively-bound Ids in GHCi] in GHC.Runtime.Context
-}</span><span>
</span><span id="line-2409"></span><span>
</span><span id="line-2410"></span><span class="hs-comment">-- | Compile a stmt all the way to an HValue, but don't run it</span><span>
</span><span id="line-2411"></span><span class="hs-comment">--</span><span>
</span><span id="line-2412"></span><span class="hs-comment">-- We return Nothing to indicate an empty statement (or comment only), not a</span><span>
</span><span id="line-2413"></span><span class="hs-comment">-- parse error.</span><span>
</span><span id="line-2414"></span><span class="annot"><a href="GHC.Driver.Main.html#hscStmt"><span class="hs-identifier hs-type">hscStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2415"></span><span id="hscStmt"><span class="annot"><span class="annottext">hscStmt :: HscEnv -&gt; [Char] -&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscStmt"><span class="hs-identifier hs-var hs-var">hscStmt</span></a></span></span><span> </span><span id="local-6989586621683157588"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157588"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157589"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157589"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [Char]
-&gt; [Char]
-&gt; Int
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier hs-var">hscStmtWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157588"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157589"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2416"></span><span>
</span><span id="line-2417"></span><span class="hs-comment">-- | Compile a stmt all the way to an HValue, but don't run it</span><span>
</span><span id="line-2418"></span><span class="hs-comment">--</span><span>
</span><span id="line-2419"></span><span class="hs-comment">-- We return Nothing to indicate an empty statement (or comment only), not a</span><span>
</span><span id="line-2420"></span><span class="hs-comment">-- parse error.</span><span>
</span><span id="line-2421"></span><span class="annot"><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier hs-type">hscStmtWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2422"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The statement</span></span><span>
</span><span id="line-2423"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The source</span></span><span>
</span><span id="line-2424"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Starting line</span></span><span>
</span><span id="line-2425"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2426"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-comment">{- IO [HValue] -}</span><span>
</span><span id="line-2427"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2428"></span><span id="hscStmtWithLocation"><span class="annot"><span class="annottext">hscStmtWithLocation :: HscEnv
-&gt; [Char]
-&gt; [Char]
-&gt; Int
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier hs-var hs-var">hscStmtWithLocation</span></a></span></span><span> </span><span id="local-6989586621683157590"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157590"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683157591"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157591"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span id="local-6989586621683157592"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157592"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621683157593"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157593"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2429"></span><span>  </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157590"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
 -&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv)))
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2430"></span><span>    </span><span id="local-6989586621683157594"><span class="annot"><a href="#local-6989586621683157594"><span class="hs-identifier hs-var">maybe_stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; Hsc (Maybe (GhciLStmt GhcPs))
</span><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier hs-var">hscParseStmtWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157592"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157593"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157591"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2431"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683157594"><span class="hs-identifier hs-type">maybe_stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2432"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ([Id], ForeignHValue, FixityEnv)
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ([Id], ForeignHValue, FixityEnv)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2433"></span><span>
</span><span id="line-2434"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157595"><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
</span><a href="#local-6989586621683157595"><span class="hs-identifier hs-var">parsed_stmt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2435"></span><span>        </span><span id="local-6989586621683157596"><span class="annot"><a href="#local-6989586621683157596"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-2436"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier hs-type">hscParsedStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157596"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157595"><span class="hs-identifier hs-type">parsed_stmt</span></a></span><span>
</span><span id="line-2437"></span><span>
</span><span id="line-2438"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier hs-type">hscParsedStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2439"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The parsed statement</span></span><span>
</span><span id="line-2440"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2441"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-comment">{- IO [HValue] -}</span><span>
</span><span id="line-2442"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2443"></span><span id="hscParsedStmt"><span class="annot"><span class="annottext">hscParsedStmt :: HscEnv
-&gt; GhciLStmt GhcPs -&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier hs-var hs-var">hscParsedStmt</span></a></span></span><span> </span><span id="local-6989586621683157597"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157597"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157598"><span class="annot"><span class="annottext">GhciLStmt GhcPs
</span><a href="#local-6989586621683157598"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157597"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
 -&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv)))
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2444"></span><span>  </span><span class="hs-comment">-- Rename and typecheck it</span><span>
</span><span id="line-2445"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683157599"><span class="annot"><a href="#local-6989586621683157599"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157600"><span class="annot"><a href="#local-6989586621683157600"><span class="hs-identifier hs-var">tc_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157601"><span class="annot"><a href="#local-6989586621683157601"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; Hsc ([Id], LHsExpr GhcTc, FixityEnv)
forall a. IO (Messages GhcMessage, Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages GhcMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
 -&gt; Hsc ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; IO (Messages GhcMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; Hsc ([Id], LHsExpr GhcTc, FixityEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; IO (Messages GhcMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Messages TcRnMessage, a) -&gt; m (Messages GhcMessage, a)
</span><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-var">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
 -&gt; IO
      (Messages GhcMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv)))
-&gt; IO
     (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; IO (Messages GhcMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; GhciLStmt GhcPs
-&gt; IO
     (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
</span><a href="GHC.Tc.Module.html#tcRnStmt"><span class="hs-identifier hs-var">tcRnStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157597"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">GhciLStmt GhcPs
</span><a href="#local-6989586621683157598"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2446"></span><span>
</span><span id="line-2447"></span><span>  </span><span class="hs-comment">-- Desugar it</span><span>
</span><span id="line-2448"></span><span>  </span><span id="local-6989586621683157603"><span class="annot"><a href="#local-6989586621683157603"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistDsMessage"><span class="hs-identifier hs-type">hoistDsMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.html#deSugarExpr"><span class="hs-identifier hs-type">deSugarExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157597"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157600"><span class="hs-identifier hs-type">tc_expr</span></a></span><span>
</span><span id="line-2449"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.Interactive.html#lintInteractiveExpr"><span class="hs-identifier hs-type">lintInteractiveExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;desugar expression&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157597"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157603"><span class="hs-identifier hs-type">ds_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2450"></span><span>  </span><span class="annot"><a href="GHC.Driver.Main.html#handleWarnings"><span class="hs-identifier hs-type">handleWarnings</span></a></span><span>
</span><span id="line-2451"></span><span>
</span><span id="line-2452"></span><span>  </span><span class="hs-comment">-- Then code-gen, and link it</span><span>
</span><span id="line-2453"></span><span>  </span><span class="hs-comment">-- It's important NOT to have package 'interactive' as thisUnitId</span><span>
</span><span id="line-2454"></span><span>  </span><span class="hs-comment">-- for linking, else we try to link 'main' and can't find it.</span><span>
</span><span id="line-2455"></span><span>  </span><span class="hs-comment">-- Whereas the linker already knows to ignore 'interactive'</span><span>
</span><span id="line-2456"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157605"><span class="annot"><a href="#local-6989586621683157605"><span class="hs-identifier hs-var hs-var">src_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="GHC.Types.SrcLoc.html#interactiveSrcLoc"><span class="hs-identifier hs-var">interactiveSrcLoc</span></a></span><span>
</span><span id="line-2457"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683157608"><span class="annot"><a href="#local-6989586621683157608"><span class="hs-identifier hs-var">hval</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-type">hscCompileCoreExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157597"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157605"><span class="hs-identifier hs-type">src_span</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157603"><span class="hs-identifier hs-type">ds_expr</span></a></span><span>
</span><span id="line-2458"></span><span>
</span><span id="line-2459"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157599"><span class="hs-identifier hs-type">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157608"><span class="hs-identifier hs-type">hval</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157601"><span class="hs-identifier hs-type">fix_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2460"></span><span>
</span><span id="line-2461"></span><span class="annot"><span class="hs-comment">-- | Compile a decls</span></span><span>
</span><span id="line-2462"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDecls"><span class="hs-identifier hs-type">hscDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2463"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The statement</span></span><span>
</span><span id="line-2464"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2465"></span><span id="hscDecls"><span class="annot"><span class="annottext">hscDecls :: HscEnv -&gt; [Char] -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscDecls"><span class="hs-identifier hs-var hs-var">hscDecls</span></a></span></span><span> </span><span id="local-6989586621683157609"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157609"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157610"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157610"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [Char] -&gt; [Char] -&gt; Int -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier hs-var">hscDeclsWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157609"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157610"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2466"></span><span>
</span><span id="line-2467"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseModuleWithLocation"><span class="hs-identifier hs-type">hscParseModuleWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2468"></span><span id="hscParseModuleWithLocation"><span class="annot"><span class="annottext">hscParseModuleWithLocation :: HscEnv -&gt; [Char] -&gt; Int -&gt; [Char] -&gt; IO (HsModule GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseModuleWithLocation"><span class="hs-identifier hs-var hs-var">hscParseModuleWithLocation</span></a></span></span><span> </span><span id="local-6989586621683157611"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157611"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157612"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157612"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621683157613"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157613"><span class="hs-identifier hs-var">line_num</span></a></span></span><span> </span><span id="local-6989586621683157614"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157614"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2469"></span><span>    </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683157615"><span class="annot"><a href="#local-6989586621683157615"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2470"></span><span>      </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Located (HsModule GhcPs)) -&gt; IO (Located (HsModule GhcPs))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157611"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Located (HsModule GhcPs)) -&gt; IO (Located (HsModule GhcPs)))
-&gt; Hsc (Located (HsModule GhcPs)) -&gt; IO (Located (HsModule GhcPs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2471"></span><span>        </span><span class="annot"><span class="annottext">[Char]
-&gt; Int
-&gt; P (Located (HsModule GhcPs))
-&gt; [Char]
-&gt; Hsc (Located (HsModule GhcPs))
forall thing.
(Outputable thing, Data thing) =&gt;
[Char] -&gt; Int -&gt; P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157612"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157613"><span class="hs-identifier hs-var">line_num</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located (HsModule GhcPs))
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157614"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2472"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683157615"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-2473"></span><span>
</span><span id="line-2474"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseDeclsWithLocation"><span class="hs-identifier hs-type">hscParseDeclsWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2475"></span><span id="hscParseDeclsWithLocation"><span class="annot"><span class="annottext">hscParseDeclsWithLocation :: HscEnv -&gt; [Char] -&gt; Int -&gt; [Char] -&gt; IO [LHsDecl GhcPs]
</span><a href="GHC.Driver.Main.html#hscParseDeclsWithLocation"><span class="hs-identifier hs-var hs-var">hscParseDeclsWithLocation</span></a></span></span><span> </span><span id="local-6989586621683157617"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157617"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157618"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157618"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621683157619"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157619"><span class="hs-identifier hs-var">line_num</span></a></span></span><span> </span><span id="local-6989586621683157620"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157620"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2476"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.html#hsmodDecls"><span class="hs-identifier hs-var">hsmodDecls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157623"><span class="annot"><a href="#local-6989586621683157623"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Char] -&gt; Int -&gt; [Char] -&gt; IO (HsModule GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseModuleWithLocation"><span class="hs-identifier hs-var">hscParseModuleWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157617"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157618"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157619"><span class="hs-identifier hs-var">line_num</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157620"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2477"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683157623"><span class="hs-identifier hs-type">decls</span></a></span><span>
</span><span id="line-2478"></span><span>
</span><span id="line-2479"></span><span class="annot"><span class="hs-comment">-- | Compile a decls</span></span><span>
</span><span id="line-2480"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier hs-type">hscDeclsWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2481"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The statement</span></span><span>
</span><span id="line-2482"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The source</span></span><span>
</span><span id="line-2483"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Starting line</span></span><span>
</span><span id="line-2484"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2485"></span><span id="hscDeclsWithLocation"><span class="annot"><span class="annottext">hscDeclsWithLocation :: HscEnv
-&gt; [Char] -&gt; [Char] -&gt; Int -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier hs-var hs-var">hscDeclsWithLocation</span></a></span></span><span> </span><span id="local-6989586621683157624"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157624"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157625"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157625"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621683157626"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157626"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621683157627"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157627"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2486"></span><span>    </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.html#hsmodDecls"><span class="hs-identifier hs-var">hsmodDecls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157628"><span class="annot"><a href="#local-6989586621683157628"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2487"></span><span>      </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Located (HsModule GhcPs)) -&gt; IO (Located (HsModule GhcPs))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157624"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Located (HsModule GhcPs)) -&gt; IO (Located (HsModule GhcPs)))
-&gt; Hsc (Located (HsModule GhcPs)) -&gt; IO (Located (HsModule GhcPs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2488"></span><span>        </span><span class="annot"><span class="annottext">[Char]
-&gt; Int
-&gt; P (Located (HsModule GhcPs))
-&gt; [Char]
-&gt; Hsc (Located (HsModule GhcPs))
forall thing.
(Outputable thing, Data thing) =&gt;
[Char] -&gt; Int -&gt; P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157626"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157627"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located (HsModule GhcPs))
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157625"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2489"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier hs-type">hscParsedDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157624"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157628"><span class="hs-identifier hs-type">decls</span></a></span><span>
</span><span id="line-2490"></span><span>
</span><span id="line-2491"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier hs-type">hscParsedDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2492"></span><span id="hscParsedDecls"><span class="annot"><span class="annottext">hscParsedDecls :: HscEnv -&gt; [LHsDecl GhcPs] -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier hs-var hs-var">hscParsedDecls</span></a></span></span><span> </span><span id="local-6989586621683157629"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157629"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157630"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683157630"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc ([TyThing], InteractiveContext)
-&gt; IO ([TyThing], InteractiveContext)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157629"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ([TyThing], InteractiveContext)
 -&gt; IO ([TyThing], InteractiveContext))
-&gt; Hsc ([TyThing], InteractiveContext)
-&gt; IO ([TyThing], InteractiveContext)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2493"></span><span>    </span><span id="local-6989586621683157631"><span class="annot"><a href="#local-6989586621683157631"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-2494"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157632"><span class="annot"><a href="#local-6989586621683157632"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157631"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2495"></span><span>
</span><span id="line-2496"></span><span>    </span><span class="hs-comment">{- Rename and typecheck it -}</span><span>
</span><span id="line-2497"></span><span>    </span><span id="local-6989586621683157633"><span class="annot"><a href="#local-6989586621683157633"><span class="hs-identifier hs-var">tc_gblenv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnDeclsi"><span class="hs-identifier hs-type">tcRnDeclsi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157631"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157630"><span class="hs-identifier hs-type">decls</span></a></span><span>
</span><span id="line-2498"></span><span>
</span><span id="line-2499"></span><span>    </span><span class="hs-comment">{- Grab the new instances -}</span><span>
</span><span id="line-2500"></span><span>    </span><span class="hs-comment">-- We grab the whole environment because of the overlapping that may have</span><span>
</span><span id="line-2501"></span><span>    </span><span class="hs-comment">-- been done. See the notes at the definition of InteractiveContext</span><span>
</span><span id="line-2502"></span><span>    </span><span class="hs-comment">-- (ic_instances) for more details.</span><span>
</span><span id="line-2503"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157635"><span class="annot"><a href="#local-6989586621683157635"><span class="hs-identifier hs-var hs-var">defaults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; DefaultEnv
</span><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157633"><span class="hs-identifier hs-var">tc_gblenv</span></a></span><span>
</span><span id="line-2504"></span><span>
</span><span id="line-2505"></span><span>    </span><span class="hs-comment">{- Desugar it -}</span><span>
</span><span id="line-2506"></span><span>    </span><span class="hs-comment">-- We use a basically null location for iNTERACTIVE</span><span>
</span><span id="line-2507"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157647"><span class="annot"><a href="#local-6989586621683157647"><span class="hs-identifier hs-var hs-var">iNTERACTIVELoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#OsPathModLocation"><span class="hs-identifier hs-type">OsPathModLocation</span></a></span><span>
</span><span id="line-2508"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_hs_file_ospath :: Maybe OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file_ospath"><span class="hs-identifier hs-var">ml_hs_file_ospath</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OsPath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-2509"></span><span>              </span><span class="annot"><span class="annottext">ml_hi_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file_ospath"><span class="hs-identifier hs-var">ml_hi_file_ospath</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_hi_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2510"></span><span>              </span><span class="annot"><span class="annottext">ml_obj_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file_ospath"><span class="hs-identifier hs-var">ml_obj_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_obj_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2511"></span><span>              </span><span class="annot"><span class="annottext">ml_dyn_obj_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file_ospath"><span class="hs-identifier hs-var">ml_dyn_obj_file_ospath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_dyn_obj_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2512"></span><span>              </span><span class="annot"><span class="annottext">ml_dyn_hi_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_hi_file_ospath"><span class="hs-identifier hs-var">ml_dyn_hi_file_ospath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_dyn_hi_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2513"></span><span>              </span><span class="annot"><span class="annottext">ml_hie_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file_ospath"><span class="hs-identifier hs-var">ml_hie_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_hie_file_ospath&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2514"></span><span>    </span><span id="local-6989586621683157648"><span class="annot"><a href="#local-6989586621683157648"><span class="hs-identifier hs-var">ds_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-type">hscDesugar'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157647"><span class="hs-identifier hs-type">iNTERACTIVELoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157633"><span class="hs-identifier hs-type">tc_gblenv</span></a></span><span>
</span><span id="line-2515"></span><span>
</span><span id="line-2516"></span><span>    </span><span class="hs-comment">{- Simplify -}</span><span>
</span><span id="line-2517"></span><span>    </span><span id="local-6989586621683157649"><span class="annot"><a href="#local-6989586621683157649"><span class="hs-identifier hs-var">simpl_mg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2518"></span><span>      </span><span id="local-6989586621683157650"><span class="annot"><a href="#local-6989586621683157650"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157633"><span class="hs-identifier hs-type">tc_gblenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2519"></span><span>      </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier hs-type">hscSimplify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157631"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157650"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157648"><span class="hs-identifier hs-type">ds_result</span></a></span><span>
</span><span id="line-2520"></span><span>
</span><span id="line-2521"></span><span>    </span><span class="hs-comment">{- Tidy -}</span><span>
</span><span id="line-2522"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157651"><span class="annot"><a href="#local-6989586621683157651"><span class="hs-identifier hs-var">tidy_cg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157652"><span class="annot"><a href="#local-6989586621683157652"><span class="hs-identifier hs-var">mod_details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTidy"><span class="hs-identifier hs-type">hscTidy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157631"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157649"><span class="hs-identifier hs-type">simpl_mg</span></a></span><span>
</span><span id="line-2523"></span><span>
</span><span id="line-2524"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_module"><span class="hs-identifier hs-var">cg_module</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157653"><span class="annot"><a href="#local-6989586621683157653"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2525"></span><span>                 </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157654"><span class="annot"><a href="#local-6989586621683157654"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span>
</span><span id="line-2526"></span><span>                 </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157651"><span class="hs-identifier hs-type">tidy_cg</span></a></span><span>
</span><span id="line-2527"></span><span>
</span><span id="line-2528"></span><span>        </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#md_insts"><span class="hs-identifier hs-var">md_insts</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157656"><span class="annot"><a href="#local-6989586621683157656"><span class="hs-identifier hs-var">cls_insts</span></a></span></span><span>
</span><span id="line-2529"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#md_fam_insts"><span class="hs-identifier hs-var">md_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683157658"><span class="annot"><a href="#local-6989586621683157658"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157652"><span class="hs-identifier hs-type">mod_details</span></a></span><span>
</span><span id="line-2530"></span><span>            </span><span class="hs-comment">-- Get the *tidied* cls_insts and fam_insts</span><span>
</span><span id="line-2531"></span><span>
</span><span id="line-2532"></span><span>    </span><span class="hs-comment">{- Generate byte code &amp; foreign stubs -}</span><span>
</span><span id="line-2533"></span><span>    </span><span id="local-6989586621683157659"><span class="annot"><a href="#local-6989586621683157659"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#generateFreshByteCode"><span class="hs-identifier hs-type">generateFreshByteCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157631"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-2534"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157653"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2535"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Main.html#mkCgInteractiveGuts"><span class="hs-identifier hs-type">mkCgInteractiveGuts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157651"><span class="hs-identifier hs-type">tidy_cg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2536"></span><span>      </span><span class="annot"><a href="#local-6989586621683157647"><span class="hs-identifier hs-type">iNTERACTIVELoc</span></a></span><span>
</span><span id="line-2537"></span><span>
</span><span id="line-2538"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157660"><span class="annot"><a href="#local-6989586621683157660"><span class="hs-identifier hs-var hs-var">src_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="GHC.Types.SrcLoc.html#interactiveSrcLoc"><span class="hs-identifier hs-var">interactiveSrcLoc</span></a></span><span>
</span><span id="line-2539"></span><span>    </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html#loadDecls"><span class="hs-identifier hs-type">loadDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157632"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157631"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157660"><span class="hs-identifier hs-type">src_span</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157659"><span class="hs-identifier hs-type">linkable</span></a></span><span>
</span><span id="line-2540"></span><span>
</span><span id="line-2541"></span><span>    </span><span class="hs-comment">{- Load static pointer table entries -}</span><span>
</span><span id="line-2542"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-type">hscAddSptEntries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157631"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#cg_spt_entries"><span class="hs-identifier hs-var">cg_spt_entries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157651"><span class="hs-identifier hs-type">tidy_cg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2543"></span><span>
</span><span id="line-2544"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157662"><span class="annot"><a href="#local-6989586621683157662"><span class="hs-identifier hs-var hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Bool) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isImplicitTyCon"><span class="hs-identifier hs-var">isImplicitTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; [TyCon]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_tcs"><span class="hs-identifier hs-var">mg_tcs</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157649"><span class="hs-identifier hs-var">simpl_mg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2545"></span><span>        </span><span id="local-6989586621683157666"><span class="annot"><a href="#local-6989586621683157666"><span class="hs-identifier hs-var hs-var">patsyns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; [PatSyn]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_patsyns"><span class="hs-identifier hs-var">mg_patsyns</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157649"><span class="hs-identifier hs-var">simpl_mg</span></a></span><span>
</span><span id="line-2546"></span><span>
</span><span id="line-2547"></span><span>        </span><span id="local-6989586621683157668"><span class="annot"><a href="#local-6989586621683157668"><span class="hs-identifier hs-var hs-var">ext_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157669"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683157669"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157669"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; [Id]
forall b. [Bind b] -&gt; [b]
</span><a href="GHC.Core.html#bindersOfBinds"><span class="hs-identifier hs-var">bindersOfBinds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157654"><span class="hs-identifier hs-var">core_binds</span></a></span><span>
</span><span id="line-2548"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157669"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2549"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDFunId"><span class="hs-identifier hs-var">isDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157669"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isImplicitId"><span class="hs-identifier hs-var">isImplicitId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157669"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2550"></span><span>            </span><span class="hs-comment">-- We only need to keep around the external bindings</span><span>
</span><span id="line-2551"></span><span>            </span><span class="hs-comment">-- (as decided by GHC.Iface.Tidy), since those are the only ones</span><span>
</span><span id="line-2552"></span><span>            </span><span class="hs-comment">-- that might later be looked up by name.  But we can exclude</span><span>
</span><span id="line-2553"></span><span>            </span><span class="hs-comment">--    - DFunIds, which are in 'cls_insts' (see Note [ic_tythings] in GHC.Runtime.Context</span><span>
</span><span id="line-2554"></span><span>            </span><span class="hs-comment">--    - Implicit Ids, which are implicit in tcs</span><span>
</span><span id="line-2555"></span><span>            </span><span class="hs-comment">-- c.f. GHC.Tc.Module.runTcInteractive, which reconstructs the TypeEnv</span><span>
</span><span id="line-2556"></span><span>
</span><span id="line-2557"></span><span>        </span><span id="local-6989586621683157674"><span class="annot"><a href="#local-6989586621683157674"><span class="hs-identifier hs-var hs-var">new_tythings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; TyThing) -&gt; [Id] -&gt; [TyThing]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-var">AnId</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683157668"><span class="hs-identifier hs-var">ext_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing] -&gt; [TyThing] -&gt; [TyThing]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; TyThing) -&gt; [TyCon] -&gt; [TyThing]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683157662"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing] -&gt; [TyThing] -&gt; [TyThing]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(PatSyn -&gt; TyThing) -&gt; [PatSyn] -&gt; [TyThing]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a></span><span> </span><span class="annot"><span class="annottext">(ConLike -&gt; TyThing) -&gt; (PatSyn -&gt; ConLike) -&gt; PatSyn -&gt; TyThing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatSyn]
</span><a href="#local-6989586621683157666"><span class="hs-identifier hs-var">patsyns</span></a></span><span>
</span><span id="line-2558"></span><span>        </span><span id="local-6989586621683157679"><span class="annot"><a href="#local-6989586621683157679"><span class="hs-identifier hs-var hs-var">ictxt</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157631"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2559"></span><span>        </span><span class="hs-comment">-- See Note [Fixity declarations in GHCi]</span><span>
</span><span id="line-2560"></span><span>        </span><span id="local-6989586621683157680"><span class="annot"><a href="#local-6989586621683157680"><span class="hs-identifier hs-var hs-var">fix_env</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683157633"><span class="hs-identifier hs-var">tc_gblenv</span></a></span><span>
</span><span id="line-2561"></span><span>        </span><span id="local-6989586621683157682"><span class="annot"><a href="#local-6989586621683157682"><span class="hs-identifier hs-var hs-var">new_ictxt</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
-&gt; [TyThing]
-&gt; InstEnv
-&gt; [FamInst]
-&gt; DefaultEnv
-&gt; FixityEnv
-&gt; InteractiveContext
</span><a href="GHC.Runtime.Context.html#extendInteractiveContext"><span class="hs-identifier hs-var">extendInteractiveContext</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683157679"><span class="hs-identifier hs-var">ictxt</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621683157674"><span class="hs-identifier hs-var">new_tythings</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683157656"><span class="hs-identifier hs-var">cls_insts</span></a></span><span>
</span><span id="line-2562"></span><span>                                                </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683157658"><span class="hs-identifier hs-var">fam_insts</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultEnv
</span><a href="#local-6989586621683157635"><span class="hs-identifier hs-var">defaults</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683157680"><span class="hs-identifier hs-var">fix_env</span></a></span><span>
</span><span id="line-2563"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157674"><span class="hs-identifier hs-type">new_tythings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157682"><span class="hs-identifier hs-type">new_ictxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2564"></span><span>
</span><span id="line-2565"></span><span class="hs-comment">-- | Load the given static-pointer table entries into the interpreter.</span><span>
</span><span id="line-2566"></span><span class="hs-comment">-- See Note [Grand plan for static forms] in &quot;GHC.Iface.Tidy.StaticPtrTable&quot;.</span><span>
</span><span id="line-2567"></span><span class="annot"><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-type">hscAddSptEntries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2568"></span><span id="hscAddSptEntries"><span class="annot"><span class="annottext">hscAddSptEntries :: HscEnv -&gt; [SptEntry] -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-var hs-var">hscAddSptEntries</span></a></span></span><span> </span><span id="local-6989586621683157684"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157684"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157685"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621683157685"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2569"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157686"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621683157686"><span class="hs-identifier hs-var hs-var hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157684"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2570"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683157687"><span class="hs-identifier hs-type">add_spt_entry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2571"></span><span>        </span><span id="local-6989586621683157687"><span class="annot"><span class="annottext">add_spt_entry :: SptEntry -&gt; IO ()
</span><a href="#local-6989586621683157687"><span class="hs-identifier hs-var hs-var">add_spt_entry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span> </span><span id="local-6989586621683157689"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157689"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621683157690"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621683157690"><span class="hs-identifier hs-var">fpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2572"></span><span>            </span><span class="hs-comment">-- These are only names from the current module</span><span>
</span><span id="line-2573"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621683157691"><span class="annot"><a href="#local-6989586621683157691"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; HscEnv -&gt; Name -&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Linker.Loader.html#loadName"><span class="hs-identifier hs-var">loadName</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683157686"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157684"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157689"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2574"></span><span>            </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#addSptEntry"><span class="hs-identifier hs-type">addSptEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157686"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157690"><span class="hs-identifier hs-type">fpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157691"><span class="hs-identifier hs-type">val</span></a></span><span>
</span><span id="line-2575"></span><span>    </span><span class="annot"><span class="annottext">(SptEntry -&gt; IO ()) -&gt; [SptEntry] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">SptEntry -&gt; IO ()
</span><a href="#local-6989586621683157687"><span class="hs-identifier hs-var">add_spt_entry</span></a></span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621683157685"><span class="hs-identifier hs-var">entries</span></a></span><span>
</span><span id="line-2576"></span><span>
</span><span id="line-2577"></span><span class="hs-comment">{-
  Note [Fixity declarations in GHCi]
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  To support fixity declarations on types defined within GHCi (as requested
  in #10018) we record the fixity environment in InteractiveContext.
  When we want to evaluate something GHC.Tc.Module.runTcInteractive pulls out this
  fixity environment and uses it to initialize the global typechecker environment.
  After the typechecker has finished its business, an updated fixity environment
  (reflecting whatever fixity declarations were present in the statements we
  passed it) will be returned from hscParsedStmt. This is passed to
  updateFixityEnv, which will stuff it back into InteractiveContext, to be
  used in evaluating the next statement.

-}</span><span>
</span><span id="line-2591"></span><span>
</span><span id="line-2592"></span><span class="annot"><a href="GHC.Driver.Main.html#hscImport"><span class="hs-identifier hs-type">hscImport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2593"></span><span id="hscImport"><span class="annot"><span class="annottext">hscImport :: HscEnv -&gt; [Char] -&gt; IO (ImportDecl GhcPs)
</span><a href="GHC.Driver.Main.html#hscImport"><span class="hs-identifier hs-var hs-var">hscImport</span></a></span></span><span> </span><span id="local-6989586621683157694"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157694"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157695"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157695"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (ImportDecl GhcPs) -&gt; IO (ImportDecl GhcPs)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157694"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (ImportDecl GhcPs) -&gt; IO (ImportDecl GhcPs))
-&gt; Hsc (ImportDecl GhcPs) -&gt; IO (ImportDecl GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2594"></span><span>    </span><span class="hs-comment">-- Use &gt;&gt;= \case instead of MonadFail desugaring to take into</span><span>
</span><span id="line-2595"></span><span>    </span><span class="hs-comment">-- consideration `instance XXModule p = DataConCantHappen`.</span><span>
</span><span id="line-2596"></span><span>    </span><span class="hs-comment">-- Tracked in #15681</span><span>
</span><span id="line-2597"></span><span>    </span><span class="annot"><span class="annottext">P (Located (HsModule GhcPs))
-&gt; [Char] -&gt; Hsc (Located (HsModule GhcPs))
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located (HsModule GhcPs))
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157695"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">Hsc (Located (HsModule GhcPs))
-&gt; (Located (HsModule GhcPs) -&gt; Hsc (ImportDecl GhcPs))
-&gt; Hsc (ImportDecl GhcPs)
forall a b. Hsc a -&gt; (a -&gt; Hsc b) -&gt; Hsc b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2598"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsmodImports :: forall p. HsModule p -&gt; [LImportDecl p]
</span><a href="Language.Haskell.Syntax.html#hsmodImports"><span class="hs-identifier hs-var">hsmodImports</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683157698"><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621683157698"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2599"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621683157698"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2600"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683157699"><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683157699"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; Hsc (ImportDecl GhcPs)
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683157699"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2601"></span><span>            </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (ImportDecl GhcPs) -&gt; Hsc (ImportDecl GhcPs)
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (ImportDecl GhcPs) -&gt; Hsc (ImportDecl GhcPs))
-&gt; IO (ImportDecl GhcPs) -&gt; Hsc (ImportDecl GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; IO (ImportDecl GhcPs)
forall (io :: * -&gt; *) a.
MonadIO io =&gt;
MsgEnvelope GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; IO (ImportDecl GhcPs))
-&gt; MsgEnvelope GhcMessage -&gt; IO (ImportDecl GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2602"></span><span>                     </span><span class="annot"><span class="annottext">SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2603"></span><span>                     </span><span class="annot"><span class="annottext">PsWarning -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-var">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(PsWarning -&gt; GhcMessage) -&gt; PsWarning -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnknownDiagnostic (DiagnosticOpts PsWarning) -&gt; PsWarning
</span><a href="GHC.Parser.Errors.Types.html#PsUnknownMessage"><span class="hs-identifier hs-var">PsUnknownMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(UnknownDiagnostic (DiagnosticOpts PsWarning) -&gt; PsWarning)
-&gt; UnknownDiagnostic (DiagnosticOpts PsWarning) -&gt; PsWarning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2604"></span><span>                     </span><span class="annot"><span class="annottext">DiagnosticMessage -&gt; UnknownDiagnostic (DiagnosticOpts PsWarning)
forall a b.
(Diagnostic a, Typeable a, DiagnosticOpts a ~ NoDiagnosticOpts) =&gt;
a -&gt; UnknownDiagnostic b
</span><a href="GHC.Types.Error.html#mkSimpleUnknownDiagnostic"><span class="hs-identifier hs-var">mkSimpleUnknownDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">(DiagnosticMessage -&gt; UnknownDiagnostic (DiagnosticOpts PsWarning))
-&gt; DiagnosticMessage
-&gt; UnknownDiagnostic (DiagnosticOpts PsWarning)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2605"></span><span>                      </span><span class="annot"><span class="annottext">[GhcHint] -&gt; SDoc -&gt; DiagnosticMessage
</span><a href="GHC.Types.Error.html#mkPlainError"><span class="hs-identifier hs-var">mkPlainError</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="GHC.Types.Error.html#noHints"><span class="hs-identifier hs-var">noHints</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; DiagnosticMessage) -&gt; SDoc -&gt; DiagnosticMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2606"></span><span>                         </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;parse error in import declaration&quot;</span></span><span>
</span><span id="line-2607"></span><span>
</span><span id="line-2608"></span><span class="annot"><span class="hs-comment">-- | Typecheck an expression (but don't run it)</span></span><span>
</span><span id="line-2609"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcExpr"><span class="hs-identifier hs-type">hscTcExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2610"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#TcRnExprMode"><span class="hs-identifier hs-type">TcRnExprMode</span></a></span><span>
</span><span id="line-2611"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The expression</span></span><span>
</span><span id="line-2612"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2613"></span><span id="hscTcExpr"><span class="annot"><span class="annottext">hscTcExpr :: HscEnv -&gt; TcRnExprMode -&gt; [Char] -&gt; IO Type
</span><a href="GHC.Driver.Main.html#hscTcExpr"><span class="hs-identifier hs-var hs-var">hscTcExpr</span></a></span></span><span> </span><span id="local-6989586621683157702"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157702"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683157703"><span class="annot"><span class="annottext">TcRnExprMode
</span><a href="#local-6989586621683157703"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683157704"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157704"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc Type -&gt; IO Type
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157702"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc Type -&gt; IO Type) -&gt; Hsc Type -&gt; IO Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2614"></span><span>  </span><span id="local-6989586621683157705"><span class="annot"><a href="#local-6989586621683157705"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-2615"></span><span>  </span><span id="local-6989586621683157706"><span class="annot"><a href="#local-6989586621683157706"><span class="hs-identifier hs-var">parsed_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier hs-type">hscParseExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157704"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-2616"></span><span>  </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnExpr"><span class="hs-identifier hs-type">tcRnExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157705"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157703"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157706"><span class="hs-identifier hs-type">parsed_expr</span></a></span><span>
</span><span id="line-2617"></span><span>
</span><span id="line-2618"></span><span class="annot"><span class="hs-comment">-- | Find the kind of a type, after generalisation</span></span><span>
</span><span id="line-2619"></span><span class="annot"><a href="GHC.Driver.Main.html#hscKcType"><span class="hs-identifier hs-type">hscKcType</span></a></span><span>
</span><span id="line-2620"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2621"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Normalise the type</span></span><span>
</span><span id="line-2622"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The type as a string</span></span><span>
</span><span id="line-2623"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Resulting type (possibly normalised) and kind</span></span><span>
</span><span id="line-2624"></span><span id="hscKcType"><span class="annot"><span class="annottext">hscKcType :: HscEnv -&gt; Bool -&gt; [Char] -&gt; IO (Type, Type)
</span><a href="GHC.Driver.Main.html#hscKcType"><span class="hs-identifier hs-var hs-var">hscKcType</span></a></span></span><span> </span><span id="local-6989586621683157709"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157709"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621683157710"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683157710"><span class="hs-identifier hs-var">normalise</span></a></span></span><span> </span><span id="local-6989586621683157711"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157711"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Type, Type) -&gt; IO (Type, Type)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157709"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Type, Type) -&gt; IO (Type, Type))
-&gt; Hsc (Type, Type) -&gt; IO (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2625"></span><span>    </span><span id="local-6989586621683157712"><span class="annot"><a href="#local-6989586621683157712"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-2626"></span><span>    </span><span id="local-6989586621683157713"><span class="annot"><a href="#local-6989586621683157713"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier hs-type">hscParseType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157711"><span class="hs-identifier hs-type">str</span></a></span><span>
</span><span id="line-2627"></span><span>    </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-type">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnType"><span class="hs-identifier hs-type">tcRnType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157712"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Env.html#DefaultFlexi"><span class="hs-identifier hs-type">DefaultFlexi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157710"><span class="hs-identifier hs-type">normalise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157713"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-2628"></span><span>
</span><span id="line-2629"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier hs-type">hscParseExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2630"></span><span id="hscParseExpr"><span class="annot"><span class="annottext">hscParseExpr :: [Char] -&gt; Hsc (LHsExpr GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier hs-var hs-var">hscParseExpr</span></a></span></span><span> </span><span id="local-6989586621683157715"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157715"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2631"></span><span>  </span><span id="local-6989586621683157716"><span class="annot"><a href="#local-6989586621683157716"><span class="hs-identifier hs-var">maybe_stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Hsc (Maybe (GhciLStmt GhcPs))
</span><a href="GHC.Driver.Main.html#hscParseStmt"><span class="hs-identifier hs-var">hscParseStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157715"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-2632"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683157716"><span class="hs-identifier hs-type">maybe_stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2633"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683157719"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683157719"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
-&gt; Hsc (GenLocated SrcSpanAnnA (HsExpr GhcPs))
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683157719"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-2634"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage
-&gt; Hsc (GenLocated SrcSpanAnnA (HsExpr GhcPs))
forall (io :: * -&gt; *) a.
MonadIO io =&gt;
MsgEnvelope GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage
 -&gt; Hsc (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
-&gt; MsgEnvelope GhcMessage
-&gt; Hsc (GenLocated SrcSpanAnnA (HsExpr GhcPs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2635"></span><span>           </span><span class="annot"><span class="annottext">SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2636"></span><span>           </span><span class="annot"><span class="annottext">PsWarning -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-var">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(PsWarning -&gt; GhcMessage) -&gt; PsWarning -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnknownDiagnostic (DiagnosticOpts PsWarning) -&gt; PsWarning
</span><a href="GHC.Parser.Errors.Types.html#PsUnknownMessage"><span class="hs-identifier hs-var">PsUnknownMessage</span></a></span><span>
</span><span id="line-2637"></span><span>             </span><span class="annot"><span class="annottext">(UnknownDiagnostic (DiagnosticOpts PsWarning) -&gt; PsWarning)
-&gt; UnknownDiagnostic (DiagnosticOpts PsWarning) -&gt; PsWarning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiagnosticMessage -&gt; UnknownDiagnostic (DiagnosticOpts PsWarning)
forall a b.
(Diagnostic a, Typeable a, DiagnosticOpts a ~ NoDiagnosticOpts) =&gt;
a -&gt; UnknownDiagnostic b
</span><a href="GHC.Types.Error.html#mkSimpleUnknownDiagnostic"><span class="hs-identifier hs-var">mkSimpleUnknownDiagnostic</span></a></span><span>
</span><span id="line-2638"></span><span>             </span><span class="annot"><span class="annottext">(DiagnosticMessage -&gt; UnknownDiagnostic (DiagnosticOpts PsWarning))
-&gt; DiagnosticMessage
-&gt; UnknownDiagnostic (DiagnosticOpts PsWarning)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; SDoc -&gt; DiagnosticMessage
</span><a href="GHC.Types.Error.html#mkPlainError"><span class="hs-identifier hs-var">mkPlainError</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="GHC.Types.Error.html#noHints"><span class="hs-identifier hs-var">noHints</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; DiagnosticMessage) -&gt; SDoc -&gt; DiagnosticMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2639"></span><span>             </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;not an expression:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157715"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2640"></span><span>
</span><span id="line-2641"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseStmt"><span class="hs-identifier hs-type">hscParseStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2642"></span><span id="hscParseStmt"><span class="annot"><span class="annottext">hscParseStmt :: [Char] -&gt; Hsc (Maybe (GhciLStmt GhcPs))
</span><a href="GHC.Driver.Main.html#hscParseStmt"><span class="hs-identifier hs-var hs-var">hscParseStmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (Maybe
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))))
-&gt; [Char]
-&gt; Hsc
     (Maybe
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))))
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (Maybe
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))))
</span><a href="GHC.Parser.html#parseStmt"><span class="hs-identifier hs-var">parseStmt</span></a></span><span>
</span><span id="line-2643"></span><span>
</span><span id="line-2644"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier hs-type">hscParseStmtWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-2645"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2646"></span><span id="hscParseStmtWithLocation"><span class="annot"><span class="annottext">hscParseStmtWithLocation :: [Char] -&gt; Int -&gt; [Char] -&gt; Hsc (Maybe (GhciLStmt GhcPs))
</span><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier hs-var hs-var">hscParseStmtWithLocation</span></a></span></span><span> </span><span id="local-6989586621683157721"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157721"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621683157722"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157722"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span id="local-6989586621683157723"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157723"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2647"></span><span>    </span><span class="annot"><span class="annottext">[Char]
-&gt; Int
-&gt; P (Maybe
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))))
-&gt; [Char]
-&gt; Hsc
     (Maybe
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))))
forall thing.
(Outputable thing, Data thing) =&gt;
[Char] -&gt; Int -&gt; P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157721"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157722"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">P (Maybe
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))))
</span><a href="GHC.Parser.html#parseStmt"><span class="hs-identifier hs-var">parseStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157723"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2648"></span><span>
</span><span id="line-2649"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier hs-type">hscParseType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2650"></span><span id="hscParseType"><span class="annot"><span class="annottext">hscParseType :: [Char] -&gt; Hsc (LHsType GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier hs-var hs-var">hscParseType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (GenLocated SrcSpanAnnA (HsType GhcPs))
-&gt; [Char] -&gt; Hsc (GenLocated SrcSpanAnnA (HsType GhcPs))
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (GenLocated SrcSpanAnnA (HsType GhcPs))
</span><a href="GHC.Parser.html#parseType"><span class="hs-identifier hs-var">parseType</span></a></span><span>
</span><span id="line-2651"></span><span>
</span><span id="line-2652"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseIdentifier"><span class="hs-identifier hs-type">hscParseIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2653"></span><span id="hscParseIdentifier"><span class="annot"><span class="annottext">hscParseIdentifier :: HscEnv -&gt; [Char] -&gt; IO (LocatedN RdrName)
</span><a href="GHC.Driver.Main.html#hscParseIdentifier"><span class="hs-identifier hs-var hs-var">hscParseIdentifier</span></a></span></span><span> </span><span id="local-6989586621683157725"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157725"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157726"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157726"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2654"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (LocatedN RdrName) -&gt; IO (LocatedN RdrName)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157725"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (LocatedN RdrName) -&gt; IO (LocatedN RdrName))
-&gt; Hsc (LocatedN RdrName) -&gt; IO (LocatedN RdrName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">P (LocatedN RdrName) -&gt; [Char] -&gt; Hsc (LocatedN RdrName)
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (LocatedN RdrName)
</span><a href="GHC.Parser.html#parseIdentifier"><span class="hs-identifier hs-var">parseIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157726"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2655"></span><span>
</span><span id="line-2656"></span><span id="local-6989586621683155035"><span class="annot"><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-type">hscParseThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683155035"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621683155035"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2657"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html#P"><span class="hs-identifier hs-type">Lexer.P</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683155035"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683155035"><span class="hs-identifier hs-type">thing</span></a></span></span><span>
</span><span id="line-2658"></span><span id="hscParseThing"><span class="annot"><span class="annottext">hscParseThing :: forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var hs-var">hscParseThing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; P thing -&gt; [Char] -&gt; Hsc thing
forall thing.
(Outputable thing, Data thing) =&gt;
[Char] -&gt; Int -&gt; P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2659"></span><span>
</span><span id="line-2660"></span><span id="local-6989586621683155026"><span class="annot"><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-type">hscParseThingWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683155026"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621683155026"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2661"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html#P"><span class="hs-identifier hs-type">Lexer.P</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683155026"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683155026"><span class="hs-identifier hs-type">thing</span></a></span></span><span>
</span><span id="line-2662"></span><span id="hscParseThingWithLocation"><span class="annot"><span class="annottext">hscParseThingWithLocation :: forall thing.
(Outputable thing, Data thing) =&gt;
[Char] -&gt; Int -&gt; P thing -&gt; [Char] -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var hs-var">hscParseThingWithLocation</span></a></span></span><span> </span><span id="local-6989586621683157748"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157748"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621683157749"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157749"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span id="local-6989586621683157750"><span class="annot"><span class="annottext">P thing
</span><a href="#local-6989586621683157750"><span class="hs-identifier hs-var">parser</span></a></span></span><span> </span><span id="local-6989586621683157751"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157751"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2663"></span><span>    </span><span id="local-6989586621683157752"><span class="annot"><a href="#local-6989586621683157752"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2664"></span><span>    </span><span id="local-6989586621683157753"><span class="annot"><a href="#local-6989586621683157753"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-2665"></span><span>    </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-type">withTiming</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157753"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-2666"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Parser [source]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2667"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Parser&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2668"></span><span>
</span><span id="line-2669"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157754"><span class="annot"><a href="#local-6989586621683157754"><span class="hs-identifier hs-var hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; StringBuffer
</span><a href="GHC.Data.StringBuffer.html#stringToStringBuffer"><span class="hs-identifier hs-var">stringToStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157751"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2670"></span><span>            </span><span id="local-6989586621683157756"><span class="annot"><a href="#local-6989586621683157756"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157748"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157749"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2671"></span><span>
</span><span id="line-2672"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157750"><span class="hs-identifier hs-type">parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Lexer.html#initParserState"><span class="hs-identifier hs-type">initParserState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Parser.html#initParserOpts"><span class="hs-identifier hs-type">initParserOpts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157752"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157754"><span class="hs-identifier hs-type">buf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157756"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2673"></span><span>            </span><span class="annot"><a href="GHC.Parser.Lexer.html#PFailed"><span class="hs-identifier hs-type">PFailed</span></a></span><span> </span><span id="local-6989586621683157757"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683157757"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2674"></span><span>                </span><span class="annot"><span class="annottext">(Messages PsWarning, Messages PsWarning) -&gt; Hsc thing
forall a. (Messages PsWarning, Messages PsWarning) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-var">handleWarningsThrowErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState -&gt; (Messages PsWarning, Messages PsWarning)
</span><a href="GHC.Parser.Lexer.html#getPsMessages"><span class="hs-identifier hs-var">getPsMessages</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683157757"><span class="hs-identifier hs-var">pst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2675"></span><span>            </span><span class="annot"><a href="GHC.Parser.Lexer.html#POk"><span class="hs-identifier hs-type">POk</span></a></span><span> </span><span id="local-6989586621683157758"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683157758"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span id="local-6989586621683157759"><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621683157759"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2676"></span><span>                </span><span class="annot"><span class="annottext">(Messages PsWarning, Messages PsWarning) -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarningsReportErrors"><span class="hs-identifier hs-var">logWarningsReportErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState -&gt; (Messages PsWarning, Messages PsWarning)
</span><a href="GHC.Parser.Lexer.html#getPsMessages"><span class="hs-identifier hs-var">getPsMessages</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621683157758"><span class="hs-identifier hs-var">pst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2677"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157753"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed"><span class="hs-identifier hs-var">Opt_D_dump_parsed</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Parser&quot;</span></span><span>
</span><span id="line-2678"></span><span>                            </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">thing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621683157759"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2679"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall a. IO a -&gt; Hsc a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; [Char] -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157753"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed_ast"><span class="hs-identifier hs-var">Opt_D_dump_parsed_ast</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Parser AST&quot;</span></span><span>
</span><span id="line-2680"></span><span>                            </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlankSrcSpan -&gt; BlankEpAnnotations -&gt; thing -&gt; SDoc
forall a. Data a =&gt; BlankSrcSpan -&gt; BlankEpAnnotations -&gt; a -&gt; SDoc
</span><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-var">showAstData</span></a></span><span> </span><span class="annot"><span class="annottext">BlankSrcSpan
</span><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-var">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">BlankEpAnnotations
</span><a href="GHC.Hs.Dump.html#NoBlankEpAnnotations"><span class="hs-identifier hs-var">NoBlankEpAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621683157759"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2681"></span><span>                </span><span class="annot"><span class="annottext">thing -&gt; Hsc thing
forall a. a -&gt; Hsc a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621683157759"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-2682"></span><span>
</span><span id="line-2683"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTidy"><span class="hs-identifier hs-type">hscTidy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2684"></span><span id="hscTidy"><span class="annot"><span class="annottext">hscTidy :: HscEnv -&gt; ModGuts -&gt; IO (CgGuts, ModDetails)
</span><a href="GHC.Driver.Main.html#hscTidy"><span class="hs-identifier hs-var hs-var">hscTidy</span></a></span></span><span> </span><span id="local-6989586621683157760"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157760"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157761"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157761"><span class="hs-identifier hs-var">guts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2685"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157762"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683157762"><span class="hs-identifier hs-var hs-var hs-var">logger</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157760"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2686"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157763"><span class="annot"><span class="annottext">this_mod :: Module
</span><a href="#local-6989586621683157763"><span class="hs-identifier hs-var hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157761"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-2687"></span><span>
</span><span id="line-2688"></span><span>  </span><span id="local-6989586621683157765"><span class="annot"><a href="#local-6989586621683157765"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO TidyOpts
</span><a href="GHC.Driver.Config.Tidy.html#initTidyOpts"><span class="hs-identifier hs-var">initTidyOpts</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157760"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2689"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683157767"><span class="annot"><a href="#local-6989586621683157767"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157768"><span class="annot"><a href="#local-6989586621683157768"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-type">withTiming</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157762"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-2690"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CoreTidy&quot;</span></span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157763"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2691"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2692"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CoreTidy&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Iface.Tidy.html#tidyProgram"><span class="hs-identifier hs-type">tidyProgram</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157765"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157761"><span class="hs-identifier hs-type">guts</span></a></span><span>
</span><span id="line-2693"></span><span>
</span><span id="line-2694"></span><span>  </span><span class="hs-comment">-- post tidy pretty-printing and linting...</span><span>
</span><span id="line-2695"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157770"><span class="annot"><a href="#local-6989586621683157770"><span class="hs-identifier hs-var hs-var">tidy_rules</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModDetails -&gt; [CoreRule]
</span><a href="GHC.Unit.Module.ModDetails.html#md_rules"><span class="hs-identifier hs-var">md_rules</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683157768"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-2696"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157772"><span class="annot"><a href="#local-6989586621683157772"><span class="hs-identifier hs-var hs-var">all_tidy_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621683157767"><span class="hs-identifier hs-var">cgguts</span></a></span><span>
</span><span id="line-2697"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157773"><span class="annot"><a href="#local-6989586621683157773"><span class="hs-identifier hs-var hs-var">name_ppr_ctx</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnv -&gt; NamePprCtx
forall info.
Outputable info =&gt;
PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnvX info -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#mkNamePprCtx"><span class="hs-identifier hs-var">mkNamePprCtx</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621683157775"><span class="hs-identifier hs-var">ptc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157760"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; GlobalRdrEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rdr_env"><span class="hs-identifier hs-var">mg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621683157761"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2698"></span><span>      </span><span id="local-6989586621683157775"><span class="annot"><a href="#local-6989586621683157775"><span class="hs-identifier hs-var hs-var">ptc</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.DynFlags.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157760"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2699"></span><span>
</span><span id="line-2700"></span><span>  </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.html#endPassHscEnvIO"><span class="hs-identifier hs-type">endPassHscEnvIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157760"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157773"><span class="hs-identifier hs-type">name_ppr_ctx</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreTidy"><span class="hs-identifier hs-type">CoreTidy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157772"><span class="hs-identifier hs-type">all_tidy_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157770"><span class="hs-identifier hs-type">tidy_rules</span></a></span><span>
</span><span id="line-2701"></span><span>
</span><span id="line-2702"></span><span>  </span><span class="hs-comment">-- If the endPass didn't print the rules, but ddump-rules is</span><span>
</span><span id="line-2703"></span><span>  </span><span class="hs-comment">-- on, print now</span><span>
</span><span id="line-2704"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157762"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_simpl"><span class="hs-identifier hs-type">Opt_D_dump_simpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2705"></span><span>    </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157762"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_rules"><span class="hs-identifier hs-type">Opt_D_dump_rules</span></a></span><span>
</span><span id="line-2706"></span><span>      </span><span class="annot"><span class="hs-string">&quot;Tidy Core rules&quot;</span></span><span>
</span><span id="line-2707"></span><span>      </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-type">FormatText</span></a></span><span>
</span><span id="line-2708"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Rules.html#pprRulesForUser"><span class="hs-identifier hs-type">pprRulesForUser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157770"><span class="hs-identifier hs-type">tidy_rules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2709"></span><span>
</span><span id="line-2710"></span><span>  </span><span class="hs-comment">-- Print one-line size info</span><span>
</span><span id="line-2711"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157782"><span class="annot"><a href="#local-6989586621683157782"><span class="hs-identifier hs-var hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; CoreStats
</span><a href="GHC.Core.Stats.html#coreBindsStats"><span class="hs-identifier hs-var">coreBindsStats</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683157772"><span class="hs-identifier hs-var">all_tidy_binds</span></a></span><span>
</span><span id="line-2712"></span><span>  </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157762"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_core_stats"><span class="hs-identifier hs-type">Opt_D_dump_core_stats</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Core Stats&quot;</span></span><span>
</span><span id="line-2713"></span><span>    </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-type">FormatText</span></a></span><span>
</span><span id="line-2714"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tidy size (terms,types,coercions)&quot;</span></span><span>
</span><span id="line-2715"></span><span>     </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157763"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-type">colon</span></a></span><span>
</span><span id="line-2716"></span><span>     </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-type">int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Stats.html#cs_tm"><span class="hs-identifier hs-var">cs_tm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157782"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2717"></span><span>     </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-type">int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Stats.html#cs_ty"><span class="hs-identifier hs-var">cs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157782"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2718"></span><span>     </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-type">int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Stats.html#cs_co"><span class="hs-identifier hs-var">cs_co</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157782"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2719"></span><span>
</span><span id="line-2720"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157767"><span class="hs-identifier hs-type">cgguts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157768"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2721"></span><span>
</span><span id="line-2722"></span><span>
</span><span id="line-2723"></span><span class="annot"><span class="hs-comment">{- **********************************************************************
%*                                                                      *
        Desugar, simplify, convert to bytecode, and link an expression
%*                                                                      *
%********************************************************************* -}</span></span><span>
</span><span id="line-2728"></span><span>
</span><span id="line-2729"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-type">hscCompileCoreExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2730"></span><span id="hscCompileCoreExpr"><span class="annot"><span class="annottext">hscCompileCoreExpr :: HscEnv
-&gt; SrcSpan
-&gt; CoreExpr
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-var hs-var">hscCompileCoreExpr</span></a></span></span><span> </span><span id="local-6989586621683157790"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157790"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157791"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157791"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683157792"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683157792"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2731"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; Maybe
     (HscEnv
      -&gt; SrcSpan
      -&gt; CoreExpr
      -&gt; IO (ForeignHValue, [Linkable], PkgsLoaded))
</span><a href="GHC.Driver.Hooks.html#hscCompileCoreExprHook"><span class="hs-identifier hs-var">hscCompileCoreExprHook</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157790"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2732"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  (HscEnv
   -&gt; SrcSpan
   -&gt; CoreExpr
   -&gt; IO (ForeignHValue, [Linkable], PkgsLoaded))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; SrcSpan
-&gt; CoreExpr
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier hs-var">hscCompileCoreExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157790"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157791"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683157792"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-2733"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157794"><span class="annot"><span class="annottext">HscEnv
-&gt; SrcSpan
-&gt; CoreExpr
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="#local-6989586621683157794"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; SrcSpan
-&gt; CoreExpr
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="#local-6989586621683157794"><span class="hs-identifier hs-var">h</span></a></span><span>                   </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157790"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157791"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683157792"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-2734"></span><span>
</span><span id="line-2735"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier hs-type">hscCompileCoreExpr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2736"></span><span id="hscCompileCoreExpr%27"><span class="annot"><span class="annottext">hscCompileCoreExpr' :: HscEnv
-&gt; SrcSpan
-&gt; CoreExpr
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier hs-var hs-var">hscCompileCoreExpr'</span></a></span></span><span> </span><span id="local-6989586621683157795"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157796"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157796"><span class="hs-identifier hs-var">srcspan</span></a></span></span><span> </span><span id="local-6989586621683157797"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683157797"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2737"></span><span>  </span><span class="hs-comment">{- Simplify it -}</span><span>
</span><span id="line-2738"></span><span>  </span><span class="hs-comment">-- Question: should we call SimpleOpt.simpleOptExpr here instead?</span><span>
</span><span id="line-2739"></span><span>  </span><span class="hs-comment">-- It is, well, simpler, and does less inlining etc.</span><span>
</span><span id="line-2740"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157798"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683157798"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2741"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157799"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683157799"><span class="hs-identifier hs-var hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2742"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157800"><span class="annot"><span class="annottext">ic :: InteractiveContext
</span><a href="#local-6989586621683157800"><span class="hs-identifier hs-var hs-var hs-var">ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2743"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157801"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621683157801"><span class="hs-identifier hs-var hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2744"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157802"><span class="annot"><span class="annottext">simplify_expr_opts :: SimplifyExprOpts
</span><a href="#local-6989586621683157802"><span class="hs-identifier hs-var hs-var hs-var">simplify_expr_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; InteractiveContext -&gt; SimplifyExprOpts
</span><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initSimplifyExprOpts"><span class="hs-identifier hs-var">initSimplifyExprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157798"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683157800"><span class="hs-identifier hs-var">ic</span></a></span><span>
</span><span id="line-2745"></span><span>
</span><span id="line-2746"></span><span>  </span><span id="local-6989586621683157803"><span class="annot"><a href="#local-6989586621683157803"><span class="hs-identifier hs-var">simpl_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; ExternalUnitCache -&gt; SimplifyExprOpts -&gt; CoreExpr -&gt; IO CoreExpr
</span><a href="GHC.Core.Opt.Simplify.html#simplifyExpr"><span class="hs-identifier hs-var">simplifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157799"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; ExternalUnitCache
</span><a href="GHC.Unit.Env.html#ue_eps"><span class="hs-identifier hs-var">ue_eps</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683157801"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SimplifyExprOpts
</span><a href="#local-6989586621683157802"><span class="hs-identifier hs-var">simplify_expr_opts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683157797"><span class="hs-identifier hs-var">ds_expr</span></a></span><span>
</span><span id="line-2747"></span><span>
</span><span id="line-2748"></span><span>  </span><span class="hs-comment">-- Create a unique temporary binding</span><span>
</span><span id="line-2749"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2750"></span><span>  </span><span class="hs-comment">-- The id has to be exported for the JS backend. This isn't required for the</span><span>
</span><span id="line-2751"></span><span>  </span><span class="hs-comment">-- byte-code interpreter but it does no harm to always do it.</span><span>
</span><span id="line-2752"></span><span>  </span><span id="local-6989586621683157806"><span class="annot"><a href="#local-6989586621683157806"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-identifier hs-type">uniqFromTag</span></a></span><span> </span><span class="annot"><span class="hs-char">'I'</span></span><span>
</span><span id="line-2753"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157807"><span class="annot"><a href="#local-6989586621683157807"><span class="hs-identifier hs-var hs-var">binding_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; FastString -&gt; Name
</span><a href="GHC.Types.Name.html#mkSystemVarName"><span class="hs-identifier hs-var">mkSystemVarName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683157806"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;BCO_toplevel&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2754"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157809"><span class="annot"><a href="#local-6989586621683157809"><span class="hs-identifier hs-var hs-var">binding_id</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkExportedVanillaId"><span class="hs-identifier hs-var">mkExportedVanillaId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683157807"><span class="hs-identifier hs-var">binding_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683157803"><span class="hs-identifier hs-var">simpl_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2755"></span><span>
</span><span id="line-2756"></span><span>  </span><span class="hs-comment">{- Tidy it (temporary, until coreSat does cloning) -}</span><span>
</span><span id="line-2757"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157811"><span class="annot"><a href="#local-6989586621683157811"><span class="hs-identifier hs-var hs-var">tidy_occ_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OccName] -&gt; TidyOccEnv
</span><a href="GHC.Types.Name.Occurrence.html#initTidyOccEnv"><span class="hs-identifier hs-var">initTidyOccEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157809"><span class="hs-identifier hs-var">binding_id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2758"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157814"><span class="annot"><a href="#local-6989586621683157814"><span class="hs-identifier hs-var hs-var">tidy_env</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyOccEnv -&gt; TidyEnv
</span><a href="GHC.Types.Var.Env.html#mkEmptyTidyEnv"><span class="hs-identifier hs-var">mkEmptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621683157811"><span class="hs-identifier hs-var">tidy_occ_env</span></a></span><span>
</span><span id="line-2759"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157815"><span class="annot"><a href="#local-6989586621683157815"><span class="hs-identifier hs-var hs-var">tidy_expr</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683157814"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683157803"><span class="hs-identifier hs-var">simpl_expr</span></a></span><span>
</span><span id="line-2760"></span><span>
</span><span id="line-2761"></span><span>  </span><span class="hs-comment">{- Prepare for codegen -}</span><span>
</span><span id="line-2762"></span><span>  </span><span id="local-6989586621683157816"><span class="annot"><a href="#local-6989586621683157816"><span class="hs-identifier hs-var">cp_cfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.CoreToStg.Prep.html#initCorePrepConfig"><span class="hs-identifier hs-type">initCorePrepConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157795"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-2763"></span><span>  </span><span id="local-6989586621683157817"><span class="annot"><a href="#local-6989586621683157817"><span class="hs-identifier hs-var">prepd_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CoreToStg.Prep.html#corePrepExpr"><span class="hs-identifier hs-type">corePrepExpr</span></a></span><span>
</span><span id="line-2764"></span><span>   </span><span class="annot"><a href="#local-6989586621683157799"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157816"><span class="hs-identifier hs-type">cp_cfg</span></a></span><span>
</span><span id="line-2765"></span><span>   </span><span class="annot"><a href="#local-6989586621683157815"><span class="hs-identifier hs-type">tidy_expr</span></a></span><span>
</span><span id="line-2766"></span><span>
</span><span id="line-2767"></span><span>  </span><span class="hs-comment">{- Lint if necessary -}</span><span>
</span><span id="line-2768"></span><span>  </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.Interactive.html#lintInteractiveExpr"><span class="hs-identifier hs-type">lintInteractiveExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;hscCompileCoreExpr&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157795"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157817"><span class="hs-identifier hs-type">prepd_expr</span></a></span><span>
</span><span id="line-2769"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157829"><span class="annot"><a href="#local-6989586621683157829"><span class="hs-identifier hs-var hs-var">this_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#OsPathModLocation"><span class="hs-identifier hs-type">OsPathModLocation</span></a></span><span>
</span><span id="line-2770"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_hs_file_ospath :: Maybe OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file_ospath"><span class="hs-identifier hs-var">ml_hs_file_ospath</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OsPath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-2771"></span><span>            </span><span class="annot"><span class="annottext">ml_hi_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file_ospath"><span class="hs-identifier hs-var">ml_hi_file_ospath</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCoreExpr':ml_hi_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2772"></span><span>            </span><span class="annot"><span class="annottext">ml_obj_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file_ospath"><span class="hs-identifier hs-var">ml_obj_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCoreExpr':ml_obj_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2773"></span><span>            </span><span class="annot"><span class="annottext">ml_dyn_obj_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file_ospath"><span class="hs-identifier hs-var">ml_dyn_obj_file_ospath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCoreExpr': ml_obj_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2774"></span><span>            </span><span class="annot"><span class="annottext">ml_dyn_hi_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_hi_file_ospath"><span class="hs-identifier hs-var">ml_dyn_hi_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCoreExpr': ml_dyn_hi_file_ospath&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2775"></span><span>            </span><span class="annot"><span class="annottext">ml_hie_file_ospath :: OsPath
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file_ospath"><span class="hs-identifier hs-var">ml_hie_file_ospath</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OsPath
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hscCompileCoreExpr':ml_hie_file_ospath&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2776"></span><span>
</span><span id="line-2777"></span><span>  </span><span class="hs-comment">-- Ensure module uniqueness by giving it a name like &quot;GhciNNNN&quot;.</span><span>
</span><span id="line-2778"></span><span>  </span><span class="hs-comment">-- This uniqueness is needed by the JS linker. Without it we break the 1-1</span><span>
</span><span id="line-2779"></span><span>  </span><span class="hs-comment">-- relationship between modules and object files, i.e. we get different object</span><span>
</span><span id="line-2780"></span><span>  </span><span class="hs-comment">-- files for the same module and the JS linker doesn't support this.</span><span>
</span><span id="line-2781"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2782"></span><span>  </span><span class="hs-comment">-- Note that we can't use icInteractiveModule because the ic_mod_index value</span><span>
</span><span id="line-2783"></span><span>  </span><span class="hs-comment">-- isn't bumped between invocations of hscCompileCoreExpr, so uniqueness isn't</span><span>
</span><span id="line-2784"></span><span>  </span><span class="hs-comment">-- guaranteed.</span><span>
</span><span id="line-2785"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2786"></span><span>  </span><span class="hs-comment">-- We reuse the unique we obtained for the binding, but any unique would do.</span><span>
</span><span id="line-2787"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157830"><span class="annot"><a href="#local-6989586621683157830"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Module
</span><a href="GHC.Builtin.Names.html#mkInteractiveModule"><span class="hs-identifier hs-var">mkInteractiveModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683157806"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2788"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157832"><span class="annot"><a href="#local-6989586621683157832"><span class="hs-identifier hs-var hs-var">for_bytecode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2789"></span><span>
</span><span id="line-2790"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683157833"><span class="annot"><a href="#local-6989586621683157833"><span class="hs-identifier hs-var">stg_binds_with_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157834"><span class="annot"><a href="#local-6989586621683157834"><span class="hs-identifier hs-var">_prov_map</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157835"><span class="annot"><a href="#local-6989586621683157835"><span class="hs-identifier hs-var">_collected_ccs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157836"><span class="annot"><a href="#local-6989586621683157836"><span class="hs-identifier hs-var">_stg_cg_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2791"></span><span>       </span><span class="annot"><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-type">myCoreToStg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157799"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-2792"></span><span>                   </span><span class="annot"><a href="#local-6989586621683157798"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-2793"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier hs-type">interactiveInScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157795"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2794"></span><span>                   </span><span class="annot"><a href="#local-6989586621683157832"><span class="hs-identifier hs-type">for_bytecode</span></a></span><span>
</span><span id="line-2795"></span><span>                   </span><span class="annot"><a href="#local-6989586621683157830"><span class="hs-identifier hs-type">this_mod</span></a></span><span>
</span><span id="line-2796"></span><span>                   </span><span class="annot"><a href="#local-6989586621683157829"><span class="hs-identifier hs-type">this_loc</span></a></span><span>
</span><span id="line-2797"></span><span>                   </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157809"><span class="hs-identifier hs-type">binding_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157817"><span class="hs-identifier hs-type">prepd_expr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2798"></span><span>
</span><span id="line-2799"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157838"><span class="annot"><a href="#local-6989586621683157838"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157839"><span class="annot"><a href="#local-6989586621683157839"><span class="hs-identifier hs-var">_stg_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621683157833"><span class="hs-identifier hs-type">stg_binds_with_deps</span></a></span><span>
</span><span id="line-2800"></span><span>
</span><span id="line-2801"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157840"><span class="annot"><a href="#local-6989586621683157840"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2802"></span><span>
</span><span id="line-2803"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683157840"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2804"></span><span>    </span><span class="hs-comment">-- always generate JS code for the JS interpreter (no bytecode!)</span><span>
</span><span id="line-2805"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtJS"><span class="hs-identifier hs-type">ExtJS</span></a></span><span> </span><span id="local-6989586621683157844"><span class="annot"><span class="annottext">JSInterp
</span><a href="#local-6989586621683157844"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Loader
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MVar (UniqFM FastString (Ptr ()))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2806"></span><span>      </span><span class="annot"><span class="annottext">HscEnv
-&gt; SrcSpan
-&gt; JSInterp
-&gt; Module
-&gt; [(CgStgTopBinding, IdSet)]
-&gt; Id
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Driver.Main.html#jsCodeGen"><span class="hs-identifier hs-var">jsCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157796"><span class="hs-identifier hs-var">srcspan</span></a></span><span> </span><span class="annot"><span class="annottext">JSInterp
</span><a href="#local-6989586621683157844"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157830"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[(CgStgTopBinding, IdSet)]
</span><a href="#local-6989586621683157833"><span class="hs-identifier hs-var">stg_binds_with_deps</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157809"><span class="hs-identifier hs-var">binding_id</span></a></span><span>
</span><span id="line-2807"></span><span>
</span><span id="line-2808"></span><span>    </span><span class="annot"><span class="annottext">Interp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2809"></span><span>      </span><span class="hs-comment">{- Convert to BCOs -}</span><span>
</span><span id="line-2810"></span><span>      </span><span id="local-6989586621683157846"><span class="annot"><a href="#local-6989586621683157846"><span class="hs-identifier hs-var">bcos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; [CgStgTopBinding]
-&gt; [TyCon]
-&gt; Maybe ModBreaks
-&gt; [SptEntry]
-&gt; IO CompiledByteCode
</span><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier hs-var">byteCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2811"></span><span>                </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157830"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-2812"></span><span>                </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157838"><span class="hs-identifier hs-var">stg_binds</span></a></span><span>
</span><span id="line-2813"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2814"></span><span>                </span><span class="annot"><span class="annottext">Maybe ModBreaks
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- modbreaks</span><span>
</span><span id="line-2815"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- spt entries</span><span>
</span><span id="line-2816"></span><span>
</span><span id="line-2817"></span><span>      </span><span class="hs-comment">{- load it -}</span><span>
</span><span id="line-2818"></span><span>      </span><span id="local-6989586621683157847"><span class="annot"><a href="#local-6989586621683157847"><span class="hs-identifier hs-var">bco_time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../time-1.14-9bf8/src/Data.Time.Clock.POSIX.html#getCurrentTime"><span class="hs-identifier hs-type">getCurrentTime</span></a></span><span>
</span><span id="line-2819"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683157848"><span class="annot"><a href="#local-6989586621683157848"><span class="hs-identifier hs-var">fv_hvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157849"><span class="annot"><a href="#local-6989586621683157849"><span class="hs-identifier hs-var">mods_needed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157850"><span class="annot"><a href="#local-6989586621683157850"><span class="hs-identifier hs-var">units_needed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html#loadDecls"><span class="hs-identifier hs-type">loadDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157840"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157795"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157796"><span class="hs-identifier hs-type">srcspan</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2820"></span><span>        </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157847"><span class="hs-identifier hs-type">bco_time</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157830"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-type">NE.singleton</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#BCOs"><span class="hs-identifier hs-type">BCOs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157846"><span class="hs-identifier hs-type">bcos</span></a></span><span>
</span><span id="line-2821"></span><span>      </span><span class="hs-comment">{- Get the HValue for the root -}</span><span>
</span><span id="line-2822"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-type">expectJust</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;hscCompileCoreExpr'&quot;</span></span><span>
</span><span id="line-2823"></span><span>         </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-type">idName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157809"><span class="hs-identifier hs-type">binding_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157848"><span class="hs-identifier hs-type">fv_hvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157849"><span class="hs-identifier hs-type">mods_needed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157850"><span class="hs-identifier hs-type">units_needed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2824"></span><span>
</span><span id="line-2825"></span><span>
</span><span id="line-2826"></span><span>
</span><span id="line-2827"></span><span class="annot"><span class="hs-comment">-- | Generate JS code for the given bindings and return the HValue for the given id</span></span><span>
</span><span id="line-2828"></span><span class="annot"><a href="GHC.Driver.Main.html#jsCodeGen"><span class="hs-identifier hs-type">jsCodeGen</span></a></span><span>
</span><span id="line-2829"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2830"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-2831"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#JSInterp"><span class="hs-identifier hs-type">JSInterp</span></a></span><span>
</span><span id="line-2832"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2833"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2834"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-2835"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2836"></span><span id="jsCodeGen"><span class="annot"><span class="annottext">jsCodeGen :: HscEnv
-&gt; SrcSpan
-&gt; JSInterp
-&gt; Module
-&gt; [(CgStgTopBinding, IdSet)]
-&gt; Id
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Driver.Main.html#jsCodeGen"><span class="hs-identifier hs-var hs-var">jsCodeGen</span></a></span></span><span> </span><span id="local-6989586621683157852"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683157853"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157853"><span class="hs-identifier hs-var">srcspan</span></a></span></span><span> </span><span id="local-6989586621683157854"><span class="annot"><span class="annottext">JSInterp
</span><a href="#local-6989586621683157854"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621683157855"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157855"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621683157856"><span class="annot"><span class="annottext">[(CgStgTopBinding, IdSet)]
</span><a href="#local-6989586621683157856"><span class="hs-identifier hs-var">stg_binds_with_deps</span></a></span></span><span> </span><span id="local-6989586621683157857"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683157857"><span class="hs-identifier hs-var">binding_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2837"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157858"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683157858"><span class="hs-identifier hs-var hs-var hs-var">logger</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2838"></span><span>      </span><span id="local-6989586621683157859"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621683157859"><span class="hs-identifier hs-var hs-var hs-var">tmpfs</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2839"></span><span>      </span><span id="local-6989586621683157860"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683157860"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2840"></span><span>      </span><span id="local-6989586621683157861"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621683157861"><span class="hs-identifier hs-var hs-var hs-var">interp</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2841"></span><span>      </span><span id="local-6989586621683157862"><span class="annot"><span class="annottext">tmp_dir :: TempDir
</span><a href="#local-6989586621683157862"><span class="hs-identifier hs-var hs-var hs-var">tmp_dir</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157860"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2842"></span><span>      </span><span id="local-6989586621683157863"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621683157863"><span class="hs-identifier hs-var hs-var hs-var">unit_env</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2843"></span><span>      </span><span id="local-6989586621683157864"><span class="annot"><span class="annottext">js_config :: StgToJSConfig
</span><a href="#local-6989586621683157864"><span class="hs-identifier hs-var hs-var hs-var">js_config</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; StgToJSConfig
</span><a href="GHC.Driver.Config.StgToJS.html#initStgToJSConfig"><span class="hs-identifier hs-var">initStgToJSConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157860"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2844"></span><span>
</span><span id="line-2845"></span><span>  </span><span class="hs-comment">-- We need to load all the dependencies first.</span><span>
</span><span id="line-2846"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2847"></span><span>  </span><span class="hs-comment">-- We get all the imported names from the Stg bindings and load their modules.</span><span>
</span><span id="line-2848"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2849"></span><span>  </span><span class="hs-comment">-- (logic adapted from GHC.Linker.Loader.loadDecls for the JS linker)</span><span>
</span><span id="line-2850"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-2851"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683157865"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621683157865"><span class="hs-identifier hs-var hs-var">stg_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157866"><span class="annot"><span class="annottext">[IdSet]
</span><a href="#local-6989586621683157866"><span class="hs-identifier hs-var hs-var">stg_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CgStgTopBinding, IdSet)] -&gt; ([CgStgTopBinding], [IdSet])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(CgStgTopBinding, IdSet)]
</span><a href="#local-6989586621683157856"><span class="hs-identifier hs-var">stg_binds_with_deps</span></a></span><span>
</span><span id="line-2852"></span><span>    </span><span id="local-6989586621683157867"><span class="annot"><span class="annottext">imported_ids :: [Id]
</span><a href="#local-6989586621683157867"><span class="hs-identifier hs-var hs-var hs-var">imported_ids</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdSet -&gt; [Id]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IdSet] -&gt; IdSet
</span><a href="GHC.Types.Var.Set.html#unionVarSets"><span class="hs-identifier hs-var">unionVarSets</span></a></span><span> </span><span class="annot"><span class="annottext">[IdSet]
</span><a href="#local-6989586621683157866"><span class="hs-identifier hs-var">stg_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2853"></span><span>    </span><span id="local-6989586621683157870"><span class="annot"><span class="annottext">imported_names :: [Name]
</span><a href="#local-6989586621683157870"><span class="hs-identifier hs-var hs-var hs-var">imported_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683157867"><span class="hs-identifier hs-var">imported_ids</span></a></span><span>
</span><span id="line-2854"></span><span>
</span><span id="line-2855"></span><span>    </span><span class="annot"><a href="#local-6989586621683157871"><span class="hs-identifier hs-type">needed_mods</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2856"></span><span>    </span><span id="local-6989586621683157871"><span class="annot"><span class="annottext">needed_mods :: [Module]
</span><a href="#local-6989586621683157871"><span class="hs-identifier hs-var hs-var hs-var">needed_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Module
Name -&gt; Module
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683157873"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683157873"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683157873"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683157870"><span class="hs-identifier hs-var">imported_names</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2857"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683157873"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Names from other modules</span><span>
</span><span id="line-2858"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isWiredInName"><span class="hs-identifier hs-var">isWiredInName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683157873"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Exclude wired-in names</span><span>
</span><span id="line-2859"></span><span>                  </span><span class="hs-special">]</span><span>                         </span><span class="hs-comment">-- (see note below)</span><span>
</span><span id="line-2860"></span><span>    </span><span class="hs-comment">-- Exclude wired-in names because we may not have read</span><span>
</span><span id="line-2861"></span><span>    </span><span class="hs-comment">-- their interface files, so getLinkDeps will fail</span><span>
</span><span id="line-2862"></span><span>    </span><span class="hs-comment">-- All wired-in names are in the base package, which we link</span><span>
</span><span id="line-2863"></span><span>    </span><span class="hs-comment">-- by default, so we can safely ignore them here.</span><span>
</span><span id="line-2864"></span><span>
</span><span id="line-2865"></span><span>  </span><span class="hs-comment">-- Initialise the linker (if it's not been done already)</span><span>
</span><span id="line-2866"></span><span>  </span><span class="annot"><span class="annottext">Interp -&gt; HscEnv -&gt; IO ()
</span><a href="GHC.Linker.Loader.html#initLoaderState"><span class="hs-identifier hs-var">initLoaderState</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683157861"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2867"></span><span>
</span><span id="line-2868"></span><span>  </span><span class="hs-comment">-- Take lock for the actual work.</span><span>
</span><span id="line-2869"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683157876"><span class="annot"><a href="#local-6989586621683157876"><span class="hs-identifier hs-var">dep_linkables</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157877"><span class="annot"><a href="#local-6989586621683157877"><span class="hs-identifier hs-var">dep_units</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; (LoaderState -&gt; IO (LoaderState, ([Linkable], PkgsLoaded)))
-&gt; IO ([Linkable], PkgsLoaded)
forall a. Interp -&gt; (LoaderState -&gt; IO (LoaderState, a)) -&gt; IO a
</span><a href="GHC.Linker.Loader.html#modifyLoaderState"><span class="hs-identifier hs-var">modifyLoaderState</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683157861"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">((LoaderState -&gt; IO (LoaderState, ([Linkable], PkgsLoaded)))
 -&gt; IO ([Linkable], PkgsLoaded))
-&gt; (LoaderState -&gt; IO (LoaderState, ([Linkable], PkgsLoaded)))
-&gt; IO ([Linkable], PkgsLoaded)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683157879"><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621683157879"><span class="hs-identifier hs-var">pls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2870"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157880"><span class="annot"><span class="annottext">link_opts :: LinkDepsOpts
</span><a href="#local-6989586621683157880"><span class="hs-identifier hs-var hs-var hs-var">link_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; LinkDepsOpts
</span><a href="GHC.Linker.Loader.html#initLinkDepsOpts"><span class="hs-identifier hs-var">initLinkDepsOpts</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157852"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2871"></span><span>
</span><span id="line-2872"></span><span>    </span><span class="hs-comment">-- Find what packages and linkables are required</span><span>
</span><span id="line-2873"></span><span>    </span><span id="local-6989586621683157882"><span class="annot"><a href="#local-6989586621683157882"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
-&gt; Interp -&gt; LoaderState -&gt; SrcSpan -&gt; [Module] -&gt; IO LinkDeps
</span><a href="GHC.Linker.Deps.html#getLinkDeps"><span class="hs-identifier hs-var">getLinkDeps</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDepsOpts
</span><a href="#local-6989586621683157880"><span class="hs-identifier hs-var">link_opts</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683157861"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621683157879"><span class="hs-identifier hs-var">pls</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683157853"><span class="hs-identifier hs-var">srcspan</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683157871"><span class="hs-identifier hs-var">needed_mods</span></a></span><span>
</span><span id="line-2874"></span><span>    </span><span class="hs-comment">-- We update the LinkerState even if the JS interpreter maintains its linker</span><span>
</span><span id="line-2875"></span><span>    </span><span class="hs-comment">-- state independently to load new objects here.</span><span>
</span><span id="line-2876"></span><span>
</span><span id="line-2877"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157884"><span class="annot"><a href="#local-6989586621683157884"><span class="hs-identifier hs-var hs-var">objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Linkable -&gt; Maybe Linkable) -&gt; [Linkable] -&gt; [Linkable]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
</span><a href="GHC.Linker.Types.html#linkableFilterNative"><span class="hs-identifier hs-var">linkableFilterNative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkDeps -&gt; [Linkable]
</span><a href="GHC.Linker.Deps.html#ldNeededLinkables"><span class="hs-identifier hs-var">ldNeededLinkables</span></a></span><span> </span><span class="annot"><span class="annottext">LinkDeps
</span><a href="#local-6989586621683157882"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2878"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683157888"><span class="annot"><a href="#local-6989586621683157888"><span class="hs-identifier hs-var">objs_loaded'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683157889"><span class="annot"><a href="#local-6989586621683157889"><span class="hs-identifier hs-var">_new_objs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html#rmDupLinkables"><span class="hs-identifier hs-type">rmDupLinkables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Types.html#objs_loaded"><span class="hs-identifier hs-var">objs_loaded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157879"><span class="hs-identifier hs-type">pls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683157884"><span class="hs-identifier hs-type">objs</span></a></span><span>
</span><span id="line-2879"></span><span>
</span><span id="line-2880"></span><span>    </span><span class="hs-comment">-- FIXME: we should make the JS linker load new_objs here, instead of</span><span>
</span><span id="line-2881"></span><span>    </span><span class="hs-comment">-- on-demand.</span><span>
</span><span id="line-2882"></span><span>
</span><span id="line-2883"></span><span>    </span><span class="hs-comment">-- FIXME: we don't report needed units because we would have to find a way</span><span>
</span><span id="line-2884"></span><span>    </span><span class="hs-comment">-- to build a meaningful LoadedPkgInfo (see the mess in</span><span>
</span><span id="line-2885"></span><span>    </span><span class="hs-comment">-- GHC.Linker.Loader.{loadPackage,loadPackages'}). Detecting what to load</span><span>
</span><span id="line-2886"></span><span>    </span><span class="hs-comment">-- and actually loading (using the native interpreter) are intermingled, so</span><span>
</span><span id="line-2887"></span><span>    </span><span class="hs-comment">-- we can't directly reuse this code.</span><span>
</span><span id="line-2888"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157892"><span class="annot"><a href="#local-6989586621683157892"><span class="hs-identifier hs-var hs-var">pls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LoaderState
</span><a href="#local-6989586621683157879"><span class="hs-identifier hs-var">pls</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#objs_loaded"><span class="hs-identifier hs-var">objs_loaded</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683157888"><span class="hs-identifier hs-type">objs_loaded'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2889"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157892"><span class="hs-identifier hs-type">pls'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Deps.html#ldAllLinkables"><span class="hs-identifier hs-var">ldAllLinkables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157882"><span class="hs-identifier hs-type">deps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html#emptyUDFM"><span class="hs-identifier hs-type">emptyUDFM</span></a></span><span> </span><span class="hs-comment">{- ldNeededUnits deps -}</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2890"></span><span>
</span><span id="line-2891"></span><span>
</span><span id="line-2892"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157895"><span class="annot"><a href="#local-6989586621683157895"><span class="hs-identifier hs-var hs-var">foreign_stubs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="GHC.Types.ForeignStubs.html#NoStubs"><span class="hs-identifier hs-var">NoStubs</span></a></span><span>
</span><span id="line-2893"></span><span>      </span><span id="local-6989586621683157900"><span class="annot"><a href="#local-6989586621683157900"><span class="hs-identifier hs-var hs-var">spt_entries</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SptEntry]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2894"></span><span>      </span><span id="local-6989586621683157909"><span class="annot"><a href="#local-6989586621683157909"><span class="hs-identifier hs-var hs-var">cost_centre_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([CostCentre], [CostCentreStack])
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2895"></span><span>
</span><span id="line-2896"></span><span>  </span><span class="hs-comment">-- codegen into object file whose path is in out_obj</span><span>
</span><span id="line-2897"></span><span>  </span><span id="local-6989586621683157910"><span class="annot"><a href="#local-6989586621683157910"><span class="hs-identifier hs-var">out_obj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-type">newTempName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157858"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157859"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157862"><span class="hs-identifier hs-type">tmp_dir</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-type">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;o&quot;</span></span><span>
</span><span id="line-2898"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.CodeGen.html#stgToJS"><span class="hs-identifier hs-type">stgToJS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157858"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157864"><span class="hs-identifier hs-type">js_config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157865"><span class="hs-identifier hs-type">stg_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157855"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157900"><span class="hs-identifier hs-type">spt_entries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157895"><span class="hs-identifier hs-type">foreign_stubs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157909"><span class="hs-identifier hs-type">cost_centre_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157910"><span class="hs-identifier hs-type">out_obj</span></a></span><span>
</span><span id="line-2899"></span><span>
</span><span id="line-2900"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html#TxtI"><span class="hs-identifier hs-type">TxtI</span></a></span><span> </span><span id="local-6989586621683157914"><span class="annot"><a href="#local-6989586621683157914"><span class="hs-identifier hs-var">id_sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Ids.html#makeIdentForId"><span class="hs-identifier hs-type">makeIdentForId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157857"><span class="hs-identifier hs-type">binding_id</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#IdPlain"><span class="hs-identifier hs-type">IdPlain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157855"><span class="hs-identifier hs-type">this_mod</span></a></span><span>
</span><span id="line-2901"></span><span>  </span><span class="hs-comment">-- link code containing binding &quot;id_sym = expr&quot;, using id_sym as root</span><span>
</span><span id="line-2902"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#withJSInterp"><span class="hs-identifier hs-type">withJSInterp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157854"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683157918"><span class="annot"><span class="annottext">ExtInterpInstance JSInterpExtra
</span><a href="#local-6989586621683157918"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2903"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683157919"><span class="annot"><span class="annottext">roots :: [ExportedFun]
</span><a href="#local-6989586621683157919"><span class="hs-identifier hs-var hs-var">roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkExportedModFuns"><span class="hs-identifier hs-var">mkExportedModFuns</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683157855"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683157914"><span class="hs-identifier hs-var">id_sym</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2904"></span><span>    </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs
-&gt; TempDir
-&gt; StgToJSConfig
-&gt; UnitEnv
-&gt; ExtInterpInstance JSInterpExtra
-&gt; [Char]
-&gt; [ExportedFun]
-&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.JS.html#jsLinkObject"><span class="hs-identifier hs-var">jsLinkObject</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157858"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621683157859"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">TempDir
</span><a href="#local-6989586621683157862"><span class="hs-identifier hs-var">tmp_dir</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621683157864"><span class="hs-identifier hs-var">js_config</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683157863"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance JSInterpExtra
</span><a href="#local-6989586621683157918"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683157910"><span class="hs-identifier hs-var">out_obj</span></a></span><span> </span><span class="annot"><span class="annottext">[ExportedFun]
</span><a href="#local-6989586621683157919"><span class="hs-identifier hs-var">roots</span></a></span><span>
</span><span id="line-2905"></span><span>
</span><span id="line-2906"></span><span>  </span><span class="hs-comment">-- look up &quot;id_sym&quot; closure and create a StablePtr (HValue) from it</span><span>
</span><span id="line-2907"></span><span>  </span><span id="local-6989586621683157922"><span class="annot"><a href="#local-6989586621683157922"><span class="hs-identifier hs-var">href</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#lookupClosure"><span class="hs-identifier hs-type">lookupClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157861"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-type">unpackFS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157914"><span class="hs-identifier hs-type">id_sym</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2908"></span><span>    </span><span class="annot"><span class="annottext">Maybe HValueRef
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; IO HValueRef
forall a. HasCallStack =&gt; [Char] -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Couldn't find just linked TH closure&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683157914"><span class="hs-identifier hs-var">id_sym</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2909"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683157924"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621683157924"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HValueRef -&gt; IO HValueRef
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621683157924"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2910"></span><span>
</span><span id="line-2911"></span><span>  </span><span id="local-6989586621683157925"><span class="annot"><a href="#local-6989586621683157925"><span class="hs-identifier hs-var">binding_fref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#withJSInterp"><span class="hs-identifier hs-type">withJSInterp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157854"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683157926"><span class="annot"><span class="annottext">ExtInterpInstance JSInterpExtra
</span><a href="#local-6989586621683157926"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2912"></span><span>                    </span><span class="annot"><span class="annottext">HValueRef -&gt; IO () -&gt; IO ForeignHValue
forall a. RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#mkForeignRef"><span class="hs-identifier hs-var">mkForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621683157922"><span class="hs-identifier hs-var">href</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtInterpInstance JSInterpExtra -&gt; HValueRef -&gt; IO ()
forall d a. ExtInterpInstance d -&gt; RemoteRef a -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#freeReallyRemoteRef"><span class="hs-identifier hs-var">freeReallyRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance JSInterpExtra
</span><a href="#local-6989586621683157926"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621683157922"><span class="hs-identifier hs-var">href</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2913"></span><span>
</span><span id="line-2914"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#castForeignRef"><span class="hs-identifier hs-type">castForeignRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157925"><span class="hs-identifier hs-type">binding_fref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157876"><span class="hs-identifier hs-type">dep_linkables</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683157877"><span class="hs-identifier hs-type">dep_units</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2915"></span><span>
</span><span id="line-2916"></span><span>
</span><span id="line-2917"></span><span class="annot"><span class="hs-comment">{- **********************************************************************
%*                                                                      *
        Statistics on reading interfaces
%*                                                                      *
%********************************************************************* -}</span></span><span>
</span><span id="line-2922"></span><span>
</span><span id="line-2923"></span><span class="annot"><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-type">dumpIfaceStats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2924"></span><span id="dumpIfaceStats"><span class="annot"><span class="annottext">dumpIfaceStats :: HscEnv -&gt; IO ()
</span><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-var hs-var">dumpIfaceStats</span></a></span></span><span> </span><span id="local-6989586621683157930"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157930"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2925"></span><span>  </span><span id="local-6989586621683157931"><span class="annot"><a href="#local-6989586621683157931"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ExternalPackageState
</span><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157930"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2926"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-2927"></span><span>    </span><span id="local-6989586621683157932"><span class="annot"><a href="#local-6989586621683157932"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683157930"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2928"></span><span>    </span><span id="local-6989586621683157933"><span class="annot"><a href="#local-6989586621683157933"><span class="hs-identifier hs-var hs-var">dump_rn_stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-var">logHasDumpFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157932"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_stats"><span class="hs-identifier hs-var">Opt_D_dump_rn_stats</span></a></span><span>
</span><span id="line-2929"></span><span>    </span><span id="local-6989586621683157935"><span class="annot"><a href="#local-6989586621683157935"><span class="hs-identifier hs-var hs-var">dump_if_trace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-var">logHasDumpFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683157932"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_if_trace"><span class="hs-identifier hs-var">Opt_D_dump_if_trace</span></a></span><span>
</span><span id="line-2930"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683157935"><span class="hs-identifier hs-type">dump_if_trace</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621683157933"><span class="hs-identifier hs-type">dump_rn_stats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2931"></span><span>    </span><span class="annot"><a href="GHC.Utils.Logger.html#logDumpMsg"><span class="hs-identifier hs-type">logDumpMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157932"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Interface statistics&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Load.html#ifaceStats"><span class="hs-identifier hs-type">ifaceStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683157931"><span class="hs-identifier hs-type">eps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2932"></span><span>
</span><span id="line-2933"></span><span>
</span><span id="line-2934"></span><span class="annot"><span class="hs-comment">{- **********************************************************************
%*                                                                      *
        Progress Messages: Module i of n
%*                                                                      *
%********************************************************************* -}</span></span><span>
</span><span id="line-2939"></span><span>
</span><span id="line-2940"></span><span class="annot"><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier hs-type">showModuleIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2941"></span><span id="showModuleIndex"><span class="annot"><span class="annottext">showModuleIndex :: (Int, Int) -&gt; SDoc
</span><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier hs-var hs-var">showModuleIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683157937"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157937"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683157938"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157938"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683157939"><span class="hs-identifier hs-var">pad</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157937"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; of &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157938"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;] &quot;</span></span><span>
</span><span id="line-2942"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2943"></span><span>    </span><span class="hs-comment">-- compute the length of x &gt; 0 in base 10</span><span>
</span><span id="line-2944"></span><span>    </span><span id="local-6989586621683157978"><span class="annot"><span class="annottext">len :: a -&gt; b
</span><a href="#local-6989586621683157978"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span id="local-6989586621683157979"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683157979"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; b
forall b. Integral b =&gt; Float -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">ceiling</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">logBase</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">10</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683157979"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span>
</span><span id="line-2945"></span><span>    </span><span id="local-6989586621683157939"><span class="annot"><span class="annottext">pad :: SDoc
</span><a href="#local-6989586621683157939"><span class="hs-identifier hs-var hs-var">pad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; [Char]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall {b} {a}. (Integral b, Integral a) =&gt; a -&gt; b
</span><a href="#local-6989586621683157978"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157938"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall {b} {a}. (Integral b, Integral a) =&gt; a -&gt; b
</span><a href="#local-6989586621683157978"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683157937"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: use GHC.Utils.Ppr.RStr</span><span>
</span><span id="line-2946"></span><span>
</span><span id="line-2947"></span><span class="annot"><a href="GHC.Driver.Main.html#writeInterfaceOnlyMode"><span class="hs-identifier hs-type">writeInterfaceOnlyMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2948"></span><span id="writeInterfaceOnlyMode"><span class="annot"><span class="annottext">writeInterfaceOnlyMode :: DynFlags -&gt; Bool
</span><a href="GHC.Driver.Main.html#writeInterfaceOnlyMode"><span class="hs-identifier hs-var hs-var">writeInterfaceOnlyMode</span></a></span></span><span> </span><span id="local-6989586621683157984"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157984"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2949"></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteInterface"><span class="hs-identifier hs-var">Opt_WriteInterface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157984"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2950"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCode"><span class="hs-identifier hs-var">backendGeneratesCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683157984"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2951"></span></pre></body></html>