<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006-2008
(c) The GRASP/AQUA Project, Glasgow University, 1993-1998
-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | Module for constructing @ModIface@ values (interface files),</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- writing them to disk and comparing two versions to see if</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- recompilation is required.</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html"><span class="hs-identifier">GHC.Iface.Make</span></a></span><span>
</span><span id="line-13"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html#mkPartialIface"><span class="hs-identifier">mkPartialIface</span></a></span><span>
</span><span id="line-14"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier">mkFullIface</span></a></span><span>
</span><span id="line-15"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceTc"><span class="hs-identifier">mkIfaceTc</span></a></span><span>
</span><span id="line-16"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceExports"><span class="hs-identifier">mkIfaceExports</span></a></span><span>
</span><span id="line-17"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html"><span class="hs-identifier">GHC.Stg.InferTags.TagSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#StgCgInfos"><span class="hs-identifier">StgCgInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier">CmmCgInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Warnings.html"><span class="hs-identifier">GHC.Iface.Warnings</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Decl.html"><span class="hs-identifier">GHC.Iface.Decl</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html"><span class="hs-identifier">GHC.Iface.Syntax</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html"><span class="hs-identifier">GHC.Iface.Recomp</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Fields.html"><span class="hs-identifier">GHC.Iface.Ext.Fields</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CoreToIface.html"><span class="hs-identifier">GHC.CoreToIface</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Ppr.html"><span class="hs-identifier">GHC.Core.Ppr</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.RoughMap.html"><span class="hs-identifier">GHC.Core.RoughMap</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.RoughMap.html#RoughMatchTc"><span class="hs-identifier">RoughMatchTc</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.HsToCore.Usage.html"><span class="hs-identifier">GHC.Driver.Config.HsToCore.Usage</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html"><span class="hs-identifier">GHC.Driver.Backend</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html"><span class="hs-identifier">GHC.Types.Fixity.Env</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html"><span class="hs-identifier">GHC.Types.ForeignStubs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignStubs.html#ForeignStubs"><span class="hs-identifier">ForeignStubs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignStubs.html#NoStubs"><span class="hs-identifier">NoStubs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html"><span class="hs-identifier">GHC.Types.SafeHaskell</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html"><span class="hs-identifier">GHC.Types.Annotations</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html"><span class="hs-identifier">GHC.Types.Avail</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html"><span class="hs-identifier">GHC.Types.DefaultEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier">ClassDefaults</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier">DefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#defaultList"><span class="hs-identifier">defaultList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html"><span class="hs-identifier">GHC.Types.TypeEnv</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html"><span class="hs-identifier">GHC.Types.HpcInfo</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html"><span class="hs-identifier">GHC.Types.CompleteMatch</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html"><span class="hs-identifier">GHC.Types.Name.Cache</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html"><span class="hs-identifier">GHC.Utils.Binary</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html"><span class="hs-identifier">GHC.Iface.Binary</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Docs.html"><span class="hs-identifier">GHC.HsToCore.Docs</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Usage.html"><span class="hs-identifier">GHC.HsToCore.Usage</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html"><span class="hs-identifier">GHC.Unit.Module.Warnings</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html"><span class="hs-identifier">GHC.Unit.Module.ModDetails</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html"><span class="hs-identifier">GHC.Unit.Module.ModGuts</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html"><span class="hs-identifier">GHC.Unit.Module.ModSummary</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html"><span class="hs-identifier">GHC.Unit.Module.Deps</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html"><span class="hs-identifier">GHC.Unit.Module.WholeCoreBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.WholeCoreBindings.html#encodeIfaceForeign"><span class="hs-identifier">encodeIfaceForeign</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Completing an interface}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><a href="GHC.Iface.Make.html#mkPartialIface"><span class="hs-identifier hs-type">mkPartialIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-109"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-110"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-111"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-112"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier hs-type">ImportUserSpec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-114"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#PartialModIface"><span class="hs-identifier hs-type">PartialModIface</span></a></span><span>
</span><span id="line-115"></span><span id="mkPartialIface"><span class="annot"><span class="annottext">mkPartialIface :: HscEnv
-&gt; CoreProgram
-&gt; ModDetails
-&gt; ModSummary
-&gt; [ImportUserSpec]
-&gt; ModGuts
-&gt; PartialModIface
</span><a href="GHC.Iface.Make.html#mkPartialIface"><span class="hs-identifier hs-var hs-var">mkPartialIface</span></a></span></span><span> </span><span id="local-6989586621683145148"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145148"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683145149"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683145149"><span class="hs-identifier hs-var">core_prog</span></a></span></span><span> </span><span id="local-6989586621683145150"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683145150"><span class="hs-identifier hs-var">mod_details</span></a></span></span><span> </span><span id="local-6989586621683145151"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683145151"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683145152"><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683145152"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_module :: ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145155"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145155"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span>
</span><span id="line-117"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_hsc_src :: ModGuts -&gt; HscSource
</span><a href="GHC.Unit.Module.ModGuts.html#mg_hsc_src"><span class="hs-identifier hs-var">mg_hsc_src</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145157"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683145157"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span>
</span><span id="line-118"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_usages :: ModGuts -&gt; [Usage]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_usages"><span class="hs-identifier hs-var">mg_usages</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145159"><span class="annot"><span class="annottext">[Usage]
</span><a href="#local-6989586621683145159"><span class="hs-identifier hs-var">usages</span></a></span></span><span>
</span><span id="line-119"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_used_th :: ModGuts -&gt; Bool
</span><a href="GHC.Unit.Module.ModGuts.html#mg_used_th"><span class="hs-identifier hs-var">mg_used_th</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145161"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145161"><span class="hs-identifier hs-var">used_th</span></a></span></span><span>
</span><span id="line-120"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_deps :: ModGuts -&gt; Dependencies
</span><a href="GHC.Unit.Module.ModGuts.html#mg_deps"><span class="hs-identifier hs-var">mg_deps</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145163"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683145163"><span class="hs-identifier hs-var">deps</span></a></span></span><span>
</span><span id="line-121"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_rdr_env :: ModGuts -&gt; GlobalRdrEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rdr_env"><span class="hs-identifier hs-var">mg_rdr_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145165"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145165"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span>
</span><span id="line-122"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_fix_env :: ModGuts -&gt; FixityEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_fix_env"><span class="hs-identifier hs-var">mg_fix_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145167"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683145167"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span>
</span><span id="line-123"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_warns :: ModGuts -&gt; Warnings GhcRn
</span><a href="GHC.Unit.Module.ModGuts.html#mg_warns"><span class="hs-identifier hs-var">mg_warns</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145169"><span class="annot"><span class="annottext">Warnings GhcRn
</span><a href="#local-6989586621683145169"><span class="hs-identifier hs-var">warns</span></a></span></span><span>
</span><span id="line-124"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_hpc_info :: ModGuts -&gt; HpcInfo
</span><a href="GHC.Unit.Module.ModGuts.html#mg_hpc_info"><span class="hs-identifier hs-var">mg_hpc_info</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145171"><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621683145171"><span class="hs-identifier hs-var">hpc_info</span></a></span></span><span>
</span><span id="line-125"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_safe_haskell :: ModGuts -&gt; SafeHaskellMode
</span><a href="GHC.Unit.Module.ModGuts.html#mg_safe_haskell"><span class="hs-identifier hs-var">mg_safe_haskell</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145173"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683145173"><span class="hs-identifier hs-var">safe_mode</span></a></span></span><span>
</span><span id="line-126"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_trust_pkg :: ModGuts -&gt; Bool
</span><a href="GHC.Unit.Module.ModGuts.html#mg_trust_pkg"><span class="hs-identifier hs-var">mg_trust_pkg</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145175"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145175"><span class="hs-identifier hs-var">self_trust</span></a></span></span><span>
</span><span id="line-127"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_docs :: ModGuts -&gt; Maybe Docs
</span><a href="GHC.Unit.Module.ModGuts.html#mg_docs"><span class="hs-identifier hs-var">mg_docs</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145177"><span class="annot"><span class="annottext">Maybe Docs
</span><a href="#local-6989586621683145177"><span class="hs-identifier hs-var">docs</span></a></span></span><span>
</span><span id="line-128"></span><span>         </span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; CoreProgram
-&gt; HscSource
-&gt; Bool
-&gt; Dependencies
-&gt; GlobalRdrEnv
-&gt; [ImportUserSpec]
-&gt; FixityEnv
-&gt; Warnings GhcRn
-&gt; HpcInfo
-&gt; Bool
-&gt; SafeHaskellMode
-&gt; [Usage]
-&gt; Maybe Docs
-&gt; ModSummary
-&gt; ModDetails
-&gt; PartialModIface
</span><a href="GHC.Iface.Make.html#mkIface_"><span class="hs-identifier hs-var">mkIface_</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145155"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683145149"><span class="hs-identifier hs-var">core_prog</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683145157"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145161"><span class="hs-identifier hs-var">used_th</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683145163"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145165"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683145152"><span class="hs-identifier hs-var">import_decls</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683145167"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">Warnings GhcRn
</span><a href="#local-6989586621683145169"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621683145171"><span class="hs-identifier hs-var">hpc_info</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145175"><span class="hs-identifier hs-var">self_trust</span></a></span><span>
</span><span id="line-130"></span><span>             </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683145173"><span class="hs-identifier hs-var">safe_mode</span></a></span><span> </span><span class="annot"><span class="annottext">[Usage]
</span><a href="#local-6989586621683145159"><span class="hs-identifier hs-var">usages</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Docs
</span><a href="#local-6989586621683145177"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683145151"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683145150"><span class="hs-identifier hs-var">mod_details</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Fully instantiate an interface. Adds fingerprints and potentially code</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- generator produced information.</span><span>
</span><span id="line-134"></span><span class="hs-comment">--</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- CmmCgInfos is not available when not generating code (-fno-code), or when not</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- generating interface pragmas (-fomit-interface-pragmas). See also</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- Note [Conveying CAF-info and LFInfo between modules] in GHC.StgToCmm.Types.</span><span>
</span><span id="line-138"></span><span class="annot"><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier hs-type">mkFullIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#PartialModIface"><span class="hs-identifier hs-type">PartialModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#StgCgInfos"><span class="hs-identifier hs-type">StgCgInfos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForeignSrcLang</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-139"></span><span id="mkFullIface"><span class="annot"><span class="annottext">mkFullIface :: HscEnv
-&gt; PartialModIface
-&gt; Maybe StgCgInfos
-&gt; Maybe CmmCgInfos
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, FilePath)]
-&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier hs-var hs-var">mkFullIface</span></a></span></span><span> </span><span id="local-6989586621683145179"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145179"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683145180"><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621683145180"><span class="hs-identifier hs-var">partial_iface</span></a></span></span><span> </span><span id="local-6989586621683145181"><span class="annot"><span class="annottext">Maybe StgCgInfos
</span><a href="#local-6989586621683145181"><span class="hs-identifier hs-var">mb_stg_infos</span></a></span></span><span> </span><span id="local-6989586621683145182"><span class="annot"><span class="annottext">Maybe CmmCgInfos
</span><a href="#local-6989586621683145182"><span class="hs-identifier hs-var">mb_cmm_infos</span></a></span></span><span> </span><span id="local-6989586621683145183"><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683145183"><span class="hs-identifier hs-var">stubs</span></a></span></span><span> </span><span id="local-6989586621683145184"><span class="annot"><span class="annottext">[(ForeignSrcLang, FilePath)]
</span><a href="#local-6989586621683145184"><span class="hs-identifier hs-var">foreign_files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145185"><span class="annot"><span class="annottext">decls :: [IfaceDeclExts 'ModIfaceCore]
</span><a href="#local-6989586621683145185"><span class="hs-identifier hs-var hs-var hs-var">decls</span></a></span></span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_OmitInterfacePragmas"><span class="hs-identifier hs-var">Opt_OmitInterfacePragmas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145179"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialModIface -&gt; [IfaceDeclExts 'ModIfaceCore]
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; [IfaceDeclExts phase]
</span><a href="GHC.Unit.Module.ModIface.html#mi_decls"><span class="hs-identifier hs-var">mi_decls</span></a></span><span> </span><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621683145180"><span class="hs-identifier hs-var">partial_iface</span></a></span><span>
</span><span id="line-143"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-144"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IfaceDecl] -&gt; Maybe StgCgInfos -&gt; Maybe CmmCgInfos -&gt; [IfaceDecl]
</span><a href="GHC.Iface.Make.html#updateDecl"><span class="hs-identifier hs-var">updateDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartialModIface -&gt; [IfaceDeclExts 'ModIfaceCore]
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; [IfaceDeclExts phase]
</span><a href="GHC.Unit.Module.ModIface.html#mi_decls"><span class="hs-identifier hs-var">mi_decls</span></a></span><span> </span><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621683145180"><span class="hs-identifier hs-var">partial_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StgCgInfos
</span><a href="#local-6989586621683145181"><span class="hs-identifier hs-var">mb_stg_infos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CmmCgInfos
</span><a href="#local-6989586621683145182"><span class="hs-identifier hs-var">mb_cmm_infos</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">-- See Note [Foreign stubs and TH bytecode linking]</span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621683145191"><span class="annot"><a href="#local-6989586621683145191"><span class="hs-identifier hs-var">foreign_</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; DynFlags
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, FilePath)]
-&gt; IO IfaceForeign
</span><a href="GHC.Unit.Module.WholeCoreBindings.html#encodeIfaceForeign"><span class="hs-identifier hs-var">encodeIfaceForeign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145179"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145179"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621683145183"><span class="hs-identifier hs-var">stubs</span></a></span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, FilePath)]
</span><a href="#local-6989586621683145184"><span class="hs-identifier hs-var">foreign_files</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621683145193"><span class="annot"><a href="#local-6989586621683145193"><span class="hs-identifier hs-var">full_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;addFingerprints&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><a href="GHC.Iface.Recomp.html#addFingerprints"><span class="hs-identifier hs-type">addFingerprints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145179"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#set_mi_foreign"><span class="hs-identifier hs-type">set_mi_foreign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145191"><span class="hs-identifier hs-type">foreign_</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#set_mi_decls"><span class="hs-identifier hs-type">set_mi_decls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145185"><span class="hs-identifier hs-type">decls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145180"><span class="hs-identifier hs-type">partial_iface</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- Debug printing</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145197"><span class="annot"><a href="#local-6989586621683145197"><span class="hs-identifier hs-var hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145179"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145179"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_hi"><span class="hs-identifier hs-type">Opt_D_dump_hi</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;FINAL INTERFACE&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-type">FormatText</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Load.html#pprModIface"><span class="hs-identifier hs-type">pprModIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145197"><span class="hs-identifier hs-type">unit_state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145193"><span class="hs-identifier hs-type">full_iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621683145203"><span class="annot"><a href="#local-6989586621683145203"><span class="hs-identifier hs-var">final_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html#shareIface"><span class="hs-identifier hs-type">shareIface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_NC"><span class="hs-identifier hs-var">hsc_NC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145179"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Load.html#flagsToIfCompression"><span class="hs-identifier hs-type">flagsToIfCompression</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145179"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683145193"><span class="hs-identifier hs-type">full_iface</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683145203"><span class="hs-identifier hs-type">final_iface</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Compress an 'ModIface' and share as many values as possible, depending on the 'CompressionIFace' level.</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- See Note [Sharing of ModIface].</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- We compress the 'ModIface' by serialising the 'ModIface' to an in-memory byte array, and then deserialising it.</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- The deserialisation will deduplicate certain values depending on the 'CompressionIFace' level.</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- See Note [Deduplication during iface binary serialisation] for how we do that.</span><span>
</span><span id="line-166"></span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- Additionally, we cache the serialised byte array, so if the 'ModIface' is not modified</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- after calling 'shareIface', 'writeBinIface' will reuse that buffer without serialising the 'ModIface' again.</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- Modifying the 'ModIface' forces us to re-serialise it again.</span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.Iface.Make.html#shareIface"><span class="hs-identifier hs-type">shareIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-type">CompressionIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-171"></span><span id="shareIface"><span class="annot"><span class="annottext">shareIface :: NameCache -&gt; CompressionIFace -&gt; ModIface -&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#shareIface"><span class="hs-identifier hs-var hs-var">shareIface</span></a></span></span><span> </span><span class="annot"><span class="annottext">NameCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="GHC.Iface.Binary.html#NormalCompression"><span class="hs-identifier hs-var">NormalCompression</span></a></span><span> </span><span id="local-6989586621683145210"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683145210"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-comment">-- In 'NormalCompression', the sharing isn't reducing the memory usage, as 'Name's and 'FastString's are</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-comment">-- already shared, and at this compression level, we don't compress/share anything else.</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-comment">-- Thus, for a brief moment we simply double the memory residency for no reason.</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-comment">-- Therefore, we only try to share expensive values if the compression mode is higher than</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-comment">-- 'NormalCompression'</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><span class="annottext">ModIface -&gt; IO ModIface
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683145210"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-178"></span><span class="annot"><a href="GHC.Iface.Make.html#shareIface"><span class="hs-identifier hs-var">shareIface</span></a></span><span> </span><span id="local-6989586621683145211"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683145211"><span class="hs-identifier hs-var">nc</span></a></span></span><span> </span><span id="local-6989586621683145212"><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683145212"><span class="hs-identifier hs-var">compressionLevel</span></a></span></span><span>  </span><span id="local-6989586621683145213"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683145213"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>  </span><span id="local-6989586621683145214"><span class="annot"><a href="#local-6989586621683145214"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO WriteBinHandle
</span><a href="GHC.Utils.Binary.html#openBinMem"><span class="hs-identifier hs-var">openBinMem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Iface.Make.html#initBinMemSize"><span class="hs-identifier hs-var">initBinMemSize</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621683145217"><span class="annot"><a href="#local-6989586621683145217"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#tellBinWriter"><span class="hs-identifier hs-type">tellBinWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145214"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><a href="GHC.Iface.Binary.html#putIfaceWithExtFields"><span class="hs-identifier hs-type">putIfaceWithExtFields</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#QuietBinIFace"><span class="hs-identifier hs-type">QuietBinIFace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145212"><span class="hs-identifier hs-type">compressionLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145214"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145213"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621683145221"><span class="annot"><a href="#local-6989586621683145221"><span class="hs-identifier hs-var">rbh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#shrinkBinBuffer"><span class="hs-identifier hs-type">shrinkBinBuffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145214"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#seekBinReader"><span class="hs-identifier hs-type">seekBinReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145221"><span class="hs-identifier hs-type">rbh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145217"><span class="hs-identifier hs-type">start</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621683145224"><span class="annot"><a href="#local-6989586621683145224"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#getIfaceWithExtFields"><span class="hs-identifier hs-type">getIfaceWithExtFields</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145211"><span class="hs-identifier hs-type">nc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145221"><span class="hs-identifier hs-type">rbh</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145226"><span class="annot"><a href="#local-6989586621683145226"><span class="hs-identifier hs-var hs-var">resiface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModIface -&gt; ModIface
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#restoreFromOldModIface"><span class="hs-identifier hs-var">restoreFromOldModIface</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683145213"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683145224"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#forceModIface"><span class="hs-identifier hs-type">forceModIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145226"><span class="hs-identifier hs-type">resiface</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683145226"><span class="hs-identifier hs-type">resiface</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><span class="hs-comment">-- | Initial ram buffer to allocate for writing interface files.</span></span><span>
</span><span id="line-190"></span><span class="annot"><a href="GHC.Iface.Make.html#initBinMemSize"><span class="hs-identifier hs-type">initBinMemSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-191"></span><span id="initBinMemSize"><span class="annot"><span class="annottext">initBinMemSize :: Int
</span><a href="GHC.Iface.Make.html#initBinMemSize"><span class="hs-identifier hs-var hs-var">initBinMemSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span> </span><span class="hs-comment">-- 1 MB</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="GHC.Iface.Make.html#updateDecl"><span class="hs-identifier hs-type">updateDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#StgCgInfos"><span class="hs-identifier hs-type">StgCgInfos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span id="updateDecl"><span class="annot"><span class="annottext">updateDecl :: [IfaceDecl] -&gt; Maybe StgCgInfos -&gt; Maybe CmmCgInfos -&gt; [IfaceDecl]
</span><a href="GHC.Iface.Make.html#updateDecl"><span class="hs-identifier hs-var hs-var">updateDecl</span></a></span></span><span> </span><span id="local-6989586621683145230"><span class="annot"><span class="annottext">[IfaceDecl]
</span><a href="#local-6989586621683145230"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe StgCgInfos
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe CmmCgInfos
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IfaceDecl]
</span><a href="#local-6989586621683145230"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-195"></span><span class="annot"><a href="GHC.Iface.Make.html#updateDecl"><span class="hs-identifier hs-var">updateDecl</span></a></span><span> </span><span id="local-6989586621683145231"><span class="annot"><span class="annottext">[IfaceDecl]
</span><a href="#local-6989586621683145231"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span id="local-6989586621683145232"><span class="annot"><span class="annottext">Maybe StgCgInfos
</span><a href="#local-6989586621683145232"><span class="hs-identifier hs-var">m_stg_infos</span></a></span></span><span> </span><span id="local-6989586621683145233"><span class="annot"><span class="annottext">Maybe CmmCgInfos
</span><a href="#local-6989586621683145233"><span class="hs-identifier hs-var">m_cmm_infos</span></a></span></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IfaceDecl -&gt; IfaceDecl) -&gt; [IfaceDecl] -&gt; [IfaceDecl]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">IfaceDecl -&gt; IfaceDecl
</span><a href="#local-6989586621683145234"><span class="hs-identifier hs-var">update_decl</span></a></span><span> </span><span class="annot"><span class="annottext">[IfaceDecl]
</span><a href="#local-6989586621683145231"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683145235"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683145235"><span class="hs-identifier hs-var">non_cafs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683145236"><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621683145236"><span class="hs-identifier hs-var">lf_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NameSet, ModuleLFInfos)
-&gt; (CmmCgInfos -&gt; (NameSet, ModuleLFInfos))
-&gt; Maybe CmmCgInfos
-&gt; (NameSet, ModuleLFInfos)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>                                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683145238"><span class="annot"><span class="annottext">CmmCgInfos
</span><a href="#local-6989586621683145238"><span class="hs-identifier hs-var">cmm_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonCaffySet -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#ncs_nameSet"><span class="hs-identifier hs-var">ncs_nameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmCgInfos -&gt; NonCaffySet
</span><a href="GHC.StgToCmm.Types.html#cgNonCafs"><span class="hs-identifier hs-var">cgNonCafs</span></a></span><span> </span><span class="annot"><span class="annottext">CmmCgInfos
</span><a href="#local-6989586621683145238"><span class="hs-identifier hs-var">cmm_info</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmCgInfos -&gt; ModuleLFInfos
</span><a href="GHC.StgToCmm.Types.html#cgLFInfos"><span class="hs-identifier hs-var">cgLFInfos</span></a></span><span> </span><span class="annot"><span class="annottext">CmmCgInfos
</span><a href="#local-6989586621683145238"><span class="hs-identifier hs-var">cmm_info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>                                </span><span class="annot"><span class="annottext">Maybe CmmCgInfos
</span><a href="#local-6989586621683145233"><span class="hs-identifier hs-var">m_cmm_infos</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621683145242"><span class="annot"><span class="annottext">tag_sigs :: StgCgInfos
</span><a href="#local-6989586621683145242"><span class="hs-identifier hs-var hs-var">tag_sigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgCgInfos -&gt; Maybe StgCgInfos -&gt; StgCgInfos
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">StgCgInfos
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Maybe StgCgInfos
</span><a href="#local-6989586621683145232"><span class="hs-identifier hs-var">m_stg_infos</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621683145234"><span class="annot"><span class="annottext">update_decl :: IfaceDecl -&gt; IfaceDecl
</span><a href="#local-6989586621683145234"><span class="hs-identifier hs-var hs-var">update_decl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceId"><span class="hs-identifier hs-type">IfaceId</span></a></span><span> </span><span id="local-6989586621683145245"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145245"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621683145246"><span class="annot"><span class="annottext">IfaceType
</span><a href="#local-6989586621683145246"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683145247"><span class="annot"><span class="annottext">IfaceIdDetails
</span><a href="#local-6989586621683145247"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span id="local-6989586621683145248"><span class="annot"><span class="annottext">IfaceIdInfo
</span><a href="#local-6989586621683145248"><span class="hs-identifier hs-var">infos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145249"><span class="annot"><span class="annottext">not_caffy :: Bool
</span><a href="#local-6989586621683145249"><span class="hs-identifier hs-var hs-var">not_caffy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145245"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683145235"><span class="hs-identifier hs-var">non_cafs</span></a></span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145251"><span class="annot"><span class="annottext">mb_lf_info :: Maybe LambdaFormInfo
</span><a href="#local-6989586621683145251"><span class="hs-identifier hs-var hs-var">mb_lf_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos -&gt; Name -&gt; Maybe LambdaFormInfo
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621683145236"><span class="hs-identifier hs-var">lf_infos</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145245"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145253"><span class="annot"><span class="annottext">sig :: Maybe TagSig
</span><a href="#local-6989586621683145253"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgCgInfos -&gt; Name -&gt; Maybe TagSig
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">StgCgInfos
</span><a href="#local-6989586621683145242"><span class="hs-identifier hs-var">tag_sigs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145245"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; FilePath -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#warnPprTrace"><span class="hs-identifier hs-var">warnPprTrace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe LambdaFormInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe LambdaFormInfo
</span><a href="#local-6989586621683145251"><span class="hs-identifier hs-var">mb_lf_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;updateDecl&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Name without LFInfo:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145245"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-comment">-- Only allocate a new IfaceId if we're going to update the infos</span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe LambdaFormInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe LambdaFormInfo
</span><a href="#local-6989586621683145251"><span class="hs-identifier hs-var">mb_lf_info</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145249"><span class="hs-identifier hs-var">not_caffy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe TagSig -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe TagSig
</span><a href="#local-6989586621683145253"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IfaceType -&gt; IfaceIdDetails -&gt; IfaceIdInfo -&gt; IfaceDecl
</span><a href="GHC.Iface.Syntax.html#IfaceId"><span class="hs-identifier hs-var">IfaceId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145245"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">IfaceType
</span><a href="#local-6989586621683145246"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">IfaceIdDetails
</span><a href="#local-6989586621683145247"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">(IfaceIdInfo -&gt; IfaceDecl) -&gt; IfaceIdInfo -&gt; IfaceDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145249"><span class="hs-identifier hs-var">not_caffy</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfaceInfoItem
</span><a href="GHC.Iface.Syntax.html#HsNoCafRefs"><span class="hs-identifier hs-var">HsNoCafRefs</span></a></span><span> </span><span class="annot"><span class="annottext">IfaceInfoItem -&gt; IfaceIdInfo -&gt; IfaceIdInfo
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IfaceIdInfo -&gt; IfaceIdInfo
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IfaceIdInfo -&gt; IfaceIdInfo) -&gt; IfaceIdInfo -&gt; IfaceIdInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe TagSig -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe TagSig
</span><a href="#local-6989586621683145253"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagSig -&gt; IfaceInfoItem
</span><a href="GHC.Iface.Syntax.html#HsTagSig"><span class="hs-identifier hs-var">HsTagSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TagSig -&gt; TagSig
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe TagSig
</span><a href="#local-6989586621683145253"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">IfaceInfoItem -&gt; IfaceIdInfo -&gt; IfaceIdInfo
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IfaceIdInfo -&gt; IfaceIdInfo
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IfaceIdInfo -&gt; IfaceIdInfo) -&gt; IfaceIdInfo -&gt; IfaceIdInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe LambdaFormInfo
</span><a href="#local-6989586621683145251"><span class="hs-identifier hs-var">mb_lf_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-214"></span><span>             </span><span class="annot"><span class="annottext">Maybe LambdaFormInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IfaceIdInfo
</span><a href="#local-6989586621683145248"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="hs-comment">-- LFInfos not available when building .cmm files</span><span>
</span><span id="line-215"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683145265"><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621683145265"><span class="hs-identifier hs-var">lf_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IfaceLFInfo -&gt; IfaceInfoItem
</span><a href="GHC.Iface.Syntax.html#HsLFInfo"><span class="hs-identifier hs-var">HsLFInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LambdaFormInfo -&gt; IfaceLFInfo
</span><a href="GHC.CoreToIface.html#toIfaceLFInfo"><span class="hs-identifier hs-var">toIfaceLFInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145245"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621683145265"><span class="hs-identifier hs-var">lf_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfaceInfoItem -&gt; IfaceIdInfo -&gt; IfaceIdInfo
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">IfaceIdInfo
</span><a href="#local-6989586621683145248"><span class="hs-identifier hs-var">infos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="#local-6989586621683145234"><span class="hs-identifier hs-var">update_decl</span></a></span><span> </span><span id="local-6989586621683145268"><span class="annot"><span class="annottext">IfaceDecl
</span><a href="#local-6989586621683145268"><span class="hs-identifier hs-var">decl</span></a></span></span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceDecl
</span><a href="#local-6989586621683145268"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Make an interface from the results of typechecking only.  Useful</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- for non-optimising compilation, or where we aren't generating any</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- object code at all ('NoBackend').</span><span>
</span><span id="line-226"></span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceTc"><span class="hs-identifier hs-type">mkIfaceTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-227"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span>    </span><span class="hs-comment">-- The safe haskell mode</span><span>
</span><span id="line-228"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>         </span><span class="hs-comment">-- gotten from mkBootModDetails, probably</span><span>
</span><span id="line-229"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-230"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>           </span><span class="hs-comment">-- Usages, deprecations, etc</span><span>
</span><span id="line-232"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-233"></span><span id="mkIfaceTc"><span class="annot"><span class="annottext">mkIfaceTc :: HscEnv
-&gt; SafeHaskellMode
-&gt; ModDetails
-&gt; ModSummary
-&gt; Maybe CoreProgram
-&gt; TcGblEnv
-&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#mkIfaceTc"><span class="hs-identifier hs-var hs-var">mkIfaceTc</span></a></span></span><span> </span><span id="local-6989586621683145269"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683145270"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683145270"><span class="hs-identifier hs-var">safe_mode</span></a></span></span><span> </span><span id="local-6989586621683145271"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683145271"><span class="hs-identifier hs-var">mod_details</span></a></span></span><span> </span><span id="local-6989586621683145272"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683145272"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621683145273"><span class="annot"><span class="annottext">Maybe CoreProgram
</span><a href="#local-6989586621683145273"><span class="hs-identifier hs-var">mb_program</span></a></span></span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621683145274"><span class="annot"><span class="annottext">tc_result :: TcGblEnv
</span><a href="#local-6989586621683145274"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_mod :: TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145277"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145277"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-235"></span><span>                      </span><span class="annot"><span class="annottext">tcg_src :: TcGblEnv -&gt; HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var">tcg_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145279"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683145279"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-236"></span><span>                      </span><span class="annot"><span class="annottext">tcg_imports :: TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145281"><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683145281"><span class="hs-identifier hs-var">imports</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>                      </span><span class="annot"><span class="annottext">tcg_import_decls :: TcGblEnv -&gt; [ImportUserSpec]
</span><a href="GHC.Tc.Types.html#tcg_import_decls"><span class="hs-identifier hs-var">tcg_import_decls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145283"><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683145283"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-238"></span><span>                      </span><span class="annot"><span class="annottext">tcg_rdr_env :: TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145285"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145285"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>                      </span><span class="annot"><span class="annottext">tcg_fix_env :: TcGblEnv -&gt; FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145287"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683145287"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-240"></span><span>                      </span><span class="annot"><span class="annottext">tcg_merged :: TcGblEnv -&gt; [(Module, Fingerprint)]
</span><a href="GHC.Tc.Types.html#tcg_merged"><span class="hs-identifier hs-var">tcg_merged</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145289"><span class="annot"><span class="annottext">[(Module, Fingerprint)]
</span><a href="#local-6989586621683145289"><span class="hs-identifier hs-var">merged</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-241"></span><span>                      </span><span class="annot"><span class="annottext">tcg_warns :: TcGblEnv -&gt; Warnings GhcRn
</span><a href="GHC.Tc.Types.html#tcg_warns"><span class="hs-identifier hs-var">tcg_warns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145291"><span class="annot"><span class="annottext">Warnings GhcRn
</span><a href="#local-6989586621683145291"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-242"></span><span>                      </span><span class="annot"><span class="annottext">tcg_hpc :: TcGblEnv -&gt; Bool
</span><a href="GHC.Tc.Types.html#tcg_hpc"><span class="hs-identifier hs-var">tcg_hpc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145293"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145293"><span class="hs-identifier hs-var">other_hpc_info</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>                      </span><span class="annot"><span class="annottext">tcg_th_splice_used :: TcGblEnv -&gt; TcRef Bool
</span><a href="GHC.Tc.Types.html#tcg_th_splice_used"><span class="hs-identifier hs-var">tcg_th_splice_used</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145295"><span class="annot"><span class="annottext">TcRef Bool
</span><a href="#local-6989586621683145295"><span class="hs-identifier hs-var">tc_splice_used</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>                      </span><span class="annot"><span class="annottext">tcg_dependent_files :: TcGblEnv -&gt; TcRef [FilePath]
</span><a href="GHC.Tc.Types.html#tcg_dependent_files"><span class="hs-identifier hs-var">tcg_dependent_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145297"><span class="annot"><span class="annottext">TcRef [FilePath]
</span><a href="#local-6989586621683145297"><span class="hs-identifier hs-var">dependent_files</span></a></span></span><span>
</span><span id="line-245"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145298"><span class="annot"><span class="annottext">used_names :: NameSet
</span><a href="#local-6989586621683145298"><span class="hs-identifier hs-var hs-var hs-var">used_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; NameSet
</span><a href="GHC.HsToCore.Usage.html#mkUsedNames"><span class="hs-identifier hs-var">mkUsedNames</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683145274"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-248"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145300"><span class="annot"><span class="annottext">pluginModules :: [ModIface]
</span><a href="#local-6989586621683145300"><span class="hs-identifier hs-var hs-var hs-var">pluginModules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LoadedPlugin -&gt; ModIface) -&gt; [LoadedPlugin] -&gt; [ModIface]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin -&gt; ModIface
</span><a href="GHC.Driver.Plugins.html#lpModule"><span class="hs-identifier hs-var">lpModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Plugins -&gt; [LoadedPlugin]
</span><a href="GHC.Driver.Plugins.html#loadedPlugins"><span class="hs-identifier hs-var">loadedPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145304"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621683145304"><span class="hs-identifier hs-var hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-250"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145306"><span class="annot"><span class="annottext">deps :: Dependencies
</span><a href="#local-6989586621683145306"><span class="hs-identifier hs-var hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; Module -&gt; ImportAvails -&gt; [Module] -&gt; Dependencies
</span><a href="GHC.Unit.Module.Deps.html#mkDependencies"><span class="hs-identifier hs-var">mkDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683145304"><span class="hs-identifier hs-var">home_unit</span></a></span><span>
</span><span id="line-251"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683145274"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683145274"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModIface -&gt; Module) -&gt; [ModIface] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">[ModIface]
</span><a href="#local-6989586621683145300"><span class="hs-identifier hs-var">pluginModules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145309"><span class="annot"><span class="annottext">hpc_info :: HpcInfo
</span><a href="#local-6989586621683145309"><span class="hs-identifier hs-var hs-var hs-var">hpc_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HpcInfo
</span><a href="GHC.Types.HpcInfo.html#emptyHpcInfo"><span class="hs-identifier hs-var">emptyHpcInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145293"><span class="hs-identifier hs-var">other_hpc_info</span></a></span><span>
</span><span id="line-255"></span><span>          </span><span id="local-6989586621683145311"><span class="annot"><a href="#local-6989586621683145311"><span class="hs-identifier hs-var">used_th</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef Bool -&gt; IO Bool
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">TcRef Bool
</span><a href="#local-6989586621683145295"><span class="hs-identifier hs-var">tc_splice_used</span></a></span><span>
</span><span id="line-256"></span><span>          </span><span id="local-6989586621683145313"><span class="annot"><a href="#local-6989586621683145313"><span class="hs-identifier hs-var">dep_files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683145297"><span class="hs-identifier hs-type">dependent_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683145314"><span class="annot"><a href="#local-6989586621683145314"><span class="hs-identifier hs-var">needed_links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683145315"><span class="annot"><a href="#local-6989586621683145315"><span class="hs-identifier hs-var">needed_pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_needed_deps"><span class="hs-identifier hs-var">tcg_th_needed_deps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145274"><span class="hs-identifier hs-type">tc_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145317"><span class="annot"><a href="#local-6989586621683145317"><span class="hs-identifier hs-var hs-var">uc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UsageConfig
</span><a href="GHC.Driver.Config.HsToCore.Usage.html#initUsageConfig"><span class="hs-identifier hs-var">initUsageConfig</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-259"></span><span>              </span><span id="local-6989586621683145319"><span class="annot"><a href="#local-6989586621683145319"><span class="hs-identifier hs-var hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-260"></span><span>              </span><span id="local-6989586621683145320"><span class="annot"><a href="#local-6989586621683145320"><span class="hs-identifier hs-var hs-var">fc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-261"></span><span>              </span><span id="local-6989586621683145322"><span class="annot"><a href="#local-6989586621683145322"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-262"></span><span>          </span><span class="hs-comment">-- Do NOT use semantic module here; this_mod in mkUsageInfo</span><span>
</span><span id="line-263"></span><span>          </span><span class="hs-comment">-- is used solely to decide if we should record a dependency</span><span>
</span><span id="line-264"></span><span>          </span><span class="hs-comment">-- or not.  When we instantiate a signature, the semantic</span><span>
</span><span id="line-265"></span><span>          </span><span class="hs-comment">-- module is something we want to record dependencies for,</span><span>
</span><span id="line-266"></span><span>          </span><span class="hs-comment">-- but if you pass that in here, we'll decide it's the local</span><span>
</span><span id="line-267"></span><span>          </span><span class="hs-comment">-- module and does not need to be recorded as a dependency.</span><span>
</span><span id="line-268"></span><span>          </span><span class="hs-comment">-- See Note [Identity versus semantic module]</span><span>
</span><span id="line-269"></span><span>          </span><span id="local-6989586621683145324"><span class="annot"><a href="#local-6989586621683145324"><span class="hs-identifier hs-var">usages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier hs-type">initIfaceLoad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145269"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Usage.html#mkUsageInfo"><span class="hs-identifier hs-type">mkUsageInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145317"><span class="hs-identifier hs-type">uc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145319"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145320"><span class="hs-identifier hs-type">fc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145322"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145277"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_mods"><span class="hs-identifier hs-var">imp_mods</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145281"><span class="hs-identifier hs-type">imports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683145298"><span class="hs-identifier hs-type">used_names</span></a></span><span>
</span><span id="line-270"></span><span>                      </span><span class="annot"><a href="#local-6989586621683145313"><span class="hs-identifier hs-type">dep_files</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145289"><span class="hs-identifier hs-type">merged</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145314"><span class="hs-identifier hs-type">needed_links</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145315"><span class="hs-identifier hs-type">needed_pkgs</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>          </span><span id="local-6989586621683145328"><span class="annot"><a href="#local-6989586621683145328"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Docs.html#extractDocs"><span class="hs-identifier hs-type">extractDocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145272"><span class="hs-identifier hs-type">mod_summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683145274"><span class="hs-identifier hs-type">tc_result</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145331"><span class="annot"><a href="#local-6989586621683145331"><span class="hs-identifier hs-var hs-var">partial_iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; CoreProgram
-&gt; HscSource
-&gt; Bool
-&gt; Dependencies
-&gt; GlobalRdrEnv
-&gt; [ImportUserSpec]
-&gt; FixityEnv
-&gt; Warnings GhcRn
-&gt; HpcInfo
-&gt; Bool
-&gt; SafeHaskellMode
-&gt; [Usage]
-&gt; Maybe Docs
-&gt; ModSummary
-&gt; ModDetails
-&gt; PartialModIface
</span><a href="GHC.Iface.Make.html#mkIface_"><span class="hs-identifier hs-var">mkIface_</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145269"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-275"></span><span>                   </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145277"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreProgram -&gt; Maybe CoreProgram -&gt; CoreProgram
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe CoreProgram
</span><a href="#local-6989586621683145273"><span class="hs-identifier hs-var">mb_program</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683145279"><span class="hs-identifier hs-var">hsc_src</span></a></span><span>
</span><span id="line-276"></span><span>                   </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145311"><span class="hs-identifier hs-var">used_th</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683145306"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145285"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683145283"><span class="hs-identifier hs-var">import_decls</span></a></span><span>
</span><span id="line-277"></span><span>                   </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683145287"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">Warnings GhcRn
</span><a href="#local-6989586621683145291"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621683145309"><span class="hs-identifier hs-var">hpc_info</span></a></span><span>
</span><span id="line-278"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportAvails -&gt; Bool
</span><a href="GHC.Unit.Module.Deps.html#imp_trust_own_pkg"><span class="hs-identifier hs-var">imp_trust_own_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683145281"><span class="hs-identifier hs-var">imports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683145270"><span class="hs-identifier hs-var">safe_mode</span></a></span><span> </span><span class="annot"><span class="annottext">[Usage]
</span><a href="#local-6989586621683145324"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-279"></span><span>                   </span><span class="annot"><span class="annottext">Maybe Docs
</span><a href="#local-6989586621683145328"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683145272"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-280"></span><span>                   </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683145271"><span class="hs-identifier hs-var">mod_details</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier hs-type">mkFullIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145269"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683145331"><span class="hs-identifier hs-type">partial_iface</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#NoStubs"><span class="hs-identifier hs-type">NoStubs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="GHC.Iface.Make.html#mkIface_"><span class="hs-identifier hs-type">mkIface_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-285"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier hs-type">ImportUserSpec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a></span><span>
</span><span id="line-287"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-288"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span>
</span><span id="line-289"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#Usage"><span class="hs-identifier hs-type">Usage</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Hs.Doc.html#Docs"><span class="hs-identifier hs-type">Docs</span></a></span><span>
</span><span id="line-291"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-292"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-293"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#PartialModIface"><span class="hs-identifier hs-type">PartialModIface</span></a></span><span>
</span><span id="line-294"></span><span id="mkIface_"><span class="annot"><span class="annottext">mkIface_ :: HscEnv
-&gt; Module
-&gt; CoreProgram
-&gt; HscSource
-&gt; Bool
-&gt; Dependencies
-&gt; GlobalRdrEnv
-&gt; [ImportUserSpec]
-&gt; FixityEnv
-&gt; Warnings GhcRn
-&gt; HpcInfo
-&gt; Bool
-&gt; SafeHaskellMode
-&gt; [Usage]
-&gt; Maybe Docs
-&gt; ModSummary
-&gt; ModDetails
-&gt; PartialModIface
</span><a href="GHC.Iface.Make.html#mkIface_"><span class="hs-identifier hs-var hs-var">mkIface_</span></a></span></span><span> </span><span id="local-6989586621683145333"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145333"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-295"></span><span>         </span><span id="local-6989586621683145334"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145334"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621683145335"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683145335"><span class="hs-identifier hs-var">core_prog</span></a></span></span><span> </span><span id="local-6989586621683145336"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683145336"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span> </span><span id="local-6989586621683145337"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145337"><span class="hs-identifier hs-var">used_th</span></a></span></span><span> </span><span id="local-6989586621683145338"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683145338"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621683145339"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145339"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621683145340"><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683145340"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span> </span><span id="local-6989586621683145341"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683145341"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span id="local-6989586621683145342"><span class="annot"><span class="annottext">Warnings GhcRn
</span><a href="#local-6989586621683145342"><span class="hs-identifier hs-var">src_warns</span></a></span></span><span>
</span><span id="line-296"></span><span>         </span><span id="local-6989586621683145343"><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621683145343"><span class="hs-identifier hs-var">hpc_info</span></a></span></span><span> </span><span id="local-6989586621683145344"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145344"><span class="hs-identifier hs-var">pkg_trust_req</span></a></span></span><span> </span><span id="local-6989586621683145345"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683145345"><span class="hs-identifier hs-var">safe_mode</span></a></span></span><span> </span><span id="local-6989586621683145346"><span class="annot"><span class="annottext">[Usage]
</span><a href="#local-6989586621683145346"><span class="hs-identifier hs-var">usages</span></a></span></span><span>
</span><span id="line-297"></span><span>         </span><span id="local-6989586621683145347"><span class="annot"><span class="annottext">Maybe Docs
</span><a href="#local-6989586621683145347"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span id="local-6989586621683145348"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683145348"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span>
</span><span id="line-298"></span><span>         </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span class="hs-special">{</span><span>  </span><span class="annot"><span class="annottext">md_defaults :: ModDetails -&gt; DefaultEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_defaults"><span class="hs-identifier hs-var">md_defaults</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145351"><span class="annot"><span class="annottext">DefaultEnv
</span><a href="#local-6989586621683145351"><span class="hs-identifier hs-var">defaults</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-299"></span><span>                      </span><span class="annot"><span class="annottext">md_insts :: ModDetails -&gt; InstEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_insts"><span class="hs-identifier hs-var">md_insts</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145353"><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683145353"><span class="hs-identifier hs-var">insts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>                      </span><span class="annot"><span class="annottext">md_fam_insts :: ModDetails -&gt; [FamInst]
</span><a href="GHC.Unit.Module.ModDetails.html#md_fam_insts"><span class="hs-identifier hs-var">md_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145355"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683145355"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>                      </span><span class="annot"><span class="annottext">md_rules :: ModDetails -&gt; [CoreRule]
</span><a href="GHC.Unit.Module.ModDetails.html#md_rules"><span class="hs-identifier hs-var">md_rules</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145357"><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621683145357"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>                      </span><span class="annot"><span class="annottext">md_anns :: ModDetails -&gt; [Annotation]
</span><a href="GHC.Unit.Module.ModDetails.html#md_anns"><span class="hs-identifier hs-var">md_anns</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145359"><span class="annot"><span class="annottext">[Annotation]
</span><a href="#local-6989586621683145359"><span class="hs-identifier hs-var">anns</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>                      </span><span class="annot"><span class="annottext">md_types :: ModDetails -&gt; TypeEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_types"><span class="hs-identifier hs-var">md_types</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145361"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683145361"><span class="hs-identifier hs-var">type_env</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>                      </span><span class="annot"><span class="annottext">md_exports :: ModDetails -&gt; [AvailInfo]
</span><a href="GHC.Unit.Module.ModDetails.html#md_exports"><span class="hs-identifier hs-var">md_exports</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145363"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683145363"><span class="hs-identifier hs-var">exports</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-305"></span><span>                      </span><span class="annot"><span class="annottext">md_complete_matches :: ModDetails -&gt; CompleteMatches
</span><a href="GHC.Unit.Module.ModDetails.html#md_complete_matches"><span class="hs-identifier hs-var">md_complete_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145365"><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621683145365"><span class="hs-identifier hs-var">complete_matches</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- NB:  notice that mkIface does not look at the bindings</span><span>
</span><span id="line-307"></span><span class="hs-comment">--      only at the TypeEnv.  The previous Tidy phase has</span><span>
</span><span id="line-308"></span><span class="hs-comment">--      put exactly the info into the TypeEnv that we want</span><span>
</span><span id="line-309"></span><span class="hs-comment">--      to expose in the interface</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145366"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621683145366"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145333"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span id="local-6989586621683145367"><span class="annot"><span class="annottext">semantic_mod :: Module
</span><a href="#local-6989586621683145367"><span class="hs-identifier hs-var hs-var">semantic_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#homeModuleNameInstantiation"><span class="hs-identifier hs-var">homeModuleNameInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683145366"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145334"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>        </span><span id="local-6989586621683145370"><span class="annot"><span class="annottext">entities :: [TyThing]
</span><a href="#local-6989586621683145370"><span class="hs-identifier hs-var hs-var">entities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [TyThing]
</span><a href="GHC.Types.TypeEnv.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683145361"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-315"></span><span>        </span><span id="local-6989586621683145372"><span class="annot"><span class="annottext">show_linear_types :: Bool
</span><a href="#local-6989586621683145372"><span class="hs-identifier hs-var hs-var">show_linear_types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.LinearTypes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145333"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621683145375"><span class="annot"><span class="annottext">extra_decls :: Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="#local-6989586621683145375"><span class="hs-identifier hs-var hs-var">extra_decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteIfSimplifiedCore"><span class="hs-identifier hs-var">Opt_WriteIfSimplifiedCore</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683145377"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
-&gt; Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo
</span><a href="GHC.CoreToIface.html#toIfaceTopBind"><span class="hs-identifier hs-var">toIfaceTopBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621683145379"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683145379"><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621683145379"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683145335"><span class="hs-identifier hs-var">core_prog</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-318"></span><span>                                                               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621683145380"><span class="annot"><span class="annottext">decls :: [IfaceDecl]
</span><a href="#local-6989586621683145380"><span class="hs-identifier hs-var hs-var">decls</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TyThing -&gt; IfaceDecl
</span><a href="GHC.Iface.Decl.html#tyThingToIfaceDecl"><span class="hs-identifier hs-var">tyThingToIfaceDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145372"><span class="hs-identifier hs-var">show_linear_types</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683145382"><span class="hs-identifier hs-var">entity</span></a></span><span>
</span><span id="line-320"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683145382"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683145382"><span class="hs-identifier hs-var">entity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621683145370"><span class="hs-identifier hs-var">entities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-321"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683145383"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683145383"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683145382"><span class="hs-identifier hs-var">entity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; Bool
</span><a href="GHC.Types.TyThing.html#isImplicitTyThing"><span class="hs-identifier hs-var">isImplicitTyThing</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683145382"><span class="hs-identifier hs-var">entity</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>                      </span><span class="hs-comment">-- No implicit Ids and class tycons in the interface file</span><span>
</span><span id="line-324"></span><span>                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isWiredInName"><span class="hs-identifier hs-var">isWiredInName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145383"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>                      </span><span class="hs-comment">-- Nor wired-in things; the compiler knows about them anyhow</span><span>
</span><span id="line-326"></span><span>                   </span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145367"><span class="hs-identifier hs-var">semantic_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145383"><span class="hs-identifier hs-var">name</span></a></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-327"></span><span>                      </span><span class="hs-comment">-- Sigh: see Note [Root-main Id] in GHC.Tc.Module</span><span>
</span><span id="line-328"></span><span>                      </span><span class="hs-comment">-- NB: ABSOLUTELY need to check against semantic_mod,</span><span>
</span><span id="line-329"></span><span>                      </span><span class="hs-comment">-- because all of the names in an hsig p[H=&lt;H&gt;]:H</span><span>
</span><span id="line-330"></span><span>                      </span><span class="hs-comment">-- are going to be for &lt;H&gt;, not the former id!</span><span>
</span><span id="line-331"></span><span>                      </span><span class="hs-comment">-- See Note [Identity versus semantic module]</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621683145389"><span class="annot"><span class="annottext">fixities :: [(OccName, Fixity)]
</span><a href="#local-6989586621683145389"><span class="hs-identifier hs-var hs-var">fixities</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((OccName, Fixity) -&gt; (OccName, Fixity) -&gt; Ordering)
-&gt; [(OccName, Fixity)] -&gt; [(OccName, Fixity)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((OccName, Fixity) -&gt; OccName)
-&gt; (OccName, Fixity) -&gt; (OccName, Fixity) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">(OccName, Fixity) -&gt; OccName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683145392"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621683145393"><span class="hs-identifier hs-var">fix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a></span><span> </span><span id="local-6989586621683145392"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683145392"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span id="local-6989586621683145393"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621683145393"><span class="hs-identifier hs-var">fix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FixityEnv -&gt; [FixItem]
forall a. NameEnv a -&gt; [a]
</span><a href="GHC.Types.Name.Env.html#nonDetNameEnvElts"><span class="hs-identifier hs-var">nonDetNameEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683145341"><span class="hs-identifier hs-var">fix_env</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>          </span><span class="hs-comment">-- The order of fixities returned from nonDetNameEnvElts is not</span><span>
</span><span id="line-336"></span><span>          </span><span class="hs-comment">-- deterministic, so we sort by OccName to canonicalize it.</span><span>
</span><span id="line-337"></span><span>          </span><span class="hs-comment">-- See Note [Deterministic UniqFM] in GHC.Types.Unique.DFM for more details.</span><span>
</span><span id="line-338"></span><span>        </span><span id="local-6989586621683145396"><span class="annot"><span class="annottext">warns :: IfaceWarnings
</span><a href="#local-6989586621683145396"><span class="hs-identifier hs-var hs-var">warns</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Warnings GhcRn -&gt; IfaceWarnings
</span><a href="GHC.Iface.Warnings.html#toIfaceWarnings"><span class="hs-identifier hs-var">toIfaceWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Warnings GhcRn
</span><a href="#local-6989586621683145342"><span class="hs-identifier hs-var">src_warns</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span id="local-6989586621683145398"><span class="annot"><span class="annottext">iface_rules :: [IfaceRule]
</span><a href="#local-6989586621683145398"><span class="hs-identifier hs-var hs-var">iface_rules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreRule -&gt; IfaceRule) -&gt; [CoreRule] -&gt; [IfaceRule]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CoreRule -&gt; IfaceRule
</span><a href="GHC.Iface.Make.html#coreRuleToIfaceRule"><span class="hs-identifier hs-var">coreRuleToIfaceRule</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621683145357"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span id="local-6989586621683145400"><span class="annot"><span class="annottext">iface_insts :: [IfaceClsInst]
</span><a href="#local-6989586621683145400"><span class="hs-identifier hs-var hs-var">iface_insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; IfaceClsInst) -&gt; [ClsInst] -&gt; [IfaceClsInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; IfaceClsInst
</span><a href="GHC.Iface.Make.html#instanceToIfaceInst"><span class="hs-identifier hs-var">instanceToIfaceInst</span></a></span><span> </span><span class="annot"><span class="annottext">([ClsInst] -&gt; [IfaceClsInst]) -&gt; [ClsInst] -&gt; [IfaceClsInst]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; [ClsInst] -&gt; [ClsInst]
</span><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier hs-var">fixSafeInstances</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683145345"><span class="hs-identifier hs-var">safe_mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnv -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#instEnvElts"><span class="hs-identifier hs-var">instEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683145353"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621683145404"><span class="annot"><span class="annottext">iface_fam_insts :: [IfaceFamInst]
</span><a href="#local-6989586621683145404"><span class="hs-identifier hs-var hs-var">iface_fam_insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FamInst -&gt; IfaceFamInst) -&gt; [FamInst] -&gt; [IfaceFamInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FamInst -&gt; IfaceFamInst
</span><a href="GHC.Iface.Make.html#famInstToIfaceFamInst"><span class="hs-identifier hs-var">famInstToIfaceFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683145355"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-342"></span><span>        </span><span id="local-6989586621683145406"><span class="annot"><span class="annottext">trust_info :: IfaceTrustInfo
</span><a href="#local-6989586621683145406"><span class="hs-identifier hs-var hs-var">trust_info</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; IfaceTrustInfo
</span><a href="GHC.Types.SafeHaskell.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683145345"><span class="hs-identifier hs-var">safe_mode</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span id="local-6989586621683145408"><span class="annot"><span class="annottext">annotations :: [IfaceAnnotation]
</span><a href="#local-6989586621683145408"><span class="hs-identifier hs-var hs-var">annotations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Annotation -&gt; IfaceAnnotation)
-&gt; [Annotation] -&gt; [IfaceAnnotation]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Annotation -&gt; IfaceAnnotation
</span><a href="GHC.Iface.Make.html#mkIfaceAnnotation"><span class="hs-identifier hs-var">mkIfaceAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">[Annotation]
</span><a href="#local-6989586621683145359"><span class="hs-identifier hs-var">anns</span></a></span><span>
</span><span id="line-344"></span><span>        </span><span id="local-6989586621683145410"><span class="annot"><span class="annottext">icomplete_matches :: [IfaceCompleteMatch]
</span><a href="#local-6989586621683145410"><span class="hs-identifier hs-var hs-var">icomplete_matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompleteMatch -&gt; IfaceCompleteMatch)
-&gt; CompleteMatches -&gt; [IfaceCompleteMatch]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; IfaceCompleteMatch
</span><a href="GHC.Iface.Make.html#mkIfaceCompleteMatch"><span class="hs-identifier hs-var">mkIfaceCompleteMatch</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621683145365"><span class="hs-identifier hs-var">complete_matches</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621683145412"><span class="annot"><span class="annottext">rdrs :: Maybe IfaceTopEnv
</span><a href="#local-6989586621683145412"><span class="hs-identifier hs-var hs-var">rdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Maybe IfaceTopEnv
</span><a href="#local-6989586621683145413"><span class="hs-identifier hs-var">maybeGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145339"><span class="hs-identifier hs-var">rdr_env</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><span class="annottext">Module -&gt; PartialModIface
</span><a href="GHC.Unit.Module.ModIface.html#emptyPartialModIface"><span class="hs-identifier hs-var">emptyPartialModIface</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145334"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-348"></span><span>          </span><span class="hs-comment">-- Need to record this because it depends on the -instantiated-with flag</span><span>
</span><span id="line-349"></span><span>          </span><span class="hs-comment">-- which could change</span><span>
</span><span id="line-350"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Module -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Maybe Module -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_sig_of"><span class="hs-identifier hs-var">set_mi_sig_of</span></a></span><span>           </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145367"><span class="hs-identifier hs-var">semantic_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145334"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-351"></span><span>                                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Module
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-352"></span><span>                                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Maybe Module
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683145367"><span class="hs-identifier hs-var">semantic_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
HscSource -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_hsc_src"><span class="hs-identifier hs-var">set_mi_hsc_src</span></a></span><span>          </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683145336"><span class="hs-identifier hs-var">hsc_src</span></a></span><span>
</span><span id="line-354"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Dependencies -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_deps"><span class="hs-identifier hs-var">set_mi_deps</span></a></span><span>             </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683145338"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Usage] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[Usage] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_usages"><span class="hs-identifier hs-var">set_mi_usages</span></a></span><span>           </span><span class="annot"><span class="annottext">[Usage]
</span><a href="#local-6989586621683145346"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[AvailInfo] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[AvailInfo] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_exports"><span class="hs-identifier hs-var">set_mi_exports</span></a></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AvailInfo] -&gt; [AvailInfo]
</span><a href="GHC.Iface.Make.html#mkIfaceExports"><span class="hs-identifier hs-var">mkIfaceExports</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683145363"><span class="hs-identifier hs-var">exports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[IfaceDefault] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[IfaceDefault] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_defaults"><span class="hs-identifier hs-var">set_mi_defaults</span></a></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefaultEnv -&gt; [IfaceDefault]
</span><a href="GHC.Iface.Make.html#defaultsToIfaceDefaults"><span class="hs-identifier hs-var">defaultsToIfaceDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultEnv
</span><a href="#local-6989586621683145351"><span class="hs-identifier hs-var">defaults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>          </span><span class="hs-comment">-- Sort these lexicographically, so that</span><span>
</span><span id="line-361"></span><span>          </span><span class="hs-comment">-- the result is stable across compilations</span><span>
</span><span id="line-362"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[IfaceClsInst] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[IfaceClsInst] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_insts"><span class="hs-identifier hs-var">set_mi_insts</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IfaceClsInst -&gt; IfaceClsInst -&gt; Ordering)
-&gt; [IfaceClsInst] -&gt; [IfaceClsInst]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="annot"><span class="annottext">IfaceClsInst -&gt; IfaceClsInst -&gt; Ordering
</span><a href="#local-6989586621683145424"><span class="hs-identifier hs-var">cmp_inst</span></a></span><span>     </span><span class="annot"><span class="annottext">[IfaceClsInst]
</span><a href="#local-6989586621683145400"><span class="hs-identifier hs-var">iface_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[IfaceFamInst] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[IfaceFamInst] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_fam_insts"><span class="hs-identifier hs-var">set_mi_fam_insts</span></a></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IfaceFamInst -&gt; IfaceFamInst -&gt; Ordering)
-&gt; [IfaceFamInst] -&gt; [IfaceFamInst]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="annot"><span class="annottext">IfaceFamInst -&gt; IfaceFamInst -&gt; Ordering
</span><a href="#local-6989586621683145426"><span class="hs-identifier hs-var">cmp_fam_inst</span></a></span><span> </span><span class="annot"><span class="annottext">[IfaceFamInst]
</span><a href="#local-6989586621683145404"><span class="hs-identifier hs-var">iface_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[IfaceRule] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[IfaceRule] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_rules"><span class="hs-identifier hs-var">set_mi_rules</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IfaceRule -&gt; IfaceRule -&gt; Ordering) -&gt; [IfaceRule] -&gt; [IfaceRule]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="annot"><span class="annottext">IfaceRule -&gt; IfaceRule -&gt; Ordering
</span><a href="#local-6989586621683145428"><span class="hs-identifier hs-var">cmp_rule</span></a></span><span>     </span><span class="annot"><span class="annottext">[IfaceRule]
</span><a href="#local-6989586621683145398"><span class="hs-identifier hs-var">iface_rules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(OccName, Fixity)] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[(OccName, Fixity)] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_fixities"><span class="hs-identifier hs-var">set_mi_fixities</span></a></span><span>         </span><span class="annot"><span class="annottext">[(OccName, Fixity)]
</span><a href="#local-6989586621683145389"><span class="hs-identifier hs-var">fixities</span></a></span><span>
</span><span id="line-367"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IfaceWarnings -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
IfaceWarnings -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_warns"><span class="hs-identifier hs-var">set_mi_warns</span></a></span><span>            </span><span class="annot"><span class="annottext">IfaceWarnings
</span><a href="#local-6989586621683145396"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-368"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[IfaceAnnotation] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[IfaceAnnotation] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_anns"><span class="hs-identifier hs-var">set_mi_anns</span></a></span><span>             </span><span class="annot"><span class="annottext">[IfaceAnnotation]
</span><a href="#local-6989586621683145408"><span class="hs-identifier hs-var">annotations</span></a></span><span>
</span><span id="line-369"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe IfaceTopEnv -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Maybe IfaceTopEnv -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_top_env"><span class="hs-identifier hs-var">set_mi_top_env</span></a></span><span>          </span><span class="annot"><span class="annottext">Maybe IfaceTopEnv
</span><a href="#local-6989586621683145412"><span class="hs-identifier hs-var">rdrs</span></a></span><span>
</span><span id="line-370"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Bool -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_used_th"><span class="hs-identifier hs-var">set_mi_used_th</span></a></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145337"><span class="hs-identifier hs-var">used_th</span></a></span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[IfaceDeclExts 'ModIfaceCore] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[IfaceDeclExts phase] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_decls"><span class="hs-identifier hs-var">set_mi_decls</span></a></span><span>            </span><span class="annot"><span class="annottext">[IfaceDecl]
[IfaceDeclExts 'ModIfaceCore]
</span><a href="#local-6989586621683145380"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-372"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
-&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
-&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_extra_decls"><span class="hs-identifier hs-var">set_mi_extra_decls</span></a></span><span>      </span><span class="annot"><span class="annottext">Maybe [IfaceBindingX IfaceMaybeRhs IfaceTopBndrInfo]
</span><a href="#local-6989586621683145375"><span class="hs-identifier hs-var">extra_decls</span></a></span><span>
</span><span id="line-373"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Bool -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_hpc"><span class="hs-identifier hs-var">set_mi_hpc</span></a></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HpcInfo -&gt; Bool
</span><a href="GHC.Types.HpcInfo.html#isHpcUsed"><span class="hs-identifier hs-var">isHpcUsed</span></a></span><span> </span><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621683145343"><span class="hs-identifier hs-var">hpc_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IfaceTrustInfo -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
IfaceTrustInfo -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_trust"><span class="hs-identifier hs-var">set_mi_trust</span></a></span><span>            </span><span class="annot"><span class="annottext">IfaceTrustInfo
</span><a href="#local-6989586621683145406"><span class="hs-identifier hs-var">trust_info</span></a></span><span>
</span><span id="line-375"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Bool -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_trust_pkg"><span class="hs-identifier hs-var">set_mi_trust_pkg</span></a></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145344"><span class="hs-identifier hs-var">pkg_trust_req</span></a></span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[IfaceCompleteMatch] -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
[IfaceCompleteMatch] -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_complete_matches"><span class="hs-identifier hs-var">set_mi_complete_matches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IfaceCompleteMatch]
</span><a href="#local-6989586621683145410"><span class="hs-identifier hs-var">icomplete_matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Docs -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Maybe Docs -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_docs"><span class="hs-identifier hs-var">set_mi_docs</span></a></span><span>             </span><span class="annot"><span class="annottext">Maybe Docs
</span><a href="#local-6989586621683145347"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-378"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IfaceBackendExts 'ModIfaceCore
-&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
IfaceBackendExts phase -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_final_exts"><span class="hs-identifier hs-var">set_mi_final_exts</span></a></span><span>       </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ExtensibleFields -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
ExtensibleFields -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_ext_fields"><span class="hs-identifier hs-var">set_mi_ext_fields</span></a></span><span>       </span><span class="annot"><span class="annottext">ExtensibleFields
</span><a href="GHC.Iface.Ext.Fields.html#emptyExtensibleFields"><span class="hs-identifier hs-var">emptyExtensibleFields</span></a></span><span>
</span><span id="line-380"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
Fingerprint -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_src_hash"><span class="hs-identifier hs-var">set_mi_src_hash</span></a></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hs_hash"><span class="hs-identifier hs-var">ms_hs_hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683145348"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>          </span><span class="annot"><span class="annottext">PartialModIface
-&gt; (PartialModIface -&gt; PartialModIface) -&gt; PartialModIface
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IfaceBinHandle 'ModIfaceCore -&gt; PartialModIface -&gt; PartialModIface
forall (phase :: ModIfacePhase).
IfaceBinHandle phase -&gt; ModIface_ phase -&gt; ModIface_ phase
</span><a href="GHC.Unit.Module.ModIface.html#set_mi_hi_bytes"><span class="hs-identifier hs-var">set_mi_hi_bytes</span></a></span><span>         </span><span class="annot"><span class="annottext">IfaceBinHandle 'ModIfaceCore
</span><a href="GHC.Unit.Module.ModIface.html#PartialIfaceBinHandle"><span class="hs-identifier hs-var">PartialIfaceBinHandle</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-384"></span><span>     </span><span id="local-6989586621683145428"><span class="annot"><span class="annottext">cmp_rule :: IfaceRule -&gt; IfaceRule -&gt; Ordering
</span><a href="#local-6989586621683145428"><span class="hs-identifier hs-var hs-var">cmp_rule</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier hs-var">lexicalCompareFS</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; FastString -&gt; Ordering)
-&gt; (IfaceRule -&gt; FastString) -&gt; IfaceRule -&gt; IfaceRule -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">IfaceRule -&gt; FastString
</span><a href="GHC.Iface.Syntax.html#ifRuleName"><span class="hs-identifier hs-var">ifRuleName</span></a></span><span>
</span><span id="line-385"></span><span>     </span><span class="hs-comment">-- Compare these lexicographically by OccName, *not* by unique,</span><span>
</span><span id="line-386"></span><span>     </span><span class="hs-comment">-- because the latter is not stable across compilations:</span><span>
</span><span id="line-387"></span><span>     </span><span id="local-6989586621683145424"><span class="annot"><span class="annottext">cmp_inst :: IfaceClsInst -&gt; IfaceClsInst -&gt; Ordering
</span><a href="#local-6989586621683145424"><span class="hs-identifier hs-var hs-var">cmp_inst</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IfaceClsInst -&gt; OccName)
-&gt; IfaceClsInst -&gt; IfaceClsInst -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName)
-&gt; (IfaceClsInst -&gt; Name) -&gt; IfaceClsInst -&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IfaceClsInst -&gt; Name
</span><a href="GHC.Iface.Syntax.html#ifDFun"><span class="hs-identifier hs-var">ifDFun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>     </span><span id="local-6989586621683145426"><span class="annot"><span class="annottext">cmp_fam_inst :: IfaceFamInst -&gt; IfaceFamInst -&gt; Ordering
</span><a href="#local-6989586621683145426"><span class="hs-identifier hs-var hs-var">cmp_fam_inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IfaceFamInst -&gt; OccName)
-&gt; IfaceFamInst -&gt; IfaceFamInst -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName)
-&gt; (IfaceFamInst -&gt; Name) -&gt; IfaceFamInst -&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IfaceFamInst -&gt; Name
</span><a href="#local-6989586621683145456"><span class="hs-identifier hs-var">ifFamInstTcName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>     </span><span id="local-6989586621683145377"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683145377"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683145333"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>     </span><span class="hs-comment">-- We only fill in mi_top_env if the module was compiled to byte</span><span>
</span><span id="line-393"></span><span>     </span><span class="hs-comment">-- code.  Otherwise, the compiler may not have retained all the</span><span>
</span><span id="line-394"></span><span>     </span><span class="hs-comment">-- top-level bindings and they won't be in the TypeEnv (see</span><span>
</span><span id="line-395"></span><span>     </span><span class="hs-comment">-- Desugar.addExportFlagsAndRules).  The mi_top_env field is used</span><span>
</span><span id="line-396"></span><span>     </span><span class="hs-comment">-- by GHCi to decide whether the module has its full top-level</span><span>
</span><span id="line-397"></span><span>     </span><span class="hs-comment">-- scope available. (#5534)</span><span>
</span><span id="line-398"></span><span>     </span><span class="annot"><a href="#local-6989586621683145413"><span class="hs-identifier hs-type">maybeGlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#IfaceTopEnv"><span class="hs-identifier hs-type">IfaceTopEnv</span></a></span><span>
</span><span id="line-399"></span><span>     </span><span id="local-6989586621683145413"><span class="annot"><span class="annottext">maybeGlobalRdrEnv :: GlobalRdrEnv -&gt; Maybe IfaceTopEnv
</span><a href="#local-6989586621683145413"><span class="hs-identifier hs-var hs-var">maybeGlobalRdrEnv</span></a></span></span><span> </span><span id="local-6989586621683145457"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145457"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendWantsGlobalBindings"><span class="hs-identifier hs-var">backendWantsGlobalBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.DynFlags.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683145377"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceTopEnv -&gt; Maybe IfaceTopEnv
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IfaceTopEnv -&gt; Maybe IfaceTopEnv)
-&gt; IfaceTopEnv -&gt; Maybe IfaceTopEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683145461"><span class="annot"><span class="annottext">exports :: IfGlobalRdrEnv
</span><a href="#local-6989586621683145461"><span class="hs-identifier hs-var hs-var">exports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; IfGlobalRdrEnv
forall info. GlobalRdrEnvX info -&gt; IfGlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#forceGlobalRdrEnv"><span class="hs-identifier hs-var">forceGlobalRdrEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; GlobalRdrEnv
forall info. GlobalRdrEnvX info -&gt; GlobalRdrEnvX info
</span><a href="GHC.Types.Name.Reader.html#globalRdrEnvLocal"><span class="hs-identifier hs-var">globalRdrEnvLocal</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145457"><span class="hs-identifier hs-var">rdr_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>                      </span><span class="hs-glyph">!</span><span id="local-6989586621683145464"><span class="annot"><span class="annottext">imports :: [IfaceImport]
</span><a href="#local-6989586621683145464"><span class="hs-identifier hs-var hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportUserSpec] -&gt; [IfaceImport]
</span><a href="GHC.Iface.Make.html#mkIfaceImports"><span class="hs-identifier hs-var">mkIfaceImports</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683145340"><span class="hs-identifier hs-var">import_decls</span></a></span><span>
</span><span id="line-403"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IfGlobalRdrEnv -&gt; [IfaceImport] -&gt; IfaceTopEnv
</span><a href="GHC.Unit.Module.ModIface.html#IfaceTopEnv"><span class="hs-identifier hs-var">IfaceTopEnv</span></a></span><span> </span><span class="annot"><span class="annottext">IfGlobalRdrEnv
</span><a href="#local-6989586621683145461"><span class="hs-identifier hs-var">exports</span></a></span><span> </span><span class="annot"><span class="annottext">[IfaceImport]
</span><a href="#local-6989586621683145464"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-404"></span><span>          </span><span class="hs-comment">-- See Note [Forcing GREInfo] in GHC.Types.GREInfo.</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IfaceTopEnv
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>     </span><span id="local-6989586621683145456"><span class="annot"><span class="annottext">ifFamInstTcName :: IfaceFamInst -&gt; Name
</span><a href="#local-6989586621683145456"><span class="hs-identifier hs-var hs-var">ifFamInstTcName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceFamInst -&gt; Name
</span><a href="GHC.Iface.Syntax.html#ifFamInstFam"><span class="hs-identifier hs-var">ifFamInstFam</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.Iface.Make.html#defaultsToIfaceDefaults"><span class="hs-identifier hs-type">defaultsToIfaceDefaults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier hs-type">DefaultEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDefault"><span class="hs-identifier hs-type">IfaceDefault</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-412"></span><span id="defaultsToIfaceDefaults"><span class="annot"><span class="annottext">defaultsToIfaceDefaults :: DefaultEnv -&gt; [IfaceDefault]
</span><a href="GHC.Iface.Make.html#defaultsToIfaceDefaults"><span class="hs-identifier hs-var hs-var">defaultsToIfaceDefaults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClassDefaults -&gt; IfaceDefault)
-&gt; [ClassDefaults] -&gt; [IfaceDefault]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; IfaceDefault
</span><a href="#local-6989586621683145468"><span class="hs-identifier hs-var">toIface</span></a></span><span> </span><span class="annot"><span class="annottext">([ClassDefaults] -&gt; [IfaceDefault])
-&gt; (DefaultEnv -&gt; [ClassDefaults]) -&gt; DefaultEnv -&gt; [IfaceDefault]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DefaultEnv -&gt; [ClassDefaults]
</span><a href="GHC.Types.DefaultEnv.html#defaultList"><span class="hs-identifier hs-var">defaultList</span></a></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621683145468"><span class="annot"><span class="annottext">toIface :: ClassDefaults -&gt; IfaceDefault
</span><a href="#local-6989586621683145468"><span class="hs-identifier hs-var hs-var">toIface</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cd_class :: ClassDefaults -&gt; TyCon
</span><a href="GHC.Types.DefaultEnv.html#cd_class"><span class="hs-identifier hs-var">cd_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145472"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683145472"><span class="hs-identifier hs-var">clsTyCon</span></a></span></span><span>
</span><span id="line-415"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cd_types :: ClassDefaults -&gt; [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145474"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683145474"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-416"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cd_warn :: ClassDefaults -&gt; Maybe (WarningTxt GhcRn)
</span><a href="GHC.Types.DefaultEnv.html#cd_warn"><span class="hs-identifier hs-var">cd_warn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145476"><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621683145476"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDefault"><span class="hs-identifier hs-type">IfaceDefault</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ifDefaultCls :: IfaceTyCon
</span><a href="GHC.Iface.Syntax.html#ifDefaultCls"><span class="hs-identifier hs-var">ifDefaultCls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; IfaceTyCon
</span><a href="GHC.CoreToIface.html#toIfaceTyCon"><span class="hs-identifier hs-var">toIfaceTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683145472"><span class="hs-identifier hs-var">clsTyCon</span></a></span><span>
</span><span id="line-418"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifDefaultTys :: [IfaceType]
</span><a href="GHC.Iface.Syntax.html#ifDefaultTys"><span class="hs-identifier hs-var">ifDefaultTys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IfaceType) -&gt; [Type] -&gt; [IfaceType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; IfaceType
</span><a href="GHC.CoreToIface.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683145474"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-419"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifDefaultWarn :: Maybe IfaceWarningTxt
</span><a href="GHC.Iface.Syntax.html#ifDefaultWarn"><span class="hs-identifier hs-var">ifDefaultWarn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WarningTxt GhcRn -&gt; IfaceWarningTxt)
-&gt; Maybe (WarningTxt GhcRn) -&gt; Maybe IfaceWarningTxt
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">WarningTxt GhcRn -&gt; IfaceWarningTxt
</span><a href="GHC.Iface.Warnings.html#toIfaceWarningTxt"><span class="hs-identifier hs-var">toIfaceWarningTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621683145476"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-422"></span><span class="annot"><a href="GHC.Iface.Make.html#instanceToIfaceInst"><span class="hs-identifier hs-type">instanceToIfaceInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceClsInst"><span class="hs-identifier hs-type">IfaceClsInst</span></a></span><span>
</span><span id="line-423"></span><span id="instanceToIfaceInst"><span class="annot"><span class="annottext">instanceToIfaceInst :: ClsInst -&gt; IfaceClsInst
</span><a href="GHC.Iface.Make.html#instanceToIfaceInst"><span class="hs-identifier hs-var hs-var">instanceToIfaceInst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_dfun :: ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#is_dfun"><span class="hs-identifier hs-var">is_dfun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145486"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683145486"><span class="hs-identifier hs-var">dfun_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_flag :: ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var">is_flag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145488"><span class="annot"><span class="annottext">OverlapFlag
</span><a href="#local-6989586621683145488"><span class="hs-identifier hs-var">oflag</span></a></span></span><span>
</span><span id="line-424"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_cls_nm :: ClsInst -&gt; Name
</span><a href="GHC.Core.InstEnv.html#is_cls_nm"><span class="hs-identifier hs-var">is_cls_nm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145490"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145490"><span class="hs-identifier hs-var">cls_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_cls :: ClsInst -&gt; Class
</span><a href="GHC.Core.InstEnv.html#is_cls"><span class="hs-identifier hs-var">is_cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145492"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683145492"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-425"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_tcs :: ClsInst -&gt; [RoughMatchTc]
</span><a href="GHC.Core.InstEnv.html#is_tcs"><span class="hs-identifier hs-var">is_tcs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145494"><span class="annot"><span class="annottext">[RoughMatchTc]
</span><a href="#local-6989586621683145494"><span class="hs-identifier hs-var">rough_tcs</span></a></span></span><span>
</span><span id="line-426"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_orphan :: ClsInst -&gt; IsOrphan
</span><a href="GHC.Core.InstEnv.html#is_orphan"><span class="hs-identifier hs-var">is_orphan</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145496"><span class="annot"><span class="annottext">IsOrphan
</span><a href="#local-6989586621683145496"><span class="hs-identifier hs-var">orph</span></a></span></span><span>
</span><span id="line-427"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_warn :: ClsInst -&gt; Maybe (WarningTxt GhcRn)
</span><a href="GHC.Core.InstEnv.html#is_warn"><span class="hs-identifier hs-var">is_warn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145498"><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621683145498"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IfaceClsInst -&gt; IfaceClsInst
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145490"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Name
</span><a href="GHC.Core.Class.html#className"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683145492"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IfaceClsInst -&gt; IfaceClsInst) -&gt; IfaceClsInst -&gt; IfaceClsInst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceClsInst"><span class="hs-identifier hs-type">IfaceClsInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ifDFun :: Name
</span><a href="GHC.Iface.Syntax.html#ifDFun"><span class="hs-identifier hs-var">ifDFun</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683145486"><span class="hs-identifier hs-var">dfun_id</span></a></span><span>
</span><span id="line-430"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifOFlag :: OverlapFlag
</span><a href="GHC.Iface.Syntax.html#ifOFlag"><span class="hs-identifier hs-var">ifOFlag</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapFlag
</span><a href="#local-6989586621683145488"><span class="hs-identifier hs-var">oflag</span></a></span><span>
</span><span id="line-431"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifInstCls :: Name
</span><a href="GHC.Iface.Syntax.html#ifInstCls"><span class="hs-identifier hs-var">ifInstCls</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145490"><span class="hs-identifier hs-var">cls_name</span></a></span><span>
</span><span id="line-432"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifInstTys :: [Maybe IfaceTyCon]
</span><a href="GHC.Iface.Syntax.html#ifInstTys"><span class="hs-identifier hs-var">ifInstTys</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RoughMatchTc] -&gt; [Maybe IfaceTyCon]
</span><a href="GHC.Iface.Make.html#ifaceRoughMatchTcs"><span class="hs-identifier hs-var">ifaceRoughMatchTcs</span></a></span><span> </span><span class="annot"><span class="annottext">([RoughMatchTc] -&gt; [Maybe IfaceTyCon])
-&gt; [RoughMatchTc] -&gt; [Maybe IfaceTyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[RoughMatchTc] -&gt; [RoughMatchTc]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[RoughMatchTc]
</span><a href="#local-6989586621683145494"><span class="hs-identifier hs-var">rough_tcs</span></a></span><span>
</span><span id="line-433"></span><span>                   </span><span class="hs-comment">-- N.B. Drop the class name from the rough match template</span><span>
</span><span id="line-434"></span><span>                   </span><span class="hs-comment">--      It is put back by GHC.Core.InstEnv.mkImportedClsInst</span><span>
</span><span id="line-435"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifInstOrph :: IsOrphan
</span><a href="GHC.Iface.Syntax.html#ifInstOrph"><span class="hs-identifier hs-var">ifInstOrph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsOrphan
</span><a href="#local-6989586621683145496"><span class="hs-identifier hs-var">orph</span></a></span><span>
</span><span id="line-436"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifInstWarn :: Maybe IfaceWarningTxt
</span><a href="GHC.Iface.Syntax.html#ifInstWarn"><span class="hs-identifier hs-var">ifInstWarn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WarningTxt GhcRn -&gt; IfaceWarningTxt)
-&gt; Maybe (WarningTxt GhcRn) -&gt; Maybe IfaceWarningTxt
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">WarningTxt GhcRn -&gt; IfaceWarningTxt
</span><a href="GHC.Iface.Warnings.html#toIfaceWarningTxt"><span class="hs-identifier hs-var">toIfaceWarningTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621683145498"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.Iface.Make.html#famInstToIfaceFamInst"><span class="hs-identifier hs-type">famInstToIfaceFamInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceFamInst"><span class="hs-identifier hs-type">IfaceFamInst</span></a></span><span>
</span><span id="line-440"></span><span id="famInstToIfaceFamInst"><span class="annot"><span class="annottext">famInstToIfaceFamInst :: FamInst -&gt; IfaceFamInst
</span><a href="GHC.Iface.Make.html#famInstToIfaceFamInst"><span class="hs-identifier hs-var hs-var">famInstToIfaceFamInst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fi_axiom :: FamInst -&gt; CoAxiom Unbranched
</span><a href="GHC.Core.FamInstEnv.html#fi_axiom"><span class="hs-identifier hs-var">fi_axiom</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145512"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621683145512"><span class="hs-identifier hs-var">axiom</span></a></span></span><span>
</span><span id="line-441"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fi_fam :: FamInst -&gt; Name
</span><a href="GHC.Core.FamInstEnv.html#fi_fam"><span class="hs-identifier hs-var">fi_fam</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145514"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145514"><span class="hs-identifier hs-var">fam</span></a></span></span><span>
</span><span id="line-442"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fi_tcs :: FamInst -&gt; [RoughMatchTc]
</span><a href="GHC.Core.FamInstEnv.html#fi_tcs"><span class="hs-identifier hs-var">fi_tcs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145516"><span class="annot"><span class="annottext">[RoughMatchTc]
</span><a href="#local-6989586621683145516"><span class="hs-identifier hs-var">rough_tcs</span></a></span></span><span>
</span><span id="line-443"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fi_orphan :: FamInst -&gt; IsOrphan
</span><a href="GHC.Core.FamInstEnv.html#fi_orphan"><span class="hs-identifier hs-var">fi_orphan</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145518"><span class="annot"><span class="annottext">IsOrphan
</span><a href="#local-6989586621683145518"><span class="hs-identifier hs-var">orphan</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceFamInst"><span class="hs-identifier hs-type">IfaceFamInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ifFamInstAxiom :: Name
</span><a href="GHC.Iface.Syntax.html#ifFamInstAxiom"><span class="hs-identifier hs-var">ifFamInstAxiom</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; Name
forall (br :: BranchFlag). CoAxiom br -&gt; Name
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomName"><span class="hs-identifier hs-var">coAxiomName</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621683145512"><span class="hs-identifier hs-var">axiom</span></a></span><span>
</span><span id="line-445"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifFamInstFam :: Name
</span><a href="GHC.Iface.Syntax.html#ifFamInstFam"><span class="hs-identifier hs-var">ifFamInstFam</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145514"><span class="hs-identifier hs-var">fam</span></a></span><span>
</span><span id="line-446"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifFamInstTys :: [Maybe IfaceTyCon]
</span><a href="GHC.Iface.Syntax.html#ifFamInstTys"><span class="hs-identifier hs-var">ifFamInstTys</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RoughMatchTc] -&gt; [Maybe IfaceTyCon]
</span><a href="GHC.Iface.Make.html#ifaceRoughMatchTcs"><span class="hs-identifier hs-var">ifaceRoughMatchTcs</span></a></span><span> </span><span class="annot"><span class="annottext">[RoughMatchTc]
</span><a href="#local-6989586621683145516"><span class="hs-identifier hs-var">rough_tcs</span></a></span><span>
</span><span id="line-447"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifFamInstOrph :: IsOrphan
</span><a href="GHC.Iface.Syntax.html#ifFamInstOrph"><span class="hs-identifier hs-var">ifFamInstOrph</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsOrphan
</span><a href="#local-6989586621683145518"><span class="hs-identifier hs-var">orphan</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="GHC.Iface.Make.html#ifaceRoughMatchTcs"><span class="hs-identifier hs-type">ifaceRoughMatchTcs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.RoughMap.html#RoughMatchTc"><span class="hs-identifier hs-type">RoughMatchTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#IfaceTyCon"><span class="hs-identifier hs-type">IfaceTyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-450"></span><span id="ifaceRoughMatchTcs"><span class="annot"><span class="annottext">ifaceRoughMatchTcs :: [RoughMatchTc] -&gt; [Maybe IfaceTyCon]
</span><a href="GHC.Iface.Make.html#ifaceRoughMatchTcs"><span class="hs-identifier hs-var hs-var">ifaceRoughMatchTcs</span></a></span></span><span> </span><span id="local-6989586621683145524"><span class="annot"><span class="annottext">[RoughMatchTc]
</span><a href="#local-6989586621683145524"><span class="hs-identifier hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RoughMatchTc -&gt; Maybe IfaceTyCon)
-&gt; [RoughMatchTc] -&gt; [Maybe IfaceTyCon]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RoughMatchTc -&gt; Maybe IfaceTyCon
</span><a href="#local-6989586621683145525"><span class="hs-identifier hs-var">do_rough</span></a></span><span> </span><span class="annot"><span class="annottext">[RoughMatchTc]
</span><a href="#local-6989586621683145524"><span class="hs-identifier hs-var">tcs</span></a></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-452"></span><span>    </span><span id="local-6989586621683145525"><span class="annot"><span class="annottext">do_rough :: RoughMatchTc -&gt; Maybe IfaceTyCon
</span><a href="#local-6989586621683145525"><span class="hs-identifier hs-var hs-var">do_rough</span></a></span></span><span> </span><span class="annot"><span class="annottext">RoughMatchTc
</span><a href="GHC.Core.RoughMap.html#RM_WildCard"><span class="hs-identifier hs-var">RM_WildCard</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IfaceTyCon
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><a href="#local-6989586621683145525"><span class="hs-identifier hs-var">do_rough</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.RoughMap.html#RM_KnownTc"><span class="hs-identifier hs-type">RM_KnownTc</span></a></span><span> </span><span id="local-6989586621683145528"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145528"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceTyCon -&gt; Maybe IfaceTyCon
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; IfaceTyCon
</span><a href="GHC.CoreToIface.html#toIfaceTyCon_name"><span class="hs-identifier hs-var">toIfaceTyCon_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145528"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-456"></span><span class="annot"><a href="GHC.Iface.Make.html#coreRuleToIfaceRule"><span class="hs-identifier hs-type">coreRuleToIfaceRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceRule"><span class="hs-identifier hs-type">IfaceRule</span></a></span><span>
</span><span id="line-457"></span><span class="hs-comment">-- A plugin that installs a BuiltinRule in a CoreDoPluginPass should</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- ensure that there's another CoreDoPluginPass that removes the rule.</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- Otherwise a module using the plugin and compiled with -fno-omit-interface-pragmas</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- would cause panic when the rule is attempted to be written to the interface file.</span><span>
</span><span id="line-461"></span><span id="coreRuleToIfaceRule"><span class="annot"><span class="annottext">coreRuleToIfaceRule :: CoreRule -&gt; IfaceRule
</span><a href="GHC.Iface.Make.html#coreRuleToIfaceRule"><span class="hs-identifier hs-var hs-var">coreRuleToIfaceRule</span></a></span></span><span> </span><span id="local-6989586621683145530"><span class="annot"><span class="annottext">rule :: CoreRule
</span><a href="#local-6989586621683145530"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#BuiltinRule"><span class="hs-identifier hs-type">BuiltinRule</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IfaceRule
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;toHsRule:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreRule -&gt; SDoc
</span><a href="GHC.Core.Ppr.html#pprRule"><span class="hs-identifier hs-var">pprRule</span></a></span><span> </span><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621683145530"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="GHC.Iface.Make.html#coreRuleToIfaceRule"><span class="hs-identifier hs-var">coreRuleToIfaceRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ru_name :: CoreRule -&gt; FastString
</span><a href="GHC.Core.html#ru_name"><span class="hs-identifier hs-var">ru_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145536"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683145536"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ru_fn :: CoreRule -&gt; Name
</span><a href="GHC.Core.html#ru_fn"><span class="hs-identifier hs-var">ru_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145538"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145538"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-465"></span><span>                            </span><span class="annot"><span class="annottext">ru_act :: CoreRule -&gt; Activation
</span><a href="GHC.Core.html#ru_act"><span class="hs-identifier hs-var">ru_act</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145540"><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683145540"><span class="hs-identifier hs-var">act</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ru_bndrs :: CoreRule -&gt; [Id]
</span><a href="GHC.Core.html#ru_bndrs"><span class="hs-identifier hs-var">ru_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145542"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683145542"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-466"></span><span>                            </span><span class="annot"><span class="annottext">ru_args :: CoreRule -&gt; [CoreExpr]
</span><a href="GHC.Core.html#ru_args"><span class="hs-identifier hs-var">ru_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145544"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683145544"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ru_rhs :: CoreRule -&gt; CoreExpr
</span><a href="GHC.Core.html#ru_rhs"><span class="hs-identifier hs-var">ru_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145546"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683145546"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-467"></span><span>                            </span><span class="annot"><span class="annottext">ru_orphan :: CoreRule -&gt; IsOrphan
</span><a href="GHC.Core.html#ru_orphan"><span class="hs-identifier hs-var">ru_orphan</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145548"><span class="annot"><span class="annottext">IsOrphan
</span><a href="#local-6989586621683145548"><span class="hs-identifier hs-var">orph</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ru_auto :: CoreRule -&gt; Bool
</span><a href="GHC.Core.html#ru_auto"><span class="hs-identifier hs-var">ru_auto</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145550"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145550"><span class="hs-identifier hs-var">auto</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceRule"><span class="hs-identifier hs-type">IfaceRule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ifRuleName :: FastString
</span><a href="GHC.Iface.Syntax.html#ifRuleName"><span class="hs-identifier hs-var">ifRuleName</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683145536"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ifActivation :: Activation
</span><a href="GHC.Iface.Syntax.html#ifActivation"><span class="hs-identifier hs-var">ifActivation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683145540"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-469"></span><span>                </span><span class="annot"><span class="annottext">ifRuleBndrs :: [IfaceBndr]
</span><a href="GHC.Iface.Syntax.html#ifRuleBndrs"><span class="hs-identifier hs-var">ifRuleBndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; IfaceBndr) -&gt; [Id] -&gt; [IfaceBndr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; IfaceBndr
</span><a href="GHC.CoreToIface.html#toIfaceBndr"><span class="hs-identifier hs-var">toIfaceBndr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683145542"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-470"></span><span>                </span><span class="annot"><span class="annottext">ifRuleHead :: Name
</span><a href="GHC.Iface.Syntax.html#ifRuleHead"><span class="hs-identifier hs-var">ifRuleHead</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683145538"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-471"></span><span>                </span><span class="annot"><span class="annottext">ifRuleArgs :: [IfaceExpr]
</span><a href="GHC.Iface.Syntax.html#ifRuleArgs"><span class="hs-identifier hs-var">ifRuleArgs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; IfaceExpr) -&gt; [CoreExpr] -&gt; [IfaceExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; IfaceExpr
</span><a href="#local-6989586621683145557"><span class="hs-identifier hs-var">do_arg</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683145544"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-472"></span><span>                </span><span class="annot"><span class="annottext">ifRuleRhs :: IfaceExpr
</span><a href="GHC.Iface.Syntax.html#ifRuleRhs"><span class="hs-identifier hs-var">ifRuleRhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; IfaceExpr
</span><a href="GHC.CoreToIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683145546"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-473"></span><span>                </span><span class="annot"><span class="annottext">ifRuleAuto :: Bool
</span><a href="GHC.Iface.Syntax.html#ifRuleAuto"><span class="hs-identifier hs-var">ifRuleAuto</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683145550"><span class="hs-identifier hs-var">auto</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-474"></span><span>                </span><span class="annot"><span class="annottext">ifRuleOrph :: IsOrphan
</span><a href="GHC.Iface.Syntax.html#ifRuleOrph"><span class="hs-identifier hs-var">ifRuleOrph</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsOrphan
</span><a href="#local-6989586621683145548"><span class="hs-identifier hs-var">orph</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-comment">-- For type args we must remove synonyms from the outermost</span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-comment">-- level.  Reason: so that when we read it back in we'll</span><span>
</span><span id="line-478"></span><span>        </span><span class="hs-comment">-- construct the same ru_rough field as we have right now;</span><span>
</span><span id="line-479"></span><span>        </span><span class="hs-comment">-- see tcIfaceRule</span><span>
</span><span id="line-480"></span><span>    </span><span id="local-6989586621683145557"><span class="annot"><span class="annottext">do_arg :: CoreExpr -&gt; IfaceExpr
</span><a href="#local-6989586621683145557"><span class="hs-identifier hs-var hs-var">do_arg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621683145563"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683145563"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceType -&gt; IfaceExpr
</span><a href="GHC.Iface.Syntax.html#IfaceType"><span class="hs-identifier hs-var">IfaceType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; IfaceType
</span><a href="GHC.CoreToIface.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#deNoteType"><span class="hs-identifier hs-var">deNoteType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683145563"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><a href="#local-6989586621683145557"><span class="hs-identifier hs-var">do_arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621683145567"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683145567"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceCoercion -&gt; IfaceExpr
</span><a href="GHC.Iface.Syntax.html#IfaceCo"><span class="hs-identifier hs-var">IfaceCo</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; IfaceCoercion
</span><a href="GHC.CoreToIface.html#toIfaceCoercion"><span class="hs-identifier hs-var">toIfaceCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683145567"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="#local-6989586621683145557"><span class="hs-identifier hs-var">do_arg</span></a></span><span> </span><span id="local-6989586621683145570"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683145570"><span class="hs-identifier hs-var">arg</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; IfaceExpr
</span><a href="GHC.CoreToIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683145570"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
       COMPLETE Pragmas
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceCompleteMatch"><span class="hs-identifier hs-type">mkIfaceCompleteMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceCompleteMatch"><span class="hs-identifier hs-type">IfaceCompleteMatch</span></a></span><span>
</span><span id="line-494"></span><span id="mkIfaceCompleteMatch"><span class="annot"><span class="annottext">mkIfaceCompleteMatch :: CompleteMatch -&gt; IfaceCompleteMatch
</span><a href="GHC.Iface.Make.html#mkIfaceCompleteMatch"><span class="hs-identifier hs-var hs-var">mkIfaceCompleteMatch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span id="local-6989586621683145572"><span class="annot"><span class="annottext">UniqDSet Name
</span><a href="#local-6989586621683145572"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683145573"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683145573"><span class="hs-identifier hs-var">mtc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><span class="annottext">[Name] -&gt; Maybe Name -&gt; IfaceCompleteMatch
</span><a href="GHC.Iface.Syntax.html#IfaceCompleteMatch"><span class="hs-identifier hs-var">IfaceCompleteMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDSet Name -&gt; [Name]
forall a. UniqDSet a -&gt; [a]
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet Name
</span><a href="#local-6989586621683145572"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683145573"><span class="hs-identifier hs-var">mtc</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
       Keeping track of what we've slurped, and fingerprints
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceAnnotation"><span class="hs-identifier hs-type">mkIfaceAnnotation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceAnnotation"><span class="hs-identifier hs-type">IfaceAnnotation</span></a></span><span>
</span><span id="line-508"></span><span id="mkIfaceAnnotation"><span class="annot"><span class="annottext">mkIfaceAnnotation :: Annotation -&gt; IfaceAnnotation
</span><a href="GHC.Iface.Make.html#mkIfaceAnnotation"><span class="hs-identifier hs-var hs-var">mkIfaceAnnotation</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ann_target :: Annotation -&gt; CoreAnnTarget
</span><a href="GHC.Types.Annotations.html#ann_target"><span class="hs-identifier hs-var">ann_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145578"><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621683145578"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ann_value :: Annotation -&gt; AnnPayload
</span><a href="GHC.Types.Annotations.html#ann_value"><span class="hs-identifier hs-var">ann_value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683145580"><span class="annot"><span class="annottext">AnnPayload
</span><a href="#local-6989586621683145580"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceAnnotation"><span class="hs-identifier hs-type">IfaceAnnotation</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-510"></span><span>        </span><span class="annot"><span class="annottext">ifAnnotatedTarget :: IfaceAnnTarget
</span><a href="GHC.Iface.Syntax.html#ifAnnotatedTarget"><span class="hs-identifier hs-var">ifAnnotatedTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; CoreAnnTarget -&gt; IfaceAnnTarget
forall a b. (a -&gt; b) -&gt; AnnTarget a -&gt; AnnTarget b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621683145578"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-511"></span><span>        </span><span class="annot"><span class="annottext">ifAnnotatedValue :: AnnPayload
</span><a href="GHC.Iface.Syntax.html#ifAnnotatedValue"><span class="hs-identifier hs-var">ifAnnotatedValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnPayload
</span><a href="#local-6989586621683145580"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceImports"><span class="hs-identifier hs-type">mkIfaceImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier hs-type">ImportUserSpec</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceImport"><span class="hs-identifier hs-type">IfaceImport</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-515"></span><span id="mkIfaceImports"><span class="annot"><span class="annottext">mkIfaceImports :: [ImportUserSpec] -&gt; [IfaceImport]
</span><a href="GHC.Iface.Make.html#mkIfaceImports"><span class="hs-identifier hs-var hs-var">mkIfaceImports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImportUserSpec -&gt; IfaceImport)
-&gt; [ImportUserSpec] -&gt; [IfaceImport]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ImportUserSpec -&gt; IfaceImport
</span><a href="#local-6989586621683145584"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-517"></span><span>    </span><span id="local-6989586621683145584"><span class="annot"><span class="annottext">go :: ImportUserSpec -&gt; IfaceImport
</span><a href="#local-6989586621683145584"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ImpUserSpec"><span class="hs-identifier hs-type">ImpUserSpec</span></a></span><span> </span><span id="local-6989586621683145586"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683145586"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="annot"><span class="annottext">ImpUserList
</span><a href="GHC.Tc.Types.html#ImpUserAll"><span class="hs-identifier hs-var">ImpUserAll</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; ImpIfaceList -&gt; IfaceImport
</span><a href="GHC.Iface.Syntax.html#IfaceImport"><span class="hs-identifier hs-var">IfaceImport</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683145586"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">ImpIfaceList
</span><a href="GHC.Iface.Syntax.html#ImpIfaceAll"><span class="hs-identifier hs-var">ImpIfaceAll</span></a></span><span>
</span><span id="line-518"></span><span>    </span><span class="annot"><a href="#local-6989586621683145584"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ImpUserSpec"><span class="hs-identifier hs-type">ImpUserSpec</span></a></span><span> </span><span id="local-6989586621683145590"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683145590"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ImpUserExplicit"><span class="hs-identifier hs-type">ImpUserExplicit</span></a></span><span> </span><span id="local-6989586621683145592"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145592"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; ImpIfaceList -&gt; IfaceImport
</span><a href="GHC.Iface.Syntax.html#IfaceImport"><span class="hs-identifier hs-var">IfaceImport</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683145590"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfGlobalRdrEnv -&gt; ImpIfaceList
</span><a href="GHC.Iface.Syntax.html#ImpIfaceExplicit"><span class="hs-identifier hs-var">ImpIfaceExplicit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; IfGlobalRdrEnv
forall info. GlobalRdrEnvX info -&gt; IfGlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#forceGlobalRdrEnv"><span class="hs-identifier hs-var">forceGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683145592"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>    </span><span class="annot"><a href="#local-6989586621683145584"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ImpUserSpec"><span class="hs-identifier hs-type">ImpUserSpec</span></a></span><span> </span><span id="local-6989586621683145594"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683145594"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ImpUserEverythingBut"><span class="hs-identifier hs-type">ImpUserEverythingBut</span></a></span><span> </span><span id="local-6989586621683145596"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683145596"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; ImpIfaceList -&gt; IfaceImport
</span><a href="GHC.Iface.Syntax.html#IfaceImport"><span class="hs-identifier hs-var">IfaceImport</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683145594"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet -&gt; ImpIfaceList
</span><a href="GHC.Iface.Syntax.html#ImpIfaceEverythingBut"><span class="hs-identifier hs-var">ImpIfaceEverythingBut</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683145596"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="annot"><a href="GHC.Iface.Make.html#mkIfaceExports"><span class="hs-identifier hs-type">mkIfaceExports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#IfaceExport"><span class="hs-identifier hs-type">IfaceExport</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Sort to make canonical</span><span>
</span><span id="line-522"></span><span id="mkIfaceExports"><span class="annot"><span class="annottext">mkIfaceExports :: [AvailInfo] -&gt; [AvailInfo]
</span><a href="GHC.Iface.Make.html#mkIfaceExports"><span class="hs-identifier hs-var hs-var">mkIfaceExports</span></a></span></span><span> </span><span id="local-6989586621683145599"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683145599"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[AvailInfo] -&gt; DetOrdAvails
</span><a href="GHC.Types.Avail.html#sortAvails"><span class="hs-identifier hs-var">sortAvails</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683145599"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html#DefinitelyDeterministicAvails"><span class="hs-identifier hs-type">DefinitelyDeterministicAvails</span></a></span><span> </span><span id="local-6989586621683145602"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683145602"><span class="hs-identifier hs-var">sas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683145602"><span class="hs-identifier hs-var">sas</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-comment">{-
Note [Original module]
~~~~~~~~~~~~~~~~~~~~~
Consider this:
        module X where { data family T }
        module Y( T(..) ) where { import X; data instance T Int = MkT Int }
The exported Avail from Y will look like
        X.T{X.T, Y.MkT}
That is, in Y,
  - only MkT is brought into scope by the data instance;
  - but the parent (used for grouping and naming in T(..) exports) is X.T
  - and in this case we export X.T too

In the result of mkIfaceExports, the names are grouped by defining module,
so we may need to split up a single Avail into multiple ones.
-}</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-comment">{-
Note [Sharing of ModIface]
~~~~~~~~~~~~~~~~~~~~~~~~~~
A 'ModIface' contains many duplicated values such as 'Name', 'FastString' and 'IfaceType'.
'Name's and 'FastString's are already deduplicated by default using the 'NameCache' and
'FastStringTable' respectively.
However, 'IfaceType' can be quite expensive in terms of memory usage.
To improve the sharing of 'IfaceType', we introduced deduplication tables during
serialisation of 'ModIface', see Note [Deduplication during iface binary serialisation].

We can improve the sharing of 'ModIface' at run-time as well, by serialising the 'ModIface' to
an in-memory buffer, and then deserialising it again.
This implicitly shares duplicated values.

To avoid re-serialising the 'ModIface' when writing it to disk, we save the serialised 'ModIface' buffer
in 'mi_hi_bytes_' field of said 'ModIface'. This buffer is written to disk directly in 'putIfaceWithExtFields'.
If we have to modify the 'ModIface' after 'shareIface' is called, the buffer needs to be discarded.
-}</span><span>
</span><span id="line-559"></span></pre></body></html>