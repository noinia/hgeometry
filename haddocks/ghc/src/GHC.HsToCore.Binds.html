<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Pattern-matching bindings (HsBinds and MonoBinds)

Handles @HsBinds@; those at the top level require different handling,
in that the @Rec@/@NonRec@/etc structure is thrown away (whereas at
lower levels it is preserved with @let@/@letrec@s).
-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html"><span class="hs-identifier">GHC.HsToCore.Binds</span></a></span><span>
</span><span id="line-18"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTopLHsBinds"><span class="hs-identifier">dsTopLHsBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsLHsBinds"><span class="hs-identifier">dsLHsBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#decomposeRuleLhs"><span class="hs-identifier">decomposeRuleLhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsSpec"><span class="hs-identifier">dsSpec</span></a></span><span>
</span><span id="line-19"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier">dsHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrappers"><span class="hs-identifier">dsHsWrappers</span></a></span><span>
</span><span id="line-20"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier">dsEvTerm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTcEvBinds"><span class="hs-identifier">dsTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTcEvBinds_s"><span class="hs-identifier">dsTcEvBinds_s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvBinds"><span class="hs-identifier">dsEvBinds</span></a></span><span>
</span><span id="line-21"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsWarnOrphanRule"><span class="hs-identifier">dsWarnOrphanRule</span></a></span><span>
</span><span id="line-22"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.html"><span class="hs-identifier">GHC.Driver.Config</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.HsToCore.Expr.html"><span class="hs-identifier">GHC.HsToCore.Expr</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier">dsLExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.HsToCore.Match.html"><span class="hs-identifier">GHC.HsToCore.Match</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.html#matchWrapper"><span class="hs-identifier">matchWrapper</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Utils.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Utils</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier">tracePm</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html"><span class="hs-identifier">GHC.HsToCore.Errors.Types</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.GuardedRHSs.html"><span class="hs-identifier">GHC.HsToCore.GuardedRHSs</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html"><span class="hs-identifier">GHC.HsToCore.Utils</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.html"><span class="hs-identifier">GHC.HsToCore.Pmc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.html#addTyCs"><span class="hs-identifier">addTyCs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.html#pmcGRHSs"><span class="hs-identifier">pmcGRHSs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>             </span><span class="hs-comment">-- lots of things</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>           </span><span class="hs-comment">-- lots of things</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.SimpleOpt.html"><span class="hs-identifier">GHC.Core.SimpleOpt</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.SimpleOpt.html#simpleOptExpr"><span class="hs-identifier">simpleOptExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.OccurAnal.html"><span class="hs-identifier">GHC.Core.Opt.OccurAnal</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.OccurAnal.html#occurAnalyseExpr"><span class="hs-identifier">occurAnalyseExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier">CanonicalEvidence</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Arity.html"><span class="hs-identifier">GHC.Core.Opt.Arity</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Arity.html#etaExpand"><span class="hs-identifier">etaExpand</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unfold.Make.html"><span class="hs-identifier">GHC.Core.Unfold.Make</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FVs.html"><span class="hs-identifier">GHC.Core.FVs</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html"><span class="hs-identifier">GHC.Core.Rules</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html"><span class="hs-identifier">GHC.Core.TyCo.Compare</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier">eqType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#naturalTy"><span class="hs-identifier">naturalTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#typeSymbolKind"><span class="hs-identifier">typeSymbolKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#charTy"><span class="hs-identifier">charTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html#nospecId"><span class="hs-identifier">nospecId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier">EvVar</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier">nonDetEltsUniqSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html"><span class="hs-identifier">GHC.Data.Graph.Directed</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><span class="hs-comment">{-**********************************************************************
*                                                                      *
           Desugaring a MonoBinds
*                                                                      *
**********************************************************************-}</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | Desugar top level binds, strict binds are treated like normal</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- binds since there is no good time to force before first usage.</span><span>
</span><span id="line-97"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTopLHsBinds"><span class="hs-identifier hs-type">dsTopLHsBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span id="dsTopLHsBinds"><span class="annot"><span class="annottext">dsTopLHsBinds :: LHsBinds GhcTc -&gt; DsM (OrdList (EvVar, CoreExpr))
</span><a href="GHC.HsToCore.Binds.html#dsTopLHsBinds"><span class="hs-identifier hs-var hs-var">dsTopLHsBinds</span></a></span></span><span> </span><span id="local-6989586621683130232"><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683130232"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-99"></span><span>     </span><span class="hs-comment">-- see Note [Strict binds checks]</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130235"><span class="hs-identifier hs-var">unlifted_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130237"><span class="hs-identifier hs-var">bang_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) ())
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindsType
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall {a}.
HasLoc a =&gt;
BindsType
-&gt; GenLocated a (HsBindLR GhcTc GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="#local-6989586621683130239"><span class="hs-identifier hs-var">top_level_err</span></a></span><span> </span><span class="annot"><span class="annottext">BindsType
</span><a href="GHC.HsToCore.Errors.Types.html#UnliftedTypeBinds"><span class="hs-identifier hs-var">UnliftedTypeBinds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130235"><span class="hs-identifier hs-var">unlifted_binds</span></a></span><span>
</span><span id="line-102"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) ())
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindsType
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall {a}.
HasLoc a =&gt;
BindsType
-&gt; GenLocated a (HsBindLR GhcTc GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="#local-6989586621683130239"><span class="hs-identifier hs-var">top_level_err</span></a></span><span> </span><span class="annot"><span class="annottext">BindsType
</span><a href="GHC.HsToCore.Errors.Types.html#StrictBinds"><span class="hs-identifier hs-var">StrictBinds</span></a></span><span class="hs-special">)</span><span>       </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130237"><span class="hs-identifier hs-var">bang_binds</span></a></span><span>
</span><span id="line-103"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OrdList (EvVar, CoreExpr) -&gt; DsM (OrdList (EvVar, CoreExpr))
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList (EvVar, CoreExpr)
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130243"><span class="annot"><a href="#local-6989586621683130243"><span class="hs-identifier hs-var">force_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130244"><span class="annot"><a href="#local-6989586621683130244"><span class="hs-identifier hs-var">prs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc -&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
</span><a href="GHC.HsToCore.Binds.html#dsLHsBinds"><span class="hs-identifier hs-var">dsLHsBinds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683130232"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-107"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-type">debugIsOn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-108"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130246"><span class="annot"><a href="#local-6989586621683130246"><span class="hs-identifier hs-var">xstrict</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Strict</span></span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683130243"><span class="hs-identifier hs-type">force_vars</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621683130246"><span class="hs-identifier hs-type">xstrict</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130232"><span class="hs-identifier hs-type">binds</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130243"><span class="hs-identifier hs-type">force_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-110"></span><span>              </span><span class="hs-comment">-- with -XStrict, even top-level vars are listed as force vars.</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130244"><span class="hs-identifier hs-type">prs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621683130235"><span class="annot"><span class="annottext">unlifted_binds :: [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130235"><span class="hs-identifier hs-var hs-var">unlifted_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc -&gt; Bool
</span><a href="GHC.Hs.Utils.html#isUnliftedHsBind"><span class="hs-identifier hs-var">isUnliftedHsBind</span></a></span><span> </span><span class="annot"><span class="annottext">(HsBindLR GhcTc GhcTc -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
    -&gt; HsBindLR GhcTc GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
-&gt; HsBindLR GhcTc GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130232"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621683130237"><span class="annot"><span class="annottext">bang_binds :: [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130237"><span class="hs-identifier hs-var hs-var">bang_binds</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc -&gt; Bool
</span><a href="GHC.Hs.Utils.html#isBangedHsBind"><span class="hs-identifier hs-var">isBangedHsBind</span></a></span><span>   </span><span class="annot"><span class="annottext">(HsBindLR GhcTc GhcTc -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
    -&gt; HsBindLR GhcTc GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
-&gt; HsBindLR GhcTc GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130232"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621683130239"><span class="annot"><span class="annottext">top_level_err :: BindsType
-&gt; GenLocated a (HsBindLR GhcTc GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="#local-6989586621683130239"><span class="hs-identifier hs-var hs-var">top_level_err</span></a></span></span><span> </span><span id="local-6989586621683130259"><span class="annot"><span class="annottext">BindsType
</span><a href="#local-6989586621683130259"><span class="hs-identifier hs-var">bindsType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683130261"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130261"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683130262"><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc
</span><a href="#local-6989586621683130262"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130261"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env DsGblEnv DsLclEnv) ()
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) ())
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><span class="annottext">DsMessage -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindsType -&gt; HsBindLR GhcTc GhcTc -&gt; DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsTopLevelBindsNotAllowed"><span class="hs-identifier hs-var">DsTopLevelBindsNotAllowed</span></a></span><span> </span><span class="annot"><span class="annottext">BindsType
</span><a href="#local-6989586621683130259"><span class="hs-identifier hs-var">bindsType</span></a></span><span> </span><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc
</span><a href="#local-6989586621683130262"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-comment">{-
Note [Return non-recursive bindings in dependency order]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For recursive bindings, the desugarer has no choice: it returns a single big
Rec{...} group.

But for /non-recursive/ bindings, the desugarer guarantees to desugar them to
a sequence of non-recurive Core bindings, in dependency order.

Why is this important?  Partly it saves a bit of work in the first run of the
occurrence analyser. But more importantly, for linear types, non-recursive lets
can be linear whereas recursive-let can't. Since we check the output of the
desugarer for linearity (see also Note [Linting linearity]), desugaring
non-recursive lets to recursive lets would break linearity checks. An
alternative is to refine the typing rule for recursive lets so that we don't
have to care (see in particular #23218 and #18694), but the outcome of this line
of work is still unclear. In the meantime, being a little precise in the
desugarer is cheap. (paragraph written on 2023-06-09)

In dsLHSBinds (and dependencies), a single binding can be desugared to multiple
bindings. For instance because the source binding has the {-# SPECIALIZE #-}
pragma. In:

f _ = &#8230;
 where
  {-# SPECIALIZE g :: F Int -&gt; F Int #-}
  g :: C a =&gt; F a -&gt; F a
  g _ = &#8230;

The g binding desugars to

let {
  $sg = &#8230; } in

  g
  [RULES: &quot;SPEC g&quot; g @Int $dC = $sg]
  g = &#8230;

In order to avoid generating a letrec that will immediately be reordered, we
make sure to return the binding in dependency order [$sg, g].

-}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | Desugar all other kind of bindings, Ids of strict binds are returned to</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- later be forced in the binding group body, see Note [Desugar Strict binds]</span><span>
</span><span id="line-166"></span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- Invariant: the desugared bindings are returned in dependency order,</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- see Note [Return non-recursive bindings in dependency order]</span><span>
</span><span id="line-169"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsLHsBinds"><span class="hs-identifier hs-type">dsLHsBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span id="dsLHsBinds"><span class="annot"><span class="annottext">dsLHsBinds :: LHsBinds GhcTc -&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
</span><a href="GHC.HsToCore.Binds.html#dsLHsBinds"><span class="hs-identifier hs-var hs-var">dsLHsBinds</span></a></span></span><span> </span><span id="local-6989586621683130267"><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683130267"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130268"><span class="annot"><a href="#local-6989586621683130268"><span class="hs-identifier hs-var">ds_bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
 -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [([EvVar], [(EvVar, CoreExpr)])]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">LHsBind GhcTc -&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
</span><a href="GHC.HsToCore.Binds.html#dsLHsBind"><span class="hs-identifier hs-var">dsLHsBind</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683130267"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-172"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683130272"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130272"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130273"><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130273"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130274"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130274"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130275"><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130275"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130272"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar] -&gt; [EvVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130274"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130273"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130275"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>                         </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683130268"><span class="hs-identifier hs-type">ds_bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-176"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsLHsBind"><span class="hs-identifier hs-type">dsLHsBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span id="dsLHsBind"><span class="annot"><span class="annottext">dsLHsBind :: LHsBind GhcTc -&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
</span><a href="GHC.HsToCore.Binds.html#dsLHsBind"><span class="hs-identifier hs-var hs-var">dsLHsBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683130276"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683130276"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683130277"><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc
</span><a href="#local-6989586621683130277"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683130278"><span class="annot"><a href="#local-6989586621683130278"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-179"></span><span>                            </span><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-type">putSrcSpanDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130276"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsBind"><span class="hs-identifier hs-type">dsHsBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130278"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130277"><span class="hs-identifier hs-type">bind</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | Desugar a single binding (or group of recursive binds).</span><span>
</span><span id="line-182"></span><span class="hs-comment">--</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- Invariant: the desugared bindings are returned in dependency order,</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- see Note [Return non-recursive bindings in dependency order]</span><span>
</span><span id="line-185"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsBind"><span class="hs-identifier hs-type">dsHsBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-186"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsBind"><span class="hs-identifier hs-type">HsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-187"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>         </span><span class="hs-comment">-- ^ The Ids of strict binds, to be forced in the body of the</span><span>
</span><span id="line-189"></span><span>         </span><span class="hs-comment">-- binding group see Note [Desugar Strict binds] and all</span><span>
</span><span id="line-190"></span><span>         </span><span class="hs-comment">-- bindings and their desugared right hand sides.</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span id="dsHsBind"><span class="annot"><span class="annottext">dsHsBind :: DynFlags
-&gt; HsBindLR GhcTc GhcTc -&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
</span><a href="GHC.HsToCore.Binds.html#dsHsBind"><span class="hs-identifier hs-var hs-var">dsHsBind</span></a></span></span><span> </span><span id="local-6989586621683130282"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130282"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#VarBind"><span class="hs-identifier hs-type">VarBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">var_id :: forall idL idR. HsBindLR idL idR -&gt; IdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#var_id"><span class="hs-identifier hs-var">var_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130285"><span class="annot"><span class="annottext">IdP GhcTc
</span><a href="#local-6989586621683130285"><span class="hs-identifier hs-var">var</span></a></span></span><span>
</span><span id="line-193"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">var_rhs :: forall idL idR. HsBindLR idL idR -&gt; LHsExpr idR
</span><a href="Language.Haskell.Syntax.Binds.html#var_rhs"><span class="hs-identifier hs-var">var_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130287"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683130287"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130288"><span class="annot"><a href="#local-6989586621683130288"><span class="hs-identifier hs-var">core_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683130287"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-195"></span><span>                </span><span class="hs-comment">-- Dictionary bindings are always VarBinds,</span><span>
</span><span id="line-196"></span><span>                </span><span class="hs-comment">-- so we only need do this here</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130289"><span class="annot"><a href="#local-6989586621683130289"><span class="hs-identifier hs-var">core_bind</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683130290"><span class="annot"><a href="#local-6989586621683130290"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#makeCorePair"><span class="hs-identifier hs-type">makeCorePair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130282"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130285"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621683130288"><span class="hs-identifier hs-type">core_expr</span></a></span><span>
</span><span id="line-198"></span><span>              </span><span id="local-6989586621683130292"><span class="annot"><a href="#local-6989586621683130292"><span class="hs-identifier hs-var hs-var">force_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.Strict</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130282"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-199"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130290"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-200"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130292"><span class="hs-identifier hs-type">force_var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683130289"><span class="hs-identifier hs-type">core_bind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsBind"><span class="hs-identifier hs-var">dsHsBind</span></a></span><span> </span><span id="local-6989586621683130294"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130294"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683130295"><span class="annot"><span class="annottext">b :: HsBindLR GhcTc GhcTc
</span><a href="#local-6989586621683130295"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683130298"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683130298"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683130299"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130299"><span class="hs-identifier hs-var">fun</span></a></span></span><span>
</span><span id="line-204"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_matches :: forall idL idR. HsBindLR idL idR -&gt; MatchGroup idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130301"><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621683130301"><span class="hs-identifier hs-var">matches</span></a></span></span><span>
</span><span id="line-205"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_ext :: forall idL idR. HsBindLR idL idR -&gt; XFunBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#fun_ext"><span class="hs-identifier hs-var">fun_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130303"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130303"><span class="hs-identifier hs-var">co_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130304"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683130304"><span class="hs-identifier hs-var">tick</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>                           </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsWrapper
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a. HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-var">dsHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130303"><span class="hs-identifier hs-var">co_fn</span></a></span><span> </span><span class="annot"><span class="annottext">(((CoreExpr -&gt; CoreExpr) -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
 -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130305"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130305"><span class="hs-identifier hs-var">core_wrap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130306"><span class="annot"><a href="#local-6989586621683130306"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130307"><span class="annot"><a href="#local-6989586621683130307"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; Bag EvVar -&gt; DsM ([EvVar], CoreExpr) -&gt; DsM ([EvVar], CoreExpr)
forall a. Origin -&gt; Bag EvVar -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Pmc.html#addTyCs"><span class="hs-identifier hs-var">addTyCs</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#FromSource"><span class="hs-identifier hs-var">FromSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Bag EvVar
</span><a href="GHC.Tc.Types.Evidence.html#hsWrapDictBinders"><span class="hs-identifier hs-var">hsWrapDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130303"><span class="hs-identifier hs-var">co_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DsM ([EvVar], CoreExpr) -&gt; DsM ([EvVar], CoreExpr))
-&gt; DsM ([EvVar], CoreExpr) -&gt; DsM ([EvVar], CoreExpr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-209"></span><span>                          </span><span class="hs-comment">-- FromSource might not be accurate (we don't have any</span><span>
</span><span id="line-210"></span><span>                          </span><span class="hs-comment">-- origin annotations for things in this module), but at</span><span>
</span><span id="line-211"></span><span>                          </span><span class="hs-comment">-- worst we do superfluous calls to the pattern match</span><span>
</span><span id="line-212"></span><span>                          </span><span class="hs-comment">-- oracle.</span><span>
</span><span id="line-213"></span><span>                          </span><span class="hs-comment">-- addTyCs: Add type evidence to the refinement type</span><span>
</span><span id="line-214"></span><span>                          </span><span class="hs-comment">--            predicate of the coverage checker</span><span>
</span><span id="line-215"></span><span>                          </span><span class="hs-comment">-- See Note [Long-distance information] in &quot;GHC.HsToCore.Pmc&quot;</span><span>
</span><span id="line-216"></span><span>                          </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; Maybe [LHsExpr GhcTc]
-&gt; MatchGroup GhcTc (LHsExpr GhcTc)
-&gt; DsM ([EvVar], CoreExpr)
</span><a href="GHC.HsToCore.Match.html#matchWrapper"><span class="hs-identifier hs-var">matchWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
-&gt; AnnFunRhs -&gt; HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. fn -&gt; AnnFunRhs -&gt; HsMatchContext fn
</span><a href="GHC.Hs.Utils.html#mkPrefixFunRhs"><span class="hs-identifier hs-var">mkPrefixFunRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683130298"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130299"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnFunRhs
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [LHsExpr GhcTc]
Maybe [GenLocated SrcSpanAnnA (HsExpr GhcTc)]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621683130301"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130313"><span class="annot"><a href="#local-6989586621683130313"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkOptTickBox"><span class="hs-identifier hs-var">mkOptTickBox</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683130304"><span class="hs-identifier hs-var">tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130307"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-219"></span><span>              </span><span id="local-6989586621683130315"><span class="annot"><a href="#local-6989586621683130315"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130305"><span class="hs-identifier hs-var">core_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130306"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130313"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>              </span><span id="local-6989586621683130317"><span class="annot"><a href="#local-6989586621683130317"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683130318"><span class="annot"><a href="#local-6989586621683130318"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#makeCorePair"><span class="hs-identifier hs-type">makeCorePair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130294"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130299"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621683130315"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-221"></span><span>              </span><span id="local-6989586621683130319"><span class="annot"><a href="#local-6989586621683130319"><span class="hs-identifier hs-var hs-var">force_var</span></a></span></span><span>
</span><span id="line-222"></span><span>                  </span><span class="hs-comment">-- Bindings are strict when -XStrict is enabled</span><span>
</span><span id="line-223"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.Strict</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130294"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-224"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)) -&gt; Arity
forall (id :: Pass) body. MatchGroup (GhcPass id) body -&gt; Arity
</span><a href="GHC.Hs.Expr.html#matchGroupArity"><span class="hs-identifier hs-var">matchGroupArity</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683130301"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- no need to force lambdas</span><span>
</span><span id="line-225"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130318"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc -&gt; Bool
</span><a href="GHC.Hs.Utils.html#isBangedHsBind"><span class="hs-identifier hs-var">isBangedHsBind</span></a></span><span> </span><span class="annot"><span class="annottext">HsBindLR GhcTc GhcTc
</span><a href="#local-6989586621683130295"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-227"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130318"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-229"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-comment">--pprTrace &quot;dsHsBind&quot; (vcat [ ppr fun &lt;+&gt; ppr (idInlinePragma fun)</span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-comment">--                          , ppr (mg_alts matches)</span><span>
</span><span id="line-232"></span><span>          </span><span class="hs-comment">--                          , ppr args, ppr core_binds, ppr body']) $</span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130319"><span class="hs-identifier hs-type">force_var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683130317"><span class="hs-identifier hs-type">core_binds</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsBind"><span class="hs-identifier hs-var">dsHsBind</span></a></span><span> </span><span id="local-6989586621683130321"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130321"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatBind"><span class="hs-identifier hs-type">PatBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_lhs :: forall idL idR. HsBindLR idL idR -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Binds.html#pat_lhs"><span class="hs-identifier hs-var">pat_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130324"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683130324"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_rhs :: forall idL idR. HsBindLR idL idR -&gt; GRHSs idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#pat_rhs"><span class="hs-identifier hs-var">pat_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130326"><span class="annot"><span class="annottext">GRHSs GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621683130326"><span class="hs-identifier hs-var">grhss</span></a></span></span><span>
</span><span id="line-236"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_ext :: forall idL idR. HsBindLR idL idR -&gt; XPatBind idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#pat_ext"><span class="hs-identifier hs-var">pat_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130328"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130328"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130329"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683130329"><span class="hs-identifier hs-var">rhs_tick</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130330"><span class="annot"><span class="annottext">[[CoreTickish]]
</span><a href="#local-6989586621683130330"><span class="hs-identifier hs-var">var_ticks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>                         </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130331"><span class="annot"><a href="#local-6989586621683130331"><span class="hs-identifier hs-var">rhss_nablas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; GRHSs GhcTc (LHsExpr GhcTc) -&gt; DsM (NonEmpty Nablas)
</span><a href="GHC.HsToCore.Pmc.html#pmcGRHSs"><span class="hs-identifier hs-var">pmcGRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. HsMatchContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#PatBindGuards"><span class="hs-identifier hs-var">PatBindGuards</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621683130326"><span class="hs-identifier hs-var">grhss</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130333"><span class="annot"><a href="#local-6989586621683130333"><span class="hs-identifier hs-var">body_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.GuardedRHSs.html#dsGuarded"><span class="hs-identifier hs-type">dsGuarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130326"><span class="hs-identifier hs-type">grhss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130328"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130331"><span class="hs-identifier hs-type">rhss_nablas</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130335"><span class="annot"><a href="#local-6989586621683130335"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkOptTickBox"><span class="hs-identifier hs-var">mkOptTickBox</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683130329"><span class="hs-identifier hs-var">rhs_tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130333"><span class="hs-identifier hs-var">body_expr</span></a></span><span>
</span><span id="line-241"></span><span>              </span><span id="local-6989586621683130336"><span class="annot"><a href="#local-6989586621683130336"><span class="hs-identifier hs-var hs-var">pat'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; LPat GhcTc -&gt; LPat GhcTc
</span><a href="GHC.HsToCore.Utils.html#decideBangHood"><span class="hs-identifier hs-var">decideBangHood</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130321"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683130324"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130338"><span class="annot"><a href="#local-6989586621683130338"><span class="hs-identifier hs-var">force_var</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683130339"><span class="annot"><a href="#local-6989586621683130339"><span class="hs-identifier hs-var">sel_binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkSelectorBinds"><span class="hs-identifier hs-type">mkSelectorBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130330"><span class="hs-identifier hs-type">var_ticks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130324"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#PatBindRhs"><span class="hs-identifier hs-type">PatBindRhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130335"><span class="hs-identifier hs-type">body'</span></a></span><span>
</span><span id="line-243"></span><span>          </span><span class="hs-comment">-- We silently ignore inline pragmas; no makeCorePair</span><span>
</span><span id="line-244"></span><span>          </span><span class="hs-comment">-- Not so cool, but really doesn't matter</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130342"><span class="annot"><a href="#local-6989586621683130342"><span class="hs-identifier hs-var hs-var">force_var'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; Bool
forall (p :: Pass). LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Hs.Pat.html#isBangedLPat"><span class="hs-identifier hs-var">isBangedLPat</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683130336"><span class="hs-identifier hs-var">pat'</span></a></span><span>
</span><span id="line-246"></span><span>                           </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130338"><span class="hs-identifier hs-var">force_var</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-247"></span><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130342"><span class="hs-identifier hs-type">force_var'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130339"><span class="hs-identifier hs-type">sel_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsBind"><span class="hs-identifier hs-var">dsHsBind</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621683130344"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130344"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XHsBindsLR"><span class="hs-identifier hs-type">XHsBindsLR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#AbsBinds"><span class="hs-identifier hs-type">AbsBinds</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abs_tvs :: AbsBinds -&gt; [EvVar]
</span><a href="GHC.Hs.Binds.html#abs_tvs"><span class="hs-identifier hs-var">abs_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130348"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130348"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_ev_vars :: AbsBinds -&gt; [EvVar]
</span><a href="GHC.Hs.Binds.html#abs_ev_vars"><span class="hs-identifier hs-var">abs_ev_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130350"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130350"><span class="hs-identifier hs-var">dicts</span></a></span></span><span>
</span><span id="line-253"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_exports :: AbsBinds -&gt; [ABExport]
</span><a href="GHC.Hs.Binds.html#abs_exports"><span class="hs-identifier hs-var">abs_exports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130352"><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130352"><span class="hs-identifier hs-var">exports</span></a></span></span><span>
</span><span id="line-254"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_ev_binds :: AbsBinds -&gt; [TcEvBinds]
</span><a href="GHC.Hs.Binds.html#abs_ev_binds"><span class="hs-identifier hs-var">abs_ev_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130354"><span class="annot"><span class="annottext">[TcEvBinds]
</span><a href="#local-6989586621683130354"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span>
</span><span id="line-255"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_binds :: AbsBinds -&gt; LHsBinds GhcTc
</span><a href="GHC.Hs.Binds.html#abs_binds"><span class="hs-identifier hs-var">abs_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130356"><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683130356"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_sig :: AbsBinds -&gt; Bool
</span><a href="GHC.Hs.Binds.html#abs_sig"><span class="hs-identifier hs-var">abs_sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130358"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130358"><span class="hs-identifier hs-var">has_sig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcEvBinds]
-&gt; ([CoreBind] -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a. [TcEvBinds] -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsTcEvBinds_s"><span class="hs-identifier hs-var">dsTcEvBinds_s</span></a></span><span> </span><span class="annot"><span class="annottext">[TcEvBinds]
</span><a href="#local-6989586621683130354"><span class="hs-identifier hs-var">ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(([CoreBind] -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
 -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; ([CoreBind] -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130359"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130359"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130360"><span class="annot"><a href="#local-6989586621683130360"><span class="hs-identifier hs-var">ds_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; Bag EvVar
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a. Origin -&gt; Bag EvVar -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Pmc.html#addTyCs"><span class="hs-identifier hs-var">addTyCs</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#FromSource"><span class="hs-identifier hs-var">FromSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; Bag EvVar
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130350"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DsM ([EvVar], [(EvVar, CoreExpr)])
 -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-258"></span><span>                     </span><span class="annot"><span class="annottext">LHsBinds GhcTc -&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
</span><a href="GHC.HsToCore.Binds.html#dsLHsBinds"><span class="hs-identifier hs-var">dsLHsBinds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683130356"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-259"></span><span>             </span><span class="hs-comment">-- addTyCs: push type constraints deeper</span><span>
</span><span id="line-260"></span><span>             </span><span class="hs-comment">--            for inner pattern match check</span><span>
</span><span id="line-261"></span><span>             </span><span class="hs-comment">-- See Check, Note [Long-distance information]</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- dsAbsBinds does the hard work</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsAbsBinds"><span class="hs-identifier hs-type">dsAbsBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130344"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130348"><span class="hs-identifier hs-type">tyvars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130350"><span class="hs-identifier hs-type">dicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130352"><span class="hs-identifier hs-type">exports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130359"><span class="hs-identifier hs-type">ds_ev_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130360"><span class="hs-identifier hs-type">ds_binds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-type">isSingleton</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130356"><span class="hs-identifier hs-type">binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683130358"><span class="hs-identifier hs-type">has_sig</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsBind"><span class="hs-identifier hs-var">dsHsBind</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#PatSynBind"><span class="hs-identifier hs-type">PatSynBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsHsBind: PatSynBind&quot;</span></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-269"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsAbsBinds"><span class="hs-identifier hs-type">dsAbsBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-270"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Binds.html#ABExport"><span class="hs-identifier hs-type">ABExport</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- Desugared evidence bindings</span><span>
</span><span id="line-272"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Desugared value bindings</span><span>
</span><span id="line-273"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                      </span><span class="hs-comment">-- Single source binding</span><span>
</span><span id="line-274"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                      </span><span class="hs-comment">-- Single binding with signature</span><span>
</span><span id="line-275"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span id="dsAbsBinds"><span class="annot"><span class="annottext">dsAbsBinds :: DynFlags
-&gt; [EvVar]
-&gt; [EvVar]
-&gt; [ABExport]
-&gt; [CoreBind]
-&gt; ([EvVar], [(EvVar, CoreExpr)])
-&gt; Bool
-&gt; Bool
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
</span><a href="GHC.HsToCore.Binds.html#dsAbsBinds"><span class="hs-identifier hs-var hs-var">dsAbsBinds</span></a></span></span><span> </span><span id="local-6989586621683130367"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130367"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683130368"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130368"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span> </span><span id="local-6989586621683130369"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span id="local-6989586621683130370"><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130370"><span class="hs-identifier hs-var">exports</span></a></span></span><span>
</span><span id="line-278"></span><span>           </span><span id="local-6989586621683130371"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130371"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130372"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130372"><span class="hs-identifier hs-var">force_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130373"><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130373"><span class="hs-identifier hs-var">bind_prs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130374"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130374"><span class="hs-identifier hs-var">is_singleton</span></a></span></span><span> </span><span id="local-6989586621683130375"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130375"><span class="hs-identifier hs-var">has_sig</span></a></span></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-comment">-- A very important common case: one exported variable</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-comment">-- Non-recursive bindings come through this way</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-comment">-- So do self-recursive bindings</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">--    gbl_id = wrap (/\tvs \dicts. let ev_binds</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-comment">--                                 letrec bind_prs</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">--                                 in lcl_id)</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683130376"><span class="annot"><span class="annottext">ABExport
</span><a href="#local-6989586621683130376"><span class="hs-keyword hs-var">export</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130370"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abe_poly :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130379"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130379"><span class="hs-identifier hs-var">global_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_mono :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130381"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130381"><span class="hs-identifier hs-var">local_id</span></a></span></span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_wrap :: ABExport -&gt; HsWrapper
</span><a href="GHC.Hs.Binds.html#abe_wrap"><span class="hs-identifier hs-var">abe_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130383"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130383"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_prags :: ABExport -&gt; TcSpecPrags
</span><a href="GHC.Hs.Binds.html#abe_prags"><span class="hs-identifier hs-var">abe_prags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130385"><span class="annot"><span class="annottext">TcSpecPrags
</span><a href="#local-6989586621683130385"><span class="hs-identifier hs-var">prags</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ABExport
</span><a href="#local-6989586621683130376"><span class="hs-keyword hs-var">export</span></a></span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683130386"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130386"><span class="hs-identifier hs-var">force_vars'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130372"><span class="hs-identifier hs-var">force_vars</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>                           </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; Maybe [EvVar]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-291"></span><span>                           </span><span class="hs-special">[</span><span id="local-6989586621683130387"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130387"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130387"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; EvVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130381"><span class="hs-identifier hs-var">local_id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; Maybe [EvVar]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130379"><span class="hs-identifier hs-var">global_id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-292"></span><span>                           </span><span class="annot"><span class="annottext">[EvVar]
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [EvVar]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-comment">-- If there is a variable to force, it's just the</span><span>
</span><span id="line-294"></span><span>       </span><span class="hs-comment">-- single variable we are binding here</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsWrapper
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a. HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-var">dsHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130383"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(((CoreExpr -&gt; CoreExpr) -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
 -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM ([EvVar], [(EvVar, CoreExpr)]))
-&gt; DsM ([EvVar], [(EvVar, CoreExpr)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130388"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130388"><span class="hs-identifier hs-var">core_wrap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Usually the identity</span><span>
</span><span id="line-296"></span><span>       </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130389"><span class="annot"><span class="annottext">rhs :: CoreExpr
</span><a href="#local-6989586621683130389"><span class="hs-identifier hs-var hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130388"><span class="hs-identifier hs-var">core_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-297"></span><span>                   </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130368"><span class="hs-identifier hs-var">tyvars</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-298"></span><span>                   </span><span class="annot"><span class="annottext">[CoreBind] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLets"><span class="hs-identifier hs-var">mkCoreLets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130371"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-299"></span><span>                   </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130391"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>             </span><span id="local-6989586621683130391"><span class="annot"><span class="annottext">body :: CoreExpr
</span><a href="#local-6989586621683130391"><span class="hs-identifier hs-var hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130375"><span class="hs-identifier hs-var">has_sig</span></a></span><span>
</span><span id="line-302"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130392"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130392"><span class="hs-identifier hs-var">lrhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130373"><span class="hs-identifier hs-var">bind_prs</span></a></span><span>
</span><span id="line-303"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130392"><span class="hs-identifier hs-var">lrhs</span></a></span><span>
</span><span id="line-304"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-305"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)] -&gt; CoreExpr -&gt; CoreExpr
forall b. [(b, Expr b)] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLetRec"><span class="hs-identifier hs-var">mkLetRec</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130373"><span class="hs-identifier hs-var">bind_prs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130381"><span class="hs-identifier hs-var">local_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130395"><span class="annot"><a href="#local-6989586621683130395"><span class="hs-identifier hs-var">spec_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130396"><span class="annot"><a href="#local-6989586621683130396"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; TcSpecPrags -&gt; DsM (OrdList (EvVar, CoreExpr), [CoreRule])
</span><a href="GHC.HsToCore.Binds.html#dsSpecs"><span class="hs-identifier hs-var">dsSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130389"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcSpecPrags
</span><a href="#local-6989586621683130385"><span class="hs-identifier hs-var">prags</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130398"><span class="annot"><a href="#local-6989586621683130398"><span class="hs-identifier hs-var hs-var">global_id'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; [CoreRule] -&gt; EvVar
</span><a href="GHC.Core.Rules.html#addIdSpecialisations"><span class="hs-identifier hs-var">addIdSpecialisations</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130379"><span class="hs-identifier hs-var">global_id</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621683130396"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-310"></span><span>             </span><span id="local-6989586621683130400"><span class="annot"><a href="#local-6989586621683130400"><span class="hs-identifier hs-var hs-var">main_bind</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; EvVar -&gt; Bool -&gt; Arity -&gt; CoreExpr -&gt; (EvVar, CoreExpr)
</span><a href="GHC.HsToCore.Binds.html#makeCorePair"><span class="hs-identifier hs-var">makeCorePair</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130367"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130398"><span class="hs-identifier hs-var">global_id'</span></a></span><span>
</span><span id="line-311"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSpecPrags -&gt; Bool
</span><a href="GHC.Hs.Binds.html#isDefaultMethod"><span class="hs-identifier hs-var">isDefaultMethod</span></a></span><span> </span><span class="annot"><span class="annottext">TcSpecPrags
</span><a href="#local-6989586621683130385"><span class="hs-identifier hs-var">prags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; Arity
</span><a href="GHC.HsToCore.Binds.html#dictArity"><span class="hs-identifier hs-var">dictArity</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130389"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130386"><span class="hs-identifier hs-type">force_vars'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-type">fromOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130395"><span class="hs-identifier hs-type">spec_binds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683130400"><span class="hs-identifier hs-type">main_bind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-comment">-- Another common case: no tyvars, no dicts</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-comment">-- In this case we can have a much simpler desugaring</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">--    lcl_id{inl-prag} = rhs  -- Auxiliary binds</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-comment">--    gbl_id = lcl_id |&gt; co   -- Main binds</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-comment">-- See Note [The no-tyvar no-dict case]</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130368"><span class="hs-identifier hs-var">tyvars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130406"><span class="annot"><span class="annottext">wrap_first_bind :: (b -&gt; b) -&gt; [(a, b)] -&gt; [(a, b)]
</span><a href="#local-6989586621683130406"><span class="hs-identifier hs-var hs-var hs-var">wrap_first_bind</span></a></span></span><span> </span><span id="local-6989586621683130407"><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621683130407"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683130408"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130408"><span class="hs-identifier hs-var">main</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130409"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621683130409"><span class="hs-identifier hs-var">main_rhs</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683130410"><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621683130410"><span class="hs-identifier hs-var">other_binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-324"></span><span>               </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130408"><span class="hs-identifier hs-var">main</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621683130407"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621683130409"><span class="hs-identifier hs-var">main_rhs</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(a, b) -&gt; [(a, b)] -&gt; [(a, b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621683130410"><span class="hs-identifier hs-var">other_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>             </span><span class="annot"><a href="#local-6989586621683130406"><span class="hs-identifier hs-var">wrap_first_bind</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(a, b)]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsAbsBinds received an empty binding list&quot;</span></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>             </span><span class="annot"><a href="#local-6989586621683130411"><span class="hs-identifier hs-type">mk_main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABExport"><span class="hs-identifier hs-type">ABExport</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>             </span><span id="local-6989586621683130411"><span class="annot"><span class="annottext">mk_main :: ABExport -&gt; DsM (EvVar, CoreExpr)
</span><a href="#local-6989586621683130411"><span class="hs-identifier hs-var hs-var hs-var">mk_main</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abe_poly :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130412"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130412"><span class="hs-identifier hs-var">gbl_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_mono :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130413"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130413"><span class="hs-identifier hs-var">lcl_id</span></a></span></span><span>
</span><span id="line-329"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_wrap :: ABExport -&gt; HsWrapper
</span><a href="GHC.Hs.Binds.html#abe_wrap"><span class="hs-identifier hs-var">abe_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130414"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130414"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>                     </span><span class="hs-comment">-- No SpecPrags (no dicts)</span><span>
</span><span id="line-331"></span><span>                     </span><span class="hs-comment">-- Can't be a default method (default methods are singletons)</span><span>
</span><span id="line-332"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsWrapper
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM (EvVar, CoreExpr))
-&gt; DsM (EvVar, CoreExpr)
forall a. HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-var">dsHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130414"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(((CoreExpr -&gt; CoreExpr) -&gt; DsM (EvVar, CoreExpr))
 -&gt; DsM (EvVar, CoreExpr))
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM (EvVar, CoreExpr))
-&gt; DsM (EvVar, CoreExpr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130415"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130415"><span class="hs-identifier hs-var">core_wrap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(EvVar, CoreExpr) -&gt; DsM (EvVar, CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130412"><span class="hs-identifier hs-var">gbl_id</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; InlinePragma -&gt; EvVar
</span><a href="GHC.Types.Id.html#setInlinePragma"><span class="hs-operator hs-var">`setInlinePragma`</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="GHC.Types.Basic.html#defaultInlinePragma"><span class="hs-identifier hs-var">defaultInlinePragma</span></a></span><span>
</span><span id="line-334"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130415"><span class="hs-identifier hs-var">core_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130413"><span class="hs-identifier hs-var">lcl_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130418"><span class="annot"><a href="#local-6989586621683130418"><span class="hs-identifier hs-var">main_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ABExport -&gt; DsM (EvVar, CoreExpr))
-&gt; [ABExport] -&gt; IOEnv (Env DsGblEnv DsLclEnv) [(EvVar, CoreExpr)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ABExport -&gt; DsM (EvVar, CoreExpr)
</span><a href="#local-6989586621683130411"><span class="hs-identifier hs-var">mk_main</span></a></span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130370"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-336"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130419"><span class="annot"><a href="#local-6989586621683130419"><span class="hs-identifier hs-var hs-var">bind_prs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EvVar, CoreExpr) -&gt; (EvVar, CoreExpr))
-&gt; [(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EvVar, CoreExpr) -&gt; (EvVar, CoreExpr)
</span><a href="#local-6989586621683130420"><span class="hs-identifier hs-var">mk_aux_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130373"><span class="hs-identifier hs-var">bind_prs</span></a></span><span>
</span><span id="line-337"></span><span>             </span><span class="hs-comment">-- When there's a single source binding, we wrap the evidence binding in a</span><span>
</span><span id="line-338"></span><span>             </span><span class="hs-comment">-- separate let-rec (DSB1) inside the first desugared binding (DSB2).</span><span>
</span><span id="line-339"></span><span>             </span><span class="hs-comment">-- See Note [The no-tyvar no-dict case].</span><span>
</span><span id="line-340"></span><span>             </span><span id="local-6989586621683130421"><span class="annot"><a href="#local-6989586621683130421"><span class="hs-identifier hs-var hs-var">final_prs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130374"><span class="hs-identifier hs-var">is_singleton</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; [(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)]
forall {b} {a}. (b -&gt; b) -&gt; [(a, b)] -&gt; [(a, b)]
</span><a href="#local-6989586621683130406"><span class="hs-identifier hs-var">wrap_first_bind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreBind] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLets"><span class="hs-identifier hs-var">mkCoreLets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130371"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130419"><span class="hs-identifier hs-var">bind_prs'</span></a></span><span>
</span><span id="line-341"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreBind] -&gt; [(EvVar, CoreExpr)]
forall b. [Bind b] -&gt; [(b, Expr b)]
</span><a href="GHC.Core.html#flattenBinds"><span class="hs-identifier hs-var">flattenBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130371"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130419"><span class="hs-identifier hs-var">bind_prs'</span></a></span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130372"><span class="hs-identifier hs-type">force_vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130421"><span class="hs-identifier hs-type">final_prs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683130418"><span class="hs-identifier hs-type">main_prs</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">-- The general case</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- See Note [Desugaring AbsBinds]</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130423"><span class="annot"><span class="annottext">aux_binds :: CoreBind
</span><a href="#local-6989586621683130423"><span class="hs-identifier hs-var hs-var hs-var">aux_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)] -&gt; CoreBind
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvVar, CoreExpr) -&gt; (EvVar, CoreExpr))
-&gt; [(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EvVar, CoreExpr) -&gt; (EvVar, CoreExpr)
</span><a href="#local-6989586621683130420"><span class="hs-identifier hs-var">mk_aux_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130373"><span class="hs-identifier hs-var">bind_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>                </span><span class="hs-comment">-- Monomorphic recursion possible, hence Rec</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>             </span><span id="local-6989586621683130425"><span class="annot"><span class="annottext">new_force_vars :: [EvVar]
</span><a href="#local-6989586621683130425"><span class="hs-identifier hs-var hs-var hs-var">new_force_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar]
forall {t :: * -&gt; *}. Foldable t =&gt; t EvVar -&gt; [EvVar]
</span><a href="#local-6989586621683130426"><span class="hs-identifier hs-var">get_new_force_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130372"><span class="hs-identifier hs-var">force_vars</span></a></span><span>
</span><span id="line-351"></span><span>             </span><span id="local-6989586621683130427"><span class="annot"><span class="annottext">locals :: [EvVar]
</span><a href="#local-6989586621683130427"><span class="hs-identifier hs-var hs-var hs-var">locals</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ABExport -&gt; EvVar) -&gt; [ABExport] -&gt; [EvVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130370"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-352"></span><span>             </span><span id="local-6989586621683130428"><span class="annot"><span class="annottext">all_locals :: [EvVar]
</span><a href="#local-6989586621683130428"><span class="hs-identifier hs-var hs-var hs-var">all_locals</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130427"><span class="hs-identifier hs-var">locals</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar] -&gt; [EvVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130425"><span class="hs-identifier hs-var">new_force_vars</span></a></span><span>
</span><span id="line-353"></span><span>             </span><span id="local-6989586621683130429"><span class="annot"><span class="annottext">tup_expr :: CoreExpr
</span><a href="#local-6989586621683130429"><span class="hs-identifier hs-var hs-var hs-var">tup_expr</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130428"><span class="hs-identifier hs-var">all_locals</span></a></span><span>
</span><span id="line-354"></span><span>             </span><span id="local-6989586621683130431"><span class="annot"><span class="annottext">tup_ty :: Type
</span><a href="#local-6989586621683130431"><span class="hs-identifier hs-var hs-var hs-var">tup_ty</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130429"><span class="hs-identifier hs-var">tup_expr</span></a></span><span>
</span><span id="line-355"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130433"><span class="annot"><span class="annottext">poly_tup_rhs :: CoreExpr
</span><a href="#local-6989586621683130433"><span class="hs-identifier hs-var hs-var hs-var">poly_tup_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130368"><span class="hs-identifier hs-var">tyvars</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-356"></span><span>                            </span><span class="annot"><span class="annottext">[CoreBind] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLets"><span class="hs-identifier hs-var">mkCoreLets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130371"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-357"></span><span>                            </span><span class="annot"><span class="annottext">CoreBind -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLet"><span class="hs-identifier hs-var">mkLet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621683130423"><span class="hs-identifier hs-var">aux_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-358"></span><span>                            </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130429"><span class="hs-identifier hs-var">tup_expr</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130435"><span class="annot"><a href="#local-6989586621683130435"><span class="hs-identifier hs-var">poly_tup_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-var">newSysLocalMDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130433"><span class="hs-identifier hs-var">poly_tup_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-comment">-- Find corresponding global or make up a new one: sometimes</span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-comment">-- we need to make new export to desugar strict binds, see</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-comment">-- Note [Desugar Strict binds]</span><span>
</span><span id="line-365"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130437"><span class="annot"><a href="#local-6989586621683130437"><span class="hs-identifier hs-var">exported_force_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130438"><span class="annot"><a href="#local-6989586621683130438"><span class="hs-identifier hs-var">extra_exports</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683130439"><span class="hs-identifier hs-type">get_exports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130372"><span class="hs-identifier hs-type">force_vars</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130440"><span class="annot"><a href="#local-6989586621683130440"><span class="hs-identifier hs-var hs-var">mk_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abe_wrap :: ABExport -&gt; HsWrapper
</span><a href="GHC.Hs.Binds.html#abe_wrap"><span class="hs-identifier hs-var">abe_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130441"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130441"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>
</span><span id="line-368"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_poly :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130442"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130442"><span class="hs-identifier hs-var">global</span></a></span></span><span>
</span><span id="line-369"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_mono :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130443"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130443"><span class="hs-identifier hs-var">local</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_prags :: ABExport -&gt; TcSpecPrags
</span><a href="GHC.Hs.Binds.html#abe_prags"><span class="hs-identifier hs-var">abe_prags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130444"><span class="annot"><span class="annottext">TcSpecPrags
</span><a href="#local-6989586621683130444"><span class="hs-identifier hs-var">spec_prags</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>                          </span><span class="hs-comment">-- See Note [ABExport wrapper] in &quot;GHC.Hs.Binds&quot;</span><span>
</span><span id="line-371"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130445"><span class="annot"><a href="#local-6989586621683130445"><span class="hs-identifier hs-var">tup_id</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-var">newSysLocalMDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130431"><span class="hs-identifier hs-var">tup_ty</span></a></span><span>
</span><span id="line-372"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-type">dsHsWrapper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130441"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130446"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130446"><span class="hs-identifier hs-var">core_wrap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130447"><span class="annot"><span class="annottext">rhs :: CoreExpr
</span><a href="#local-6989586621683130447"><span class="hs-identifier hs-var hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130446"><span class="hs-identifier hs-var">core_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130368"><span class="hs-identifier hs-var">tyvars</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-374"></span><span>                                 </span><span class="annot"><span class="annottext">[EvVar] -&gt; EvVar -&gt; EvVar -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigTupleSelector"><span class="hs-identifier hs-var">mkBigTupleSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130428"><span class="hs-identifier hs-var">all_locals</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130443"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130445"><span class="hs-identifier hs-var">tup_id</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-375"></span><span>                                 </span><span class="annot"><span class="annottext">CoreExpr -&gt; [EvVar] -&gt; CoreExpr
forall b. Expr b -&gt; [EvVar] -&gt; Expr b
</span><a href="GHC.Core.html#mkVarApps"><span class="hs-identifier hs-var">mkVarApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130435"><span class="hs-identifier hs-var">poly_tup_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130368"><span class="hs-identifier hs-var">tyvars</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar] -&gt; [EvVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>                           </span><span id="local-6989586621683130450"><span class="annot"><span class="annottext">rhs_for_spec :: CoreExpr
</span><a href="#local-6989586621683130450"><span class="hs-identifier hs-var hs-var hs-var">rhs_for_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr -&gt; CoreBind
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130435"><span class="hs-identifier hs-var">poly_tup_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130433"><span class="hs-identifier hs-var">poly_tup_rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130447"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-377"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130453"><span class="annot"><a href="#local-6989586621683130453"><span class="hs-identifier hs-var">spec_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130454"><span class="annot"><a href="#local-6989586621683130454"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; TcSpecPrags -&gt; DsM (OrdList (EvVar, CoreExpr), [CoreRule])
</span><a href="GHC.HsToCore.Binds.html#dsSpecs"><span class="hs-identifier hs-var">dsSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130450"><span class="hs-identifier hs-var">rhs_for_spec</span></a></span><span> </span><span class="annot"><span class="annottext">TcSpecPrags
</span><a href="#local-6989586621683130444"><span class="hs-identifier hs-var">spec_prags</span></a></span><span>
</span><span id="line-378"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130455"><span class="annot"><a href="#local-6989586621683130455"><span class="hs-identifier hs-var hs-var">global'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130442"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; InlinePragma -&gt; EvVar
</span><a href="GHC.Types.Id.html#setInlinePragma"><span class="hs-operator hs-var">`setInlinePragma`</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="GHC.Types.Basic.html#defaultInlinePragma"><span class="hs-identifier hs-var">defaultInlinePragma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>                                             </span><span class="annot"><span class="annottext">EvVar -&gt; [CoreRule] -&gt; EvVar
</span><a href="GHC.Core.Rules.html#addIdSpecialisations"><span class="hs-operator hs-var">`addIdSpecialisations`</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621683130454"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-380"></span><span>                           </span><span class="hs-comment">-- Kill the INLINE pragma because it applies to</span><span>
</span><span id="line-381"></span><span>                           </span><span class="hs-comment">-- the user written (local) function.  The global</span><span>
</span><span id="line-382"></span><span>                           </span><span class="hs-comment">-- Id is just the selector.  Hmm.</span><span>
</span><span id="line-383"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-type">fromOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130453"><span class="hs-identifier hs-type">spec_binds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130455"><span class="hs-identifier hs-type">global'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130447"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130456"><span class="annot"><a href="#local-6989586621683130456"><span class="hs-identifier hs-var">export_binds_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="#local-6989586621683130440"><span class="hs-identifier hs-type">mk_bind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130370"><span class="hs-identifier hs-type">exports</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683130438"><span class="hs-identifier hs-type">extra_exports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683130437"><span class="hs-identifier hs-type">exported_force_vars</span></a></span><span>
</span><span id="line-388"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130435"><span class="hs-identifier hs-type">poly_tup_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130433"><span class="hs-identifier hs-type">poly_tup_rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span>
</span><span id="line-389"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621683130456"><span class="hs-identifier hs-type">export_binds_s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><a href="#local-6989586621683130420"><span class="hs-identifier hs-type">mk_aux_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621683130420"><span class="annot"><span class="annottext">mk_aux_bind :: (EvVar, CoreExpr) -&gt; (EvVar, CoreExpr)
</span><a href="#local-6989586621683130420"><span class="hs-identifier hs-var hs-var">mk_aux_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130458"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130458"><span class="hs-identifier hs-var">lcl_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130459"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130459"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130460"><span class="annot"><span class="annottext">lcl_w_inline :: EvVar
</span><a href="#local-6989586621683130460"><span class="hs-identifier hs-var hs-var">lcl_w_inline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv EvVar -&gt; EvVar -&gt; Maybe EvVar
forall a. VarEnv a -&gt; EvVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv EvVar
</span><a href="#local-6989586621683130462"><span class="hs-identifier hs-var">inline_env</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130458"><span class="hs-identifier hs-var">lcl_id</span></a></span><span>
</span><span id="line-393"></span><span>                                                   </span><span class="annot"><span class="annottext">Maybe EvVar -&gt; EvVar -&gt; EvVar
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130458"><span class="hs-identifier hs-var">lcl_id</span></a></span><span>
</span><span id="line-394"></span><span>                                 </span><span class="hs-keyword">in</span><span>
</span><span id="line-395"></span><span>                                 </span><span class="annot"><span class="annottext">DynFlags -&gt; EvVar -&gt; Bool -&gt; Arity -&gt; CoreExpr -&gt; (EvVar, CoreExpr)
</span><a href="GHC.HsToCore.Binds.html#makeCorePair"><span class="hs-identifier hs-var">makeCorePair</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130367"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130460"><span class="hs-identifier hs-var">lcl_w_inline</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130459"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><a href="#local-6989586621683130462"><span class="hs-identifier hs-type">inline_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-comment">-- Maps a monomorphic local Id to one with</span><span>
</span><span id="line-398"></span><span>                           </span><span class="hs-comment">-- the inline pragma from the source</span><span>
</span><span id="line-399"></span><span>                           </span><span class="hs-comment">-- The type checker put the inline pragma</span><span>
</span><span id="line-400"></span><span>                           </span><span class="hs-comment">-- on the *global* Id, so we need to transfer it</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621683130462"><span class="annot"><span class="annottext">inline_env :: VarEnv EvVar
</span><a href="#local-6989586621683130462"><span class="hs-identifier hs-var hs-var">inline_env</span></a></span></span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EvVar, EvVar)] -&gt; VarEnv EvVar
forall a. [(EvVar, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130466"><span class="hs-identifier hs-var">lcl_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; InlinePragma -&gt; EvVar
</span><a href="GHC.Types.Id.html#setInlinePragma"><span class="hs-identifier hs-var">setInlinePragma</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130466"><span class="hs-identifier hs-var">lcl_id</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130467"><span class="hs-identifier hs-var">prag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abe_mono :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130466"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130466"><span class="hs-identifier hs-var">lcl_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_poly :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130468"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130468"><span class="hs-identifier hs-var">gbl_id</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130370"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-404"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130467"><span class="annot"><span class="annottext">prag :: InlinePragma
</span><a href="#local-6989586621683130467"><span class="hs-identifier hs-var hs-var">prag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; InlinePragma
</span><a href="GHC.Types.Id.html#idInlinePragma"><span class="hs-identifier hs-var">idInlinePragma</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130468"><span class="hs-identifier hs-var">gbl_id</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><a href="#local-6989586621683130470"><span class="hs-identifier hs-type">global_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-comment">-- Maps local Id to its global exported Id</span><span>
</span><span id="line-407"></span><span>    </span><span id="local-6989586621683130470"><span class="annot"><span class="annottext">global_env :: VarEnv EvVar
</span><a href="#local-6989586621683130470"><span class="hs-identifier hs-var hs-var">global_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-408"></span><span>      </span><span class="annot"><span class="annottext">[(EvVar, EvVar)] -&gt; VarEnv EvVar
forall a. [(EvVar, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130471"><span class="hs-identifier hs-var">local</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130472"><span class="hs-identifier hs-var">global</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abe_mono :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130471"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130471"><span class="hs-identifier hs-var">local</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_poly :: ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130472"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130472"><span class="hs-identifier hs-var">global</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130370"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-410"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-comment">-- find variables that are not exported</span><span>
</span><span id="line-413"></span><span>    </span><span id="local-6989586621683130426"><span class="annot"><span class="annottext">get_new_force_vars :: t EvVar -&gt; [EvVar]
</span><a href="#local-6989586621683130426"><span class="hs-identifier hs-var hs-var">get_new_force_vars</span></a></span></span><span> </span><span id="local-6989586621683130475"><span class="annot"><span class="annottext">t EvVar
</span><a href="#local-6989586621683130475"><span class="hs-identifier hs-var">lcls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-414"></span><span>      </span><span class="annot"><span class="annottext">(EvVar -&gt; [EvVar] -&gt; [EvVar]) -&gt; [EvVar] -&gt; t EvVar -&gt; [EvVar]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683130476"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130476"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span id="local-6989586621683130477"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130477"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarEnv EvVar -&gt; EvVar -&gt; Maybe EvVar
forall a. VarEnv a -&gt; EvVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv EvVar
</span><a href="#local-6989586621683130470"><span class="hs-identifier hs-var">global_env</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130476"><span class="hs-identifier hs-var">lcl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-415"></span><span>                           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130477"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-416"></span><span>                           </span><span class="annot"><span class="annottext">Maybe EvVar
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130476"><span class="hs-identifier hs-var">lcl</span></a></span><span class="annot"><span class="annottext">EvVar -&gt; [EvVar] -&gt; [EvVar]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130477"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">t EvVar
</span><a href="#local-6989586621683130475"><span class="hs-identifier hs-var">lcls</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-comment">-- find exports or make up new exports for force variables</span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><a href="#local-6989586621683130439"><span class="hs-identifier hs-type">get_exports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Binds.html#ABExport"><span class="hs-identifier hs-type">ABExport</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>    </span><span id="local-6989586621683130439"><span class="annot"><span class="annottext">get_exports :: [EvVar] -&gt; DsM ([EvVar], [ABExport])
</span><a href="#local-6989586621683130439"><span class="hs-identifier hs-var hs-var">get_exports</span></a></span></span><span> </span><span id="local-6989586621683130478"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130478"><span class="hs-identifier hs-var">lcls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-422"></span><span>      </span><span class="annot"><span class="annottext">(([EvVar], [ABExport]) -&gt; EvVar -&gt; DsM ([EvVar], [ABExport]))
-&gt; ([EvVar], [ABExport]) -&gt; [EvVar] -&gt; DsM ([EvVar], [ABExport])
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683130480"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130480"><span class="hs-identifier hs-var">glbls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130481"><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130481"><span class="hs-identifier hs-var">exports</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130482"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130482"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-423"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarEnv EvVar -&gt; EvVar -&gt; Maybe EvVar
forall a. VarEnv a -&gt; EvVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv EvVar
</span><a href="#local-6989586621683130470"><span class="hs-identifier hs-var">global_env</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130482"><span class="hs-identifier hs-var">lcl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-424"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683130483"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130483"><span class="hs-identifier hs-var">glbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([EvVar], [ABExport]) -&gt; DsM ([EvVar], [ABExport])
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130483"><span class="hs-identifier hs-var">glbl</span></a></span><span class="annot"><span class="annottext">EvVar -&gt; [EvVar] -&gt; [EvVar]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130480"><span class="hs-identifier hs-var">glbls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683130481"><span class="hs-identifier hs-var">exports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>                </span><span class="annot"><span class="annottext">Maybe EvVar
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683130484"><span class="annot"><a href="#local-6989586621683130484"><span class="hs-keyword hs-var">export</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; IOEnv (Env DsGblEnv DsLclEnv) ABExport
</span><a href="#local-6989586621683130485"><span class="hs-identifier hs-var">mk_export</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130482"><span class="hs-identifier hs-var">lcl</span></a></span><span>
</span><span id="line-426"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130486"><span class="annot"><a href="#local-6989586621683130486"><span class="hs-identifier hs-var hs-var">glbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ABExport -&gt; EvVar
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="annot"><span class="annottext">ABExport
</span><a href="#local-6989586621683130484"><span class="hs-keyword hs-var">export</span></a></span><span>
</span><span id="line-427"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130486"><span class="hs-identifier hs-type">glbl</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683130480"><span class="hs-identifier hs-type">glbls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130484"><span class="hs-keyword hs-type">export</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683130481"><span class="hs-identifier hs-type">exports</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130478"><span class="hs-identifier hs-var">lcls</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621683130485"><span class="annot"><span class="annottext">mk_export :: EvVar -&gt; IOEnv (Env DsGblEnv DsLclEnv) ABExport
</span><a href="#local-6989586621683130485"><span class="hs-identifier hs-var hs-var">mk_export</span></a></span></span><span> </span><span id="local-6989586621683130487"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130487"><span class="hs-identifier hs-var">local</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683130488"><span class="annot"><a href="#local-6989586621683130488"><span class="hs-identifier hs-var">global</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-var">newSysLocalMDs</span></a></span><span>
</span><span id="line-432"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130368"><span class="hs-identifier hs-var">tyvars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130369"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130487"><span class="hs-identifier hs-var">local</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683130488"><span class="hs-identifier hs-type">global</span></a></span><span>
</span><span id="line-434"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683130487"><span class="hs-identifier hs-type">local</span></a></span><span>
</span><span id="line-435"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_wrap"><span class="hs-identifier hs-var">abe_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpHole"><span class="hs-identifier hs-type">WpHole</span></a></span><span>
</span><span id="line-436"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#abe_prags"><span class="hs-identifier hs-var">abe_prags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#SpecPrags"><span class="hs-identifier hs-type">SpecPrags</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="hs-comment">-- | This is where we apply INLINE and INLINABLE pragmas. All we need to</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- do is to attach the unfolding information to the Id.</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- Other decisions about whether to inline are made in</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- `calcUnfoldingGuidance` but the decision about whether to then expose</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- the unfolding in the interface file is made in `GHC.Iface.Tidy.addExternal`</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- using this information.</span><span>
</span><span id="line-445"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-446"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#makeCorePair"><span class="hs-identifier hs-type">makeCorePair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-447"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span id="makeCorePair"><span class="annot"><span class="annottext">makeCorePair :: DynFlags -&gt; EvVar -&gt; Bool -&gt; Arity -&gt; CoreExpr -&gt; (EvVar, CoreExpr)
</span><a href="GHC.HsToCore.Binds.html#makeCorePair"><span class="hs-identifier hs-var hs-var">makeCorePair</span></a></span></span><span> </span><span id="local-6989586621683130491"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130491"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683130492"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span></span><span> </span><span id="local-6989586621683130493"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130493"><span class="hs-identifier hs-var">is_default_method</span></a></span></span><span> </span><span id="local-6989586621683130494"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683130494"><span class="hs-identifier hs-var">dict_arity</span></a></span></span><span> </span><span id="local-6989586621683130495"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130493"><span class="hs-identifier hs-var">is_default_method</span></a></span><span>    </span><span class="hs-comment">-- Default methods are *always* inlined</span><span>
</span><span id="line-450"></span><span>                         </span><span class="hs-comment">-- See Note [INLINE and default methods] in GHC.Tc.TyCl.Instance</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Unfolding -&gt; EvVar
</span><a href="GHC.Types.Id.html#setIdUnfolding"><span class="hs-operator hs-var">`setIdUnfolding`</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts -&gt; CoreExpr -&gt; Unfolding
</span><a href="GHC.Core.Unfold.Make.html#mkCompulsoryUnfolding%27"><span class="hs-identifier hs-var">mkCompulsoryUnfolding'</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621683130498"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InlinePragma -&gt; InlineSpec
</span><a href="GHC.Types.Basic.html#inlinePragmaSpec"><span class="hs-identifier hs-var">inlinePragmaSpec</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130500"><span class="hs-identifier hs-var">inline_prag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-455"></span><span>          </span><span class="annot"><span class="annottext">InlineSpec
</span><a href="GHC.Types.Basic.html#NoUserInlinePrag"><span class="hs-identifier hs-var">NoUserInlinePrag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>          </span><span class="annot"><a href="GHC.Types.Basic.html#NoInline"><span class="hs-identifier hs-type">NoInline</span></a></span><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>          </span><span class="annot"><a href="GHC.Types.Basic.html#Opaque"><span class="hs-identifier hs-type">Opaque</span></a></span><span>    </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>          </span><span class="annot"><a href="GHC.Types.Basic.html#Inlinable"><span class="hs-identifier hs-type">Inlinable</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Unfolding -&gt; EvVar
</span><a href="GHC.Types.Id.html#setIdUnfolding"><span class="hs-operator hs-var">`setIdUnfolding`</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621683130505"><span class="hs-identifier hs-var">inlinable_unf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>          </span><span class="annot"><a href="GHC.Types.Basic.html#Inline"><span class="hs-identifier hs-type">Inline</span></a></span><span>    </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EvVar, CoreExpr)
</span><a href="#local-6989586621683130507"><span class="hs-identifier hs-var">inline_pair</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>    </span><span id="local-6989586621683130498"><span class="annot"><span class="annottext">simpl_opts :: SimpleOpts
</span><a href="#local-6989586621683130498"><span class="hs-identifier hs-var hs-var">simpl_opts</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SimpleOpts
</span><a href="GHC.Driver.Config.html#initSimpleOpts"><span class="hs-identifier hs-var">initSimpleOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130491"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621683130500"><span class="annot"><span class="annottext">inline_prag :: InlinePragma
</span><a href="#local-6989586621683130500"><span class="hs-identifier hs-var hs-var">inline_prag</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; InlinePragma
</span><a href="GHC.Types.Id.html#idInlinePragma"><span class="hs-identifier hs-var">idInlinePragma</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621683130505"><span class="annot"><span class="annottext">inlinable_unf :: Unfolding
</span><a href="#local-6989586621683130505"><span class="hs-identifier hs-var hs-var">inlinable_unf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleOpts -&gt; UnfoldingSource -&gt; CoreExpr -&gt; Unfolding
</span><a href="GHC.Core.Unfold.Make.html#mkInlinableUnfolding"><span class="hs-identifier hs-var">mkInlinableUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621683130498"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingSource
</span><a href="GHC.Types.Basic.html#StableUserSrc"><span class="hs-identifier hs-var">StableUserSrc</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span id="local-6989586621683130507"><span class="annot"><span class="annottext">inline_pair :: (EvVar, CoreExpr)
</span><a href="#local-6989586621683130507"><span class="hs-identifier hs-var hs-var">inline_pair</span></a></span></span><span>
</span><span id="line-465"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683130511"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683130511"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InlinePragma -&gt; Maybe Arity
</span><a href="GHC.Types.Basic.html#inlinePragmaSat"><span class="hs-identifier hs-var">inlinePragmaSat</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130500"><span class="hs-identifier hs-var">inline_prag</span></a></span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-comment">-- Add an Unfolding for an INLINE (but not for NOINLINE)</span><span>
</span><span id="line-467"></span><span>        </span><span class="hs-comment">-- And eta-expand the RHS; see Note [Eta-expanding INLINE things]</span><span>
</span><span id="line-468"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130513"><span class="annot"><span class="annottext">real_arity :: Arity
</span><a href="#local-6989586621683130513"><span class="hs-identifier hs-var hs-var">real_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683130494"><span class="hs-identifier hs-var">dict_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683130511"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-comment">-- NB: The arity passed to mkInlineUnfoldingWithArity</span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-comment">--     must take account of the dictionaries</span><span>
</span><span id="line-471"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Unfolding -&gt; EvVar
</span><a href="GHC.Types.Id.html#setIdUnfolding"><span class="hs-operator hs-var">`setIdUnfolding`</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts -&gt; UnfoldingSource -&gt; Arity -&gt; CoreExpr -&gt; Unfolding
</span><a href="GHC.Core.Unfold.Make.html#mkInlineUnfoldingWithArity"><span class="hs-identifier hs-var">mkInlineUnfoldingWithArity</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621683130498"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingSource
</span><a href="GHC.Types.Basic.html#StableUserSrc"><span class="hs-identifier hs-var">StableUserSrc</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683130513"><span class="hs-identifier hs-var">real_arity</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-472"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Opt.Arity.html#etaExpand"><span class="hs-identifier hs-var">etaExpand</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683130513"><span class="hs-identifier hs-var">real_arity</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-475"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; (EvVar, CoreExpr) -&gt; (EvVar, CoreExpr)
forall a. String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;makeCorePair: arity missing&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((EvVar, CoreExpr) -&gt; (EvVar, CoreExpr))
-&gt; (EvVar, CoreExpr) -&gt; (EvVar, CoreExpr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-476"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130492"><span class="hs-identifier hs-var">gbl_id</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Unfolding -&gt; EvVar
</span><a href="GHC.Types.Id.html#setIdUnfolding"><span class="hs-operator hs-var">`setIdUnfolding`</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts -&gt; UnfoldingSource -&gt; CoreExpr -&gt; Unfolding
</span><a href="GHC.Core.Unfold.Make.html#mkInlineUnfoldingNoArity"><span class="hs-identifier hs-var">mkInlineUnfoldingNoArity</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621683130498"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingSource
</span><a href="GHC.Types.Basic.html#StableUserSrc"><span class="hs-identifier hs-var">StableUserSrc</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130495"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dictArity"><span class="hs-identifier hs-type">dictArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span>
</span><span id="line-479"></span><span class="hs-comment">-- Don't count coercion variables in arity</span><span>
</span><span id="line-480"></span><span id="dictArity"><span class="annot"><span class="annottext">dictArity :: [EvVar] -&gt; Arity
</span><a href="GHC.HsToCore.Binds.html#dictArity"><span class="hs-identifier hs-var hs-var">dictArity</span></a></span></span><span> </span><span id="local-6989586621683130519"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130519"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EvVar -&gt; Bool) -&gt; [EvVar] -&gt; Arity
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Arity
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isId"><span class="hs-identifier hs-var">isId</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130519"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span class="hs-comment">{-
Note [Desugaring AbsBinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~
In the general AbsBinds case we desugar the binding to this:

       tup a (d:Num a) = let fm = ...gm...
                             gm = ...fm...
                         in (fm,gm)
       f a d = case tup a d of { (fm,gm) -&gt; fm }
       g a d = case tup a d of { (fm,gm) -&gt; fm }

Note [Rules and inlining]
~~~~~~~~~~~~~~~~~~~~~~~~~
Common special case: no type or dictionary abstraction
This is a bit less trivial than you might suppose
The naive way would be to desugar to something like
        f_lcl = ...f_lcl...     -- The &quot;binds&quot; from AbsBinds
        M.f = f_lcl             -- Generated from &quot;exports&quot;
But we don't want that, because if M.f isn't exported,
it'll be inlined unconditionally at every call site (its rhs is
trivial).  That would be ok unless it has RULES, which would
thereby be completely lost.  Bad, bad, bad.

Instead we want to generate
        M.f = ...f_lcl...
        f_lcl = M.f
Now all is cool. The RULES are attached to M.f (by SimplCore),
and f_lcl is rapidly inlined away.

This does not happen in the same way to polymorphic binds,
because they desugar to
        M.f = /\a. let f_lcl = ...f_lcl... in f_lcl
Although I'm a bit worried about whether full laziness might
float the f_lcl binding out and then inline M.f at its call site

Note [Specialising in no-dict case]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Even if there are no tyvars or dicts, we may have specialisation pragmas.
Class methods can generate
      AbsBinds [] [] [( ... spec-prag]
         { AbsBinds [tvs] [dicts] ...blah }
So the overloading is in the nested AbsBinds. A good example is in GHC.Float:

  class  (Real a, Fractional a) =&gt; RealFrac a  where
    round :: (Integral b) =&gt; a -&gt; b

  instance  RealFrac Float  where
    {-# SPECIALIZE round :: Float -&gt; Int #-}

The top-level AbsBinds for $cround has no tyvars or dicts (because the
instance does not).  But the method is locally overloaded!

Note [The no-tyvar no-dict case]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we are desugaring
    AbsBinds { tyvars   = []
             , dicts    = []
             , exports  = [ ABE f fm, ABE g gm ]
             , binds    = B
             , ev_binds = EB }
That is: no type variables or dictionary abstractions.  Here, `f` and `fm` are
the polymorphic and monomorphic versions of `f`; in this special case they will
both have the same type.

Specialising Note [Desugaring AbsBinds] for this case gives the desugaring

    tup = letrec EB' in letrec B' in (fm,gm)
    f = case tup of { (fm,gm) -&gt; fm }
    g = case tup of { (fm,gm) -&gt; fm }

where B' is the result of desugaring B. This desugaring is a little silly: we
don't need the intermediate tuple (contrast with the general case where fm and f
have different types). So instead, in this case, we desugar to

    EB'; B'; f=fm; g=gm

This is done in the `null tyvars, null dicts` case of `dsAbsBinds`.

But there is a wrinkle (DSB1).  If the original binding group was
/non-recursive/, we want to return a bunch of non-recursive bindings in
dependency order: see Note [Return non-recursive bindings in dependency order].

But there is no guarantee that EB', the desugared evidence bindings, will be
non-recursive.  Happily, in the non-recursive case, B will have just a single
binding (f = rhs), so we can wrap EB' around its RHS, thus:

   fm = letrec EB' in rhs; f = fm

There is a sub-wrinkle (DSB2).  If B is a /pattern/ bindings, it will desugar to
a &quot;main&quot; binding followed by a bunch of selectors. The main binding always
comes first, so we can pick it out and wrap EB' around its RHS.  For example

    AbsBinds { tyvars   = []
             , dicts    = []
             , exports  = [ ABE p pm, ABE q qm ]
             , binds    = PatBind (pm, Just qm) rhs
             , ev_binds = EB }

can desguar to

   pt = let EB' in
        case rhs of
          (pm,Just qm) -&gt; (pm,qm)
   pm = case pt of (pm,qm) -&gt; pm
   qm = case pt of (pm,qm) -&gt; qm

   p = pm
   q = qm

The first three bindings come from desugaring the PatBind, and subsequently
wrapping the RHS of the main binding in EB'.

Why got to this trouble?  It's a common case, and it removes the
quadratic-sized tuple desugaring.  Less clutter, hopefully faster
compilation, especially in a case where there are a *lot* of
bindings.

Note [Eta-expanding INLINE things]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   foo :: Eq a =&gt; a -&gt; a
   {-# INLINE foo #-}
   foo x = ...

If (foo d) ever gets floated out as a common sub-expression (which can
happen as a result of method sharing), there's a danger that we never
get to do the inlining, which is a Terribly Bad thing given that the
user said &quot;inline&quot;!

To avoid this we preemptively eta-expand the definition, so that foo
has the arity with which it is declared in the source code.  In this
example it has arity 2 (one for the Eq and one for x). Doing this
should mean that (foo d) is a PAP and we don't share it.

Note [Nested arities]
~~~~~~~~~~~~~~~~~~~~~
For reasons that are not entirely clear, method bindings come out looking like
this:

  AbsBinds [] [] [$cfromT &lt;= [] fromT]
    $cfromT [InlPrag=INLINE] :: T Bool -&gt; Bool
    { AbsBinds [] [] [fromT &lt;= [] fromT_1]
        fromT :: T Bool -&gt; Bool
        { fromT_1 ((TBool b)) = not b } } }

Note the nested AbsBind.  The arity for the unfolding on $cfromT should be
gotten from the binding for fromT_1.

It might be better to have just one level of AbsBinds, but that requires more
thought!


Note [Desugar Strict binds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
See https://gitlab.haskell.org/ghc/ghc/wikis/strict-pragma

Desugaring strict variable bindings looks as follows (core below ==&gt;)

  let !x = rhs
  in  body
==&gt;
  let x = rhs
  in x `seq` body -- seq the variable

and if it is a pattern binding the desugaring looks like

  let !pat = rhs
  in body
==&gt;
  let x = rhs -- bind the rhs to a new variable
      pat = x
  in x `seq` body -- seq the new variable

if there is no variable in the pattern desugaring looks like

  let False = rhs
  in body
==&gt;
  let x = case rhs of {False -&gt; (); _ -&gt; error &quot;Match failed&quot;}
  in x `seq` body

In order to force the Ids in the binding group they are passed around
in the dsHsBind family of functions, and later seq'ed in GHC.HsToCore.Expr.ds_val_bind.

Consider a recursive group like this

  letrec
     f : g = rhs[f,g]
  in &lt;body&gt;

Without `Strict`, we get a translation like this:

  let t = /\a. letrec tm = rhs[fm,gm]
                      fm = case t of fm:_ -&gt; fm
                      gm = case t of _:gm -&gt; gm
                in
                (fm,gm)

  in let f = /\a. case t a of (fm,_) -&gt; fm
  in let g = /\a. case t a of (_,gm) -&gt; gm
  in &lt;body&gt;

Here `tm` is the monomorphic binding for `rhs`.

With `Strict`, we want to force `tm`, but NOT `fm` or `gm`.
Alas, `tm` isn't in scope in the `in &lt;body&gt;` part.

The simplest thing is to return it in the polymorphic
tuple `t`, thus:

  let t = /\a. letrec tm = rhs[fm,gm]
                      fm = case t of fm:_ -&gt; fm
                      gm = case t of _:gm -&gt; gm
                in
                (tm, fm, gm)

  in let f = /\a. case t a of (_,fm,_) -&gt; fm
  in let g = /\a. case t a of (_,_,gm) -&gt; gm
  in let tm = /\a. case t a of (tm,_,_) -&gt; tm
  in tm `seq` &lt;body&gt;


See https://gitlab.haskell.org/ghc/ghc/wikis/strict-pragma for a more
detailed explanation of the desugaring of strict bindings.

Wrinkle 1: forcing linear variables

Consider

  let %1 !x = rhs in &lt;body&gt;
==&gt;
  let x = rhs in x `seq` &lt;body&gt;

In the desugared version x is used in both arguments of seq. This isn't
recognised a linear. So we can't strictly speaking use seq. Instead, the code is
really desugared as

  let x = rhs in case x of x { _ -&gt; &lt;body&gt; }

The shadowing with the case-binder is crucial. The linear linter (see
Note [Linting linearity] in GHC.Core.Lint) understands this as linear. This is
what the seqVar function does.

To be more precise, suppose x has multiplicity p, the fully annotated seqVar (in
Core, p is really stored inside x) is

  case x of %p x { _ -&gt; &lt;body&gt; }

In linear Core, case u of %p y { _ -&gt; v } consumes u with multiplicity p, and
makes y available with multiplicity p in v. Which is exactly what we want.

Wrinkle 2: linear patterns

Consider the following linear binding (linear lets are always non-recursive):

  let
     %1 f : g = rhs
  in &lt;body&gt;

The general case would desugar it to

  let t = let tm = rhs
              fm = case tm of fm:_ -&gt; fm
              gm = case tm of _:gm -&gt; gm
           in
           (tm, fm, gm)

  in let f = case t a of (_,fm,_) -&gt; fm
  in let g = case t a of (_,_,gm) -&gt; gm
  in let tm = case t a of (tm,_,_) -&gt; tm
  in tm `seq` &lt;body&gt;

But all the case expression drop variables, which is prohibited by
linearity. But because this is a non-recursive let (in particular we're
desugaring a single binding), we can (and do) desugar the binding as a simple
case-expression instead:

  case rhs of {
    (f:g) -&gt; &lt;body&gt;
  }

This is handled by the special case: a non-recursive PatBind in
GHC.HsToCore.Expr.ds_val_bind.

Note [Strict binds checks]
~~~~~~~~~~~~~~~~~~~~~~~~~~
There are several checks around properly formed strict bindings. They
all link to this Note. These checks must be here in the desugarer because
we cannot know whether or not a type is unlifted until after zonking, due
to representation polymorphism. These checks all used to be handled in the
typechecker in checkStrictBinds (before Jan '17).

We define an &quot;unlifted bind&quot; to be any bind that binds an unlifted id. Note that

  x :: Char
  (# True, x #) = blah

is *not* an unlifted bind. Unlifted binds are detected by GHC.Hs.Utils.isUnliftedHsBind.

Define a &quot;banged bind&quot; to have a top-level bang. Detected by GHC.Hs.Pat.isBangedHsBind.
Define a &quot;strict bind&quot; to be either an unlifted bind or a banged bind.

The restrictions are:
  1. Strict binds may not be top-level. Checked in dsTopLHsBinds.

  2. Unlifted binds must also be banged. (There is no trouble to compile an unbanged
     unlifted bind, but an unbanged bind looks lazy, and we don't want users to be
     surprised by the strictness of an unlifted bind.) Checked in first clause
     of GHC.HsToCore.Expr.ds_val_bind.

  3. Unlifted binds may not have polymorphism (#6078). (That is, no quantified type
     variables or constraints.) Checked in first clause
     of GHC.HsToCore.Expr.ds_val_bind.

  4. Unlifted binds may not be recursive. Checked in second clause of ds_val_bind.

-}</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-801"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsSpecs"><span class="hs-identifier hs-type">dsSpecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>     </span><span class="hs-comment">-- Its rhs</span><span>
</span><span id="line-802"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#TcSpecPrags"><span class="hs-identifier hs-type">TcSpecPrags</span></a></span><span>
</span><span id="line-803"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Binding for specialised Ids</span><span>
</span><span id="line-804"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Rules for the Global Ids</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- See Note [Handling SPECIALISE pragmas] in GHC.Tc.Gen.Bind</span><span>
</span><span id="line-806"></span><span id="dsSpecs"><span class="annot"><span class="annottext">dsSpecs :: CoreExpr
-&gt; TcSpecPrags -&gt; DsM (OrdList (EvVar, CoreExpr), [CoreRule])
</span><a href="GHC.HsToCore.Binds.html#dsSpecs"><span class="hs-identifier hs-var hs-var">dsSpecs</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcSpecPrags
</span><a href="GHC.Hs.Binds.html#IsDefaultMethod"><span class="hs-identifier hs-var">IsDefaultMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OrdList (EvVar, CoreExpr), [CoreRule])
-&gt; DsM (OrdList (EvVar, CoreExpr), [CoreRule])
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList (EvVar, CoreExpr)
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsSpecs"><span class="hs-identifier hs-var">dsSpecs</span></a></span><span> </span><span id="local-6989586621683130523"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130523"><span class="hs-identifier hs-var">poly_rhs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#SpecPrags"><span class="hs-identifier hs-type">SpecPrags</span></a></span><span> </span><span id="local-6989586621683130524"><span class="annot"><span class="annottext">[LTcSpecPrag]
</span><a href="#local-6989586621683130524"><span class="hs-identifier hs-var">sps</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130525"><span class="annot"><a href="#local-6989586621683130525"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LTcSpecPrag
 -&gt; IOEnv
      (Env DsGblEnv DsLclEnv)
      (Maybe (OrdList (EvVar, CoreExpr), CoreRule)))
-&gt; [LTcSpecPrag]
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) [(OrdList (EvVar, CoreExpr), CoreRule)]
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe CoreExpr
-&gt; LTcSpecPrag
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
</span><a href="GHC.HsToCore.Binds.html#dsSpec"><span class="hs-identifier hs-var">dsSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe CoreExpr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130523"><span class="hs-identifier hs-var">poly_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LTcSpecPrag]
</span><a href="#local-6989586621683130524"><span class="hs-identifier hs-var">sps</span></a></span><span>
</span><span id="line-809"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130527"><span class="annot"><a href="#local-6989586621683130527"><span class="hs-identifier hs-var">spec_binds_s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130528"><span class="annot"><a href="#local-6989586621683130528"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621683130525"><span class="hs-identifier hs-type">pairs</span></a></span><span>
</span><span id="line-810"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-type">concatOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130527"><span class="hs-identifier hs-type">spec_binds_s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130528"><span class="hs-identifier hs-type">rules</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsSpec"><span class="hs-identifier hs-type">dsSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>        </span><span class="hs-comment">-- Just rhs =&gt; RULE is for a local binding</span><span>
</span><span id="line-813"></span><span>                                </span><span class="hs-comment">-- Nothing =&gt; RULE is for an imported Id</span><span>
</span><span id="line-814"></span><span>                                </span><span class="hs-comment">--            rhs is in the Id's unfolding</span><span>
</span><span id="line-815"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#TcSpecPrag"><span class="hs-identifier hs-type">TcSpecPrag</span></a></span><span>
</span><span id="line-816"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span id="dsSpec"><span class="annot"><span class="annottext">dsSpec :: Maybe CoreExpr
-&gt; LTcSpecPrag
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
</span><a href="GHC.HsToCore.Binds.html#dsSpec"><span class="hs-identifier hs-var hs-var">dsSpec</span></a></span></span><span> </span><span id="local-6989586621683130532"><span class="annot"><span class="annottext">Maybe CoreExpr
</span><a href="#local-6989586621683130532"><span class="hs-identifier hs-var">mb_poly_rhs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683130533"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683130533"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#SpecPrag"><span class="hs-identifier hs-type">SpecPrag</span></a></span><span> </span><span id="local-6989586621683130535"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span> </span><span id="local-6989586621683130536"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130536"><span class="hs-identifier hs-var">spec_co</span></a></span></span><span> </span><span id="local-6989586621683130537"><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130537"><span class="hs-identifier hs-var">spec_inl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Class -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Maybe Class
</span><a href="GHC.Types.Id.html#isClassOpId_maybe"><span class="hs-identifier hs-var">isClassOpId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683130533"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env DsGblEnv DsLclEnv)
   (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
 -&gt; IOEnv
      (Env DsGblEnv DsLclEnv)
      (Maybe (OrdList (EvVar, CoreExpr), CoreRule)))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-820"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsUselessSpecialiseForClassMethodSelector"><span class="hs-identifier hs-var">DsUselessSpecialiseForClassMethodSelector</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (OrdList (EvVar, CoreExpr), CoreRule)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (OrdList (EvVar, CoreExpr), CoreRule)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- There is no point in trying to specialise a class op</span><span>
</span><span id="line-822"></span><span>                            </span><span class="hs-comment">-- Moreover, classops don't (currently) have an inl_sat arity set</span><span>
</span><span id="line-823"></span><span>                            </span><span class="hs-comment">-- (it would be Just 0) and that in turn makes makeCorePair bleat</span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130541"><span class="hs-identifier hs-var">no_act_spec</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Activation -&gt; Bool
</span><a href="GHC.Types.Basic.html#isNeverActive"><span class="hs-identifier hs-var">isNeverActive</span></a></span><span> </span><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683130544"><span class="hs-identifier hs-var">rule_act</span></a></span><span>
</span><span id="line-826"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683130533"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env DsGblEnv DsLclEnv)
   (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
 -&gt; IOEnv
      (Env DsGblEnv DsLclEnv)
      (Maybe (OrdList (EvVar, CoreExpr), CoreRule)))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsUselessSpecialiseForNoInlineFunction"><span class="hs-identifier hs-var">DsUselessSpecialiseForNoInlineFunction</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (OrdList (EvVar, CoreExpr), CoreRule)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (OrdList (EvVar, CoreExpr), CoreRule)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- Function is NOINLINE, and the specialisation inherits that</span><span>
</span><span id="line-829"></span><span>                            </span><span class="hs-comment">-- See Note [Activation pragmas for SPECIALISE]</span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683130533"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env DsGblEnv DsLclEnv)
   (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
 -&gt; IOEnv
      (Env DsGblEnv DsLclEnv)
      (Maybe (OrdList (EvVar, CoreExpr), CoreRule)))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130546"><span class="annot"><a href="#local-6989586621683130546"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-834"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130548"><span class="annot"><a href="#local-6989586621683130548"><span class="hs-identifier hs-var hs-var">poly_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-835"></span><span>             </span><span id="local-6989586621683130549"><span class="annot"><a href="#local-6989586621683130549"><span class="hs-identifier hs-var hs-var">spec_occ</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkSpecOcc"><span class="hs-identifier hs-var">mkSpecOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683130548"><span class="hs-identifier hs-var">poly_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>             </span><span id="local-6989586621683130552"><span class="annot"><a href="#local-6989586621683130552"><span class="hs-identifier hs-var hs-var">spec_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683130546"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683130549"><span class="hs-identifier hs-var">spec_occ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683130548"><span class="hs-identifier hs-var">poly_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621683130555"><span class="annot"><a href="#local-6989586621683130555"><span class="hs-identifier hs-var">spec_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130556"><span class="annot"><a href="#local-6989586621683130556"><span class="hs-identifier hs-var">spec_app</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#collectHsWrapBinders"><span class="hs-identifier hs-type">collectHsWrapBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130536"><span class="hs-identifier hs-type">spec_co</span></a></span><span>
</span><span id="line-838"></span><span>               </span><span class="hs-comment">-- spec_co looks like</span><span>
</span><span id="line-839"></span><span>               </span><span class="hs-comment">--         \spec_bndrs. [] spec_args</span><span>
</span><span id="line-840"></span><span>               </span><span class="hs-comment">-- perhaps with the body of the lambda wrapped in some WpLets</span><span>
</span><span id="line-841"></span><span>               </span><span class="hs-comment">-- E.g. /\a \(d:Eq a). let d2 = $df d in [] (Maybe a) d2</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapperForRuleLHS"><span class="hs-identifier hs-type">dsHsWrapperForRuleLHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130556"><span class="hs-identifier hs-type">spec_app</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130559"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130559"><span class="hs-identifier hs-var">core_app</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span>       </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130560"><span class="annot"><span class="annottext">ds_lhs :: CoreExpr
</span><a href="#local-6989586621683130560"><span class="hs-identifier hs-var hs-var hs-var">ds_lhs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130559"><span class="hs-identifier hs-var">core_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>             </span><span id="local-6989586621683130561"><span class="annot"><span class="annottext">spec_ty :: Type
</span><a href="#local-6989586621683130561"><span class="hs-identifier hs-var hs-var hs-var">spec_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Utils.html#mkLamTypes"><span class="hs-identifier hs-var">mkLamTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130555"><span class="hs-identifier hs-var">spec_bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130560"><span class="hs-identifier hs-var">ds_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- pprTrace &quot;dsRule&quot; (vcat [ text &quot;Id:&quot; &lt;+&gt; ppr poly_id</span><span>
</span><span id="line-848"></span><span>         </span><span class="hs-comment">--                         , text &quot;spec_co:&quot; &lt;+&gt; ppr spec_co</span><span>
</span><span id="line-849"></span><span>         </span><span class="hs-comment">--                         , text &quot;ds_rhs:&quot; &lt;+&gt; ppr ds_lhs ]) $</span><span>
</span><span id="line-850"></span><span>         </span><span id="local-6989586621683130563"><span class="annot"><a href="#local-6989586621683130563"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-851"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#decomposeRuleLhs"><span class="hs-identifier hs-type">decomposeRuleLhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130563"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130555"><span class="hs-identifier hs-type">spec_bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130560"><span class="hs-identifier hs-type">ds_lhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-type">mkVarSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130555"><span class="hs-identifier hs-type">spec_bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-852"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683130565"><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683130565"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683130565"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (OrdList (EvVar, CoreExpr), CoreRule)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (Maybe (OrdList (EvVar, CoreExpr), CoreRule))
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (OrdList (EvVar, CoreExpr), CoreRule)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-853"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130566"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130566"><span class="hs-identifier hs-var">rule_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130567"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130567"><span class="hs-identifier hs-var">_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130568"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130568"><span class="hs-identifier hs-var">rule_lhs_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span>       </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130569"><span class="annot"><a href="#local-6989586621683130569"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-856"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130571"><span class="annot"><a href="#local-6989586621683130571"><span class="hs-identifier hs-var hs-var">fn_unf</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Unfolding
</span><a href="GHC.Types.Id.html#realIdUnfolding"><span class="hs-identifier hs-var">realIdUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-857"></span><span>             </span><span id="local-6989586621683130573"><span class="annot"><a href="#local-6989586621683130573"><span class="hs-identifier hs-var hs-var">simpl_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SimpleOpts
</span><a href="GHC.Driver.Config.html#initSimpleOpts"><span class="hs-identifier hs-var">initSimpleOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130563"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-858"></span><span>             </span><span id="local-6989586621683130574"><span class="annot"><a href="#local-6989586621683130574"><span class="hs-identifier hs-var hs-var">spec_unf</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleOpts
-&gt; [EvVar]
-&gt; (CoreExpr -&gt; CoreExpr)
-&gt; [CoreExpr]
-&gt; Unfolding
-&gt; Unfolding
</span><a href="GHC.Core.Unfold.Make.html#specUnfolding"><span class="hs-identifier hs-var">specUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621683130573"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130555"><span class="hs-identifier hs-var">spec_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130559"><span class="hs-identifier hs-var">core_app</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130568"><span class="hs-identifier hs-var">rule_lhs_args</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621683130571"><span class="hs-identifier hs-var">fn_unf</span></a></span><span>
</span><span id="line-859"></span><span>             </span><span id="local-6989586621683130576"><span class="annot"><a href="#local-6989586621683130576"><span class="hs-identifier hs-var hs-var">spec_id</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Type -&gt; Type -&gt; EvVar
Name -&gt; Type -&gt; Type -&gt; EvVar
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683130552"><span class="hs-identifier hs-var">spec_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130561"><span class="hs-identifier hs-var">spec_ty</span></a></span><span> </span><span class="hs-comment">-- Specialised binding is toplevel, hence Many.</span><span>
</span><span id="line-860"></span><span>                            </span><span class="annot"><span class="annottext">EvVar -&gt; InlinePragma -&gt; EvVar
</span><a href="GHC.Types.Id.html#setInlinePragma"><span class="hs-operator hs-var">`setInlinePragma`</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130579"><span class="hs-identifier hs-var">inl_prag</span></a></span><span>
</span><span id="line-861"></span><span>                            </span><span class="annot"><span class="annottext">EvVar -&gt; Unfolding -&gt; EvVar
</span><a href="GHC.Types.Id.html#setIdUnfolding"><span class="hs-operator hs-var">`setIdUnfolding`</span></a></span><span>  </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621683130574"><span class="hs-identifier hs-var">spec_unf</span></a></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>             </span><span id="local-6989586621683130580"><span class="annot"><a href="#local-6989586621683130580"><span class="hs-identifier hs-var hs-var">rule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module
-&gt; Bool
-&gt; Activation
-&gt; SDoc
-&gt; EvVar
-&gt; [EvVar]
-&gt; [CoreExpr]
-&gt; CoreExpr
-&gt; CoreRule
</span><a href="GHC.Core.Rules.html#mkSpecRule"><span class="hs-identifier hs-var">mkSpecRule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130563"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683130569"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683130544"><span class="hs-identifier hs-var">rule_act</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;USPEC&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>                               </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130566"><span class="hs-identifier hs-var">rule_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130568"><span class="hs-identifier hs-var">rule_lhs_args</span></a></span><span>
</span><span id="line-865"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; [EvVar] -&gt; CoreExpr
forall b. Expr b -&gt; [EvVar] -&gt; Expr b
</span><a href="GHC.Core.html#mkVarApps"><span class="hs-identifier hs-var">mkVarApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130576"><span class="hs-identifier hs-var">spec_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130555"><span class="hs-identifier hs-var">spec_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>             </span><span id="local-6989586621683130583"><span class="annot"><a href="#local-6989586621683130583"><span class="hs-identifier hs-var hs-var">spec_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130555"><span class="hs-identifier hs-var">spec_bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130559"><span class="hs-identifier hs-var">core_app</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130584"><span class="hs-identifier hs-var">poly_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsWarnOrphanRule"><span class="hs-identifier hs-type">dsWarnOrphanRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130580"><span class="hs-identifier hs-type">rule</span></a></span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-type">tracePm</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;dsSpec&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-871"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;fun:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130535"><span class="hs-identifier hs-type">poly_id</span></a></span><span>
</span><span id="line-872"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;spec_co:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130536"><span class="hs-identifier hs-type">spec_co</span></a></span><span>
</span><span id="line-873"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;spec_bndrs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130555"><span class="hs-identifier hs-type">spec_bndrs</span></a></span><span>
</span><span id="line-874"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ds_lhs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130560"><span class="hs-identifier hs-type">ds_lhs</span></a></span><span>
</span><span id="line-875"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;args:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130568"><span class="hs-identifier hs-type">rule_lhs_args</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-876"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130576"><span class="hs-identifier hs-type">spec_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130583"><span class="hs-identifier hs-type">spec_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130580"><span class="hs-identifier hs-type">rule</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-877"></span><span>            </span><span class="hs-comment">-- NB: do *not* use makeCorePair on (spec_id,spec_rhs), because</span><span>
</span><span id="line-878"></span><span>            </span><span class="hs-comment">--     makeCorePair overwrites the unfolding, which we have</span><span>
</span><span id="line-879"></span><span>            </span><span class="hs-comment">--     just created using specUnfolding</span><span>
</span><span id="line-880"></span><span>       </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-882"></span><span>    </span><span id="local-6989586621683130588"><span class="annot"><span class="annottext">is_local_id :: Bool
</span><a href="#local-6989586621683130588"><span class="hs-identifier hs-var hs-var">is_local_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CoreExpr -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe CoreExpr
</span><a href="#local-6989586621683130532"><span class="hs-identifier hs-var">mb_poly_rhs</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span id="local-6989586621683130584"><span class="annot"><span class="annottext">poly_rhs :: CoreExpr
</span><a href="#local-6989586621683130584"><span class="hs-identifier hs-var hs-var">poly_rhs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683130589"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130589"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><span class="annottext">Maybe CoreExpr
</span><a href="#local-6989586621683130532"><span class="hs-identifier hs-var">mb_poly_rhs</span></a></span><span>
</span><span id="line-884"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130589"><span class="hs-identifier hs-var">rhs</span></a></span><span>          </span><span class="hs-comment">-- Local Id; this is its rhs</span><span>
</span><span id="line-885"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683130590"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130590"><span class="hs-identifier hs-var">unfolding</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; Maybe CoreExpr
</span><a href="GHC.Core.html#maybeUnfoldingTemplate"><span class="hs-identifier hs-var">maybeUnfoldingTemplate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Unfolding
</span><a href="GHC.Types.Id.html#realIdUnfolding"><span class="hs-identifier hs-var">realIdUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130590"><span class="hs-identifier hs-var">unfolding</span></a></span><span>    </span><span class="hs-comment">-- Imported Id; this is its unfolding</span><span>
</span><span id="line-887"></span><span>                            </span><span class="hs-comment">-- Use realIdUnfolding so we get the unfolding</span><span>
</span><span id="line-888"></span><span>                            </span><span class="hs-comment">-- even when it is a loop breaker.</span><span>
</span><span id="line-889"></span><span>                            </span><span class="hs-comment">-- We want to specialise recursive functions!</span><span>
</span><span id="line-890"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CoreExpr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsImpSpecs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>                            </span><span class="hs-comment">-- The type checker has checked that it *has* an unfolding</span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>    </span><span id="local-6989586621683130593"><span class="annot"><span class="annottext">id_inl :: InlinePragma
</span><a href="#local-6989586621683130593"><span class="hs-identifier hs-var hs-var">id_inl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; InlinePragma
</span><a href="GHC.Types.Id.html#idInlinePragma"><span class="hs-identifier hs-var">idInlinePragma</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span>    </span><span class="hs-comment">-- See Note [Activation pragmas for SPECIALISE]</span><span>
</span><span id="line-896"></span><span>    </span><span id="local-6989586621683130579"><span class="annot"><span class="annottext">inl_prag :: InlinePragma
</span><a href="#local-6989586621683130579"><span class="hs-identifier hs-var hs-var">inl_prag</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InlinePragma -&gt; Bool
</span><a href="GHC.Types.Basic.html#isDefaultInlinePragma"><span class="hs-identifier hs-var">isDefaultInlinePragma</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130537"><span class="hs-identifier hs-var">spec_inl</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130537"><span class="hs-identifier hs-var">spec_inl</span></a></span><span>
</span><span id="line-897"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130588"><span class="hs-identifier hs-var">is_local_id</span></a></span><span>  </span><span class="hs-comment">-- See Note [Specialising imported functions]</span><span>
</span><span id="line-898"></span><span>                                 </span><span class="hs-comment">-- in OccurAnal</span><span>
</span><span id="line-899"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OccInfo -&gt; Bool
</span><a href="GHC.Types.Basic.html#isStrongLoopBreaker"><span class="hs-identifier hs-var">isStrongLoopBreaker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; OccInfo
</span><a href="GHC.Types.Id.html#idOccInfo"><span class="hs-identifier hs-var">idOccInfo</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130535"><span class="hs-identifier hs-var">poly_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="GHC.Types.Basic.html#neverInlinePragma"><span class="hs-identifier hs-var">neverInlinePragma</span></a></span><span>
</span><span id="line-900"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130593"><span class="hs-identifier hs-var">id_inl</span></a></span><span>
</span><span id="line-901"></span><span>     </span><span class="hs-comment">-- Get the INLINE pragma from SPECIALISE declaration, or,</span><span>
</span><span id="line-902"></span><span>     </span><span class="hs-comment">-- failing that, from the original Id</span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>    </span><span id="local-6989586621683130598"><span class="annot"><span class="annottext">spec_prag_act :: Activation
</span><a href="#local-6989586621683130598"><span class="hs-identifier hs-var hs-var">spec_prag_act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlinePragma -&gt; Activation
</span><a href="GHC.Types.Basic.html#inlinePragmaActivation"><span class="hs-identifier hs-var">inlinePragmaActivation</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130537"><span class="hs-identifier hs-var">spec_inl</span></a></span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>    </span><span class="hs-comment">-- See Note [Activation pragmas for SPECIALISE]</span><span>
</span><span id="line-907"></span><span>    </span><span class="hs-comment">-- no_act_spec is True if the user didn't write an explicit</span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-comment">-- phase specification in the SPECIALISE pragma</span><span>
</span><span id="line-909"></span><span>    </span><span id="local-6989586621683130541"><span class="annot"><span class="annottext">no_act_spec :: Bool
</span><a href="#local-6989586621683130541"><span class="hs-identifier hs-var hs-var">no_act_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InlinePragma -&gt; InlineSpec
</span><a href="GHC.Types.Basic.html#inlinePragmaSpec"><span class="hs-identifier hs-var">inlinePragmaSpec</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130537"><span class="hs-identifier hs-var">spec_inl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-910"></span><span>                    </span><span class="annot"><a href="GHC.Types.Basic.html#NoInline"><span class="hs-identifier hs-type">NoInline</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Activation -&gt; Bool
</span><a href="GHC.Types.Basic.html#isNeverActive"><span class="hs-identifier hs-var">isNeverActive</span></a></span><span>  </span><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683130598"><span class="hs-identifier hs-var">spec_prag_act</span></a></span><span>
</span><span id="line-911"></span><span>                    </span><span class="annot"><a href="GHC.Types.Basic.html#Opaque"><span class="hs-identifier hs-type">Opaque</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Activation -&gt; Bool
</span><a href="GHC.Types.Basic.html#isNeverActive"><span class="hs-identifier hs-var">isNeverActive</span></a></span><span>  </span><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683130598"><span class="hs-identifier hs-var">spec_prag_act</span></a></span><span>
</span><span id="line-912"></span><span>                    </span><span class="annot"><span class="annottext">InlineSpec
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Activation -&gt; Bool
</span><a href="GHC.Types.Basic.html#isAlwaysActive"><span class="hs-identifier hs-var">isAlwaysActive</span></a></span><span> </span><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683130598"><span class="hs-identifier hs-var">spec_prag_act</span></a></span><span>
</span><span id="line-913"></span><span>    </span><span id="local-6989586621683130544"><span class="annot"><span class="annottext">rule_act :: Activation
</span><a href="#local-6989586621683130544"><span class="hs-identifier hs-var hs-var">rule_act</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130541"><span class="hs-identifier hs-var">no_act_spec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlinePragma -&gt; Activation
</span><a href="GHC.Types.Basic.html#inlinePragmaActivation"><span class="hs-identifier hs-var">inlinePragmaActivation</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma
</span><a href="#local-6989586621683130593"><span class="hs-identifier hs-var">id_inl</span></a></span><span>   </span><span class="hs-comment">-- Inherit</span><span>
</span><span id="line-914"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Activation
</span><a href="#local-6989586621683130598"><span class="hs-identifier hs-var">spec_prag_act</span></a></span><span>                   </span><span class="hs-comment">-- Specified by user</span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span>
</span><span id="line-917"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsWarnOrphanRule"><span class="hs-identifier hs-type">dsWarnOrphanRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span id="dsWarnOrphanRule"><span class="annot"><span class="annottext">dsWarnOrphanRule :: CoreRule -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Binds.html#dsWarnOrphanRule"><span class="hs-identifier hs-var hs-var">dsWarnOrphanRule</span></a></span></span><span> </span><span id="local-6989586621683130601"><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621683130601"><span class="hs-identifier hs-var">rule</span></a></span></span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsOrphan -&gt; Bool
</span><a href="GHC.Core.html#isOrphan"><span class="hs-identifier hs-var">isOrphan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreRule -&gt; IsOrphan
</span><a href="GHC.Core.html#ru_orphan"><span class="hs-identifier hs-var">ru_orphan</span></a></span><span> </span><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621683130601"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env DsGblEnv DsLclEnv) ()
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) ())
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-920"></span><span>    </span><span class="annot"><span class="annottext">DsMessage -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreRule -&gt; DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsOrphanRule"><span class="hs-identifier hs-var">DsOrphanRule</span></a></span><span> </span><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621683130601"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span class="hs-comment">{- Note [SPECIALISE on INLINE functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We used to warn that using SPECIALISE for a function marked INLINE
would be a no-op; but it isn't!  Especially with worker/wrapper split
we might have
   {-# INLINE f #-}
   f :: Ord a =&gt; Int -&gt; a -&gt; ...
   f d x y = case x of I# x' -&gt; $wf d x' y

We might want to specialise 'f' so that we in turn specialise '$wf'.
We can't even /name/ '$wf' in the source code, so we can't specialise
it even if we wanted to.  #10721 is a case in point.

Note [Activation pragmas for SPECIALISE]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
From a user SPECIALISE pragma for f, we generate
  a) A top-level binding    spec_fn = rhs
  b) A RULE                 f dOrd = spec_fn

We need two pragma-like things:

* spec_fn's inline pragma: inherited from f's inline pragma (ignoring
                           activation on SPEC), unless overridden by SPEC INLINE

* Activation of RULE: from SPECIALISE pragma (if activation given)
                      otherwise from f's inline pragma

This is not obvious (see #5237)!

Examples      Rule activation   Inline prag on spec'd fn
---------------------------------------------------------------------
SPEC [n] f :: ty            [n]   Always, or NOINLINE [n]
                                  copy f's prag

NOINLINE f
SPEC [n] f :: ty            [n]   NOINLINE
                                  copy f's prag

NOINLINE [k] f
SPEC [n] f :: ty            [n]   NOINLINE [k]
                                  copy f's prag

INLINE [k] f
SPEC [n] f :: ty            [n]   INLINE [k]
                                  copy f's prag

SPEC INLINE [n] f :: ty     [n]   INLINE [n]
                                  (ignore INLINE prag on f,
                                  same activation for rule and spec'd fn)

NOINLINE [k] f
SPEC f :: ty                [n]   INLINE [k]


************************************************************************
*                                                                      *
\subsection{Adding inline pragmas}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#decomposeRuleLhs"><span class="hs-identifier hs-type">decomposeRuleLhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-984"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span>   </span><span class="hs-comment">-- Free vars of the RHS</span><span>
</span><span id="line-985"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span class="hs-comment">-- (decomposeRuleLhs bndrs lhs) takes apart the LHS of a RULE,</span><span>
</span><span id="line-987"></span><span class="hs-comment">-- The 'bndrs' are the quantified binders of the rules, but decomposeRuleLhs</span><span>
</span><span id="line-988"></span><span class="hs-comment">-- may add some extra dictionary binders (see Note [Free dictionaries on rule LHS])</span><span>
</span><span id="line-989"></span><span class="hs-comment">--</span><span>
</span><span id="line-990"></span><span class="hs-comment">-- Returns an error message if the LHS isn't of the expected shape</span><span>
</span><span id="line-991"></span><span class="hs-comment">-- Note [Decomposing the left-hand side of a RULE]</span><span>
</span><span id="line-992"></span><span id="decomposeRuleLhs"><span class="annot"><span class="annottext">decomposeRuleLhs :: DynFlags
-&gt; [EvVar]
-&gt; CoreExpr
-&gt; VarSet
-&gt; Either DsMessage ([EvVar], EvVar, [CoreExpr])
</span><a href="GHC.HsToCore.Binds.html#decomposeRuleLhs"><span class="hs-identifier hs-var hs-var">decomposeRuleLhs</span></a></span></span><span> </span><span id="local-6989586621683130605"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130605"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683130606"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130606"><span class="hs-identifier hs-var">orig_bndrs</span></a></span></span><span> </span><span id="local-6989586621683130607"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130607"><span class="hs-identifier hs-var">orig_lhs</span></a></span></span><span> </span><span id="local-6989586621683130608"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130608"><span class="hs-identifier hs-var">rhs_fvs</span></a></span></span><span>
</span><span id="line-993"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621683130609"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130609"><span class="hs-identifier hs-var">funId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130610"><span class="hs-identifier hs-var">fun2</span></a></span><span>
</span><span id="line-994"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683130611"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683130611"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConId_maybe"><span class="hs-identifier hs-var">isDataConId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130609"><span class="hs-identifier hs-var">funId</span></a></span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; Either DsMessage ([EvVar], EvVar, [CoreExpr])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsRuleIgnoredDueToConstructor"><span class="hs-identifier hs-var">DsRuleIgnoredDueToConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683130611"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See Note [No RULES on datacons]</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; Maybe (EvVar, [CoreExpr])
</span><a href="#local-6989586621683130614"><span class="hs-identifier hs-var">decompose</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130610"><span class="hs-identifier hs-var">fun2</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130615"><span class="hs-identifier hs-var">args2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-998"></span><span>        </span><span class="annot"><span class="annottext">Maybe (EvVar, [CoreExpr])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- pprTrace &quot;decomposeRuleLhs 3&quot; (vcat [ text &quot;orig_bndrs:&quot; &lt;+&gt; ppr orig_bndrs</span><span>
</span><span id="line-999"></span><span>                   </span><span class="hs-comment">--                                    , text &quot;orig_lhs:&quot; &lt;+&gt; ppr orig_lhs</span><span>
</span><span id="line-1000"></span><span>                   </span><span class="hs-comment">--                                    , text &quot;rhs_fvs:&quot; &lt;+&gt; ppr rhs_fvs</span><span>
</span><span id="line-1001"></span><span>                   </span><span class="hs-comment">--                                    , text &quot;orig_lhs:&quot; &lt;+&gt; ppr orig_lhs</span><span>
</span><span id="line-1002"></span><span>                   </span><span class="hs-comment">--                                    , text &quot;lhs1:&quot; &lt;+&gt; ppr lhs1</span><span>
</span><span id="line-1003"></span><span>                   </span><span class="hs-comment">--                                    , text &quot;lhs2:&quot; &lt;+&gt; ppr lhs2</span><span>
</span><span id="line-1004"></span><span>                   </span><span class="hs-comment">--                                    , text &quot;fun2:&quot; &lt;+&gt; ppr fun2</span><span>
</span><span id="line-1005"></span><span>                   </span><span class="hs-comment">--                                    , text &quot;args2:&quot; &lt;+&gt; ppr args2</span><span>
</span><span id="line-1006"></span><span>                   </span><span class="hs-comment">--                                    ]) $</span><span>
</span><span id="line-1007"></span><span>                   </span><span class="annot"><span class="annottext">DsMessage -&gt; Either DsMessage ([EvVar], EvVar, [CoreExpr])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsRuleLhsTooComplicated"><span class="hs-identifier hs-var">DsRuleLhsTooComplicated</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130607"><span class="hs-identifier hs-var">orig_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130617"><span class="hs-identifier hs-var">lhs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130618"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130618"><span class="hs-identifier hs-var">fn_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130619"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130619"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130620"><span class="hs-identifier hs-var">unbound</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1010"></span><span>            </span><span class="hs-comment">-- Check for things unbound on LHS</span><span>
</span><span id="line-1011"></span><span>            </span><span class="hs-comment">-- See Note [Unused spec binders]</span><span>
</span><span id="line-1012"></span><span>            </span><span class="hs-comment">-- pprTrace &quot;decomposeRuleLhs 1&quot; (vcat [ text &quot;orig_bndrs:&quot; &lt;+&gt; ppr orig_bndrs</span><span>
</span><span id="line-1013"></span><span>            </span><span class="hs-comment">--                                     , text &quot;orig_lhs:&quot; &lt;+&gt; ppr orig_lhs</span><span>
</span><span id="line-1014"></span><span>            </span><span class="hs-comment">--                                     , text &quot;lhs_fvs:&quot; &lt;+&gt; ppr lhs_fvs</span><span>
</span><span id="line-1015"></span><span>            </span><span class="hs-comment">--                                     , text &quot;rhs_fvs:&quot; &lt;+&gt; ppr rhs_fvs</span><span>
</span><span id="line-1016"></span><span>            </span><span class="hs-comment">--                                     , text &quot;unbound:&quot; &lt;+&gt; ppr unbound</span><span>
</span><span id="line-1017"></span><span>            </span><span class="hs-comment">--                                     ]) $</span><span>
</span><span id="line-1018"></span><span>            </span><span class="annot"><span class="annottext">DsMessage -&gt; Either DsMessage ([EvVar], EvVar, [CoreExpr])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar] -&gt; CoreExpr -&gt; CoreExpr -&gt; DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsRuleBindersNotBound"><span class="hs-identifier hs-var">DsRuleBindersNotBound</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130620"><span class="hs-identifier hs-var">unbound</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130606"><span class="hs-identifier hs-var">orig_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130607"><span class="hs-identifier hs-var">orig_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130617"><span class="hs-identifier hs-var">lhs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1020"></span><span>            </span><span class="hs-comment">-- pprTrace &quot;decomposeRuleLhs 2&quot; (vcat [ text &quot;orig_bndrs:&quot; &lt;+&gt; ppr orig_bndrs</span><span>
</span><span id="line-1021"></span><span>            </span><span class="hs-comment">--                                    , text &quot;orig_lhs:&quot; &lt;+&gt; ppr orig_lhs</span><span>
</span><span id="line-1022"></span><span>            </span><span class="hs-comment">--                                    , text &quot;lhs1:&quot;     &lt;+&gt; ppr lhs1</span><span>
</span><span id="line-1023"></span><span>            </span><span class="hs-comment">--                                    , text &quot;extra_bndrs:&quot; &lt;+&gt; ppr extra_bndrs</span><span>
</span><span id="line-1024"></span><span>            </span><span class="hs-comment">--                                    , text &quot;fn_id:&quot; &lt;+&gt; ppr fn_id</span><span>
</span><span id="line-1025"></span><span>            </span><span class="hs-comment">--                                    , text &quot;args:&quot;   &lt;+&gt; ppr args</span><span>
</span><span id="line-1026"></span><span>            </span><span class="hs-comment">--                                    , text &quot;args fvs:&quot; &lt;+&gt; ppr (exprsFreeVarsList args)</span><span>
</span><span id="line-1027"></span><span>            </span><span class="hs-comment">--                                    ]) $</span><span>
</span><span id="line-1028"></span><span>            </span><span class="annot"><span class="annottext">([EvVar], EvVar, [CoreExpr])
-&gt; Either DsMessage ([EvVar], EvVar, [CoreExpr])
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130622"><span class="hs-identifier hs-var">trimmed_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar] -&gt; [EvVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130623"><span class="hs-identifier hs-var">extra_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130618"><span class="hs-identifier hs-var">fn_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130619"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- See Note [Variables unbound on the LHS]</span><span>
</span><span id="line-1031"></span><span>                </span><span id="local-6989586621683130624"><span class="annot"><span class="annottext">lhs_fvs :: VarSet
</span><a href="#local-6989586621683130624"><span class="hs-identifier hs-var hs-var">lhs_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; VarSet
</span><a href="GHC.Core.FVs.html#exprsFreeVars"><span class="hs-identifier hs-var">exprsFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130619"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1032"></span><span>                </span><span id="local-6989586621683130626"><span class="annot"><span class="annottext">all_fvs :: VarSet
</span><a href="#local-6989586621683130626"><span class="hs-identifier hs-var hs-var">all_fvs</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130624"><span class="hs-identifier hs-var">lhs_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130608"><span class="hs-identifier hs-var">rhs_fvs</span></a></span><span>
</span><span id="line-1033"></span><span>                </span><span id="local-6989586621683130622"><span class="annot"><span class="annottext">trimmed_bndrs :: [EvVar]
</span><a href="#local-6989586621683130622"><span class="hs-identifier hs-var hs-var">trimmed_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EvVar -&gt; Bool) -&gt; [EvVar] -&gt; [EvVar]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130626"><span class="hs-identifier hs-var">all_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130606"><span class="hs-identifier hs-var">orig_bndrs</span></a></span><span>
</span><span id="line-1034"></span><span>                </span><span id="local-6989586621683130620"><span class="annot"><span class="annottext">unbound :: [EvVar]
</span><a href="#local-6989586621683130620"><span class="hs-identifier hs-var hs-var">unbound</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EvVar -&gt; Bool) -&gt; [EvVar] -&gt; [EvVar]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130624"><span class="hs-identifier hs-var">lhs_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130622"><span class="hs-identifier hs-var">trimmed_bndrs</span></a></span><span>
</span><span id="line-1035"></span><span>                    </span><span class="hs-comment">-- Needed on RHS but not bound on LHS</span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span>                </span><span class="hs-comment">-- Add extra tyvar binders: Note [Free tyvars on rule LHS]</span><span>
</span><span id="line-1038"></span><span>                </span><span class="hs-comment">-- and extra dict binders: Note [Free dictionaries on rule LHS]</span><span>
</span><span id="line-1039"></span><span>                </span><span id="local-6989586621683130623"><span class="annot"><span class="annottext">extra_bndrs :: [EvVar]
</span><a href="#local-6989586621683130623"><span class="hs-identifier hs-var hs-var">extra_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar]
</span><a href="GHC.Core.TyCo.FVs.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130631"><span class="hs-identifier hs-var">extra_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar] -&gt; [EvVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130632"><span class="hs-identifier hs-var">extra_dicts</span></a></span><span>
</span><span id="line-1040"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1041"></span><span>                    </span><span id="local-6989586621683130631"><span class="annot"><span class="annottext">extra_tvs :: [EvVar]
</span><a href="#local-6989586621683130631"><span class="hs-identifier hs-var hs-var">extra_tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130633"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683130633"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130633"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130634"><span class="hs-identifier hs-var">extra_vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130633"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>                </span><span class="hs-comment">-- isEvVar: this includes coercions, matching what</span><span>
</span><span id="line-1044"></span><span>                </span><span class="hs-comment">--          happens in `split_lets` (isDictId, isCoVar)</span><span>
</span><span id="line-1045"></span><span>                </span><span id="local-6989586621683130632"><span class="annot"><span class="annottext">extra_dicts :: [EvVar]
</span><a href="#local-6989586621683130632"><span class="hs-identifier hs-var hs-var">extra_dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1046"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Type -&gt; Type -&gt; EvVar
Name -&gt; Type -&gt; Type -&gt; EvVar
</span><a href="GHC.Types.Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="GHC.Types.Name.html#localiseName"><span class="hs-identifier hs-var">localiseName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130638"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130638"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683130638"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130638"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130634"><span class="hs-identifier hs-var">extra_vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEvVar"><span class="hs-identifier hs-var">isEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130638"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1048"></span><span>                </span><span id="local-6989586621683130634"><span class="annot"><span class="annottext">extra_vars :: [EvVar]
</span><a href="#local-6989586621683130634"><span class="hs-identifier hs-var hs-var">extra_vars</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-1049"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130641"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1050"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683130641"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130641"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; [EvVar]
</span><a href="GHC.Core.FVs.html#exprsFreeVarsList"><span class="hs-identifier hs-var">exprsFreeVarsList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130619"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1051"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130641"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130643"><span class="hs-identifier hs-var">orig_bndr_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130641"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; EvVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130618"><span class="hs-identifier hs-var">fn_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1053"></span><span>                    </span><span class="hs-comment">-- fn_id: do not quantify over the function itself, which may</span><span>
</span><span id="line-1054"></span><span>                    </span><span class="hs-comment">-- itself be a dictionary (in pathological cases, #10251)</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1057"></span><span>   </span><span id="local-6989586621683130644"><span class="annot"><span class="annottext">simpl_opts :: SimpleOpts
</span><a href="#local-6989586621683130644"><span class="hs-identifier hs-var hs-var">simpl_opts</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SimpleOpts
</span><a href="GHC.Driver.Config.html#initSimpleOpts"><span class="hs-identifier hs-var">initSimpleOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683130605"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1058"></span><span>   </span><span id="local-6989586621683130643"><span class="annot"><span class="annottext">orig_bndr_set :: VarSet
</span><a href="#local-6989586621683130643"><span class="hs-identifier hs-var hs-var">orig_bndr_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130606"><span class="hs-identifier hs-var">orig_bndrs</span></a></span><span>
</span><span id="line-1059"></span><span>
</span><span id="line-1060"></span><span>   </span><span id="local-6989586621683130645"><span class="annot"><span class="annottext">lhs1 :: CoreExpr
</span><a href="#local-6989586621683130645"><span class="hs-identifier hs-var hs-var">lhs1</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130646"><span class="hs-identifier hs-var">drop_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130607"><span class="hs-identifier hs-var">orig_lhs</span></a></span><span>
</span><span id="line-1061"></span><span>   </span><span id="local-6989586621683130617"><span class="annot"><span class="annottext">lhs2 :: CoreExpr
</span><a href="#local-6989586621683130617"><span class="hs-identifier hs-var hs-var">lhs2</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; SimpleOpts -&gt; CoreExpr -&gt; CoreExpr
SimpleOpts -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.SimpleOpt.html#simpleOptExpr"><span class="hs-identifier hs-var">simpleOptExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621683130644"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130645"><span class="hs-identifier hs-var">lhs1</span></a></span><span>  </span><span class="hs-comment">-- See Note [Simplify rule LHS]</span><span>
</span><span id="line-1062"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621683130610"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130610"><span class="hs-identifier hs-var">fun2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683130615"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130615"><span class="hs-identifier hs-var">args2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; (CoreExpr, [CoreExpr])
forall b. Expr b -&gt; (Expr b, [Expr b])
</span><a href="GHC.Core.html#collectArgs"><span class="hs-identifier hs-var">collectArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130617"><span class="hs-identifier hs-var">lhs2</span></a></span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span>   </span><span id="local-6989586621683130614"><span class="annot"><span class="annottext">decompose :: CoreExpr -&gt; [CoreExpr] -&gt; Maybe (EvVar, [CoreExpr])
</span><a href="#local-6989586621683130614"><span class="hs-identifier hs-var hs-var">decompose</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621683130648"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130648"><span class="hs-identifier hs-var">fn_id</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130649"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130649"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1065"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130648"><span class="hs-identifier hs-var">fn_id</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130643"><span class="hs-identifier hs-var">orig_bndr_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EvVar, [CoreExpr]) -&gt; Maybe (EvVar, [CoreExpr])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130648"><span class="hs-identifier hs-var">fn_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130649"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span>   </span><span class="annot"><a href="#local-6989586621683130614"><span class="hs-identifier hs-var">decompose</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (EvVar, [CoreExpr])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1069"></span><span>
</span><span id="line-1070"></span><span>   </span><span class="annot"><a href="#local-6989586621683130646"><span class="hs-identifier hs-type">drop_dicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1071"></span><span>   </span><span id="local-6989586621683130646"><span class="annot"><span class="annottext">drop_dicts :: CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130646"><span class="hs-identifier hs-var hs-var">drop_dicts</span></a></span></span><span> </span><span id="local-6989586621683130650"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130650"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-1072"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; [(EvVar, CoreExpr)] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130651"><span class="hs-identifier hs-var">wrap_lets</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130652"><span class="hs-identifier hs-var">needed</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130653"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130654"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1073"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-1074"></span><span>       </span><span id="local-6989586621683130652"><span class="annot"><span class="annottext">needed :: VarSet
</span><a href="#local-6989586621683130652"><span class="hs-identifier hs-var hs-var">needed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130643"><span class="hs-identifier hs-var">orig_bndr_set</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#minusVarSet"><span class="hs-operator hs-var">`minusVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; VarSet
</span><a href="GHC.Core.FVs.html#exprFreeVars"><span class="hs-identifier hs-var">exprFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130654"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1075"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621683130653"><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130653"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130654"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130654"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; ([(EvVar, CoreExpr)], CoreExpr)
</span><a href="#local-6989586621683130657"><span class="hs-identifier hs-var">split_lets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Opt.OccurAnal.html#occurAnalyseExpr"><span class="hs-identifier hs-var">occurAnalyseExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130650"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1076"></span><span>           </span><span class="hs-comment">-- The occurAnalyseExpr drops dead bindings which is</span><span>
</span><span id="line-1077"></span><span>           </span><span class="hs-comment">-- crucial to ensure that every binding is used later;</span><span>
</span><span id="line-1078"></span><span>           </span><span class="hs-comment">-- which in turn makes wrap_lets work right</span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span>   </span><span class="annot"><a href="#local-6989586621683130657"><span class="hs-identifier hs-type">split_lets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#DictId"><span class="hs-identifier hs-type">DictId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>   </span><span id="local-6989586621683130657"><span class="annot"><span class="annottext">split_lets :: CoreExpr -&gt; ([(EvVar, CoreExpr)], CoreExpr)
</span><a href="#local-6989586621683130657"><span class="hs-identifier hs-var hs-var">split_lets</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621683130659"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130659"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621683130660"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130660"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130661"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130661"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isDictId"><span class="hs-identifier hs-var">isDictId</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130659"><span class="hs-identifier hs-var">d</span></a></span><span>  </span><span class="hs-comment">-- Catches dictionaries, yes, but also catches dictionary</span><span>
</span><span id="line-1083"></span><span>                   </span><span class="hs-comment">-- /functions/ arising from solving a</span><span>
</span><span id="line-1084"></span><span>                   </span><span class="hs-comment">-- quantified contraint (#24370)</span><span>
</span><span id="line-1085"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130659"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130660"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(EvVar, CoreExpr) -&gt; [(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130663"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130664"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130663"><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130663"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130664"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130664"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; ([(EvVar, CoreExpr)], CoreExpr)
</span><a href="#local-6989586621683130657"><span class="hs-identifier hs-var">split_lets</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130661"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span>    </span><span class="hs-comment">-- handle &quot;unlifted lets&quot; too, needed for &quot;map/coerce&quot;</span><span>
</span><span id="line-1089"></span><span>   </span><span class="annot"><a href="#local-6989586621683130657"><span class="hs-identifier hs-var">split_lets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621683130666"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130666"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621683130667"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130667"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683130670"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130670"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1090"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130667"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1091"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130667"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130666"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(EvVar, CoreExpr) -&gt; [(EvVar, CoreExpr)] -&gt; [(EvVar, CoreExpr)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130672"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130673"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1092"></span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130672"><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130672"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130673"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130673"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; ([(EvVar, CoreExpr)], CoreExpr)
</span><a href="#local-6989586621683130657"><span class="hs-identifier hs-var">split_lets</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130670"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>   </span><span class="annot"><a href="#local-6989586621683130657"><span class="hs-identifier hs-var">split_lets</span></a></span><span> </span><span id="local-6989586621683130674"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130674"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130674"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>   </span><span class="annot"><a href="#local-6989586621683130651"><span class="hs-identifier hs-type">wrap_lets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#DictId"><span class="hs-identifier hs-type">DictId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1097"></span><span>   </span><span id="local-6989586621683130651"><span class="annot"><span class="annottext">wrap_lets :: VarSet -&gt; [(EvVar, CoreExpr)] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130651"><span class="hs-identifier hs-var hs-var">wrap_lets</span></a></span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683130675"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130675"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130675"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1098"></span><span>   </span><span class="annot"><a href="#local-6989586621683130651"><span class="hs-identifier hs-var">wrap_lets</span></a></span><span> </span><span id="local-6989586621683130676"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130676"><span class="hs-identifier hs-var">needed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683130677"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130677"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130678"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130678"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683130679"><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130679"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130680"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130680"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-1099"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130681"><span class="hs-identifier hs-var">rhs_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#intersectsVarSet"><span class="hs-operator hs-var">`intersectsVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130676"><span class="hs-identifier hs-var">needed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr -&gt; CoreBind
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130677"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130678"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; [(EvVar, CoreExpr)] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130651"><span class="hs-identifier hs-var">wrap_lets</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130684"><span class="hs-identifier hs-var">needed'</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130679"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130680"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1100"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; [(EvVar, CoreExpr)] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130651"><span class="hs-identifier hs-var">wrap_lets</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130676"><span class="hs-identifier hs-var">needed</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvVar, CoreExpr)]
</span><a href="#local-6989586621683130679"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130680"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1101"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-1102"></span><span>       </span><span id="local-6989586621683130681"><span class="annot"><span class="annottext">rhs_fvs :: VarSet
</span><a href="#local-6989586621683130681"><span class="hs-identifier hs-var hs-var">rhs_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; VarSet
</span><a href="GHC.Core.FVs.html#exprFreeVars"><span class="hs-identifier hs-var">exprFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130678"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1103"></span><span>       </span><span id="local-6989586621683130684"><span class="annot"><span class="annottext">needed' :: VarSet
</span><a href="#local-6989586621683130684"><span class="hs-identifier hs-var hs-var">needed'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130676"><span class="hs-identifier hs-var">needed</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#minusVarSet"><span class="hs-operator hs-var">`minusVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683130681"><span class="hs-identifier hs-var">rhs_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; EvVar -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-operator hs-var">`extendVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130677"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span class="hs-comment">{-
Note [Variables unbound on the LHS]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We obviously want to complain about
   RULE   forall x. f True = not x
because the forall'd variable `x` is not bound on the LHS.

It can be a bit delicate when dictionaries are involved.
Consider #22471
  {-# RULES &quot;foo&quot; forall (f :: forall a. [a] -&gt; Int).
                  foo (\xs. 1 + f xs) = 2 + foo f #-}

We get two dicts on the LHS, one from `1` and one from `+`.
For reasons described in Note [The SimplifyRule Plan] in
GHC.Tc.Gen.Rule, we quantify separately over those dictionaries:
   forall f (d1::Num Int) (d2 :: Num Int).
   foo (\xs. (+) d1 (fromInteger d2 1) xs) = ...

Now the desugarer shortcircuits (fromInteger d2 1) to (I# 1); so d2 is
not mentioned at all (on LHS or RHS)! We don't want to complain about
and unbound d2.  Hence the trimmed_bndrs.

Note [Decomposing the left-hand side of a RULE]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There are several things going on here.
* drop_dicts: see Note [Drop dictionary bindings on rule LHS]
* simpleOptExpr: see Note [Simplify rule LHS]
* extra_dict_bndrs: see Note [Free dictionaries on rule LHS]

Note [Free tyvars on rule LHS]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  data T a = C

  foo :: T a -&gt; Int
  foo C = 1

  {-# RULES &quot;myrule&quot;  foo C = 1 #-}

After type checking the LHS becomes (foo alpha (C alpha)), where alpha
is an unbound meta-tyvar.  The zonker in GHC.Tc.Zonk.Type is careful not to
turn the free alpha into Any (as it usually does).  Instead it turns it
into a TyVar 'a'.  See Note [Zonking the LHS of a RULE] in &quot;GHC.Tc.Zonk.Type&quot;.

Now we must quantify over that 'a'.  It's /really/ inconvenient to do that
in the zonker, because the HsExpr data type is very large.  But it's /easy/
to do it here in the desugarer.

Moreover, we have to do something rather similar for dictionaries;
see Note [Free dictionaries on rule LHS].   So that's why we look for
type variables free on the LHS, and quantify over them.

This relies on there not being any in-scope tyvars, which is true for
user-defined RULEs, which are always top-level.

Note [Free dictionaries on rule LHS]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When the LHS of a specialisation rule, (/\as\ds. f es) has a free dict,
which is presumably in scope at the function definition site, we can quantify
over it too.  *Any* dict with that type will do.

So for example when you have
        f :: Eq a =&gt; a -&gt; a
        f = &lt;rhs&gt;
        ... SPECIALISE f :: Int -&gt; Int ...

Then we get the SpecPrag
        SpecPrag (f Int dInt)

And from that we want the rule

        RULE forall dInt. f Int dInt = f_spec
        f_spec = let f = &lt;rhs&gt; in f Int dInt

But be careful!  That dInt might be GHC.Base.$fOrdInt, which is an External
Name, and you can't bind them in a lambda or forall without getting things
confused.   Likewise it might have a stable unfolding or something, which would be
utterly bogus. So we really make a fresh Id, with the same unique and type
as the old one, but with an Internal name and no IdInfo.

Note [Drop dictionary bindings on rule LHS]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
drop_dicts drops dictionary bindings on the LHS where possible.
   E.g.  let d:Eq [Int] = $fEqList $fEqInt in f d
     --&gt; f d
   Reasoning here is that there is only one d:Eq [Int], and so we can
   quantify over it. That makes 'd' free in the LHS, but that is later
   picked up by extra_dict_bndrs (see Note [Unused spec binders]).

   NB 1: We can only drop the binding if the RHS doesn't bind
         one of the orig_bndrs, which we assume occur on RHS.
         Example
            f :: (Eq a) =&gt; b -&gt; a -&gt; a
            {-# SPECIALISE f :: Eq a =&gt; b -&gt; [a] -&gt; [a] #-}
         Here we want to end up with
            RULE forall d:Eq a.  f ($dfEqList d) = f_spec d
         Of course, the ($dfEqlist d) in the pattern makes it less likely
         to match, but there is no other way to get d:Eq a

   NB 2: We do drop_dicts *before* simplOptEpxr, so that we expect all
         the evidence bindings to be wrapped around the outside of the
         LHS.  (After simplOptExpr they'll usually have been inlined.)
         dsHsWrapper does dependency analysis, so that civilised ones
         will be simple NonRec bindings.  We don't handle recursive
         dictionaries!

    NB3: In the common case of a non-overloaded, but perhaps-polymorphic
         specialisation, we don't need to bind *any* dictionaries for use
         in the RHS. For example (#8331)
             {-# SPECIALIZE INLINE useAbstractMonad :: ReaderST s Int #-}
             useAbstractMonad :: MonadAbstractIOST m =&gt; m Int
         Here, deriving (MonadAbstractIOST (ReaderST s)) is a lot of code
         but the RHS uses no dictionaries, so we want to end up with
             RULE forall s (d :: MonadAbstractIOST (ReaderT s)).
                useAbstractMonad (ReaderT s) d = $suseAbstractMonad s

   #8848 is a good example of where there are some interesting
   dictionary bindings to discard.

The drop_dicts algorithm is based on these observations:

  * Given (let d = rhs in e) where d is a DictId,
    matching 'e' will bind e's free variables.

  * So we want to keep the binding if one of the needed variables (for
    which we need a binding) is in fv(rhs) but not already in fv(e).

  * The &quot;needed variables&quot; are simply the orig_bndrs.  Consider
       f :: (Eq a, Show b) =&gt; a -&gt; b -&gt; String
       ... SPECIALISE f :: (Show b) =&gt; Int -&gt; b -&gt; String ...
    Then orig_bndrs includes the *quantified* dictionaries of the type
    namely (dsb::Show b), but not the one for Eq Int

So we work inside out, applying the above criterion at each step.


Note [Simplify rule LHS]
~~~~~~~~~~~~~~~~~~~~~~~~
simplOptExpr occurrence-analyses and simplifies the LHS:

   (a) Inline any remaining dictionary bindings (which hopefully
       occur just once)

   (b) Substitute trivial lets, so that they don't get in the way.
       Note that we substitute the function too; we might
       have this as a LHS:  let f71 = M.f Int in f71

   (c) Do eta reduction.  To see why, consider the fold/build rule,
       which without simplification looked like:
          fold k z (build (/\a. g a))  ==&gt;  ...
       This doesn't match unless you do eta reduction on the build argument.
       Similarly for a LHS like
         augment g (build h)
       we do not want to get
         augment (\a. g a) (build h)
       otherwise we don't match when given an argument like
          augment (\a. h a a) (build h)

Note [Unused spec binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
        f :: a -&gt; a
        ... SPECIALISE f :: Eq a =&gt; a -&gt; a ...
It's true that this *is* a more specialised type, but the rule
we get is something like this:
        f_spec d = f
        RULE: f = f_spec d
Note that the rule is bogus, because it mentions a 'd' that is
not bound on the LHS!  But it's a silly specialisation anyway, because
the constraint is unused.  We could bind 'd' to (error &quot;unused&quot;)
but it seems better to reject the program because it's almost certainly
a mistake.  That's what the isDeadBinder call detects.

Note [No RULES on datacons]
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously, `RULES` like

    &quot;JustNothing&quot; forall x . Just x = Nothing

were allowed. Simon Peyton Jones says this seems to have been a
mistake, that such rules have never been supported intentionally,
and that he doesn't know if they can break in horrible ways.
Furthermore, Ben Gamari and Reid Barton are considering trying to
detect the presence of &quot;static data&quot; that the simplifier doesn't
need to traverse at all. Such rules do not play well with that.
So for now, we ban them altogether as requested by #13290. See also #7398.


************************************************************************
*                                                                      *
                Desugaring evidence
*                                                                      *
************************************************************************

Note [Desugaring WpFun]
~~~~~~~~~~~~~~~~~~~~~~~
See comments on WpFun in GHC.Tc.Types.Evidence for what WpFun means.
Roughly:

  (WpFun w_arg w_res)[ e ] = \x. w_res[ e w_arg[x] ]

This eta-expansion risk duplicating work, if `e` is not in HNF.
At one stage I thought we could avoid that by desugaring to
      let f = e in \x. w_res[ f w_arg[x] ]
But that /fundamentally/ doesn't work, because `w_res` may bind
evidence that is used in `e`.

This question arose when thinking about deep subsumption; see
https://github.com/ghc-proposals/ghc-proposals/pull/287#issuecomment-1125419649).

Note [Desugaring non-canonical evidence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If the evidence is canonical, we desugar WpEvApp by simply passing
core_tm directly to k:

  k core_tm

If the evidence is not canonical, we mark the application with nospec:

  nospec @(cls =&gt; a) k core_tm

where  nospec :: forall a. a -&gt; a  ensures that the typeclass specialiser
doesn't attempt to common up this evidence term with other evidence terms
of the same type (see Note [nospecId magic] in GHC.Types.Id.Make).

See Note [Coherence and specialisation: overview] for why we shouldn't
specialise incoherent evidence.

We can find out if a given evidence is canonical or not during the
desugaring of its WpLet wrapper: an evidence is non-canonical if its
own resolution was incoherent (see Note [Incoherent instances]), or
if its definition refers to other non-canonical evidence. dsEvBinds is
the convenient place to compute this, since it already needs to do
inter-evidence dependency analysis to generate well-scoped
bindings. We then record this specialisability information in the
dsl_unspecables field of DsM's local environment.

Wrinkle:

(NC1) Don't do this in the LHS of a RULE.  In paritcular, if we have
     f :: (Num a, HasCallStack) =&gt; a -&gt; a
     {-# SPECIALISE f :: Int -&gt; Int #-}
  then making a rule like
        RULE   forall d1:Num Int, d2:HasCallStack.
               f @Int d1 d2 = $sf
  is pretty dodgy, because $sf won't get the call stack passed in d2.
  But that's what you asked for in the SPECIALISE pragma, so we'll obey.

  We definitely can't desugar that LHS into this!
      nospec (f @Int d1) d2

  Hence the `is_rule_lhs` flag in `ds_hs_wrapper`.
-}</span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span id="local-6989586621683129907"><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrappers"><span class="hs-identifier hs-type">dsHsWrappers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129907"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129907"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1361"></span><span id="dsHsWrappers"><span class="annot"><span class="annottext">dsHsWrappers :: forall a. [HsWrapper] -&gt; ([CoreExpr -&gt; CoreExpr] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrappers"><span class="hs-identifier hs-var hs-var">dsHsWrappers</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130686"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130686"><span class="hs-identifier hs-var">wp</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683130687"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621683130687"><span class="hs-identifier hs-var">wps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130688"><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr] -&gt; DsM a
</span><a href="#local-6989586621683130688"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
forall a. HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-var">dsHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130686"><span class="hs-identifier hs-var">wp</span></a></span><span> </span><span class="annot"><span class="annottext">(((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a)
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130689"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130689"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[HsWrapper] -&gt; ([CoreExpr -&gt; CoreExpr] -&gt; DsM a) -&gt; DsM a
forall a. [HsWrapper] -&gt; ([CoreExpr -&gt; CoreExpr] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrappers"><span class="hs-identifier hs-var">dsHsWrappers</span></a></span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621683130687"><span class="hs-identifier hs-var">wps</span></a></span><span> </span><span class="annot"><span class="annottext">(([CoreExpr -&gt; CoreExpr] -&gt; DsM a) -&gt; DsM a)
-&gt; ([CoreExpr -&gt; CoreExpr] -&gt; DsM a) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130690"><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr]
</span><a href="#local-6989586621683130690"><span class="hs-identifier hs-var">wraps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr] -&gt; DsM a
</span><a href="#local-6989586621683130688"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130689"><span class="hs-identifier hs-var">wrap</span></a></span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; [CoreExpr -&gt; CoreExpr] -&gt; [CoreExpr -&gt; CoreExpr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr]
</span><a href="#local-6989586621683130690"><span class="hs-identifier hs-var">wraps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1362"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrappers"><span class="hs-identifier hs-var">dsHsWrappers</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span id="local-6989586621683130691"><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr] -&gt; DsM a
</span><a href="#local-6989586621683130691"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr] -&gt; DsM a
</span><a href="#local-6989586621683130691"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1363"></span><span>
</span><span id="line-1364"></span><span id="local-6989586621683129808"><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-type">dsHsWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129808"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129808"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1365"></span><span id="dsHsWrapper"><span class="annot"><span class="annottext">dsHsWrapper :: forall a. HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-var hs-var">dsHsWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
forall a.
Bool -&gt; HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#ds_hs_wrapper"><span class="hs-identifier hs-var">ds_hs_wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span id="local-6989586621683130693"><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapperForRuleLHS"><span class="hs-identifier hs-type">dsHsWrapperForRuleLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130693"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130693"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1368"></span><span id="dsHsWrapperForRuleLHS"><span class="annot"><span class="annottext">dsHsWrapperForRuleLHS :: forall a. HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsHsWrapperForRuleLHS"><span class="hs-identifier hs-var hs-var">dsHsWrapperForRuleLHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
forall a.
Bool -&gt; HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#ds_hs_wrapper"><span class="hs-identifier hs-var">ds_hs_wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1369"></span><span>
</span><span id="line-1370"></span><span id="local-6989586621683129910"><span class="annot"><a href="GHC.HsToCore.Binds.html#ds_hs_wrapper"><span class="hs-identifier hs-type">ds_hs_wrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; LHS of a RULE</span><span>
</span><span id="line-1371"></span><span>                         </span><span class="hs-comment">-- See (NC1) in Note [Desugaring non-canonical evidence]</span><span>
</span><span id="line-1372"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-1373"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129910"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1374"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129910"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1375"></span><span id="ds_hs_wrapper"><span class="annot"><span class="annottext">ds_hs_wrapper :: forall a.
Bool -&gt; HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#ds_hs_wrapper"><span class="hs-identifier hs-var hs-var">ds_hs_wrapper</span></a></span></span><span> </span><span id="local-6989586621683130706"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130706"><span class="hs-identifier hs-var">is_rule_lhs</span></a></span></span><span> </span><span id="local-6989586621683130707"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130707"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130707"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-1376"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1377"></span><span>    </span><span id="local-6989586621683130708"><span class="annot"><span class="annottext">go :: HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="#local-6989586621683130708"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpHole"><span class="hs-identifier hs-var">WpHole</span></a></span><span>            </span><span id="local-6989586621683130709"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130709"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130709"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; DsM a)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130710"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130710"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130710"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1378"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpTyApp"><span class="hs-identifier hs-type">WpTyApp</span></a></span><span> </span><span id="local-6989586621683130712"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130712"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>      </span><span id="local-6989586621683130713"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130713"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130713"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; DsM a)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130714"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130714"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130714"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130712"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1379"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpEvLam"><span class="hs-identifier hs-type">WpEvLam</span></a></span><span> </span><span id="local-6989586621683130718"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130718"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span>      </span><span id="local-6989586621683130719"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130719"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130719"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; DsM a)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130718"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1380"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpTyLam"><span class="hs-identifier hs-type">WpTyLam</span></a></span><span> </span><span id="local-6989586621683130722"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130722"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>      </span><span id="local-6989586621683130723"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130723"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130723"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; DsM a)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130722"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1381"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpCast"><span class="hs-identifier hs-type">WpCast</span></a></span><span> </span><span id="local-6989586621683130725"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683130725"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>       </span><span id="local-6989586621683130726"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130726"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DsM a -&gt; DsM a
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683130725"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DsM a -&gt; DsM a) -&gt; DsM a -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1382"></span><span>                             </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130726"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; DsM a)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130730"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130730"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; TcCoercionR -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCastDs"><span class="hs-identifier hs-var">mkCastDs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130730"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683130725"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1383"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpLet"><span class="hs-identifier hs-type">WpLet</span></a></span><span> </span><span id="local-6989586621683130733"><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683130733"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621683130734"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130734"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
forall a. TcEvBinds -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsTcEvBinds"><span class="hs-identifier hs-var">dsTcEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683130733"><span class="hs-identifier hs-var">ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(([CoreBind] -&gt; DsM a) -&gt; DsM a) -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130735"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130735"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1384"></span><span>                             </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130734"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreBind] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLets"><span class="hs-identifier hs-var">mkCoreLets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130735"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpCompose"><span class="hs-identifier hs-type">WpCompose</span></a></span><span> </span><span id="local-6989586621683130737"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130737"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621683130738"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130738"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130739"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130739"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130737"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">(((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a)
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130740"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130740"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1386"></span><span>                             </span><span class="annot"><span class="annottext">HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130738"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">(((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a)
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130741"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130741"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1387"></span><span>                             </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130739"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130740"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130741"><span class="hs-identifier hs-var">w2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpFun"><span class="hs-identifier hs-type">WpFun</span></a></span><span> </span><span id="local-6989586621683130743"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130743"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621683130744"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130744"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621683130745"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621683130745"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621683130746"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130746"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Desugaring WpFun]</span><span>
</span><span id="line-1389"></span><span>                             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130747"><span class="annot"><a href="#local-6989586621683130747"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621683130745"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1390"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130743"><span class="hs-identifier hs-type">c1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130749"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130749"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1391"></span><span>                                  </span><span class="annot"><span class="annottext">HsWrapper -&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
</span><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683130744"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">(((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a)
-&gt; ((CoreExpr -&gt; CoreExpr) -&gt; DsM a) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130750"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130750"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1392"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130752"><span class="annot"><span class="annottext">app :: CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130752"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621683130753"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130753"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683130754"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130754"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoreAppDs"><span class="hs-identifier hs-var">mkCoreAppDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsHsWrapper&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130753"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130754"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1393"></span><span>                                      </span><span id="local-6989586621683130756"><span class="annot"><span class="annottext">arg :: CoreExpr
</span><a href="#local-6989586621683130756"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130749"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130747"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>                                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130746"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683130757"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130757"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130747"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130750"><span class="hs-identifier hs-var">w2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683130752"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130757"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130756"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1395"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpEvApp"><span class="hs-identifier hs-type">WpEvApp</span></a></span><span> </span><span id="local-6989586621683130759"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130759"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">)</span><span>      </span><span id="local-6989586621683130760"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130760"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130761"><span class="annot"><a href="#local-6989586621683130761"><span class="hs-identifier hs-var">core_tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-var">dsEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130759"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1396"></span><span>
</span><span id="line-1397"></span><span>                                  </span><span class="hs-comment">-- See Note [Desugaring non-canonical evidence]</span><span>
</span><span id="line-1398"></span><span>                                </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130762"><span class="annot"><a href="#local-6989586621683130762"><span class="hs-identifier hs-var">unspecables</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getUnspecables"><span class="hs-identifier hs-type">getUnspecables</span></a></span><span>
</span><span id="line-1399"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130764"><span class="annot"><a href="#local-6989586621683130764"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [EvVar]
</span><a href="GHC.Core.FVs.html#exprFreeVarsList"><span class="hs-identifier hs-var">exprFreeVarsList</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130761"><span class="hs-identifier hs-var">core_tm</span></a></span><span>
</span><span id="line-1400"></span><span>                                      </span><span id="local-6989586621683130766"><span class="annot"><a href="#local-6989586621683130766"><span class="hs-identifier hs-var hs-var">is_unspecable_var</span></a></span></span><span> </span><span id="local-6989586621683130767"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130767"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130767"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; Set EvVar -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set EvVar
</span><a href="#local-6989586621683130762"><span class="hs-identifier hs-var">unspecables</span></a></span><span>
</span><span id="line-1401"></span><span>                                      </span><span id="local-6989586621683130769"><span class="annot"><a href="#local-6989586621683130769"><span class="hs-identifier hs-var hs-var">is_specable</span></a></span></span><span>
</span><span id="line-1402"></span><span>                                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130706"><span class="hs-identifier hs-var">is_rule_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1403"></span><span>                                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EvVar -&gt; Bool) -&gt; [EvVar] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Bool
</span><a href="#local-6989586621683130766"><span class="hs-identifier hs-var">is_unspecable_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130764"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1404"></span><span>
</span><span id="line-1405"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683130760"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683130771"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130771"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Binds.html#app_ev"><span class="hs-identifier hs-var">app_ev</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130769"><span class="hs-identifier hs-var">is_specable</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130771"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130761"><span class="hs-identifier hs-var">core_tm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1406"></span><span>
</span><span id="line-1407"></span><span>  </span><span class="hs-comment">-- See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-1408"></span><span>    </span><span class="annot"><a href="#local-6989586621683130708"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpMultCoercion"><span class="hs-identifier hs-type">WpMultCoercion</span></a></span><span> </span><span id="local-6989586621683130774"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683130774"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130775"><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130775"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683130774"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env DsGblEnv DsLclEnv) ()
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) ())
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1409"></span><span>                                    </span><span class="annot"><span class="annottext">DsMessage -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsMultiplicityCoercionsNotSupported"><span class="hs-identifier hs-var">DsMultiplicityCoercionsNotSupported</span></a></span><span>
</span><span id="line-1410"></span><span>                                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; DsM a
</span><a href="#local-6989586621683130775"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; DsM a)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130779"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130779"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130779"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1411"></span><span>
</span><span id="line-1412"></span><span class="hs-comment">-- We are about to construct an evidence application `f dict`.  If the dictionary is</span><span>
</span><span id="line-1413"></span><span class="hs-comment">-- non-specialisable, instead construct</span><span>
</span><span id="line-1414"></span><span class="hs-comment">--     nospec f dict</span><span>
</span><span id="line-1415"></span><span class="hs-comment">-- See Note [nospecId magic] in GHC.Types.Id.Make for what `nospec` does.</span><span>
</span><span id="line-1416"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#app_ev"><span class="hs-identifier hs-type">app_ev</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1417"></span><span id="app_ev"><span class="annot"><span class="annottext">app_ev :: Bool -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Binds.html#app_ev"><span class="hs-identifier hs-var hs-var">app_ev</span></a></span></span><span> </span><span id="local-6989586621683130780"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130780"><span class="hs-identifier hs-var">is_specable</span></a></span></span><span> </span><span id="local-6989586621683130781"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130781"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621683130782"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130782"><span class="hs-identifier hs-var">core_tm</span></a></span></span><span>
</span><span id="line-1418"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130780"><span class="hs-identifier hs-var">is_specable</span></a></span><span>
</span><span id="line-1419"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="GHC.Types.Id.Make.html#nospecId"><span class="hs-identifier hs-var">nospecId</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130781"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130781"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130782"><span class="hs-identifier hs-var">core_tm</span></a></span><span>
</span><span id="line-1420"></span><span>
</span><span id="line-1421"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1422"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130781"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130782"><span class="hs-identifier hs-var">core_tm</span></a></span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-1425"></span><span id="local-6989586621683129840"><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTcEvBinds_s"><span class="hs-identifier hs-type">dsTcEvBinds_s</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-type">TcEvBinds</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129840"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129840"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1426"></span><span id="dsTcEvBinds_s"><span class="annot"><span class="annottext">dsTcEvBinds_s :: forall a. [TcEvBinds] -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsTcEvBinds_s"><span class="hs-identifier hs-var hs-var">dsTcEvBinds_s</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span id="local-6989586621683130786"><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130786"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130786"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1427"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTcEvBinds_s"><span class="hs-identifier hs-var">dsTcEvBinds_s</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130787"><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683130787"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683130788"><span class="annot"><span class="annottext">[TcEvBinds]
</span><a href="#local-6989586621683130788"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130789"><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130789"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DsM a -&gt; DsM a
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcEvBinds] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TcEvBinds]
</span><a href="#local-6989586621683130788"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DsM a -&gt; DsM a) -&gt; DsM a -&gt; DsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- Zonker ensures null</span><span>
</span><span id="line-1428"></span><span>                           </span><span class="annot"><span class="annottext">TcEvBinds -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
forall a. TcEvBinds -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsTcEvBinds"><span class="hs-identifier hs-var">dsTcEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683130787"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130789"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1429"></span><span>
</span><span id="line-1430"></span><span id="local-6989586621683129916"><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTcEvBinds"><span class="hs-identifier hs-type">dsTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-type">TcEvBinds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129916"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129916"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1431"></span><span id="dsTcEvBinds"><span class="annot"><span class="annottext">dsTcEvBinds :: forall a. TcEvBinds -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsTcEvBinds"><span class="hs-identifier hs-var hs-var">dsTcEvBinds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-type">TcEvBinds</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsEvBinds&quot;</span></span><span>    </span><span class="hs-comment">-- Zonker has got rid of this</span><span>
</span><span id="line-1432"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsTcEvBinds"><span class="hs-identifier hs-var">dsTcEvBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBinds"><span class="hs-identifier hs-type">EvBinds</span></a></span><span> </span><span id="local-6989586621683130794"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683130794"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag EvBind -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
forall a. Bag EvBind -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsEvBinds"><span class="hs-identifier hs-var">dsEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683130794"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span class="hs-comment">--   * Desugars the ev_binds, sorts them into dependency order, and</span><span>
</span><span id="line-1435"></span><span class="hs-comment">--     passes the resulting [CoreBind] to thing_inside</span><span>
</span><span id="line-1436"></span><span class="hs-comment">--   * Extends the DsM (dsl_unspecable field) with specialisability information</span><span>
</span><span id="line-1437"></span><span class="hs-comment">--     for each binder in ev_binds, before invoking thing_inside</span><span>
</span><span id="line-1438"></span><span id="local-6989586621683129926"><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvBinds"><span class="hs-identifier hs-type">dsEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129926"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129926"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1439"></span><span id="dsEvBinds"><span class="annot"><span class="annottext">dsEvBinds :: forall a. Bag EvBind -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsEvBinds"><span class="hs-identifier hs-var hs-var">dsEvBinds</span></a></span></span><span> </span><span id="local-6989586621683130797"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683130797"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span> </span><span id="local-6989586621683130798"><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130798"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1440"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130799"><span class="annot"><a href="#local-6989586621683130799"><span class="hs-identifier hs-var">ds_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(EvBind
 -&gt; IOEnv
      (Env DsGblEnv DsLclEnv) (EvVar, CanonicalEvidence, CoreExpr))
-&gt; Bag EvBind
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) (Bag (EvVar, CanonicalEvidence, CoreExpr))
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Bag a -&gt; m (Bag b)
</span><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a></span><span> </span><span class="annot"><span class="annottext">EvBind
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) (EvVar, CanonicalEvidence, CoreExpr)
</span><a href="GHC.HsToCore.Binds.html#dsEvBind"><span class="hs-identifier hs-var">dsEvBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683130797"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-1441"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130802"><span class="annot"><a href="#local-6989586621683130802"><span class="hs-identifier hs-var hs-var">comps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag (EvVar, CanonicalEvidence, CoreExpr)
-&gt; [SCC (Node EvVar (CanonicalEvidence, CoreExpr))]
</span><a href="GHC.HsToCore.Binds.html#sort_ev_binds"><span class="hs-identifier hs-var">sort_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (EvVar, CanonicalEvidence, CoreExpr)
</span><a href="#local-6989586621683130799"><span class="hs-identifier hs-var">ds_binds</span></a></span><span>
</span><span id="line-1442"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683130804"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130802"><span class="hs-identifier hs-type">comps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130798"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1443"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1444"></span><span>    </span><span id="local-6989586621683129934"><span class="annot"><a href="#local-6989586621683130804"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129934"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683129934"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1445"></span><span>    </span><span id="local-6989586621683130804"><span class="annot"><span class="annottext">go :: forall a.
[SCC (Node EvVar (CanonicalEvidence, CoreExpr))]
-&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="#local-6989586621683130804"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130807"><span class="annot"><span class="annottext">SCC (Node EvVar (CanonicalEvidence, CoreExpr))
</span><a href="#local-6989586621683130807"><span class="hs-identifier hs-var">comp</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683130808"><span class="annot"><span class="annottext">[SCC (Node EvVar (CanonicalEvidence, CoreExpr))]
</span><a href="#local-6989586621683130808"><span class="hs-identifier hs-var">comps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683130809"><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130809"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1446"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130810"><span class="annot"><a href="#local-6989586621683130810"><span class="hs-identifier hs-var">unspecables</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM (Set EvVar)
</span><a href="GHC.HsToCore.Monad.html#getUnspecables"><span class="hs-identifier hs-var">getUnspecables</span></a></span><span>
</span><span id="line-1447"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130811"><span class="annot"><a href="#local-6989586621683130811"><span class="hs-identifier hs-var">core_bind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130812"><span class="annot"><a href="#local-6989586621683130812"><span class="hs-identifier hs-var">new_unspecables</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683130813"><span class="hs-identifier hs-type">ds_component</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130810"><span class="hs-identifier hs-type">unspecables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130807"><span class="hs-identifier hs-type">comp</span></a></span><span>
</span><span id="line-1448"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#addUnspecables"><span class="hs-identifier hs-type">addUnspecables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130812"><span class="hs-identifier hs-type">new_unspecables</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683130804"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130808"><span class="hs-identifier hs-type">comps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683130815"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130815"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1449"></span><span>               </span><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130809"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621683130811"><span class="hs-identifier hs-var">core_bind</span></a></span><span class="annot"><span class="annottext">CoreBind -&gt; [CoreBind] -&gt; [CoreBind]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130815"><span class="hs-identifier hs-var">core_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1450"></span><span>    </span><span class="annot"><a href="#local-6989586621683130804"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683130816"><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130816"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreBind] -&gt; DsM a
</span><a href="#local-6989586621683130816"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1451"></span><span>
</span><span id="line-1452"></span><span>    </span><span id="local-6989586621683130813"><span class="annot"><span class="annottext">ds_component :: Set a
-&gt; SCC (Node a (CanonicalEvidence, Expr a)) -&gt; (Bind a, Set a)
</span><a href="#local-6989586621683130813"><span class="hs-identifier hs-var hs-var">ds_component</span></a></span></span><span> </span><span id="local-6989586621683130830"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621683130830"><span class="hs-identifier hs-var">unspecables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621683130832"><span class="annot"><span class="annottext">Node a (CanonicalEvidence, Expr a)
</span><a href="#local-6989586621683130832"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Expr a -&gt; Bind a
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130833"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621683130834"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621683130835"><span class="hs-identifier hs-var">new_unspecables</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1453"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1454"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683130833"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130833"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130834"><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621683130834"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130836"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130836"><span class="hs-identifier hs-var">this_canonical</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130837"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683130837"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node a (CanonicalEvidence, Expr a)
-&gt; ((a, Expr a), (CanonicalEvidence, [a]))
forall {a} {a} {b}. Node a (a, b) -&gt; ((a, b), (a, [a]))
</span><a href="#local-6989586621683130838"><span class="hs-identifier hs-var">unpack_node</span></a></span><span> </span><span class="annot"><span class="annottext">Node a (CanonicalEvidence, Expr a)
</span><a href="#local-6989586621683130832"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1455"></span><span>        </span><span id="local-6989586621683130839"><span class="annot"><span class="annottext">transitively_unspecable :: Bool
</span><a href="#local-6989586621683130839"><span class="hs-identifier hs-var hs-var">transitively_unspecable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence -&gt; Bool
</span><a href="#local-6989586621683130840"><span class="hs-identifier hs-var">is_unspecable</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130836"><span class="hs-identifier hs-var">this_canonical</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621683130841"><span class="hs-identifier hs-var">is_unspecable_dep</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683130837"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1456"></span><span>        </span><span id="local-6989586621683130841"><span class="annot"><span class="annottext">is_unspecable_dep :: a -&gt; Bool
</span><a href="#local-6989586621683130841"><span class="hs-identifier hs-var hs-var">is_unspecable_dep</span></a></span></span><span> </span><span id="local-6989586621683130842"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130842"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130842"><span class="hs-identifier hs-var">dep</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621683130830"><span class="hs-identifier hs-var">unspecables</span></a></span><span>
</span><span id="line-1457"></span><span>        </span><span id="local-6989586621683130835"><span class="annot"><span class="annottext">new_unspecables :: Set a
</span><a href="#local-6989586621683130835"><span class="hs-identifier hs-var hs-var">new_unspecables</span></a></span></span><span>
</span><span id="line-1458"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130839"><span class="hs-identifier hs-var">transitively_unspecable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a
forall a. a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130833"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1459"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1460"></span><span>    </span><span class="annot"><a href="#local-6989586621683130813"><span class="hs-identifier hs-var">ds_component</span></a></span><span> </span><span id="local-6989586621683130844"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621683130844"><span class="hs-identifier hs-var">unspecables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621683130846"><span class="annot"><span class="annottext">[Node a (CanonicalEvidence, Expr a)]
</span><a href="#local-6989586621683130846"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, Expr a)] -&gt; Bind a
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621683130847"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621683130848"><span class="hs-identifier hs-var">new_unspecables</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1461"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1462"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683130847"><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621683130847"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130849"><span class="annot"><span class="annottext">[(CanonicalEvidence, [a])]
</span><a href="#local-6989586621683130849"><span class="hs-identifier hs-var">direct_canonicity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((a, Expr a), (CanonicalEvidence, [a]))]
-&gt; ([(a, Expr a)], [(CanonicalEvidence, [a])])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([((a, Expr a), (CanonicalEvidence, [a]))]
 -&gt; ([(a, Expr a)], [(CanonicalEvidence, [a])]))
-&gt; [((a, Expr a), (CanonicalEvidence, [a]))]
-&gt; ([(a, Expr a)], [(CanonicalEvidence, [a])])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Node a (CanonicalEvidence, Expr a)
 -&gt; ((a, Expr a), (CanonicalEvidence, [a])))
-&gt; [Node a (CanonicalEvidence, Expr a)]
-&gt; [((a, Expr a), (CanonicalEvidence, [a]))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Node a (CanonicalEvidence, Expr a)
-&gt; ((a, Expr a), (CanonicalEvidence, [a]))
forall {a} {a} {b}. Node a (a, b) -&gt; ((a, b), (a, [a]))
</span><a href="#local-6989586621683130838"><span class="hs-identifier hs-var">unpack_node</span></a></span><span> </span><span class="annot"><span class="annottext">[Node a (CanonicalEvidence, Expr a)]
</span><a href="#local-6989586621683130846"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-1463"></span><span>
</span><span id="line-1464"></span><span>        </span><span id="local-6989586621683130850"><span class="annot"><span class="annottext">is_unspecable_remote :: a -&gt; Bool
</span><a href="#local-6989586621683130850"><span class="hs-identifier hs-var hs-var">is_unspecable_remote</span></a></span></span><span> </span><span id="local-6989586621683130851"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130851"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130851"><span class="hs-identifier hs-var">dep</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621683130844"><span class="hs-identifier hs-var">unspecables</span></a></span><span>
</span><span id="line-1465"></span><span>        </span><span id="local-6989586621683130852"><span class="annot"><span class="annottext">transitively_unspecable :: Bool
</span><a href="#local-6989586621683130852"><span class="hs-identifier hs-var hs-var">transitively_unspecable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence -&gt; Bool
</span><a href="#local-6989586621683130840"><span class="hs-identifier hs-var">is_unspecable</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130854"><span class="hs-identifier hs-var">this_canonical</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621683130850"><span class="hs-identifier hs-var">is_unspecable_remote</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683130855"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1466"></span><span>                                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130854"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130854"><span class="hs-identifier hs-var">this_canonical</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130855"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683130855"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(CanonicalEvidence, [a])]
</span><a href="#local-6989586621683130849"><span class="hs-identifier hs-var">direct_canonicity</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1467"></span><span>            </span><span class="hs-comment">-- Bindings from a given SCC are transitively specialisable if</span><span>
</span><span id="line-1468"></span><span>            </span><span class="hs-comment">-- all are specialisable and all their remote dependencies are</span><span>
</span><span id="line-1469"></span><span>            </span><span class="hs-comment">-- also specialisable; see Note [Desugaring non-canonical evidence]</span><span>
</span><span id="line-1470"></span><span>
</span><span id="line-1471"></span><span>        </span><span id="local-6989586621683130848"><span class="annot"><span class="annottext">new_unspecables :: Set a
</span><a href="#local-6989586621683130848"><span class="hs-identifier hs-var hs-var">new_unspecables</span></a></span></span><span>
</span><span id="line-1472"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683130852"><span class="hs-identifier hs-var">transitively_unspecable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Set a
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130857"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130857"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130857"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621683130847"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1473"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1474"></span><span>
</span><span id="line-1475"></span><span>    </span><span id="local-6989586621683130838"><span class="annot"><span class="annottext">unpack_node :: Node a (a, b) -&gt; ((a, b), (a, [a]))
</span><a href="#local-6989586621683130838"><span class="hs-identifier hs-var hs-var">unpack_node</span></a></span></span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-type">DigraphNode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">node_key :: forall key payload. Node key payload -&gt; key
</span><a href="GHC.Data.Graph.Directed.html#node_key"><span class="hs-identifier hs-var">node_key</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130860"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130860"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node_payload :: forall key payload. Node key payload -&gt; payload
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var">node_payload</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130862"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130862"><span class="hs-identifier hs-var">canonical</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130863"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621683130863"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node_dependencies :: forall key payload. Node key payload -&gt; [key]
</span><a href="GHC.Data.Graph.Directed.html#node_dependencies"><span class="hs-identifier hs-var">node_dependencies</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130865"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683130865"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1476"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130860"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621683130863"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683130862"><span class="hs-identifier hs-var">canonical</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683130865"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span>    </span><span class="annot"><a href="#local-6989586621683130840"><span class="hs-identifier hs-type">is_unspecable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1479"></span><span>    </span><span id="local-6989586621683130840"><span class="annot"><span class="annottext">is_unspecable :: CanonicalEvidence -&gt; Bool
</span><a href="#local-6989586621683130840"><span class="hs-identifier hs-var hs-var">is_unspecable</span></a></span></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvNonCanonical"><span class="hs-identifier hs-var">EvNonCanonical</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1480"></span><span>    </span><span class="annot"><a href="#local-6989586621683130840"><span class="hs-identifier hs-var">is_unspecable</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1481"></span><span>
</span><span id="line-1482"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#sort_ev_binds"><span class="hs-identifier hs-type">sort_ev_binds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1483"></span><span class="hs-comment">-- We do SCC analysis of the evidence bindings, /after/ desugaring</span><span>
</span><span id="line-1484"></span><span class="hs-comment">-- them. This is convenient: it means we can use the GHC.Core</span><span>
</span><span id="line-1485"></span><span class="hs-comment">-- free-variable functions rather than having to do accurate free vars</span><span>
</span><span id="line-1486"></span><span class="hs-comment">-- for EvTerm.</span><span>
</span><span id="line-1487"></span><span id="sort_ev_binds"><span class="annot"><span class="annottext">sort_ev_binds :: Bag (EvVar, CanonicalEvidence, CoreExpr)
-&gt; [SCC (Node EvVar (CanonicalEvidence, CoreExpr))]
</span><a href="GHC.HsToCore.Binds.html#sort_ev_binds"><span class="hs-identifier hs-var hs-var">sort_ev_binds</span></a></span></span><span> </span><span id="local-6989586621683130868"><span class="annot"><span class="annottext">Bag (EvVar, CanonicalEvidence, CoreExpr)
</span><a href="#local-6989586621683130868"><span class="hs-identifier hs-var">ds_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Node EvVar (CanonicalEvidence, CoreExpr)]
-&gt; [SCC (Node EvVar (CanonicalEvidence, CoreExpr))]
forall key payload.
Uniquable key =&gt;
[Node key payload] -&gt; [SCC (Node key payload)]
</span><a href="GHC.Data.Graph.Directed.html#stronglyConnCompFromEdgedVerticesUniqR"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesUniqR</span></a></span><span> </span><span class="annot"><span class="annottext">[Node EvVar (CanonicalEvidence, CoreExpr)]
</span><a href="#local-6989586621683130870"><span class="hs-identifier hs-var">edges</span></a></span><span>
</span><span id="line-1488"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1489"></span><span>    </span><span class="annot"><a href="#local-6989586621683130870"><span class="hs-identifier hs-type">edges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1490"></span><span>    </span><span id="local-6989586621683130870"><span class="annot"><span class="annottext">edges :: [Node EvVar (CanonicalEvidence, CoreExpr)]
</span><a href="#local-6989586621683130870"><span class="hs-identifier hs-var hs-var">edges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EvVar, CanonicalEvidence, CoreExpr)
 -&gt; [Node EvVar (CanonicalEvidence, CoreExpr)]
 -&gt; [Node EvVar (CanonicalEvidence, CoreExpr)])
-&gt; [Node EvVar (CanonicalEvidence, CoreExpr)]
-&gt; Bag (EvVar, CanonicalEvidence, CoreExpr)
-&gt; [Node EvVar (CanonicalEvidence, CoreExpr)]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Bag a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Node EvVar (CanonicalEvidence, CoreExpr)
 -&gt; [Node EvVar (CanonicalEvidence, CoreExpr)]
 -&gt; [Node EvVar (CanonicalEvidence, CoreExpr)])
-&gt; ((EvVar, CanonicalEvidence, CoreExpr)
    -&gt; Node EvVar (CanonicalEvidence, CoreExpr))
-&gt; (EvVar, CanonicalEvidence, CoreExpr)
-&gt; [Node EvVar (CanonicalEvidence, CoreExpr)]
-&gt; [Node EvVar (CanonicalEvidence, CoreExpr)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EvVar, CanonicalEvidence, CoreExpr)
-&gt; Node EvVar (CanonicalEvidence, CoreExpr)
</span><a href="#local-6989586621683130871"><span class="hs-identifier hs-var">mk_node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bag (EvVar, CanonicalEvidence, CoreExpr)
</span><a href="#local-6989586621683130868"><span class="hs-identifier hs-var">ds_binds</span></a></span><span>
</span><span id="line-1491"></span><span>
</span><span id="line-1492"></span><span>    </span><span class="annot"><a href="#local-6989586621683130871"><span class="hs-identifier hs-type">mk_node</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span>    </span><span id="local-6989586621683130871"><span class="annot"><span class="annottext">mk_node :: (EvVar, CanonicalEvidence, CoreExpr)
-&gt; Node EvVar (CanonicalEvidence, CoreExpr)
</span><a href="#local-6989586621683130871"><span class="hs-identifier hs-var hs-var">mk_node</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130872"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130872"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130873"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130873"><span class="hs-identifier hs-var">canonical</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130874"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130874"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1494"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-type">DigraphNode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">node_payload :: (CanonicalEvidence, CoreExpr)
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var">node_payload</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130873"><span class="hs-identifier hs-var">canonical</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130874"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1495"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node_key :: EvVar
</span><a href="GHC.Data.Graph.Directed.html#node_key"><span class="hs-identifier hs-var">node_key</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130872"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1496"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node_dependencies :: [EvVar]
</span><a href="GHC.Data.Graph.Directed.html#node_dependencies"><span class="hs-identifier hs-var">node_dependencies</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; [EvVar]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; [EvVar]) -&gt; VarSet -&gt; [EvVar]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1497"></span><span>                                          </span><span class="annot"><span class="annottext">CoreExpr -&gt; VarSet
</span><a href="GHC.Core.FVs.html#exprFreeVars"><span class="hs-identifier hs-var">exprFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130874"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span>
</span><span id="line-1498"></span><span>                                          </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#coVarsOfType"><span class="hs-identifier hs-var">coVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130872"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1499"></span><span>      </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here as graphFromEdgedVerticesUniq</span><span>
</span><span id="line-1500"></span><span>      </span><span class="hs-comment">-- is still deterministic even if the edges are in nondeterministic order</span><span>
</span><span id="line-1501"></span><span>      </span><span class="hs-comment">-- as explained in Note [Deterministic SCC] in GHC.Data.Graph.Directed.</span><span>
</span><span id="line-1502"></span><span>
</span><span id="line-1503"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvBind"><span class="hs-identifier hs-type">dsEvBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1504"></span><span id="dsEvBind"><span class="annot"><span class="annottext">dsEvBind :: EvBind
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) (EvVar, CanonicalEvidence, CoreExpr)
</span><a href="GHC.HsToCore.Binds.html#dsEvBind"><span class="hs-identifier hs-var hs-var">dsEvBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eb_lhs :: EvBind -&gt; EvVar
</span><a href="GHC.Tc.Types.Evidence.html#eb_lhs"><span class="hs-identifier hs-var">eb_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130879"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130879"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eb_rhs :: EvBind -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#eb_rhs"><span class="hs-identifier hs-var">eb_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130881"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130881"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eb_info :: EvBind -&gt; EvBindInfo
</span><a href="GHC.Tc.Types.Evidence.html#eb_info"><span class="hs-identifier hs-var">eb_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130883"><span class="annot"><span class="annottext">EvBindInfo
</span><a href="#local-6989586621683130883"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1505"></span><span>    </span><span id="local-6989586621683130884"><span class="annot"><a href="#local-6989586621683130884"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-var">dsEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130881"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1506"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130885"><span class="annot"><a href="#local-6989586621683130885"><span class="hs-identifier hs-var hs-var">canonical</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EvBindInfo
</span><a href="#local-6989586621683130883"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1507"></span><span>            </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindGiven"><span class="hs-identifier hs-type">EvBindGiven</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span>
</span><span id="line-1508"></span><span>            </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindWanted"><span class="hs-identifier hs-type">EvBindWanted</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebi_canonical :: EvBindInfo -&gt; CanonicalEvidence
</span><a href="GHC.Tc.Types.Evidence.html#ebi_canonical"><span class="hs-identifier hs-var">ebi_canonical</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130889"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130889"><span class="hs-identifier hs-var">canonical</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683130889"><span class="hs-identifier hs-var">canonical</span></a></span><span>
</span><span id="line-1509"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683130879"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130885"><span class="hs-identifier hs-type">canonical</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130884"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1510"></span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span class="annot"><span class="hs-comment">{-**********************************************************************
*                                                                      *
           Desugaring EvTerms
*                                                                      *
**********************************************************************-}</span></span><span>
</span><span id="line-1517"></span><span>
</span><span id="line-1518"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-type">dsEvTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1519"></span><span id="dsEvTerm"><span class="annot"><span class="annottext">dsEvTerm :: EvTerm -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-var hs-var">dsEvTerm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a></span><span> </span><span id="local-6989586621683130891"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130891"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130891"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1520"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-var">dsEvTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTypeable"><span class="hs-identifier hs-type">EvTypeable</span></a></span><span> </span><span id="local-6989586621683130893"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130893"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683130894"><span class="annot"><span class="annottext">EvTypeable
</span><a href="#local-6989586621683130894"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; EvTypeable -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#dsEvTypeable"><span class="hs-identifier hs-var">dsEvTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130893"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">EvTypeable
</span><a href="#local-6989586621683130894"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1521"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-var">dsEvTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvFun"><span class="hs-identifier hs-type">EvFun</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">et_tvs :: EvTerm -&gt; [EvVar]
</span><a href="GHC.Tc.Types.Evidence.html#et_tvs"><span class="hs-identifier hs-var">et_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130898"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130898"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">et_given :: EvTerm -&gt; [EvVar]
</span><a href="GHC.Tc.Types.Evidence.html#et_given"><span class="hs-identifier hs-var">et_given</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130900"><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130900"><span class="hs-identifier hs-var">given</span></a></span></span><span>
</span><span id="line-1522"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">et_binds :: EvTerm -&gt; TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#et_binds"><span class="hs-identifier hs-var">et_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130902"><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683130902"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">et_body :: EvTerm -&gt; EvVar
</span><a href="GHC.Tc.Types.Evidence.html#et_body"><span class="hs-identifier hs-var">et_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683130904"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130904"><span class="hs-identifier hs-var">wanted_id</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcEvBinds -&gt; ([CoreBind] -&gt; DsM CoreExpr) -&gt; DsM CoreExpr
forall a. TcEvBinds -&gt; ([CoreBind] -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Binds.html#dsTcEvBinds"><span class="hs-identifier hs-var">dsTcEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683130902"><span class="hs-identifier hs-var">ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(([CoreBind] -&gt; DsM CoreExpr) -&gt; DsM CoreExpr)
-&gt; ([CoreBind] -&gt; DsM CoreExpr) -&gt; DsM CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683130905"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130905"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1524"></span><span>       </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; CoreExpr -&gt; DsM CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130898"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [EvVar] -&gt; [EvVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683130900"><span class="hs-identifier hs-var">given</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1525"></span><span>                   </span><span class="annot"><span class="annottext">[CoreBind] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLets"><span class="hs-identifier hs-var">mkCoreLets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621683130905"><span class="hs-identifier hs-var">ds_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1526"></span><span>                   </span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130904"><span class="hs-identifier hs-var">wanted_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1527"></span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span class="annot"><span class="hs-comment">{-**********************************************************************
*                                                                      *
           Desugaring Typeable dictionaries
*                                                                      *
**********************************************************************-}</span></span><span>
</span><span id="line-1534"></span><span>
</span><span id="line-1535"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvTypeable"><span class="hs-identifier hs-type">dsEvTypeable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTypeable"><span class="hs-identifier hs-type">EvTypeable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1536"></span><span class="hs-comment">-- Return a CoreExpr :: Typeable ty</span><span>
</span><span id="line-1537"></span><span class="hs-comment">-- This code is tightly coupled to the representation</span><span>
</span><span id="line-1538"></span><span class="hs-comment">-- of TypeRep, in base library Data.Typeable.Internal</span><span>
</span><span id="line-1539"></span><span id="dsEvTypeable"><span class="annot"><span class="annottext">dsEvTypeable :: Type -&gt; EvTypeable -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#dsEvTypeable"><span class="hs-identifier hs-var hs-var">dsEvTypeable</span></a></span></span><span> </span><span id="local-6989586621683130906"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130906"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683130907"><span class="annot"><span class="annottext">EvTypeable
</span><a href="#local-6989586621683130907"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-1540"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130908"><span class="annot"><a href="#local-6989586621683130908"><span class="hs-identifier hs-var">tyCl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var">dsLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeableClassName"><span class="hs-identifier hs-var">typeableClassName</span></a></span><span>    </span><span class="hs-comment">-- Typeable</span><span>
</span><span id="line-1541"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130911"><span class="annot"><a href="#local-6989586621683130911"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130906"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1542"></span><span>             </span><span id="local-6989586621683130913"><span class="annot"><a href="#local-6989586621683130913"><span class="hs-identifier hs-var hs-var">typeable_data_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon"><span class="hs-identifier hs-var">tyConSingleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683130908"><span class="hs-identifier hs-var">tyCl</span></a></span><span>  </span><span class="hs-comment">-- &quot;Data constructor&quot;</span><span>
</span><span id="line-1543"></span><span>                                                    </span><span class="hs-comment">-- for Typeable</span><span>
</span><span id="line-1544"></span><span>
</span><span id="line-1545"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130915"><span class="annot"><a href="#local-6989586621683130915"><span class="hs-identifier hs-var">rep_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#ds_ev_typeable"><span class="hs-identifier hs-type">ds_ev_typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130906"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130907"><span class="hs-identifier hs-type">ev</span></a></span><span>           </span><span class="hs-comment">-- :: TypeRep a</span><span>
</span><span id="line-1546"></span><span>
</span><span id="line-1547"></span><span>       </span><span class="hs-comment">-- Package up the method as `Typeable` dictionary</span><span>
</span><span id="line-1548"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.html#mkConApp"><span class="hs-identifier hs-type">mkConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130913"><span class="hs-identifier hs-type">typeable_data_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130911"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130906"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130915"><span class="hs-identifier hs-type">rep_expr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span class="hs-keyword">type</span><span> </span><span id="TypeRepExpr"><span class="annot"><a href="GHC.HsToCore.Binds.html#TypeRepExpr"><span class="hs-identifier hs-var">TypeRepExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1551"></span><span>
</span><span id="line-1552"></span><span class="annot"><span class="hs-comment">-- | Returns a @CoreExpr :: TypeRep ty@</span></span><span>
</span><span id="line-1553"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#ds_ev_typeable"><span class="hs-identifier hs-type">ds_ev_typeable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTypeable"><span class="hs-identifier hs-type">EvTypeable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1554"></span><span id="ds_ev_typeable"><span class="annot"><span class="annottext">ds_ev_typeable :: Type -&gt; EvTypeable -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#ds_ev_typeable"><span class="hs-identifier hs-var hs-var">ds_ev_typeable</span></a></span></span><span> </span><span id="local-6989586621683130919"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130919"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTypeableTyCon"><span class="hs-identifier hs-type">EvTypeableTyCon</span></a></span><span> </span><span id="local-6989586621683130921"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683130921"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683130922"><span class="annot"><span class="annottext">[EvTerm]
</span><a href="#local-6989586621683130922"><span class="hs-identifier hs-var">kind_ev</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1555"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130923"><span class="annot"><a href="#local-6989586621683130923"><span class="hs-identifier hs-var">mkTrCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#mkTrConName"><span class="hs-identifier hs-var">mkTrConName</span></a></span><span>
</span><span id="line-1556"></span><span>                    </span><span class="hs-comment">-- mkTrCon :: forall k (a :: k). TyCon -&gt; TypeRep k -&gt; TypeRep a</span><span>
</span><span id="line-1557"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130926"><span class="annot"><a href="#local-6989586621683130926"><span class="hs-identifier hs-var">someTypeRepTyCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-type">dsLookupTyCon</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#someTypeRepTyConName"><span class="hs-identifier hs-type">someTypeRepTyConName</span></a></span><span>
</span><span id="line-1558"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130928"><span class="annot"><a href="#local-6989586621683130928"><span class="hs-identifier hs-var">someTypeRepDataCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-type">dsLookupDataCon</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#someTypeRepDataConName"><span class="hs-identifier hs-type">someTypeRepDataConName</span></a></span><span>
</span><span id="line-1559"></span><span>                    </span><span class="hs-comment">-- SomeTypeRep :: forall k (a :: k). TypeRep a -&gt; SomeTypeRep</span><span>
</span><span id="line-1560"></span><span>
</span><span id="line-1561"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130931"><span class="annot"><a href="#local-6989586621683130931"><span class="hs-identifier hs-var">tc_rep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#tyConRep"><span class="hs-identifier hs-type">tyConRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130921"><span class="hs-identifier hs-type">tc</span></a></span><span>                      </span><span class="hs-comment">-- :: TyCon</span><span>
</span><span id="line-1562"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130933"><span class="annot"><a href="#local-6989586621683130933"><span class="hs-identifier hs-var hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [Type]
Type -&gt; [Type]
</span><a href="GHC.Core.Type.html#tyConAppArgs"><span class="hs-identifier hs-var">tyConAppArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130919"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1563"></span><span>             </span><span class="hs-comment">-- Construct a SomeTypeRep</span><span>
</span><span id="line-1564"></span><span>             </span><span class="annot"><a href="#local-6989586621683130935"><span class="hs-identifier hs-type">toSomeTypeRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1565"></span><span>             </span><span id="local-6989586621683130935"><span class="annot"><a href="#local-6989586621683130935"><span class="hs-identifier hs-var hs-var">toSomeTypeRep</span></a></span></span><span> </span><span id="local-6989586621683130936"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130936"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621683130937"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130937"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1566"></span><span>                 </span><span id="local-6989586621683130938"><span class="annot"><a href="#local-6989586621683130938"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-var">getRep</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130937"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130936"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1567"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkCoreConApps"><span class="hs-identifier hs-type">mkCoreConApps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130928"><span class="hs-identifier hs-type">someTypeRepDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-type">typeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130936"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130936"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130938"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1568"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130941"><span class="annot"><a href="#local-6989586621683130941"><span class="hs-identifier hs-var">kind_arg_reps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">sequence</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><a href="#local-6989586621683130935"><span class="hs-identifier hs-type">toSomeTypeRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130933"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130922"><span class="hs-identifier hs-type">kind_ev</span></a></span><span>   </span><span class="hs-comment">-- :: TypeRep t</span><span>
</span><span id="line-1569"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- :: [SomeTypeRep]</span><span>
</span><span id="line-1570"></span><span>             </span><span id="local-6989586621683130944"><span class="annot"><a href="#local-6989586621683130944"><span class="hs-identifier hs-var hs-var">kind_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkListExpr"><span class="hs-identifier hs-var">mkListExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683130926"><span class="hs-identifier hs-var">someTypeRepTyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683130941"><span class="hs-identifier hs-var">kind_arg_reps</span></a></span><span>
</span><span id="line-1571"></span><span>
</span><span id="line-1572"></span><span>         </span><span class="hs-comment">-- Note that we use the kind of the type, not the TyCon from which it</span><span>
</span><span id="line-1573"></span><span>         </span><span class="hs-comment">-- is constructed since the latter may be kind polymorphic whereas the</span><span>
</span><span id="line-1574"></span><span>         </span><span class="hs-comment">-- former we know is not (we checked in the solver).</span><span>
</span><span id="line-1575"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130947"><span class="annot"><a href="#local-6989586621683130947"><span class="hs-identifier hs-var hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130923"><span class="hs-identifier hs-var">mkTrCon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130919"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130919"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1577"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130931"><span class="hs-identifier hs-var">tc_rep</span></a></span><span>
</span><span id="line-1578"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130944"><span class="hs-identifier hs-var">kind_args</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1579"></span><span>       </span><span class="hs-comment">-- ; pprRuntimeTrace &quot;Trace mkTrTyCon&quot; (ppr expr) expr</span><span>
</span><span id="line-1580"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683130947"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-1581"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1582"></span><span>
</span><span id="line-1583"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#ds_ev_typeable"><span class="hs-identifier hs-var">ds_ev_typeable</span></a></span><span> </span><span id="local-6989586621683130949"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130949"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTypeableTyApp"><span class="hs-identifier hs-type">EvTypeableTyApp</span></a></span><span> </span><span id="local-6989586621683130951"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130951"><span class="hs-identifier hs-var">ev1</span></a></span></span><span> </span><span id="local-6989586621683130952"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130952"><span class="hs-identifier hs-var">ev2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1584"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130953"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130953"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683130954"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130954"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130949"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1585"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130956"><span class="annot"><a href="#local-6989586621683130956"><span class="hs-identifier hs-var">e1</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-var">getRep</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130951"><span class="hs-identifier hs-var">ev1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130953"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1586"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130957"><span class="annot"><a href="#local-6989586621683130957"><span class="hs-identifier hs-var">e2</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-type">getRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130952"><span class="hs-identifier hs-type">ev2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130954"><span class="hs-identifier hs-type">t2</span></a></span><span>
</span><span id="line-1587"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130958"><span class="annot"><a href="#local-6989586621683130958"><span class="hs-identifier hs-var">mkTrApp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#mkTrAppName"><span class="hs-identifier hs-type">mkTrAppName</span></a></span><span>
</span><span id="line-1588"></span><span>                    </span><span class="hs-comment">-- mkTrApp :: forall k1 k2 (a :: k1 -&gt; k2) (b :: k1).</span><span>
</span><span id="line-1589"></span><span>                    </span><span class="hs-comment">--            TypeRep a -&gt; TypeRep b -&gt; TypeRep (a b)</span><span>
</span><span id="line-1590"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130960"><span class="annot"><a href="#local-6989586621683130960"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683130961"><span class="annot"><a href="#local-6989586621683130961"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#splitFunTy"><span class="hs-identifier hs-type">splitFunTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-type">typeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130953"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- drop the multiplicity,</span><span>
</span><span id="line-1591"></span><span>                                                     </span><span class="hs-comment">-- since it's a kind</span><span>
</span><span id="line-1592"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130963"><span class="annot"><a href="#local-6989586621683130963"><span class="hs-identifier hs-var hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; [Type] -&gt; CoreExpr
forall b. Expr b -&gt; [Type] -&gt; Expr b
</span><a href="GHC.Core.html#mkTyApps"><span class="hs-identifier hs-var">mkTyApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683130958"><span class="hs-identifier hs-var">mkTrApp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130960"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130961"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130953"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130954"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1593"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130956"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683130957"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1594"></span><span>       </span><span class="hs-comment">-- ; pprRuntimeTrace &quot;Trace mkTrApp&quot; (ppr expr) expr</span><span>
</span><span id="line-1595"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683130963"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-1596"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#ds_ev_typeable"><span class="hs-identifier hs-var">ds_ev_typeable</span></a></span><span> </span><span id="local-6989586621683130965"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130965"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTypeableTrFun"><span class="hs-identifier hs-type">EvTypeableTrFun</span></a></span><span> </span><span id="local-6989586621683130967"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130967"><span class="hs-identifier hs-var">evm</span></a></span></span><span> </span><span id="local-6989586621683130968"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130968"><span class="hs-identifier hs-var">ev1</span></a></span></span><span> </span><span id="local-6989586621683130969"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130969"><span class="hs-identifier hs-var">ev2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1599"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683130970"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683130970"><span class="hs-identifier hs-var">_af</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683130971"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130971"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683130972"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130972"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683130973"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130973"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130965"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1600"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130975"><span class="annot"><a href="#local-6989586621683130975"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-var">getRep</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130968"><span class="hs-identifier hs-var">ev1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130972"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1601"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130976"><span class="annot"><a href="#local-6989586621683130976"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-type">getRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130969"><span class="hs-identifier hs-type">ev2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130973"><span class="hs-identifier hs-type">t2</span></a></span><span>
</span><span id="line-1602"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130977"><span class="annot"><a href="#local-6989586621683130977"><span class="hs-identifier hs-var">em</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-type">getRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130967"><span class="hs-identifier hs-type">evm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130971"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1603"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130978"><span class="annot"><a href="#local-6989586621683130978"><span class="hs-identifier hs-var">mkTrFun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#mkTrFunName"><span class="hs-identifier hs-type">mkTrFunName</span></a></span><span>
</span><span id="line-1604"></span><span>                    </span><span class="hs-comment">-- mkTrFun :: forall (m :: Multiplicity) r1 r2 (a :: TYPE r1) (b :: TYPE r2).</span><span>
</span><span id="line-1605"></span><span>                    </span><span class="hs-comment">--            TypeRep m -&gt; TypeRep a -&gt; TypeRep b -&gt; TypeRep (a % m -&gt; b)</span><span>
</span><span id="line-1606"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683130980"><span class="annot"><a href="#local-6989586621683130980"><span class="hs-identifier hs-var hs-var">r1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130972"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1607"></span><span>             </span><span id="local-6989586621683130982"><span class="annot"><a href="#local-6989586621683130982"><span class="hs-identifier hs-var hs-var">r2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130973"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1608"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-type">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#mkTyApps"><span class="hs-identifier hs-type">mkTyApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130978"><span class="hs-identifier hs-type">mkTrFun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683130971"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130980"><span class="hs-identifier hs-type">r1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130982"><span class="hs-identifier hs-type">r2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130972"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130973"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1609"></span><span>                         </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621683130977"><span class="hs-identifier hs-type">em</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130975"><span class="hs-identifier hs-type">e1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683130976"><span class="hs-identifier hs-type">e2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1610"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1611"></span><span>
</span><span id="line-1612"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#ds_ev_typeable"><span class="hs-identifier hs-var">ds_ev_typeable</span></a></span><span> </span><span id="local-6989586621683130983"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130983"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTypeableTyLit"><span class="hs-identifier hs-type">EvTypeableTyLit</span></a></span><span> </span><span id="local-6989586621683130985"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130985"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1613"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Typeable for Nat and Symbol] in GHC.Tc.Instance.Class</span><span>
</span><span id="line-1614"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130986"><span class="annot"><a href="#local-6989586621683130986"><span class="hs-identifier hs-var">fun</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683130987"><span class="hs-identifier hs-var">tr_fun</span></a></span><span>
</span><span id="line-1615"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130988"><span class="annot"><a href="#local-6989586621683130988"><span class="hs-identifier hs-var">dict</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-type">dsEvTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130985"><span class="hs-identifier hs-type">ev</span></a></span><span>       </span><span class="hs-comment">-- Of type KnownNat/KnownSymbol</span><span>
</span><span id="line-1616"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-type">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#mkTyApps"><span class="hs-identifier hs-type">mkTyApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130986"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683130983"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621683130988"><span class="hs-identifier hs-type">dict</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1617"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1618"></span><span>    </span><span id="local-6989586621683130989"><span class="annot"><span class="annottext">ty_kind :: Type
</span><a href="#local-6989586621683130989"><span class="hs-identifier hs-var hs-var">ty_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130983"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1619"></span><span>
</span><span id="line-1620"></span><span>    </span><span class="hs-comment">-- tr_fun is the Name of</span><span>
</span><span id="line-1621"></span><span>    </span><span class="hs-comment">--       typeNatTypeRep    :: KnownNat    a =&gt; TypeRep a</span><span>
</span><span id="line-1622"></span><span>    </span><span class="hs-comment">-- of    typeSymbolTypeRep :: KnownSymbol a =&gt; TypeRep a</span><span>
</span><span id="line-1623"></span><span>    </span><span id="local-6989586621683130987"><span class="annot"><span class="annottext">tr_fun :: Name
</span><a href="#local-6989586621683130987"><span class="hs-identifier hs-var hs-var">tr_fun</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130989"><span class="hs-identifier hs-var">ty_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#naturalTy"><span class="hs-identifier hs-var">naturalTy</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeNatTypeRepName"><span class="hs-identifier hs-var">typeNatTypeRepName</span></a></span><span>
</span><span id="line-1624"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130989"><span class="hs-identifier hs-var">ty_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#typeSymbolKind"><span class="hs-identifier hs-var">typeSymbolKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeSymbolTypeRepName"><span class="hs-identifier hs-var">typeSymbolTypeRepName</span></a></span><span>
</span><span id="line-1625"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130989"><span class="hs-identifier hs-var">ty_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#charTy"><span class="hs-identifier hs-var">charTy</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeCharTypeRepName"><span class="hs-identifier hs-var">typeCharTypeRepName</span></a></span><span>
</span><span id="line-1626"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsEvTypeable: unknown type lit kind&quot;</span></span><span>
</span><span id="line-1627"></span><span>
</span><span id="line-1628"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#ds_ev_typeable"><span class="hs-identifier hs-var">ds_ev_typeable</span></a></span><span> </span><span id="local-6989586621683130993"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130993"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683130994"><span class="annot"><span class="annottext">EvTypeable
</span><a href="#local-6989586621683130994"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-1629"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM CoreExpr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsEvTypeable&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130993"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">EvTypeable -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvTypeable
</span><a href="#local-6989586621683130994"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1630"></span><span>
</span><span id="line-1631"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-type">getRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ EvTerm for @Typeable ty@</span></span><span>
</span><span id="line-1632"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ The type @ty@</span></span><span>
</span><span id="line-1633"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html#TypeRepExpr"><span class="hs-identifier hs-type">TypeRepExpr</span></a></span><span> </span><span class="hs-comment">-- ^ Return @CoreExpr :: TypeRep ty@</span><span>
</span><span id="line-1634"></span><span>                          </span><span class="hs-comment">-- namely @typeRep# dict@</span><span>
</span><span id="line-1635"></span><span class="hs-comment">-- Remember that</span><span>
</span><span id="line-1636"></span><span class="hs-comment">--   typeRep# :: forall k (a::k). Typeable k a -&gt; TypeRep a</span><span>
</span><span id="line-1637"></span><span id="getRep"><span class="annot"><span class="annottext">getRep :: EvTerm -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#getRep"><span class="hs-identifier hs-var hs-var">getRep</span></a></span></span><span> </span><span id="local-6989586621683130995"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130995"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683130996"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130996"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1638"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683130997"><span class="annot"><a href="#local-6989586621683130997"><span class="hs-identifier hs-var">typeable_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#dsEvTerm"><span class="hs-identifier hs-var">dsEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683130995"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1639"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683130998"><span class="annot"><a href="#local-6989586621683130998"><span class="hs-identifier hs-var">typeRepId</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#typeRepIdName"><span class="hs-identifier hs-type">typeRepIdName</span></a></span><span>
</span><span id="line-1640"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683131000"><span class="annot"><a href="#local-6989586621683131000"><span class="hs-identifier hs-var hs-var">ty_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130996"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683130996"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1641"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-type">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#mkTyApps"><span class="hs-identifier hs-type">mkTyApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683130998"><span class="hs-identifier hs-type">typeRepId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683131000"><span class="hs-identifier hs-type">ty_args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621683130997"><span class="hs-identifier hs-type">typeable_expr</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span class="annot"><a href="GHC.HsToCore.Binds.html#tyConRep"><span class="hs-identifier hs-type">tyConRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1644"></span><span class="hs-comment">-- Returns CoreExpr :: TyCon</span><span>
</span><span id="line-1645"></span><span id="tyConRep"><span class="annot"><span class="annottext">tyConRep :: TyCon -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Binds.html#tyConRep"><span class="hs-identifier hs-var hs-var">tyConRep</span></a></span></span><span> </span><span id="local-6989586621683131001"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683131001"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-1646"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683131002"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683131002"><span class="hs-identifier hs-var">tc_rep_nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Name
</span><a href="GHC.Core.TyCon.html#tyConRepName_maybe"><span class="hs-identifier hs-var">tyConRepName_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683131001"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1647"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683131004"><span class="annot"><a href="#local-6989586621683131004"><span class="hs-identifier hs-var">tc_rep_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683131002"><span class="hs-identifier hs-var">tc_rep_nm</span></a></span><span>
</span><span id="line-1648"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683131004"><span class="hs-identifier hs-type">tc_rep_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1649"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1650"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM CoreExpr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tyConRep&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683131001"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1651"></span></pre></body></html>