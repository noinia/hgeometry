<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecursiveDo #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html"><span class="hs-identifier">GHC.Tc.Solver.Solve</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-4"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveSimpleGivens"><span class="hs-identifier">solveSimpleGivens</span></a></span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Solves [Ct]</span><span>
</span><span id="line-5"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveSimpleWanteds"><span class="hs-identifier">solveSimpleWanteds</span></a></span><span>   </span><span class="hs-comment">-- Solves Cts</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Dict.html"><span class="hs-identifier">GHC.Tc.Solver.Dict</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Equality.html"><span class="hs-identifier">GHC.Tc.Solver.Equality</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Equality.html#solveEquality"><span class="hs-identifier">solveEquality</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Irred.html"><span class="hs-identifier">GHC.Tc.Solver.Irred</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Irred.html#solveIrred"><span class="hs-identifier">solveIrred</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Rewrite.html"><span class="hs-identifier">GHC.Tc.Solver.Rewrite</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier">rewrite</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html"><span class="hs-identifier">GHC.Tc.Types.CtLoc</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctLocEnv"><span class="hs-identifier">ctLocEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctLocOrigin"><span class="hs-identifier">ctLocOrigin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#setCtLocOrigin"><span class="hs-identifier">setCtLocOrigin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html"><span class="hs-identifier">GHC.Tc.Solver.InertSet</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html"><span class="hs-identifier">GHC.Tc.Solver.Monad</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html"><span class="hs-identifier">GHC.Core.Reduction</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#classHasSCs"><span class="hs-identifier">classHasSCs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#IntWithInf"><span class="hs-identifier">IntWithInf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#intGtLimit"><span class="hs-identifier">intGtLimit</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">deleteFirstsBy</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Void.html"><span class="hs-identifier">Data.Void</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Void</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">{-
**********************************************************************
*                                                                    *
*                      Main Solver                                   *
*                                                                    *
**********************************************************************

Note [Basic Simplifier Plan]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Pick an element from the WorkList if there exists one with depth
   less than our context-stack depth.

2. Run it down the 'stage' pipeline. Stages are:
      - canonicalization
      - inert reactions
      - spontaneous reactions
      - top-level interactions
   Each stage returns a StopOrContinue and may have sideeffected
   the inerts or worklist.

   The threading of the stages is as follows:
      - If (Stop) is returned by a stage then we start again from Step 1.
      - If (ContinueWith ct) is returned by a stage, we feed 'ct' on to
        the next stage in the pipeline.
4. If the element has survived (i.e. ContinueWith x) the last stage
   then we add it in the inerts and jump back to Step 1.

If in Step 1 no such element exists, we have exceeded our context-stack
depth and will simply fail.
-}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveSimpleGivens"><span class="hs-identifier hs-type">solveSimpleGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span id="solveSimpleGivens"><span class="annot"><span class="annottext">solveSimpleGivens :: [Ct] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Solve.html#solveSimpleGivens"><span class="hs-identifier hs-var hs-var">solveSimpleGivens</span></a></span></span><span> </span><span id="local-6989586621683044833"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683044833"><span class="hs-identifier hs-var">givens</span></a></span></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683044833"><span class="hs-identifier hs-var">givens</span></a></span><span>  </span><span class="hs-comment">-- Shortcut for common case</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;solveSimpleGivens {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683044833"><span class="hs-identifier hs-var">givens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS ()
</span><a href="#local-6989586621683044837"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683044833"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-85"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;End solveSimpleGivens }&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621683044837"><span class="annot"><span class="annottext">go :: [Ct] -&gt; TcS ()
</span><a href="#local-6989586621683044837"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683044843"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683044843"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Solve.html#solveSimples"><span class="hs-identifier hs-var">solveSimples</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; Cts
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683044843"><span class="hs-identifier hs-var">givens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683044846"><span class="annot"><a href="#local-6989586621683044846"><span class="hs-identifier hs-var">new_givens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS [Ct]
</span><a href="GHC.Tc.Solver.Solve.html#runTcPluginsGiven"><span class="hs-identifier hs-var">runTcPluginsGiven</span></a></span><span>
</span><span id="line-89"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-type">notNull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044846"><span class="hs-identifier hs-type">new_givens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-90"></span><span>                     </span><span class="annot"><a href="#local-6989586621683044837"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044846"><span class="hs-identifier hs-type">new_givens</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveSimpleWanteds"><span class="hs-identifier hs-type">solveSimpleWanteds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- The result is not necessarily zonked</span><span>
</span><span id="line-94"></span><span id="solveSimpleWanteds"><span class="annot"><span class="annottext">solveSimpleWanteds :: Cts -&gt; TcS WantedConstraints
</span><a href="GHC.Tc.Solver.Solve.html#solveSimpleWanteds"><span class="hs-identifier hs-var hs-var">solveSimpleWanteds</span></a></span></span><span> </span><span id="local-6989586621683044850"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683044850"><span class="hs-identifier hs-var">simples</span></a></span></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;solveSimpleWanteds {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cts -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683044850"><span class="hs-identifier hs-var">simples</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683044851"><span class="annot"><a href="#local-6989586621683044851"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-97"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683044853"><span class="annot"><a href="#local-6989586621683044853"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683044854"><span class="annot"><a href="#local-6989586621683044854"><span class="hs-identifier hs-var">wc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683044855"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#solverIterations"><span class="hs-identifier hs-var">solverIterations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044851"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-type">emptyWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683044850"><span class="hs-identifier hs-type">simples</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;solveSimpleWanteds end }&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-99"></span><span>             </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;iterations =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044853"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-100"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;residual =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044854"><span class="hs-identifier hs-type">wc</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683044854"><span class="hs-identifier hs-type">wc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><a href="#local-6989586621683044855"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#IntWithInf"><span class="hs-identifier hs-type">IntWithInf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- See Note [The solveSimpleWanteds loop]</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621683044855"><span class="annot"><span class="annottext">go :: Int
-&gt; IntWithInf -&gt; WantedConstraints -&gt; TcS (Int, WantedConstraints)
</span><a href="#local-6989586621683044855"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683044862"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683044862"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683044863"><span class="annot"><span class="annottext">IntWithInf
</span><a href="#local-6989586621683044863"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621683044864"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683044864"><span class="hs-identifier hs-var">wc</span></a></span></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683044862"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntWithInf -&gt; Bool
</span><a href="GHC.Types.Basic.html#intGtLimit"><span class="hs-operator hs-var">`intGtLimit`</span></a></span><span> </span><span class="annot"><span class="annottext">IntWithInf
</span><a href="#local-6989586621683044863"><span class="hs-identifier hs-var">limit</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcS (Int, WantedConstraints)
forall a. TcRnMessage -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#failTcS"><span class="hs-identifier hs-var">failTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcS (Int, WantedConstraints))
-&gt; TcRnMessage -&gt; TcS (Int, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cts -&gt; IntWithInf -&gt; WantedConstraints -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnSimplifierTooManyIterations"><span class="hs-identifier hs-var">TcRnSimplifierTooManyIterations</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683044850"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">IntWithInf
</span><a href="#local-6989586621683044863"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683044864"><span class="hs-identifier hs-var">wc</span></a></span><span>
</span><span id="line-108"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Cts
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683044864"><span class="hs-identifier hs-var">wc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, WantedConstraints) -&gt; TcS (Int, WantedConstraints)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683044862"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683044864"><span class="hs-identifier hs-var">wc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-112"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Solve</span><span>
</span><span id="line-113"></span><span>            </span><span id="local-6989586621683044868"><span class="annot"><a href="#local-6989586621683044868"><span class="hs-identifier hs-var">wc1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcS WantedConstraints
</span><a href="GHC.Tc.Solver.Solve.html#solve_simple_wanteds"><span class="hs-identifier hs-var">solve_simple_wanteds</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683044864"><span class="hs-identifier hs-var">wc</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>            </span><span class="hs-comment">-- Run plugins</span><span>
</span><span id="line-116"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683044870"><span class="annot"><a href="#local-6989586621683044870"><span class="hs-identifier hs-var">rerun_plugin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683044871"><span class="annot"><a href="#local-6989586621683044871"><span class="hs-identifier hs-var">wc2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#runTcPluginsWanted"><span class="hs-identifier hs-type">runTcPluginsWanted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044868"><span class="hs-identifier hs-type">wc1</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683044870"><span class="hs-identifier hs-type">rerun_plugin</span></a></span><span>
</span><span id="line-119"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;solveSimple going round again:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044870"><span class="hs-identifier hs-type">rerun_plugin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683044855"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683044862"><span class="hs-identifier hs-type">n</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683044863"><span class="hs-identifier hs-type">limit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044871"><span class="hs-identifier hs-type">wc2</span></a></span><span> </span><span class="hs-special">}</span><span>   </span><span class="hs-comment">-- Loop</span><span>
</span><span id="line-121"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683044862"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683044871"><span class="hs-identifier hs-type">wc2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>           </span><span class="hs-comment">-- Done</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solve_simple_wanteds"><span class="hs-identifier hs-type">solve_simple_wanteds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- Try solving these constraints</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- Affects the unification state (of course) but not the inert set</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- The result is not necessarily zonked</span><span>
</span><span id="line-128"></span><span id="solve_simple_wanteds"><span class="annot"><span class="annottext">solve_simple_wanteds :: WantedConstraints -&gt; TcS WantedConstraints
</span><a href="GHC.Tc.Solver.Solve.html#solve_simple_wanteds"><span class="hs-identifier hs-var hs-var">solve_simple_wanteds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WC"><span class="hs-identifier hs-type">WC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wc_simple :: WantedConstraints -&gt; Cts
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044875"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683044875"><span class="hs-identifier hs-var">simples1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wc_impl :: WantedConstraints -&gt; Bag Implication
</span><a href="GHC.Tc.Types.Constraint.html#wc_impl"><span class="hs-identifier hs-var">wc_impl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044877"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621683044877"><span class="hs-identifier hs-var">implics1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wc_errors :: WantedConstraints -&gt; Bag DelayedError
</span><a href="GHC.Tc.Types.Constraint.html#wc_errors"><span class="hs-identifier hs-var">wc_errors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044879"><span class="annot"><span class="annottext">Bag DelayedError
</span><a href="#local-6989586621683044879"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS WantedConstraints -&gt; TcS WantedConstraints
forall a. TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#nestTcS"><span class="hs-identifier hs-var">nestTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcS WantedConstraints -&gt; TcS WantedConstraints)
-&gt; TcS WantedConstraints -&gt; TcS WantedConstraints
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Solve.html#solveSimples"><span class="hs-identifier hs-var">solveSimples</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683044875"><span class="hs-identifier hs-var">simples1</span></a></span><span>
</span><span id="line-131"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683044881"><span class="annot"><a href="#local-6989586621683044881"><span class="hs-identifier hs-var">implics2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683044882"><span class="annot"><a href="#local-6989586621683044882"><span class="hs-identifier hs-var">unsolved</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (Bag Implication, Cts)
</span><a href="GHC.Tc.Solver.Monad.html#getUnsolvedInerts"><span class="hs-identifier hs-var">getUnsolvedInerts</span></a></span><span>
</span><span id="line-132"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WC"><span class="hs-identifier hs-type">WC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683044882"><span class="hs-identifier hs-type">unsolved</span></a></span><span>
</span><span id="line-133"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_impl"><span class="hs-identifier hs-var">wc_impl</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683044877"><span class="hs-identifier hs-type">implics1</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044881"><span class="hs-identifier hs-type">implics2</span></a></span><span>
</span><span id="line-134"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_errors"><span class="hs-identifier hs-var">wc_errors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683044879"><span class="hs-identifier hs-type">errs</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">{- Note [The solveSimpleWanteds loop]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Solving a bunch of simple constraints is done in a loop,
(the 'go' loop of 'solveSimpleWanteds'):
  1. Try to solve them
  2. Try the plugin
  3. If the plugin wants to run again, go back to step 1
-}</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
           Solving flat constraints: solveSimples
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- The main solver loop implements Note [Basic Simplifier Plan]</span><span>
</span><span id="line-153"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-154"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveSimples"><span class="hs-identifier hs-type">solveSimples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- Returns the final InertSet in TcS</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- Has no effect on work-list or residual-implications</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- The constraints are initially examined in left-to-right order</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="solveSimples"><span class="annot"><span class="annottext">solveSimples :: Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Solve.html#solveSimples"><span class="hs-identifier hs-var hs-var">solveSimples</span></a></span></span><span> </span><span id="local-6989586621683044885"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683044885"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;solveSimples&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683044885"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcS ()
</span><a href="#local-6989586621683044887"><span class="hs-identifier hs-var">solve_loop</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621683044887"><span class="annot"><span class="annottext">solve_loop :: TcS ()
</span><a href="#local-6989586621683044887"><span class="hs-identifier hs-var hs-var">solve_loop</span></a></span></span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;solve_loop&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683044891"><span class="annot"><a href="#local-6989586621683044891"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (Maybe Ct)
</span><a href="GHC.Tc.Solver.Monad.html#selectNextWorkItem"><span class="hs-identifier hs-var">selectNextWorkItem</span></a></span><span>
</span><span id="line-166"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683044891"><span class="hs-identifier hs-type">sel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-167"></span><span>              </span><span class="annot"><span class="annottext">Maybe Ct
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683044893"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044893"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Solve.html#solveOne"><span class="hs-identifier hs-var">solveOne</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044893"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-169"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcS ()
</span><a href="#local-6989586621683044887"><span class="hs-identifier hs-var">solve_loop</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveOne"><span class="hs-identifier hs-type">solveOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Solve one constraint</span><span>
</span><span id="line-172"></span><span id="solveOne"><span class="annot"><span class="annottext">solveOne :: Ct -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Solve.html#solveOne"><span class="hs-identifier hs-var hs-var">solveOne</span></a></span></span><span> </span><span id="local-6989586621683044895"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044895"><span class="hs-identifier hs-var">workItem</span></a></span></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683044896"><span class="annot"><a href="#local-6989586621683044896"><span class="hs-identifier hs-var">wl</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS WorkList
</span><a href="GHC.Tc.Solver.Monad.html#getWorkList"><span class="hs-identifier hs-var">getWorkList</span></a></span><span>
</span><span id="line-174"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683044898"><span class="annot"><a href="#local-6989586621683044898"><span class="hs-identifier hs-var">inerts</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-type">getInertSet</span></a></span><span>
</span><span id="line-175"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683044900"><span class="annot"><a href="#local-6989586621683044900"><span class="hs-identifier hs-var">tclevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-176"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;----------------------------- &quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Start solver pipeline {&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-178"></span><span>                  </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tclevel =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044900"><span class="hs-identifier hs-type">tclevel</span></a></span><span>
</span><span id="line-179"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;work item =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044895"><span class="hs-identifier hs-type">workItem</span></a></span><span>
</span><span id="line-180"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inerts =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044898"><span class="hs-identifier hs-type">inerts</span></a></span><span>
</span><span id="line-181"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rest of worklist =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044896"><span class="hs-identifier hs-type">wl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#bumpStepCountTcS"><span class="hs-identifier hs-type">bumpStepCountTcS</span></a></span><span>    </span><span class="hs-comment">-- One step for each constraint processed</span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683044903"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044895"><span class="hs-identifier hs-type">workItem</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><a href="#local-6989586621683044903"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span id="local-6989586621683044903"><span class="annot"><span class="annottext">solve :: Ct -&gt; TcS ()
</span><a href="#local-6989586621683044903"><span class="hs-identifier hs-var hs-var">solve</span></a></span></span><span> </span><span id="local-6989586621683044904"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044904"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-188"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;solve {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;workitem = &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044904"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683044905"><span class="annot"><a href="#local-6989586621683044905"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SolverStage Void -&gt; TcS (StopOrContinue Void)
forall a. SolverStage a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#runSolverStage"><span class="hs-identifier hs-var">runSolverStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Solve.html#solveCt"><span class="hs-identifier hs-var">solveCt</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044904"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;end solve }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044905"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683044905"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-192"></span><span>               </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StartAgain"><span class="hs-identifier hs-type">StartAgain</span></a></span><span> </span><span id="local-6989586621683044909"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044909"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Go round again&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044909"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>                                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS ()
</span><a href="#local-6989586621683044903"><span class="hs-identifier hs-var">solve</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683044909"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>               </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Stop"><span class="hs-identifier hs-type">Stop</span></a></span><span> </span><span id="local-6989586621683044911"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044911"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683044912"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683044912"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-identifier hs-var">traceFireTcS</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044911"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683044912"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-196"></span><span>                               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;End solver pipeline }&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-197"></span><span>                               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>               </span><span class="hs-comment">-- ContinueWith can't happen: res :: SolverStage Void</span><span>
</span><span id="line-200"></span><span>               </span><span class="hs-comment">-- solveCt either solves the constraint, or puts</span><span>
</span><span id="line-201"></span><span>               </span><span class="hs-comment">-- the unsolved constraint in the inert set.</span><span>
</span><span id="line-202"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
*              Solving one constraint: solveCt
*                                                                      *
************************************************************************

Note [Canonicalization]
~~~~~~~~~~~~~~~~~~~~~~~
Canonicalization converts a simple constraint to a canonical form. It is
unary (i.e. treats individual constraints one at a time).

Constraints originating from user-written code come into being as
CNonCanonicals. We know nothing about these constraints. So, first:

     Classify CNonCanoncal constraints, depending on whether they
     are equalities, class predicates, or other.

Then proceed depending on the shape of the constraint. Generally speaking,
each constraint gets rewritten and then decomposed into one of several forms
(see type Ct in GHC.Tc.Types).

When an already-canonicalized constraint gets kicked out of the inert set,
it must be recanonicalized. But we know a bit about its shape from the
last time through, so we can skip the classification step.
-}</span></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveCt"><span class="hs-identifier hs-type">solveCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-231"></span><span class="hs-comment">-- The Void result tells us that solveCt cannot return</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- a ContinueWith; it must return Stop or StartAgain.</span><span>
</span><span id="line-233"></span><span id="solveCt"><span class="annot"><span class="annottext">solveCt :: Ct -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Solve.html#solveCt"><span class="hs-identifier hs-var hs-var">solveCt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CNonCanonical"><span class="hs-identifier hs-type">CNonCanonical</span></a></span><span> </span><span id="local-6989586621683044915"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044915"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Solve.html#solveNC"><span class="hs-identifier hs-var">solveNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044915"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveCt"><span class="hs-identifier hs-var">solveCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ev :: IrredCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044920"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044920"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Solve.html#solveNC"><span class="hs-identifier hs-var">solveNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044920"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveCt"><span class="hs-identifier hs-var">solveCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_ev :: EqCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#eq_ev"><span class="hs-identifier hs-var">eq_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044924"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044924"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_eq_rel :: EqCt -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#eq_eq_rel"><span class="hs-identifier hs-var">eq_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044926"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683044926"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span>
</span><span id="line-237"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044928"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621683044928"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_rhs :: EqCt -&gt; Xi
</span><a href="GHC.Tc.Types.Constraint.html#eq_rhs"><span class="hs-identifier hs-var">eq_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044930"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044930"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Xi -&gt; Xi -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Equality.html#solveEquality"><span class="hs-identifier hs-var">solveEquality</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044924"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683044926"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Xi
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621683044928"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044930"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveCt"><span class="hs-identifier hs-var">solveCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-type">CQuantCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_ev :: QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044935"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044935"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pend_sc :: QCInst -&gt; Int
</span><a href="GHC.Tc.Types.Constraint.html#qci_pend_sc"><span class="hs-identifier hs-var">qci_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044937"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683044937"><span class="hs-identifier hs-var">pend_sc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683044938"><span class="annot"><a href="#local-6989586621683044938"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SolverStage CtEvidence
</span><a href="GHC.Tc.Solver.Solve.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044935"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-242"></span><span>         </span><span class="hs-comment">-- It is (much) easier to rewrite and re-classify than to</span><span>
</span><span id="line-243"></span><span>         </span><span class="hs-comment">-- rewrite the pieces and build a Reduction that will rewrite</span><span>
</span><span id="line-244"></span><span>         </span><span class="hs-comment">-- the whole constraint</span><span>
</span><span id="line-245"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-type">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-type">ctEvPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044938"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#ForAllPred"><span class="hs-identifier hs-type">ForAllPred</span></a></span><span> </span><span id="local-6989586621683044943"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683044943"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621683044944"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044944"><span class="hs-identifier hs-var">th</span></a></span></span><span> </span><span id="local-6989586621683044945"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044945"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue Void) -&gt; SolverStage Void
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue Void) -&gt; SolverStage Void)
-&gt; TcS (StopOrContinue Void) -&gt; SolverStage Void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; [TyVar] -&gt; [Xi] -&gt; Xi -&gt; Int -&gt; TcS (StopOrContinue Void)
</span><a href="GHC.Tc.Solver.Solve.html#solveForAll"><span class="hs-identifier hs-var">solveForAll</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044938"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683044943"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044944"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044945"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683044937"><span class="hs-identifier hs-var">pend_sc</span></a></span><span>
</span><span id="line-247"></span><span>           </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; SolverStage Void
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SolveCt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044938"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveCt"><span class="hs-identifier hs-var">solveCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_ev :: DictCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#di_ev"><span class="hs-identifier hs-var">di_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044952"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044952"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_pend_sc :: DictCt -&gt; Int
</span><a href="GHC.Tc.Types.Constraint.html#di_pend_sc"><span class="hs-identifier hs-var">di_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683044954"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683044954"><span class="hs-identifier hs-var">pend_sc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683044955"><span class="annot"><a href="#local-6989586621683044955"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SolverStage CtEvidence
</span><a href="GHC.Tc.Solver.Solve.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044952"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-251"></span><span>         </span><span class="hs-comment">-- It is easier to rewrite and re-classify than to rewrite</span><span>
</span><span id="line-252"></span><span>         </span><span class="hs-comment">-- the pieces and build a Reduction that will rewrite the</span><span>
</span><span id="line-253"></span><span>         </span><span class="hs-comment">-- whole constraint</span><span>
</span><span id="line-254"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-type">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-type">ctEvPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044955"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-255"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621683044957"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683044957"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683044958"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044958"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-256"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Dict.html#solveDict"><span class="hs-identifier hs-var">solveDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#di_ev"><span class="hs-identifier hs-var">di_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044955"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_cls :: Class
</span><a href="GHC.Tc.Types.Constraint.html#di_cls"><span class="hs-identifier hs-var">di_cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683044957"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-257"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_tys :: [Xi]
</span><a href="GHC.Tc.Types.Constraint.html#di_tys"><span class="hs-identifier hs-var">di_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044958"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_pend_sc :: Int
</span><a href="GHC.Tc.Types.Constraint.html#di_pend_sc"><span class="hs-identifier hs-var">di_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683044954"><span class="hs-identifier hs-var">pend_sc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>           </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; SolverStage Void
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;solveCt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044955"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-261"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveNC"><span class="hs-identifier hs-type">solveNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-262"></span><span id="solveNC"><span class="annot"><span class="annottext">solveNC :: CtEvidence -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Solve.html#solveNC"><span class="hs-identifier hs-var hs-var">solveNC</span></a></span></span><span> </span><span id="local-6989586621683044962"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044962"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Instead of rewriting the evidence before classifying, it's possible we</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- can make progress without the rewrite. Try this first.</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">-- For insolubles (all of which are equalities), do /not/ rewrite the arguments</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-comment">-- In #14350 doing so led entire-unnecessary and ridiculously large</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- type function expansion.  Instead, canEqNC just applies</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- the substitution to the predicate, and may do decomposition;</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">--    e.g. a ~ [a], where [G] a ~ [Int], can decompose</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Xi -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Xi
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044962"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span id="local-6989586621683044964"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683044964"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621683044965"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044965"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683044966"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044966"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Xi -&gt; Xi -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Equality.html#solveEquality"><span class="hs-identifier hs-var">solveEquality</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044962"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683044964"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044965"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044966"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- Do rewriting on the constraint, especially zonking</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683044967"><span class="annot"><a href="#local-6989586621683044967"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SolverStage CtEvidence
</span><a href="GHC.Tc.Solver.Solve.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044962"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-276"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683044968"><span class="annot"><a href="#local-6989586621683044968"><span class="hs-identifier hs-var hs-var">irred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044967"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ir_reason :: CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#ir_reason"><span class="hs-identifier hs-var">ir_reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#IrredShapeReason"><span class="hs-identifier hs-var">IrredShapeReason</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-comment">-- And then re-classify</span><span>
</span><span id="line-279"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-type">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-type">ctEvPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044967"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-280"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621683044971"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683044971"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683044972"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044972"><span class="hs-identifier hs-var">tys</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Class -&gt; [Xi] -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Dict.html#solveDictNC"><span class="hs-identifier hs-var">solveDictNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044967"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683044971"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044972"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-281"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#ForAllPred"><span class="hs-identifier hs-type">ForAllPred</span></a></span><span> </span><span id="local-6989586621683044974"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683044974"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621683044975"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044975"><span class="hs-identifier hs-var">th</span></a></span></span><span> </span><span id="local-6989586621683044976"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044976"><span class="hs-identifier hs-var">p</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue Void) -&gt; SolverStage Void
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue Void) -&gt; SolverStage Void)
-&gt; TcS (StopOrContinue Void) -&gt; SolverStage Void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; [TyVar] -&gt; [Xi] -&gt; Xi -&gt; TcS (StopOrContinue Void)
</span><a href="GHC.Tc.Solver.Solve.html#solveForAllNC"><span class="hs-identifier hs-var">solveForAllNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044967"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683044974"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044975"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044976"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-282"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#IrredPred"><span class="hs-identifier hs-type">IrredPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Irred.html#solveIrred"><span class="hs-identifier hs-var">solveIrred</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621683044968"><span class="hs-identifier hs-var">irred</span></a></span><span>
</span><span id="line-283"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span id="local-6989586621683044979"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683044979"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621683044980"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044980"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683044981"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044981"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Xi -&gt; Xi -&gt; SolverStage Void
</span><a href="GHC.Tc.Solver.Equality.html#solveEquality"><span class="hs-identifier hs-var">solveEquality</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044967"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683044979"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044980"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044981"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-284"></span><span>              </span><span class="hs-comment">-- This case only happens if (say) `c` is unified with `a ~# b`,</span><span>
</span><span id="line-285"></span><span>              </span><span class="hs-comment">-- but that is rare becuase it requires c :: CONSTRAINT UnliftedRep</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
*                      Quantified constraints
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">{- Note [Quantified constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The -XQuantifiedConstraints extension allows type-class contexts like this:

  data Rose f x = Rose x (f (Rose f x))

  instance (Eq a, forall b. Eq b =&gt; Eq (f b))
        =&gt; Eq (Rose f a)  where
    (Rose x1 rs1) == (Rose x2 rs2) = x1==x2 &amp;&amp; rs1 == rs2

Note the (forall b. Eq b =&gt; Eq (f b)) in the instance contexts.
This quantified constraint is needed to solve the
 [W] (Eq (f (Rose f x)))
constraint which arises form the (==) definition.

The wiki page is
  https://gitlab.haskell.org/ghc/ghc/wikis/quantified-constraints
which in turn contains a link to the GHC Proposal where the change
is specified, and a Haskell Symposium paper about it.

We implement two main extensions to the design in the paper:

 1. We allow a variable in the instance head, e.g.
      f :: forall m a. (forall b. m b) =&gt; D (m a)
    Notice the 'm' in the head of the quantified constraint, not
    a class.

 2. We support superclasses to quantified constraints.
    For example (contrived):
      f :: (Ord b, forall b. Ord b =&gt; Ord (m b)) =&gt; m a -&gt; m a -&gt; Bool
      f x y = x==y
    Here we need (Eq (m a)); but the quantified constraint deals only
    with Ord.  But we can make it work by using its superclass.

Here are the moving parts
  * Language extension {-# LANGUAGE QuantifiedConstraints #-}
    and add it to ghc-boot-th:GHC.LanguageExtensions.Type.Extension

  * A new form of evidence, EvDFun, that is used to discharge
    such wanted constraints

  * checkValidType gets some changes to accept forall-constraints
    only in the right places.

  * Predicate.Pred gets a new constructor ForAllPred, and
    and classifyPredType analyses a PredType to decompose
    the new forall-constraints

  * GHC.Tc.Solver.Monad.InertCans gets an extra field, inert_insts,
    which holds all the Given forall-constraints.  In effect,
    such Given constraints are like local instance decls.

  * When trying to solve a class constraint, via
    GHC.Tc.Solver.Instance.Class.matchInstEnv, use the InstEnv from inert_insts
    so that we include the local Given forall-constraints
    in the lookup.  (See GHC.Tc.Solver.Monad.getInstEnvs.)

  * `solveForAll` deals with solving a forall-constraint.  See
       Note [Solving a Wanted forall-constraint]

  * We augment the kick-out code to kick out an inert
    forall constraint if it can be rewritten by a new
    type equality; see GHC.Tc.Solver.Monad.kick_out_rewritable

Note that a quantified constraint is never /inferred/
(by GHC.Tc.Solver.simplifyInfer).  A function can only have a
quantified constraint in its type if it is given an explicit
type signature.

-}</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveForAllNC"><span class="hs-identifier hs-type">solveForAllNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span>
</span><span id="line-368"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- NC: this came from CNonCanonical, so we have not yet expanded superclasses</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- Precondition: already rewritten by inert set</span><span>
</span><span id="line-371"></span><span id="solveForAllNC"><span class="annot"><span class="annottext">solveForAllNC :: CtEvidence -&gt; [TyVar] -&gt; [Xi] -&gt; Xi -&gt; TcS (StopOrContinue Void)
</span><a href="GHC.Tc.Solver.Solve.html#solveForAllNC"><span class="hs-identifier hs-var hs-var">solveForAllNC</span></a></span></span><span> </span><span id="local-6989586621683044985"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044985"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683044986"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683044986"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621683044987"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044987"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621683044988"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044988"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683044985"><span class="hs-identifier hs-var">ev</span></a></span><span>  </span><span class="hs-comment">-- See Note [Eagerly expand given superclasses]</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683044990"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683044990"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683044991"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683044991"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Class, [Xi])
</span><a href="#local-6989586621683044992"><span class="hs-identifier hs-var">cls_pred_tys_maybe</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683044993"><span class="annot"><a href="#local-6989586621683044993"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-375"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683044994"><span class="annot"><a href="#local-6989586621683044994"><span class="hs-identifier hs-var">sc_cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Dict.html#mkStrictSuperClasses"><span class="hs-identifier hs-type">mkStrictSuperClasses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#givensFuel"><span class="hs-identifier hs-var">givensFuel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044993"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683044985"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044986"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044987"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044990"><span class="hs-identifier hs-type">cls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044991"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-376"></span><span>       </span><span class="hs-comment">-- givensFuel dflags: See Note [Expanding Recursive Superclasses and ExpansionFuel]</span><span>
</span><span id="line-377"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-type">emitWork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-type">listToBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044994"><span class="hs-identifier hs-type">sc_cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveForAll"><span class="hs-identifier hs-type">solveForAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044985"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044986"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044987"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044988"><span class="hs-identifier hs-type">pred</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#doNotExpand"><span class="hs-identifier hs-type">doNotExpand</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-379"></span><span>       </span><span class="hs-comment">-- doNotExpand: as we have already (eagerly) expanded superclasses for this class</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683044998"><span class="annot"><a href="#local-6989586621683044998"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-383"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683044999"><span class="annot"><a href="#local-6989586621683044999"><span class="hs-identifier hs-var hs-var">fuel</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045000"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683045000"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Xi]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Class, [Xi])
</span><a href="#local-6989586621683044992"><span class="hs-identifier hs-var">cls_pred_tys_maybe</span></a></span><span>
</span><span id="line-384"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Class.html#classHasSCs"><span class="hs-identifier hs-var">classHasSCs</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683045000"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.DynFlags.html#qcsFuel"><span class="hs-identifier hs-var">qcsFuel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683044998"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-385"></span><span>                  </span><span class="hs-comment">-- See invariants (a) and (b) in QCI.qci_pend_sc</span><span>
</span><span id="line-386"></span><span>                  </span><span class="hs-comment">-- qcsFuel dflags: See Note [Expanding Recursive Superclasses and ExpansionFuel]</span><span>
</span><span id="line-387"></span><span>                  </span><span class="hs-comment">-- See Note [Quantified constraints]</span><span>
</span><span id="line-388"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Tc.Types.Constraint.html#doNotExpand"><span class="hs-identifier hs-var">doNotExpand</span></a></span><span>
</span><span id="line-389"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveForAll"><span class="hs-identifier hs-type">solveForAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044985"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044986"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044987"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044988"><span class="hs-identifier hs-type">pred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683044999"><span class="hs-identifier hs-type">fuel</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621683044992"><span class="annot"><span class="annottext">cls_pred_tys_maybe :: Maybe (Class, [Xi])
</span><a href="#local-6989586621683044992"><span class="hs-identifier hs-var hs-var">cls_pred_tys_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Xi -&gt; Maybe (Class, [Xi])
</span><a href="GHC.Core.Predicate.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683044988"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveForAll"><span class="hs-identifier hs-type">solveForAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ExpansionFuel"><span class="hs-identifier hs-type">ExpansionFuel</span></a></span><span>
</span><span id="line-394"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- Precondition: already rewritten by inert set</span><span>
</span><span id="line-396"></span><span id="solveForAll"><span class="annot"><span class="annottext">solveForAll :: CtEvidence
-&gt; [TyVar] -&gt; [Xi] -&gt; Xi -&gt; Int -&gt; TcS (StopOrContinue Void)
</span><a href="GHC.Tc.Solver.Solve.html#solveForAll"><span class="hs-identifier hs-var hs-var">solveForAll</span></a></span></span><span> </span><span id="local-6989586621683045005"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621683045005"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045008"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621683045008"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045010"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045010"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045012"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045012"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>            </span><span id="local-6989586621683045013"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683045013"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621683045014"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683045014"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621683045015"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045015"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621683045016"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683045016"><span class="hs-identifier hs-var">_fuel</span></a></span></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Solving a Wanted forall-constraint]</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><span class="annottext">RealSrcSpan
-&gt; TcS (StopOrContinue Void) -&gt; TcS (StopOrContinue Void)
forall a. RealSrcSpan -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLocEnv -&gt; RealSrcSpan
</span><a href="GHC.Tc.Types.CtLoc.html#getCtLocEnvLoc"><span class="hs-identifier hs-var">getCtLocEnvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(CtLocEnv -&gt; RealSrcSpan) -&gt; CtLocEnv -&gt; RealSrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtLocEnv
</span><a href="GHC.Tc.Types.CtLoc.html#ctLocEnv"><span class="hs-identifier hs-var">ctLocEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045012"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue Void) -&gt; TcS (StopOrContinue Void))
-&gt; TcS (StopOrContinue Void) -&gt; TcS (StopOrContinue Void)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- This setSrcSpan is important: the emitImplicationTcS uses that</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-comment">-- TcLclEnv for the implication, and that in turn sets the location</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-comment">-- for the Givens when solving the constraint (#21006)</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683045019"><span class="annot"><span class="annottext">empty_subst :: Subst
</span><a href="#local-6989586621683045019"><span class="hs-identifier hs-var hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Subst) -&gt; InScopeSet -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-404"></span><span>                           </span><span class="annot"><span class="annottext">[Xi] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045015"><span class="hs-identifier hs-var">pred</span></a></span><span class="annot"><span class="annottext">Xi -&gt; [Xi] -&gt; [Xi]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683045014"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; [TyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#delVarSetList"><span class="hs-operator hs-var">`delVarSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683045013"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-405"></span><span>             </span><span id="local-6989586621683045024"><span class="annot"><span class="annottext">is_qc :: ClsInstOrQC
</span><a href="#local-6989586621683045024"><span class="hs-identifier hs-var hs-var hs-var">is_qc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; ClsInstOrQC
</span><a href="GHC.Tc.Types.Origin.html#IsQC"><span class="hs-identifier hs-var">IsQC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.CtLoc.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045012"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>         </span><span class="hs-comment">-- rec {..}: see Note [Keeping SkolemInfo inside a SkolemTv]</span><span>
</span><span id="line-408"></span><span>         </span><span class="hs-comment">--           in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-409"></span><span>         </span><span class="hs-comment">-- Very like the code in tcSkolDFunType</span><span>
</span><span id="line-410"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">rec</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045026"><span class="annot"><a href="#local-6989586621683045026"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-type">mkSkolemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045028"><span class="hs-identifier hs-type">skol_info_anon</span></a></span><span>
</span><span id="line-411"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045029"><span class="annot"><a href="#local-6989586621683045029"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683045030"><span class="annot"><a href="#local-6989586621683045030"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-type">tcInstSkolTyVarsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045026"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045019"><span class="hs-identifier hs-type">empty_subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045013"><span class="hs-identifier hs-type">tvs</span></a></span><span>
</span><span id="line-412"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683045032"><span class="annot"><a href="#local-6989586621683045032"><span class="hs-identifier hs-var hs-var">inst_pred</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Xi -&gt; Xi
Subst -&gt; Xi -&gt; Xi
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span>    </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683045029"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045015"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-413"></span><span>                   </span><span id="local-6989586621683045034"><span class="annot"><a href="#local-6989586621683045034"><span class="hs-identifier hs-var hs-var">inst_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Xi] -&gt; [Xi]
Subst -&gt; [Xi] -&gt; [Xi]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683045029"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683045014"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-414"></span><span>                   </span><span id="local-6989586621683045028"><span class="annot"><a href="#local-6989586621683045028"><span class="hs-identifier hs-var hs-var">skol_info_anon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC -&gt; PatersonSize -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#InstSkol"><span class="hs-identifier hs-var">InstSkol</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC
</span><a href="#local-6989586621683045024"><span class="hs-identifier hs-var">is_qc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Xi -&gt; PatersonSize
</span><a href="#local-6989586621683045037"><span class="hs-identifier hs-var">get_size</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045032"><span class="hs-identifier hs-var">inst_pred</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683045038"><span class="annot"><a href="#local-6989586621683045038"><span class="hs-identifier hs-var">given_ev_vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-type">newEvVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045034"><span class="hs-identifier hs-type">inst_theta</span></a></span><span>
</span><span id="line-417"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045041"><span class="annot"><a href="#local-6989586621683045041"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045042"><span class="annot"><a href="#local-6989586621683045042"><span class="hs-identifier hs-var">w_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683045043"><span class="annot"><a href="#local-6989586621683045043"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier hs-type">pushLevelNoWorkList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045026"><span class="hs-identifier hs-type">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-419"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683045045"><span class="annot"><a href="#local-6989586621683045045"><span class="hs-identifier hs-var hs-var">loc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin -&gt; CtLoc
</span><a href="GHC.Tc.Types.CtLoc.html#setCtLocOrigin"><span class="hs-identifier hs-var">setCtLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045012"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInstOrQC -&gt; NakedScFlag -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ScOrigin"><span class="hs-identifier hs-var">ScOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC
</span><a href="#local-6989586621683045024"><span class="hs-identifier hs-var">is_qc</span></a></span><span> </span><span class="annot"><span class="annottext">NakedScFlag
</span><a href="GHC.Tc.Types.Origin.html#NakedSc"><span class="hs-identifier hs-var">NakedSc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>                         </span><span class="hs-comment">-- Set the thing to prove to have a ScOrigin, so we are</span><span>
</span><span id="line-421"></span><span>                         </span><span class="hs-comment">-- careful about its termination checks.</span><span>
</span><span id="line-422"></span><span>                         </span><span class="hs-comment">-- See (QC-INV) in Note [Solving a Wanted forall-constraint]</span><span>
</span><span id="line-423"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683045048"><span class="annot"><a href="#local-6989586621683045048"><span class="hs-identifier hs-var">wanted_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-type">newWantedEvVarNC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045045"><span class="hs-identifier hs-type">loc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045010"><span class="hs-identifier hs-type">rewriters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045032"><span class="hs-identifier hs-type">inst_pred</span></a></span><span>
</span><span id="line-424"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvEvId"><span class="hs-identifier hs-type">ctEvEvId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045048"><span class="hs-identifier hs-type">wanted_ev</span></a></span><span>
</span><span id="line-425"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-type">unitBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-type">mkNonCanonical</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045048"><span class="hs-identifier hs-type">wanted_ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683045053"><span class="annot"><a href="#local-6989586621683045053"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier hs-type">emitImplicationTcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045041"><span class="hs-identifier hs-type">lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045028"><span class="hs-identifier hs-type">skol_info_anon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045030"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045038"><span class="hs-identifier hs-type">given_ev_vars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045043"><span class="hs-identifier hs-type">wanteds</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-type">setWantedEvTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045008"><span class="hs-identifier hs-type">dest</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-type">EvCanonical</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-430"></span><span>        </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvFun"><span class="hs-identifier hs-type">EvFun</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#et_tvs"><span class="hs-identifier hs-var">et_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045030"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#et_given"><span class="hs-identifier hs-var">et_given</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045038"><span class="hs-identifier hs-type">given_ev_vars</span></a></span><span>
</span><span id="line-431"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#et_binds"><span class="hs-identifier hs-var">et_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045053"><span class="hs-identifier hs-type">ev_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#et_body"><span class="hs-identifier hs-var">et_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045042"><span class="hs-identifier hs-type">w_id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#stopWith"><span class="hs-identifier hs-type">stopWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045005"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Wanted forall-constraint&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-comment">-- Getting the size of the head is a bit horrible</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-comment">-- because of the special treament for class predicates</span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621683045037"><span class="annot"><span class="annottext">get_size :: Xi -&gt; PatersonSize
</span><a href="#local-6989586621683045037"><span class="hs-identifier hs-var hs-var">get_size</span></a></span></span><span> </span><span id="local-6989586621683045063"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045063"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Xi -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045063"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-438"></span><span>                      </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621683045064"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683045064"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683045065"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683045065"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Xi] -&gt; PatersonSize
</span><a href="GHC.Tc.Utils.TcType.html#pSizeClassPred"><span class="hs-identifier hs-var">pSizeClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683045064"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683045065"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-439"></span><span>                      </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Xi -&gt; PatersonSize
</span><a href="GHC.Tc.Utils.TcType.html#pSizeType"><span class="hs-identifier hs-var">pSizeType</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045063"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span> </span><span class="hs-comment">-- See Note [Solving a Given forall-constraint]</span><span>
</span><span id="line-442"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#solveForAll"><span class="hs-identifier hs-var">solveForAll</span></a></span><span> </span><span id="local-6989586621683045068"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621683045068"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683045070"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683045070"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621683045071"><span class="annot"><span class="annottext">[Xi]
</span><a href="#local-6989586621683045071"><span class="hs-identifier hs-var">_theta</span></a></span></span><span> </span><span id="local-6989586621683045072"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045072"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621683045073"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683045073"><span class="hs-identifier hs-var">fuel</span></a></span></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier hs-var">addInertForAll</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683045075"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-444"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Void)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045068"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given forall-constraint&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621683045075"><span class="annot"><span class="annottext">qci :: QCInst
</span><a href="#local-6989586621683045075"><span class="hs-identifier hs-var hs-var">qci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045068"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_tvs :: [TyVar]
</span><a href="GHC.Tc.Types.Constraint.html#qci_tvs"><span class="hs-identifier hs-var">qci_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683045070"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-447"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pred :: Xi
</span><a href="GHC.Tc.Types.Constraint.html#qci_pred"><span class="hs-identifier hs-var">qci_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045072"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pend_sc :: Int
</span><a href="GHC.Tc.Types.Constraint.html#qci_pend_sc"><span class="hs-identifier hs-var">qci_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683045073"><span class="hs-identifier hs-var">fuel</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="hs-comment">{- Note [Solving a Wanted forall-constraint]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Solving a wanted forall (quantified) constraint
  [W] df :: forall ab. (Eq a, Ord b) =&gt; C x a b
is delightfully easy.   Just build an implication constraint
    forall ab. (g1::Eq a, g2::Ord b) =&gt; [W] d :: C x a
and discharge df thus:
    df = /\ab. \g1 g2. let &lt;binds&gt; in d
where &lt;binds&gt; is filled in by solving the implication constraint.
All the machinery is to hand; there is little to do.

The tricky point is about termination: see #19690.  We want to maintain
the invariant (QC-INV):

  (QC-INV) Every quantified constraint returns a non-bottom dictionary

just as every top-level instance declaration guarantees to return a non-bottom
dictionary.  But as #19690 shows, it is possible to get a bottom dicionary
by superclass selection if we aren't careful.  The situation is very similar
to that described in Note [Recursive superclasses] in GHC.Tc.TyCl.Instance;
and we use the same solution:

* Give the Givens a CtOrigin of (GivenOrigin (InstSkol IsQC head_size))
* Give the Wanted a CtOrigin of (ScOrigin IsQC NakedSc)

Both of these things are done in solveForAll.  Now the mechanism described
in Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance takes over.

Note [Solving a Given forall-constraint]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For a Given constraint
  [G] df :: forall ab. (Eq a, Ord b) =&gt; C x a b
we just add it to TcS's local InstEnv of known instances,
via addInertForall.  Then, if we look up (C x Int Bool), say,
we'll find a match in the InstEnv.


************************************************************************
*                                                                      *
                  Evidence transformation
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#rewriteEvidence"><span class="hs-identifier hs-type">rewriteEvidence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-494"></span><span class="hs-comment">-- (rewriteEvidence old_ev new_pred co do_next)</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- Main purpose: create new evidence for new_pred;</span><span>
</span><span id="line-496"></span><span class="hs-comment">--                 unless new_pred is cached already</span><span>
</span><span id="line-497"></span><span class="annot"><span class="hs-comment">-- * Calls do_next with (new_ev :: new_pred), with same wanted/given flag as old_ev</span></span><span>
</span><span id="line-498"></span><span class="annot"><span class="hs-comment">-- * If old_ev was wanted, create a binding for old_ev, in terms of new_ev</span></span><span>
</span><span id="line-499"></span><span class="annot"><span class="hs-comment">-- * If old_ev was given, AND not cached, create a binding for new_ev, in terms of old_ev</span></span><span>
</span><span id="line-500"></span><span class="annot"><span class="hs-comment">-- * Stops if new_ev is already cached</span></span><span>
</span><span id="line-501"></span><span class="hs-comment">--</span><span>
</span><span id="line-502"></span><span class="hs-comment">--        Old evidence    New predicate is               Return new evidence</span><span>
</span><span id="line-503"></span><span class="hs-comment">--        flavour                                        of same flavor</span><span>
</span><span id="line-504"></span><span class="hs-comment">--        -------------------------------------------------------------------</span><span>
</span><span id="line-505"></span><span class="hs-comment">--        Wanted          Already solved or in inert     Stop</span><span>
</span><span id="line-506"></span><span class="hs-comment">--                        Not                            do_next new_evidence</span><span>
</span><span id="line-507"></span><span class="hs-comment">--</span><span>
</span><span id="line-508"></span><span class="hs-comment">--        Given           Already in inert               Stop</span><span>
</span><span id="line-509"></span><span class="hs-comment">--                        Not                            do_next new_evidence</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">{- Note [Rewriting with Refl]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If the coercion is just reflexivity then you may re-use the same
evidence variable.  But be careful!  Although the coercion is Refl, new_pred
may reflect the result of unification alpha := ty, so new_pred might
not _look_ the same as old_pred, and it's vital to proceed from now on
using new_pred.

The rewriter preserves type synonyms, so they should appear in new_pred
as well as in old_pred; that is important for good error messages.

If we are rewriting with Refl, then there are no new rewriters to add to
the rewriter set. We check this with an assertion.
 -}</span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span id="rewriteEvidence"><span class="annot"><span class="annottext">rewriteEvidence :: CtEvidence -&gt; SolverStage CtEvidence
</span><a href="GHC.Tc.Solver.Solve.html#rewriteEvidence"><span class="hs-identifier hs-var hs-var">rewriteEvidence</span></a></span></span><span> </span><span id="local-6989586621683045078"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045078"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue CtEvidence) -&gt; SolverStage CtEvidence
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue CtEvidence) -&gt; SolverStage CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence) -&gt; SolverStage CtEvidence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rewriteEvidence&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045078"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045079"><span class="annot"><a href="#local-6989586621683045079"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683045080"><span class="annot"><a href="#local-6989586621683045080"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Xi -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045078"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Xi
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045078"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#finish_rewrite"><span class="hs-identifier hs-type">finish_rewrite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045078"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045079"><span class="hs-identifier hs-type">redn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045080"><span class="hs-identifier hs-type">rewriters</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#finish_rewrite"><span class="hs-identifier hs-type">finish_rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ old evidence</span></span><span>
</span><span id="line-533"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ new predicate + coercion, of type &lt;type of old evidence&gt; ~ new predicate</span></span><span>
</span><span id="line-534"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span>  </span><span class="hs-comment">-- ^ See Note [Wanteds rewrite Wanteds]</span><span>
</span><span id="line-535"></span><span>                               </span><span class="hs-comment">-- in GHC.Tc.Types.Constraint</span><span>
</span><span id="line-536"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span id="finish_rewrite"><span class="annot"><span class="annottext">finish_rewrite :: CtEvidence
-&gt; Reduction -&gt; RewriterSet -&gt; TcS (StopOrContinue CtEvidence)
</span><a href="GHC.Tc.Solver.Solve.html#finish_rewrite"><span class="hs-identifier hs-var hs-var">finish_rewrite</span></a></span></span><span> </span><span id="local-6989586621683045082"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045082"><span class="hs-identifier hs-var">old_ev</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621683045084"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683045084"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621683045085"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045085"><span class="hs-identifier hs-var">new_pred</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683045086"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045086"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683045084"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-comment">-- See Note [Rewriting with Refl]</span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyRewriterSet"><span class="hs-identifier hs-var">isEmptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045086"><span class="hs-identifier hs-var">rewriters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue CtEvidence)
 -&gt; TcS (StopOrContinue CtEvidence))
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue CtEvidence)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; Xi -&gt; CtEvidence
CtEvidence -&gt; Xi -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#setCtEvPredType"><span class="hs-identifier hs-var">setCtEvPredType</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045082"><span class="hs-identifier hs-var">old_ev</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045085"><span class="hs-identifier hs-var">new_pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#finish_rewrite"><span class="hs-identifier hs-var">finish_rewrite</span></a></span><span> </span><span id="local-6989586621683045092"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621683045092"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045094"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683045094"><span class="hs-identifier hs-var">old_evar</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045095"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045095"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621683045096"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683045096"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621683045097"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045097"><span class="hs-identifier hs-var">new_pred</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683045098"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045098"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyRewriterSet"><span class="hs-identifier hs-var">isEmptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045098"><span class="hs-identifier hs-var">rewriters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue CtEvidence)
 -&gt; TcS (StopOrContinue CtEvidence))
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- this is a Given, not a wanted</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045099"><span class="annot"><a href="#local-6989586621683045099"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Xi, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045095"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045097"><span class="hs-identifier hs-var">new_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683045101"><span class="hs-identifier hs-var">new_tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier hs-type">continueWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045099"><span class="hs-identifier hs-type">new_ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-comment">-- mkEvCast optimises ReflCo</span><span>
</span><span id="line-549"></span><span>    </span><span id="local-6989586621683045102"><span class="annot"><span class="annottext">ev_rw_role :: Role
</span><a href="#local-6989586621683045102"><span class="hs-identifier hs-var hs-var">ev_rw_role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; Role
CtEvidence -&gt; Role
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRewriteRole"><span class="hs-identifier hs-var">ctEvRewriteRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045092"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621683045101"><span class="annot"><span class="annottext">new_tm :: EvTerm
</span><a href="#local-6989586621683045101"><span class="hs-identifier hs-var hs-var">new_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (EvExpr -&gt; Coercion -&gt; EvTerm) -&gt; EvExpr -&gt; Coercion -&gt; EvTerm
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683045096"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683045102"><span class="hs-identifier hs-var">ev_rw_role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>             </span><span class="annot"><span class="annottext">EvExpr -&gt; Coercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#mkEvCast"><span class="hs-identifier hs-var">mkEvCast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; EvExpr
</span><a href="GHC.Tc.Types.Evidence.html#evId"><span class="hs-identifier hs-var">evId</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683045094"><span class="hs-identifier hs-var">old_evar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683045102"><span class="hs-identifier hs-var">ev_rw_role</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683045096"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#finish_rewrite"><span class="hs-identifier hs-var">finish_rewrite</span></a></span><span> </span><span id="local-6989586621683045109"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621683045109"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045110"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621683045110"><span class="hs-identifier hs-var">dest</span></a></span></span><span>
</span><span id="line-555"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045111"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045111"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-556"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045112"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045112"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621683045113"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683045113"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621683045114"><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045114"><span class="hs-identifier hs-var">new_pred</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683045115"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045115"><span class="hs-identifier hs-var">new_rewriters</span></a></span></span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045116"><span class="annot"><a href="#local-6989586621683045116"><span class="hs-identifier hs-var">mb_new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Xi -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683045111"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045118"><span class="hs-identifier hs-var">rewriters'</span></a></span><span> </span><span class="annot"><span class="annottext">Xi
</span><a href="#local-6989586621683045114"><span class="hs-identifier hs-var">new_pred</span></a></span><span>
</span><span id="line-559"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683045119"><span class="annot"><a href="#local-6989586621683045119"><span class="hs-identifier hs-var hs-var">ev_rw_role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; Role
CtEvidence -&gt; Role
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRewriteRole"><span class="hs-identifier hs-var">ctEvRewriteRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045109"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-560"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-type">coercionRole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045113"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621683045119"><span class="hs-identifier hs-type">ev_rw_role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-type">setWantedEvTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045110"><span class="hs-identifier hs-type">dest</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-type">EvCanonical</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-562"></span><span>            </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkEvCast"><span class="hs-identifier hs-type">mkEvCast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-type">getEvExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045116"><span class="hs-identifier hs-type">mb_new_ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-type">downgradeRole</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-type">Representational</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045119"><span class="hs-identifier hs-type">ev_rw_role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-type">mkSymCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045113"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683045116"><span class="hs-identifier hs-type">mb_new_ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-565"></span><span>            </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span>  </span><span id="local-6989586621683045124"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045124"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue CtEvidence)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045124"><span class="hs-identifier hs-var">new_ev</span></a></span><span>
</span><span id="line-566"></span><span>            </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue CtEvidence)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683045109"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cached wanted&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-568"></span><span>    </span><span id="local-6989586621683045118"><span class="annot"><span class="annottext">rewriters' :: RewriterSet
</span><a href="#local-6989586621683045118"><span class="hs-identifier hs-var hs-var">rewriters'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045112"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; RewriterSet -&gt; RewriterSet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">S.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683045115"><span class="hs-identifier hs-var">new_rewriters</span></a></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="annot"><span class="hs-comment">{- *******************************************************************
*                                                                    *
*                      Typechecker plugins
*                                                                    *
******************************************************************* -}</span></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">-- | Extract the (inert) givens and invoke the plugins on them.</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- Remove solved givens from the inert set and emit insolubles, but</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- return new work produced so that 'solveSimpleGivens' can feed it back</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- into the main solver.</span><span>
</span><span id="line-580"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#runTcPluginsGiven"><span class="hs-identifier hs-type">runTcPluginsGiven</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-581"></span><span id="runTcPluginsGiven"><span class="annot"><span class="annottext">runTcPluginsGiven :: TcS [Ct]
</span><a href="GHC.Tc.Solver.Solve.html#runTcPluginsGiven"><span class="hs-identifier hs-var hs-var">runTcPluginsGiven</span></a></span></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045126"><span class="annot"><a href="#local-6989586621683045126"><span class="hs-identifier hs-var">solvers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS [TcPluginSolver]
</span><a href="GHC.Tc.Solver.Solve.html#getTcPluginSolvers"><span class="hs-identifier hs-var">getTcPluginSolvers</span></a></span><span>
</span><span id="line-583"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683045126"><span class="hs-identifier hs-type">solvers</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-584"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045128"><span class="annot"><a href="#local-6989586621683045128"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier hs-type">getInertGivens</span></a></span><span>
</span><span id="line-585"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683045128"><span class="hs-identifier hs-type">givens</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;runTcPluginsGiven {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045128"><span class="hs-identifier hs-type">givens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683045130"><span class="annot"><a href="#local-6989586621683045130"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#runTcPluginSolvers"><span class="hs-identifier hs-type">runTcPluginSolvers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045126"><span class="hs-identifier hs-type">solvers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683045128"><span class="hs-identifier hs-type">givens</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045132"><span class="annot"><a href="#local-6989586621683045132"><span class="hs-identifier hs-var">solved_givens</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginSolvedCts"><span class="hs-identifier hs-var">pluginSolvedCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045130"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-589"></span><span>             </span><span id="local-6989586621683045134"><span class="annot"><a href="#local-6989586621683045134"><span class="hs-identifier hs-var hs-var">insols</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; IrredCt) -&gt; [Ct] -&gt; [IrredCt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; Ct -&gt; IrredCt
</span><a href="GHC.Tc.Types.Constraint.html#ctIrredCt"><span class="hs-identifier hs-var">ctIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#PluginReason"><span class="hs-identifier hs-var">PluginReason</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPluginProgress -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Solve.html#pluginBadCts"><span class="hs-identifier hs-var">pluginBadCts</span></a></span><span> </span><span class="annot"><span class="annottext">TcPluginProgress
</span><a href="#local-6989586621683045130"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-type">updInertCans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#removeInertCts"><span class="hs-identifier hs-type">removeInertCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045132"><span class="hs-identifier hs-type">solved_givens</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span>
</span><span id="line-591"></span><span>                       </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#updIrreds"><span class="hs-identifier hs-type">updIrreds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addIrreds"><span class="hs-identifier hs-type">addIrreds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045134"><span class="hs-identifier hs-type">insols</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;runTcPluginsGiven }&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-593"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;solved_givens:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045132"><span class="hs-identifier hs-type">solved_givens</span></a></span><span>
</span><span id="line-594"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;insols:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045134"><span class="hs-identifier hs-type">insols</span></a></span><span>
</span><span id="line-595"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;new:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginNewCts"><span class="hs-identifier hs-var">pluginNewCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045130"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-596"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginNewCts"><span class="hs-identifier hs-var">pluginNewCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045130"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="hs-comment">-- | Given a bag of (rewritten, zonked) wanteds, invoke the plugins on</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- them and produce an updated bag of wanteds (possibly with some new</span><span>
</span><span id="line-600"></span><span class="hs-comment">-- work) and a bag of insolubles.  The boolean indicates whether</span><span>
</span><span id="line-601"></span><span class="hs-comment">-- 'solveSimpleWanteds' should feed the updated wanteds back into the</span><span>
</span><span id="line-602"></span><span class="hs-comment">-- main solver.</span><span>
</span><span id="line-603"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#runTcPluginsWanted"><span class="hs-identifier hs-type">runTcPluginsWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span id="runTcPluginsWanted"><span class="annot"><span class="annottext">runTcPluginsWanted :: WantedConstraints -&gt; TcS (Bool, WantedConstraints)
</span><a href="GHC.Tc.Solver.Solve.html#runTcPluginsWanted"><span class="hs-identifier hs-var hs-var">runTcPluginsWanted</span></a></span></span><span> </span><span id="local-6989586621683045144"><span class="annot"><span class="annottext">wc :: WantedConstraints
</span><a href="#local-6989586621683045144"><span class="hs-identifier hs-var">wc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WC"><span class="hs-identifier hs-type">WC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wc_simple :: WantedConstraints -&gt; Cts
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045145"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683045145"><span class="hs-identifier hs-var">simples1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683045145"><span class="hs-identifier hs-var">simples1</span></a></span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool, WantedConstraints) -&gt; TcS (Bool, WantedConstraints)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683045144"><span class="hs-identifier hs-var">wc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045146"><span class="annot"><a href="#local-6989586621683045146"><span class="hs-identifier hs-var">solvers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS [TcPluginSolver]
</span><a href="GHC.Tc.Solver.Solve.html#getTcPluginSolvers"><span class="hs-identifier hs-var">getTcPluginSolvers</span></a></span><span>
</span><span id="line-609"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683045146"><span class="hs-identifier hs-type">solvers</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683045144"><span class="hs-identifier hs-type">wc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045147"><span class="annot"><a href="#local-6989586621683045147"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier hs-type">getInertGivens</span></a></span><span>
</span><span id="line-612"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683045148"><span class="annot"><a href="#local-6989586621683045148"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkSimples"><span class="hs-identifier hs-type">zonkSimples</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045145"><span class="hs-identifier hs-type">simples1</span></a></span><span>    </span><span class="hs-comment">-- Plugin requires zonked inputs</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Running plugins (&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Given:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045147"><span class="hs-identifier hs-type">given</span></a></span><span>
</span><span id="line-615"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Watned:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045148"><span class="hs-identifier hs-type">wanted</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683045150"><span class="annot"><a href="#local-6989586621683045150"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#runTcPluginSolvers"><span class="hs-identifier hs-type">runTcPluginSolvers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045146"><span class="hs-identifier hs-type">solvers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683045147"><span class="hs-identifier hs-type">given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-type">bagToList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045148"><span class="hs-identifier hs-type">wanted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683045152"><span class="annot"><a href="#local-6989586621683045152"><span class="hs-identifier hs-var">solved_wanted</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginSolvedCts"><span class="hs-identifier hs-var">pluginSolvedCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045150"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-618"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683045153"><span class="annot"><a href="#local-6989586621683045153"><span class="hs-identifier hs-var">unsolved_wanted</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginInputCts"><span class="hs-identifier hs-var">pluginInputCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045150"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-619"></span><span>             </span><span id="local-6989586621683045155"><span class="annot"><a href="#local-6989586621683045155"><span class="hs-identifier hs-var hs-var">new_wanted</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPluginProgress -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Solve.html#pluginNewCts"><span class="hs-identifier hs-var">pluginNewCts</span></a></span><span> </span><span class="annot"><span class="annottext">TcPluginProgress
</span><a href="#local-6989586621683045150"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-620"></span><span>             </span><span id="local-6989586621683045156"><span class="annot"><a href="#local-6989586621683045156"><span class="hs-identifier hs-var hs-var">insols</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPluginProgress -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Solve.html#pluginBadCts"><span class="hs-identifier hs-var">pluginBadCts</span></a></span><span> </span><span class="annot"><span class="annottext">TcPluginProgress
</span><a href="#local-6989586621683045150"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-621"></span><span>             </span><span id="local-6989586621683045157"><span class="annot"><a href="#local-6989586621683045157"><span class="hs-identifier hs-var hs-var">all_new_wanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; Cts
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045155"><span class="hs-identifier hs-var">new_wanted</span></a></span><span>       </span><span class="annot"><span class="annottext">Cts -&gt; Cts -&gt; Cts
</span><a href="GHC.Tc.Types.Constraint.html#andCts"><span class="hs-operator hs-var">`andCts`</span></a></span><span>
</span><span id="line-622"></span><span>                              </span><span class="annot"><span class="annottext">[Ct] -&gt; Cts
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045153"><span class="hs-identifier hs-var">unsolved_wanted</span></a></span><span>  </span><span class="annot"><span class="annottext">Cts -&gt; Cts -&gt; Cts
</span><a href="GHC.Tc.Types.Constraint.html#andCts"><span class="hs-operator hs-var">`andCts`</span></a></span><span>
</span><span id="line-623"></span><span>                              </span><span class="annot"><span class="annottext">[Ct] -&gt; Cts
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045156"><span class="hs-identifier hs-var">insols</span></a></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="hs-comment">-- SLPJ: I'm deeply suspicious of this</span><span>
</span><span id="line-626"></span><span class="hs-comment">--       ; updInertCans (removeInertCts $ solved_givens)</span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="#local-6989586621683045160"><span class="hs-identifier hs-type">setEv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045152"><span class="hs-identifier hs-type">solved_wanted</span></a></span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Finished plugins }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045155"><span class="hs-identifier hs-type">new_wanted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-type">notNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginNewCts"><span class="hs-identifier hs-var">pluginNewCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045150"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683045144"><span class="hs-identifier hs-type">wc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045157"><span class="hs-identifier hs-type">all_new_wanted</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><a href="#local-6989586621683045160"><span class="hs-identifier hs-type">setEv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621683045160"><span class="annot"><span class="annottext">setEv :: (EvTerm, Ct) -&gt; TcS ()
</span><a href="#local-6989586621683045160"><span class="hs-identifier hs-var hs-var">setEv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045161"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683045161"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683045162"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045162"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045162"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-636"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045164"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621683045164"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcEvDest -&gt; CanonicalEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621683045164"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683045161"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-637"></span><span>           </span><span class="hs-comment">-- TODO: plugins should be able to signal non-canonicity</span><span>
</span><span id="line-638"></span><span>      </span><span class="annot"><span class="annottext">CtEvidence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcS ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runTcPluginsWanted.setEv: attempt to solve non-wanted!&quot;</span></span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span class="annot"><span class="hs-comment">-- | A pair of (given, wanted) constraints to pass to plugins</span></span><span>
</span><span id="line-641"></span><span class="hs-keyword">type</span><span> </span><span id="SplitCts"><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SplitCts"><span class="hs-identifier hs-var">SplitCts</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span class="annot"><span class="hs-comment">-- | A solved pair of constraints, with evidence for wanteds</span></span><span>
</span><span id="line-644"></span><span class="hs-keyword">type</span><span> </span><span id="SolvedCts"><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SolvedCts"><span class="hs-identifier hs-var">SolvedCts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span class="hs-comment">-- | Represents collections of constraints generated by typechecker</span><span>
</span><span id="line-647"></span><span class="hs-comment">-- plugins</span><span>
</span><span id="line-648"></span><span class="hs-keyword">data</span><span> </span><span id="TcPluginProgress"><span class="annot"><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-var">TcPluginProgress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TcPluginProgress"><span class="annot"><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-var">TcPluginProgress</span></a></span></span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="pluginInputCts"><span class="annot"><span class="annottext">TcPluginProgress -&gt; SplitCts
</span><a href="GHC.Tc.Solver.Solve.html#pluginInputCts"><span class="hs-identifier hs-var hs-var">pluginInputCts</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SplitCts"><span class="hs-identifier hs-type">SplitCts</span></a></span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-comment">-- ^ Original inputs to the plugins with solved/bad constraints</span><span>
</span><span id="line-651"></span><span>      </span><span class="hs-comment">-- removed, but otherwise unmodified</span><span>
</span><span id="line-652"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pluginSolvedCts"><span class="annot"><span class="annottext">TcPluginProgress -&gt; ([Ct], [(EvTerm, Ct)])
</span><a href="GHC.Tc.Solver.Solve.html#pluginSolvedCts"><span class="hs-identifier hs-var hs-var">pluginSolvedCts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SolvedCts"><span class="hs-identifier hs-type">SolvedCts</span></a></span><span>
</span><span id="line-653"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Constraints solved by plugins</span></span><span>
</span><span id="line-654"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pluginBadCts"><span class="annot"><span class="annottext">TcPluginProgress -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Solve.html#pluginBadCts"><span class="hs-identifier hs-var hs-var">pluginBadCts</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-655"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Constraints reported as insoluble by plugins</span></span><span>
</span><span id="line-656"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pluginNewCts"><span class="annot"><span class="annottext">TcPluginProgress -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Solve.html#pluginNewCts"><span class="hs-identifier hs-var hs-var">pluginNewCts</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-657"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ New constraints emitted by plugins</span></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#getTcPluginSolvers"><span class="hs-identifier hs-type">getTcPluginSolvers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginSolver"><span class="hs-identifier hs-type">TcPluginSolver</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-661"></span><span id="getTcPluginSolvers"><span class="annot"><span class="annottext">getTcPluginSolvers :: TcS [TcPluginSolver]
</span><a href="GHC.Tc.Solver.Solve.html#getTcPluginSolvers"><span class="hs-identifier hs-var hs-var">getTcPluginSolvers</span></a></span></span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045168"><span class="annot"><a href="#local-6989586621683045168"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcGblEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_tc_plugin_solvers"><span class="hs-identifier hs-var">tcg_tc_plugin_solvers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045168"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span class="hs-comment">-- | Starting from a pair of (given, wanted) constraints,</span><span>
</span><span id="line-665"></span><span class="hs-comment">-- invoke each of the typechecker constraint-solving plugins in turn and return</span><span>
</span><span id="line-666"></span><span class="hs-comment">--</span><span>
</span><span id="line-667"></span><span class="hs-comment">--  * the remaining unmodified constraints,</span><span>
</span><span id="line-668"></span><span class="hs-comment">--  * constraints that have been solved,</span><span>
</span><span id="line-669"></span><span class="hs-comment">--  * constraints that are insoluble, and</span><span>
</span><span id="line-670"></span><span class="hs-comment">--  * new work.</span><span>
</span><span id="line-671"></span><span class="hs-comment">--</span><span>
</span><span id="line-672"></span><span class="hs-comment">-- Note that new work generated by one plugin will not be seen by</span><span>
</span><span id="line-673"></span><span class="hs-comment">-- other plugins on this pass (but the main constraint solver will be</span><span>
</span><span id="line-674"></span><span class="hs-comment">-- re-invoked and they will see it later).  There is no check that new</span><span>
</span><span id="line-675"></span><span class="hs-comment">-- work differs from the original constraints supplied to the plugin:</span><span>
</span><span id="line-676"></span><span class="hs-comment">-- the plugin itself should perform this check if necessary.</span><span>
</span><span id="line-677"></span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#runTcPluginSolvers"><span class="hs-identifier hs-type">runTcPluginSolvers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginSolver"><span class="hs-identifier hs-type">TcPluginSolver</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SplitCts"><span class="hs-identifier hs-type">SplitCts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-type">TcPluginProgress</span></a></span><span>
</span><span id="line-678"></span><span id="runTcPluginSolvers"><span class="annot"><span class="annottext">runTcPluginSolvers :: [TcPluginSolver] -&gt; SplitCts -&gt; TcS TcPluginProgress
</span><a href="GHC.Tc.Solver.Solve.html#runTcPluginSolvers"><span class="hs-identifier hs-var hs-var">runTcPluginSolvers</span></a></span></span><span> </span><span id="local-6989586621683045171"><span class="annot"><span class="annottext">[TcPluginSolver]
</span><a href="#local-6989586621683045171"><span class="hs-identifier hs-var">solvers</span></a></span></span><span> </span><span id="local-6989586621683045172"><span class="annot"><span class="annottext">SplitCts
</span><a href="#local-6989586621683045172"><span class="hs-identifier hs-var">all_cts</span></a></span></span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683045173"><span class="annot"><a href="#local-6989586621683045173"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var">getTcEvBindsVar</span></a></span><span>
</span><span id="line-680"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683045176"><span class="hs-identifier hs-type">do_plugin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045173"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683045177"><span class="hs-identifier hs-type">initialProgress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045171"><span class="hs-identifier hs-type">solvers</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-682"></span><span>    </span><span class="annot"><a href="#local-6989586621683045176"><span class="hs-identifier hs-type">do_plugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-type">TcPluginProgress</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginSolver"><span class="hs-identifier hs-type">TcPluginSolver</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-type">TcPluginProgress</span></a></span><span>
</span><span id="line-683"></span><span>    </span><span id="local-6989586621683045176"><span class="annot"><span class="annottext">do_plugin :: EvBindsVar
-&gt; TcPluginProgress -&gt; TcPluginSolver -&gt; TcS TcPluginProgress
</span><a href="#local-6989586621683045176"><span class="hs-identifier hs-var hs-var">do_plugin</span></a></span></span><span> </span><span id="local-6989586621683045178"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683045178"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span id="local-6989586621683045179"><span class="annot"><span class="annottext">TcPluginProgress
</span><a href="#local-6989586621683045179"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683045180"><span class="annot"><span class="annottext">TcPluginSolver
</span><a href="#local-6989586621683045180"><span class="hs-identifier hs-var">solver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-684"></span><span>        </span><span id="local-6989586621683045181"><span class="annot"><a href="#local-6989586621683045181"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcPluginM TcPluginSolveResult -&gt; TcS TcPluginSolveResult
forall a. TcPluginM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#runTcPluginTcS"><span class="hs-identifier hs-var">runTcPluginTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ct] -&gt; [Ct] -&gt; TcPluginM TcPluginSolveResult)
-&gt; SplitCts -&gt; TcPluginM TcPluginSolveResult
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPluginSolver
</span><a href="#local-6989586621683045180"><span class="hs-identifier hs-var">solver</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683045178"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPluginProgress -&gt; SplitCts
</span><a href="GHC.Tc.Solver.Solve.html#pluginInputCts"><span class="hs-identifier hs-var">pluginInputCts</span></a></span><span> </span><span class="annot"><span class="annottext">TcPluginProgress
</span><a href="#local-6989586621683045179"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683045184"><span class="hs-identifier hs-type">progress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045179"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045181"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>    </span><span class="annot"><a href="#local-6989586621683045184"><span class="hs-identifier hs-type">progress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-type">TcPluginProgress</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginSolveResult"><span class="hs-identifier hs-type">TcPluginSolveResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-type">TcPluginProgress</span></a></span><span>
</span><span id="line-688"></span><span>    </span><span id="local-6989586621683045184"><span class="annot"><span class="annottext">progress :: TcPluginProgress -&gt; TcPluginSolveResult -&gt; TcPluginProgress
</span><a href="#local-6989586621683045184"><span class="hs-identifier hs-var hs-var">progress</span></a></span></span><span> </span><span id="local-6989586621683045185"><span class="annot"><span class="annottext">TcPluginProgress
</span><a href="#local-6989586621683045185"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-689"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginSolveResult"><span class="hs-identifier hs-type">TcPluginSolveResult</span></a></span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcPluginInsolubleCts :: TcPluginSolveResult -&gt; [Ct]
</span><a href="GHC.Tc.Types.html#tcPluginInsolubleCts"><span class="hs-identifier hs-var">tcPluginInsolubleCts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045188"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045188"><span class="hs-identifier hs-var">bad_cts</span></a></span></span><span>
</span><span id="line-691"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginSolvedCts :: TcPluginSolveResult -&gt; [(EvTerm, Ct)]
</span><a href="GHC.Tc.Types.html#tcPluginSolvedCts"><span class="hs-identifier hs-var">tcPluginSolvedCts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045190"><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621683045190"><span class="hs-identifier hs-var">solved_cts</span></a></span></span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginNewCts :: TcPluginSolveResult -&gt; [Ct]
</span><a href="GHC.Tc.Types.html#tcPluginNewCts"><span class="hs-identifier hs-var">tcPluginNewCts</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683045192"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045192"><span class="hs-identifier hs-var">new_cts</span></a></span></span><span>
</span><span id="line-693"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-694"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-695"></span><span>        </span><span class="annot"><span class="annottext">TcPluginProgress
</span><a href="#local-6989586621683045185"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginInputCts"><span class="hs-identifier hs-var">pluginInputCts</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045193"><span class="hs-identifier hs-type">discard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683045188"><span class="hs-identifier hs-type">bad_cts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><a href="#local-6989586621683045190"><span class="hs-identifier hs-type">solved_cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginInputCts"><span class="hs-identifier hs-var">pluginInputCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045185"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginSolvedCts"><span class="hs-identifier hs-var">pluginSolvedCts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045195"><span class="hs-identifier hs-type">add</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045190"><span class="hs-identifier hs-type">solved_cts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginSolvedCts"><span class="hs-identifier hs-var">pluginSolvedCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045185"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginNewCts"><span class="hs-identifier hs-var">pluginNewCts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045192"><span class="hs-identifier hs-type">new_cts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginNewCts"><span class="hs-identifier hs-var">pluginNewCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045185"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-698"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginBadCts"><span class="hs-identifier hs-var">pluginBadCts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683045188"><span class="hs-identifier hs-type">bad_cts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#pluginBadCts"><span class="hs-identifier hs-var">pluginBadCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683045185"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-699"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>    </span><span id="local-6989586621683045177"><span class="annot"><span class="annottext">initialProgress :: TcPluginProgress
</span><a href="#local-6989586621683045177"><span class="hs-identifier hs-var hs-var">initialProgress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitCts
-&gt; ([Ct], [(EvTerm, Ct)]) -&gt; [Ct] -&gt; [Ct] -&gt; TcPluginProgress
</span><a href="GHC.Tc.Solver.Solve.html#TcPluginProgress"><span class="hs-identifier hs-var">TcPluginProgress</span></a></span><span> </span><span class="annot"><span class="annottext">SplitCts
</span><a href="#local-6989586621683045172"><span class="hs-identifier hs-var">all_cts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>    </span><span class="annot"><a href="#local-6989586621683045193"><span class="hs-identifier hs-type">discard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SplitCts"><span class="hs-identifier hs-type">SplitCts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SplitCts"><span class="hs-identifier hs-type">SplitCts</span></a></span><span>
</span><span id="line-704"></span><span>    </span><span id="local-6989586621683045193"><span class="annot"><span class="annottext">discard :: [Ct] -&gt; SplitCts -&gt; SplitCts
</span><a href="#local-6989586621683045193"><span class="hs-identifier hs-var hs-var">discard</span></a></span></span><span> </span><span id="local-6989586621683045196"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045196"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045197"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045197"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683045198"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045198"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-705"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045197"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
</span><a href="#local-6989586621683045199"><span class="hs-operator hs-var">`without`</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045196"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045198"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
</span><a href="#local-6989586621683045199"><span class="hs-operator hs-var">`without`</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045196"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>    </span><span class="annot"><a href="#local-6989586621683045199"><span class="hs-identifier hs-type">without</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-708"></span><span>    </span><span id="local-6989586621683045199"><span class="annot"><span class="annottext">without :: [Ct] -&gt; [Ct] -&gt; [Ct]
</span><a href="#local-6989586621683045199"><span class="hs-identifier hs-var hs-var">without</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Ct -&gt; Bool) -&gt; [Ct] -&gt; [Ct] -&gt; [Ct]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">deleteFirstsBy</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Ct -&gt; Bool
</span><a href="#local-6989586621683045200"><span class="hs-identifier hs-var">eq_ct</span></a></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="#local-6989586621683045200"><span class="hs-identifier hs-type">eq_ct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-711"></span><span>    </span><span id="local-6989586621683045200"><span class="annot"><span class="annottext">eq_ct :: Ct -&gt; Ct -&gt; Bool
</span><a href="#local-6989586621683045200"><span class="hs-identifier hs-var hs-var">eq_ct</span></a></span></span><span> </span><span id="local-6989586621683045201"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045201"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621683045202"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045202"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctFlavour"><span class="hs-identifier hs-var">ctFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045201"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavour -&gt; CtFlavour -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctFlavour"><span class="hs-identifier hs-var">ctFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045202"><span class="hs-identifier hs-var">c'</span></a></span><span>
</span><span id="line-712"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Xi
</span><a href="GHC.Tc.Types.Constraint.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045201"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Xi -&gt; Xi -&gt; Bool
Xi -&gt; Xi -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Xi
</span><a href="GHC.Tc.Types.Constraint.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045202"><span class="hs-identifier hs-var">c'</span></a></span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="#local-6989586621683045195"><span class="hs-identifier hs-type">add</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SolvedCts"><span class="hs-identifier hs-type">SolvedCts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SolvedCts"><span class="hs-identifier hs-type">SolvedCts</span></a></span><span>
</span><span id="line-715"></span><span>    </span><span id="local-6989586621683045195"><span class="annot"><span class="annottext">add :: [(EvTerm, Ct)] -&gt; ([Ct], [(EvTerm, Ct)]) -&gt; ([Ct], [(EvTerm, Ct)])
</span><a href="#local-6989586621683045195"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621683045207"><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621683045207"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621683045208"><span class="annot"><span class="annottext">([Ct], [(EvTerm, Ct)])
</span><a href="#local-6989586621683045208"><span class="hs-identifier hs-var">scs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Ct], [(EvTerm, Ct)]) -&gt; (EvTerm, Ct) -&gt; ([Ct], [(EvTerm, Ct)]))
-&gt; ([Ct], [(EvTerm, Ct)])
-&gt; [(EvTerm, Ct)]
-&gt; ([Ct], [(EvTerm, Ct)])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">([Ct], [(EvTerm, Ct)]) -&gt; (EvTerm, Ct) -&gt; ([Ct], [(EvTerm, Ct)])
</span><a href="#local-6989586621683045210"><span class="hs-identifier hs-var">addOne</span></a></span><span> </span><span class="annot"><span class="annottext">([Ct], [(EvTerm, Ct)])
</span><a href="#local-6989586621683045208"><span class="hs-identifier hs-var">scs</span></a></span><span> </span><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621683045207"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="#local-6989586621683045210"><span class="hs-identifier hs-type">addOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SolvedCts"><span class="hs-identifier hs-type">SolvedCts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Solve.html#SolvedCts"><span class="hs-identifier hs-type">SolvedCts</span></a></span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621683045210"><span class="annot"><span class="annottext">addOne :: ([Ct], [(EvTerm, Ct)]) -&gt; (EvTerm, Ct) -&gt; ([Ct], [(EvTerm, Ct)])
</span><a href="#local-6989586621683045210"><span class="hs-identifier hs-var hs-var">addOne</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045211"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045211"><span class="hs-identifier hs-var">givens</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683045212"><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621683045212"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683045213"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683045213"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683045214"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045214"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045214"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-719"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045214"><span class="hs-identifier hs-var">ct</span></a></span><span class="annot"><span class="annottext">Ct -&gt; [Ct] -&gt; [Ct]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045211"><span class="hs-identifier hs-var">givens</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621683045212"><span class="hs-identifier hs-var">wanteds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683045211"><span class="hs-identifier hs-var">givens</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683045213"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683045214"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(EvTerm, Ct) -&gt; [(EvTerm, Ct)] -&gt; [(EvTerm, Ct)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621683045212"><span class="hs-identifier hs-var">wanteds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span></pre></body></html>