<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

Extracting imported and top-level names in scope
-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html"><span class="hs-identifier">GHC.Rename.Names</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#rnImports"><span class="hs-identifier">rnImports</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#getLocalNonValBinders"><span class="hs-identifier">getLocalNonValBinders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#newRecordFieldLabel"><span class="hs-identifier">newRecordFieldLabel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#importsFromIface"><span class="hs-identifier">importsFromIface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier">ImportUserSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#extendGlobalRdrEnvRn"><span class="hs-identifier">extendGlobalRdrEnvRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#gresFromAvails"><span class="hs-identifier">gresFromAvails</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#calculateAvails"><span class="hs-identifier">calculateAvails</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#reportUnusedNames"><span class="hs-identifier">reportUnusedNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#checkConName"><span class="hs-identifier">checkConName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#mkChildEnv"><span class="hs-identifier">mkChildEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#findChildren"><span class="hs-identifier">findChildren</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#findImportUsage"><span class="hs-identifier">findImportUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#getMinimalImports"><span class="hs-identifier">getMinimalImports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#printMinimalImports"><span class="hs-identifier">printMinimalImports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#renamePkgQual"><span class="hs-identifier">renamePkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier">renameRawPkgQual</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#classifyGREs"><span class="hs-identifier">classifyGREs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Rename.Names.html#ImportDeclUsage"><span class="hs-identifier">ImportDeclUsage</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier">head</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">init</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">last</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier">tail</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html"><span class="hs-identifier">GHC.Rename.Fixity</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#warnUnusedTopBinds"><span class="hs-identifier">warnUnusedTopBinds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html"><span class="hs-identifier">GHC.Rename.Unbound</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html"><span class="hs-identifier">GHC.Rename.Unbound</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unbound</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html"><span class="hs-identifier">GHC.Tc.Types.LclEnv</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier">tcInitTidyEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#loadSrcInterface"><span class="hs-identifier">loadSrcInterface</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html"><span class="hs-identifier">GHC.Iface.Syntax</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDefault"><span class="hs-identifier">IfaceDefault</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#fromIfaceWarnings"><span class="hs-identifier">fromIfaceWarnings</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.PostProcess.html"><span class="hs-identifier">GHC.Parser.PostProcess</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Parser.PostProcess.html#setRdrNameSpace"><span class="hs-identifier">setRdrNameSpace</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier">tyConName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Utils</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html"><span class="hs-identifier">GHC.Types.Fixity.Env</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html"><span class="hs-identifier">GHC.Types.SafeHaskell</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html"><span class="hs-identifier">GHC.Types.Avail</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html"><span class="hs-identifier">GHC.Types.FieldLabel</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Hint.html"><span class="hs-identifier">GHC.Types.Hint</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SrcLoc</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier">TopLevelFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html"><span class="hs-identifier">GHC.Types.HpcInfo</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html"><span class="hs-identifier">GHC.Types.PkgQual</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html"><span class="hs-identifier">GHC.Types.GREInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.GREInfo.html#ConInfo"><span class="hs-identifier">ConInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConFieldInfo"><span class="hs-identifier">ConFieldInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConLikeInfo"><span class="hs-identifier">ConLikeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.GREInfo.html#ConIsData"><span class="hs-identifier">ConIsData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html"><span class="hs-identifier">GHC.Unit.Module.Warnings</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html"><span class="hs-identifier">GHC.Unit.Module.Imported</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html"><span class="hs-identifier">GHC.Unit.Module.Deps</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.Env.html"><span class="hs-identifier">GHC.Data.FastString.Env</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#removeDups"><span class="hs-identifier">removeDups</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">for_</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.html"><span class="hs-identifier">Data.IntMap</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#IntMap"><span class="hs-identifier">IntMap</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.html"><span class="hs-identifier">Data.IntMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">comparing</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator">(&lt;/&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{rnImports}
*                                                                      *
************************************************************************

Note [Tracking Trust Transitively]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we import a package as well as checking that the direct imports are safe
according to the rules outlined in the Note [Safe Haskell Trust Check] in GHC.Driver.Main
we must also check that these rules hold transitively for all dependent modules
and packages. Doing this without caching any trust information would be very
slow as we would need to touch all packages and interface files a module depends
on. To avoid this we make use of the property that if a modules Safe Haskell
mode changes, this triggers a recompilation from that module in the dependency
graph. So we can just worry mostly about direct imports.

There is one trust property that can change for a package though without
recompilation being triggered: package trust. So we must check that all
packages a module transitively depends on to be trusted are still trusted when
we are compiling this module (as due to recompilation avoidance some modules
below may not be considered trusted any more without recompilation being
triggered).

We handle this by augmenting the existing transitive list of packages a module M
depends on with a bool for each package that says if it must be trusted when the
module M is being checked for trust. This list of trust required packages for a
single import is gathered in the rnImportDecl function and stored in an
ImportAvails data structure. The union of these trust required packages for all
imports is done by the rnImports function using the combine function which calls
the plusImportAvails function that is a union operation for the ImportAvails
type. This gives us in an ImportAvails structure all packages required to be
trusted for the module we are currently compiling. Checking that these packages
are still trusted (and that direct imports are trusted) is done in
GHC.Driver.Main.checkSafeImports.

See the note below, [Trust Own Package] for a corner case in this method and
how its handled.


Note [Trust Own Package]
~~~~~~~~~~~~~~~~~~~~~~~~
There is a corner case of package trust checking that the usual transitive check
doesn't cover. (For how the usual check operates see the Note [Tracking Trust
Transitively] below). The case is when you import a -XSafe module M and M
imports a -XTrustworthy module N. If N resides in a different package than M,
then the usual check works as M will record a package dependency on N's package
and mark it as required to be trusted. If N resides in the same package as M
though, then importing M should require its own package be trusted due to N
(since M is -XSafe so doesn't create this requirement by itself). The usual
check fails as a module doesn't record a package dependency of its own package.
So instead we now have a bool field in a modules interface file that simply
states if the module requires its own package to be trusted. This field avoids
us having to load all interface files that the module depends on to see if one
is trustworthy.


Note [Trust Transitive Property]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
So there is an interesting design question in regards to transitive trust
checking. Say I have a module B compiled with -XSafe. B is dependent on a bunch
of modules and packages, some packages it requires to be trusted as its using
-XTrustworthy modules from them. Now if I have a module A that doesn't use safe
haskell at all and simply imports B, should A inherit all the trust
requirements from B? Should A now also require that a package p is trusted since
B required it?

We currently say no but saying yes also makes sense. The difference is, if a
module M that doesn't use Safe Haskell imports a module N that does, should all
the trusted package requirements be dropped since M didn't declare that it cares
about Safe Haskell (so -XSafe is more strongly associated with the module doing
the importing) or should it be done still since the author of the module N that
uses Safe Haskell said they cared (so -XSafe is more strongly associated with
the module that was compiled that used it).

Going with yes is a simpler semantics we think and harder for the user to stuff
up but it does mean that Safe Haskell will affect users who don't care about
Safe Haskell as they might grab a package from Cabal which uses safe haskell (say
network) and that packages imports -XTrustworthy modules from another package
(say bytestring), so requires that package is trusted. The user may now get
compilation errors in code that doesn't do anything with Safe Haskell simply
because they are using the network package. They will have to call 'ghc-pkg
trust network' to get everything working. Due to this invasive nature of going
with yes we have gone with no for now.
-}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- | Process Import Decls.  See 'rnImportDecl' for a description of what</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- the return types represent.</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- Note: Do the non SOURCE ones first, so that we get a helpful warning</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- for SOURCE ones that are unnecessary</span><span>
</span><span id="line-203"></span><span class="annot"><a href="GHC.Rename.Names.html#rnImports"><span class="hs-identifier hs-type">rnImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier hs-type">ImportUserSpec</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDefault"><span class="hs-identifier hs-type">IfaceDefault</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span id="rnImports"><span class="annot"><span class="annottext">rnImports :: [(LImportDecl (GhcPass 'Parsed), SDoc)]
-&gt; RnM
     ([LImportDecl GhcRn], [ImportUserSpec], GlobalRdrEnv, ImportAvails,
      [(Module, IfaceDefault)], Bool)
</span><a href="GHC.Rename.Names.html#rnImports"><span class="hs-identifier hs-var hs-var">rnImports</span></a></span></span><span> </span><span id="local-6989586621683052509"><span class="annot"><span class="annottext">[(LImportDecl (GhcPass 'Parsed), SDoc)]
</span><a href="#local-6989586621683052509"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621683052510"><span class="annot"><a href="#local-6989586621683052510"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- NB: want an identity module here, because it's OK for a signature</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- module to import from its implementor</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052512"><span class="annot"><a href="#local-6989586621683052512"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683052510"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052514"><span class="annot"><a href="#local-6989586621683052514"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052515"><span class="annot"><a href="#local-6989586621683052515"><span class="hs-identifier hs-var">ordinary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052516"><span class="hs-identifier hs-type">is_source_import</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052509"><span class="hs-identifier hs-type">imports</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span id="local-6989586621683052516"><span class="annot"><a href="#local-6989586621683052516"><span class="hs-identifier hs-var hs-var">is_source_import</span></a></span></span><span> </span><span id="local-6989586621683052520"><span class="annot"><span class="annottext">GenLocated l (ImportDecl pass)
</span><a href="#local-6989586621683052520"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl pass -&gt; IsBootInterface
forall pass. ImportDecl pass -&gt; IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclSource"><span class="hs-identifier hs-var">ideclSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated l (ImportDecl pass) -&gt; ImportDecl pass
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated l (ImportDecl pass)
</span><a href="#local-6989586621683052520"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621683052524"><span class="annot"><a href="#local-6989586621683052524"><span class="hs-identifier hs-var">stuff1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-type">mapAndReportM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#rnImportDecl"><span class="hs-identifier hs-type">rnImportDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052512"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052515"><span class="hs-identifier hs-type">ordinary</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621683052526"><span class="annot"><a href="#local-6989586621683052526"><span class="hs-identifier hs-var">stuff2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-type">mapAndReportM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#rnImportDecl"><span class="hs-identifier hs-type">rnImportDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052512"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052514"><span class="hs-identifier hs-type">source</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- Safe Haskell: See Note [Tracking Trust Transitively]</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052527"><span class="annot"><a href="#local-6989586621683052527"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052528"><span class="annot"><a href="#local-6989586621683052528"><span class="hs-identifier hs-var">imp_user_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052529"><span class="annot"><a href="#local-6989586621683052529"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052530"><span class="annot"><a href="#local-6989586621683052530"><span class="hs-identifier hs-var">imp_avails</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052531"><span class="annot"><a href="#local-6989586621683052531"><span class="hs-identifier hs-var">defaults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052532"><span class="annot"><a href="#local-6989586621683052532"><span class="hs-identifier hs-var">hpc_usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683052533"><span class="hs-identifier hs-type">combine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052524"><span class="hs-identifier hs-type">stuff1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683052526"><span class="hs-identifier hs-type">stuff2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">-- Update imp_boot_mods if imp_direct_mods mentions any of them</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052534"><span class="annot"><a href="#local-6989586621683052534"><span class="hs-identifier hs-var hs-var">merged_import_avail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; ImportAvails
</span><a href="#local-6989586621683052535"><span class="hs-identifier hs-var">clobberSourceImports</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052530"><span class="hs-identifier hs-var">imp_avails</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052527"><span class="hs-identifier hs-type">decls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052528"><span class="hs-identifier hs-type">imp_user_spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052529"><span class="hs-identifier hs-type">rdr_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052534"><span class="hs-identifier hs-type">merged_import_avail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052531"><span class="hs-identifier hs-type">defaults</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052532"><span class="hs-identifier hs-type">hpc_usage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621683052535"><span class="annot"><span class="annottext">clobberSourceImports :: ImportAvails -&gt; ImportAvails
</span><a href="#local-6989586621683052535"><span class="hs-identifier hs-var hs-var">clobberSourceImports</span></a></span></span><span> </span><span id="local-6989586621683052536"><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052536"><span class="hs-identifier hs-var">imp_avails</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052536"><span class="hs-identifier hs-var">imp_avails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_boot_mods"><span class="hs-identifier hs-var">imp_boot_mods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683052538"><span class="hs-identifier hs-type">imp_boot_mods'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>        </span><span id="local-6989586621683052538"><span class="annot"><span class="annottext">imp_boot_mods' :: InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052538"><span class="hs-identifier hs-var hs-var">imp_boot_mods'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenWithIsBoot ModuleName
 -&gt; GenWithIsBoot ModuleName -&gt; Maybe (GenWithIsBoot ModuleName))
-&gt; (InstalledModuleEnv (GenWithIsBoot ModuleName)
    -&gt; InstalledModuleEnv (GenWithIsBoot ModuleName))
-&gt; (InstalledModuleEnv (GenWithIsBoot ModuleName)
    -&gt; InstalledModuleEnv (GenWithIsBoot ModuleName))
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
forall elta eltb eltc.
(elta -&gt; eltb -&gt; Maybe eltc)
-&gt; (InstalledModuleEnv elta -&gt; InstalledModuleEnv eltc)
-&gt; (InstalledModuleEnv eltb -&gt; InstalledModuleEnv eltc)
-&gt; InstalledModuleEnv elta
-&gt; InstalledModuleEnv eltb
-&gt; InstalledModuleEnv eltc
</span><a href="GHC.Unit.Module.Env.html#mergeInstalledModuleEnv"><span class="hs-identifier hs-var">mergeInstalledModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot ModuleName
-&gt; GenWithIsBoot ModuleName -&gt; Maybe (GenWithIsBoot ModuleName)
forall {mod}.
GenWithIsBoot mod -&gt; GenWithIsBoot mod -&gt; Maybe (GenWithIsBoot mod)
</span><a href="#local-6989586621683052540"><span class="hs-identifier hs-var">combJ</span></a></span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
forall a. InstalledModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#emptyInstalledModuleEnv"><span class="hs-identifier hs-var">emptyInstalledModuleEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportAvails -&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="GHC.Unit.Module.Deps.html#imp_boot_mods"><span class="hs-identifier hs-var">imp_boot_mods</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052536"><span class="hs-identifier hs-var">imp_avails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportAvails -&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="GHC.Unit.Module.Deps.html#imp_direct_dep_mods"><span class="hs-identifier hs-var">imp_direct_dep_mods</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052536"><span class="hs-identifier hs-var">imp_avails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>        </span><span id="local-6989586621683052540"><span class="annot"><span class="annottext">combJ :: GenWithIsBoot mod -&gt; GenWithIsBoot mod -&gt; Maybe (GenWithIsBoot mod)
</span><a href="#local-6989586621683052540"><span class="hs-identifier hs-var hs-var">combJ</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">mod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683052546"><span class="annot"><span class="annottext">GenWithIsBoot mod
</span><a href="#local-6989586621683052546"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot mod -&gt; Maybe (GenWithIsBoot mod)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot mod
</span><a href="#local-6989586621683052546"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="annot"><a href="#local-6989586621683052540"><span class="hs-identifier hs-var">combJ</span></a></span><span> </span><span id="local-6989586621683052547"><span class="annot"><span class="annottext">GenWithIsBoot mod
</span><a href="#local-6989586621683052547"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot mod
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot mod -&gt; Maybe (GenWithIsBoot mod)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot mod
</span><a href="#local-6989586621683052547"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- See Note [Combining ImportAvails]</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="#local-6989586621683052533"><span class="hs-identifier hs-type">combine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier hs-type">ImportUserSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDefault"><span class="hs-identifier hs-type">IfaceDefault</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier hs-type">ImportUserSpec</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDefault"><span class="hs-identifier hs-type">IfaceDefault</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621683052533"><span class="annot"><span class="annottext">combine :: [(LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
  [(Module, IfaceDefault)], Bool)]
-&gt; ([LImportDecl GhcRn], [ImportUserSpec], GlobalRdrEnv,
    ImportAvails, [(Module, IfaceDefault)], Bool)
</span><a href="#local-6989586621683052533"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621683052548"><span class="annot"><span class="annottext">[(LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
  [(Module, IfaceDefault)], Bool)]
</span><a href="#local-6989586621683052548"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052549"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
</span><a href="#local-6989586621683052549"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052550"><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683052550"><span class="hs-identifier hs-var">imp_user_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052551"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052551"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052552"><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052552"><span class="hs-identifier hs-var">imp_avails</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052553"><span class="annot"><span class="annottext">[(Module, IfaceDefault)]
</span><a href="#local-6989586621683052553"><span class="hs-identifier hs-var">defaults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052554"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052554"><span class="hs-identifier hs-var">hpc_usage</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052555"><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621683052555"><span class="hs-identifier hs-var">finsts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GenLocated SrcSpanAnnA (ImportDecl GhcRn), ImportUserSpec,
  GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool)
 -&gt; ([GenLocated SrcSpanAnnA (ImportDecl GhcRn)], [ImportUserSpec],
     GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool,
     ModuleSet)
 -&gt; ([GenLocated SrcSpanAnnA (ImportDecl GhcRn)], [ImportUserSpec],
     GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool,
     ModuleSet))
-&gt; ([GenLocated SrcSpanAnnA (ImportDecl GhcRn)], [ImportUserSpec],
    GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool,
    ModuleSet)
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcRn), ImportUserSpec,
     GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool)]
-&gt; ([GenLocated SrcSpanAnnA (ImportDecl GhcRn)], [ImportUserSpec],
    GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool,
    ModuleSet)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>
</span><span id="line-235"></span><span>            </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (ImportDecl GhcRn), ImportUserSpec,
 GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool)
-&gt; ([GenLocated SrcSpanAnnA (ImportDecl GhcRn)], [ImportUserSpec],
    GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool,
    ModuleSet)
-&gt; ([GenLocated SrcSpanAnnA (ImportDecl GhcRn)], [ImportUserSpec],
    GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool,
    ModuleSet)
forall {a} {a} {a}.
(a, a, GlobalRdrEnv, ImportAvails, [a], Bool)
-&gt; ([a], [a], GlobalRdrEnv, ImportAvails, [a], Bool, ModuleSet)
-&gt; ([a], [a], GlobalRdrEnv, ImportAvails, [a], Bool, ModuleSet)
</span><a href="#local-6989586621683052557"><span class="hs-identifier hs-var">plus</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
forall info. GlobalRdrEnvX info
</span><a href="GHC.Types.Name.Reader.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="GHC.Unit.Module.Env.html#emptyModuleSet"><span class="hs-identifier hs-var">emptyModuleSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>            </span><span class="annot"><span class="annottext">[(LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
  [(Module, IfaceDefault)], Bool)]
[(GenLocated SrcSpanAnnA (ImportDecl GhcRn), ImportUserSpec,
  GlobalRdrEnv, ImportAvails, [(Module, IfaceDefault)], Bool)]
</span><a href="#local-6989586621683052548"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LImportDecl GhcRn]
[GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
</span><a href="#local-6989586621683052549"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ImportUserSpec]
</span><a href="#local-6989586621683052550"><span class="hs-identifier hs-var">imp_user_spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052551"><span class="hs-identifier hs-var">rdr_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052552"><span class="hs-identifier hs-var">imp_avails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_finsts"><span class="hs-identifier hs-var">imp_finsts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Env.html#moduleSetElts"><span class="hs-identifier hs-type">moduleSetElts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052555"><span class="hs-identifier hs-type">finsts</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>            </span><span class="annot"><span class="annottext">[(Module, IfaceDefault)]
</span><a href="#local-6989586621683052553"><span class="hs-identifier hs-var">defaults</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052554"><span class="hs-identifier hs-var">hpc_usage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621683052557"><span class="annot"><span class="annottext">plus :: (a, a, GlobalRdrEnv, ImportAvails, [a], Bool)
-&gt; ([a], [a], GlobalRdrEnv, ImportAvails, [a], Bool, ModuleSet)
-&gt; ([a], [a], GlobalRdrEnv, ImportAvails, [a], Bool, ModuleSet)
</span><a href="#local-6989586621683052557"><span class="hs-identifier hs-var hs-var">plus</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052563"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683052563"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">,</span><span>  </span><span id="local-6989586621683052564"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683052564"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052565"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052565"><span class="hs-identifier hs-var">gbl_env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052566"><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052566"><span class="hs-identifier hs-var">imp_avails1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052567"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052567"><span class="hs-identifier hs-var">defaults1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052568"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052568"><span class="hs-identifier hs-var">hpc_usage1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621683052569"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052569"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052570"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052570"><span class="hs-identifier hs-var">uss</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052571"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052571"><span class="hs-identifier hs-var">gbl_env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052572"><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052572"><span class="hs-identifier hs-var">imp_avails2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052573"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052573"><span class="hs-identifier hs-var">defaults2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052574"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052574"><span class="hs-identifier hs-var">hpc_usage2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052575"><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621683052575"><span class="hs-identifier hs-var">finsts_set</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683052563"><span class="hs-identifier hs-var">decl</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052569"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683052564"><span class="hs-identifier hs-var">us</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052570"><span class="hs-identifier hs-var">uss</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052565"><span class="hs-identifier hs-var">gbl_env1</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#plusGlobalRdrEnv"><span class="hs-operator hs-var">`plusGlobalRdrEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052571"><span class="hs-identifier hs-var">gbl_env2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>          </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052577"><span class="hs-identifier hs-var">imp_avails1'</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; ImportAvails -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#plusImportAvails"><span class="hs-operator hs-var">`plusImportAvails`</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052572"><span class="hs-identifier hs-var">imp_avails2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052567"><span class="hs-identifier hs-var">defaults1</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683052573"><span class="hs-identifier hs-var">defaults2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-248"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052568"><span class="hs-identifier hs-var">hpc_usage1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052574"><span class="hs-identifier hs-var">hpc_usage2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-249"></span><span>          </span><span class="annot"><span class="annottext">ModuleSet -&gt; [Module] -&gt; ModuleSet
</span><a href="GHC.Unit.Module.Env.html#extendModuleSetList"><span class="hs-identifier hs-var">extendModuleSetList</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621683052575"><span class="hs-identifier hs-var">finsts_set</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052581"><span class="hs-identifier hs-var">new_finsts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>      </span><span id="local-6989586621683052577"><span class="annot"><span class="annottext">imp_avails1' :: ImportAvails
</span><a href="#local-6989586621683052577"><span class="hs-identifier hs-var hs-var">imp_avails1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052566"><span class="hs-identifier hs-var">imp_avails1</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_finsts"><span class="hs-identifier hs-var">imp_finsts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-252"></span><span>      </span><span id="local-6989586621683052581"><span class="annot"><span class="annottext">new_finsts :: [Module]
</span><a href="#local-6989586621683052581"><span class="hs-identifier hs-var hs-var">new_finsts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; [Module]
</span><a href="GHC.Unit.Module.Deps.html#imp_finsts"><span class="hs-identifier hs-var">imp_finsts</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683052566"><span class="hs-identifier hs-var">imp_avails1</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">{-
Note [Combining ImportAvails]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
imp_finsts in ImportAvails is a list of family instance modules
transitively depended on by an import. imp_finsts for a currently
compiled module is a union of all the imp_finsts of imports.
Computing the union of two lists of size N is O(N^2) and if we
do it to M imports we end up with O(M*N^2). That can get very
expensive for bigger module hierarchies.

Union can be optimized to O(N log N) if we use a Set.
imp_finsts is converted back and forth between dep_finsts, so
changing a type of imp_finsts means either paying for the conversions
or changing the type of dep_finsts as well.

I've measured that the conversions would cost 20% of allocations on my
test case, so that can be ruled out.

Changing the type of dep_finsts forces checkFamInsts to
get the module lists in non-deterministic order. If we wanted to restore
the deterministic order, we'd have to sort there, which is an additional
cost. As far as I can tell, using a non-deterministic order is fine there,
but that's a brittle nonlocal property which I'd like to avoid.

Additionally, dep_finsts is read from an interface file, so its &quot;natural&quot;
type is a list. Which makes it a natural type for imp_finsts.

Since rnImports.combine is really the only place that would benefit from
it being a Set, it makes sense to optimize the hot loop in rnImports.combine
without changing the representation.

So here's what we do: instead of naively merging ImportAvails with
plusImportAvails in a loop, we make plusImportAvails merge empty imp_finsts
and compute the union on the side using Sets. When we're done, we can
convert it back to a list. One nice side effect of this approach is that
if there's a lot of overlap in the imp_finsts of imports, the
Set doesn't really need to grow and we don't need to allocate.

Running generateModules from #14693 with DEPTH=16, WIDTH=30 finishes in
23s before, and 11s after.
-}</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- | Given a located import declaration @decl@ from @this_mod@,</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- calculate the following pieces of information:</span><span>
</span><span id="line-298"></span><span class="hs-comment">--</span><span>
</span><span id="line-299"></span><span class="hs-comment">--  1. An updated 'LImportDecl', where all unresolved 'RdrName' in</span><span>
</span><span id="line-300"></span><span class="hs-comment">--     the entity lists have been resolved into 'Name's,</span><span>
</span><span id="line-301"></span><span class="hs-comment">--</span><span>
</span><span id="line-302"></span><span class="hs-comment">--  2. A 'GlobalRdrEnv' representing the new identifiers that were</span><span>
</span><span id="line-303"></span><span class="hs-comment">--     brought into scope (taking into account module qualification</span><span>
</span><span id="line-304"></span><span class="hs-comment">--     and hiding),</span><span>
</span><span id="line-305"></span><span class="hs-comment">--</span><span>
</span><span id="line-306"></span><span class="hs-comment">--  3. 'ImportAvails' summarizing the identifiers that were imported</span><span>
</span><span id="line-307"></span><span class="hs-comment">--     by this declaration, and</span><span>
</span><span id="line-308"></span><span class="hs-comment">--</span><span>
</span><span id="line-309"></span><span class="hs-comment">--  4. A boolean 'AnyHpcUsage' which is true if the imported module</span><span>
</span><span id="line-310"></span><span class="hs-comment">--     used HPC.</span><span>
</span><span id="line-311"></span><span class="annot"><a href="GHC.Rename.Names.html#rnImportDecl"><span class="hs-identifier hs-type">rnImportDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ImportUserSpec"><span class="hs-identifier hs-type">ImportUserSpec</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#IfaceDefault"><span class="hs-identifier hs-type">IfaceDefault</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span id="rnImportDecl"><span class="annot"><span class="annottext">rnImportDecl :: Module
-&gt; (LImportDecl (GhcPass 'Parsed), SDoc)
-&gt; RnM
     (LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
      [(Module, IfaceDefault)], Bool)
</span><a href="GHC.Rename.Names.html#rnImportDecl"><span class="hs-identifier hs-var hs-var">rnImportDecl</span></a></span></span><span> </span><span id="local-6989586621683052583"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052583"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span>
</span><span id="line-314"></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683052585"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683052585"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683052586"><span class="annot"><span class="annottext">decl :: ImportDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052586"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ideclName :: forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052589"><span class="annot"><span class="annottext">XRec (GhcPass 'Parsed) ModuleName
</span><a href="#local-6989586621683052589"><span class="hs-identifier hs-var">loc_imp_mod_name</span></a></span></span><span>
</span><span id="line-315"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclPkgQual :: forall pass. ImportDecl pass -&gt; ImportDeclPkgQual pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclPkgQual"><span class="hs-identifier hs-var">ideclPkgQual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052591"><span class="annot"><span class="annottext">ImportDeclPkgQual (GhcPass 'Parsed)
</span><a href="#local-6989586621683052591"><span class="hs-identifier hs-var">raw_pkg_qual</span></a></span></span><span>
</span><span id="line-316"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclSource :: forall pass. ImportDecl pass -&gt; IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclSource"><span class="hs-identifier hs-var">ideclSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052592"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683052592"><span class="hs-identifier hs-var">want_boot</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclSafe :: forall pass. ImportDecl pass -&gt; Bool
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclSafe"><span class="hs-identifier hs-var">ideclSafe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052594"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052594"><span class="hs-identifier hs-var">mod_safe</span></a></span></span><span>
</span><span id="line-317"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclQualified :: forall pass. ImportDecl pass -&gt; ImportDeclQualifiedStyle
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclQualified"><span class="hs-identifier hs-var">ideclQualified</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052596"><span class="annot"><span class="annottext">ImportDeclQualifiedStyle
</span><a href="#local-6989586621683052596"><span class="hs-identifier hs-var">qual_style</span></a></span></span><span>
</span><span id="line-318"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclExt :: forall pass. ImportDecl pass -&gt; XCImportDecl pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclExt"><span class="hs-identifier hs-var">ideclExt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.ImpExp.html#XImportDeclPass"><span class="hs-identifier hs-type">XImportDeclPass</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ideclImplicit :: XImportDeclPass -&gt; Bool
</span><a href="GHC.Hs.ImpExp.html#ideclImplicit"><span class="hs-identifier hs-var">ideclImplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052600"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052600"><span class="hs-identifier hs-var">implicit</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-319"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclAs :: forall pass. ImportDecl pass -&gt; Maybe (XRec pass ModuleName)
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclAs"><span class="hs-identifier hs-var">ideclAs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052602"><span class="annot"><span class="annottext">Maybe (XRec (GhcPass 'Parsed) ModuleName)
</span><a href="#local-6989586621683052602"><span class="hs-identifier hs-var">as_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclImportList :: forall pass.
ImportDecl pass
-&gt; Maybe (ImportListInterpretation, XRec pass [LIE pass])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052604"><span class="annot"><span class="annottext">Maybe
  (ImportListInterpretation,
   XRec (GhcPass 'Parsed) [LIE (GhcPass 'Parsed)])
</span><a href="#local-6989586621683052604"><span class="hs-identifier hs-var">imp_details</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052605"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683052605"><span class="hs-identifier hs-var">import_reason</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; RnM
     (LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
      [(Module, IfaceDefault)], Bool)
-&gt; RnM
     (LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
      [(Module, IfaceDefault)], Bool)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683052585"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(RnM
   (LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
    [(Module, IfaceDefault)], Bool)
 -&gt; RnM
      (LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
       [(Module, IfaceDefault)], Bool))
-&gt; RnM
     (LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
      [(Module, IfaceDefault)], Bool)
-&gt; RnM
     (LImportDecl GhcRn, ImportUserSpec, GlobalRdrEnv, ImportAvails,
      [(Module, IfaceDefault)], Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ImportDeclPkgQual (GhcPass 'Parsed)
</span><a href="#local-6989586621683052591"><span class="hs-identifier hs-var">raw_pkg_qual</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">ImportDeclPkgQual (GhcPass 'Parsed)
RawPkgQual
</span><a href="GHC.Types.PkgQual.html#NoRawPkgQual"><span class="hs-identifier hs-var">NoRawPkgQual</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>      </span><span class="annot"><a href="GHC.Types.PkgQual.html#RawPkgQual"><span class="hs-identifier hs-type">RawPkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">StringLiteral
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>        </span><span id="local-6989586621683052609"><span class="annot"><a href="#local-6989586621683052609"><span class="hs-identifier hs-var">pkg_imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.PackageImports</span></span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683052609"><span class="hs-identifier hs-type">pkg_imports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnPackageImportsDisabled"><span class="hs-identifier hs-type">TcRnPackageImportsDisabled</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052616"><span class="annot"><span class="annottext">qual_only :: Bool
</span><a href="#local-6989586621683052616"><span class="hs-identifier hs-var hs-var hs-var">qual_only</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDeclQualifiedStyle -&gt; Bool
</span><a href="GHC.Hs.ImpExp.html#isImportDeclQualified"><span class="hs-identifier hs-var">isImportDeclQualified</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDeclQualifiedStyle
</span><a href="#local-6989586621683052596"><span class="hs-identifier hs-var">qual_style</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-comment">-- If there's an error in loadInterface, (e.g. interface</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-comment">-- file not found) we get lots of spurious errors from 'filterImports'</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052618"><span class="annot"><span class="annottext">imp_mod_name :: ModuleName
</span><a href="#local-6989586621683052618"><span class="hs-identifier hs-var hs-var hs-var">imp_mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec (GhcPass 'Parsed) ModuleName
GenLocated SrcSpanAnnA ModuleName
</span><a href="#local-6989586621683052589"><span class="hs-identifier hs-var">loc_imp_mod_name</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621683052619"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683052619"><span class="hs-identifier hs-var hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052618"><span class="hs-identifier hs-var">imp_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683052605"><span class="hs-identifier hs-var">import_reason</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621683052622"><span class="annot"><a href="#local-6989586621683052622"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621683052624"><span class="annot"><a href="#local-6989586621683052624"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052627"><span class="annot"><a href="#local-6989586621683052627"><span class="hs-identifier hs-var hs-var">pkg_qual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier hs-var">renameRawPkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052624"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052618"><span class="hs-identifier hs-var">imp_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDeclPkgQual (GhcPass 'Parsed)
RawPkgQual
</span><a href="#local-6989586621683052591"><span class="hs-identifier hs-var">raw_pkg_qual</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">-- Check for self-import, which confuses the typechecker (#9032)</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- ghc --make rejects self-import cycles already, but batch-mode may not</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-comment">-- at least not until GHC.IfaceToCore.tcHiBootIface, which is too late to avoid</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-comment">-- typechecker crashes.  (Indirect self imports are not caught until</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">-- GHC.IfaceToCore, see #10337 tracking how to make this error better.)</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- Originally, we also allowed 'import {-# SOURCE #-} M', but this</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- caused bug #10182: in one-shot mode, we should never load an hs-boot</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">-- file for the module we are compiling into the EPS.  In principle,</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- it should be possible to support this mode of use, but we would have to</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- extend Provenance to support a local definition in a qualified location.</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-comment">-- For now, we don't support it, but see #10336</span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052618"><span class="hs-identifier hs-type">imp_mod_name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052583"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span>
</span><span id="line-352"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683052627"><span class="hs-identifier hs-type">pkg_qual</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- If we have import &quot;&lt;pkg&gt;&quot; M, then we should</span><span>
</span><span id="line-353"></span><span>                            </span><span class="hs-comment">-- check that &quot;&lt;pkg&gt;&quot; is &quot;this&quot; (which is magic)</span><span>
</span><span id="line-354"></span><span>                            </span><span class="hs-comment">-- or the name of this_mod's package.  Yurgh!</span><span>
</span><span id="line-355"></span><span>                            </span><span class="hs-comment">-- c.f. GHC.findModule, and #9997</span><span>
</span><span id="line-356"></span><span>             </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-357"></span><span>             </span><span class="annot"><a href="GHC.Types.PkgQual.html#ThisPkg"><span class="hs-identifier hs-type">ThisPkg</span></a></span><span> </span><span id="local-6989586621683052632"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052632"><span class="hs-identifier hs-var">uid</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052632"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.DynFlags.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683052622"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>             </span><span class="annot"><a href="GHC.Types.PkgQual.html#OtherPkg"><span class="hs-identifier hs-type">OtherPkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnSelfImport"><span class="hs-identifier hs-type">TcRnSelfImport</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052618"><span class="hs-identifier hs-type">imp_mod_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-comment">-- Check for a missing import list (Opt_WarnMissingImportList also</span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">-- checks for T(..) items but that is done in checkDodgyImport below)</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683052604"><span class="hs-identifier hs-type">imp_details</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XRec (GhcPass 'Parsed) [LIE (GhcPass 'Parsed)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Explicit import list</span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><span class="annottext">Maybe
  (ImportListInterpretation,
   XRec (GhcPass 'Parsed) [LIE (GhcPass 'Parsed)])
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052600"><span class="hs-identifier hs-var">implicit</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Do not bleat for implicit imports</span><span>
</span><span id="line-366"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052616"><span class="hs-identifier hs-var">qual_only</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">addDiagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnNoExplicitImportList"><span class="hs-identifier hs-var">TcRnNoExplicitImportList</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052618"><span class="hs-identifier hs-var">imp_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621683052640"><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#loadSrcInterface"><span class="hs-identifier hs-type">loadSrcInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052619"><span class="hs-identifier hs-type">doc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052618"><span class="hs-identifier hs-type">imp_mod_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052592"><span class="hs-identifier hs-type">want_boot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052627"><span class="hs-identifier hs-type">pkg_qual</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-comment">-- Compiler sanity check: if the import didn't say</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-comment">-- {-# SOURCE #-} we should not get a hi-boot file</span><span>
</span><span id="line-374"></span><span>    </span><span class="annot"><a href="GHC.Utils.Trace.html#warnPprTrace"><span class="hs-identifier hs-type">warnPprTrace</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052592"><span class="hs-identifier hs-type">want_boot</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-type">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_boot"><span class="hs-identifier hs-type">mi_boot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-type">IsBoot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;rnImportDecl&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052618"><span class="hs-identifier hs-type">imp_mod_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- Issue a user warning for a redundant {- SOURCE -} import</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- NB that we arrange to read all the ordinary imports before</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-comment">-- any of the {- SOURCE -} imports.</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-comment">-- in --make and GHCi, the compilation manager checks for this,</span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-comment">-- and indeed we shouldn't do it here because the existence of</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-comment">-- the non-boot module depends on the compilation order, which</span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-comment">-- is not deterministic.  The hs-boot test can show this up.</span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621683052644"><span class="annot"><a href="#local-6989586621683052644"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnIf"><span class="hs-identifier hs-type">warnIf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052592"><span class="hs-identifier hs-type">want_boot</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-type">IsBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_boot"><span class="hs-identifier hs-type">mi_boot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-type">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#isOneShot"><span class="hs-identifier hs-type">isOneShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#ghcMode"><span class="hs-identifier hs-var">ghcMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052644"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnRedundantSourceImport"><span class="hs-identifier hs-type">TcRnRedundantSourceImport</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052618"><span class="hs-identifier hs-type">imp_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052594"><span class="hs-identifier hs-type">mod_safe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#safeImportsOn"><span class="hs-identifier hs-type">safeImportsOn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052644"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-388"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnSafeImportsDisabled"><span class="hs-identifier hs-type">TcRnSafeImportsDisabled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052618"><span class="hs-identifier hs-type">imp_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052652"><span class="annot"><a href="#local-6989586621683052652"><span class="hs-identifier hs-var hs-var">imp_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052640"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-391"></span><span>        </span><span id="local-6989586621683052654"><span class="annot"><a href="#local-6989586621683052654"><span class="hs-identifier hs-var hs-var">qual_mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName)
-&gt; Maybe (GenLocated SrcSpanAnnA ModuleName) -&gt; Maybe ModuleName
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (XRec (GhcPass 'Parsed) ModuleName)
Maybe (GenLocated SrcSpanAnnA ModuleName)
</span><a href="#local-6989586621683052602"><span class="hs-identifier hs-var">as_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; ModuleName -&gt; ModuleName
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052618"><span class="hs-identifier hs-var">imp_mod_name</span></a></span><span>
</span><span id="line-392"></span><span>        </span><span id="local-6989586621683052656"><span class="annot"><a href="#local-6989586621683052656"><span class="hs-identifier hs-var hs-var">imp_spec</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_mod :: Module
</span><a href="GHC.Types.Name.Reader.html#is_mod"><span class="hs-identifier hs-var">is_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052652"><span class="hs-identifier hs-var">imp_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_qual :: Bool
</span><a href="GHC.Types.Name.Reader.html#is_qual"><span class="hs-identifier hs-var">is_qual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052616"><span class="hs-identifier hs-var">qual_only</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-393"></span><span>                                  </span><span class="annot"><span class="annottext">is_dloc :: SrcSpan
</span><a href="GHC.Types.Name.Reader.html#is_dloc"><span class="hs-identifier hs-var">is_dloc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683052585"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_as :: ModuleName
</span><a href="GHC.Types.Name.Reader.html#is_as"><span class="hs-identifier hs-var">is_as</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052654"><span class="hs-identifier hs-var">qual_mod_name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-394"></span><span>                                  </span><span class="annot"><span class="annottext">is_pkg_qual :: PkgQual
</span><a href="GHC.Types.Name.Reader.html#is_pkg_qual"><span class="hs-identifier hs-var">is_pkg_qual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621683052627"><span class="hs-identifier hs-var">pkg_qual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_isboot :: IsBootInterface
</span><a href="GHC.Types.Name.Reader.html#is_isboot"><span class="hs-identifier hs-var">is_isboot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683052592"><span class="hs-identifier hs-var">want_boot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-comment">-- filter the imports according to the import declaration</span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683052665"><span class="annot"><a href="#local-6989586621683052665"><span class="hs-identifier hs-var">new_imp_details</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052666"><span class="annot"><a href="#local-6989586621683052666"><span class="hs-identifier hs-var">imp_user_list</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052667"><span class="annot"><a href="#local-6989586621683052667"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#filterImports"><span class="hs-identifier hs-type">filterImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052622"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052656"><span class="hs-identifier hs-type">imp_spec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052604"><span class="hs-identifier hs-type">imp_details</span></a></span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-comment">-- for certain error messages, we&#8217;d like to know what could be imported</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- here, if everything were imported</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621683052669"><span class="annot"><a href="#local-6989586621683052669"><span class="hs-identifier hs-var">potential_gres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe
  (ImportListInterpretation,
   LocatedLI [GenLocated SrcSpanAnnA (IE GhcRn)])
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ImpUserList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683052670"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052670"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052670"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#filterImports"><span class="hs-identifier hs-type">filterImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052622"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052656"><span class="hs-identifier hs-type">imp_spec</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052671"><span class="annot"><a href="#local-6989586621683052671"><span class="hs-identifier hs-var hs-var">is_hiding</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#EverythingBut"><span class="hs-identifier hs-var">EverythingBut</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">XRec (GhcPass 'Parsed) [LIE (GhcPass 'Parsed)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe
  (ImportListInterpretation,
   XRec (GhcPass 'Parsed) [LIE (GhcPass 'Parsed)])
</span><a href="#local-6989586621683052604"><span class="hs-identifier hs-var">imp_details</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-404"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-comment">-- should the import be safe?</span><span>
</span><span id="line-407"></span><span>        </span><span id="local-6989586621683052673"><span class="annot"><a href="#local-6989586621683052673"><span class="hs-identifier hs-var hs-var">mod_safe'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052594"><span class="hs-identifier hs-var">mod_safe</span></a></span><span>
</span><span id="line-408"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052600"><span class="hs-identifier hs-var">implicit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeDirectImpsReq"><span class="hs-identifier hs-var">safeDirectImpsReq</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683052644"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052600"><span class="hs-identifier hs-var">implicit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeImplicitImpsReq"><span class="hs-identifier hs-var">safeImplicitImpsReq</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683052644"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>    </span><span id="local-6989586621683052676"><span class="annot"><a href="#local-6989586621683052676"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052677"><span class="annot"><a href="#local-6989586621683052677"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683052676"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span id="local-6989586621683052679"><span class="annot"><a href="#local-6989586621683052679"><span class="hs-identifier hs-var hs-var">other_home_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Set UnitId
</span><a href="GHC.Driver.Env.html#hsc_all_home_unit_ids"><span class="hs-identifier hs-var">hsc_all_home_unit_ids</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683052676"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-414"></span><span>        </span><span id="local-6989586621683052681"><span class="annot"><a href="#local-6989586621683052681"><span class="hs-identifier hs-var hs-var">imv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imv_name :: ModuleName
</span><a href="GHC.Unit.Module.Imported.html#imv_name"><span class="hs-identifier hs-var">imv_name</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; ModuleName
</span><a href="GHC.Types.Name.Reader.html#is_as"><span class="hs-identifier hs-var">is_as</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683052656"><span class="hs-identifier hs-var">imp_spec</span></a></span><span>
</span><span id="line-416"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imv_span :: SrcSpan
</span><a href="GHC.Unit.Module.Imported.html#imv_span"><span class="hs-identifier hs-var">imv_span</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683052585"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-417"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imv_is_safe :: Bool
</span><a href="GHC.Unit.Module.Imported.html#imv_is_safe"><span class="hs-identifier hs-var">imv_is_safe</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052673"><span class="hs-identifier hs-var">mod_safe'</span></a></span><span>
</span><span id="line-418"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imv_is_hiding :: Bool
</span><a href="GHC.Unit.Module.Imported.html#imv_is_hiding"><span class="hs-identifier hs-var">imv_is_hiding</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052671"><span class="hs-identifier hs-var">is_hiding</span></a></span><span>
</span><span id="line-419"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imv_all_exports :: GlobalRdrEnv
</span><a href="GHC.Unit.Module.Imported.html#imv_all_exports"><span class="hs-identifier hs-var">imv_all_exports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052669"><span class="hs-identifier hs-var">potential_gres</span></a></span><span>
</span><span id="line-420"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imv_qualified :: Bool
</span><a href="GHC.Unit.Module.Imported.html#imv_qualified"><span class="hs-identifier hs-var">imv_qualified</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052616"><span class="hs-identifier hs-var">qual_only</span></a></span><span>
</span><span id="line-421"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-422"></span><span>        </span><span id="local-6989586621683052689"><span class="annot"><a href="#local-6989586621683052689"><span class="hs-identifier hs-var hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit
-&gt; Set UnitId
-&gt; ModIface
-&gt; Bool
-&gt; IsBootInterface
-&gt; ImportedBy
-&gt; ImportAvails
</span><a href="GHC.Rename.Names.html#calculateAvails"><span class="hs-identifier hs-var">calculateAvails</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683052677"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683052679"><span class="hs-identifier hs-var">other_home_units</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052640"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052673"><span class="hs-identifier hs-var">mod_safe'</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683052592"><span class="hs-identifier hs-var">want_boot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedModsVal -&gt; ImportedBy
</span><a href="GHC.Unit.Module.Imported.html#ImportedByUser"><span class="hs-identifier hs-var">ImportedByUser</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621683052681"><span class="hs-identifier hs-var">imv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- Complain if we import a deprecated module</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Iface.Syntax.html#fromIfaceWarnings"><span class="hs-identifier hs-type">fromIfaceWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_warns"><span class="hs-identifier hs-var">mi_warns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-426"></span><span>       </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html#WarnAll"><span class="hs-identifier hs-type">WarnAll</span></a></span><span> </span><span id="local-6989586621683052693"><span class="annot"><span class="annottext">WarningTxt GhcRn
</span><a href="#local-6989586621683052693"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">addDiagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; WarningTxt GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnDeprecatedModule"><span class="hs-identifier hs-var">TcRnDeprecatedModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052618"><span class="hs-identifier hs-var">imp_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">WarningTxt GhcRn
</span><a href="#local-6989586621683052693"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>       </span><span class="annot"><span class="annottext">Warnings GhcRn
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052695"><span class="annot"><a href="#local-6989586621683052695"><span class="hs-identifier hs-var hs-var">new_imp_decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span>
</span><span id="line-430"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ideclExt :: XCImportDecl GhcRn
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclExt"><span class="hs-identifier hs-var">ideclExt</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed) -&gt; XCImportDecl (GhcPass 'Parsed)
forall pass. ImportDecl pass -&gt; XCImportDecl pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclExt"><span class="hs-identifier hs-var">ideclExt</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052586"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-431"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclName :: XRec GhcRn ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed) -&gt; XRec (GhcPass 'Parsed) ModuleName
forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052586"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-432"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclPkgQual :: ImportDeclPkgQual GhcRn
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclPkgQual"><span class="hs-identifier hs-var">ideclPkgQual</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDeclPkgQual GhcRn
PkgQual
</span><a href="#local-6989586621683052627"><span class="hs-identifier hs-var">pkg_qual</span></a></span><span>
</span><span id="line-433"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclSource :: IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclSource"><span class="hs-identifier hs-var">ideclSource</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed) -&gt; IsBootInterface
forall pass. ImportDecl pass -&gt; IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclSource"><span class="hs-identifier hs-var">ideclSource</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052586"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-434"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclSafe :: Bool
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclSafe"><span class="hs-identifier hs-var">ideclSafe</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052673"><span class="hs-identifier hs-var">mod_safe'</span></a></span><span>
</span><span id="line-435"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclQualified :: ImportDeclQualifiedStyle
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclQualified"><span class="hs-identifier hs-var">ideclQualified</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed) -&gt; ImportDeclQualifiedStyle
forall pass. ImportDecl pass -&gt; ImportDeclQualifiedStyle
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclQualified"><span class="hs-identifier hs-var">ideclQualified</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052586"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-436"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclAs :: Maybe (XRec GhcRn ModuleName)
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclAs"><span class="hs-identifier hs-var">ideclAs</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed)
-&gt; Maybe (XRec (GhcPass 'Parsed) ModuleName)
forall pass. ImportDecl pass -&gt; Maybe (XRec pass ModuleName)
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclAs"><span class="hs-identifier hs-var">ideclAs</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052586"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-437"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclImportList :: Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
Maybe
  (ImportListInterpretation,
   LocatedLI [GenLocated SrcSpanAnnA (IE GhcRn)])
</span><a href="#local-6989586621683052665"><span class="hs-identifier hs-var">new_imp_details</span></a></span><span>
</span><span id="line-438"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052585"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052695"><span class="hs-identifier hs-type">new_imp_decl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ImpUserSpec"><span class="hs-identifier hs-type">ImpUserSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052656"><span class="hs-identifier hs-type">imp_spec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052666"><span class="hs-identifier hs-type">imp_user_list</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052667"><span class="hs-identifier hs-type">gbl_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-441"></span><span>            </span><span class="annot"><a href="#local-6989586621683052689"><span class="hs-identifier hs-type">imports</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_defaults"><span class="hs-identifier hs-var">mi_defaults</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_hpc"><span class="hs-identifier hs-var">mi_hpc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052640"><span class="hs-identifier hs-type">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><span class="hs-comment">-- | Rename raw package imports</span></span><span>
</span><span id="line-445"></span><span class="annot"><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier hs-type">renameRawPkgQual</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#RawPkgQual"><span class="hs-identifier hs-type">RawPkgQual</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span>
</span><span id="line-446"></span><span id="renameRawPkgQual"><span class="annot"><span class="annottext">renameRawPkgQual :: UnitEnv -&gt; ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier hs-var hs-var">renameRawPkgQual</span></a></span></span><span> </span><span id="local-6989586621683052699"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052699"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621683052700"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052700"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><span class="annottext">RawPkgQual
</span><a href="GHC.Types.PkgQual.html#NoRawPkgQual"><span class="hs-identifier hs-var">NoRawPkgQual</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><a href="GHC.Types.PkgQual.html#RawPkgQual"><span class="hs-identifier hs-type">RawPkgQual</span></a></span><span> </span><span id="local-6989586621683052701"><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621683052701"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; ModuleName -&gt; Maybe FastString -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renamePkgQual"><span class="hs-identifier hs-var">renamePkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052699"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052700"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Maybe FastString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StringLiteral -&gt; FastString
</span><a href="GHC.Types.SourceText.html#sl_fs"><span class="hs-identifier hs-var">sl_fs</span></a></span><span> </span><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621683052701"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="annot"><span class="hs-comment">-- | Rename raw package imports</span></span><span>
</span><span id="line-451"></span><span class="annot"><a href="GHC.Rename.Names.html#renamePkgQual"><span class="hs-identifier hs-type">renamePkgQual</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span>
</span><span id="line-452"></span><span id="renamePkgQual"><span class="annot"><span class="annottext">renamePkgQual :: UnitEnv -&gt; ModuleName -&gt; Maybe FastString -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renamePkgQual"><span class="hs-identifier hs-var hs-var">renamePkgQual</span></a></span></span><span> </span><span id="local-6989586621683052703"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052703"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621683052704"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052704"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621683052705"><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621683052705"><span class="hs-identifier hs-var">mb_pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621683052705"><span class="hs-identifier hs-var">mb_pkg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><span class="annottext">Maybe FastString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span>
</span><span id="line-454"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683052706"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683052706"><span class="hs-identifier hs-var">pkg_fs</span></a></span></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683052707"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052707"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; UnitId
forall u. GenHomeUnit u -&gt; UnitId
</span><a href="GHC.Unit.Home.html#homeUnitId"><span class="hs-identifier hs-var">homeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeUnit -&gt; UnitId) -&gt; Maybe HomeUnit -&gt; Maybe UnitId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Unit.Env.html#ue_homeUnit"><span class="hs-identifier hs-var">ue_homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052703"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683052706"><span class="hs-identifier hs-var">pkg_fs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;this&quot;</span></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; PkgQual
</span><a href="GHC.Types.PkgQual.html#ThisPkg"><span class="hs-identifier hs-var">ThisPkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052707"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052711"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052711"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((UnitId, Maybe FastString) -&gt; Bool)
-&gt; [(UnitId, Maybe FastString)] -&gt; Maybe (UnitId, Maybe FastString)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool)
-&gt; ((UnitId, Maybe FastString) -&gt; Maybe Bool)
-&gt; (UnitId, Maybe FastString)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; Bool) -&gt; Maybe FastString -&gt; Maybe Bool
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683052706"><span class="hs-identifier hs-var">pkg_fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe FastString -&gt; Maybe Bool)
-&gt; ((UnitId, Maybe FastString) -&gt; Maybe FastString)
-&gt; (UnitId, Maybe FastString)
-&gt; Maybe Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(UnitId, Maybe FastString) -&gt; Maybe FastString
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(UnitId, Maybe FastString)]
</span><a href="#local-6989586621683052714"><span class="hs-identifier hs-var">home_names</span></a></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; PkgQual
</span><a href="GHC.Types.PkgQual.html#ThisPkg"><span class="hs-identifier hs-var">ThisPkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052711"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683052715"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052715"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; ModuleName -&gt; PackageName -&gt; Maybe UnitId
</span><a href="GHC.Unit.State.html#resolvePackageImport"><span class="hs-identifier hs-var">resolvePackageImport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; UnitState
UnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#ue_units"><span class="hs-identifier hs-var">ue_units</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052703"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683052704"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; PackageName
</span><a href="GHC.Unit.Info.html#PackageName"><span class="hs-identifier hs-var">PackageName</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683052706"><span class="hs-identifier hs-var">pkg_fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; PkgQual
</span><a href="GHC.Types.PkgQual.html#OtherPkg"><span class="hs-identifier hs-var">OtherPkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052715"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; PkgQual
</span><a href="GHC.Types.PkgQual.html#OtherPkg"><span class="hs-identifier hs-var">OtherPkg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; UnitId
</span><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-var">UnitId</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683052706"><span class="hs-identifier hs-var">pkg_fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>       </span><span class="hs-comment">-- not really correct as pkg_fs is unlikely to be a valid unit-id but</span><span>
</span><span id="line-468"></span><span>       </span><span class="hs-comment">-- we will report the failure later...</span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-470"></span><span>    </span><span id="local-6989586621683052714"><span class="annot"><span class="annottext">home_names :: [(UnitId, Maybe FastString)]
</span><a href="#local-6989586621683052714"><span class="hs-identifier hs-var hs-var">home_names</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; (UnitId, Maybe FastString))
-&gt; [UnitId] -&gt; [(UnitId, Maybe FastString)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683052720"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052720"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052720"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; Maybe String -&gt; Maybe FastString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.DynFlags.html#thisPackageName"><span class="hs-identifier hs-var">thisPackageName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitId -&gt; UnitEnv -&gt; HomeUnitEnv
UnitId -&gt; UnitEnv -&gt; HomeUnitEnv
</span><a href="GHC.Unit.Env.html#ue_findHomeUnitEnv"><span class="hs-identifier hs-var">ue_findHomeUnitEnv</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052720"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052703"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621683052725"><span class="hs-identifier hs-var">hpt_deps</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>    </span><span id="local-6989586621683052726"><span class="annot"><span class="annottext">units :: UnitState
</span><a href="#local-6989586621683052726"><span class="hs-identifier hs-var hs-var">units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; UnitState
UnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#ue_units"><span class="hs-identifier hs-var">ue_units</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683052703"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>    </span><span class="annot"><a href="#local-6989586621683052725"><span class="hs-identifier hs-type">hpt_deps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-475"></span><span>    </span><span id="local-6989586621683052725"><span class="annot"><span class="annottext">hpt_deps :: [UnitId]
</span><a href="#local-6989586621683052725"><span class="hs-identifier hs-var hs-var">hpt_deps</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#homeUnitDepends"><span class="hs-identifier hs-var">homeUnitDepends</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683052726"><span class="hs-identifier hs-var">units</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- | Calculate the 'ImportAvails' induced by an import of a particular</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- interface, but without 'imp_mods'.</span><span>
</span><span id="line-480"></span><span class="annot"><a href="GHC.Rename.Names.html#calculateAvails"><span class="hs-identifier hs-type">calculateAvails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span>
</span><span id="line-481"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-482"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-483"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#IsSafeImport"><span class="hs-identifier hs-type">IsSafeImport</span></a></span><span>
</span><span id="line-484"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span>
</span><span id="line-485"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Imported.html#ImportedBy"><span class="hs-identifier hs-type">ImportedBy</span></a></span><span>
</span><span id="line-486"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span>
</span><span id="line-487"></span><span id="calculateAvails"><span class="annot"><span class="annottext">calculateAvails :: HomeUnit
-&gt; Set UnitId
-&gt; ModIface
-&gt; Bool
-&gt; IsBootInterface
-&gt; ImportedBy
-&gt; ImportAvails
</span><a href="GHC.Rename.Names.html#calculateAvails"><span class="hs-identifier hs-var hs-var">calculateAvails</span></a></span></span><span> </span><span id="local-6989586621683052730"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683052730"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span id="local-6989586621683052731"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683052731"><span class="hs-identifier hs-var">other_home_units</span></a></span></span><span> </span><span id="local-6989586621683052732"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683052733"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052733"><span class="hs-identifier hs-var">mod_safe'</span></a></span></span><span> </span><span id="local-6989586621683052734"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683052734"><span class="hs-identifier hs-var">want_boot</span></a></span></span><span> </span><span id="local-6989586621683052735"><span class="annot"><span class="annottext">ImportedBy
</span><a href="#local-6989586621683052735"><span class="hs-identifier hs-var">imported_by</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-488"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052736"><span class="annot"><span class="annottext">imp_mod :: Module
</span><a href="#local-6989586621683052736"><span class="hs-identifier hs-var hs-var">imp_mod</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-489"></span><span>      </span><span id="local-6989586621683052737"><span class="annot"><span class="annottext">imp_sem_mod :: Module
</span><a href="#local-6989586621683052737"><span class="hs-identifier hs-var hs-var">imp_sem_mod</span></a></span></span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_semantic_module"><span class="hs-identifier hs-var">mi_semantic_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-490"></span><span>      </span><span id="local-6989586621683052739"><span class="annot"><span class="annottext">orph_iface :: Bool
</span><a href="#local-6989586621683052739"><span class="hs-identifier hs-var hs-var">orph_iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Bool
</span><a href="GHC.Unit.Module.ModIface.html#mi_orphan"><span class="hs-identifier hs-var">mi_orphan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_final_exts"><span class="hs-identifier hs-var">mi_final_exts</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>      </span><span id="local-6989586621683052742"><span class="annot"><span class="annottext">has_finsts :: Bool
</span><a href="#local-6989586621683052742"><span class="hs-identifier hs-var hs-var">has_finsts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Bool
</span><a href="GHC.Unit.Module.ModIface.html#mi_finsts"><span class="hs-identifier hs-var">mi_finsts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_final_exts"><span class="hs-identifier hs-var">mi_final_exts</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>      </span><span id="local-6989586621683052744"><span class="annot"><span class="annottext">deps :: Dependencies
</span><a href="#local-6989586621683052744"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Dependencies
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Dependencies
</span><a href="GHC.Unit.Module.ModIface.html#mi_deps"><span class="hs-identifier hs-var">mi_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-493"></span><span>      </span><span id="local-6989586621683052746"><span class="annot"><span class="annottext">trust :: SafeHaskellMode
</span><a href="#local-6989586621683052746"><span class="hs-identifier hs-var hs-var">trust</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceTrustInfo -&gt; SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#getSafeMode"><span class="hs-identifier hs-var">getSafeMode</span></a></span><span> </span><span class="annot"><span class="annottext">(IfaceTrustInfo -&gt; SafeHaskellMode)
-&gt; IfaceTrustInfo -&gt; SafeHaskellMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IfaceTrustInfo
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; IfaceTrustInfo
</span><a href="GHC.Unit.Module.ModIface.html#mi_trust"><span class="hs-identifier hs-var">mi_trust</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-494"></span><span>      </span><span id="local-6989586621683052749"><span class="annot"><span class="annottext">trust_pkg :: Bool
</span><a href="#local-6989586621683052749"><span class="hs-identifier hs-var hs-var">trust_pkg</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Bool
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Bool
</span><a href="GHC.Unit.Module.ModIface.html#mi_trust_pkg"><span class="hs-identifier hs-var">mi_trust_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-495"></span><span>      </span><span id="local-6989586621683052751"><span class="annot"><span class="annottext">is_sig :: Bool
</span><a href="#local-6989586621683052751"><span class="hs-identifier hs-var hs-var">is_sig</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; HscSource
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; HscSource
</span><a href="GHC.Unit.Module.ModIface.html#mi_hsc_src"><span class="hs-identifier hs-var">mi_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>      </span><span class="hs-comment">-- If the module exports anything defined in this module, just</span><span>
</span><span id="line-498"></span><span>      </span><span class="hs-comment">-- ignore it.  Reason: otherwise it looks as if there are two</span><span>
</span><span id="line-499"></span><span>      </span><span class="hs-comment">-- local definition sites for the thing, and an error gets</span><span>
</span><span id="line-500"></span><span>      </span><span class="hs-comment">-- reported.  Easiest thing is just to filter them out up</span><span>
</span><span id="line-501"></span><span>      </span><span class="hs-comment">-- front. This situation only arises if a module imports</span><span>
</span><span id="line-502"></span><span>      </span><span class="hs-comment">-- itself, or another module that imported it.  (Necessarily,</span><span>
</span><span id="line-503"></span><span>      </span><span class="hs-comment">-- this involves a loop.)</span><span>
</span><span id="line-504"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-505"></span><span>      </span><span class="hs-comment">-- We do this *after* filterImports, so that if you say</span><span>
</span><span id="line-506"></span><span>      </span><span class="hs-comment">--      module A where</span><span>
</span><span id="line-507"></span><span>      </span><span class="hs-comment">--         import B( AType )</span><span>
</span><span id="line-508"></span><span>      </span><span class="hs-comment">--         type AType = ...</span><span>
</span><span id="line-509"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-510"></span><span>      </span><span class="hs-comment">--      module B( AType ) where</span><span>
</span><span id="line-511"></span><span>      </span><span class="hs-comment">--         import {-# SOURCE #-} A( AType )</span><span>
</span><span id="line-512"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-513"></span><span>      </span><span class="hs-comment">-- then you won't get a 'B does not export AType' message.</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-comment">-- Compute new transitive dependencies</span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-518"></span><span>      </span><span class="hs-comment">-- 'dep_orphs' and 'dep_finsts' do NOT include the imported module</span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-comment">-- itself, but we DO need to include this module in 'imp_orphs' and</span><span>
</span><span id="line-520"></span><span>      </span><span class="hs-comment">-- 'imp_finsts' if it defines an orphan or instance family; thus the</span><span>
</span><span id="line-521"></span><span>      </span><span class="hs-comment">-- orph_iface/has_iface tests.</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>      </span><span id="local-6989586621683052754"><span class="annot"><span class="annottext">deporphs :: [Module]
</span><a href="#local-6989586621683052754"><span class="hs-identifier hs-var hs-var">deporphs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; [Module]
</span><a href="GHC.Unit.Module.Deps.html#dep_orphs"><span class="hs-identifier hs-var">dep_orphs</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683052744"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-524"></span><span>      </span><span id="local-6989586621683052756"><span class="annot"><span class="annottext">depfinsts :: [Module]
</span><a href="#local-6989586621683052756"><span class="hs-identifier hs-var hs-var">depfinsts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; [Module]
</span><a href="GHC.Unit.Module.Deps.html#dep_finsts"><span class="hs-identifier hs-var">dep_finsts</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683052744"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>      </span><span id="local-6989586621683052758"><span class="annot"><span class="annottext">orphans :: [Module]
</span><a href="#local-6989586621683052758"><span class="hs-identifier hs-var hs-var">orphans</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052739"><span class="hs-identifier hs-var">orph_iface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [Module] -&gt; [Module]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052737"><span class="hs-identifier hs-var">imp_sem_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Module] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052754"><span class="hs-identifier hs-var">deporphs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052737"><span class="hs-identifier hs-var">imp_sem_mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052754"><span class="hs-identifier hs-var">deporphs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Module] -&gt; [Module]) -&gt; [Module] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-527"></span><span>                             </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052737"><span class="hs-identifier hs-var">imp_sem_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Module] -&gt; [Module]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052754"><span class="hs-identifier hs-var">deporphs</span></a></span><span>
</span><span id="line-528"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052754"><span class="hs-identifier hs-var">deporphs</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>      </span><span id="local-6989586621683052761"><span class="annot"><span class="annottext">finsts :: [Module]
</span><a href="#local-6989586621683052761"><span class="hs-identifier hs-var hs-var">finsts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052742"><span class="hs-identifier hs-var">has_finsts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [Module] -&gt; [Module]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052737"><span class="hs-identifier hs-var">imp_sem_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Module] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052756"><span class="hs-identifier hs-var">depfinsts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052737"><span class="hs-identifier hs-var">imp_sem_mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052756"><span class="hs-identifier hs-var">depfinsts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Module] -&gt; [Module]) -&gt; [Module] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-531"></span><span>                            </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052737"><span class="hs-identifier hs-var">imp_sem_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Module] -&gt; [Module]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052756"><span class="hs-identifier hs-var">depfinsts</span></a></span><span>
</span><span id="line-532"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052756"><span class="hs-identifier hs-var">depfinsts</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span>      </span><span class="hs-comment">-- Trusted packages are a lot like orphans.</span><span>
</span><span id="line-535"></span><span>      </span><span id="local-6989586621683052762"><span class="annot"><span class="annottext">trusted_pkgs :: Set UnitId
</span><a href="#local-6989586621683052762"><span class="hs-identifier hs-var hs-var">trusted_pkgs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052733"><span class="hs-identifier hs-var">mod_safe'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#dep_trusted_pkgs"><span class="hs-identifier hs-var">dep_trusted_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683052744"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-536"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>      </span><span id="local-6989586621683052765"><span class="annot"><span class="annottext">pkg :: GenUnit UnitId
</span><a href="#local-6989586621683052765"><span class="hs-identifier hs-var hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>      </span><span id="local-6989586621683052767"><span class="annot"><span class="annottext">ipkg :: UnitId
</span><a href="#local-6989586621683052767"><span class="hs-identifier hs-var hs-var">ipkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621683052765"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-comment">-- Does this import mean we now require our own pkg</span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-comment">-- to be trusted? See Note [Trust Own Package]</span><span>
</span><span id="line-544"></span><span>      </span><span id="local-6989586621683052769"><span class="annot"><span class="annottext">ptrust :: Bool
</span><a href="#local-6989586621683052769"><span class="hs-identifier hs-var hs-var">ptrust</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621683052746"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052749"><span class="hs-identifier hs-var">trust_pkg</span></a></span><span>
</span><span id="line-545"></span><span>      </span><span id="local-6989586621683052771"><span class="annot"><span class="annottext">pkg_trust_req :: Bool
</span><a href="#local-6989586621683052771"><span class="hs-identifier hs-var hs-var">pkg_trust_req</span></a></span></span><span>
</span><span id="line-546"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; GenUnit UnitId -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeUnit"><span class="hs-identifier hs-var">isHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683052730"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621683052765"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052769"><span class="hs-identifier hs-var">ptrust</span></a></span><span>
</span><span id="line-547"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span>      </span><span id="local-6989586621683052773"><span class="annot"><span class="annottext">dependent_pkgs :: Set UnitId
</span><a href="#local-6989586621683052773"><span class="hs-identifier hs-var hs-var">dependent_pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621683052765"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683052731"><span class="hs-identifier hs-var">other_home_units</span></a></span><span>
</span><span id="line-550"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Set UnitId
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-551"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId
forall a. a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621683052767"><span class="hs-identifier hs-var">ipkg</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>      </span><span id="local-6989586621683052776"><span class="annot"><span class="annottext">direct_mods :: InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052776"><span class="hs-identifier hs-var hs-var">direct_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (UnitId, GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="GHC.Tc.Types.html#mkModDeps"><span class="hs-identifier hs-var">mkModDeps</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (UnitId, GenWithIsBoot ModuleName)
 -&gt; InstalledModuleEnv (GenWithIsBoot ModuleName))
-&gt; Set (UnitId, GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621683052765"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683052731"><span class="hs-identifier hs-var">other_home_units</span></a></span><span>
</span><span id="line-554"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(UnitId, GenWithIsBoot ModuleName)
-&gt; Set (UnitId, GenWithIsBoot ModuleName)
forall a. a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052736"><span class="hs-identifier hs-var">imp_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; GenWithIsBoot ModuleName
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052736"><span class="hs-identifier hs-var">imp_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683052734"><span class="hs-identifier hs-var">want_boot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set (UnitId, GenWithIsBoot ModuleName)
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>      </span><span id="local-6989586621683052779"><span class="annot"><span class="annottext">dep_boot_mods_map :: InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052779"><span class="hs-identifier hs-var hs-var">dep_boot_mods_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (UnitId, GenWithIsBoot ModuleName)
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="GHC.Tc.Types.html#mkModDeps"><span class="hs-identifier hs-var">mkModDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependencies -&gt; Set (UnitId, GenWithIsBoot ModuleName)
</span><a href="GHC.Unit.Module.Deps.html#dep_boot_mods"><span class="hs-identifier hs-var">dep_boot_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683052744"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>      </span><span id="local-6989586621683052781"><span class="annot"><span class="annottext">boot_mods :: InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052781"><span class="hs-identifier hs-var hs-var">boot_mods</span></a></span></span><span>
</span><span id="line-560"></span><span>        </span><span class="hs-comment">-- If we are looking for a boot module, it must be HPT</span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683052734"><span class="hs-identifier hs-var">want_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
-&gt; InstalledModule
-&gt; GenWithIsBoot ModuleName
-&gt; InstalledModuleEnv (GenWithIsBoot ModuleName)
forall a.
InstalledModuleEnv a
-&gt; InstalledModule -&gt; a -&gt; InstalledModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#extendInstalledModuleEnv"><span class="hs-identifier hs-var">extendInstalledModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052779"><span class="hs-identifier hs-var">dep_boot_mods_map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; UnitId) -&gt; Module -&gt; InstalledModule
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052736"><span class="hs-identifier hs-var">imp_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; GenWithIsBoot ModuleName
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052736"><span class="hs-identifier hs-var">imp_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-comment">-- Now we are importing A properly, so don't go looking for</span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-comment">-- A.hs-boot</span><span>
</span><span id="line-564"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; GenUnit UnitId -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeUnit"><span class="hs-identifier hs-var">isHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683052730"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621683052765"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052779"><span class="hs-identifier hs-var">dep_boot_mods_map</span></a></span><span>
</span><span id="line-565"></span><span>        </span><span class="hs-comment">-- There's no boot files to find in external imports</span><span>
</span><span id="line-566"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
forall a. InstalledModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#emptyInstalledModuleEnv"><span class="hs-identifier hs-var">emptyInstalledModuleEnv</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span>      </span><span id="local-6989586621683052783"><span class="annot"><span class="annottext">sig_mods :: [ModuleName]
</span><a href="#local-6989586621683052783"><span class="hs-identifier hs-var hs-var">sig_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052751"><span class="hs-identifier hs-var">is_sig</span></a></span><span>
</span><span id="line-570"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683052736"><span class="hs-identifier hs-var">imp_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModuleName] -&gt; [ModuleName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; [ModuleName]
</span><a href="GHC.Unit.Module.Deps.html#dep_sig_mods"><span class="hs-identifier hs-var">dep_sig_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683052744"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-571"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; [ModuleName]
</span><a href="GHC.Unit.Module.Deps.html#dep_sig_mods"><span class="hs-identifier hs-var">dep_sig_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621683052744"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-575"></span><span>          </span><span class="annot"><span class="annottext">imp_mods :: ImportedMods
</span><a href="GHC.Unit.Module.Deps.html#imp_mods"><span class="hs-identifier hs-var">imp_mods</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; [ImportedBy] -&gt; ImportedMods
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683052732"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ImportedBy
</span><a href="#local-6989586621683052735"><span class="hs-identifier hs-var">imported_by</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-576"></span><span>          </span><span class="annot"><span class="annottext">imp_orphs :: [Module]
</span><a href="GHC.Unit.Module.Deps.html#imp_orphs"><span class="hs-identifier hs-var">imp_orphs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052758"><span class="hs-identifier hs-var">orphans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-577"></span><span>          </span><span class="annot"><span class="annottext">imp_finsts :: [Module]
</span><a href="GHC.Unit.Module.Deps.html#imp_finsts"><span class="hs-identifier hs-var">imp_finsts</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683052761"><span class="hs-identifier hs-var">finsts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-578"></span><span>          </span><span class="annot"><span class="annottext">imp_sig_mods :: [ModuleName]
</span><a href="GHC.Unit.Module.Deps.html#imp_sig_mods"><span class="hs-identifier hs-var">imp_sig_mods</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621683052783"><span class="hs-identifier hs-var">sig_mods</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-579"></span><span>          </span><span class="annot"><span class="annottext">imp_direct_dep_mods :: InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="GHC.Unit.Module.Deps.html#imp_direct_dep_mods"><span class="hs-identifier hs-var">imp_direct_dep_mods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052776"><span class="hs-identifier hs-var">direct_mods</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-580"></span><span>          </span><span class="annot"><span class="annottext">imp_dep_direct_pkgs :: Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#imp_dep_direct_pkgs"><span class="hs-identifier hs-var">imp_dep_direct_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683052773"><span class="hs-identifier hs-var">dependent_pkgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-581"></span><span>          </span><span class="annot"><span class="annottext">imp_boot_mods :: InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="GHC.Unit.Module.Deps.html#imp_boot_mods"><span class="hs-identifier hs-var">imp_boot_mods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv (GenWithIsBoot ModuleName)
</span><a href="#local-6989586621683052781"><span class="hs-identifier hs-var">boot_mods</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>          </span><span class="hs-comment">-- Add in the imported modules trusted package</span><span>
</span><span id="line-584"></span><span>          </span><span class="hs-comment">-- requirements. ONLY do this though if we import the</span><span>
</span><span id="line-585"></span><span>          </span><span class="hs-comment">-- module as a safe import.</span><span>
</span><span id="line-586"></span><span>          </span><span class="hs-comment">-- See Note [Tracking Trust Transitively]</span><span>
</span><span id="line-587"></span><span>          </span><span class="hs-comment">-- and Note [Trust Transitive Property]</span><span>
</span><span id="line-588"></span><span>          </span><span class="annot"><span class="annottext">imp_trust_pkgs :: Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621683052762"><span class="hs-identifier hs-var">trusted_pkgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-589"></span><span>          </span><span class="hs-comment">-- Do we require our own pkg to be trusted?</span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-comment">-- See Note [Trust Own Package]</span><span>
</span><span id="line-591"></span><span>          </span><span class="annot"><span class="annottext">imp_trust_own_pkg :: Bool
</span><a href="GHC.Unit.Module.Deps.html#imp_trust_own_pkg"><span class="hs-identifier hs-var">imp_trust_own_pkg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052771"><span class="hs-identifier hs-var">pkg_trust_req</span></a></span><span>
</span><span id="line-592"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{importsFromLocalDecls}
*                                                                      *
************************************************************************

From the top-level declarations of this module produce
        * the lexical environment
        * the ImportAvails
created by its bindings.

Note [Top-level Names in Template Haskell decl quotes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also: Note [Interactively-bound Ids in GHCi] in GHC.Driver.Env
          Note [Looking up Exact RdrNames] in GHC.Rename.Env

Consider a Template Haskell declaration quotation like this:
      module M where
        f x = h [d| f = 3 |]
When renaming the declarations inside [d| ...|], we treat the
top level binders specially in two ways

1.  We give them an Internal Name, not (as usual) an External one.
    This is done by GHC.Rename.Env.newTopSrcBinder.

2.  We make them *shadow* the outer bindings.
    See Note [GlobalRdrEnv shadowing]

3. We find out whether we are inside a [d| ... |] by testing the TH
   stage. This is a slight hack, because the stage field was really
   meant for the type checker, and here we are not interested in the
   fields of Brack, hence the error thunks in thRnBrack.
-}</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span class="annot"><a href="GHC.Rename.Names.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-type">extendGlobalRdrEnvRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-631"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a></span><span>
</span><span id="line-632"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span class="hs-comment">-- Updates both the GlobalRdrEnv and the FixityEnv</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- We return a new TcLclEnv only because we might have to</span><span>
</span><span id="line-635"></span><span class="hs-comment">-- delete some bindings from it;</span><span>
</span><span id="line-636"></span><span class="hs-comment">-- see Note [Top-level Names in Template Haskell decl quotes]</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span id="extendGlobalRdrEnvRn"><span class="annot"><span class="annottext">extendGlobalRdrEnvRn :: [GlobalRdrElt] -&gt; MiniFixityEnv -&gt; RnM (TcGblEnv, TcLclEnv)
</span><a href="GHC.Rename.Names.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-var hs-var">extendGlobalRdrEnvRn</span></a></span></span><span> </span><span id="local-6989586621683052791"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052791"><span class="hs-identifier hs-var">new_gres</span></a></span></span><span> </span><span id="local-6989586621683052792"><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683052792"><span class="hs-identifier hs-var">new_fixities</span></a></span></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RnM (TcGblEnv, TcLclEnv) -&gt; RnM (TcGblEnv, TcLclEnv)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(RnM (TcGblEnv, TcLclEnv) -&gt; RnM (TcGblEnv, TcLclEnv))
-&gt; RnM (TcGblEnv, TcLclEnv) -&gt; RnM (TcGblEnv, TcLclEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- See Note [Fail fast on duplicate definitions]</span><span>
</span><span id="line-640"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052794"><span class="annot"><a href="#local-6989586621683052794"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052795"><span class="annot"><a href="#local-6989586621683052795"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM (TcGblEnv, TcLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span>
</span><span id="line-641"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052797"><span class="annot"><a href="#local-6989586621683052797"><span class="hs-identifier hs-var">stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-type">getStage</span></a></span><span>
</span><span id="line-642"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052799"><span class="annot"><a href="#local-6989586621683052799"><span class="hs-identifier hs-var">isGHCi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier hs-type">getIsGHCi</span></a></span><span>
</span><span id="line-643"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052801"><span class="annot"><a href="#local-6989586621683052801"><span class="hs-identifier hs-var hs-var">rdr_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683052794"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-644"></span><span>              </span><span id="local-6989586621683052803"><span class="annot"><a href="#local-6989586621683052803"><span class="hs-identifier hs-var hs-var">fix_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683052794"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-645"></span><span>              </span><span id="local-6989586621683052805"><span class="annot"><a href="#local-6989586621683052805"><span class="hs-identifier hs-var hs-var">th_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; ThBindEnv
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvThBndrs"><span class="hs-identifier hs-var">getLclEnvThBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683052795"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-646"></span><span>              </span><span id="local-6989586621683052807"><span class="annot"><a href="#local-6989586621683052807"><span class="hs-identifier hs-var hs-var">th_lvl</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; Int
</span><a href="GHC.Tc.Types.TH.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621683052797"><span class="hs-identifier hs-var">stage</span></a></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span>              </span><span class="hs-comment">-- Delete new_occs from global and local envs</span><span>
</span><span id="line-649"></span><span>              </span><span class="hs-comment">-- If we are in a TemplateHaskell decl bracket,</span><span>
</span><span id="line-650"></span><span>              </span><span class="hs-comment">--    we are going to shadow them</span><span>
</span><span id="line-651"></span><span>              </span><span class="hs-comment">-- See Note [GlobalRdrEnv shadowing]</span><span>
</span><span id="line-652"></span><span>              </span><span id="local-6989586621683052809"><span class="annot"><a href="#local-6989586621683052809"><span class="hs-identifier hs-var hs-var">inBracket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; Bool
</span><a href="GHC.Tc.Utils.Env.html#isBrackStage"><span class="hs-identifier hs-var">isBrackStage</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621683052797"><span class="hs-identifier hs-var">stage</span></a></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>              </span><span id="local-6989586621683052811"><span class="annot"><a href="#local-6989586621683052811"><span class="hs-identifier hs-var hs-var">lcl_env_TH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclCtxt -&gt; TcLclCtxt) -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#modifyLclCtxt"><span class="hs-identifier hs-var">modifyLclCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683052813"><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621683052813"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621683052813"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_rdr"><span class="hs-identifier hs-var">tcl_rdr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#minusLocalRdrEnv"><span class="hs-identifier hs-type">minusLocalRdrEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_rdr"><span class="hs-identifier hs-var">tcl_rdr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052813"><span class="hs-identifier hs-type">lcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052816"><span class="hs-identifier hs-type">new_gres_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683052795"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-655"></span><span>                           </span><span class="hs-comment">-- See Note [GlobalRdrEnv shadowing]</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>              </span><span id="local-6989586621683052817"><span class="annot"><a href="#local-6989586621683052817"><span class="hs-identifier hs-var hs-var">lcl_env2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052809"><span class="hs-identifier hs-var">inBracket</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683052811"><span class="hs-identifier hs-var">lcl_env_TH</span></a></span><span>
</span><span id="line-658"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683052795"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>              </span><span class="hs-comment">-- Deal with shadowing: see Note [GlobalRdrEnv shadowing]</span><span>
</span><span id="line-661"></span><span>              </span><span id="local-6989586621683052818"><span class="annot"><a href="#local-6989586621683052818"><span class="hs-identifier hs-var hs-var">want_shadowing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052799"><span class="hs-identifier hs-var">isGHCi</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052809"><span class="hs-identifier hs-var">inBracket</span></a></span><span>
</span><span id="line-662"></span><span>              </span><span id="local-6989586621683052819"><span class="annot"><a href="#local-6989586621683052819"><span class="hs-identifier hs-var hs-var">rdr_env1</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052818"><span class="hs-identifier hs-var">want_shadowing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#shadowNames"><span class="hs-identifier hs-var">shadowNames</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052801"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052816"><span class="hs-identifier hs-var">new_gres_env</span></a></span><span>
</span><span id="line-663"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052801"><span class="hs-identifier hs-var">rdr_env</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>              </span><span id="local-6989586621683052821"><span class="annot"><a href="#local-6989586621683052821"><span class="hs-identifier hs-var hs-var">lcl_env3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclCtxt -&gt; TcLclCtxt) -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#modifyLclCtxt"><span class="hs-identifier hs-var">modifyLclCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683052822"><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621683052822"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621683052822"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_th_bndrs"><span class="hs-identifier hs-var">tcl_th_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#extendNameEnvList"><span class="hs-identifier hs-type">extendNameEnvList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052805"><span class="hs-identifier hs-type">th_bndrs</span></a></span><span>
</span><span id="line-666"></span><span>                                                       </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683052825"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#TopLevel"><span class="hs-identifier hs-type">TopLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052807"><span class="hs-identifier hs-type">th_lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>                                                       </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683052825"><span class="annot"><a href="#local-6989586621683052825"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683052827"><span class="hs-identifier hs-type">new_names</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683052817"><span class="hs-identifier hs-var">lcl_env2</span></a></span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052828"><span class="annot"><a href="#local-6989586621683052828"><span class="hs-identifier hs-var">rdr_env2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldlM</span></span><span> </span><span class="annot"><a href="#local-6989586621683052830"><span class="hs-identifier hs-type">add_gre</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052819"><span class="hs-identifier hs-type">rdr_env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052791"><span class="hs-identifier hs-type">new_gres</span></a></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052831"><span class="annot"><a href="#local-6989586621683052831"><span class="hs-identifier hs-var hs-var">fix_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FixityEnv -&gt; GlobalRdrElt -&gt; FixityEnv)
-&gt; FixityEnv -&gt; [GlobalRdrElt] -&gt; FixityEnv
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">FixityEnv -&gt; GlobalRdrElt -&gt; FixityEnv
</span><a href="#local-6989586621683052833"><span class="hs-identifier hs-var">extend_fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683052803"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052791"><span class="hs-identifier hs-var">new_gres</span></a></span><span>
</span><span id="line-672"></span><span>              </span><span id="local-6989586621683052834"><span class="annot"><a href="#local-6989586621683052834"><span class="hs-identifier hs-var hs-var">gbl_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683052794"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683052828"><span class="hs-identifier hs-type">rdr_env2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683052831"><span class="hs-identifier hs-type">fix_env'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;extendGlobalRdrEnvRn 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#pprGlobalRdrEnv"><span class="hs-identifier hs-type">pprGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683052828"><span class="hs-identifier hs-type">rdr_env2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052834"><span class="hs-identifier hs-type">gbl_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052821"><span class="hs-identifier hs-type">lcl_env3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-677"></span><span>    </span><span id="local-6989586621683052827"><span class="annot"><span class="annottext">new_names :: [Name]
</span><a href="#local-6989586621683052827"><span class="hs-identifier hs-var hs-var">new_names</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052791"><span class="hs-identifier hs-var">new_gres</span></a></span><span>
</span><span id="line-678"></span><span>    </span><span id="local-6989586621683052816"><span class="annot"><span class="annottext">new_gres_env :: GlobalRdrEnv
</span><a href="#local-6989586621683052816"><span class="hs-identifier hs-var hs-var">new_gres_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052791"><span class="hs-identifier hs-var">new_gres</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-comment">-- If there is a fixity decl for the gre, add it to the fixity env</span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621683052833"><span class="annot"><span class="annottext">extend_fix_env :: FixityEnv -&gt; GlobalRdrElt -&gt; FixityEnv
</span><a href="#local-6989586621683052833"><span class="hs-identifier hs-var hs-var">extend_fix_env</span></a></span></span><span> </span><span id="local-6989586621683052839"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683052839"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span id="local-6989586621683052840"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052840"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-682"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683052841"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621683052841"><span class="hs-identifier hs-var">fi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv -&gt; Name -&gt; Maybe (Located Fixity)
</span><a href="GHC.Rename.Fixity.html#lookupMiniFixityEnv"><span class="hs-identifier hs-var">lookupMiniFixityEnv</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683052792"><span class="hs-identifier hs-var">new_fixities</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052843"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityEnv -&gt; Name -&gt; FixItem -&gt; FixityEnv
forall a. NameEnv a -&gt; Name -&gt; a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#extendNameEnv"><span class="hs-identifier hs-var">extendNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683052839"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052843"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; Fixity -&gt; FixItem
</span><a href="GHC.Types.Fixity.Env.html#FixItem"><span class="hs-identifier hs-var">FixItem</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683052846"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621683052841"><span class="hs-identifier hs-var">fi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621683052839"><span class="hs-identifier hs-var">fix_env</span></a></span><span>
</span><span id="line-686"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-687"></span><span>        </span><span id="local-6989586621683052843"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683052843"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052840"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-688"></span><span>        </span><span id="local-6989586621683052846"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683052846"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; OccName
forall info. GlobalRdrEltX info -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052840"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><a href="#local-6989586621683052830"><span class="hs-identifier hs-type">add_gre</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-comment">-- Extend the GlobalRdrEnv with a LocalDef GRE</span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-comment">-- If there is already a LocalDef GRE with the same OccName,</span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-comment">--    report an error and discard the new GRE</span><span>
</span><span id="line-694"></span><span>    </span><span class="hs-comment">-- This establishes INVARIANT 1 of GlobalRdrEnvs</span><span>
</span><span id="line-695"></span><span>    </span><span id="local-6989586621683052830"><span class="annot"><span class="annottext">add_gre :: GlobalRdrEnv
-&gt; GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) GlobalRdrEnv
</span><a href="#local-6989586621683052830"><span class="hs-identifier hs-var hs-var">add_gre</span></a></span></span><span> </span><span id="local-6989586621683052848"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052848"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621683052849"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052849"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-696"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052851"><span class="hs-identifier hs-var">dups</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Same OccName defined twice</span><span>
</span><span id="line-697"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#addDupDeclErr"><span class="hs-identifier hs-var">addDupDeclErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052849"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052851"><span class="hs-identifier hs-var">dups</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) GlobalRdrEnv
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052848"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-700"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) GlobalRdrEnv
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; GlobalRdrElt -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#extendGlobalRdrEnv"><span class="hs-identifier hs-var">extendGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052848"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052849"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-702"></span><span>        </span><span class="hs-comment">-- See Note [Reporting duplicate local declarations]</span><span>
</span><span id="line-703"></span><span>        </span><span id="local-6989586621683052851"><span class="annot"><span class="annottext">dups :: [GlobalRdrElt]
</span><a href="#local-6989586621683052851"><span class="hs-identifier hs-var hs-var">dups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683052855"><span class="hs-identifier hs-var">isBadDupGRE</span></a></span><span>
</span><span id="line-704"></span><span>             </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; [GlobalRdrElt])
-&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683052848"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; WhichGREs GREInfo -&gt; LookupGRE GREInfo
forall info. OccName -&gt; WhichGREs info -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupOccName"><span class="hs-identifier hs-var">LookupOccName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; OccName
forall info. GlobalRdrEltX info -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052849"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantBoth"><span class="hs-identifier hs-var">WantBoth</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span>        </span><span id="local-6989586621683052855"><span class="annot"><span class="annottext">isBadDupGRE :: GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683052855"><span class="hs-identifier hs-var hs-var">isBadDupGRE</span></a></span></span><span> </span><span id="local-6989586621683052860"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052860"><span class="hs-identifier hs-var">old_gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052860"><span class="hs-identifier hs-var">old_gre</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; GlobalRdrElt -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#greClashesWith"><span class="hs-identifier hs-var">greClashesWith</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052849"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052860"><span class="hs-identifier hs-var">old_gre</span></a></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">{- Note [Fail fast on duplicate definitions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If there are duplicate bindings for the same thing, we want to fail
fast. Having two bindings for the same thing can cause follow-on errors.
Example (test T9975a):
   data Test = Test { x :: Int }
   pattern Test wat = Test { x = wat }
This defines 'Test' twice.  The second defn has no field-names; and then
we get an error from Test { x=wat }, saying &quot;Test has no field 'x'&quot;.

Easiest thing is to bale out fast on duplicate definitions, which
we do via `checkNoErrs` on `extendGlobalRdrEnvRn`.

Note [Reporting duplicate local declarations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In general, a single module may not define the same OccName multiple times. This
is checked in extendGlobalRdrEnvRn: when adding a new locally-defined GRE to the
GlobalRdrEnv we report an error if there are already duplicates in the
environment.  This establishes INVARIANT 1 (see comments on GlobalRdrEnv in
GHC.Types.Name.Reader), which says that for a given OccName, all the
GlobalRdrElts to which it maps must have distinct 'greName's.

For example, the following will be rejected:

  f x = x
  g x = x
  f x = x  -- Duplicate!

Users are allowed to introduce new GREs with the same OccName as an imported GRE,
as disambiguation is possible through the module system, e.g.:

  module M where
    import N (f)
    f x = x
    g x = M.f x + N.f x

If both GREs are local, the general rule is that two GREs clash if they have
the same OccName, i.e. they share a textual name and live in the same namespace.
However, there are additional clashes due to record fields:

  - a new variable clashes with previously defined record fields
    which define field selectors,

  - a new record field shadows:

    - previously defined variables, if it defines a field selector,
    - previously defined record fields, unless it is a duplicate record field.

This logic is implemented in the function 'GHC.Types.Name.Reader.greClashesWith'.

See also Note [Skipping ambiguity errors at use sites of local declarations] in
GHC.Rename.Utils.
-}</span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
    getLocalDeclBindersd@ returns the names for an HsDecl
             It's used for source code.

        *** See Note [The Naming story] in GHC.Hs.Decls ****
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="annot"><a href="GHC.Rename.Names.html#getLocalNonValBinders"><span class="hs-identifier hs-type">getLocalNonValBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span class="hs-comment">-- Get all the top-level binders bound the group *except*</span><span>
</span><span id="line-774"></span><span class="hs-comment">-- for value bindings, which are treated separately</span><span>
</span><span id="line-775"></span><span class="hs-comment">-- Specifically we return AvailInfo for</span><span>
</span><span id="line-776"></span><span class="hs-comment">--      * type decls (incl constructors and record selectors)</span><span>
</span><span id="line-777"></span><span class="hs-comment">--      * class decls (including class ops)</span><span>
</span><span id="line-778"></span><span class="hs-comment">--      * associated types</span><span>
</span><span id="line-779"></span><span class="hs-comment">--      * foreign imports</span><span>
</span><span id="line-780"></span><span class="hs-comment">--      * value signatures (in hs-boot files only)</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span id="getLocalNonValBinders"><span class="annot"><span class="annottext">getLocalNonValBinders :: MiniFixityEnv
-&gt; HsGroup (GhcPass 'Parsed) -&gt; RnM ((TcGblEnv, TcLclEnv), Defs)
</span><a href="GHC.Rename.Names.html#getLocalNonValBinders"><span class="hs-identifier hs-var hs-var">getLocalNonValBinders</span></a></span></span><span> </span><span id="local-6989586621683052864"><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683052864"><span class="hs-identifier hs-var">fixity_env</span></a></span></span><span>
</span><span id="line-783"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hs_valds :: forall p. HsGroup p -&gt; HsValBinds p
</span><a href="Language.Haskell.Syntax.Decls.html#hs_valds"><span class="hs-identifier hs-var">hs_valds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052867"><span class="annot"><span class="annottext">HsValBinds (GhcPass 'Parsed)
</span><a href="#local-6989586621683052867"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-784"></span><span>                </span><span class="annot"><span class="annottext">hs_tyclds :: forall p. HsGroup p -&gt; [TyClGroup p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_tyclds"><span class="hs-identifier hs-var">hs_tyclds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052869"><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Parsed)]
</span><a href="#local-6989586621683052869"><span class="hs-identifier hs-var">tycl_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-785"></span><span>                </span><span class="annot"><span class="annottext">hs_fords :: forall p. HsGroup p -&gt; [LForeignDecl p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_fords"><span class="hs-identifier hs-var">hs_fords</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052871"><span class="annot"><span class="annottext">[LForeignDecl (GhcPass 'Parsed)]
</span><a href="#local-6989586621683052871"><span class="hs-identifier hs-var">foreign_decls</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Process all type/class decls *except* family instances</span><span>
</span><span id="line-787"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052872"><span class="annot"><span class="annottext">inst_decls :: [GenLocated SrcSpanAnnA (InstDecl (GhcPass 'Parsed))]
</span><a href="#local-6989586621683052872"><span class="hs-identifier hs-var hs-var hs-var">inst_decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Parsed)]
</span><a href="#local-6989586621683052869"><span class="hs-identifier hs-var">tycl_decls</span></a></span><span> </span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Parsed)]
-&gt; (TyClGroup (GhcPass 'Parsed)
    -&gt; [GenLocated SrcSpanAnnA (InstDecl (GhcPass 'Parsed))])
-&gt; [GenLocated SrcSpanAnnA (InstDecl (GhcPass 'Parsed))]
forall a b. [a] -&gt; (a -&gt; [b]) -&gt; [b]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">TyClGroup (GhcPass 'Parsed) -&gt; [LInstDecl (GhcPass 'Parsed)]
TyClGroup (GhcPass 'Parsed)
-&gt; [GenLocated SrcSpanAnnA (InstDecl (GhcPass 'Parsed))]
forall pass. TyClGroup pass -&gt; [LInstDecl pass]
</span><a href="Language.Haskell.Syntax.Decls.html#group_instds"><span class="hs-identifier hs-var">group_instds</span></a></span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052874"><span class="annot"><a href="#local-6989586621683052874"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DuplicateRecordFields
</span><a href="GHC.Driver.DynFlags.html#xopt_DuplicateRecordFields"><span class="hs-identifier hs-var">xopt_DuplicateRecordFields</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DuplicateRecordFields)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DynFlags
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DuplicateRecordFields
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052876"><span class="annot"><a href="#local-6989586621683052876"><span class="hs-identifier hs-var">has_sel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#xopt_FieldSelectors"><span class="hs-identifier hs-type">xopt_FieldSelectors</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052878"><span class="annot"><a href="#local-6989586621683052878"><span class="hs-identifier hs-var">tc_gres</span></a></span></span><span>
</span><span id="line-791"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-type">concatMapM</span></a></span><span>
</span><span id="line-792"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052880"><span class="hs-identifier hs-type">new_tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052874"><span class="hs-identifier hs-type">dup_fields_ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052876"><span class="hs-identifier hs-type">has_sel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#tyClGroupTyClDecls"><span class="hs-identifier hs-type">tyClGroupTyClDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052869"><span class="hs-identifier hs-type">tycl_decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;getLocalNonValBinders 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052878"><span class="hs-identifier hs-type">tc_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052882"><span class="annot"><a href="#local-6989586621683052882"><span class="hs-identifier hs-var">envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-type">extendGlobalRdrEnvRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052878"><span class="hs-identifier hs-type">tc_gres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052864"><span class="hs-identifier hs-type">fixity_env</span></a></span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052882"><span class="hs-identifier hs-type">envs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-797"></span><span>            </span><span class="hs-comment">-- Bring these things into scope first</span><span>
</span><span id="line-798"></span><span>            </span><span class="hs-comment">-- See Note [Looking up family names in family instances]</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>          </span><span class="hs-comment">-- Process all family instances</span><span>
</span><span id="line-801"></span><span>          </span><span class="hs-comment">-- to bring new data constructors into scope</span><span>
</span><span id="line-802"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052884"><span class="annot"><a href="#local-6989586621683052884"><span class="hs-identifier hs-var">nti_gress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052886"><span class="hs-identifier hs-type">new_assoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052874"><span class="hs-identifier hs-type">dup_fields_ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052876"><span class="hs-identifier hs-type">has_sel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052872"><span class="hs-identifier hs-type">inst_decls</span></a></span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span>          </span><span class="hs-comment">-- Finish off with value binders:</span><span>
</span><span id="line-805"></span><span>          </span><span class="hs-comment">--    foreign decls and pattern synonyms for an ordinary module</span><span>
</span><span id="line-806"></span><span>          </span><span class="hs-comment">--    type sigs in case of a hs-boot file only</span><span>
</span><span id="line-807"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052887"><span class="annot"><a href="#local-6989586621683052887"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-type">tcIsHsBootOrSig</span></a></span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052889"><span class="annot"><a href="#local-6989586621683052889"><span class="hs-identifier hs-var hs-var">val_bndrs</span></a></span></span><span>
</span><span id="line-809"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683052887"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsValBinds (GhcPass 'Parsed)
</span><a href="#local-6989586621683052867"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-810"></span><span>                      </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#ValBinds"><span class="hs-identifier hs-type">ValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XValBinds (GhcPass 'Parsed) (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683052891"><span class="annot"><span class="annottext">LHsBindsLR (GhcPass 'Parsed) (GhcPass 'Parsed)
</span><a href="#local-6989586621683052891"><span class="hs-identifier hs-var">_val_binds</span></a></span></span><span> </span><span id="local-6989586621683052892"><span class="annot"><span class="annottext">[LSig (GhcPass 'Parsed)]
</span><a href="#local-6989586621683052892"><span class="hs-identifier hs-var">val_sigs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-811"></span><span>                          </span><span class="hs-comment">-- In a hs-boot file, the value binders come from the</span><span>
</span><span id="line-812"></span><span>                          </span><span class="hs-comment">--  *signatures*, and there should be no foreign binders</span><span>
</span><span id="line-813"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; RdrName -&gt; GenLocated SrcSpanAnnN RdrName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpanAnnN
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683052894"><span class="hs-identifier hs-var">decl_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName
</span><a href="#local-6989586621683052895"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683052894"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683052894"><span class="hs-identifier hs-var">decl_loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#TypeSig"><span class="hs-identifier hs-type">TypeSig</span></a></span><span> </span><span class="annot"><span class="annottext">XTypeSig (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683052897"><span class="annot"><span class="annottext">[LIdP (GhcPass 'Parsed)]
</span><a href="#local-6989586621683052897"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LSig (GhcPass 'Parsed)]
[GenLocated SrcSpanAnnA (Sig (GhcPass 'Parsed))]
</span><a href="#local-6989586621683052892"><span class="hs-identifier hs-var">val_sigs</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052895"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName
</span><a href="#local-6989586621683052895"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LIdP (GhcPass 'Parsed)]
[GenLocated SrcSpanAnnN RdrName]
</span><a href="#local-6989586621683052897"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-815"></span><span>                      </span><span class="annot"><span class="annottext">HsValBinds (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [GenLocated SrcSpanAnnN RdrName]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Non-ValBinds in hs-boot group&quot;</span></span><span>
</span><span id="line-816"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN RdrName]
</span><a href="#local-6989586621683052899"><span class="hs-identifier hs-var">for_hs_bndrs</span></a></span><span>
</span><span id="line-817"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052900"><span class="annot"><a href="#local-6989586621683052900"><span class="hs-identifier hs-var">val_gres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="#local-6989586621683052901"><span class="hs-identifier hs-type">new_simple</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052889"><span class="hs-identifier hs-type">val_bndrs</span></a></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052902"><span class="annot"><a href="#local-6989586621683052902"><span class="hs-identifier hs-var hs-var">avails</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[GlobalRdrElt]] -&gt; [GlobalRdrElt]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[GlobalRdrElt]]
</span><a href="#local-6989586621683052884"><span class="hs-identifier hs-var">nti_gress</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052900"><span class="hs-identifier hs-var">val_gres</span></a></span><span>
</span><span id="line-820"></span><span>              </span><span id="local-6989586621683052904"><span class="annot"><a href="#local-6989586621683052904"><span class="hs-identifier hs-var hs-var">new_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Defs
forall info. [GlobalRdrEltX info] -&gt; Defs
</span><a href="GHC.Types.Name.Reader.html#gresToNameSet"><span class="hs-identifier hs-var">gresToNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052902"><span class="hs-identifier hs-var">avails</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-var">`unionNameSet`</span></a></span><span>
</span><span id="line-821"></span><span>                          </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Defs
forall info. [GlobalRdrEltX info] -&gt; Defs
</span><a href="GHC.Types.Name.Reader.html#gresToNameSet"><span class="hs-identifier hs-var">gresToNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052878"><span class="hs-identifier hs-var">tc_gres</span></a></span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;getLocalNonValBinders 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052902"><span class="hs-identifier hs-type">avails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052907"><span class="annot"><a href="#local-6989586621683052907"><span class="hs-identifier hs-var">envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-type">extendGlobalRdrEnvRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052902"><span class="hs-identifier hs-type">avails</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052864"><span class="hs-identifier hs-type">fixity_env</span></a></span><span>
</span><span id="line-824"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052907"><span class="hs-identifier hs-type">envs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683052904"><span class="hs-identifier hs-type">new_bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="#local-6989586621683052899"><span class="hs-identifier hs-type">for_hs_bndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-827"></span><span>    </span><span id="local-6989586621683052899"><span class="annot"><span class="annottext">for_hs_bndrs :: [GenLocated SrcSpanAnnN RdrName]
</span><a href="#local-6989586621683052899"><span class="hs-identifier hs-var hs-var">for_hs_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LForeignDecl (GhcPass 'Parsed)] -&gt; [LIdP (GhcPass 'Parsed)]
forall (p :: Pass) a.
(UnXRec (GhcPass p), IsSrcSpanAnn p a) =&gt;
[LForeignDecl (GhcPass p)] -&gt; [LIdP (GhcPass p)]
</span><a href="GHC.Hs.Utils.html#hsForeignDeclsBinders"><span class="hs-identifier hs-var">hsForeignDeclsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[LForeignDecl (GhcPass 'Parsed)]
</span><a href="#local-6989586621683052871"><span class="hs-identifier hs-var">foreign_decls</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span>      </span><span class="hs-comment">-- the SrcSpan attached to the input should be the span of the</span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-comment">-- declaration, not just the name</span><span>
</span><span id="line-831"></span><span>    </span><span class="annot"><a href="#local-6989586621683052901"><span class="hs-identifier hs-type">new_simple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-832"></span><span>    </span><span id="local-6989586621683052901"><span class="annot"><span class="annottext">new_simple :: GenLocated SrcSpanAnnN RdrName
-&gt; IOEnv (Env TcGblEnv TcLclEnv) GlobalRdrElt
</span><a href="#local-6989586621683052901"><span class="hs-identifier hs-var hs-var">new_simple</span></a></span></span><span> </span><span id="local-6989586621683052909"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName
</span><a href="#local-6989586621683052909"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683052910"><span class="annot"><a href="#local-6989586621683052910"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName
</span><a href="#local-6989586621683052909"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-833"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#mkLocalVanillaGRE"><span class="hs-identifier hs-type">mkLocalVanillaGRE</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#NoParent"><span class="hs-identifier hs-type">NoParent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052910"><span class="hs-identifier hs-type">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span>    </span><span class="annot"><a href="#local-6989586621683052880"><span class="hs-identifier hs-type">new_tc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#DuplicateRecordFields"><span class="hs-identifier hs-type">DuplicateRecordFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldSelectors"><span class="hs-identifier hs-type">FieldSelectors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-836"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-837"></span><span>    </span><span id="local-6989586621683052880"><span class="annot"><span class="annottext">new_tc :: DuplicateRecordFields
-&gt; FieldSelectors
-&gt; LTyClDecl (GhcPass 'Parsed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="#local-6989586621683052880"><span class="hs-identifier hs-var hs-var">new_tc</span></a></span></span><span> </span><span id="local-6989586621683052914"><span class="annot"><span class="annottext">DuplicateRecordFields
</span><a href="#local-6989586621683052914"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span></span><span> </span><span id="local-6989586621683052915"><span class="annot"><span class="annottext">FieldSelectors
</span><a href="#local-6989586621683052915"><span class="hs-identifier hs-var">has_sel</span></a></span></span><span> </span><span id="local-6989586621683052916"><span class="annot"><span class="annottext">LTyClDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052916"><span class="hs-identifier hs-var">tc_decl</span></a></span></span><span> </span><span class="hs-comment">-- NOT for type/data instances</span><span>
</span><span id="line-838"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#TyDeclBinders"><span class="hs-identifier hs-type">TyDeclBinders</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052918"><span class="annot"><span class="annottext">LocatedA (IdP (GhcPass 'Parsed))
</span><a href="#local-6989586621683052918"><span class="hs-identifier hs-var hs-var">main_bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052919"><span class="annot"><span class="annottext">TyConFlavour ()
</span><a href="#local-6989586621683052919"><span class="hs-identifier hs-var hs-var">tc_flav</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683052920"><span class="annot"><span class="annottext">[(LocatedA (IdP (GhcPass 'Parsed)), TyConFlavour ())]
</span><a href="#local-6989586621683052920"><span class="hs-identifier hs-var hs-var">at_bndrs</span></a></span></span><span> </span><span id="local-6989586621683052921"><span class="annot"><span class="annottext">[LocatedA (IdP (GhcPass 'Parsed))]
</span><a href="#local-6989586621683052921"><span class="hs-identifier hs-var hs-var">sig_bndrs</span></a></span></span><span>
</span><span id="line-839"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#LConsWithFields"><span class="hs-identifier hs-type">LConsWithFields</span></a></span><span> </span><span id="local-6989586621683052923"><span class="annot"><span class="annottext">[(LocatedA (IdP (GhcPass 'Parsed)), Maybe [Located Int])]
</span><a href="#local-6989586621683052923"><span class="hs-identifier hs-var hs-var">cons_with_flds</span></a></span></span><span> </span><span id="local-6989586621683052924"><span class="annot"><span class="annottext">IntMap (LFieldOcc (GhcPass 'Parsed))
</span><a href="#local-6989586621683052924"><span class="hs-identifier hs-var hs-var">flds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (TyClDecl (GhcPass 'Parsed))
-&gt; TyDeclBinders 'Parsed
forall (p :: Pass).
(IsPass p, OutputableBndrId p) =&gt;
LocatedA (TyClDecl (GhcPass p)) -&gt; TyDeclBinders p
</span><a href="GHC.Hs.Utils.html#hsLTyClDeclBinders"><span class="hs-identifier hs-var">hsLTyClDeclBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl (GhcPass 'Parsed)
GenLocated SrcSpanAnnA (TyClDecl (GhcPass 'Parsed))
</span><a href="#local-6989586621683052916"><span class="hs-identifier hs-var">tc_decl</span></a></span><span>
</span><span id="line-840"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052926"><span class="annot"><a href="#local-6989586621683052926"><span class="hs-identifier hs-var">tycon_name</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnN RdrName -&gt; RnM Name)
-&gt; GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName -&gt; GenLocated SrcSpanAnnN RdrName
forall l l2 a.
(HasLoc l, HasAnnotation l2) =&gt;
GenLocated l a -&gt; GenLocated l2 a
</span><a href="GHC.Parser.Annotation.html#la2la"><span class="hs-identifier hs-var">la2la</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (IdP (GhcPass 'Parsed))
GenLocated SrcSpanAnnA RdrName
</span><a href="#local-6989586621683052918"><span class="hs-identifier hs-var">main_bndr</span></a></span><span>
</span><span id="line-841"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052928"><span class="annot"><a href="#local-6989586621683052928"><span class="hs-identifier hs-var">at_names</span></a></span></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-type">newTopSrcBinder</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#la2la"><span class="hs-identifier hs-type">la2la</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052920"><span class="hs-identifier hs-type">at_bndrs</span></a></span><span>
</span><span id="line-842"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052929"><span class="annot"><a href="#local-6989586621683052929"><span class="hs-identifier hs-var">sig_names</span></a></span></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-type">newTopSrcBinder</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#la2la"><span class="hs-identifier hs-type">la2la</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052921"><span class="hs-identifier hs-type">sig_bndrs</span></a></span><span>
</span><span id="line-843"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052930"><span class="annot"><a href="#local-6989586621683052930"><span class="hs-identifier hs-var">con_names_with_flds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683052931"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName
</span><a href="#local-6989586621683052931"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683052932"><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683052932"><span class="hs-identifier hs-var">flds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683052932"><span class="hs-identifier hs-var">flds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; (Name, Maybe [Located Int]))
-&gt; RnM Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, Maybe [Located Int])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName -&gt; GenLocated SrcSpanAnnN RdrName
forall l l2 a.
(HasLoc l, HasAnnotation l2) =&gt;
GenLocated l a -&gt; GenLocated l2 a
</span><a href="GHC.Parser.Annotation.html#la2la"><span class="hs-identifier hs-var">la2la</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName
</span><a href="#local-6989586621683052931"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052923"><span class="hs-identifier hs-type">cons_with_flds</span></a></span><span>
</span><span id="line-844"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683052933"><span class="annot"><a href="#local-6989586621683052933"><span class="hs-identifier hs-var">flds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#newRecordFieldLabel"><span class="hs-identifier hs-type">newRecordFieldLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052914"><span class="hs-identifier hs-type">dup_fields_ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052915"><span class="hs-identifier hs-type">has_sel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621683052930"><span class="hs-identifier hs-type">con_names_with_flds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052924"><span class="hs-identifier hs-type">flds</span></a></span><span>
</span><span id="line-845"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052935"><span class="hs-identifier hs-type">add_dup_fld_errs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052933"><span class="hs-identifier hs-type">flds'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683052930"><span class="hs-identifier hs-type">con_names_with_flds</span></a></span><span>
</span><span id="line-846"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052936"><span class="annot"><a href="#local-6989586621683052936"><span class="hs-identifier hs-var hs-var">tc_gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConFlavour Name -&gt; Name -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkLocalTyConGRE"><span class="hs-identifier hs-var">mkLocalTyConGRE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Name) -&gt; TyConFlavour () -&gt; TyConFlavour Name
forall a b. (a -&gt; b) -&gt; TyConFlavour a -&gt; TyConFlavour b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; () -&gt; Name
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052926"><span class="hs-identifier hs-var">tycon_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyConFlavour ()
</span><a href="#local-6989586621683052919"><span class="hs-identifier hs-var">tc_flav</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052926"><span class="hs-identifier hs-var">tycon_name</span></a></span><span>
</span><span id="line-847"></span><span>                   </span><span id="local-6989586621683052938"><span class="annot"><a href="#local-6989586621683052938"><span class="hs-identifier hs-var hs-var">fld_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Maybe [Located Int])]
-&gt; IntMap FieldLabel -&gt; [(ConLikeName, ConInfo)]
</span><a href="#local-6989586621683052939"><span class="hs-identifier hs-var">mk_fld_env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Maybe [Located Int])]
</span><a href="#local-6989586621683052930"><span class="hs-identifier hs-var">con_names_with_flds</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap FieldLabel
</span><a href="#local-6989586621683052933"><span class="hs-identifier hs-var">flds'</span></a></span><span>
</span><span id="line-848"></span><span>                   </span><span id="local-6989586621683052940"><span class="annot"><a href="#local-6989586621683052940"><span class="hs-identifier hs-var hs-var">at_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GenLocated SrcSpanAnnA RdrName, TyConFlavour ())
 -&gt; Name -&gt; GlobalRdrElt)
-&gt; [(GenLocated SrcSpanAnnA RdrName, TyConFlavour ())]
-&gt; [Name]
-&gt; [GlobalRdrElt]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052942"><span class="annot"><span class="annottext">TyConFlavour ()
</span><a href="#local-6989586621683052942"><span class="hs-identifier hs-var">at_flav</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683052943"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052943"><span class="hs-identifier hs-var">at_nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyConFlavour Name -&gt; Name -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkLocalTyConGRE"><span class="hs-identifier hs-var">mkLocalTyConGRE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Name) -&gt; TyConFlavour () -&gt; TyConFlavour Name
forall a b. (a -&gt; b) -&gt; TyConFlavour a -&gt; TyConFlavour b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; () -&gt; Name
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052926"><span class="hs-identifier hs-var">tycon_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyConFlavour ()
</span><a href="#local-6989586621683052942"><span class="hs-identifier hs-var">at_flav</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052943"><span class="hs-identifier hs-var">at_nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span>                               </span><span class="annot"><span class="annottext">[(LocatedA (IdP (GhcPass 'Parsed)), TyConFlavour ())]
[(GenLocated SrcSpanAnnA RdrName, TyConFlavour ())]
</span><a href="#local-6989586621683052920"><span class="hs-identifier hs-var">at_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683052928"><span class="hs-identifier hs-var">at_names</span></a></span><span>
</span><span id="line-850"></span><span>                   </span><span id="local-6989586621683052944"><span class="annot"><a href="#local-6989586621683052944"><span class="hs-identifier hs-var hs-var">sig_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; GlobalRdrElt) -&gt; [Name] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parent -&gt; Name -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkLocalVanillaGRE"><span class="hs-identifier hs-var">mkLocalVanillaGRE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052926"><span class="hs-identifier hs-var">tycon_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683052929"><span class="hs-identifier hs-var">sig_names</span></a></span><span>
</span><span id="line-851"></span><span>                   </span><span id="local-6989586621683052946"><span class="annot"><a href="#local-6989586621683052946"><span class="hs-identifier hs-var hs-var">con_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ConLikeName, ConInfo) -&gt; GlobalRdrElt)
-&gt; [(ConLikeName, ConInfo)] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parent -&gt; (ConLikeName, ConInfo) -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkLocalConLikeGRE"><span class="hs-identifier hs-var">mkLocalConLikeGRE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052926"><span class="hs-identifier hs-var">tycon_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ConLikeName, ConInfo)]
</span><a href="#local-6989586621683052938"><span class="hs-identifier hs-var">fld_env</span></a></span><span>
</span><span id="line-852"></span><span>                   </span><span id="local-6989586621683052948"><span class="annot"><a href="#local-6989586621683052948"><span class="hs-identifier hs-var hs-var">fld_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parent -&gt; [(ConLikeName, ConInfo)] -&gt; [GlobalRdrElt]
</span><a href="GHC.Types.Name.Reader.html#mkLocalFieldGREs"><span class="hs-identifier hs-var">mkLocalFieldGREs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052926"><span class="hs-identifier hs-var">tycon_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ConLikeName, ConInfo)]
</span><a href="#local-6989586621683052938"><span class="hs-identifier hs-var">fld_env</span></a></span><span>
</span><span id="line-853"></span><span>                   </span><span id="local-6989586621683052950"><span class="annot"><a href="#local-6989586621683052950"><span class="hs-identifier hs-var hs-var">sub_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052940"><span class="hs-identifier hs-var">at_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052944"><span class="hs-identifier hs-var">sig_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052946"><span class="hs-identifier hs-var">con_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683052948"><span class="hs-identifier hs-var">fld_gres</span></a></span><span>
</span><span id="line-854"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;getLocalNonValBinders new_tc&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-855"></span><span>                 </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tycon:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052926"><span class="hs-identifier hs-type">tycon_name</span></a></span><span>
</span><span id="line-856"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_gre:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052936"><span class="hs-identifier hs-type">tc_gre</span></a></span><span>
</span><span id="line-857"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sub_gres:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052950"><span class="hs-identifier hs-type">sub_gres</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-858"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683052936"><span class="hs-identifier hs-type">tc_gre</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683052950"><span class="hs-identifier hs-type">sub_gres</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span>    </span><span class="hs-comment">-- Calculate the record field information, which feeds into the GlobalRdrElts</span><span>
</span><span id="line-861"></span><span>    </span><span class="hs-comment">-- for DataCons and their fields. It's convenient to do this here where</span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-comment">-- we are working with a single datatype definition.</span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-864"></span><span>    </span><span class="hs-comment">-- The information we needed was all set up for us:</span><span>
</span><span id="line-865"></span><span>    </span><span class="hs-comment">-- see Note [Collecting record fields in data declarations] in GHC.Hs.Utils.</span><span>
</span><span id="line-866"></span><span>    </span><span class="annot"><a href="#local-6989586621683052939"><span class="hs-identifier hs-type">mk_fld_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#IntMap"><span class="hs-identifier hs-type">IntMap</span></a></span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span>
</span><span id="line-867"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.GREInfo.html#ConLikeName"><span class="hs-identifier hs-type">ConLikeName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConInfo"><span class="hs-identifier hs-type">ConInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-868"></span><span>    </span><span id="local-6989586621683052939"><span class="annot"><span class="annottext">mk_fld_env :: [(Name, Maybe [Located Int])]
-&gt; IntMap FieldLabel -&gt; [(ConLikeName, ConInfo)]
</span><a href="#local-6989586621683052939"><span class="hs-identifier hs-var hs-var">mk_fld_env</span></a></span></span><span> </span><span id="local-6989586621683052953"><span class="annot"><span class="annottext">[(Name, Maybe [Located Int])]
</span><a href="#local-6989586621683052953"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621683052954"><span class="annot"><span class="annottext">IntMap FieldLabel
</span><a href="#local-6989586621683052954"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-869"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ConLikeName
</span><a href="GHC.Types.GREInfo.html#DataConName"><span class="hs-identifier hs-var">DataConName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052956"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConLikeInfo -&gt; ConFieldInfo -&gt; ConInfo
</span><a href="GHC.Types.GREInfo.html#ConInfo"><span class="hs-identifier hs-var">ConInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; ConLikeInfo
</span><a href="GHC.Types.GREInfo.html#ConIsData"><span class="hs-identifier hs-var">ConIsData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, Maybe [Located Int]) -&gt; Name)
-&gt; [(Name, Maybe [Located Int])] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, Maybe [Located Int]) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Maybe [Located Int])]
</span><a href="#local-6989586621683052953"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConFieldInfo
</span><a href="#local-6989586621683052958"><span class="hs-identifier hs-var">fld_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052956"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052956"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683052959"><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683052959"><span class="hs-identifier hs-var">mb_fl_indxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, Maybe [Located Int])]
</span><a href="#local-6989586621683052953"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052958"><span class="annot"><span class="annottext">fld_info :: ConFieldInfo
</span><a href="#local-6989586621683052958"><span class="hs-identifier hs-var hs-var">fld_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([Located Int] -&gt; [FieldLabel])
-&gt; Maybe [Located Int] -&gt; Maybe [FieldLabel]
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Located Int -&gt; FieldLabel) -&gt; [Located Int] -&gt; [FieldLabel]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap FieldLabel
</span><a href="#local-6989586621683052954"><span class="hs-identifier hs-var">flds</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap FieldLabel -&gt; Int -&gt; FieldLabel
forall a. IntMap a -&gt; Int -&gt; a
</span><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#%21"><span class="hs-operator hs-var">IntMap.!</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; FieldLabel)
-&gt; (Located Int -&gt; Int) -&gt; Located Int -&gt; FieldLabel
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Located Int -&gt; Int
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683052959"><span class="hs-identifier hs-var">mb_fl_indxs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-872"></span><span>              </span><span class="annot"><span class="annottext">Maybe [FieldLabel]
</span><span class="hs-identifier hs-var">Nothing</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConFieldInfo
</span><a href="GHC.Types.GREInfo.html#ConHasPositionalArgs"><span class="hs-identifier hs-var">ConHasPositionalArgs</span></a></span><span>
</span><span id="line-873"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConFieldInfo
</span><a href="GHC.Types.GREInfo.html#ConIsNullary"><span class="hs-identifier hs-var">ConIsNullary</span></a></span><span>
</span><span id="line-874"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683052963"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621683052963"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683052964"><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621683052964"><span class="hs-identifier hs-var">flds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldLabel -&gt; ConFieldInfo
</span><a href="GHC.Types.GREInfo.html#ConHasRecordFields"><span class="hs-identifier hs-var">ConHasRecordFields</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty FieldLabel -&gt; ConFieldInfo)
-&gt; NonEmpty FieldLabel -&gt; ConFieldInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621683052963"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; [FieldLabel] -&gt; NonEmpty FieldLabel
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621683052964"><span class="hs-identifier hs-var">flds</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span>    </span><span class="annot"><a href="#local-6989586621683052886"><span class="hs-identifier hs-type">new_assoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#DuplicateRecordFields"><span class="hs-identifier hs-type">DuplicateRecordFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldSelectors"><span class="hs-identifier hs-type">FieldSelectors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-877"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-878"></span><span>    </span><span id="local-6989586621683052886"><span class="annot"><span class="annottext">new_assoc :: DuplicateRecordFields
-&gt; FieldSelectors
-&gt; LInstDecl (GhcPass 'Parsed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="#local-6989586621683052886"><span class="hs-identifier hs-var hs-var">new_assoc</span></a></span></span><span> </span><span class="annot"><span class="annottext">DuplicateRecordFields
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FieldSelectors
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#TyFamInstD"><span class="hs-identifier hs-type">TyFamInstD</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-879"></span><span>      </span><span class="hs-comment">-- type instances don't bind new names</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>    </span><span class="annot"><a href="#local-6989586621683052886"><span class="hs-identifier hs-var">new_assoc</span></a></span><span> </span><span id="local-6989586621683052967"><span class="annot"><span class="annottext">DuplicateRecordFields
</span><a href="#local-6989586621683052967"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span></span><span> </span><span id="local-6989586621683052968"><span class="annot"><span class="annottext">FieldSelectors
</span><a href="#local-6989586621683052968"><span class="hs-identifier hs-var">has_sel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DataFamInstD"><span class="hs-identifier hs-type">DataFamInstD</span></a></span><span> </span><span class="annot"><span class="annottext">XDataFamInstD (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683052970"><span class="annot"><span class="annottext">DataFamInstDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052970"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DuplicateRecordFields
-&gt; FieldSelectors
-&gt; Maybe Name
-&gt; DataFamInstDecl (GhcPass 'Parsed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="#local-6989586621683052971"><span class="hs-identifier hs-var">new_di</span></a></span><span> </span><span class="annot"><span class="annottext">DuplicateRecordFields
</span><a href="#local-6989586621683052967"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span><span> </span><span class="annot"><span class="annottext">FieldSelectors
</span><a href="#local-6989586621683052968"><span class="hs-identifier hs-var">has_sel</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">DataFamInstDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052970"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span class="annot"><a href="#local-6989586621683052886"><span class="hs-identifier hs-var">new_assoc</span></a></span><span> </span><span id="local-6989586621683052972"><span class="annot"><span class="annottext">DuplicateRecordFields
</span><a href="#local-6989586621683052972"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span></span><span> </span><span id="local-6989586621683052973"><span class="annot"><span class="annottext">FieldSelectors
</span><a href="#local-6989586621683052973"><span class="hs-identifier hs-var">has_sel</span></a></span></span><span>
</span><span id="line-884"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#ClsInstD"><span class="hs-identifier hs-type">ClsInstD</span></a></span><span> </span><span class="annot"><span class="annottext">XClsInstD (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#ClsInstDecl"><span class="hs-identifier hs-type">ClsInstDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cid_poly_ty :: forall pass. ClsInstDecl pass -&gt; LHsSigType pass
</span><a href="Language.Haskell.Syntax.Decls.html#cid_poly_ty"><span class="hs-identifier hs-var">cid_poly_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052977"><span class="annot"><span class="annottext">LHsSigType (GhcPass 'Parsed)
</span><a href="#local-6989586621683052977"><span class="hs-identifier hs-var">inst_ty</span></a></span></span><span>
</span><span id="line-885"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cid_datafam_insts :: forall pass. ClsInstDecl pass -&gt; [LDataFamInstDecl pass]
</span><a href="Language.Haskell.Syntax.Decls.html#cid_datafam_insts"><span class="hs-identifier hs-var">cid_datafam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052979"><span class="annot"><span class="annottext">[LDataFamInstDecl (GhcPass 'Parsed)]
</span><a href="#local-6989586621683052979"><span class="hs-identifier hs-var">adts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- First, attempt to grab the name of the class from the instance.</span><span>
</span><span id="line-887"></span><span>           </span><span class="hs-comment">-- This step could fail if the instance is not headed by a class,</span><span>
</span><span id="line-888"></span><span>           </span><span class="hs-comment">-- such as in the following examples:</span><span>
</span><span id="line-889"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-890"></span><span>           </span><span class="hs-comment">-- (1) The class is headed by a bang pattern, such as in</span><span>
</span><span id="line-891"></span><span>           </span><span class="hs-comment">--     `instance !Show Int` (#3811c)</span><span>
</span><span id="line-892"></span><span>           </span><span class="hs-comment">-- (2) The class is headed by a type variable, such as in</span><span>
</span><span id="line-893"></span><span>           </span><span class="hs-comment">--     `instance c` (#16385)</span><span>
</span><span id="line-894"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-895"></span><span>           </span><span class="hs-comment">-- If looking up the class name fails, then mb_cls_gre will</span><span>
</span><span id="line-896"></span><span>           </span><span class="hs-comment">-- be Nothing.</span><span>
</span><span id="line-897"></span><span>           </span><span id="local-6989586621683052980"><span class="annot"><a href="#local-6989586621683052980"><span class="hs-identifier hs-var">mb_cls_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe GlobalRdrElt)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe GlobalRdrElt))
-&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-898"></span><span>             </span><span class="hs-comment">-- See (1) above</span><span>
</span><span id="line-899"></span><span>             </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683052982"><span class="annot"><a href="#local-6989586621683052982"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683052983"><span class="annot"><a href="#local-6989586621683052983"><span class="hs-identifier hs-var">cls_rdr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv) (Maybe (GenLocated SrcSpanAnnN RdrName))
-&gt; MaybeT
     (IOEnv (Env TcGblEnv TcLclEnv)) (GenLocated SrcSpanAnnN RdrName)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (Maybe (GenLocated SrcSpanAnnN RdrName))
 -&gt; MaybeT
      (IOEnv (Env TcGblEnv TcLclEnv)) (GenLocated SrcSpanAnnN RdrName))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Maybe (GenLocated SrcSpanAnnN RdrName))
-&gt; MaybeT
     (IOEnv (Env TcGblEnv TcLclEnv)) (GenLocated SrcSpanAnnN RdrName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnN RdrName)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Maybe (GenLocated SrcSpanAnnN RdrName))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (GenLocated SrcSpanAnnN RdrName)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (Maybe (GenLocated SrcSpanAnnN RdrName)))
-&gt; Maybe (GenLocated SrcSpanAnnN RdrName)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Maybe (GenLocated SrcSpanAnnN RdrName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsSigType (GhcPass 'Parsed)
-&gt; Maybe (LocatedN (IdP (GhcPass 'Parsed)))
forall (p :: Pass).
(Anno (IdGhcP p) ~ SrcSpanAnnN) =&gt;
LHsSigType (GhcPass p) -&gt; Maybe (LocatedN (IdP (GhcPass p)))
</span><a href="GHC.Hs.Type.html#getLHsInstDeclClass_maybe"><span class="hs-identifier hs-var">getLHsInstDeclClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType (GhcPass 'Parsed)
</span><a href="#local-6989586621683052977"><span class="hs-identifier hs-var">inst_ty</span></a></span><span>
</span><span id="line-900"></span><span>             </span><span class="hs-comment">-- See (2) above</span><span>
</span><span id="line-901"></span><span>             </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-type">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052982"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-type">lookupGlobalOccRn_maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#SameNameSpace"><span class="hs-identifier hs-type">SameNameSpace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052983"><span class="hs-identifier hs-type">cls_rdr</span></a></span><span>
</span><span id="line-902"></span><span>           </span><span class="hs-comment">-- Assuming the previous step succeeded, process any associated data</span><span>
</span><span id="line-903"></span><span>           </span><span class="hs-comment">-- family instances. If the previous step failed, bail out.</span><span>
</span><span id="line-904"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683052980"><span class="hs-identifier hs-type">mb_cls_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-905"></span><span>             </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-906"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-907"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683052989"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052989"><span class="hs-identifier hs-var">cls_gre</span></a></span></span><span>
</span><span id="line-908"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683052990"><span class="annot"><span class="annottext">cls_nm :: Name
</span><a href="#local-6989586621683052990"><span class="hs-identifier hs-var hs-var">cls_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683052989"><span class="hs-identifier hs-var">cls_gre</span></a></span><span>
</span><span id="line-909"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (DataFamInstDecl (GhcPass 'Parsed))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt])
-&gt; [GenLocated SrcSpanAnnA (DataFamInstDecl (GhcPass 'Parsed))]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DuplicateRecordFields
-&gt; FieldSelectors
-&gt; Maybe Name
-&gt; DataFamInstDecl (GhcPass 'Parsed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="#local-6989586621683052971"><span class="hs-identifier hs-var">new_di</span></a></span><span> </span><span class="annot"><span class="annottext">DuplicateRecordFields
</span><a href="#local-6989586621683052972"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span><span> </span><span class="annot"><span class="annottext">FieldSelectors
</span><a href="#local-6989586621683052973"><span class="hs-identifier hs-var">has_sel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052990"><span class="hs-identifier hs-var">cls_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DataFamInstDecl (GhcPass 'Parsed)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt])
-&gt; (GenLocated SrcSpanAnnA (DataFamInstDecl (GhcPass 'Parsed))
    -&gt; DataFamInstDecl (GhcPass 'Parsed))
-&gt; GenLocated SrcSpanAnnA (DataFamInstDecl (GhcPass 'Parsed))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (DataFamInstDecl (GhcPass 'Parsed))
-&gt; DataFamInstDecl (GhcPass 'Parsed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LDataFamInstDecl (GhcPass 'Parsed)]
[GenLocated SrcSpanAnnA (DataFamInstDecl (GhcPass 'Parsed))]
</span><a href="#local-6989586621683052979"><span class="hs-identifier hs-var">adts</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>    </span><span class="annot"><a href="#local-6989586621683052971"><span class="hs-identifier hs-type">new_di</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#DuplicateRecordFields"><span class="hs-identifier hs-type">DuplicateRecordFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldSelectors"><span class="hs-identifier hs-type">FieldSelectors</span></a></span><span>
</span><span id="line-912"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-comment">-- class name</span><span>
</span><span id="line-913"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-914"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-915"></span><span>    </span><span id="local-6989586621683052971"><span class="annot"><span class="annottext">new_di :: DuplicateRecordFields
-&gt; FieldSelectors
-&gt; Maybe Name
-&gt; DataFamInstDecl (GhcPass 'Parsed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="#local-6989586621683052971"><span class="hs-identifier hs-var hs-var">new_di</span></a></span></span><span> </span><span id="local-6989586621683052991"><span class="annot"><span class="annottext">DuplicateRecordFields
</span><a href="#local-6989586621683052991"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span></span><span> </span><span id="local-6989586621683052992"><span class="annot"><span class="annottext">FieldSelectors
</span><a href="#local-6989586621683052992"><span class="hs-identifier hs-var">has_sel</span></a></span></span><span> </span><span id="local-6989586621683052993"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683052993"><span class="hs-identifier hs-var">mb_cls</span></a></span></span><span> </span><span id="local-6989586621683052994"><span class="annot"><span class="annottext">dfid :: DataFamInstDecl (GhcPass 'Parsed)
</span><a href="#local-6989586621683052994"><span class="hs-identifier hs-var">dfid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dfid_eqn :: forall pass. DataFamInstDecl pass -&gt; FamEqn pass (HsDataDefn pass)
</span><a href="Language.Haskell.Syntax.Decls.html#dfid_eqn"><span class="hs-identifier hs-var">dfid_eqn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683052997"><span class="annot"><span class="annottext">FamEqn (GhcPass 'Parsed) (HsDataDefn (GhcPass 'Parsed))
</span><a href="#local-6989586621683052997"><span class="hs-identifier hs-var">ti_decl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683052998"><span class="annot"><a href="#local-6989586621683052998"><span class="hs-identifier hs-var">main_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnN Name -&gt; Name)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnN Name)
-&gt; RnM Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
-&gt; GenLocated SrcSpanAnnN RdrName
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnN Name)
</span><a href="GHC.Rename.Env.html#lookupFamInstName"><span class="hs-identifier hs-var">lookupFamInstName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683052993"><span class="hs-identifier hs-var">mb_cls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamEqn (GhcPass 'Parsed) (HsDataDefn (GhcPass 'Parsed))
-&gt; LIdP (GhcPass 'Parsed)
forall pass rhs. FamEqn pass rhs -&gt; LIdP pass
</span><a href="Language.Haskell.Syntax.Decls.html#feqn_tycon"><span class="hs-identifier hs-var">feqn_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">FamEqn (GhcPass 'Parsed) (HsDataDefn (GhcPass 'Parsed))
</span><a href="#local-6989586621683052997"><span class="hs-identifier hs-var">ti_decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#LConsWithFields"><span class="hs-identifier hs-type">LConsWithFields</span></a></span><span> </span><span id="local-6989586621683053001"><span class="annot"><a href="#local-6989586621683053001"><span class="hs-identifier hs-var">cons_with_flds</span></a></span></span><span> </span><span id="local-6989586621683053002"><span class="annot"><a href="#local-6989586621683053002"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#hsDataFamInstBinders"><span class="hs-identifier hs-type">hsDataFamInstBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052994"><span class="hs-identifier hs-type">dfid</span></a></span><span>
</span><span id="line-918"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683053004"><span class="annot"><a href="#local-6989586621683053004"><span class="hs-identifier hs-var">sub_names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683053005"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName
</span><a href="#local-6989586621683053005"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683053006"><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683053006"><span class="hs-identifier hs-var">flds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683053006"><span class="hs-identifier hs-var">flds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; (Name, Maybe [Located Int]))
-&gt; RnM Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, Maybe [Located Int])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName -&gt; GenLocated SrcSpanAnnN RdrName
forall l l2 a.
(HasLoc l, HasAnnotation l2) =&gt;
GenLocated l a -&gt; GenLocated l2 a
</span><a href="GHC.Parser.Annotation.html#la2la"><span class="hs-identifier hs-var">la2la</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA RdrName
</span><a href="#local-6989586621683053005"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053001"><span class="hs-identifier hs-type">cons_with_flds</span></a></span><span>
</span><span id="line-919"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683053007"><span class="annot"><a href="#local-6989586621683053007"><span class="hs-identifier hs-var">flds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#newRecordFieldLabel"><span class="hs-identifier hs-type">newRecordFieldLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052991"><span class="hs-identifier hs-type">dup_fields_ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683052992"><span class="hs-identifier hs-type">has_sel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621683053004"><span class="hs-identifier hs-type">sub_names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053002"><span class="hs-identifier hs-type">flds</span></a></span><span>
</span><span id="line-920"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683052935"><span class="hs-identifier hs-type">add_dup_fld_errs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053007"><span class="hs-identifier hs-type">flds'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053004"><span class="hs-identifier hs-type">sub_names</span></a></span><span>
</span><span id="line-921"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053008"><span class="annot"><a href="#local-6989586621683053008"><span class="hs-identifier hs-var hs-var">fld_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Maybe [Located Int])]
-&gt; IntMap FieldLabel -&gt; [(ConLikeName, ConInfo)]
</span><a href="#local-6989586621683052939"><span class="hs-identifier hs-var">mk_fld_env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Maybe [Located Int])]
</span><a href="#local-6989586621683053004"><span class="hs-identifier hs-var">sub_names</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap FieldLabel
</span><a href="#local-6989586621683053007"><span class="hs-identifier hs-var">flds'</span></a></span><span>
</span><span id="line-922"></span><span>                   </span><span id="local-6989586621683053009"><span class="annot"><a href="#local-6989586621683053009"><span class="hs-identifier hs-var hs-var">con_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ConLikeName, ConInfo) -&gt; GlobalRdrElt)
-&gt; [(ConLikeName, ConInfo)] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parent -&gt; (ConLikeName, ConInfo) -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkLocalConLikeGRE"><span class="hs-identifier hs-var">mkLocalConLikeGRE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052998"><span class="hs-identifier hs-var">main_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ConLikeName, ConInfo)]
</span><a href="#local-6989586621683053008"><span class="hs-identifier hs-var">fld_env</span></a></span><span>
</span><span id="line-923"></span><span>                   </span><span id="local-6989586621683053010"><span class="annot"><a href="#local-6989586621683053010"><span class="hs-identifier hs-var hs-var">field_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parent -&gt; [(ConLikeName, ConInfo)] -&gt; [GlobalRdrElt]
</span><a href="GHC.Types.Name.Reader.html#mkLocalFieldGREs"><span class="hs-identifier hs-var">mkLocalFieldGREs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683052998"><span class="hs-identifier hs-var">main_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ConLikeName, ConInfo)]
</span><a href="#local-6989586621683053008"><span class="hs-identifier hs-var">fld_env</span></a></span><span>
</span><span id="line-924"></span><span>               </span><span class="hs-comment">-- NB: the data family name is not bound here,</span><span>
</span><span id="line-925"></span><span>               </span><span class="hs-comment">-- so we don't return a GlobalRdrElt for it here!</span><span>
</span><span id="line-926"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683053009"><span class="hs-identifier hs-type">con_gres</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683053010"><span class="hs-identifier hs-type">field_gres</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span>    </span><span class="hs-comment">-- Add errors if a constructor has a duplicate record field.</span><span>
</span><span id="line-929"></span><span>    </span><span class="annot"><a href="#local-6989586621683052935"><span class="hs-identifier hs-type">add_dup_fld_errs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#IntMap"><span class="hs-identifier hs-type">IntMap</span></a></span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span>
</span><span id="line-930"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>    </span><span id="local-6989586621683052935"><span class="annot"><span class="annottext">add_dup_fld_errs :: IntMap FieldLabel
-&gt; (Name, Maybe [Located Int]) -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683052935"><span class="hs-identifier hs-var hs-var">add_dup_fld_errs</span></a></span></span><span> </span><span id="local-6989586621683053011"><span class="annot"><span class="annottext">IntMap FieldLabel
</span><a href="#local-6989586621683053011"><span class="hs-identifier hs-var">all_flds</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683053012"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053012"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053013"><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683053013"><span class="hs-identifier hs-var">mb_con_flds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053014"><span class="annot"><span class="annottext">[Located Int]
</span><a href="#local-6989586621683053014"><span class="hs-identifier hs-var">con_flds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe [Located Int]
</span><a href="#local-6989586621683053013"><span class="hs-identifier hs-var">mb_con_flds</span></a></span><span>
</span><span id="line-934"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053015"><span class="annot"><span class="annottext">[NonEmpty (Located Int)]
</span><a href="#local-6989586621683053015"><span class="hs-identifier hs-var">dups</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Located Int -&gt; Located Int -&gt; Ordering)
-&gt; [Located Int] -&gt; ([Located Int], [NonEmpty (Located Int)])
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; ([a], [NonEmpty a])
</span><a href="GHC.Data.List.SetOps.html#removeDups"><span class="hs-identifier hs-var">removeDups</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Located Int -&gt; Int) -&gt; Located Int -&gt; Located Int -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">Located Int -&gt; Int
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Located Int]
</span><a href="#local-6989586621683053014"><span class="hs-identifier hs-var">con_flds</span></a></span><span>
</span><span id="line-935"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NonEmpty (Located Int)]
-&gt; (NonEmpty (Located Int) -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[NonEmpty (Located Int)]
</span><a href="#local-6989586621683053015"><span class="hs-identifier hs-var">dups</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (Located Int) -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; (NonEmpty (Located Int) -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683053016"><span class="annot"><span class="annottext">NonEmpty (Located Int)
</span><a href="#local-6989586621683053016"><span class="hs-identifier hs-var">dup_flds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-936"></span><span>          </span><span class="hs-comment">-- Report the error at the location of the second occurrence</span><span>
</span><span id="line-937"></span><span>          </span><span class="hs-comment">-- of the duplicate field.</span><span>
</span><span id="line-938"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053017"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621683053017"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-939"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Located Int)
</span><a href="#local-6989586621683053016"><span class="hs-identifier hs-var">dup_flds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-940"></span><span>                  </span><span class="annot"><span class="annottext">Located Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053018"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683053018"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Located Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683053018"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-941"></span><span>                  </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053019"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683053019"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[Located Int]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683053019"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-942"></span><span>              </span><span id="local-6989586621683053020"><span class="annot"><span class="annottext">dup_rdrs :: NonEmpty RdrName
</span><a href="#local-6989586621683053020"><span class="hs-identifier hs-var hs-var">dup_rdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Located Int -&gt; RdrName)
-&gt; NonEmpty (Located Int) -&gt; NonEmpty RdrName
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RdrName)
-&gt; (Located Int -&gt; Name) -&gt; Located Int -&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name)
-&gt; (Located Int -&gt; FieldLabel) -&gt; Located Int -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap FieldLabel
</span><a href="#local-6989586621683053011"><span class="hs-identifier hs-var">all_flds</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap FieldLabel -&gt; Int -&gt; FieldLabel
forall a. IntMap a -&gt; Int -&gt; a
</span><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#%21"><span class="hs-operator hs-var">IntMap.!</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; FieldLabel)
-&gt; (Located Int -&gt; Int) -&gt; Located Int -&gt; FieldLabel
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Located Int -&gt; Int
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Located Int)
</span><a href="#local-6989586621683053016"><span class="hs-identifier hs-var">dup_flds</span></a></span><span>
</span><span id="line-943"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683053017"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordFieldPart -&gt; NonEmpty RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnDuplicateFieldName"><span class="hs-identifier hs-var">TcRnDuplicateFieldName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; RecordFieldPart
</span><a href="GHC.Tc.Errors.Types.html#RecordFieldDecl"><span class="hs-identifier hs-var">RecordFieldDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053012"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty RdrName
</span><a href="#local-6989586621683053020"><span class="hs-identifier hs-var">dup_rdrs</span></a></span><span>
</span><span id="line-944"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-945"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span class="annot"><a href="GHC.Rename.Names.html#newRecordFieldLabel"><span class="hs-identifier hs-type">newRecordFieldLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#DuplicateRecordFields"><span class="hs-identifier hs-type">DuplicateRecordFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldSelectors"><span class="hs-identifier hs-type">FieldSelectors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span>
</span><span id="line-948"></span><span id="newRecordFieldLabel"><span class="annot"><span class="annottext">newRecordFieldLabel :: DuplicateRecordFields
-&gt; FieldSelectors
-&gt; [Name]
-&gt; LFieldOcc (GhcPass 'Parsed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) FieldLabel
</span><a href="GHC.Rename.Names.html#newRecordFieldLabel"><span class="hs-identifier hs-var hs-var">newRecordFieldLabel</span></a></span></span><span> </span><span class="annot"><span class="annottext">DuplicateRecordFields
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FieldSelectors
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">LFieldOcc (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IOEnv (Env TcGblEnv TcLclEnv) FieldLabel
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newRecordFieldLabel: datatype has no constructors!&quot;</span></span><span>
</span><span id="line-949"></span><span class="annot"><a href="GHC.Rename.Names.html#newRecordFieldLabel"><span class="hs-identifier hs-var">newRecordFieldLabel</span></a></span><span> </span><span id="local-6989586621683053027"><span class="annot"><span class="annottext">DuplicateRecordFields
</span><a href="#local-6989586621683053027"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span></span><span> </span><span id="local-6989586621683053028"><span class="annot"><span class="annottext">FieldSelectors
</span><a href="#local-6989586621683053028"><span class="hs-identifier hs-var">has_sel</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683053029"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053029"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053030"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053030"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053032"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053032"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053033"><span class="annot"><a href="#local-6989586621683053033"><span class="hs-identifier hs-var">selName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnN RdrName -&gt; RnM Name)
-&gt; GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; RdrName -&gt; GenLocated SrcSpanAnnN RdrName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpanAnnN
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053030"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; GenLocated SrcSpanAnnN RdrName)
-&gt; RdrName -&gt; GenLocated SrcSpanAnnN RdrName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053034"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-951"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#flHasDuplicateRecordFields"><span class="hs-identifier hs-var">flHasDuplicateRecordFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683053027"><span class="hs-identifier hs-type">dup_fields_ok</span></a></span><span>
</span><span id="line-952"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#flHasFieldSelector"><span class="hs-identifier hs-var">flHasFieldSelector</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683053028"><span class="hs-identifier hs-type">has_sel</span></a></span><span>
</span><span id="line-953"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683053033"><span class="hs-identifier hs-type">selName</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-955"></span><span>    </span><span id="local-6989586621683053038"><span class="annot"><span class="annottext">fld_occ :: OccName
</span><a href="#local-6989586621683053038"><span class="hs-identifier hs-var hs-var">fld_occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053032"><span class="hs-identifier hs-var">fld</span></a></span><span>
</span><span id="line-956"></span><span>    </span><span id="local-6989586621683053040"><span class="annot"><span class="annottext">dc_fs :: FastString
</span><a href="#local-6989586621683053040"><span class="hs-identifier hs-var hs-var">dc_fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString) -&gt; OccName -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053029"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-957"></span><span>    </span><span id="local-6989586621683053034"><span class="annot"><span class="annottext">field :: RdrName
</span><a href="#local-6989586621683053034"><span class="hs-identifier hs-var hs-var">field</span></a></span></span><span>
</span><span id="line-958"></span><span>      </span><span class="hs-comment">-- Use an Exact RdrName as-is, to preserve the bindings</span><span>
</span><span id="line-959"></span><span>      </span><span class="hs-comment">-- of an already renamer-resolved field and its use</span><span>
</span><span id="line-960"></span><span>      </span><span class="hs-comment">-- sites. This is needed to correctly support record</span><span>
</span><span id="line-961"></span><span>      </span><span class="hs-comment">-- selectors in Template Haskell. See Note [Binders in</span><span>
</span><span id="line-962"></span><span>      </span><span class="hs-comment">-- Template Haskell] in &quot;GHC.ThToHs&quot; and Note [Looking up</span><span>
</span><span id="line-963"></span><span>      </span><span class="hs-comment">-- Exact RdrNames] in &quot;GHC.Rename.Env&quot;.</span><span>
</span><span id="line-964"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isExact"><span class="hs-identifier hs-var">isExact</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053032"><span class="hs-identifier hs-var">fld</span></a></span><span>
</span><span id="line-965"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; RdrName -&gt; RdrName
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; Maybe FastString
</span><a href="GHC.Types.Name.Occurrence.html#fieldOcc_maybe"><span class="hs-identifier hs-var">fieldOcc_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053038"><span class="hs-identifier hs-var">fld_occ</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastString -&gt; Maybe FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Maybe FastString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683053040"><span class="hs-identifier hs-var">dc_fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newRecordFieldLabel: incorrect namespace for exact Name&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053032"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-967"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expected namespace:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; SDoc
</span><a href="GHC.Types.Name.Occurrence.html#pprNameSpace"><span class="hs-identifier hs-var">pprNameSpace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#fieldName"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683053040"><span class="hs-identifier hs-var">dc_fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  actual namespace:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; SDoc
</span><a href="GHC.Types.Name.Occurrence.html#pprNameSpace"><span class="hs-identifier hs-var">pprNameSpace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#occNameSpace"><span class="hs-identifier hs-var">occNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053038"><span class="hs-identifier hs-var">fld_occ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>        </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053032"><span class="hs-identifier hs-var">fld</span></a></span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>      </span><span class="hs-comment">-- Field names produced by the parser are namespaced with VarName.</span><span>
</span><span id="line-972"></span><span>      </span><span class="hs-comment">-- Here we namespace them according to the first constructor.</span><span>
</span><span id="line-973"></span><span>      </span><span class="hs-comment">-- See Note [Record field namespacing] in GHC.Types.Name.Occurrence.</span><span>
</span><span id="line-974"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-975"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrUnqual"><span class="hs-identifier hs-var">mkRdrUnqual</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; RdrName) -&gt; OccName -&gt; RdrName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; FastString -&gt; OccName -&gt; OccName
FastString -&gt; OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#varToRecFieldOcc"><span class="hs-identifier hs-var">varToRecFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683053040"><span class="hs-identifier hs-var">dc_fs</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053038"><span class="hs-identifier hs-var">fld_occ</span></a></span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="hs-comment">{-
Note [Looking up family names in family instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  module M where
    type family T a :: *
    type instance M.T Int = Bool

We might think that we can simply use 'lookupOccRn' when processing the type
instance to look up 'M.T'.  Alas, we can't!  The type family declaration is in
the *same* HsGroup as the type instance declaration.  Hence, as we are
currently collecting the binders declared in that HsGroup, these binders will
not have been added to the global environment yet.

Solution is simple: process the type family declarations first, extend
the environment, and then process the type instances.


************************************************************************
*                                                                      *
\subsection{Filtering imports}
*                                                                      *
************************************************************************

@filterImports@ takes the @ExportEnv@ telling what the imported module makes
available, and filters it through the import spec (if any).

Note [Dealing with imports]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
For import M( ies ), we take each AvailInfo from the mi_exports of M, and make

  imp_occ_env :: OccEnv (NameEnv ImpOccItem)

This map contains one entry for each OccName that M exports, mapping each OccName
to the following information:

  1. the GlobalRdrElt corresponding to the OccName,
  2. whether this GlobalRdrElt was the parent in the AvailInfo we found
     the OccName in.
  3. the GlobalRdrElts that were bundled together in the AvailInfo we found
    this OccName in (not including the parent),

We need (2) and (3) during the construction of the OccEnv because of associated
types and bundled pattern synonyms, respectively.
(3) is explained in Note [Importing PatternSynonyms].

To explain (2), consider for example:

  module M where
    class    C a    where { data T a }
    instance C Int  where { data T Int = T1 | T2 }
    instance C Bool where { data T Int = T3 }

Here, M's exports avails are (recalling the AvailTC invariant from GHC.Types.Avail)

  C(C,T), T(T,T1,T2,T3)

Notice that T appears *twice*, once as a child and once as a parent. From
these two exports, respectively, during construction of the imp_occ_env, we begin
by associating the following two elements with the key T:

  T -&gt; ImpOccItem { imp_item = gre1, imp_bundled = [C,T]     , imp_is_parent = False }
  T -&gt; ImpOccItem { imp_item = gre2, imp_bundled = [T1,T2,T3], imp_is_parent = True  }

where `gre1`, `gre2` are two GlobalRdrElts with greName T.
We combine these (in function 'combine' in 'mkImportOccEnv') by discarding the
non-parent item, thusly:

  T -&gt; IE_ITem { imp_item = gre1 `plusGRE` gre2, imp_bundled = [T1,T2,T3], imp_is_parent = True }

Note the `plusGRE`: this ensures we don't drop parent information;
see Note [Preserve parent information when combining import OccEnvs].

So the overall imp_occ_env is:

  C  -&gt; ImpOccItem { imp_item = C,  imp_bundled = [T       ], imp_is_parent = True  }
  T  -&gt; ImpOccItem { imp_item = T , imp_bundled = [T1,T2,T3], imp_is_parent = True  }
  T1 -&gt; ImpOccItem { imp_item = T1, imp_bundled = [T1,T2,T3], imp_is_parent = False }
    -- similarly for T2, T3

Note that the imp_occ_env will have entries for data constructors too,
although we never look up data constructors.

Note [Importing PatternSynonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As described in Note [Dealing with imports], associated types can lead to the
same Name appearing twice, both as a child and once as a parent, when
constructing the imp_occ_env.  The same thing can happen with pattern synonyms
if they are exported bundled with a type.

A simplified example, based on #11959:

  {-# LANGUAGE PatternSynonyms #-}
  module M (T(P), pattern P) where  -- Duplicate export warning, but allowed
    data T = MkT
    pattern P = MkT

Here we have T(P) and P in export_avails, and respectively construct both

  P -&gt; ImpOccItem { imp_item = P, imp_bundled = [P], imp_is_parent = False }
  P -&gt; ImpOccItem { imp_item = P, imp_bundled = [] , imp_is_parent = False }

We combine these by dropping the one with no siblings, leaving us with:

  P -&gt; ImpOccItem { imp_item = P, imp_bundled = [P], imp_is_parent = False }

That is, we simply discard the non-bundled Avail.

Note [Importing DuplicateRecordFields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In filterImports, another complicating factor is DuplicateRecordFields.
Suppose we have:

  {-# LANGUAGE DuplicateRecordFields #-}
  module M (S(foo), T(foo)) where
    data S = MkS { foo :: Int }
    data T = MkT { foo :: Int }

  module N where
    import M (foo)    -- this is allowed (A)
    import M (S(foo)) -- this is allowed (B)

Here M exports 'foo' at two different OccNames, with different namespaces for
the two construtors MkS and MkT. Then, when we look up 'foo' in lookup_names
for case (A), we have a variable foo but must look in all the record field
namespaces to find the two fields (and hence two different Avails).
Whereas in case (B) we reach the lookup_ie case for IEThingWith,
which looks up 'S' and then finds the unique 'foo' amongst its children.

See T16745 for a test of this.

Note [Preserve parent information when combining import OccEnvs]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When discarding one ImpOccItem in favour of another, as described in
Note [Dealing with imports], we must make sure to combine the GREs so that
we don't lose information.

Consider for example #24084:

  module M1 where { class C a where { type T a } }
  module M2 ( module M1 ) where { import M1 }
  module M3 where { import M2 ( C, T ); instance C () where T () = () }

When processing the import list of `M3`, we will have two `Avail`s attached
to `T`, namely `C(C, T)` and `T(T)`. We combine them in the `combine` function
of `mkImportOccEnv`; as described in Note [Dealing with imports] we discard
`C(C, T)` in favour of `T(T)`. However, in doing so, we **must not**
discard the information want that `C` is the parent of `T`. Indeed,
losing track of this information can cause errors when importing,
as we could get an error of the form

  &#8216;T&#8217; is not a (visible) associated type of class &#8216;C&#8217;

This explains why we use `plusGRE` when combining the two ImpOccItems, even
though we are discarding one in favour of the other.
-}</span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span class="annot"><span class="hs-comment">-- | All the 'GlobalRdrElt's associated with an 'AvailInfo'.</span></span><span>
</span><span id="line-1136"></span><span class="annot"><a href="GHC.Rename.Names.html#gresFromAvail"><span class="hs-identifier hs-type">gresFromAvail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-1137"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1138"></span><span id="gresFromAvail"><span class="annot"><span class="annottext">gresFromAvail :: HasDebugCallStack =&gt;
HscEnv -&gt; Maybe ImportSpec -&gt; AvailInfo -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromAvail"><span class="hs-identifier hs-var hs-var">gresFromAvail</span></a></span></span><span> </span><span id="local-6989586621683053054"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053054"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683053055"><span class="annot"><span class="annottext">Maybe ImportSpec
</span><a href="#local-6989586621683053055"><span class="hs-identifier hs-var">prov</span></a></span></span><span> </span><span id="local-6989586621683053056"><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053056"><span class="hs-identifier hs-var">avail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1139"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; GREInfo -&gt; GlobalRdrElt
</span><a href="#local-6989586621683053057"><span class="hs-identifier hs-var">mk_gre</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053058"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683053059"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683053058"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053058"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; [Name]
</span><a href="GHC.Types.Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053056"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-1141"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053059"><span class="annot"><span class="annottext">info :: GREInfo
</span><a href="#local-6989586621683053059"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; Name -&gt; GREInfo
HscEnv -&gt; Name -&gt; GREInfo
</span><a href="GHC.Rename.Env.html#lookupGREInfo"><span class="hs-identifier hs-var">lookupGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053054"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053058"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1142"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>    </span><span id="local-6989586621683053057"><span class="annot"><span class="annottext">mk_gre :: Name -&gt; GREInfo -&gt; GlobalRdrElt
</span><a href="#local-6989586621683053057"><span class="hs-identifier hs-var hs-var">mk_gre</span></a></span></span><span> </span><span id="local-6989586621683053062"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053062"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683053063"><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683053063"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-1145"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ImportSpec
</span><a href="#local-6989586621683053055"><span class="hs-identifier hs-var">prov</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1146"></span><span>            </span><span class="hs-comment">-- Nothing =&gt; bound locally</span><span>
</span><span id="line-1147"></span><span>            </span><span class="hs-comment">-- Just is =&gt; imported from 'is'</span><span>
</span><span id="line-1148"></span><span>          </span><span class="annot"><span class="annottext">Maybe ImportSpec
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GRE"><span class="hs-identifier hs-type">GRE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gre_name :: Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var">gre_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053062"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_par :: Parent
</span><a href="GHC.Types.Name.Reader.html#gre_par"><span class="hs-identifier hs-var">gre_par</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; AvailInfo -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#mkParent"><span class="hs-identifier hs-var">mkParent</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053062"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053056"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-1149"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_lcl :: Bool
</span><a href="GHC.Types.Name.Reader.html#gre_lcl"><span class="hs-identifier hs-var">gre_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_imp :: Bag ImportSpec
</span><a href="GHC.Types.Name.Reader.html#gre_imp"><span class="hs-identifier hs-var">gre_imp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag ImportSpec
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-1150"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_info :: GREInfo
</span><a href="GHC.Types.Name.Reader.html#gre_info"><span class="hs-identifier hs-var">gre_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683053063"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1151"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053072"><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053072"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GRE"><span class="hs-identifier hs-type">GRE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gre_name :: Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var">gre_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053062"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_par :: Parent
</span><a href="GHC.Types.Name.Reader.html#gre_par"><span class="hs-identifier hs-var">gre_par</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; AvailInfo -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#mkParent"><span class="hs-identifier hs-var">mkParent</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053062"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053056"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-1152"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_lcl :: Bool
</span><a href="GHC.Types.Name.Reader.html#gre_lcl"><span class="hs-identifier hs-var">gre_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_imp :: Bag ImportSpec
</span><a href="GHC.Types.Name.Reader.html#gre_imp"><span class="hs-identifier hs-var">gre_imp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportSpec -&gt; Bag ImportSpec
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053072"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-1153"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_info :: GREInfo
</span><a href="GHC.Types.Name.Reader.html#gre_info"><span class="hs-identifier hs-var">gre_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683053063"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span class="annot"><span class="hs-comment">-- | All the 'GlobalRdrElt's associated with a collection of 'AvailInfo's.</span></span><span>
</span><span id="line-1156"></span><span class="annot"><a href="GHC.Rename.Names.html#gresFromAvails"><span class="hs-identifier hs-type">gresFromAvails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1157"></span><span id="gresFromAvails"><span class="annot"><span class="annottext">gresFromAvails :: HscEnv -&gt; Maybe ImportSpec -&gt; [AvailInfo] -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromAvails"><span class="hs-identifier hs-var hs-var">gresFromAvails</span></a></span></span><span> </span><span id="local-6989586621683053074"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053074"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683053075"><span class="annot"><span class="annottext">Maybe ImportSpec
</span><a href="#local-6989586621683053075"><span class="hs-identifier hs-var">prov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AvailInfo -&gt; [GlobalRdrElt]) -&gt; [AvailInfo] -&gt; [GlobalRdrElt]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
HscEnv -&gt; Maybe ImportSpec -&gt; AvailInfo -&gt; [GlobalRdrElt]
HscEnv -&gt; Maybe ImportSpec -&gt; AvailInfo -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromAvail"><span class="hs-identifier hs-var">gresFromAvail</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053074"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ImportSpec
</span><a href="#local-6989586621683053075"><span class="hs-identifier hs-var">prov</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span class="annot"><a href="GHC.Rename.Names.html#importsFromIface"><span class="hs-identifier hs-type">importsFromIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-1160"></span><span id="importsFromIface"><span class="annot"><span class="annottext">importsFromIface :: HscEnv -&gt; ModIface -&gt; ImpDeclSpec -&gt; Maybe Defs -&gt; GlobalRdrEnv
</span><a href="GHC.Rename.Names.html#importsFromIface"><span class="hs-identifier hs-var hs-var">importsFromIface</span></a></span></span><span> </span><span id="local-6989586621683053077"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053077"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683053078"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053078"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683053079"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053079"><span class="hs-identifier hs-var">decl_spec</span></a></span></span><span> </span><span id="local-6989586621683053080"><span class="annot"><span class="annottext">Maybe Defs
</span><a href="#local-6989586621683053080"><span class="hs-identifier hs-var">hidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; GlobalRdrEnv) -&gt; [GlobalRdrElt] -&gt; GlobalRdrEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Defs
</span><a href="#local-6989586621683053080"><span class="hs-identifier hs-var">hidden</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1161"></span><span>    </span><span class="annot"><span class="annottext">Maybe Defs
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053081"><span class="hs-identifier hs-var">all_gres</span></a></span><span>
</span><span id="line-1162"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053082"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053082"><span class="hs-identifier hs-var">hidden_names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (GlobalRdrElt -&gt; Bool) -&gt; GlobalRdrElt -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053082"><span class="hs-identifier hs-var">hidden_names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (GlobalRdrElt -&gt; Name) -&gt; GlobalRdrElt -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053081"><span class="hs-identifier hs-var">all_gres</span></a></span><span>
</span><span id="line-1163"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1164"></span><span>    </span><span id="local-6989586621683053081"><span class="annot"><span class="annottext">all_gres :: [GlobalRdrElt]
</span><a href="#local-6989586621683053081"><span class="hs-identifier hs-var hs-var">all_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe ImportSpec -&gt; [AvailInfo] -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromAvails"><span class="hs-identifier hs-var">gresFromAvails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053077"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportSpec -&gt; Maybe ImportSpec
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053084"><span class="hs-identifier hs-var">imp_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; [AvailInfo]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [AvailInfo]
</span><a href="GHC.Unit.Module.ModIface.html#mi_exports"><span class="hs-identifier hs-var">mi_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053078"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>    </span><span id="local-6989586621683053084"><span class="annot"><span class="annottext">imp_spec :: ImportSpec
</span><a href="#local-6989586621683053084"><span class="hs-identifier hs-var hs-var">imp_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpSpec"><span class="hs-identifier hs-type">ImpSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_decl :: ImpDeclSpec
</span><a href="GHC.Types.Name.Reader.html#is_decl"><span class="hs-identifier hs-var">is_decl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053079"><span class="hs-identifier hs-var">decl_spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_item :: ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#is_item"><span class="hs-identifier hs-var">is_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span class="annot"><a href="GHC.Rename.Names.html#filterImports"><span class="hs-identifier hs-type">filterImports</span></a></span><span>
</span><span id="line-1168"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-1169"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1170"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-1171"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span>
</span><span id="line-1172"></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Import spec</span></span><span>
</span><span id="line-1173"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportListInterpretation"><span class="hs-identifier hs-type">ImportListInterpretation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedLI"><span class="hs-identifier hs-type">LocatedLI</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1174"></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Whether this is a &quot;hiding&quot; import list</span></span><span>
</span><span id="line-1175"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportListInterpretation"><span class="hs-identifier hs-type">ImportListInterpretation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedLI"><span class="hs-identifier hs-type">LocatedLI</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Import spec w/ Names</span><span>
</span><span id="line-1176"></span><span>            </span><span class="annot"><a href="GHC.Tc.Types.html#ImpUserList"><span class="hs-identifier hs-type">ImpUserList</span></a></span><span class="hs-special">,</span><span>                      </span><span class="hs-comment">-- same, but designed for storage in interfaces</span><span>
</span><span id="line-1177"></span><span>            </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">)</span><span>                   </span><span class="hs-comment">-- Same again, but in GRE form</span><span>
</span><span id="line-1178"></span><span id="filterImports"><span class="annot"><span class="annottext">filterImports :: HasDebugCallStack =&gt;
HscEnv
-&gt; ModIface
-&gt; ImpDeclSpec
-&gt; Maybe
     (ImportListInterpretation, LocatedLI [LIE (GhcPass 'Parsed)])
-&gt; RnM
     (Maybe (ImportListInterpretation, LocatedLI [LIE GhcRn]),
      ImpUserList, GlobalRdrEnv)
</span><a href="GHC.Rename.Names.html#filterImports"><span class="hs-identifier hs-var hs-var">filterImports</span></a></span></span><span> </span><span id="local-6989586621683053159"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053159"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683053160"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053160"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683053161"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053161"><span class="hs-identifier hs-var">decl_spec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ImportListInterpretation, LocatedLI [LIE (GhcPass 'Parsed)])
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1179"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe
   (ImportListInterpretation,
    LocatedLI [GenLocated SrcSpanAnnA (IE GhcRn)]),
 ImpUserList, GlobalRdrEnv)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe
        (ImportListInterpretation,
         LocatedLI [GenLocated SrcSpanAnnA (IE GhcRn)]),
      ImpUserList, GlobalRdrEnv)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe
  (ImportListInterpretation,
   LocatedLI [GenLocated SrcSpanAnnA (IE GhcRn)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ImpUserList
</span><a href="GHC.Tc.Types.html#ImpUserAll"><span class="hs-identifier hs-var">ImpUserAll</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModIface -&gt; ImpDeclSpec -&gt; Maybe Defs -&gt; GlobalRdrEnv
</span><a href="GHC.Rename.Names.html#importsFromIface"><span class="hs-identifier hs-var">importsFromIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053159"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053160"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053161"><span class="hs-identifier hs-var">decl_spec</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Defs
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span class="annot"><a href="GHC.Rename.Names.html#filterImports"><span class="hs-identifier hs-var">filterImports</span></a></span><span> </span><span id="local-6989586621683053163"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053163"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683053164"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053164"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683053165"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053165"><span class="hs-identifier hs-var">decl_spec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683053166"><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="#local-6989586621683053166"><span class="hs-identifier hs-var">want_hiding</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053167"><span class="annot"><span class="annottext">SrcSpanAnnLI
</span><a href="#local-6989586621683053167"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053168"><span class="annot"><span class="annottext">[LIE (GhcPass 'Parsed)]
</span><a href="#local-6989586621683053168"><span class="hs-identifier hs-var">import_items</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1181"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- check for errors, convert RdrNames to Names</span><span>
</span><span id="line-1182"></span><span>        </span><span id="local-6989586621683053169"><span class="annot"><a href="#local-6989586621683053169"><span class="hs-identifier hs-var">items1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (IE (GhcPass 'Parsed))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      [(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])])
-&gt; [GenLocated SrcSpanAnnA (IE (GhcPass 'Parsed))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [[(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">LIE (GhcPass 'Parsed) -&gt; TcRn [(LIE GhcRn, [GlobalRdrElt])]
GenLocated SrcSpanAnnA (IE (GhcPass 'Parsed))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]
</span><a href="#local-6989586621683053170"><span class="hs-identifier hs-var">lookup_lie</span></a></span><span> </span><span class="annot"><span class="annottext">[LIE (GhcPass 'Parsed)]
[GenLocated SrcSpanAnnA (IE (GhcPass 'Parsed))]
</span><a href="#local-6989586621683053168"><span class="hs-identifier hs-var">import_items</span></a></span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683053171"><span class="hs-identifier hs-type">items2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1185"></span><span>            </span><span id="local-6989586621683053171"><span class="annot"><a href="#local-6989586621683053171"><span class="hs-identifier hs-var hs-var">items2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]]
-&gt; [(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]]
</span><a href="#local-6989586621683053169"><span class="hs-identifier hs-var">items1</span></a></span><span>
</span><span id="line-1186"></span><span>                </span><span class="hs-comment">-- NB we may have duplicates, and several items</span><span>
</span><span id="line-1187"></span><span>                </span><span class="hs-comment">--    for the same parent; e.g N(x) and N(y)</span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621683053172"><span class="annot"><a href="#local-6989586621683053172"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053173"><span class="annot"><a href="#local-6989586621683053173"><span class="hs-identifier hs-var">imp_user_list</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683053166"><span class="hs-identifier hs-type">want_hiding</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1190"></span><span>              </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1191"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053174"><span class="annot"><span class="annottext">gre_env :: GlobalRdrEnv
</span><a href="#local-6989586621683053174"><span class="hs-identifier hs-var hs-var">gre_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; GlobalRdrEnv) -&gt; [GlobalRdrElt] -&gt; GlobalRdrEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])
 -&gt; [GlobalRdrElt])
-&gt; [(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]
-&gt; [GlobalRdrElt]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; (LIE GhcRn, [GlobalRdrElt]) -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromIE"><span class="hs-identifier hs-var">gresFromIE</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053165"><span class="hs-identifier hs-var">decl_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LIE GhcRn, [GlobalRdrElt])]
[(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]
</span><a href="#local-6989586621683053171"><span class="hs-identifier hs-var">items2</span></a></span><span>
</span><span id="line-1192"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053174"><span class="hs-identifier hs-var">gre_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; ImpUserList
</span><a href="GHC.Tc.Types.html#ImpUserExplicit"><span class="hs-identifier hs-var">ImpUserExplicit</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053174"><span class="hs-identifier hs-var">gre_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1193"></span><span>              </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#EverythingBut"><span class="hs-identifier hs-var">EverythingBut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1194"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053178"><span class="annot"><span class="annottext">hidden_names :: Defs
</span><a href="#local-6989586621683053178"><span class="hs-identifier hs-var hs-var">hidden_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Defs) -&gt; [Name] -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt]) -&gt; [Name])
-&gt; [(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])] -&gt; [Name]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; [Name])
-&gt; ((GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])
    -&gt; [GlobalRdrElt])
-&gt; (GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])
-&gt; [GlobalRdrElt]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LIE GhcRn, [GlobalRdrElt])]
[(GenLocated SrcSpanAnnA (IE GhcRn), [GlobalRdrElt])]
</span><a href="#local-6989586621683053171"><span class="hs-identifier hs-var">items2</span></a></span><span>
</span><span id="line-1195"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; ModIface -&gt; ImpDeclSpec -&gt; Maybe Defs -&gt; GlobalRdrEnv
</span><a href="GHC.Rename.Names.html#importsFromIface"><span class="hs-identifier hs-var">importsFromIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053163"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053164"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053165"><span class="hs-identifier hs-var">decl_spec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defs -&gt; Maybe Defs
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053178"><span class="hs-identifier hs-var">hidden_names</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Defs -&gt; ImpUserList
</span><a href="GHC.Tc.Types.html#ImpUserEverythingBut"><span class="hs-identifier hs-var">ImpUserEverythingBut</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053178"><span class="hs-identifier hs-var">hidden_names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053166"><span class="hs-identifier hs-type">want_hiding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053167"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621683053171"><span class="hs-identifier hs-type">items2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683053173"><span class="hs-identifier hs-type">imp_user_list</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683053172"><span class="hs-identifier hs-type">gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1199"></span><span>    </span><span id="local-6989586621683053181"><span class="annot"><span class="annottext">import_mod :: Module
</span><a href="#local-6989586621683053181"><span class="hs-identifier hs-var hs-var">import_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053164"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1200"></span><span>    </span><span id="local-6989586621683053182"><span class="annot"><span class="annottext">all_avails :: [AvailInfo]
</span><a href="#local-6989586621683053182"><span class="hs-identifier hs-var hs-var">all_avails</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; [AvailInfo]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [AvailInfo]
</span><a href="GHC.Unit.Module.ModIface.html#mi_exports"><span class="hs-identifier hs-var">mi_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053164"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1201"></span><span>    </span><span id="local-6989586621683053183"><span class="annot"><span class="annottext">imp_occ_env :: OccEnv (NameEnv ImpOccItem)
</span><a href="#local-6989586621683053183"><span class="hs-identifier hs-var hs-var">imp_occ_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ImpDeclSpec -&gt; [AvailInfo] -&gt; OccEnv (NameEnv ImpOccItem)
</span><a href="GHC.Rename.Names.html#mkImportOccEnv"><span class="hs-identifier hs-var">mkImportOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053163"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053165"><span class="hs-identifier hs-var">decl_spec</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053182"><span class="hs-identifier hs-var">all_avails</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>    </span><span class="hs-comment">-- Look up a parent (type constructor, class or data constructor)</span><span>
</span><span id="line-1204"></span><span>    </span><span class="hs-comment">-- in an import.</span><span>
</span><span id="line-1205"></span><span>    </span><span class="annot"><a href="#local-6989586621683053185"><span class="hs-identifier hs-type">lookup_parent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span>
</span><span id="line-1206"></span><span>    </span><span id="local-6989586621683053185"><span class="annot"><span class="annottext">lookup_parent :: IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM ImpOccItem
</span><a href="#local-6989586621683053185"><span class="hs-identifier hs-var hs-var">lookup_parent</span></a></span></span><span> </span><span id="local-6989586621683053186"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053186"><span class="hs-identifier hs-var">ie</span></a></span></span><span> </span><span id="local-6989586621683053187"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053187"><span class="hs-identifier hs-var">rdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1207"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IELookupM ImpOccItem -&gt; IELookupM ImpOccItem
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isVarNameSpace"><span class="hs-identifier hs-var">isVarNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621683053189"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;filterImports lookup_parent: unexpected variable&quot;</span></span><span>
</span><span id="line-1209"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rdr:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053187"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1210"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;namespace:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; SDoc
</span><a href="GHC.Types.Name.Occurrence.html#pprNameSpace"><span class="hs-identifier hs-var">pprNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621683053189"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IELookupM ImpOccItem -&gt; IELookupM ImpOccItem)
-&gt; IELookupM ImpOccItem -&gt; IELookupM ImpOccItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1211"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053190"><span class="annot"><a href="#local-6989586621683053190"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM (NonEmpty ImpOccItem)
</span><a href="#local-6989586621683053191"><span class="hs-identifier hs-var">lookup_names</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053186"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053187"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1212"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683053190"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1213"></span><span>            </span><span id="local-6989586621683053192"><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053192"><span class="hs-identifier hs-var">cax</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpOccItem -&gt; IELookupM ImpOccItem
forall a. a -&gt; MaybeErr IELookupError a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053192"><span class="hs-identifier hs-var">cax</span></a></span><span>
</span><span id="line-1214"></span><span>            </span><span class="annot"><span class="annottext">NonEmpty ImpOccItem
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IELookupM ImpOccItem
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;filter_imports lookup_parent ambiguous&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IELookupM ImpOccItem) -&gt; SDoc -&gt; IELookupM ImpOccItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1215"></span><span>                           </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rdr:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053187"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1216"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookups:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImpOccItem -&gt; GlobalRdrElt)
-&gt; NonEmpty ImpOccItem -&gt; NonEmpty GlobalRdrElt
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ImpOccItem
</span><a href="#local-6989586621683053190"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1217"></span><span>              </span><span class="hs-comment">-- Looking up non-variables is always unambiguous,</span><span>
</span><span id="line-1218"></span><span>              </span><span class="hs-comment">-- as there can be at most one corresponding item</span><span>
</span><span id="line-1219"></span><span>              </span><span class="hs-comment">-- in the imp_occ_env.</span><span>
</span><span id="line-1220"></span><span>              </span><span class="hs-comment">-- See item (1) of Note [Exporting duplicate declarations]</span><span>
</span><span id="line-1221"></span><span>              </span><span class="hs-comment">-- in GHC.Tc.Gen.Export.</span><span>
</span><span id="line-1222"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1223"></span><span>        </span><span id="local-6989586621683053195"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683053195"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053187"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1224"></span><span>        </span><span id="local-6989586621683053189"><span class="annot"><span class="annottext">ns :: NameSpace
</span><a href="#local-6989586621683053189"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#occNameSpace"><span class="hs-identifier hs-var">occNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053195"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span>    </span><span class="hs-comment">-- Look up a RdrName used in an import, returning multiple values if there</span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-comment">-- are several fields with the same name exposed by the module</span><span>
</span><span id="line-1228"></span><span>    </span><span class="annot"><a href="#local-6989586621683053191"><span class="hs-identifier hs-type">lookup_names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>    </span><span id="local-6989586621683053191"><span class="annot"><span class="annottext">lookup_names :: IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM (NonEmpty ImpOccItem)
</span><a href="#local-6989586621683053191"><span class="hs-identifier hs-var hs-var">lookup_names</span></a></span></span><span> </span><span id="local-6989586621683053196"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053196"><span class="hs-identifier hs-var">ie</span></a></span></span><span> </span><span id="local-6989586621683053197"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053197"><span class="hs-identifier hs-var">rdr</span></a></span></span><span>
</span><span id="line-1230"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isQual"><span class="hs-identifier hs-var">isQual</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053197"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1231"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IELookupError -&gt; IELookupM (NonEmpty ImpOccItem)
forall a. IELookupError -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-var">failLookupWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; IELookupError
</span><a href="GHC.Rename.Names.html#QualImportError"><span class="hs-identifier hs-var">QualImportError</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053197"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1233"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ImpOccItem]
</span><a href="#local-6989586621683053201"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1234"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IELookupError -&gt; IELookupM (NonEmpty ImpOccItem)
forall a. IELookupError -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-var">failLookupWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; IsSubordinate -&gt; IELookupError
</span><a href="GHC.Rename.Names.html#BadImport"><span class="hs-identifier hs-var">BadImport</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053196"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="GHC.Rename.Names.html#IsNotSubordinate"><span class="hs-identifier hs-var">IsNotSubordinate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span>           </span><span id="local-6989586621683053204"><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053204"><span class="hs-identifier hs-var">item</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683053205"><span class="annot"><span class="annottext">[ImpOccItem]
</span><a href="#local-6989586621683053205"><span class="hs-identifier hs-var">items</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty ImpOccItem -&gt; IELookupM (NonEmpty ImpOccItem)
forall a. a -&gt; MaybeErr IELookupError a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty ImpOccItem -&gt; IELookupM (NonEmpty ImpOccItem))
-&gt; NonEmpty ImpOccItem -&gt; IELookupM (NonEmpty ImpOccItem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053204"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="annot"><span class="annottext">ImpOccItem -&gt; [ImpOccItem] -&gt; NonEmpty ImpOccItem
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[ImpOccItem]
</span><a href="#local-6989586621683053205"><span class="hs-identifier hs-var">items</span></a></span><span>
</span><span id="line-1236"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1237"></span><span>        </span><span id="local-6989586621683053201"><span class="annot"><span class="annottext">lookups :: [ImpOccItem]
</span><a href="#local-6989586621683053201"><span class="hs-identifier hs-var hs-var">lookups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NameEnv ImpOccItem -&gt; [ImpOccItem])
-&gt; [NameEnv ImpOccItem] -&gt; [ImpOccItem]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">NameEnv ImpOccItem -&gt; [ImpOccItem]
forall a. NameEnv a -&gt; [a]
</span><a href="GHC.Types.Name.Env.html#nonDetNameEnvElts"><span class="hs-identifier hs-var">nonDetNameEnvElts</span></a></span><span>
</span><span id="line-1238"></span><span>                </span><span class="annot"><span class="annottext">([NameEnv ImpOccItem] -&gt; [ImpOccItem])
-&gt; [NameEnv ImpOccItem] -&gt; [ImpOccItem]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
-&gt; OccEnv (NameEnv ImpOccItem) -&gt; OccName -&gt; [NameEnv ImpOccItem]
</span><a href="GHC.Rename.Names.html#lookupImpOccEnv"><span class="hs-identifier hs-var">lookupImpOccEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OccEnv (NameEnv ImpOccItem)
</span><a href="#local-6989586621683053183"><span class="hs-identifier hs-var">imp_occ_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053197"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>    </span><span class="annot"><a href="#local-6989586621683053170"><span class="hs-identifier hs-type">lookup_lie</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1241"></span><span>    </span><span id="local-6989586621683053170"><span class="annot"><span class="annottext">lookup_lie :: LIE (GhcPass 'Parsed) -&gt; TcRn [(LIE GhcRn, [GlobalRdrElt])]
</span><a href="#local-6989586621683053170"><span class="hs-identifier hs-var hs-var">lookup_lie</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053209"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053209"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683053210"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053210"><span class="hs-identifier hs-var">ieRdr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; TcRn [(LIE GhcRn, [GlobalRdrElt])]
-&gt; TcRn [(LIE GhcRn, [GlobalRdrElt])]
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053209"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn [(LIE GhcRn, [GlobalRdrElt])]
 -&gt; TcRn [(LIE GhcRn, [GlobalRdrElt])])
-&gt; TcRn [(LIE GhcRn, [GlobalRdrElt])]
-&gt; TcRn [(LIE GhcRn, [GlobalRdrElt])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1243"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683053211"><span class="annot"><a href="#local-6989586621683053211"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053212"><span class="annot"><a href="#local-6989586621683053212"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
 -&gt; ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; Maybe ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   (Maybe ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1244"></span><span>                               </span><span class="annot"><span class="annottext">IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
forall a. IELookupM a -&gt; TcRn (Maybe a)
</span><a href="#local-6989586621683053214"><span class="hs-identifier hs-var">run_lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
</span><a href="#local-6989586621683053215"><span class="hs-identifier hs-var">lookup_ie</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053210"><span class="hs-identifier hs-var">ieRdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcRnDiagnostic"><span class="hs-identifier hs-type">addTcRnDiagnostic</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683053218"><span class="hs-identifier hs-type">warning_msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053212"><span class="hs-identifier hs-type">warns</span></a></span><span>
</span><span id="line-1246"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053209"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053219"><span class="hs-identifier hs-type">ie</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683053220"><span class="hs-identifier hs-type">gres</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683053219"><span class="annot"><a href="#local-6989586621683053219"><span class="hs-identifier hs-var">ie</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683053220"><span class="annot"><a href="#local-6989586621683053220"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683053211"><span class="hs-identifier hs-type">stuff</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1247"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-1248"></span><span>
</span><span id="line-1249"></span><span>            </span><span class="hs-comment">-- Warn when importing T(..) and no children are brought in scope</span><span>
</span><span id="line-1250"></span><span>            </span><span id="local-6989586621683053218"><span class="annot"><span class="annottext">warning_msg :: IELookupWarning -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcRnMessage
</span><a href="#local-6989586621683053218"><span class="hs-identifier hs-var hs-var">warning_msg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#DodgyImport"><span class="hs-identifier hs-type">DodgyImport</span></a></span><span> </span><span id="local-6989586621683053222"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053222"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1251"></span><span>              </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcRnMessage
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DodgyImportsReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnDodgyImports"><span class="hs-identifier hs-var">TcRnDodgyImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; DodgyImportsReason
</span><a href="GHC.Tc.Errors.Types.html#DodgyImportsEmptyParent"><span class="hs-identifier hs-var">DodgyImportsEmptyParent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053222"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1252"></span><span>            </span><span class="annot"><a href="#local-6989586621683053218"><span class="hs-identifier hs-var">warning_msg</span></a></span><span> </span><span class="annot"><span class="annottext">IELookupWarning
</span><a href="GHC.Rename.Names.html#MissingImportList"><span class="hs-identifier hs-var">MissingImportList</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1253"></span><span>              </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcRnMessage
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingImportList"><span class="hs-identifier hs-var">TcRnMissingImportList</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053210"><span class="hs-identifier hs-var">ieRdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>            </span><span class="annot"><a href="#local-6989586621683053218"><span class="hs-identifier hs-var">warning_msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#BadImportW"><span class="hs-identifier hs-type">BadImportW</span></a></span><span> </span><span id="local-6989586621683053228"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053228"><span class="hs-identifier hs-var">ie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1255"></span><span>              </span><span class="hs-comment">-- 'BadImportW' is only constructed below in 'handle_bad_import', in</span><span>
</span><span id="line-1256"></span><span>              </span><span class="hs-comment">-- the 'EverythingBut' case, so that's what we pass to</span><span>
</span><span id="line-1257"></span><span>              </span><span class="hs-comment">-- 'badImportItemErr'.</span><span>
</span><span id="line-1258"></span><span>              </span><span id="local-6989586621683053229"><span class="annot"><a href="#local-6989586621683053229"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModIface
-&gt; ImpDeclSpec
-&gt; IE (GhcPass 'Parsed)
-&gt; IsSubordinate
-&gt; [AvailInfo]
-&gt; TcRn ImportLookupReason
</span><a href="GHC.Rename.Names.html#badImportItemErr"><span class="hs-identifier hs-var">badImportItemErr</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053164"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053165"><span class="hs-identifier hs-var">decl_spec</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053228"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="GHC.Rename.Names.html#IsNotSubordinate"><span class="hs-identifier hs-var">IsNotSubordinate</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053182"><span class="hs-identifier hs-var">all_avails</span></a></span><span>
</span><span id="line-1259"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnDodgyImports"><span class="hs-identifier hs-type">TcRnDodgyImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DodgyImportsHiding"><span class="hs-identifier hs-type">DodgyImportsHiding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053229"><span class="hs-identifier hs-type">reason</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>            </span><span class="annot"><a href="#local-6989586621683053218"><span class="hs-identifier hs-var">warning_msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#DeprecatedExport"><span class="hs-identifier hs-type">DeprecatedExport</span></a></span><span> </span><span id="local-6989586621683053233"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053233"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683053234"><span class="annot"><span class="annottext">WarningTxt GhcRn
</span><a href="#local-6989586621683053234"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1261"></span><span>              </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcRnMessage
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcRnMessage)
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PragmaWarningInfo -&gt; WarningTxt GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnPragmaWarning"><span class="hs-identifier hs-var">TcRnPragmaWarning</span></a></span><span>
</span><span id="line-1262"></span><span>                         </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#PragmaWarningExport"><span class="hs-identifier hs-type">PragmaWarningExport</span></a></span><span>
</span><span id="line-1263"></span><span>                           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pwarn_occname :: OccName
</span><a href="GHC.Tc.Errors.Types.html#pwarn_occname"><span class="hs-identifier hs-var">pwarn_occname</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053233"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1264"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pwarn_impmod :: ModuleName
</span><a href="GHC.Tc.Errors.Types.html#pwarn_impmod"><span class="hs-identifier hs-var">pwarn_impmod</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683053181"><span class="hs-identifier hs-var">import_mod</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1265"></span><span>                         </span><span class="annot"><span class="annottext">WarningTxt GhcRn
</span><a href="#local-6989586621683053234"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span>            </span><span id="local-6989586621683051811"><span class="annot"><a href="#local-6989586621683053214"><span class="hs-identifier hs-type">run_lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683051811"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683051811"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1268"></span><span>            </span><span id="local-6989586621683053214"><span class="annot"><span class="annottext">run_lookup :: forall a. IELookupM a -&gt; TcRn (Maybe a)
</span><a href="#local-6989586621683053214"><span class="hs-identifier hs-var hs-var">run_lookup</span></a></span></span><span> </span><span id="local-6989586621683053244"><span class="annot"><span class="annottext">IELookupM a
</span><a href="#local-6989586621683053244"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IELookupM a
</span><a href="#local-6989586621683053244"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1269"></span><span>              </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621683053246"><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053246"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1270"></span><span>                </span><span id="local-6989586621683053247"><span class="annot"><a href="#local-6989586621683053247"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IELookupError -&gt; TcRn ImportLookupReason
</span><a href="#local-6989586621683053248"><span class="hs-identifier hs-var">lookup_err_msg</span></a></span><span> </span><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053246"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1271"></span><span>                </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnImportLookup"><span class="hs-identifier hs-type">TcRnImportLookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053247"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1273"></span><span>              </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621683053251"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683053251"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; TcRn (Maybe a)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683053251"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>            </span><span id="local-6989586621683053248"><span class="annot"><span class="annottext">lookup_err_msg :: IELookupError -&gt; TcRn ImportLookupReason
</span><a href="#local-6989586621683053248"><span class="hs-identifier hs-var hs-var">lookup_err_msg</span></a></span></span><span> </span><span id="local-6989586621683053252"><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053252"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053252"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1276"></span><span>              </span><span class="annot"><a href="GHC.Rename.Names.html#BadImport"><span class="hs-identifier hs-type">BadImport</span></a></span><span> </span><span id="local-6989586621683053253"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053253"><span class="hs-identifier hs-var">ie</span></a></span></span><span> </span><span id="local-6989586621683053254"><span class="annot"><span class="annottext">IsSubordinate
</span><a href="#local-6989586621683053254"><span class="hs-identifier hs-var">sub</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface
-&gt; ImpDeclSpec
-&gt; IE (GhcPass 'Parsed)
-&gt; IsSubordinate
-&gt; [AvailInfo]
-&gt; TcRn ImportLookupReason
</span><a href="GHC.Rename.Names.html#badImportItemErr"><span class="hs-identifier hs-var">badImportItemErr</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053164"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053165"><span class="hs-identifier hs-var">decl_spec</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053253"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="#local-6989586621683053254"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053182"><span class="hs-identifier hs-var">all_avails</span></a></span><span>
</span><span id="line-1277"></span><span>              </span><span class="annot"><span class="annottext">IELookupError
</span><a href="GHC.Rename.Names.html#IllegalImport"><span class="hs-identifier hs-var">IllegalImport</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImportLookupReason -&gt; TcRn ImportLookupReason
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ImportLookupReason
</span><a href="GHC.Tc.Errors.Types.html#ImportLookupIllegal"><span class="hs-identifier hs-var">ImportLookupIllegal</span></a></span><span>
</span><span id="line-1278"></span><span>              </span><span class="annot"><a href="GHC.Rename.Names.html#QualImportError"><span class="hs-identifier hs-type">QualImportError</span></a></span><span> </span><span id="local-6989586621683053257"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053257"><span class="hs-identifier hs-var">rdr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImportLookupReason -&gt; TcRn ImportLookupReason
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; ImportLookupReason
</span><a href="GHC.Tc.Errors.Types.html#ImportLookupQualified"><span class="hs-identifier hs-var">ImportLookupQualified</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053257"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1279"></span><span>
</span><span id="line-1280"></span><span>        </span><span class="hs-comment">-- For each import item, we convert its RdrNames to Names,</span><span>
</span><span id="line-1281"></span><span>        </span><span class="hs-comment">-- and at the same time compute all the GlobalRdrElt corresponding</span><span>
</span><span id="line-1282"></span><span>        </span><span class="hs-comment">-- to what is actually imported by this item.</span><span>
</span><span id="line-1283"></span><span>        </span><span class="hs-comment">-- Returns Nothing on error.</span><span>
</span><span id="line-1284"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1285"></span><span>        </span><span class="hs-comment">-- Returns a list because, with DuplicateRecordFields, a naked</span><span>
</span><span id="line-1286"></span><span>        </span><span class="hs-comment">-- import/export of a record field can correspond to multiple</span><span>
</span><span id="line-1287"></span><span>        </span><span class="hs-comment">-- different GlobalRdrElts. See Note [Importing DuplicateRecordFields].</span><span>
</span><span id="line-1288"></span><span>    </span><span class="annot"><a href="#local-6989586621683053215"><span class="hs-identifier hs-type">lookup_ie</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-1289"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Names.html#IELookupWarning"><span class="hs-identifier hs-type">IELookupWarning</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>    </span><span id="local-6989586621683053215"><span class="annot"><span class="annottext">lookup_ie :: IE (GhcPass 'Parsed)
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
</span><a href="#local-6989586621683053215"><span class="hs-identifier hs-var hs-var">lookup_ie</span></a></span></span><span> </span><span id="local-6989586621683053259"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
</span><a href="#local-6989586621683053260"><span class="hs-identifier hs-var">handle_bad_import</span></a></span><span> </span><span class="annot"><span class="annottext">(IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
 -&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1291"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1292"></span><span>        </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEVar"><span class="hs-identifier hs-type">IEVar</span></a></span><span> </span><span class="annot"><span class="annottext">XIEVar (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053262"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053262"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053263"><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053263"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc (GhcPass 'Parsed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1293"></span><span>            </span><span class="hs-comment">-- See Note [Importing DuplicateRecordFields]</span><span>
</span><span id="line-1294"></span><span>            </span><span id="local-6989586621683053264"><span class="annot"><a href="#local-6989586621683053264"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM (NonEmpty ImpOccItem)
</span><a href="#local-6989586621683053191"><span class="hs-identifier hs-var">lookup_names</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
forall (p :: Pass). IEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieWrappedName"><span class="hs-identifier hs-var">ieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053263"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1295"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053266"><span class="annot"><a href="#local-6989586621683053266"><span class="hs-identifier hs-var hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpOccItem -&gt; GlobalRdrElt) -&gt; [ImpOccItem] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="annot"><span class="annottext">([ImpOccItem] -&gt; [GlobalRdrElt]) -&gt; [ImpOccItem] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ImpOccItem -&gt; [ImpOccItem]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ImpOccItem
</span><a href="#local-6989586621683053264"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1296"></span><span>                </span><span id="local-6989586621683053268"><span class="annot"><a href="#local-6989586621683053268"><span class="hs-identifier hs-var hs-var">export_depr_warns</span></a></span></span><span>
</span><span id="line-1297"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="#local-6989586621683053166"><span class="hs-identifier hs-var">want_hiding</span></a></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation -&gt; ImportListInterpretation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span>
</span><span id="line-1298"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Maybe IELookupWarning)
-&gt; [GlobalRdrElt] -&gt; [IELookupWarning]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe IELookupWarning
</span><a href="#local-6989586621683053270"><span class="hs-identifier hs-var">mk_depr_export_warning</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053266"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1299"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1300"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEVar"><span class="hs-identifier hs-type">IEVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053262"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.ImpExp.html#replaceWrappedName"><span class="hs-identifier hs-type">replaceWrappedName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053263"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053272"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053273"><span class="hs-identifier hs-type">noDocstring</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683053274"><span class="hs-identifier hs-type">gre</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683053274"><span class="annot"><a href="#local-6989586621683053274"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683053266"><span class="hs-identifier hs-type">gres</span></a></span><span>
</span><span id="line-1302"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053272"><span class="annot"><a href="#local-6989586621683053272"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053274"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1303"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683053268"><span class="hs-identifier hs-type">export_depr_warns</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1304"></span><span>
</span><span id="line-1305"></span><span>        </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAll"><span class="hs-identifier hs-type">IEThingAll</span></a></span><span> </span><span class="annot"><span class="annottext">XIEThingAll (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053276"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053276"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053277"><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053277"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc (GhcPass 'Parsed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1306"></span><span>            </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053279"><span class="annot"><a href="#local-6989586621683053279"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-1307"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_bundled"><span class="hs-identifier hs-var">imp_bundled</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053281"><span class="annot"><a href="#local-6989586621683053281"><span class="hs-identifier hs-var">bundled_gres</span></a></span></span><span>
</span><span id="line-1308"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_is_parent"><span class="hs-identifier hs-var">imp_is_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053283"><span class="annot"><a href="#local-6989586621683053283"><span class="hs-identifier hs-var">is_par</span></a></span></span><span>
</span><span id="line-1309"></span><span>                       </span><span class="hs-special">}</span><span>
</span><span id="line-1310"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM ImpOccItem
</span><a href="#local-6989586621683053185"><span class="hs-identifier hs-var">lookup_parent</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; IELookupM ImpOccItem)
-&gt; RdrName -&gt; IELookupM ImpOccItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
forall (p :: Pass). IEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieWrappedName"><span class="hs-identifier hs-var">ieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053277"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1311"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053284"><span class="annot"><a href="#local-6989586621683053284"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053279"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1312"></span><span>                </span><span id="local-6989586621683053285"><span class="annot"><a href="#local-6989586621683053285"><span class="hs-identifier hs-var hs-var">child_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053283"><span class="hs-identifier hs-var">is_par</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053281"><span class="hs-identifier hs-var">bundled_gres</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1313"></span><span>                </span><span id="local-6989586621683053286"><span class="annot"><a href="#local-6989586621683053286"><span class="hs-identifier hs-var hs-var">imp_list_warn</span></a></span></span><span>
</span><span id="line-1314"></span><span>
</span><span id="line-1315"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053285"><span class="hs-identifier hs-var">child_gres</span></a></span><span>
</span><span id="line-1316"></span><span>                  </span><span class="hs-comment">-- e.g. f(..) or T(..) where T is a type synonym</span><span>
</span><span id="line-1317"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; IELookupWarning
</span><a href="GHC.Rename.Names.html#DodgyImport"><span class="hs-identifier hs-var">DodgyImport</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053279"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1318"></span><span>
</span><span id="line-1319"></span><span>                  </span><span class="hs-comment">-- e.g. import M( T(..) )</span><span>
</span><span id="line-1320"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#is_qual"><span class="hs-identifier hs-var">is_qual</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053165"><span class="hs-identifier hs-var">decl_spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1321"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IELookupWarning
</span><a href="GHC.Rename.Names.html#MissingImportList"><span class="hs-identifier hs-var">MissingImportList</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1322"></span><span>
</span><span id="line-1323"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1324"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1325"></span><span>
</span><span id="line-1326"></span><span>                </span><span id="local-6989586621683053287"><span class="annot"><a href="#local-6989586621683053287"><span class="hs-identifier hs-var hs-var">renamed_ie</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XIEThingAll GhcRn
-&gt; LIEWrappedName GhcRn -&gt; Maybe (ExportDoc GhcRn) -&gt; IE GhcRn
forall pass.
XIEThingAll pass
-&gt; LIEWrappedName pass -&gt; Maybe (ExportDoc pass) -&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAll"><span class="hs-identifier hs-var">IEThingAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EpToken &quot;(&quot;, EpToken &quot;..&quot;, EpToken &quot;)&quot;)
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IEWrappedName GhcRn
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053276"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP GhcRn -&gt; IEWrappedName GhcRn
</span><a href="GHC.Hs.ImpExp.html#replaceWrappedName"><span class="hs-identifier hs-var">replaceWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053277"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053284"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><a href="#local-6989586621683053273"><span class="hs-identifier hs-var">noDocstring</span></a></span><span>
</span><span id="line-1327"></span><span>                </span><span id="local-6989586621683053289"><span class="annot"><a href="#local-6989586621683053289"><span class="hs-identifier hs-var hs-var">export_depr_warn</span></a></span></span><span>
</span><span id="line-1328"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="#local-6989586621683053166"><span class="hs-identifier hs-var">want_hiding</span></a></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation -&gt; ImportListInterpretation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span>
</span><span id="line-1329"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IELookupWarning -&gt; [IELookupWarning]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe IELookupWarning -&gt; [IELookupWarning])
-&gt; Maybe IELookupWarning -&gt; [IELookupWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe IELookupWarning
</span><a href="#local-6989586621683053270"><span class="hs-identifier hs-var">mk_depr_export_warning</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053279"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1330"></span><span>                        </span><span class="hs-comment">-- We don't want to warn about the children as they</span><span>
</span><span id="line-1331"></span><span>                        </span><span class="hs-comment">-- are not explicitly mentioned; the warning will</span><span>
</span><span id="line-1332"></span><span>                        </span><span class="hs-comment">-- be emitted later on if they are used</span><span>
</span><span id="line-1333"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1334"></span><span>
</span><span id="line-1335"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053287"><span class="hs-identifier hs-type">renamed_ie</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683053279"><span class="hs-identifier hs-type">gre</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683053285"><span class="hs-identifier hs-type">child_gres</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1336"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683053286"><span class="hs-identifier hs-type">imp_list_warn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683053289"><span class="hs-identifier hs-type">export_depr_warn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1337"></span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span>        </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAbs"><span class="hs-identifier hs-type">IEThingAbs</span></a></span><span> </span><span class="annot"><span class="annottext">XIEThingAbs (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053292"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053292"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053293"><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053293"><span class="hs-identifier hs-var">tc'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc (GhcPass 'Parsed))
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1340"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="#local-6989586621683053166"><span class="hs-identifier hs-var">want_hiding</span></a></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation -&gt; ImportListInterpretation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#EverythingBut"><span class="hs-identifier hs-var">EverythingBut</span></a></span><span>   </span><span class="hs-comment">-- hiding ( C )</span><span>
</span><span id="line-1341"></span><span>                       </span><span class="hs-comment">-- Here the 'C' can be a data constructor</span><span>
</span><span id="line-1342"></span><span>                       </span><span class="hs-comment">--  *or* a type/class, or even both</span><span>
</span><span id="line-1343"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053294"><span class="annot"><span class="annottext">tc :: IdP (GhcPass 'Parsed)
</span><a href="#local-6989586621683053294"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
forall (p :: Pass). IEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieWrappedName"><span class="hs-identifier hs-var">ieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053293"><span class="hs-identifier hs-var">tc'</span></a></span><span>
</span><span id="line-1344"></span><span>                   </span><span id="local-6989586621683053295"><span class="annot"><span class="annottext">tc_name :: IELookupM ImpOccItem
</span><a href="#local-6989586621683053295"><span class="hs-identifier hs-var hs-var">tc_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM ImpOccItem
</span><a href="#local-6989586621683053185"><span class="hs-identifier hs-var">lookup_parent</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Parsed)
RdrName
</span><a href="#local-6989586621683053294"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1345"></span><span>                   </span><span id="local-6989586621683053296"><span class="annot"><span class="annottext">dc_name :: IELookupM ImpOccItem
</span><a href="#local-6989586621683053296"><span class="hs-identifier hs-var hs-var">dc_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM ImpOccItem
</span><a href="#local-6989586621683053185"><span class="hs-identifier hs-var">lookup_parent</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; NameSpace -&gt; RdrName
</span><a href="GHC.Parser.PostProcess.html#setRdrNameSpace"><span class="hs-identifier hs-var">setRdrNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Parsed)
RdrName
</span><a href="#local-6989586621683053294"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#srcDataName"><span class="hs-identifier hs-var">srcDataName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1346"></span><span>               </span><span class="hs-keyword">in</span><span>
</span><span id="line-1347"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[IELookupM ImpOccItem] -&gt; [ImpOccItem]
forall a. [IELookupM a] -&gt; [a]
</span><a href="GHC.Rename.Names.html#catIELookupM"><span class="hs-identifier hs-var">catIELookupM</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">IELookupM ImpOccItem
</span><a href="#local-6989586621683053295"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IELookupM ImpOccItem
</span><a href="#local-6989586621683053296"><span class="hs-identifier hs-var">dc_name</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1348"></span><span>                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IELookupError
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. IELookupError -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-var">failLookupWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; IsSubordinate -&gt; IELookupError
</span><a href="GHC.Rename.Names.html#BadImport"><span class="hs-identifier hs-var">BadImport</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="GHC.Rename.Names.html#IsNotSubordinate"><span class="hs-identifier hs-var">IsNotSubordinate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1349"></span><span>                 </span><span id="local-6989586621683053299"><span class="annot"><span class="annottext">[ImpOccItem]
</span><a href="#local-6989586621683053299"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. a -&gt; MaybeErr IELookupError a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
-&gt; SrcSpanAnnA -&gt; GlobalRdrElt -&gt; (IE GhcRn, [GlobalRdrElt])
forall {info}.
IEWrappedName (GhcPass 'Parsed)
-&gt; SrcSpanAnnA
-&gt; GlobalRdrEltX info
-&gt; (IE GhcRn, [GlobalRdrEltX info])
</span><a href="#local-6989586621683053300"><span class="hs-identifier hs-var">mkIEThingAbs</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053293"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053292"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053301"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683053301"><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053301"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ImpOccItem]
</span><a href="#local-6989586621683053299"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1350"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1351"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053302"><span class="annot"><a href="#local-6989586621683053302"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM ImpOccItem
</span><a href="#local-6989586621683053185"><span class="hs-identifier hs-var">lookup_parent</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053259"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
forall (p :: Pass). IEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieWrappedName"><span class="hs-identifier hs-var">ieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053293"><span class="hs-identifier hs-var">tc'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1352"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683053300"><span class="hs-identifier hs-type">mkIEThingAbs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053293"><span class="hs-identifier hs-type">tc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053292"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053302"><span class="hs-identifier hs-type">gre</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1353"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683053270"><span class="hs-identifier hs-type">mk_depr_export_warning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053302"><span class="hs-identifier hs-type">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span>        </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingWith"><span class="hs-identifier hs-type">IEThingWith</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683053304"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt (GhcPass 'Parsed)))
</span><a href="#local-6989586621683053304"><span class="hs-identifier hs-var">deprecation</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053305"><span class="annot"><span class="annottext">IEThingWithAnns
</span><a href="#local-6989586621683053305"><span class="hs-identifier hs-var">ann</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683053306"><span class="annot"><span class="annottext">ltc :: LIEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053306"><span class="hs-identifier hs-var">ltc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053307"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053307"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053308"><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053308"><span class="hs-identifier hs-var">rdr_tc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683053309"><span class="annot"><span class="annottext">IEWildcard
</span><a href="#local-6989586621683053309"><span class="hs-identifier hs-var">wc</span></a></span></span><span> </span><span id="local-6989586621683053310"><span class="annot"><span class="annottext">[LIEWrappedName (GhcPass 'Parsed)]
</span><a href="#local-6989586621683053310"><span class="hs-identifier hs-var">rdr_ns</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc (GhcPass 'Parsed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1356"></span><span>           </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053311"><span class="annot"><a href="#local-6989586621683053311"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_bundled"><span class="hs-identifier hs-var">imp_bundled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053312"><span class="annot"><a href="#local-6989586621683053312"><span class="hs-identifier hs-var">subnames</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1357"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; RdrName -&gt; IELookupM ImpOccItem
</span><a href="#local-6989586621683053185"><span class="hs-identifier hs-var">lookup_parent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEThingAbs (GhcPass 'Parsed)
-&gt; LIEWrappedName (GhcPass 'Parsed)
-&gt; Maybe (ExportDoc (GhcPass 'Parsed))
-&gt; IE (GhcPass 'Parsed)
forall pass.
XIEThingAbs pass
-&gt; LIEWrappedName pass -&gt; Maybe (ExportDoc pass) -&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAbs"><span class="hs-identifier hs-var">IEThingAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt (GhcPass 'Parsed)))
XIEThingAbs (GhcPass 'Parsed)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053306"><span class="hs-identifier hs-var">ltc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc (GhcPass 'Parsed))
forall a. Maybe a
</span><a href="#local-6989586621683053273"><span class="hs-identifier hs-var">noDocstring</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
forall (p :: Pass). IEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieWrappedName"><span class="hs-identifier hs-var">ieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053308"><span class="hs-identifier hs-var">rdr_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1358"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053313"><span class="annot"><a href="#local-6989586621683053313"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053311"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span>           </span><span class="hs-comment">-- Look up the children in the sub-names of the parent</span><span>
</span><span id="line-1361"></span><span>           </span><span class="hs-comment">-- See Note [Importing DuplicateRecordFields]</span><span>
</span><span id="line-1362"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#lookupChildren"><span class="hs-identifier hs-type">lookupChildren</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053312"><span class="hs-identifier hs-type">subnames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053310"><span class="hs-identifier hs-type">rdr_ns</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1363"></span><span>
</span><span id="line-1364"></span><span>             </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621683053315"><span class="annot"><span class="annottext">[LIEWrappedName (GhcPass 'Parsed)]
</span><a href="#local-6989586621683053315"><span class="hs-identifier hs-var">rdrs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IELookupError
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. IELookupError -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-var">failLookupWith</span></a></span><span> </span><span class="annot"><span class="annottext">(IELookupError
 -&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IELookupError
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1365"></span><span>                            </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; IsSubordinate -&gt; IELookupError
</span><a href="GHC.Rename.Names.html#BadImport"><span class="hs-identifier hs-var">BadImport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEThingWith (GhcPass 'Parsed)
-&gt; LIEWrappedName (GhcPass 'Parsed)
-&gt; IEWildcard
-&gt; [LIEWrappedName (GhcPass 'Parsed)]
-&gt; Maybe (ExportDoc (GhcPass 'Parsed))
-&gt; IE (GhcPass 'Parsed)
forall pass.
XIEThingWith pass
-&gt; LIEWrappedName pass
-&gt; IEWildcard
-&gt; [LIEWrappedName pass]
-&gt; Maybe (ExportDoc pass)
-&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingWith"><span class="hs-identifier hs-var">IEThingWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt (GhcPass 'Parsed)))
</span><a href="#local-6989586621683053304"><span class="hs-identifier hs-var">deprecation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IEThingWithAnns
</span><a href="#local-6989586621683053305"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LIEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053306"><span class="hs-identifier hs-var">ltc</span></a></span><span> </span><span class="annot"><span class="annottext">IEWildcard
</span><a href="#local-6989586621683053309"><span class="hs-identifier hs-var">wc</span></a></span><span> </span><span class="annot"><span class="annottext">[LIEWrappedName (GhcPass 'Parsed)]
</span><a href="#local-6989586621683053315"><span class="hs-identifier hs-var">rdrs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc (GhcPass 'Parsed))
forall a. Maybe a
</span><a href="#local-6989586621683053273"><span class="hs-identifier hs-var">noDocstring</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="GHC.Rename.Names.html#IsSubordinate"><span class="hs-identifier hs-var">IsSubordinate</span></a></span><span>
</span><span id="line-1366"></span><span>                                </span><span class="hs-comment">-- We are trying to import T( a,b,c,d ), and failed</span><span>
</span><span id="line-1367"></span><span>                                </span><span class="hs-comment">-- to find 'b' and 'd'.  So we make up an import item</span><span>
</span><span id="line-1368"></span><span>                                </span><span class="hs-comment">-- to report as failing, namely T( b, d ).</span><span>
</span><span id="line-1369"></span><span>                                </span><span class="hs-comment">-- c.f. #15412</span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span>             </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621683053317"><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
</span><a href="#local-6989586621683053317"><span class="hs-identifier hs-var">childnames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1372"></span><span>                </span><span class="annot"><span class="annottext">([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. a -&gt; MaybeErr IELookupError a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEThingWith GhcRn
-&gt; LIEWrappedName GhcRn
-&gt; IEWildcard
-&gt; [LIEWrappedName GhcRn]
-&gt; Maybe (ExportDoc GhcRn)
-&gt; IE GhcRn
forall pass.
XIEThingWith pass
-&gt; LIEWrappedName pass
-&gt; IEWildcard
-&gt; [LIEWrappedName pass]
-&gt; Maybe (ExportDoc pass)
-&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingWith"><span class="hs-identifier hs-var">IEThingWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IEThingWithAnns
</span><a href="#local-6989586621683053305"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IEWrappedName GhcRn
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053307"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName GhcRn
</span><a href="#local-6989586621683053318"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IEWildcard
</span><a href="#local-6989586621683053309"><span class="hs-identifier hs-var">wc</span></a></span><span> </span><span class="annot"><span class="annottext">[LIEWrappedName GhcRn]
[GenLocated SrcSpanAnnA (IEWrappedName GhcRn)]
</span><a href="#local-6989586621683053319"><span class="hs-identifier hs-var">childnames'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><a href="#local-6989586621683053273"><span class="hs-identifier hs-var">noDocstring</span></a></span><span>
</span><span id="line-1373"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053320"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1374"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[IELookupWarning]
</span><a href="#local-6989586621683053321"><span class="hs-identifier hs-var">export_depr_warns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1375"></span><span>
</span><span id="line-1376"></span><span>              </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683053318"><span class="annot"><span class="annottext">name' :: IEWrappedName GhcRn
</span><a href="#local-6989586621683053318"><span class="hs-identifier hs-var hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP GhcRn -&gt; IEWrappedName GhcRn
</span><a href="GHC.Hs.ImpExp.html#replaceWrappedName"><span class="hs-identifier hs-var">replaceWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053308"><span class="hs-identifier hs-var">rdr_tc</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053313"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1377"></span><span>                    </span><span id="local-6989586621683053319"><span class="annot"><span class="annottext">childnames' :: [GenLocated SrcSpanAnnA (IEWrappedName GhcRn)]
</span><a href="#local-6989586621683053319"><span class="hs-identifier hs-var hs-var">childnames'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocatedA GlobalRdrElt
 -&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn))
-&gt; [LocatedA GlobalRdrElt]
-&gt; [GenLocated SrcSpanAnnA (IEWrappedName GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
GenLocated SrcSpanAnnA Name
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA Name
 -&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn))
-&gt; (LocatedA GlobalRdrElt -&gt; GenLocated SrcSpanAnnA Name)
-&gt; LocatedA GlobalRdrElt
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name)
-&gt; LocatedA GlobalRdrElt -&gt; GenLocated SrcSpanAnnA Name
forall a b.
(a -&gt; b) -&gt; GenLocated SrcSpanAnnA a -&gt; GenLocated SrcSpanAnnA b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
</span><a href="#local-6989586621683053317"><span class="hs-identifier hs-var">childnames</span></a></span><span>
</span><span id="line-1378"></span><span>                    </span><span id="local-6989586621683053320"><span class="annot"><span class="annottext">gres :: [GlobalRdrElt]
</span><a href="#local-6989586621683053320"><span class="hs-identifier hs-var hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053311"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(LocatedA GlobalRdrElt -&gt; GlobalRdrElt)
-&gt; [LocatedA GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LocatedA GlobalRdrElt -&gt; GlobalRdrElt
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
</span><a href="#local-6989586621683053317"><span class="hs-identifier hs-var">childnames</span></a></span><span>
</span><span id="line-1379"></span><span>                    </span><span id="local-6989586621683053321"><span class="annot"><span class="annottext">export_depr_warns :: [IELookupWarning]
</span><a href="#local-6989586621683053321"><span class="hs-identifier hs-var hs-var">export_depr_warns</span></a></span></span><span>
</span><span id="line-1380"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="#local-6989586621683053166"><span class="hs-identifier hs-var">want_hiding</span></a></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation -&gt; ImportListInterpretation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Maybe IELookupWarning)
-&gt; [GlobalRdrElt] -&gt; [IELookupWarning]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe IELookupWarning
</span><a href="#local-6989586621683053270"><span class="hs-identifier hs-var">mk_depr_export_warning</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053320"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1381"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1382"></span><span>
</span><span id="line-1383"></span><span>        </span><span id="local-6989586621683053323"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053323"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IELookupError
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. IELookupError -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-var">failLookupWith</span></a></span><span> </span><span class="annot"><span class="annottext">IELookupError
</span><a href="GHC.Rename.Names.html#IllegalImport"><span class="hs-identifier hs-var">IllegalImport</span></a></span><span>
</span><span id="line-1384"></span><span>        </span><span class="hs-comment">-- could be IEModuleContents, IEGroup, IEDoc, IEDocNamed...</span><span>
</span><span id="line-1385"></span><span>        </span><span class="hs-comment">-- all of those constitute errors.</span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1388"></span><span>        </span><span id="local-6989586621683053300"><span class="annot"><span class="annottext">mkIEThingAbs :: IEWrappedName (GhcPass 'Parsed)
-&gt; SrcSpanAnnA
-&gt; GlobalRdrEltX info
-&gt; (IE GhcRn, [GlobalRdrEltX info])
</span><a href="#local-6989586621683053300"><span class="hs-identifier hs-var hs-var">mkIEThingAbs</span></a></span></span><span> </span><span id="local-6989586621683053324"><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053324"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683053325"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053325"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053326"><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053326"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-1389"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEThingAbs GhcRn
-&gt; LIEWrappedName GhcRn -&gt; Maybe (ExportDoc GhcRn) -&gt; IE GhcRn
forall pass.
XIEThingAbs pass
-&gt; LIEWrappedName pass -&gt; Maybe (ExportDoc pass) -&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAbs"><span class="hs-identifier hs-var">IEThingAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
XIEThingAbs GhcRn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IEWrappedName GhcRn
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053325"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP GhcRn -&gt; IEWrappedName GhcRn
</span><a href="GHC.Hs.ImpExp.html#replaceWrappedName"><span class="hs-identifier hs-var">replaceWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053324"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053327"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><a href="#local-6989586621683053273"><span class="hs-identifier hs-var">noDocstring</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053326"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1390"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683053327"><span class="annot"><span class="annottext">n :: Name
</span><a href="#local-6989586621683053327"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053326"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span>        </span><span class="hs-comment">-- N.B. imports never have docstrings</span><span>
</span><span id="line-1393"></span><span>        </span><span id="local-6989586621683053273"><span class="annot"><span class="annottext">noDocstring :: Maybe a
</span><a href="#local-6989586621683053273"><span class="hs-identifier hs-var hs-var">noDocstring</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1394"></span><span>
</span><span id="line-1395"></span><span>        </span><span id="local-6989586621683053260"><span class="annot"><span class="annottext">handle_bad_import :: IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
</span><a href="#local-6989586621683053260"><span class="hs-identifier hs-var hs-var">handle_bad_import</span></a></span></span><span> </span><span id="local-6989586621683053328"><span class="annot"><span class="annottext">IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
</span><a href="#local-6989586621683053328"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; (IELookupError
    -&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a.
IELookupM a -&gt; (IELookupError -&gt; IELookupM a) -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#catchIELookup"><span class="hs-identifier hs-var">catchIELookup</span></a></span><span> </span><span class="annot"><span class="annottext">IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
</span><a href="#local-6989586621683053328"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">((IELookupError
  -&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
 -&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; (IELookupError
    -&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning]))
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683053330"><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053330"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053330"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1396"></span><span>          </span><span class="annot"><a href="GHC.Rename.Names.html#BadImport"><span class="hs-identifier hs-type">BadImport</span></a></span><span> </span><span id="local-6989586621683053331"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053331"><span class="hs-identifier hs-var">ie</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsSubordinate
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1397"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="#local-6989586621683053166"><span class="hs-identifier hs-var">want_hiding</span></a></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation -&gt; ImportListInterpretation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#EverythingBut"><span class="hs-identifier hs-var">EverythingBut</span></a></span><span>
</span><span id="line-1398"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. a -&gt; MaybeErr IELookupError a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; IELookupWarning
</span><a href="GHC.Rename.Names.html#BadImportW"><span class="hs-identifier hs-var">BadImportW</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053331"><span class="hs-identifier hs-var">ie</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>          </span><span class="annot"><span class="annottext">IELookupError
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IELookupError
-&gt; IELookupM ([(IE GhcRn, [GlobalRdrElt])], [IELookupWarning])
forall a. IELookupError -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-var">failLookupWith</span></a></span><span> </span><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053330"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1400"></span><span>
</span><span id="line-1401"></span><span>        </span><span id="local-6989586621683053270"><span class="annot"><span class="annottext">mk_depr_export_warning :: GlobalRdrElt -&gt; Maybe IELookupWarning
</span><a href="#local-6989586621683053270"><span class="hs-identifier hs-var hs-var">mk_depr_export_warning</span></a></span></span><span> </span><span id="local-6989586621683053332"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053332"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-1402"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; WarningTxt GhcRn -&gt; IELookupWarning
</span><a href="GHC.Rename.Names.html#DeprecatedExport"><span class="hs-identifier hs-var">DeprecatedExport</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053333"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningTxt GhcRn -&gt; IELookupWarning)
-&gt; Maybe (WarningTxt GhcRn) -&gt; Maybe IELookupWarning
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Name -&gt; Maybe (WarningTxt GhcRn)
</span><a href="GHC.Unit.Module.ModIface.html#mi_export_warn_fn"><span class="hs-identifier hs-var">mi_export_warn_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_final_exts"><span class="hs-identifier hs-var">mi_final_exts</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053164"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053333"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1403"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1404"></span><span>            </span><span id="local-6989586621683053333"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683053333"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053332"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1405"></span><span>
</span><span id="line-1406"></span><span class="hs-keyword">type</span><span> </span><span id="IELookupM"><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-var">IELookupM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupError"><span class="hs-identifier hs-type">IELookupError</span></a></span><span>
</span><span id="line-1407"></span><span>
</span><span id="line-1408"></span><span class="hs-keyword">data</span><span> </span><span id="IELookupWarning"><span class="annot"><a href="GHC.Rename.Names.html#IELookupWarning"><span class="hs-identifier hs-var">IELookupWarning</span></a></span></span><span>
</span><span id="line-1409"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="BadImportW"><span class="annot"><a href="GHC.Rename.Names.html#BadImportW"><span class="hs-identifier hs-var">BadImportW</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1410"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingImportList"><span class="annot"><a href="GHC.Rename.Names.html#MissingImportList"><span class="hs-identifier hs-var">MissingImportList</span></a></span></span><span>
</span><span id="line-1411"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DodgyImport"><span class="annot"><a href="GHC.Rename.Names.html#DodgyImport"><span class="hs-identifier hs-var">DodgyImport</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-1412"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DeprecatedExport"><span class="annot"><a href="GHC.Rename.Names.html#DeprecatedExport"><span class="hs-identifier hs-var">DeprecatedExport</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Warnings.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span class="annot"><span class="hs-comment">-- | Is this import/export item a subordinate or not?</span></span><span>
</span><span id="line-1415"></span><span class="hs-keyword">data</span><span> </span><span id="IsSubordinate"><span class="annot"><a href="GHC.Rename.Names.html#IsSubordinate"><span class="hs-identifier hs-var">IsSubordinate</span></a></span></span><span>
</span><span id="line-1416"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IsSubordinate"><span class="annot"><a href="GHC.Rename.Names.html#IsSubordinate"><span class="hs-identifier hs-var">IsSubordinate</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="IsNotSubordinate"><span class="annot"><a href="GHC.Rename.Names.html#IsNotSubordinate"><span class="hs-identifier hs-var">IsNotSubordinate</span></a></span></span><span>
</span><span id="line-1417"></span><span>
</span><span id="line-1418"></span><span class="hs-keyword">data</span><span> </span><span id="IELookupError"><span class="annot"><a href="GHC.Rename.Names.html#IELookupError"><span class="hs-identifier hs-var">IELookupError</span></a></span></span><span>
</span><span id="line-1419"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="QualImportError"><span class="annot"><a href="GHC.Rename.Names.html#QualImportError"><span class="hs-identifier hs-var">QualImportError</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-1420"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BadImport"><span class="annot"><a href="GHC.Rename.Names.html#BadImport"><span class="hs-identifier hs-var">BadImport</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IsSubordinate"><span class="hs-identifier hs-type">IsSubordinate</span></a></span><span>
</span><span id="line-1421"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="IllegalImport"><span class="annot"><a href="GHC.Rename.Names.html#IllegalImport"><span class="hs-identifier hs-var">IllegalImport</span></a></span></span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span id="local-6989586621683051804"><span class="annot"><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-type">failLookupWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupError"><span class="hs-identifier hs-type">IELookupError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683051804"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1424"></span><span id="failLookupWith"><span class="annot"><span class="annottext">failLookupWith :: forall a. IELookupError -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#failLookupWith"><span class="hs-identifier hs-var hs-var">failLookupWith</span></a></span></span><span> </span><span id="local-6989586621683053335"><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053335"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IELookupError -&gt; MaybeErr IELookupError a
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053335"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span id="local-6989586621683051840"><span class="annot"><a href="GHC.Rename.Names.html#catchIELookup"><span class="hs-identifier hs-type">catchIELookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683051840"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#IELookupError"><span class="hs-identifier hs-type">IELookupError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683051840"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683051840"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1427"></span><span id="catchIELookup"><span class="annot"><span class="annottext">catchIELookup :: forall a.
IELookupM a -&gt; (IELookupError -&gt; IELookupM a) -&gt; IELookupM a
</span><a href="GHC.Rename.Names.html#catchIELookup"><span class="hs-identifier hs-var hs-var">catchIELookup</span></a></span></span><span> </span><span id="local-6989586621683053337"><span class="annot"><span class="annottext">IELookupM a
</span><a href="#local-6989586621683053337"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683053338"><span class="annot"><span class="annottext">IELookupError -&gt; IELookupM a
</span><a href="#local-6989586621683053338"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IELookupM a
</span><a href="#local-6989586621683053337"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1428"></span><span>  </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621683053339"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683053339"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IELookupM a
forall a. a -&gt; MaybeErr IELookupError a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683053339"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1429"></span><span>  </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621683053340"><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053340"><span class="hs-identifier hs-var">err</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IELookupError -&gt; IELookupM a
</span><a href="#local-6989586621683053338"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">IELookupError
</span><a href="#local-6989586621683053340"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1430"></span><span>
</span><span id="line-1431"></span><span id="local-6989586621683051835"><span class="annot"><a href="GHC.Rename.Names.html#catIELookupM"><span class="hs-identifier hs-type">catIELookupM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Names.html#IELookupM"><span class="hs-identifier hs-type">IELookupM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683051835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683051835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1432"></span><span id="catIELookupM"><span class="annot"><span class="annottext">catIELookupM :: forall a. [IELookupM a] -&gt; [a]
</span><a href="GHC.Rename.Names.html#catIELookupM"><span class="hs-identifier hs-var hs-var">catIELookupM</span></a></span></span><span> </span><span id="local-6989586621683053341"><span class="annot"><span class="annottext">[IELookupM a]
</span><a href="#local-6989586621683053341"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683053342"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621683053342"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683053342"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[IELookupM a]
</span><a href="#local-6989586621683053341"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span class="hs-comment">-- | Information associated to an 'AvailInfo' used in constructing</span><span>
</span><span id="line-1435"></span><span class="hs-comment">-- an 'OccEnv' corresponding to imports.</span><span>
</span><span id="line-1436"></span><span class="hs-comment">--</span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- See Note [Dealing with imports].</span><span>
</span><span id="line-1438"></span><span class="hs-keyword">data</span><span> </span><span id="ImpOccItem"><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-var">ImpOccItem</span></a></span></span><span>
</span><span id="line-1439"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ImpOccItem"><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-var">ImpOccItem</span></a></span></span><span>
</span><span id="line-1440"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="imp_item"><span class="annot"><span class="annottext">ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var hs-var">imp_item</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-1441"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The import item</span></span><span>
</span><span id="line-1442"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="imp_bundled"><span class="annot"><span class="annottext">ImpOccItem -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#imp_bundled"><span class="hs-identifier hs-var hs-var">imp_bundled</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1443"></span><span>        </span><span class="hs-comment">-- ^ Items bundled in the Avail this import item came from,</span><span>
</span><span id="line-1444"></span><span>        </span><span class="hs-comment">-- not including the import item itself if it is a parent.</span><span>
</span><span id="line-1445"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="imp_is_parent"><span class="annot"><span class="annottext">ImpOccItem -&gt; Bool
</span><a href="GHC.Rename.Names.html#imp_is_parent"><span class="hs-identifier hs-var hs-var">imp_is_parent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1446"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Is the import item a parent? See Note [Dealing with imports].</span></span><span>
</span><span id="line-1447"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1450"></span><span>  </span><span id="local-6989586621683053360"><span class="annot"><span class="annottext">ppr :: ImpOccItem -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_item :: ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053361"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053361"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_bundled :: ImpOccItem -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#imp_bundled"><span class="hs-identifier hs-var">imp_bundled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053362"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053362"><span class="hs-identifier hs-var">bundled</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_is_parent :: ImpOccItem -&gt; Bool
</span><a href="GHC.Rename.Names.html#imp_is_parent"><span class="hs-identifier hs-var">imp_is_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053363"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053363"><span class="hs-identifier hs-var">is_par</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1451"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span>
</span><span id="line-1452"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ImpOccItem&quot;</span></span><span>
</span><span id="line-1453"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053363"><span class="hs-identifier hs-var">is_par</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[is_par]&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1454"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053361"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Parent -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Parent
forall info. GlobalRdrEltX info -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#greParent"><span class="hs-identifier hs-var">greParent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053361"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1455"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bundled:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053362"><span class="hs-identifier hs-var">bundled</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span class="hs-comment">-- | Make an 'OccEnv' of all the imports.</span><span>
</span><span id="line-1458"></span><span class="hs-comment">--</span><span>
</span><span id="line-1459"></span><span class="hs-comment">-- Complicated by the fact that associated data types and pattern synonyms</span><span>
</span><span id="line-1460"></span><span class="hs-comment">-- can appear twice. See Note [Dealing with imports].</span><span>
</span><span id="line-1461"></span><span class="annot"><a href="GHC.Rename.Names.html#mkImportOccEnv"><span class="hs-identifier hs-type">mkImportOccEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#IfaceExport"><span class="hs-identifier hs-type">IfaceExport</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span id="mkImportOccEnv"><span class="annot"><span class="annottext">mkImportOccEnv :: HscEnv -&gt; ImpDeclSpec -&gt; [AvailInfo] -&gt; OccEnv (NameEnv ImpOccItem)
</span><a href="GHC.Rename.Names.html#mkImportOccEnv"><span class="hs-identifier hs-var hs-var">mkImportOccEnv</span></a></span></span><span> </span><span id="local-6989586621683053369"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053369"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683053370"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053370"><span class="hs-identifier hs-var">decl_spec</span></a></span></span><span> </span><span id="local-6989586621683053371"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053371"><span class="hs-identifier hs-var">all_avails</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1463"></span><span>  </span><span class="annot"><span class="annottext">(NameEnv ImpOccItem -&gt; NameEnv ImpOccItem -&gt; NameEnv ImpOccItem)
-&gt; [(OccName, NameEnv ImpOccItem)] -&gt; OccEnv (NameEnv ImpOccItem)
forall a. (a -&gt; a -&gt; a) -&gt; [(OccName, a)] -&gt; OccEnv a
</span><a href="GHC.Types.Name.Occurrence.html#mkOccEnv_C"><span class="hs-identifier hs-var">mkOccEnv_C</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImpOccItem -&gt; ImpOccItem -&gt; ImpOccItem)
-&gt; NameEnv ImpOccItem -&gt; NameEnv ImpOccItem -&gt; NameEnv ImpOccItem
forall a. (a -&gt; a -&gt; a) -&gt; NameEnv a -&gt; NameEnv a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#plusNameEnv_C"><span class="hs-identifier hs-var">plusNameEnv_C</span></a></span><span> </span><span class="annot"><span class="annottext">ImpOccItem -&gt; ImpOccItem -&gt; ImpOccItem
</span><a href="#local-6989586621683053374"><span class="hs-identifier hs-var">combine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1464"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053375"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, ImpOccItem)] -&gt; NameEnv ImpOccItem
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053377"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053378"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1465"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683053379"><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053379"><span class="hs-identifier hs-var">avail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053371"><span class="hs-identifier hs-var">all_avails</span></a></span><span>
</span><span id="line-1466"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053380"><span class="annot"><span class="annottext">gres :: [GlobalRdrElt]
</span><a href="#local-6989586621683053380"><span class="hs-identifier hs-var hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
HscEnv -&gt; Maybe ImportSpec -&gt; AvailInfo -&gt; [GlobalRdrElt]
HscEnv -&gt; Maybe ImportSpec -&gt; AvailInfo -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromAvail"><span class="hs-identifier hs-var">gresFromAvail</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053369"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportSpec -&gt; Maybe ImportSpec
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053381"><span class="hs-identifier hs-var">hiding_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053379"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-1467"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053382"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053382"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053380"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1468"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053377"><span class="annot"><span class="annottext">nm :: Name
</span><a href="#local-6989586621683053377"><span class="hs-identifier hs-var hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053382"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1469"></span><span>          </span><span id="local-6989586621683053375"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683053375"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; OccName
forall info. GlobalRdrEltX info -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053382"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1470"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683053383"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053383"><span class="hs-identifier hs-var">is_parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053384"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053384"><span class="hs-identifier hs-var">bundled</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053379"><span class="hs-identifier hs-var">avail</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1471"></span><span>            </span><span class="annot"><a href="GHC.Types.Avail.html#AvailTC"><span class="hs-identifier hs-type">AvailTC</span></a></span><span> </span><span id="local-6989586621683053386"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053386"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1472"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053386"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053377"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-comment">-- (Recall the AvailTC invariant from GHC.Types.AvailInfo)</span><span>
</span><span id="line-1473"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053380"><span class="hs-identifier hs-var">gres</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- &quot;drop 1&quot;: don't include the parent itself.</span><span>
</span><span id="line-1474"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1475"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053380"><span class="hs-identifier hs-var">gres</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>            </span><span class="annot"><span class="annottext">AvailInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1477"></span><span>          </span><span id="local-6989586621683053378"><span class="annot"><span class="annottext">item :: ImpOccItem
</span><a href="#local-6989586621683053378"><span class="hs-identifier hs-var hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span>
</span><span id="line-1478"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_item :: GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053382"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1479"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_bundled :: [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#imp_bundled"><span class="hs-identifier hs-var">imp_bundled</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053384"><span class="hs-identifier hs-var">bundled</span></a></span><span>
</span><span id="line-1480"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_is_parent :: Bool
</span><a href="GHC.Rename.Names.html#imp_is_parent"><span class="hs-identifier hs-var">imp_is_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053383"><span class="hs-identifier hs-var">is_parent</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1481"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1482"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1483"></span><span>
</span><span id="line-1484"></span><span>    </span><span id="local-6989586621683053381"><span class="annot"><span class="annottext">hiding_spec :: ImportSpec
</span><a href="#local-6989586621683053381"><span class="hs-identifier hs-var hs-var">hiding_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpSpec"><span class="hs-identifier hs-type">ImpSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_decl :: ImpDeclSpec
</span><a href="GHC.Types.Name.Reader.html#is_decl"><span class="hs-identifier hs-var">is_decl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053370"><span class="hs-identifier hs-var">decl_spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_item :: ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#is_item"><span class="hs-identifier hs-var">is_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1485"></span><span>
</span><span id="line-1486"></span><span>    </span><span class="hs-comment">-- See Note [Dealing with imports]</span><span>
</span><span id="line-1487"></span><span>    </span><span class="hs-comment">-- 'combine' may be called for associated data types which appear</span><span>
</span><span id="line-1488"></span><span>    </span><span class="hs-comment">-- twice in the all_avails. In the example, we have two Avails for T,</span><span>
</span><span id="line-1489"></span><span>    </span><span class="hs-comment">-- namely T(T,T1,T2,T3) and C(C,T), and we combine them by dropping the</span><span>
</span><span id="line-1490"></span><span>    </span><span class="hs-comment">-- latter, in which T is not the parent.</span><span>
</span><span id="line-1491"></span><span>    </span><span class="annot"><a href="#local-6989586621683053374"><span class="hs-identifier hs-type">combine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span>
</span><span id="line-1492"></span><span>    </span><span id="local-6989586621683053374"><span class="annot"><span class="annottext">combine :: ImpOccItem -&gt; ImpOccItem -&gt; ImpOccItem
</span><a href="#local-6989586621683053374"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621683053388"><span class="annot"><span class="annottext">item1 :: ImpOccItem
</span><a href="#local-6989586621683053388"><span class="hs-identifier hs-var">item1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_item :: ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053389"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053389"><span class="hs-identifier hs-var">gre1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_is_parent :: ImpOccItem -&gt; Bool
</span><a href="GHC.Rename.Names.html#imp_is_parent"><span class="hs-identifier hs-var">imp_is_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053390"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053390"><span class="hs-identifier hs-var">is_parent1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span>            </span><span id="local-6989586621683053391"><span class="annot"><span class="annottext">item2 :: ImpOccItem
</span><a href="#local-6989586621683053391"><span class="hs-identifier hs-var">item2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_item :: ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053392"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053392"><span class="hs-identifier hs-var">gre2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_is_parent :: ImpOccItem -&gt; Bool
</span><a href="GHC.Rename.Names.html#imp_is_parent"><span class="hs-identifier hs-var">imp_is_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053393"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053393"><span class="hs-identifier hs-var">is_parent2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1494"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053390"><span class="hs-identifier hs-var">is_parent1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053393"><span class="hs-identifier hs-var">is_parent2</span></a></span><span>
</span><span id="line-1495"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053389"><span class="hs-identifier hs-var">gre1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053392"><span class="hs-identifier hs-var">gre2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NB: does not force GREInfo.</span><span>
</span><span id="line-1496"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053395"><span class="annot"><span class="annottext">name1 :: Name
</span><a href="#local-6989586621683053395"><span class="hs-identifier hs-var hs-var">name1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053389"><span class="hs-identifier hs-var">gre1</span></a></span><span>
</span><span id="line-1497"></span><span>            </span><span id="local-6989586621683053396"><span class="annot"><span class="annottext">name2 :: Name
</span><a href="#local-6989586621683053396"><span class="hs-identifier hs-var hs-var">name2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053392"><span class="hs-identifier hs-var">gre2</span></a></span><span>
</span><span id="line-1498"></span><span>            </span><span id="local-6989586621683053397"><span class="annot"><span class="annottext">gre :: GlobalRdrElt
</span><a href="#local-6989586621683053397"><span class="hs-identifier hs-var hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053389"><span class="hs-identifier hs-var">gre1</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; GlobalRdrElt -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#plusGRE"><span class="hs-operator hs-var">`plusGRE`</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053392"><span class="hs-identifier hs-var">gre2</span></a></span><span>
</span><span id="line-1499"></span><span>              </span><span class="hs-comment">-- See Note [Preserve parent information when combining import OccEnvs]</span><span>
</span><span id="line-1500"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ImpOccItem -&gt; ImpOccItem
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053395"><span class="hs-identifier hs-var">name1</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053396"><span class="hs-identifier hs-var">name2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1501"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053395"><span class="hs-identifier hs-var">name1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053396"><span class="hs-identifier hs-var">name2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpOccItem -&gt; ImpOccItem) -&gt; ImpOccItem -&gt; ImpOccItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1502"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053390"><span class="hs-identifier hs-var">is_parent1</span></a></span><span>
</span><span id="line-1503"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053388"><span class="hs-identifier hs-var">item1</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683053397"><span class="hs-identifier hs-type">gre</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1504"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053391"><span class="hs-identifier hs-var">item2</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683053397"><span class="hs-identifier hs-type">gre</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1505"></span><span>      </span><span class="hs-comment">-- Discard C(C,T) in favour of T(T, T1, T2, T3).</span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span>    </span><span class="hs-comment">-- 'combine' may also be called for pattern synonyms which appear both</span><span>
</span><span id="line-1508"></span><span>    </span><span class="hs-comment">-- unassociated and associated (see Note [Importing PatternSynonyms]).</span><span>
</span><span id="line-1509"></span><span>    </span><span class="annot"><a href="#local-6989586621683053374"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span id="local-6989586621683053399"><span class="annot"><span class="annottext">item1 :: ImpOccItem
</span><a href="#local-6989586621683053399"><span class="hs-identifier hs-var">item1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_item :: ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053400"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053400"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_bundled :: ImpOccItem -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#imp_bundled"><span class="hs-identifier hs-var">imp_bundled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053401"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053401"><span class="hs-identifier hs-var">kids1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1510"></span><span>            </span><span id="local-6989586621683053402"><span class="annot"><span class="annottext">item2 :: ImpOccItem
</span><a href="#local-6989586621683053402"><span class="hs-identifier hs-var">item2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_item :: ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053403"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053403"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">imp_bundled :: ImpOccItem -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#imp_bundled"><span class="hs-identifier hs-var">imp_bundled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053404"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053404"><span class="hs-identifier hs-var">kids2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1511"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ImpOccItem -&gt; ImpOccItem
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053400"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053403"><span class="hs-identifier hs-var">c2</span></a></span><span>
</span><span id="line-1512"></span><span>                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053401"><span class="hs-identifier hs-var">kids1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053404"><span class="hs-identifier hs-var">kids2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1513"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053400"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053403"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053401"><span class="hs-identifier hs-var">kids1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053404"><span class="hs-identifier hs-var">kids2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpOccItem -&gt; ImpOccItem) -&gt; ImpOccItem -&gt; ImpOccItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1514"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053401"><span class="hs-identifier hs-var">kids1</span></a></span><span>
</span><span id="line-1515"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053402"><span class="hs-identifier hs-var">item2</span></a></span><span>
</span><span id="line-1516"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ImpOccItem
</span><a href="#local-6989586621683053399"><span class="hs-identifier hs-var">item1</span></a></span><span>
</span><span id="line-1517"></span><span>      </span><span class="hs-comment">-- Discard standalone pattern P in favour of T(P).</span><span>
</span><span id="line-1518"></span><span>
</span><span id="line-1519"></span><span class="hs-comment">-- | Essentially like @lookupGRE env (LookupOccName occ which_gres)@,</span><span>
</span><span id="line-1520"></span><span class="hs-comment">-- but working with 'ImpOccItem's instead of 'GlobalRdrElt's.</span><span>
</span><span id="line-1521"></span><span class="annot"><a href="GHC.Rename.Names.html#lookupImpOccEnv"><span class="hs-identifier hs-type">lookupImpOccEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WhichGREs"><span class="hs-identifier hs-type">WhichGREs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span>
</span><span id="line-1522"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1523"></span><span id="lookupImpOccEnv"><span class="annot"><span class="annottext">lookupImpOccEnv :: WhichGREs GREInfo
-&gt; OccEnv (NameEnv ImpOccItem) -&gt; OccName -&gt; [NameEnv ImpOccItem]
</span><a href="GHC.Rename.Names.html#lookupImpOccEnv"><span class="hs-identifier hs-var hs-var">lookupImpOccEnv</span></a></span></span><span> </span><span id="local-6989586621683053405"><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683053405"><span class="hs-identifier hs-var">which_gres</span></a></span></span><span> </span><span id="local-6989586621683053406"><span class="annot"><span class="annottext">OccEnv (NameEnv ImpOccItem)
</span><a href="#local-6989586621683053406"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621683053407"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053407"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1524"></span><span>  </span><span class="annot"><span class="annottext">(NameEnv ImpOccItem -&gt; Maybe (NameEnv ImpOccItem))
-&gt; [NameEnv ImpOccItem] -&gt; [NameEnv ImpOccItem]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">NameEnv ImpOccItem -&gt; Maybe (NameEnv ImpOccItem)
</span><a href="#local-6989586621683053408"><span class="hs-identifier hs-var">relevant_items</span></a></span><span> </span><span class="annot"><span class="annottext">([NameEnv ImpOccItem] -&gt; [NameEnv ImpOccItem])
-&gt; [NameEnv ImpOccItem] -&gt; [NameEnv ImpOccItem]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccEnv (NameEnv ImpOccItem) -&gt; OccName -&gt; [NameEnv ImpOccItem]
forall a. OccEnv a -&gt; OccName -&gt; [a]
</span><a href="GHC.Types.Name.Occurrence.html#lookupOccEnv_AllNameSpaces"><span class="hs-identifier hs-var">lookupOccEnv_AllNameSpaces</span></a></span><span> </span><span class="annot"><span class="annottext">OccEnv (NameEnv ImpOccItem)
</span><a href="#local-6989586621683053406"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053407"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1525"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1526"></span><span>    </span><span class="annot"><a href="#local-6989586621683053410"><span class="hs-identifier hs-type">is_relevant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1527"></span><span>    </span><span id="local-6989586621683053410"><span class="annot"><span class="annottext">is_relevant :: ImpOccItem -&gt; Bool
</span><a href="#local-6989586621683053410"><span class="hs-identifier hs-var hs-var">is_relevant</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_item :: ImpOccItem -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Names.html#imp_item"><span class="hs-identifier hs-var">imp_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053411"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053411"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1528"></span><span>      </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; NameSpace -&gt; GlobalRdrElt -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#greIsRelevant"><span class="hs-identifier hs-var">greIsRelevant</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683053405"><span class="hs-identifier hs-var">which_gres</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#occNameSpace"><span class="hs-identifier hs-var">occNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053407"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053411"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1529"></span><span>    </span><span class="annot"><a href="#local-6989586621683053408"><span class="hs-identifier hs-type">relevant_items</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImpOccItem"><span class="hs-identifier hs-type">ImpOccItem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1530"></span><span>    </span><span id="local-6989586621683053408"><span class="annot"><span class="annottext">relevant_items :: NameEnv ImpOccItem -&gt; Maybe (NameEnv ImpOccItem)
</span><a href="#local-6989586621683053408"><span class="hs-identifier hs-var hs-var">relevant_items</span></a></span></span><span> </span><span id="local-6989586621683053413"><span class="annot"><span class="annottext">NameEnv ImpOccItem
</span><a href="#local-6989586621683053413"><span class="hs-identifier hs-var">nms</span></a></span></span><span>
</span><span id="line-1531"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053414"><span class="annot"><span class="annottext">nms' :: NameEnv ImpOccItem
</span><a href="#local-6989586621683053414"><span class="hs-identifier hs-var hs-var">nms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpOccItem -&gt; Bool) -&gt; NameEnv ImpOccItem -&gt; NameEnv ImpOccItem
forall elt. (elt -&gt; Bool) -&gt; NameEnv elt -&gt; NameEnv elt
</span><a href="GHC.Types.Name.Env.html#filterNameEnv"><span class="hs-identifier hs-var">filterNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ImpOccItem -&gt; Bool
</span><a href="#local-6989586621683053410"><span class="hs-identifier hs-var">is_relevant</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv ImpOccItem
</span><a href="#local-6989586621683053413"><span class="hs-identifier hs-var">nms</span></a></span><span>
</span><span id="line-1532"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NameEnv ImpOccItem -&gt; Bool
forall a. NameEnv a -&gt; Bool
</span><a href="GHC.Types.Name.Env.html#isEmptyNameEnv"><span class="hs-identifier hs-var">isEmptyNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv ImpOccItem
</span><a href="#local-6989586621683053414"><span class="hs-identifier hs-var">nms'</span></a></span><span>
</span><span id="line-1533"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (NameEnv ImpOccItem)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1534"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NameEnv ImpOccItem -&gt; Maybe (NameEnv ImpOccItem)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">NameEnv ImpOccItem
</span><a href="#local-6989586621683053414"><span class="hs-identifier hs-var">nms'</span></a></span><span>
</span><span id="line-1535"></span><span>
</span><span id="line-1536"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Import/Export Utils}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1543"></span><span>
</span><span id="line-1544"></span><span class="hs-comment">-- | Given an import\/export spec, appropriately set the @gre_imp@ field</span><span>
</span><span id="line-1545"></span><span class="hs-comment">-- for the 'GlobalRdrElt's.</span><span>
</span><span id="line-1546"></span><span class="annot"><a href="GHC.Rename.Names.html#gresFromIE"><span class="hs-identifier hs-type">gresFromIE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1547"></span><span id="gresFromIE"><span class="annot"><span class="annottext">gresFromIE :: ImpDeclSpec -&gt; (LIE GhcRn, [GlobalRdrElt]) -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromIE"><span class="hs-identifier hs-var hs-var">gresFromIE</span></a></span></span><span> </span><span id="local-6989586621683053417"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053417"><span class="hs-identifier hs-var">decl_spec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053418"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053418"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683053419"><span class="annot"><span class="annottext">IE GhcRn
</span><a href="#local-6989586621683053419"><span class="hs-identifier hs-var">ie</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053420"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053420"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1548"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; GlobalRdrElt) -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; GlobalRdrElt
</span><a href="#local-6989586621683053421"><span class="hs-identifier hs-var">set_gre_imp</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053420"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1549"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1550"></span><span>    </span><span id="local-6989586621683053422"><span class="annot"><span class="annottext">is_explicit :: Name -&gt; Bool
</span><a href="#local-6989586621683053422"><span class="hs-identifier hs-var hs-var">is_explicit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IE GhcRn
</span><a href="#local-6989586621683053419"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1551"></span><span>                    </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAll"><span class="hs-identifier hs-type">IEThingAll</span></a></span><span> </span><span class="annot"><span class="annottext">XIEThingAll GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053423"><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053423"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683053424"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053424"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053424"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn -&gt; IdP GhcRn
forall (p :: Pass). LIEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#lieWrappedName"><span class="hs-identifier hs-var">lieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053423"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1552"></span><span>                    </span><span class="annot"><span class="annottext">IE GhcRn
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1553"></span><span>    </span><span id="local-6989586621683053426"><span class="annot"><span class="annottext">prov_fn :: Name -&gt; ImportSpec
</span><a href="#local-6989586621683053426"><span class="hs-identifier hs-var hs-var">prov_fn</span></a></span></span><span> </span><span id="local-6989586621683053427"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053427"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1554"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpSpec"><span class="hs-identifier hs-type">ImpSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_decl :: ImpDeclSpec
</span><a href="GHC.Types.Name.Reader.html#is_decl"><span class="hs-identifier hs-var">is_decl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053417"><span class="hs-identifier hs-var">decl_spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_item :: ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#is_item"><span class="hs-identifier hs-var">is_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpItemSpec
</span><a href="#local-6989586621683053428"><span class="hs-identifier hs-var">item_spec</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1555"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1556"></span><span>        </span><span id="local-6989586621683053428"><span class="annot"><span class="annottext">item_spec :: ImpItemSpec
</span><a href="#local-6989586621683053428"><span class="hs-identifier hs-var hs-var">item_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpSome"><span class="hs-identifier hs-type">ImpSome</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_explicit :: Bool
</span><a href="GHC.Types.Name.Reader.html#is_explicit"><span class="hs-identifier hs-var">is_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683053422"><span class="hs-identifier hs-var">is_explicit</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053427"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1557"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_iloc :: SrcSpan
</span><a href="GHC.Types.Name.Reader.html#is_iloc"><span class="hs-identifier hs-var">is_iloc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053418"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1558"></span><span>    </span><span id="local-6989586621683053421"><span class="annot"><span class="annottext">set_gre_imp :: GlobalRdrElt -&gt; GlobalRdrElt
</span><a href="#local-6989586621683053421"><span class="hs-identifier hs-var hs-var">set_gre_imp</span></a></span></span><span> </span><span id="local-6989586621683053432"><span class="annot"><span class="annottext">gre :: GlobalRdrElt
</span><a href="#local-6989586621683053432"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GRE"><span class="hs-identifier hs-type">GRE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gre_name :: forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var">gre_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053433"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053433"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053432"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#gre_imp"><span class="hs-identifier hs-var">gre_imp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-type">unitBag</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683053426"><span class="hs-identifier hs-type">prov_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053433"><span class="hs-identifier hs-type">nm</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1560"></span><span>
</span><span id="line-1561"></span><span class="hs-comment">{-
Note [Children for duplicate record fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the module

    {-# LANGUAGE DuplicateRecordFields #-}
    module M (F(foo, MkFInt, MkFBool)) where
      data family F a
      data instance F Int = MkFInt { foo :: Int }
      data instance F Bool = MkFBool { foo :: Bool }

The `foo` in the export list refers to *both* selectors! For this
reason, lookupChildren builds an environment that maps the FastString
to a list of items, rather than a single item.
-}</span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span class="annot"><a href="GHC.Rename.Names.html#mkChildEnv"><span class="hs-identifier hs-type">mkChildEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1578"></span><span id="mkChildEnv"><span class="annot"><span class="annottext">mkChildEnv :: [GlobalRdrElt] -&gt; NameEnv [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#mkChildEnv"><span class="hs-identifier hs-var hs-var">mkChildEnv</span></a></span></span><span> </span><span id="local-6989586621683053434"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053434"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; NameEnv [GlobalRdrElt] -&gt; NameEnv [GlobalRdrElt])
-&gt; NameEnv [GlobalRdrElt]
-&gt; [GlobalRdrElt]
-&gt; NameEnv [GlobalRdrElt]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; NameEnv [GlobalRdrElt] -&gt; NameEnv [GlobalRdrElt]
forall {info}.
GlobalRdrEltX info
-&gt; NameEnv [GlobalRdrEltX info] -&gt; NameEnv [GlobalRdrEltX info]
</span><a href="#local-6989586621683053435"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv [GlobalRdrElt]
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053434"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1579"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1580"></span><span>    </span><span id="local-6989586621683053435"><span class="annot"><span class="annottext">add :: GlobalRdrEltX info
-&gt; NameEnv [GlobalRdrEltX info] -&gt; NameEnv [GlobalRdrEltX info]
</span><a href="#local-6989586621683053435"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621683053437"><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053437"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span id="local-6989586621683053438"><span class="annot"><span class="annottext">NameEnv [GlobalRdrEltX info]
</span><a href="#local-6989586621683053438"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info -&gt; Parent
forall info. GlobalRdrEltX info -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#greParent"><span class="hs-identifier hs-var">greParent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053437"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1581"></span><span>        </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-type">ParentIs</span></a></span><span>  </span><span id="local-6989586621683053439"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053439"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrEltX info
 -&gt; [GlobalRdrEltX info] -&gt; [GlobalRdrEltX info])
-&gt; (GlobalRdrEltX info -&gt; [GlobalRdrEltX info])
-&gt; NameEnv [GlobalRdrEltX info]
-&gt; Name
-&gt; GlobalRdrEltX info
-&gt; NameEnv [GlobalRdrEltX info]
forall a b.
(a -&gt; b -&gt; b) -&gt; (a -&gt; b) -&gt; NameEnv b -&gt; Name -&gt; a -&gt; NameEnv b
</span><a href="GHC.Types.Name.Env.html#extendNameEnv_Acc"><span class="hs-identifier hs-var">extendNameEnv_Acc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info -&gt; [GlobalRdrEltX info]
forall a. a -&gt; [a]
</span><a href="GHC.Utils.Misc.html#singleton"><span class="hs-identifier hs-var">Utils.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv [GlobalRdrEltX info]
</span><a href="#local-6989586621683053438"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053439"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053437"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1582"></span><span>        </span><span class="annot"><span class="annottext">Parent
</span><a href="GHC.Types.Name.Reader.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameEnv [GlobalRdrEltX info]
</span><a href="#local-6989586621683053438"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1583"></span><span>
</span><span id="line-1584"></span><span id="local-6989586621683051863"><span class="annot"><a href="GHC.Rename.Names.html#findChildren"><span class="hs-identifier hs-type">findChildren</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683051863"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683051863"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1585"></span><span id="findChildren"><span class="annot"><span class="annottext">findChildren :: forall a. NameEnv [a] -&gt; Name -&gt; [a]
</span><a href="GHC.Rename.Names.html#findChildren"><span class="hs-identifier hs-var hs-var">findChildren</span></a></span></span><span> </span><span id="local-6989586621683053442"><span class="annot"><span class="annottext">NameEnv [a]
</span><a href="#local-6989586621683053442"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621683053443"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053443"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv [a] -&gt; Name -&gt; Maybe [a]
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv [a]
</span><a href="#local-6989586621683053442"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053443"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [a] -&gt; [a] -&gt; [a]
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1586"></span><span>
</span><span id="line-1587"></span><span class="annot"><a href="GHC.Rename.Names.html#lookupChildren"><span class="hs-identifier hs-type">lookupChildren</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1588"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIEWrappedName"><span class="hs-identifier hs-type">LIEWrappedName</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1589"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIEWrappedName"><span class="hs-identifier hs-type">LIEWrappedName</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- The ones for which the lookup failed</span><span>
</span><span id="line-1590"></span><span>                           </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1591"></span><span class="hs-comment">-- (lookupChildren all_kids rdr_items) maps each rdr_item to its</span><span>
</span><span id="line-1592"></span><span class="hs-comment">-- corresponding Name all_kids, if the former exists</span><span>
</span><span id="line-1593"></span><span class="hs-comment">-- The matching is done by FastString, not OccName, so that</span><span>
</span><span id="line-1594"></span><span class="hs-comment">--    Cls( meth, AssocTy )</span><span>
</span><span id="line-1595"></span><span class="hs-comment">-- will correctly find AssocTy among the all_kids of Cls, even though</span><span>
</span><span id="line-1596"></span><span class="hs-comment">-- the RdrName for AssocTy may have a (bogus) DataName namespace</span><span>
</span><span id="line-1597"></span><span class="hs-comment">-- (Really the rdr_items should be FastStrings in the first place.)</span><span>
</span><span id="line-1598"></span><span id="lookupChildren"><span class="annot"><span class="annottext">lookupChildren :: [GlobalRdrElt]
-&gt; [LIEWrappedName (GhcPass 'Parsed)]
-&gt; MaybeErr
     [LIEWrappedName (GhcPass 'Parsed)] [LocatedA GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#lookupChildren"><span class="hs-identifier hs-var hs-var">lookupChildren</span></a></span></span><span> </span><span id="local-6989586621683053445"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053445"><span class="hs-identifier hs-var">all_kids</span></a></span></span><span> </span><span id="local-6989586621683053446"><span class="annot"><span class="annottext">[LIEWrappedName (GhcPass 'Parsed)]
</span><a href="#local-6989586621683053446"><span class="hs-identifier hs-var">rdr_items</span></a></span></span><span>
</span><span id="line-1599"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
</span><a href="#local-6989586621683053447"><span class="hs-identifier hs-var">fails</span></a></span><span>
</span><span id="line-1600"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
-&gt; MaybeErr
     [GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
     [LocatedA GlobalRdrElt]
forall err val. val -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[LocatedA GlobalRdrElt]] -&gt; [LocatedA GlobalRdrElt]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[LocatedA GlobalRdrElt]]
</span><a href="#local-6989586621683053448"><span class="hs-identifier hs-var">oks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>       </span><span class="hs-comment">-- This 'fmap concat' trickily applies concat to the /second/ component</span><span>
</span><span id="line-1602"></span><span>       </span><span class="hs-comment">-- of the pair, whose type is ([LocatedA Name], [[Located FieldLabel]])</span><span>
</span><span id="line-1603"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1604"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
-&gt; MaybeErr
     [GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
     [LocatedA GlobalRdrElt]
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
</span><a href="#local-6989586621683053447"><span class="hs-identifier hs-var">fails</span></a></span><span>
</span><span id="line-1605"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1606"></span><span>    </span><span id="local-6989586621683053449"><span class="annot"><span class="annottext">mb_xs :: [MaybeErr
   (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
   [LocatedA GlobalRdrElt]]
</span><a href="#local-6989586621683053449"><span class="hs-identifier hs-var hs-var">mb_xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
 -&gt; MaybeErr
      (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
      [LocatedA GlobalRdrElt])
-&gt; [GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
-&gt; [MaybeErr
      (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
      [LocatedA GlobalRdrElt]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
-&gt; MaybeErr
     (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
     [LocatedA GlobalRdrElt]
</span><a href="#local-6989586621683053450"><span class="hs-identifier hs-var">doOne</span></a></span><span> </span><span class="annot"><span class="annottext">[LIEWrappedName (GhcPass 'Parsed)]
[GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
</span><a href="#local-6989586621683053446"><span class="hs-identifier hs-var">rdr_items</span></a></span><span>
</span><span id="line-1607"></span><span>    </span><span id="local-6989586621683053447"><span class="annot"><span class="annottext">fails :: [GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
</span><a href="#local-6989586621683053447"><span class="hs-identifier hs-var hs-var">fails</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
</span><a href="#local-6989586621683053451"><span class="hs-identifier hs-var">bad_rdr</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621683053451"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
</span><a href="#local-6989586621683053451"><span class="hs-identifier hs-var">bad_rdr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MaybeErr
   (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
   [LocatedA GlobalRdrElt]]
</span><a href="#local-6989586621683053449"><span class="hs-identifier hs-var">mb_xs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1608"></span><span>    </span><span id="local-6989586621683053448"><span class="annot"><span class="annottext">oks :: [[LocatedA GlobalRdrElt]]
</span><a href="#local-6989586621683053448"><span class="hs-identifier hs-var hs-var">oks</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
</span><a href="#local-6989586621683053452"><span class="hs-identifier hs-var">ok</span></a></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621683053452"><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
</span><a href="#local-6989586621683053452"><span class="hs-identifier hs-var">ok</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MaybeErr
   (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
   [LocatedA GlobalRdrElt]]
</span><a href="#local-6989586621683053449"><span class="hs-identifier hs-var">mb_xs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1609"></span><span>    </span><span class="annot"><a href="#local-6989586621683053448"><span class="hs-identifier hs-type">oks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1610"></span><span>
</span><span id="line-1611"></span><span>    </span><span id="local-6989586621683053450"><span class="annot"><span class="annottext">doOne :: GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
-&gt; MaybeErr
     (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
     [LocatedA GlobalRdrElt]
</span><a href="#local-6989586621683053450"><span class="hs-identifier hs-var hs-var">doOne</span></a></span></span><span> </span><span id="local-6989586621683053453"><span class="annot"><span class="annottext">item :: GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
</span><a href="#local-6989586621683053453"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053454"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053454"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053455"><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053455"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1612"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastStringEnv [GlobalRdrElt] -&gt; FastString -&gt; Maybe [GlobalRdrElt]
forall a. FastStringEnv a -&gt; FastString -&gt; Maybe a
</span><a href="GHC.Data.FastString.Env.html#lookupFsEnv"><span class="hs-identifier hs-var">lookupFsEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FastStringEnv [GlobalRdrElt]
</span><a href="#local-6989586621683053457"><span class="hs-identifier hs-var">kid_env</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; Maybe [GlobalRdrElt])
-&gt; (IEWrappedName (GhcPass 'Parsed) -&gt; FastString)
-&gt; IEWrappedName (GhcPass 'Parsed)
-&gt; Maybe [GlobalRdrElt]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString)
-&gt; (IEWrappedName (GhcPass 'Parsed) -&gt; OccName)
-&gt; IEWrappedName (GhcPass 'Parsed)
-&gt; FastString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName)
-&gt; (IEWrappedName (GhcPass 'Parsed) -&gt; RdrName)
-&gt; IEWrappedName (GhcPass 'Parsed)
-&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
IEWrappedName (GhcPass 'Parsed) -&gt; RdrName
forall (p :: Pass). IEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieWrappedName"><span class="hs-identifier hs-var">ieWrappedName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed)
</span><a href="#local-6989586621683053455"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1613"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683053458"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053458"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-1614"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053458"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1615"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
-&gt; MaybeErr
     (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
     [LocatedA GlobalRdrElt]
forall err val. val -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; GlobalRdrElt -&gt; LocatedA GlobalRdrElt
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053454"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053458"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1616"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053459"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053459"><span class="hs-identifier hs-var">gs</span></a></span></span><span>
</span><span id="line-1617"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053459"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-1618"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocatedA GlobalRdrElt]
-&gt; MaybeErr
     (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
     [LocatedA GlobalRdrElt]
forall err val. val -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="annot"><span class="annottext">([LocatedA GlobalRdrElt]
 -&gt; MaybeErr
      (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
      [LocatedA GlobalRdrElt])
-&gt; [LocatedA GlobalRdrElt]
-&gt; MaybeErr
     (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
     [LocatedA GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; LocatedA GlobalRdrElt)
-&gt; [GlobalRdrElt] -&gt; [LocatedA GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; GlobalRdrElt -&gt; LocatedA GlobalRdrElt
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053454"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053459"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-1619"></span><span>           </span><span class="annot"><span class="annottext">Maybe [GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
-&gt; MaybeErr
     (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed)))
     [LocatedA GlobalRdrElt]
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>    </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
</span><a href="#local-6989586621683053453"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span>    </span><span class="hs-comment">-- See Note [Children for duplicate record fields]</span><span>
</span><span id="line-1622"></span><span>    </span><span id="local-6989586621683053457"><span class="annot"><span class="annottext">kid_env :: FastStringEnv [GlobalRdrElt]
</span><a href="#local-6989586621683053457"><span class="hs-identifier hs-var hs-var">kid_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt])
-&gt; FastStringEnv [GlobalRdrElt]
-&gt; [(FastString, [GlobalRdrElt])]
-&gt; FastStringEnv [GlobalRdrElt]
forall a.
(a -&gt; a -&gt; a)
-&gt; FastStringEnv a -&gt; [(FastString, a)] -&gt; FastStringEnv a
</span><a href="GHC.Data.FastString.Env.html#extendFsEnvList_C"><span class="hs-identifier hs-var">extendFsEnvList_C</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">FastStringEnv [GlobalRdrElt]
forall a. FastStringEnv a
</span><a href="GHC.Data.FastString.Env.html#emptyFsEnv"><span class="hs-identifier hs-var">emptyFsEnv</span></a></span><span>
</span><span id="line-1623"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053463"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053463"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683053463"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053463"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053445"><span class="hs-identifier hs-var">all_kids</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1624"></span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-1627"></span><span>
</span><span id="line-1628"></span><span class="hs-comment">{-
*********************************************************
*                                                       *
\subsection{Unused names}
*                                                       *
*********************************************************
-}</span><span>
</span><span id="line-1635"></span><span>
</span><span id="line-1636"></span><span class="annot"><a href="GHC.Rename.Names.html#reportUnusedNames"><span class="hs-identifier hs-type">reportUnusedNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span id="reportUnusedNames"><span class="annot"><span class="annottext">reportUnusedNames :: TcGblEnv -&gt; HscSource -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#reportUnusedNames"><span class="hs-identifier hs-var hs-var">reportUnusedNames</span></a></span></span><span> </span><span id="local-6989586621683053464"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053464"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span id="local-6989586621683053465"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683053465"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span>
</span><span id="line-1638"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053466"><span class="annot"><a href="#local-6989586621683053466"><span class="hs-identifier hs-var">keep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef Defs -&gt; IOEnv (Env TcGblEnv TcLclEnv) Defs
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef Defs
</span><a href="GHC.Tc.Types.html#tcg_keep"><span class="hs-identifier hs-var">tcg_keep</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053464"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;RUN&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053464"><span class="hs-identifier hs-type">gbl_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#warnUnusedImportDecls"><span class="hs-identifier hs-type">warnUnusedImportDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053464"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053465"><span class="hs-identifier hs-type">hsc_src</span></a></span><span>
</span><span id="line-1641"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#warnUnusedTopBinds"><span class="hs-identifier hs-type">warnUnusedTopBinds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683053471"><span class="hs-identifier hs-type">unused_locals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053466"><span class="hs-identifier hs-type">keep</span></a></span><span>
</span><span id="line-1642"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#warnMissingSignatures"><span class="hs-identifier hs-type">warnMissingSignatures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053464"><span class="hs-identifier hs-type">gbl_env</span></a></span><span>
</span><span id="line-1643"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#warnMissingKindSignatures"><span class="hs-identifier hs-type">warnMissingKindSignatures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053464"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1644"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1645"></span><span>    </span><span class="annot"><a href="#local-6989586621683053474"><span class="hs-identifier hs-type">used_names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>
</span><span id="line-1646"></span><span>    </span><span id="local-6989586621683053474"><span class="annot"><span class="annottext">used_names :: Defs -&gt; Defs
</span><a href="#local-6989586621683053474"><span class="hs-identifier hs-var hs-var">used_names</span></a></span></span><span> </span><span id="local-6989586621683053475"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053475"><span class="hs-identifier hs-var">keep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefUses -&gt; Defs -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#findUses"><span class="hs-identifier hs-var">findUses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; DefUses
</span><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053464"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-var">`unionNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053475"><span class="hs-identifier hs-var">keep</span></a></span><span>
</span><span id="line-1647"></span><span>    </span><span class="hs-comment">-- NB: currently, if f x = g, we only treat 'g' as used if 'f' is used</span><span>
</span><span id="line-1648"></span><span>    </span><span class="hs-comment">-- Hence findUses</span><span>
</span><span id="line-1649"></span><span>
</span><span id="line-1650"></span><span>    </span><span class="hs-comment">-- Collect the defined names from the in-scope environment</span><span>
</span><span id="line-1651"></span><span>    </span><span class="annot"><a href="#local-6989586621683053478"><span class="hs-identifier hs-type">defined_names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1652"></span><span>    </span><span id="local-6989586621683053478"><span class="annot"><span class="annottext">defined_names :: [GlobalRdrElt]
</span><a href="#local-6989586621683053478"><span class="hs-identifier hs-var hs-var">defined_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; [GlobalRdrElt]
forall info. GlobalRdrEnvX info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#globalRdrEnvElts"><span class="hs-identifier hs-var">globalRdrEnvElts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053464"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1653"></span><span>
</span><span id="line-1654"></span><span>    </span><span id="local-6989586621683053480"><span class="annot"><span class="annottext">kids_env :: NameEnv [GlobalRdrElt]
</span><a href="#local-6989586621683053480"><span class="hs-identifier hs-var hs-var">kids_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; NameEnv [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#mkChildEnv"><span class="hs-identifier hs-var">mkChildEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053478"><span class="hs-identifier hs-var">defined_names</span></a></span><span>
</span><span id="line-1655"></span><span>    </span><span class="hs-comment">-- This is done in mkExports too; duplicated work</span><span>
</span><span id="line-1656"></span><span>
</span><span id="line-1657"></span><span>    </span><span class="annot"><a href="#local-6989586621683053481"><span class="hs-identifier hs-type">gre_is_used</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1658"></span><span>    </span><span id="local-6989586621683053481"><span class="annot"><span class="annottext">gre_is_used :: Defs -&gt; GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683053481"><span class="hs-identifier hs-var hs-var">gre_is_used</span></a></span></span><span> </span><span id="local-6989586621683053482"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053482"><span class="hs-identifier hs-var">used_names</span></a></span></span><span> </span><span id="local-6989586621683053483"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053483"><span class="hs-identifier hs-var">gre0</span></a></span></span><span>
</span><span id="line-1659"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053484"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053482"><span class="hs-identifier hs-var">used_names</span></a></span><span>
</span><span id="line-1660"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683053486"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053486"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053486"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053482"><span class="hs-identifier hs-var">used_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameEnv [GlobalRdrElt] -&gt; Name -&gt; [GlobalRdrElt]
forall a. NameEnv [a] -&gt; Name -&gt; [a]
</span><a href="GHC.Rename.Names.html#findChildren"><span class="hs-identifier hs-var">findChildren</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv [GlobalRdrElt]
</span><a href="#local-6989586621683053480"><span class="hs-identifier hs-var">kids_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053484"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1661"></span><span>                </span><span class="hs-comment">-- A use of C implies a use of T,</span><span>
</span><span id="line-1662"></span><span>                </span><span class="hs-comment">-- if C was brought into scope by T(..) or T(C)</span><span>
</span><span id="line-1663"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1664"></span><span>        </span><span id="local-6989586621683053484"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683053484"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053483"><span class="hs-identifier hs-var">gre0</span></a></span><span>
</span><span id="line-1665"></span><span>
</span><span id="line-1666"></span><span>    </span><span class="hs-comment">-- Filter out the ones that are</span><span>
</span><span id="line-1667"></span><span>    </span><span class="hs-comment">--  (a) defined in this module, and</span><span>
</span><span id="line-1668"></span><span>    </span><span class="hs-comment">--  (b) not defined by a 'deriving' clause</span><span>
</span><span id="line-1669"></span><span>    </span><span class="hs-comment">-- The latter have an Internal Name, so we can filter them out easily</span><span>
</span><span id="line-1670"></span><span>    </span><span class="annot"><a href="#local-6989586621683053471"><span class="hs-identifier hs-type">unused_locals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1671"></span><span>    </span><span id="local-6989586621683053471"><span class="annot"><span class="annottext">unused_locals :: Defs -&gt; [GlobalRdrElt]
</span><a href="#local-6989586621683053471"><span class="hs-identifier hs-var hs-var">unused_locals</span></a></span></span><span> </span><span id="local-6989586621683053487"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053487"><span class="hs-identifier hs-var">keep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1672"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Note that defined_and_used, defined_but_not_used</span><span>
</span><span id="line-1673"></span><span>          </span><span class="hs-comment">-- are both [GRE]; that's why we need defined_and_used</span><span>
</span><span id="line-1674"></span><span>          </span><span class="hs-comment">-- rather than just used_names</span><span>
</span><span id="line-1675"></span><span>          </span><span class="annot"><a href="#local-6989586621683053488"><span class="hs-identifier hs-type">_defined_and_used</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683053489"><span class="hs-identifier hs-type">defined_but_not_used</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1676"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683053488"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053488"><span class="hs-identifier hs-var">_defined_and_used</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053489"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053489"><span class="hs-identifier hs-var">defined_but_not_used</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool)
-&gt; [GlobalRdrElt] -&gt; ([GlobalRdrElt], [GlobalRdrElt])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defs -&gt; GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683053481"><span class="hs-identifier hs-var">gre_is_used</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defs -&gt; Defs
</span><a href="#local-6989586621683053474"><span class="hs-identifier hs-var">used_names</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053487"><span class="hs-identifier hs-var">keep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053478"><span class="hs-identifier hs-var">defined_names</span></a></span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683053490"><span class="hs-identifier hs-var">is_unused_local</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053489"><span class="hs-identifier hs-var">defined_but_not_used</span></a></span><span>
</span><span id="line-1680"></span><span>    </span><span class="annot"><a href="#local-6989586621683053490"><span class="hs-identifier hs-type">is_unused_local</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1681"></span><span>    </span><span id="local-6989586621683053490"><span class="annot"><span class="annottext">is_unused_local :: GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683053490"><span class="hs-identifier hs-var hs-var">is_unused_local</span></a></span></span><span> </span><span id="local-6989586621683053491"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053491"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053491"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1682"></span><span>                       </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053491"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1683"></span><span>
</span><span id="line-1684"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Missing signatures
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1689"></span><span>
</span><span id="line-1690"></span><span class="hs-comment">{-
Note [Missing signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~
There are four warning flags in play:

  * -Wmissing-exported-signatures
    Warn about any exported top-level function/value without a type signature.
    Does not include pattern synonyms.

  * -Wmissing-signatures
    Warn about any top-level function/value without a type signature. Does not
    include pattern synonyms. Takes priority over -Wmissing-exported-signatures.

  * -Wmissing-exported-pattern-synonym-signatures
    Warn about any exported pattern synonym without a type signature.

  * -Wmissing-pattern-synonym-signatures
    Warn about any pattern synonym without a type signature. Takes priority over
    -Wmissing-exported-pattern-synonym-signatures.

-}</span><span>
</span><span id="line-1711"></span><span>
</span><span id="line-1712"></span><span class="hs-comment">-- | Warn the user about top level binders that lack type signatures.</span><span>
</span><span id="line-1713"></span><span class="hs-comment">-- Called /after/ type inference, so that we can report the</span><span>
</span><span id="line-1714"></span><span class="hs-comment">-- inferred type of the function</span><span>
</span><span id="line-1715"></span><span class="annot"><a href="GHC.Rename.Names.html#warnMissingSignatures"><span class="hs-identifier hs-type">warnMissingSignatures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1716"></span><span id="warnMissingSignatures"><span class="annot"><span class="annottext">warnMissingSignatures :: TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#warnMissingSignatures"><span class="hs-identifier hs-var hs-var">warnMissingSignatures</span></a></span></span><span> </span><span id="local-6989586621683053493"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053493"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span>
</span><span id="line-1717"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053494"><span class="annot"><span class="annottext">exports :: Defs
</span><a href="#local-6989586621683053494"><span class="hs-identifier hs-var hs-var hs-var">exports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AvailInfo] -&gt; Defs
</span><a href="GHC.Types.Avail.html#availsToNameSet"><span class="hs-identifier hs-var">availsToNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [AvailInfo]
</span><a href="GHC.Tc.Types.html#tcg_exports"><span class="hs-identifier hs-var">tcg_exports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053493"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1718"></span><span>             </span><span id="local-6989586621683053497"><span class="annot"><span class="annottext">sig_ns :: Defs
</span><a href="#local-6989586621683053497"><span class="hs-identifier hs-var hs-var hs-var">sig_ns</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Defs
</span><a href="GHC.Tc.Types.html#tcg_sigs"><span class="hs-identifier hs-var">tcg_sigs</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053493"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-1719"></span><span>               </span><span class="hs-comment">-- We use sig_ns to exclude top-level bindings that are generated by GHC</span><span>
</span><span id="line-1720"></span><span>             </span><span id="local-6989586621683053499"><span class="annot"><span class="annottext">binds :: [IdP GhcTc]
</span><a href="#local-6989586621683053499"><span class="hs-identifier hs-var hs-var hs-var">binds</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc -&gt; LHsBindsLR GhcTc GhcTc -&gt; [IdP GhcTc]
forall p idR.
CollectPass p =&gt;
CollectFlag p -&gt; LHsBindsLR p idR -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectHsBindsBinders"><span class="hs-identifier hs-var">collectHsBindsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsBindsLR GhcTc GhcTc -&gt; [IdP GhcTc])
-&gt; LHsBindsLR GhcTc GhcTc -&gt; [IdP GhcTc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; LHsBindsLR GhcTc GhcTc
</span><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053493"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-1721"></span><span>             </span><span id="local-6989586621683053503"><span class="annot"><span class="annottext">pat_syns :: [PatSyn]
</span><a href="#local-6989586621683053503"><span class="hs-identifier hs-var hs-var hs-var">pat_syns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [PatSyn]
</span><a href="GHC.Tc.Types.html#tcg_patsyns"><span class="hs-identifier hs-var">tcg_patsyns</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053493"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-1722"></span><span>
</span><span id="line-1723"></span><span>             </span><span class="annot"><a href="#local-6989586621683053505"><span class="hs-identifier hs-type">not_ghc_generated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1724"></span><span>             </span><span id="local-6989586621683053505"><span class="annot"><span class="annottext">not_ghc_generated :: Name -&gt; Bool
</span><a href="#local-6989586621683053505"><span class="hs-identifier hs-var hs-var hs-var">not_ghc_generated</span></a></span></span><span> </span><span id="local-6989586621683053506"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053506"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053506"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053497"><span class="hs-identifier hs-var">sig_ns</span></a></span><span>
</span><span id="line-1725"></span><span>
</span><span id="line-1726"></span><span>             </span><span class="annot"><a href="#local-6989586621683053507"><span class="hs-identifier hs-type">add_binding_warn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1727"></span><span>             </span><span id="local-6989586621683053507"><span class="annot"><span class="annottext">add_binding_warn :: Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683053507"><span class="hs-identifier hs-var hs-var hs-var">add_binding_warn</span></a></span></span><span> </span><span id="local-6989586621683053508"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683053508"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1728"></span><span>               </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683053505"><span class="hs-identifier hs-var">not_ghc_generated</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053509"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1729"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053510"><span class="annot"><a href="#local-6989586621683053510"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv -&gt; TcM TidyEnv
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM TidyEnv -&gt; TcM TidyEnv) -&gt; ZonkM TidyEnv -&gt; TcM TidyEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv
</span><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span> </span><span class="hs-comment">-- Why not use emptyTidyEnv?</span><span>
</span><span id="line-1730"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053512"><span class="annot"><a href="#local-6989586621683053512"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683053510"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683053508"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1731"></span><span>                        </span><span id="local-6989586621683053515"><span class="annot"><a href="#local-6989586621683053515"><span class="hs-identifier hs-var hs-var">missing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; MissingSignature
</span><a href="GHC.Tc.Errors.Types.html#MissingTopLevelBindingSig"><span class="hs-identifier hs-var">MissingTopLevelBindingSig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053509"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683053512"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1732"></span><span>                        </span><span id="local-6989586621683053517"><span class="annot"><a href="#local-6989586621683053517"><span class="hs-identifier hs-var hs-var">diag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MissingSignature -&gt; Exported -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingSignature"><span class="hs-identifier hs-var">TcRnMissingSignature</span></a></span><span> </span><span class="annot"><span class="annottext">MissingSignature
</span><a href="#local-6989586621683053515"><span class="hs-identifier hs-var">missing</span></a></span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="#local-6989586621683053519"><span class="hs-identifier hs-var">exported</span></a></span><span>
</span><span id="line-1733"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-type">addDiagnosticAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-type">getSrcSpan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053509"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053517"><span class="hs-identifier hs-type">diag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1734"></span><span>               </span><span class="hs-keyword">where</span><span>
</span><span id="line-1735"></span><span>                 </span><span id="local-6989586621683053509"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683053509"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683053508"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1736"></span><span>                 </span><span id="local-6989586621683053519"><span class="annot"><span class="annottext">exported :: Exported
</span><a href="#local-6989586621683053519"><span class="hs-identifier hs-var hs-var">exported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053509"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053494"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-1737"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="GHC.Tc.Errors.Types.html#IsExported"><span class="hs-identifier hs-var">IsExported</span></a></span><span>
</span><span id="line-1738"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="GHC.Tc.Errors.Types.html#IsNotExported"><span class="hs-identifier hs-var">IsNotExported</span></a></span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span>             </span><span class="annot"><a href="#local-6989586621683053525"><span class="hs-identifier hs-type">add_patsyn_warn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1741"></span><span>             </span><span id="local-6989586621683053525"><span class="annot"><span class="annottext">add_patsyn_warn :: PatSyn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683053525"><span class="hs-identifier hs-var hs-var hs-var">add_patsyn_warn</span></a></span></span><span> </span><span id="local-6989586621683053526"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683053526"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1742"></span><span>               </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683053505"><span class="hs-identifier hs-var">not_ghc_generated</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053527"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1743"></span><span>                 </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-var">addDiagnosticAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053527"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1744"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MissingSignature -&gt; Exported -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingSignature"><span class="hs-identifier hs-var">TcRnMissingSignature</span></a></span><span> </span><span class="annot"><span class="annottext">MissingSignature
</span><a href="#local-6989586621683053528"><span class="hs-identifier hs-var">missing</span></a></span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="#local-6989586621683053529"><span class="hs-identifier hs-var">exported</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1745"></span><span>               </span><span class="hs-keyword">where</span><span>
</span><span id="line-1746"></span><span>                 </span><span id="local-6989586621683053527"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683053527"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; Name
</span><a href="GHC.Core.PatSyn.html#patSynName"><span class="hs-identifier hs-var">patSynName</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683053526"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1747"></span><span>                 </span><span id="local-6989586621683053528"><span class="annot"><span class="annottext">missing :: MissingSignature
</span><a href="#local-6989586621683053528"><span class="hs-identifier hs-var hs-var">missing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; MissingSignature
</span><a href="GHC.Tc.Errors.Types.html#MissingPatSynSig"><span class="hs-identifier hs-var">MissingPatSynSig</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683053526"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1748"></span><span>                 </span><span id="local-6989586621683053529"><span class="annot"><span class="annottext">exported :: Exported
</span><a href="#local-6989586621683053529"><span class="hs-identifier hs-var hs-var">exported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053527"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053494"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-1749"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="GHC.Tc.Errors.Types.html#IsExported"><span class="hs-identifier hs-var">IsExported</span></a></span><span>
</span><span id="line-1750"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="GHC.Tc.Errors.Types.html#IsNotExported"><span class="hs-identifier hs-var">IsNotExported</span></a></span><span>
</span><span id="line-1751"></span><span>
</span><span id="line-1752"></span><span>         </span><span class="hs-comment">-- Warn about missing signatures</span><span>
</span><span id="line-1753"></span><span>         </span><span class="hs-comment">-- Do this only when we have a type to offer</span><span>
</span><span id="line-1754"></span><span>         </span><span class="hs-comment">-- See Note [Missing signatures]</span><span>
</span><span id="line-1755"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; [Id] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683053507"><span class="hs-identifier hs-var">add_binding_warn</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcTc]
[Id]
</span><a href="#local-6989586621683053499"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1756"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(PatSyn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; [PatSyn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683053525"><span class="hs-identifier hs-var">add_patsyn_warn</span></a></span><span>  </span><span class="annot"><span class="annottext">[PatSyn]
</span><a href="#local-6989586621683053503"><span class="hs-identifier hs-var">pat_syns</span></a></span><span>
</span><span id="line-1757"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1758"></span><span>
</span><span id="line-1759"></span><span class="hs-comment">-- | Warn the user about tycons that lack kind signatures.</span><span>
</span><span id="line-1760"></span><span class="hs-comment">-- Called /after/ type (and kind) inference, so that we can report the</span><span>
</span><span id="line-1761"></span><span class="hs-comment">-- inferred kinds.</span><span>
</span><span id="line-1762"></span><span class="annot"><a href="GHC.Rename.Names.html#warnMissingKindSignatures"><span class="hs-identifier hs-type">warnMissingKindSignatures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1763"></span><span id="warnMissingKindSignatures"><span class="annot"><span class="annottext">warnMissingKindSignatures :: TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#warnMissingKindSignatures"><span class="hs-identifier hs-var hs-var">warnMissingKindSignatures</span></a></span></span><span> </span><span id="local-6989586621683053532"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053532"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span>
</span><span id="line-1764"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053533"><span class="annot"><a href="#local-6989586621683053533"><span class="hs-identifier hs-var">cusks_enabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.CUSKs</span></span><span>
</span><span id="line-1765"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053535"><span class="hs-identifier hs-type">add_ty_warn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053533"><span class="hs-identifier hs-type">cusks_enabled</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053536"><span class="hs-identifier hs-type">tcs</span></a></span><span>
</span><span id="line-1766"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1767"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1768"></span><span>    </span><span id="local-6989586621683053536"><span class="annot"><span class="annottext">tcs :: [TyCon]
</span><a href="#local-6989586621683053536"><span class="hs-identifier hs-var hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [TyCon]
</span><a href="GHC.Tc.Types.html#tcg_tcs"><span class="hs-identifier hs-var">tcg_tcs</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053532"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-1769"></span><span>    </span><span id="local-6989586621683053538"><span class="annot"><span class="annottext">ksig_ns :: Defs
</span><a href="#local-6989586621683053538"><span class="hs-identifier hs-var hs-var">ksig_ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Defs
</span><a href="GHC.Tc.Types.html#tcg_ksigs"><span class="hs-identifier hs-var">tcg_ksigs</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053532"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-1770"></span><span>    </span><span id="local-6989586621683053540"><span class="annot"><span class="annottext">exports :: Defs
</span><a href="#local-6989586621683053540"><span class="hs-identifier hs-var hs-var">exports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AvailInfo] -&gt; Defs
</span><a href="GHC.Types.Avail.html#availsToNameSet"><span class="hs-identifier hs-var">availsToNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [AvailInfo]
</span><a href="GHC.Tc.Types.html#tcg_exports"><span class="hs-identifier hs-var">tcg_exports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053532"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1771"></span><span>
</span><span id="line-1772"></span><span>    </span><span class="annot"><a href="#local-6989586621683053541"><span class="hs-identifier hs-type">has_kind_signature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1773"></span><span>    </span><span id="local-6989586621683053541"><span class="annot"><span class="annottext">has_kind_signature :: Name -&gt; Bool
</span><a href="#local-6989586621683053541"><span class="hs-identifier hs-var hs-var">has_kind_signature</span></a></span></span><span> </span><span id="local-6989586621683053542"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053542"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053542"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053538"><span class="hs-identifier hs-var">ksig_ns</span></a></span><span>
</span><span id="line-1774"></span><span>
</span><span id="line-1775"></span><span>    </span><span class="annot"><a href="#local-6989586621683053535"><span class="hs-identifier hs-type">add_ty_warn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1776"></span><span>    </span><span id="local-6989586621683053535"><span class="annot"><span class="annottext">add_ty_warn :: Bool -&gt; TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683053535"><span class="hs-identifier hs-var hs-var">add_ty_warn</span></a></span></span><span> </span><span id="local-6989586621683053543"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053543"><span class="hs-identifier hs-var">cusks_enabled</span></a></span></span><span> </span><span id="local-6989586621683053544"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683053544"><span class="hs-identifier hs-var">tyCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1777"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683053541"><span class="hs-identifier hs-var">has_kind_signature</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053545"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1778"></span><span>        </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-var">addDiagnosticAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053545"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621683053546"><span class="hs-identifier hs-var">diag</span></a></span><span>
</span><span id="line-1779"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1780"></span><span>        </span><span id="local-6989586621683053545"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683053545"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683053544"><span class="hs-identifier hs-var">tyCon</span></a></span><span>
</span><span id="line-1781"></span><span>        </span><span id="local-6989586621683053546"><span class="annot"><span class="annottext">diag :: TcRnMessage
</span><a href="#local-6989586621683053546"><span class="hs-identifier hs-var hs-var">diag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MissingSignature -&gt; Exported -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingSignature"><span class="hs-identifier hs-var">TcRnMissingSignature</span></a></span><span> </span><span class="annot"><span class="annottext">MissingSignature
</span><a href="#local-6989586621683053547"><span class="hs-identifier hs-var">missing</span></a></span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="#local-6989586621683053548"><span class="hs-identifier hs-var">exported</span></a></span><span>
</span><span id="line-1782"></span><span>        </span><span id="local-6989586621683053547"><span class="annot"><span class="annottext">missing :: MissingSignature
</span><a href="#local-6989586621683053547"><span class="hs-identifier hs-var hs-var">missing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool -&gt; MissingSignature
</span><a href="GHC.Tc.Errors.Types.html#MissingTyConKindSig"><span class="hs-identifier hs-var">MissingTyConKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683053544"><span class="hs-identifier hs-var">tyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053543"><span class="hs-identifier hs-var">cusks_enabled</span></a></span><span>
</span><span id="line-1783"></span><span>        </span><span id="local-6989586621683053548"><span class="annot"><span class="annottext">exported :: Exported
</span><a href="#local-6989586621683053548"><span class="hs-identifier hs-var hs-var">exported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053545"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053540"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-1784"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="GHC.Tc.Errors.Types.html#IsExported"><span class="hs-identifier hs-var">IsExported</span></a></span><span>
</span><span id="line-1785"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exported
</span><a href="GHC.Tc.Errors.Types.html#IsNotExported"><span class="hs-identifier hs-var">IsNotExported</span></a></span><span>
</span><span id="line-1786"></span><span>
</span><span id="line-1787"></span><span class="hs-comment">{-
*********************************************************
*                                                       *
\subsection{Unused imports}
*                                                       *
*********************************************************

This code finds which import declarations are unused.  The
specification and implementation notes are here:
  https://gitlab.haskell.org/ghc/ghc/wikis/commentary/compiler/unused-imports

See also Note [Choosing the best import declaration] in GHC.Types.Name.Reader
-}</span><span>
</span><span id="line-1800"></span><span>
</span><span id="line-1801"></span><span class="hs-keyword">type</span><span> </span><span id="ImportDeclUsage"><span class="annot"><a href="GHC.Rename.Names.html#ImportDeclUsage"><span class="hs-identifier hs-var">ImportDeclUsage</span></a></span></span><span>
</span><span id="line-1802"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="hs-comment">-- The import declaration</span><span>
</span><span id="line-1803"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- What *is* used (normalised)</span><span>
</span><span id="line-1804"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>            </span><span class="hs-comment">-- What is imported but *not* used</span><span>
</span><span id="line-1805"></span><span>
</span><span id="line-1806"></span><span class="annot"><a href="GHC.Rename.Names.html#warnUnusedImportDecls"><span class="hs-identifier hs-type">warnUnusedImportDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1807"></span><span id="warnUnusedImportDecls"><span class="annot"><span class="annottext">warnUnusedImportDecls :: TcGblEnv -&gt; HscSource -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#warnUnusedImportDecls"><span class="hs-identifier hs-var hs-var">warnUnusedImportDecls</span></a></span></span><span> </span><span id="local-6989586621683053550"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053550"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span id="local-6989586621683053551"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683053551"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span>
</span><span id="line-1808"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053552"><span class="annot"><a href="#local-6989586621683053552"><span class="hs-identifier hs-var">uses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [GlobalRdrElt]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [GlobalRdrElt]
</span><a href="GHC.Tc.Types.html#tcg_used_gres"><span class="hs-identifier hs-var">tcg_used_gres</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053550"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1809"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053555"><span class="annot"><a href="#local-6989586621683053555"><span class="hs-identifier hs-var hs-var">user_imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span>
</span><span id="line-1810"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XImportDeclPass -&gt; Bool
</span><a href="GHC.Hs.ImpExp.html#ideclImplicit"><span class="hs-identifier hs-var">ideclImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">(XImportDeclPass -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; XImportDeclPass)
-&gt; GenLocated SrcSpanAnnA (ImportDecl GhcRn)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; XCImportDecl GhcRn
ImportDecl GhcRn -&gt; XImportDeclPass
forall pass. ImportDecl pass -&gt; XCImportDecl pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclExt"><span class="hs-identifier hs-var">ideclExt</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportDecl GhcRn -&gt; XImportDeclPass)
-&gt; (GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; ImportDecl GhcRn)
-&gt; GenLocated SrcSpanAnnA (ImportDecl GhcRn)
-&gt; XImportDeclPass
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; ImportDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1811"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [LImportDecl GhcRn]
</span><a href="GHC.Tc.Types.html#tcg_rn_imports"><span class="hs-identifier hs-var">tcg_rn_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053550"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1812"></span><span>                </span><span class="hs-comment">-- This whole function deals only with *user* imports</span><span>
</span><span id="line-1813"></span><span>                </span><span class="hs-comment">-- both for warning about unnecessary ones, and for</span><span>
</span><span id="line-1814"></span><span>                </span><span class="hs-comment">-- deciding the minimal ones</span><span>
</span><span id="line-1815"></span><span>             </span><span id="local-6989586621683053558"><span class="annot"><a href="#local-6989586621683053558"><span class="hs-identifier hs-var hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683053550"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-1816"></span><span>
</span><span id="line-1817"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683053559"><span class="hs-identifier hs-type">usage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Names.html#ImportDeclUsage"><span class="hs-identifier hs-type">ImportDeclUsage</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1818"></span><span>             </span><span id="local-6989586621683053559"><span class="annot"><a href="#local-6989586621683053559"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcRn] -&gt; [GlobalRdrElt] -&gt; [ImportDeclUsage]
</span><a href="GHC.Rename.Names.html#findImportUsage"><span class="hs-identifier hs-var">findImportUsage</span></a></span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcRn]
[GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
</span><a href="#local-6989586621683053555"><span class="hs-identifier hs-var">user_imports</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053552"><span class="hs-identifier hs-var">uses</span></a></span><span>
</span><span id="line-1819"></span><span>
</span><span id="line-1820"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;warnUnusedImportDecls&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1821"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Uses:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053552"><span class="hs-identifier hs-type">uses</span></a></span><span>
</span><span id="line-1822"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Import usage&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053559"><span class="hs-identifier hs-type">usage</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1823"></span><span>
</span><span id="line-1824"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Names.html#warnUnusedImport"><span class="hs-identifier hs-type">warnUnusedImport</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053558"><span class="hs-identifier hs-type">rdr_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053559"><span class="hs-identifier hs-type">usage</span></a></span><span>
</span><span id="line-1825"></span><span>
</span><span id="line-1826"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier hs-type">whenGOptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_minimal_imports"><span class="hs-identifier hs-type">Opt_D_dump_minimal_imports</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1827"></span><span>         </span><span class="annot"><a href="GHC.Rename.Names.html#printMinimalImports"><span class="hs-identifier hs-type">printMinimalImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053551"><span class="hs-identifier hs-type">hsc_src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053559"><span class="hs-identifier hs-type">usage</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1828"></span><span>
</span><span id="line-1829"></span><span class="annot"><a href="GHC.Rename.Names.html#findImportUsage"><span class="hs-identifier hs-type">findImportUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1830"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1831"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Names.html#ImportDeclUsage"><span class="hs-identifier hs-type">ImportDeclUsage</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1832"></span><span>
</span><span id="line-1833"></span><span id="findImportUsage"><span class="annot"><span class="annottext">findImportUsage :: [LImportDecl GhcRn] -&gt; [GlobalRdrElt] -&gt; [ImportDeclUsage]
</span><a href="GHC.Rename.Names.html#findImportUsage"><span class="hs-identifier hs-var hs-var">findImportUsage</span></a></span></span><span> </span><span id="local-6989586621683053563"><span class="annot"><span class="annottext">[LImportDecl GhcRn]
</span><a href="#local-6989586621683053563"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span id="local-6989586621683053564"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053564"><span class="hs-identifier hs-var">used_gres</span></a></span></span><span>
</span><span id="line-1834"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (ImportDecl GhcRn)
 -&gt; (GenLocated SrcSpanAnnA (ImportDecl GhcRn), [GlobalRdrElt],
     [Name]))
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcRn), [GlobalRdrElt],
     [Name])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LImportDecl GhcRn -&gt; ImportDeclUsage
GenLocated SrcSpanAnnA (ImportDecl GhcRn)
-&gt; (GenLocated SrcSpanAnnA (ImportDecl GhcRn), [GlobalRdrElt],
    [Name])
</span><a href="#local-6989586621683053565"><span class="hs-identifier hs-var">unused_decl</span></a></span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcRn]
[GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
</span><a href="#local-6989586621683053563"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-1835"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1836"></span><span>    </span><span class="annot"><a href="#local-6989586621683053566"><span class="hs-identifier hs-type">import_usage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImportMap"><span class="hs-identifier hs-type">ImportMap</span></a></span><span>
</span><span id="line-1837"></span><span>    </span><span id="local-6989586621683053566"><span class="annot"><span class="annottext">import_usage :: ImportMap
</span><a href="#local-6989586621683053566"><span class="hs-identifier hs-var hs-var">import_usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; ImportMap
</span><a href="GHC.Rename.Names.html#mkImportMap"><span class="hs-identifier hs-var">mkImportMap</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053564"><span class="hs-identifier hs-var">used_gres</span></a></span><span>
</span><span id="line-1838"></span><span>
</span><span id="line-1839"></span><span>    </span><span class="annot"><a href="#local-6989586621683053565"><span class="hs-identifier hs-type">unused_decl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1840"></span><span>    </span><span id="local-6989586621683053565"><span class="annot"><span class="annottext">unused_decl :: LImportDecl GhcRn -&gt; ImportDeclUsage
</span><a href="#local-6989586621683053565"><span class="hs-identifier hs-var hs-var">unused_decl</span></a></span></span><span> </span><span id="local-6989586621683053568"><span class="annot"><span class="annottext">decl :: LImportDecl GhcRn
</span><a href="#local-6989586621683053568"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053569"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053569"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ideclImportList :: forall pass.
ImportDecl pass
-&gt; Maybe (ImportListInterpretation, XRec pass [LIE pass])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053570"><span class="annot"><span class="annottext">Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
</span><a href="#local-6989586621683053570"><span class="hs-identifier hs-var">imps</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1841"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LImportDecl GhcRn
</span><a href="#local-6989586621683053568"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053571"><span class="hs-identifier hs-var">used_gres</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Defs -&gt; [Name]
</span><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053573"><span class="hs-identifier hs-var">unused_imps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1842"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1843"></span><span>        </span><span id="local-6989586621683053571"><span class="annot"><span class="annottext">used_gres :: [GlobalRdrElt]
</span><a href="#local-6989586621683053571"><span class="hs-identifier hs-var hs-var">used_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; ImportMap -&gt; Maybe [GlobalRdrElt]
forall a. SrcLoc -&gt; Map RealSrcLoc a -&gt; Maybe a
</span><a href="GHC.Types.SrcLoc.html#lookupSrcLoc"><span class="hs-identifier hs-var">lookupSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcLoc
</span><a href="GHC.Types.SrcLoc.html#srcSpanEnd"><span class="hs-identifier hs-var">srcSpanEnd</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; SrcLoc) -&gt; SrcSpan -&gt; SrcLoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053569"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ImportMap
</span><a href="#local-6989586621683053566"><span class="hs-identifier hs-var">import_usage</span></a></span><span>
</span><span id="line-1844"></span><span>                               </span><span class="hs-comment">-- srcSpanEnd: see Note [The ImportMap]</span><span>
</span><span id="line-1845"></span><span>                    </span><span class="annot"><span class="annottext">Maybe [GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1846"></span><span>
</span><span id="line-1847"></span><span>        </span><span id="local-6989586621683053576"><span class="annot"><span class="annottext">used_names :: Defs
</span><a href="#local-6989586621683053576"><span class="hs-identifier hs-var hs-var">used_names</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>      </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span>        </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053571"><span class="hs-identifier hs-var">used_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1848"></span><span>        </span><span id="local-6989586621683053577"><span class="annot"><span class="annottext">used_parents :: Defs
</span><a href="#local-6989586621683053577"><span class="hs-identifier hs-var hs-var">used_parents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Maybe Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe Name
forall info. GlobalRdrEltX info -&gt; Maybe Name
</span><a href="GHC.Types.Name.Reader.html#greParent_maybe"><span class="hs-identifier hs-var">greParent_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053571"><span class="hs-identifier hs-var">used_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>
</span><span id="line-1850"></span><span>        </span><span id="local-6989586621683053573"><span class="annot"><span class="annottext">unused_imps :: Defs
</span><a href="#local-6989586621683053573"><span class="hs-identifier hs-var hs-var">unused_imps</span></a></span></span><span>   </span><span class="hs-comment">-- Not trivial; see eg #7454</span><span>
</span><span id="line-1851"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
</span><a href="#local-6989586621683053570"><span class="hs-identifier hs-var">imps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1852"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLI
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053579"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IE GhcRn)]
</span><a href="#local-6989586621683053579"><span class="hs-identifier hs-var">imp_ies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1853"></span><span>                                 </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (IE GhcRn) -&gt; Defs -&gt; Defs)
-&gt; Defs -&gt; [GenLocated SrcSpanAnnA (IE GhcRn)] -&gt; Defs
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IE GhcRn -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053580"><span class="hs-identifier hs-var">add_unused</span></a></span><span> </span><span class="annot"><span class="annottext">(IE GhcRn -&gt; Defs -&gt; Defs)
-&gt; (GenLocated SrcSpanAnnA (IE GhcRn) -&gt; IE GhcRn)
-&gt; GenLocated SrcSpanAnnA (IE GhcRn)
-&gt; Defs
-&gt; Defs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (IE GhcRn) -&gt; IE GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IE GhcRn)]
</span><a href="#local-6989586621683053579"><span class="hs-identifier hs-var">imp_ies</span></a></span><span>
</span><span id="line-1854"></span><span>              </span><span id="local-6989586621683053581"><span class="annot"><span class="annottext">Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
</span><a href="#local-6989586621683053581"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span> </span><span class="hs-comment">-- No explicit import list =&gt; no unused-name list</span><span>
</span><span id="line-1855"></span><span>
</span><span id="line-1856"></span><span>        </span><span class="annot"><a href="#local-6989586621683053580"><span class="hs-identifier hs-type">add_unused</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>
</span><span id="line-1857"></span><span>        </span><span id="local-6989586621683053580"><span class="annot"><span class="annottext">add_unused :: IE GhcRn -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053580"><span class="hs-identifier hs-var hs-var">add_unused</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEVar"><span class="hs-identifier hs-type">IEVar</span></a></span><span> </span><span class="annot"><span class="annottext">XIEVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053582"><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053582"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621683053583"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053583"><span class="hs-identifier hs-var">acc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053584"><span class="hs-identifier hs-var">add_unused_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LIEWrappedName GhcRn -&gt; IdP GhcRn
forall (p :: Pass). LIEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#lieWrappedName"><span class="hs-identifier hs-var">lieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053582"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053583"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1858"></span><span>        </span><span class="annot"><a href="#local-6989586621683053580"><span class="hs-identifier hs-var">add_unused</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAbs"><span class="hs-identifier hs-type">IEThingAbs</span></a></span><span> </span><span class="annot"><span class="annottext">XIEThingAbs GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053585"><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053585"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683053586"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053586"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053584"><span class="hs-identifier hs-var">add_unused_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LIEWrappedName GhcRn -&gt; IdP GhcRn
forall (p :: Pass). LIEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#lieWrappedName"><span class="hs-identifier hs-var">lieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053585"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053586"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1859"></span><span>        </span><span class="annot"><a href="#local-6989586621683053580"><span class="hs-identifier hs-var">add_unused</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAll"><span class="hs-identifier hs-type">IEThingAll</span></a></span><span> </span><span class="annot"><span class="annottext">XIEThingAll GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053587"><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053587"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683053588"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053588"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053589"><span class="hs-identifier hs-var">add_unused_all</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LIEWrappedName GhcRn -&gt; IdP GhcRn
forall (p :: Pass). LIEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#lieWrappedName"><span class="hs-identifier hs-var">lieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053587"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053588"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1860"></span><span>        </span><span class="annot"><a href="#local-6989586621683053580"><span class="hs-identifier hs-var">add_unused</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingWith"><span class="hs-identifier hs-type">IEThingWith</span></a></span><span> </span><span class="annot"><span class="annottext">XIEThingWith GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053590"><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053590"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683053591"><span class="annot"><span class="annottext">IEWildcard
</span><a href="#local-6989586621683053591"><span class="hs-identifier hs-var">wc</span></a></span></span><span> </span><span id="local-6989586621683053592"><span class="annot"><span class="annottext">[LIEWrappedName GhcRn]
</span><a href="#local-6989586621683053592"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683053593"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053593"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1861"></span><span>          </span><span class="annot"><span class="annottext">Defs -&gt; Defs
</span><a href="#local-6989586621683053594"><span class="hs-identifier hs-var">add_wc_all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053595"><span class="hs-identifier hs-var">add_unused_with</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053596"><span class="hs-identifier hs-var">pn</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053597"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053593"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1862"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683053596"><span class="annot"><span class="annottext">pn :: IdP GhcRn
</span><a href="#local-6989586621683053596"><span class="hs-identifier hs-var hs-var">pn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn -&gt; IdP GhcRn
forall (p :: Pass). LIEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#lieWrappedName"><span class="hs-identifier hs-var">lieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn
</span><a href="#local-6989586621683053590"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1863"></span><span>                </span><span id="local-6989586621683053597"><span class="annot"><span class="annottext">xs :: [Name]
</span><a href="#local-6989586621683053597"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (IEWrappedName GhcRn) -&gt; Name)
-&gt; [GenLocated SrcSpanAnnA (IEWrappedName GhcRn)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName GhcRn -&gt; IdP GhcRn
GenLocated SrcSpanAnnA (IEWrappedName GhcRn) -&gt; Name
forall (p :: Pass). LIEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#lieWrappedName"><span class="hs-identifier hs-var">lieWrappedName</span></a></span><span> </span><span class="annot"><span class="annottext">[LIEWrappedName GhcRn]
[GenLocated SrcSpanAnnA (IEWrappedName GhcRn)]
</span><a href="#local-6989586621683053592"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-1864"></span><span>                </span><span id="local-6989586621683053594"><span class="annot"><span class="annottext">add_wc_all :: Defs -&gt; Defs
</span><a href="#local-6989586621683053594"><span class="hs-identifier hs-var hs-var">add_wc_all</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IEWildcard
</span><a href="#local-6989586621683053591"><span class="hs-identifier hs-var">wc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1865"></span><span>                            </span><span class="annot"><span class="annottext">IEWildcard
</span><a href="Language.Haskell.Syntax.ImpExp.html#NoIEWildcard"><span class="hs-identifier hs-var">NoIEWildcard</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1866"></span><span>                            </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEWildcard"><span class="hs-identifier hs-type">IEWildcard</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053589"><span class="hs-identifier hs-var">add_unused_all</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053596"><span class="hs-identifier hs-var">pn</span></a></span><span>
</span><span id="line-1867"></span><span>        </span><span class="annot"><a href="#local-6989586621683053580"><span class="hs-identifier hs-var">add_unused</span></a></span><span> </span><span class="annot"><span class="annottext">IE GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053600"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053600"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053600"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1868"></span><span>
</span><span id="line-1869"></span><span>        </span><span id="local-6989586621683053584"><span class="annot"><span class="annottext">add_unused_name :: Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053584"><span class="hs-identifier hs-var hs-var">add_unused_name</span></a></span></span><span> </span><span id="local-6989586621683053601"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053601"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683053602"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053602"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-1870"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053601"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053576"><span class="hs-identifier hs-var">used_names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053602"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1871"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053602"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Name -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-operator hs-var">`extendNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053601"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1872"></span><span>        </span><span id="local-6989586621683053589"><span class="annot"><span class="annottext">add_unused_all :: Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053589"><span class="hs-identifier hs-var hs-var">add_unused_all</span></a></span></span><span> </span><span id="local-6989586621683053604"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053604"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683053605"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053605"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-1873"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053604"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053576"><span class="hs-identifier hs-var">used_names</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053605"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1874"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053604"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053577"><span class="hs-identifier hs-var">used_parents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053605"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1875"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053605"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Name -&gt; Defs
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-operator hs-var">`extendNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053604"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1876"></span><span>        </span><span id="local-6989586621683053595"><span class="annot"><span class="annottext">add_unused_with :: Name -&gt; [Name] -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053595"><span class="hs-identifier hs-var hs-var">add_unused_with</span></a></span></span><span> </span><span id="local-6989586621683053606"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053606"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683053607"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053607"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621683053608"><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053608"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-1877"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053609"><span class="hs-identifier hs-var">acc1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053607"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053584"><span class="hs-identifier hs-var">add_unused_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053606"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053609"><span class="hs-identifier hs-var">acc1</span></a></span><span>
</span><span id="line-1878"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053609"><span class="hs-identifier hs-var">acc1</span></a></span><span>
</span><span id="line-1879"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1880"></span><span>            </span><span id="local-6989586621683053609"><span class="annot"><span class="annottext">acc1 :: Defs
</span><a href="#local-6989586621683053609"><span class="hs-identifier hs-var hs-var">acc1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Defs -&gt; Defs) -&gt; Defs -&gt; [Name] -&gt; Defs
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Defs -&gt; Defs
</span><a href="#local-6989586621683053584"><span class="hs-identifier hs-var">add_unused_name</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621683053608"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053607"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-1881"></span><span>       </span><span class="hs-comment">-- If you use 'signum' from Num, then the user may well have</span><span>
</span><span id="line-1882"></span><span>       </span><span class="hs-comment">-- imported Num(signum).  We don't want to complain that</span><span>
</span><span id="line-1883"></span><span>       </span><span class="hs-comment">-- Num is not itself mentioned.  Hence the two cases in add_unused_with.</span><span>
</span><span id="line-1884"></span><span>
</span><span id="line-1885"></span><span>
</span><span id="line-1886"></span><span class="hs-comment">{- Note [The ImportMap]
~~~~~~~~~~~~~~~~~~~~~~~
The ImportMap is a short-lived intermediate data structure records, for
each import declaration, what stuff brought into scope by that
declaration is actually used in the module.

The SrcLoc is the location of the END of a particular 'import'
declaration.  Why *END*?  Because we don't want to get confused
by the implicit Prelude import. Consider (#7476) the module
    import Foo( foo )
    main = print foo
There is an implicit 'import Prelude(print)', and it gets a SrcSpan
of line 1:1 (just the point, not a span). If we use the *START* of
the SrcSpan to identify the import decl, we'll confuse the implicit
import Prelude with the explicit 'import Foo'.  So we use the END.
It's just a cheap hack; we could equally well use the Span too.

The [GlobalRdrElt] are the things imported from that decl.
-}</span><span>
</span><span id="line-1905"></span><span>
</span><span id="line-1906"></span><span class="hs-keyword">type</span><span> </span><span id="ImportMap"><span class="annot"><a href="GHC.Rename.Names.html#ImportMap"><span class="hs-identifier hs-var">ImportMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcLoc"><span class="hs-identifier hs-type">RealSrcLoc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- See [The ImportMap]</span><span>
</span><span id="line-1907"></span><span>     </span><span class="hs-comment">-- If loc :-&gt; gres, then</span><span>
</span><span id="line-1908"></span><span>     </span><span class="hs-comment">--   'loc' = the end loc of the bestImport of each GRE in 'gres'</span><span>
</span><span id="line-1909"></span><span>
</span><span id="line-1910"></span><span class="annot"><a href="GHC.Rename.Names.html#mkImportMap"><span class="hs-identifier hs-type">mkImportMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImportMap"><span class="hs-identifier hs-type">ImportMap</span></a></span><span>
</span><span id="line-1911"></span><span class="hs-comment">-- For each of a list of used GREs, find all the import decls that brought</span><span>
</span><span id="line-1912"></span><span class="hs-comment">-- it into scope; choose one of them (bestImport), and record</span><span>
</span><span id="line-1913"></span><span class="hs-comment">-- the RdrName in that import decl's entry in the ImportMap</span><span>
</span><span id="line-1914"></span><span id="mkImportMap"><span class="annot"><span class="annottext">mkImportMap :: [GlobalRdrElt] -&gt; ImportMap
</span><a href="GHC.Rename.Names.html#mkImportMap"><span class="hs-identifier hs-var hs-var">mkImportMap</span></a></span></span><span> </span><span id="local-6989586621683053610"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053610"><span class="hs-identifier hs-var">gres</span></a></span></span><span>
</span><span id="line-1915"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; ImportMap -&gt; ImportMap)
-&gt; ImportMap -&gt; [GlobalRdrElt] -&gt; ImportMap
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; ImportMap -&gt; ImportMap
forall {info}.
Outputable info =&gt;
GlobalRdrEltX info
-&gt; Map RealSrcLoc [GlobalRdrEltX info]
-&gt; Map RealSrcLoc [GlobalRdrEltX info]
</span><a href="#local-6989586621683053611"><span class="hs-identifier hs-var">add_one</span></a></span><span> </span><span class="annot"><span class="annottext">ImportMap
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053610"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1916"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1917"></span><span>    </span><span id="local-6989586621683053611"><span class="annot"><span class="annottext">add_one :: GlobalRdrEltX info
-&gt; Map RealSrcLoc [GlobalRdrEltX info]
-&gt; Map RealSrcLoc [GlobalRdrEltX info]
</span><a href="#local-6989586621683053611"><span class="hs-identifier hs-var hs-var">add_one</span></a></span></span><span> </span><span id="local-6989586621683053620"><span class="annot"><span class="annottext">gre :: GlobalRdrEltX info
</span><a href="#local-6989586621683053620"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GRE"><span class="hs-identifier hs-type">GRE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gre_imp :: forall info. GlobalRdrEltX info -&gt; Bag ImportSpec
</span><a href="GHC.Types.Name.Reader.html#gre_imp"><span class="hs-identifier hs-var">gre_imp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053621"><span class="annot"><span class="annottext">Bag ImportSpec
</span><a href="#local-6989586621683053621"><span class="hs-identifier hs-var">imp_specs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683053622"><span class="annot"><span class="annottext">Map RealSrcLoc [GlobalRdrEltX info]
</span><a href="#local-6989586621683053622"><span class="hs-identifier hs-var">imp_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1918"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcLoc
</span><a href="GHC.Types.SrcLoc.html#srcSpanEnd"><span class="hs-identifier hs-var">srcSpanEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; SrcSpan
</span><a href="GHC.Types.Name.Reader.html#is_dloc"><span class="hs-identifier hs-var">is_dloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportSpec -&gt; ImpDeclSpec
</span><a href="GHC.Types.Name.Reader.html#is_decl"><span class="hs-identifier hs-var">is_decl</span></a></span><span> </span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053623"><span class="hs-identifier hs-var">best_imp_spec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1919"></span><span>                              </span><span class="hs-comment">-- For srcSpanEnd see Note [The ImportMap]</span><span>
</span><span id="line-1920"></span><span>       </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcLoc"><span class="hs-identifier hs-type">RealSrcLoc</span></a></span><span> </span><span id="local-6989586621683053625"><span class="annot"><span class="annottext">RealSrcLoc
</span><a href="#local-6989586621683053625"><span class="hs-identifier hs-var">decl_loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufPos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([GlobalRdrEltX info]
 -&gt; [GlobalRdrEltX info] -&gt; [GlobalRdrEltX info])
-&gt; RealSrcLoc
-&gt; [GlobalRdrEltX info]
-&gt; Map RealSrcLoc [GlobalRdrEltX info]
-&gt; Map RealSrcLoc [GlobalRdrEltX info]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">Map.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrEltX info]
-&gt; [GlobalRdrEltX info] -&gt; [GlobalRdrEltX info]
</span><a href="#local-6989586621683053627"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcLoc
</span><a href="#local-6989586621683053625"><span class="hs-identifier hs-var">decl_loc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053620"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Map RealSrcLoc [GlobalRdrEltX info]
</span><a href="#local-6989586621683053622"><span class="hs-identifier hs-var">imp_map</span></a></span><span>
</span><span id="line-1921"></span><span>       </span><span class="annot"><a href="GHC.Types.SrcLoc.html#UnhelpfulLoc"><span class="hs-identifier hs-type">UnhelpfulLoc</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map RealSrcLoc [GlobalRdrEltX info]
</span><a href="#local-6989586621683053622"><span class="hs-identifier hs-var">imp_map</span></a></span><span>
</span><span id="line-1922"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-1923"></span><span>          </span><span id="local-6989586621683053623"><span class="annot"><span class="annottext">best_imp_spec :: ImportSpec
</span><a href="#local-6989586621683053623"><span class="hs-identifier hs-var hs-var">best_imp_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1924"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bag ImportSpec -&gt; [ImportSpec]
forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="annot"><span class="annottext">Bag ImportSpec
</span><a href="#local-6989586621683053621"><span class="hs-identifier hs-var">imp_specs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1925"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ImportSpec
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkImportMap: GRE with no ImportSpecs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrEltX info -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053620"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1926"></span><span>              </span><span id="local-6989586621683053630"><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053630"><span class="hs-identifier hs-var">is</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683053631"><span class="annot"><span class="annottext">[ImportSpec]
</span><a href="#local-6989586621683053631"><span class="hs-identifier hs-var">iss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty ImportSpec -&gt; ImportSpec
</span><a href="GHC.Types.Name.Reader.html#bestImport"><span class="hs-identifier hs-var">bestImport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053630"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">ImportSpec -&gt; [ImportSpec] -&gt; NonEmpty ImportSpec
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[ImportSpec]
</span><a href="#local-6989586621683053631"><span class="hs-identifier hs-var">iss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1927"></span><span>          </span><span id="local-6989586621683053627"><span class="annot"><span class="annottext">add :: [GlobalRdrEltX info]
-&gt; [GlobalRdrEltX info] -&gt; [GlobalRdrEltX info]
</span><a href="#local-6989586621683053627"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrEltX info]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053633"><span class="annot"><span class="annottext">[GlobalRdrEltX info]
</span><a href="#local-6989586621683053633"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info
</span><a href="#local-6989586621683053620"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEltX info -&gt; [GlobalRdrEltX info] -&gt; [GlobalRdrEltX info]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrEltX info]
</span><a href="#local-6989586621683053633"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span class="annot"><a href="GHC.Rename.Names.html#warnUnusedImport"><span class="hs-identifier hs-type">warnUnusedImport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#ImportDeclUsage"><span class="hs-identifier hs-type">ImportDeclUsage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1930"></span><span id="warnUnusedImport"><span class="annot"><span class="annottext">warnUnusedImport :: GlobalRdrEnv -&gt; ImportDeclUsage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#warnUnusedImport"><span class="hs-identifier hs-var hs-var">warnUnusedImport</span></a></span></span><span> </span><span id="local-6989586621683053634"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053634"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053635"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053635"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683053636"><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053637"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053637"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053638"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053638"><span class="hs-identifier hs-var">unused</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1931"></span><span>
</span><span id="line-1932"></span><span>  </span><span class="hs-comment">-- Do not warn for 'import M()'</span><span>
</span><span id="line-1933"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLI
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
-&gt; Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
forall pass.
ImportDecl pass
-&gt; Maybe (ImportListInterpretation, XRec pass [LIE pass])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-1934"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1935"></span><span>
</span><span id="line-1936"></span><span>  </span><span class="hs-comment">-- Note [Do not warn about Prelude hiding]</span><span>
</span><span id="line-1937"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#EverythingBut"><span class="hs-identifier hs-var">EverythingBut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLI
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053639"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IE GhcRn)]
</span><a href="#local-6989586621683053639"><span class="hs-identifier hs-var">hides</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
-&gt; Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
forall pass.
ImportDecl pass
-&gt; Maybe (ImportListInterpretation, XRec pass [LIE pass])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-1938"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IE GhcRn)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IE GhcRn)]
</span><a href="#local-6989586621683053639"><span class="hs-identifier hs-var">hides</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1939"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="GHC.Builtin.Names.html#pRELUDE_NAME"><span class="hs-identifier hs-var">pRELUDE_NAME</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; XRec GhcRn ModuleName
forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1940"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1941"></span><span>
</span><span id="line-1942"></span><span>  </span><span class="hs-comment">-- Nothing used; drop entire declaration</span><span>
</span><span id="line-1943"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053637"><span class="hs-identifier hs-var">used</span></a></span><span>
</span><span id="line-1944"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-var">addDiagnosticAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053635"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; UnusedImportReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnusedImport"><span class="hs-identifier hs-var">TcRnUnusedImport</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">UnusedImportReason
</span><a href="GHC.Tc.Errors.Types.html#UnusedImportNone"><span class="hs-identifier hs-var">UnusedImportNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1945"></span><span>
</span><span id="line-1946"></span><span>  </span><span class="hs-comment">-- Everything imported is used; nop</span><span>
</span><span id="line-1947"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053638"><span class="hs-identifier hs-var">unused</span></a></span><span>
</span><span id="line-1948"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1949"></span><span>
</span><span id="line-1950"></span><span>  </span><span class="hs-comment">-- Only one import is unused, with `SrcSpan` covering only the unused item instead of</span><span>
</span><span id="line-1951"></span><span>  </span><span class="hs-comment">-- the whole import statement</span><span>
</span><span id="line-1952"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportListInterpretation
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLI
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053643"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IE GhcRn)]
</span><a href="#local-6989586621683053643"><span class="hs-identifier hs-var">imports</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
-&gt; Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
forall pass.
ImportDecl pass
-&gt; Maybe (ImportListInterpretation, XRec pass [LIE pass])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-1953"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053638"><span class="hs-identifier hs-var">unused</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1954"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053645"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053645"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">IE GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (IE GhcRn) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (IE GhcRn)]
-&gt; Maybe (GenLocated SrcSpanAnnA (IE GhcRn))
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053646"><span class="annot"><span class="annottext">IE GhcRn
</span><a href="#local-6989586621683053646"><span class="hs-identifier hs-var">ie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IE GhcRn -&gt; IdP GhcRn
forall (p :: Pass). IE (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieName"><span class="hs-identifier hs-var">ieName</span></a></span><span> </span><span class="annot"><span class="annottext">IE GhcRn
</span><a href="#local-6989586621683053646"><span class="hs-identifier hs-var">ie</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053638"><span class="hs-identifier hs-var">unused</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (IE GhcRn)]
</span><a href="#local-6989586621683053643"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-1955"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-var">addDiagnosticAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053645"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; UnusedImportReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnusedImport"><span class="hs-identifier hs-var">TcRnUnusedImport</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnusedImportName] -&gt; UnusedImportReason
</span><a href="GHC.Tc.Errors.Types.html#UnusedImportSome"><span class="hs-identifier hs-var">UnusedImportSome</span></a></span><span> </span><span class="annot"><span class="annottext">[UnusedImportName]
</span><a href="#local-6989586621683053649"><span class="hs-identifier hs-var">sort_unused</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1956"></span><span>
</span><span id="line-1957"></span><span>  </span><span class="hs-comment">-- Some imports are unused</span><span>
</span><span id="line-1958"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1959"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-var">addDiagnosticAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053635"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; UnusedImportReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnusedImport"><span class="hs-identifier hs-var">TcRnUnusedImport</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053636"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnusedImportName] -&gt; UnusedImportReason
</span><a href="GHC.Tc.Errors.Types.html#UnusedImportSome"><span class="hs-identifier hs-var">UnusedImportSome</span></a></span><span> </span><span class="annot"><span class="annottext">[UnusedImportName]
</span><a href="#local-6989586621683053649"><span class="hs-identifier hs-var">sort_unused</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1960"></span><span>
</span><span id="line-1961"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1962"></span><span>    </span><span class="hs-comment">-- In warning message, pretty-print identifiers unqualified unconditionally</span><span>
</span><span id="line-1963"></span><span>    </span><span class="hs-comment">-- to improve the consistent for ambiguous/unambiguous identifiers.</span><span>
</span><span id="line-1964"></span><span>    </span><span class="hs-comment">-- See #14881.</span><span>
</span><span id="line-1965"></span><span>    </span><span id="local-6989586621683053650"><span class="annot"><span class="annottext">possible_field :: Name -&gt; UnusedImportName
</span><a href="#local-6989586621683053650"><span class="hs-identifier hs-var hs-var">possible_field</span></a></span></span><span> </span><span id="local-6989586621683053651"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053651"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1966"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053634"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053651"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1967"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GRE"><span class="hs-identifier hs-type">GRE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gre_par :: forall info. GlobalRdrEltX info -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#gre_par"><span class="hs-identifier hs-var">gre_par</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053653"><span class="annot"><span class="annottext">Parent
</span><a href="#local-6989586621683053653"><span class="hs-identifier hs-var">par</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_info :: forall info. GlobalRdrEltX info -&gt; info
</span><a href="GHC.Types.Name.Reader.html#gre_info"><span class="hs-identifier hs-var">gre_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#IAmRecField"><span class="hs-identifier hs-type">IAmRecField</span></a></span><span> </span><span id="local-6989586621683053655"><span class="annot"><span class="annottext">RecFieldInfo
</span><a href="#local-6989586621683053655"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1968"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683053656"><span class="hs-identifier hs-type">fld_occ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-1969"></span><span>              </span><span id="local-6989586621683053656"><span class="annot"><span class="annottext">fld_occ :: OccName
</span><a href="#local-6989586621683053656"><span class="hs-identifier hs-var hs-var">fld_occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; Name -&gt; OccName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; FieldLabel -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecFieldInfo -&gt; FieldLabel
</span><a href="GHC.Types.GREInfo.html#recFieldLabel"><span class="hs-identifier hs-var">recFieldLabel</span></a></span><span> </span><span class="annot"><span class="annottext">RecFieldInfo
</span><a href="#local-6989586621683053655"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1970"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Parent -&gt; OccName -&gt; UnusedImportName
</span><a href="GHC.Tc.Errors.Types.html#UnusedImportNameRecField"><span class="hs-identifier hs-var">UnusedImportNameRecField</span></a></span><span> </span><span class="annot"><span class="annottext">Parent
</span><a href="#local-6989586621683053653"><span class="hs-identifier hs-var">par</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053656"><span class="hs-identifier hs-var">fld_occ</span></a></span><span>
</span><span id="line-1971"></span><span>        </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UnusedImportName
</span><a href="GHC.Tc.Errors.Types.html#UnusedImportNameRegular"><span class="hs-identifier hs-var">UnusedImportNameRegular</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053651"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1972"></span><span>
</span><span id="line-1973"></span><span>    </span><span class="hs-comment">-- Print unused names in a deterministic (lexicographic) order</span><span>
</span><span id="line-1974"></span><span>    </span><span class="annot"><a href="#local-6989586621683053649"><span class="hs-identifier hs-type">sort_unused</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#UnusedImportName"><span class="hs-identifier hs-type">UnusedImportName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1975"></span><span>    </span><span id="local-6989586621683053649"><span class="annot"><span class="annottext">sort_unused :: [UnusedImportName]
</span><a href="#local-6989586621683053649"><span class="hs-identifier hs-var hs-var">sort_unused</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; UnusedImportName) -&gt; [Name] -&gt; [UnusedImportName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; UnusedImportName
</span><a href="#local-6989586621683053650"><span class="hs-identifier hs-var">possible_field</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [UnusedImportName]) -&gt; [Name] -&gt; [UnusedImportName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1976"></span><span>                  </span><span class="annot"><span class="annottext">(Name -&gt; Name -&gt; Ordering) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; Name -&gt; Name -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053638"><span class="hs-identifier hs-var">unused</span></a></span><span>
</span><span id="line-1977"></span><span>
</span><span id="line-1978"></span><span class="hs-comment">{-
Note [Do not warn about Prelude hiding]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We do not warn about
   import Prelude hiding( x, y )
because even if nothing else from Prelude is used, it may be essential to hide
x,y to avoid name-shadowing warnings.  Example (#9061)
   import Prelude hiding( log )
   f x = log where log = ()



Note [Printing minimal imports]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To print the minimal imports we walk over the user-supplied import
decls, and simply trim their import lists.  NB that

  * We do *not* change the 'qualified' or 'as' parts!

  * We do not discard a decl altogether; we might need instances
    from it.  Instead we just trim to an empty import list
-}</span><span>
</span><span id="line-2000"></span><span>
</span><span id="line-2001"></span><span class="annot"><a href="GHC.Rename.Names.html#getMinimalImports"><span class="hs-identifier hs-type">getMinimalImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Names.html#ImportDeclUsage"><span class="hs-identifier hs-type">ImportDeclUsage</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2002"></span><span id="getMinimalImports"><span class="annot"><span class="annottext">getMinimalImports :: [ImportDeclUsage] -&gt; RnM [LImportDecl GhcRn]
</span><a href="GHC.Rename.Names.html#getMinimalImports"><span class="hs-identifier hs-var hs-var">getMinimalImports</span></a></span></span><span> </span><span id="local-6989586621683053660"><span class="annot"><span class="annottext">[ImportDeclUsage]
</span><a href="#local-6989586621683053660"><span class="hs-identifier hs-var">ie_decls</span></a></span></span><span>
</span><span id="line-2003"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053661"><span class="annot"><a href="#local-6989586621683053661"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-2004"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621683053663"><span class="hs-identifier hs-type">combine</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053664"><span class="hs-identifier hs-type">mk_minimal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053661"><span class="hs-identifier hs-type">rdr_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053660"><span class="hs-identifier hs-type">ie_decls</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2005"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2006"></span><span>    </span><span id="local-6989586621683053664"><span class="annot"><span class="annottext">mk_minimal :: GlobalRdrEnv
-&gt; (GenLocated SrcSpanAnnA (ImportDecl GhcRn),
    [GlobalRdrEltX info], t a)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (ImportDecl GhcRn))
</span><a href="#local-6989586621683053664"><span class="hs-identifier hs-var hs-var">mk_minimal</span></a></span></span><span> </span><span id="local-6989586621683053697"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053697"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053698"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053698"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053699"><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053699"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053700"><span class="annot"><span class="annottext">[GlobalRdrEltX info]
</span><a href="#local-6989586621683053700"><span class="hs-identifier hs-var">used_gres</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683053701"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621683053701"><span class="hs-identifier hs-var">unused</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2007"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t a -&gt; Bool
forall a. t a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621683053701"><span class="hs-identifier hs-var">unused</span></a></span><span>
</span><span id="line-2008"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportListInterpretation
</span><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-var">Exactly</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn [LIE GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
-&gt; Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
forall pass.
ImportDecl pass
-&gt; Maybe (ImportListInterpretation, XRec pass [LIE pass])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053699"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-2009"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (ImportDecl GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (ImportDecl GhcRn))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; ImportDecl GhcRn -&gt; GenLocated SrcSpanAnnA (ImportDecl GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053698"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053699"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2010"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2011"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ideclName :: forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053702"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683053702"><span class="hs-identifier hs-var hs-var">mod_name</span></a></span></span><span>
</span><span id="line-2012"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclSource :: forall pass. ImportDecl pass -&gt; IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclSource"><span class="hs-identifier hs-var">ideclSource</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053703"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683053703"><span class="hs-identifier hs-var hs-var">is_boot</span></a></span></span><span>
</span><span id="line-2013"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ideclPkgQual :: forall pass. ImportDecl pass -&gt; ImportDeclPkgQual pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclPkgQual"><span class="hs-identifier hs-var">ideclPkgQual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683053704"><span class="annot"><span class="annottext">ImportDeclPkgQual GhcRn
</span><a href="#local-6989586621683053704"><span class="hs-identifier hs-var hs-var">pkg_qual</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053699"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-2014"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683053705"><span class="annot"><a href="#local-6989586621683053705"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ModuleName -&gt; IsBootInterface -&gt; PkgQual -&gt; RnM ModIface
</span><a href="GHC.Iface.Load.html#loadSrcInterface"><span class="hs-identifier hs-var">loadSrcInterface</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683053706"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683053702"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621683053703"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDeclPkgQual GhcRn
PkgQual
</span><a href="#local-6989586621683053704"><span class="hs-identifier hs-var">pkg_qual</span></a></span><span>
</span><span id="line-2015"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053707"><span class="annot"><a href="#local-6989586621683053707"><span class="hs-identifier hs-var hs-var">used_avails</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrEltX info] -&gt; [AvailInfo]
forall info. [GlobalRdrEltX info] -&gt; [AvailInfo]
</span><a href="GHC.Types.Name.Reader.html#gresToAvailInfo"><span class="hs-identifier hs-var">gresToAvailInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrEltX info]
</span><a href="#local-6989586621683053700"><span class="hs-identifier hs-var">used_gres</span></a></span><span>
</span><span id="line-2016"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683053709"><span class="annot"><a href="#local-6989586621683053709"><span class="hs-identifier hs-var">lies</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053698"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-type">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053710"><span class="hs-identifier hs-type">to_ie</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053697"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053705"><span class="hs-identifier hs-type">iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053707"><span class="hs-identifier hs-type">used_avails</span></a></span><span>
</span><span id="line-2017"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053698"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053699"><span class="hs-identifier hs-type">decl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-type">l2l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053698"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053709"><span class="hs-identifier hs-type">lies</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2018"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2019"></span><span>        </span><span id="local-6989586621683053706"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683053706"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compute minimal imports for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053699"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-2020"></span><span>
</span><span id="line-2021"></span><span>    </span><span class="annot"><a href="#local-6989586621683053710"><span class="hs-identifier hs-type">to_ie</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2022"></span><span>    </span><span class="hs-comment">-- The main trick here is that if we're importing all the constructors</span><span>
</span><span id="line-2023"></span><span>    </span><span class="hs-comment">-- we want to say &quot;T(..)&quot;, but if we're importing only a subset we want</span><span>
</span><span id="line-2024"></span><span>    </span><span class="hs-comment">-- to say &quot;T(A,B,C)&quot;.  So we have to find out what the module exports.</span><span>
</span><span id="line-2025"></span><span>    </span><span id="local-6989586621683053710"><span class="annot"><span class="annottext">to_ie :: GlobalRdrEnv
-&gt; ModIface
-&gt; AvailInfo
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
</span><a href="#local-6989586621683053710"><span class="hs-identifier hs-var hs-var">to_ie</span></a></span></span><span> </span><span id="local-6989586621683053711"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053711"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Avail.html#Avail"><span class="hs-identifier hs-type">Avail</span></a></span><span> </span><span id="local-6989586621683053713"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053713"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Note [Overloaded field import]</span><span>
</span><span id="line-2026"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-2027"></span><span>               </span><span id="local-6989586621683053714"><span class="annot"><span class="annottext">gre :: GlobalRdrElt
</span><a href="#local-6989586621683053714"><span class="hs-identifier hs-var hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe GlobalRdrElt -&gt; GlobalRdrElt
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getMinimalImports Avail&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; GlobalRdrElt)
-&gt; Maybe GlobalRdrElt -&gt; GlobalRdrElt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053711"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053713"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-2028"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn])
-&gt; [IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XIEVar GhcRn
-&gt; LIEWrappedName GhcRn -&gt; Maybe (ExportDoc GhcRn) -&gt; IE GhcRn
forall pass.
XIEVar pass
-&gt; LIEWrappedName pass -&gt; Maybe (ExportDoc pass) -&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEVar"><span class="hs-identifier hs-var">IEVar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
XIEVar GhcRn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn)
-&gt; LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; GenLocated SrcSpanAnnA Name
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; GenLocated SrcSpanAnnA Name)
-&gt; Name -&gt; GenLocated SrcSpanAnnA Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053714"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2029"></span><span>    </span><span class="annot"><a href="#local-6989586621683053710"><span class="hs-identifier hs-var">to_ie</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053717"><span class="annot"><span class="annottext">avail :: AvailInfo
</span><a href="#local-6989586621683053717"><span class="hs-identifier hs-var">avail</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Avail.html#AvailTC"><span class="hs-identifier hs-type">AvailTC</span></a></span><span> </span><span id="local-6989586621683053718"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053718"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Exporting the main decl and nothing else</span><span>
</span><span id="line-2030"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; Bool
</span><a href="GHC.Types.Avail.html#availExportsDecl"><span class="hs-identifier hs-var">availExportsDecl</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053717"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-2031"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XIEThingAbs GhcRn
-&gt; LIEWrappedName GhcRn -&gt; Maybe (ExportDoc GhcRn) -&gt; IE GhcRn
forall pass.
XIEThingAbs pass
-&gt; LIEWrappedName pass -&gt; Maybe (ExportDoc pass) -&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAbs"><span class="hs-identifier hs-var">IEThingAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
XIEThingAbs GhcRn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn)
-&gt; LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; LocatedA (IdP GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053718"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span>
</span><span id="line-2032"></span><span>    </span><span class="annot"><a href="#local-6989586621683053710"><span class="hs-identifier hs-var">to_ie</span></a></span><span> </span><span id="local-6989586621683053720"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053720"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621683053721"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053721"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Avail.html#AvailTC"><span class="hs-identifier hs-type">AvailTC</span></a></span><span> </span><span id="local-6989586621683053722"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053722"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683053723"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053723"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2033"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053724"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683053725"><span class="annot"><span class="annottext">avail :: AvailInfo
</span><a href="#local-6989586621683053725"><span class="hs-identifier hs-var">avail</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Avail.html#AvailTC"><span class="hs-identifier hs-type">AvailTC</span></a></span><span> </span><span id="local-6989586621683053726"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053726"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683053724"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053724"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; [AvailInfo]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [AvailInfo]
</span><a href="GHC.Unit.Module.ModIface.html#mi_exports"><span class="hs-identifier hs-var">mi_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053721"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-2034"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053726"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053722"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2035"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; Bool
</span><a href="GHC.Types.Avail.html#availExportsDecl"><span class="hs-identifier hs-var">availExportsDecl</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053725"><span class="hs-identifier hs-var">avail</span></a></span><span>  </span><span class="hs-comment">-- Note [Partial export]</span><span>
</span><span id="line-2036"></span><span>           </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2037"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621683053727"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053727"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-2038"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Bool
</span><a href="#local-6989586621683053728"><span class="hs-identifier hs-var">all_used</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053727"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2039"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XIEThingAll GhcRn
-&gt; LIEWrappedName GhcRn -&gt; Maybe (ExportDoc GhcRn) -&gt; IE GhcRn
forall pass.
XIEThingAll pass
-&gt; LIEWrappedName pass -&gt; Maybe (ExportDoc pass) -&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingAll"><span class="hs-identifier hs-var">IEThingAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EpToken &quot;(&quot;, EpToken &quot;..&quot;, EpToken &quot;)&quot;)
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn)
-&gt; LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; LocatedA (IdP GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053722"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span>
</span><span id="line-2040"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2041"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053729"><span class="annot"><span class="annottext">ns_gres :: [GlobalRdrElt]
</span><a href="#local-6989586621683053729"><span class="hs-identifier hs-var hs-var">ns_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; GlobalRdrElt) -&gt; [Name] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe GlobalRdrElt -&gt; GlobalRdrElt
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getMinimalImports AvailTC&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; GlobalRdrElt)
-&gt; (Name -&gt; Maybe GlobalRdrElt) -&gt; Name -&gt; GlobalRdrElt
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053720"><span class="hs-identifier hs-var">rdr_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053723"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-2042"></span><span>                      </span><span id="local-6989586621683053730"><span class="annot"><span class="annottext">ns :: [Name]
</span><a href="#local-6989586621683053730"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053729"><span class="hs-identifier hs-var">ns_gres</span></a></span><span>
</span><span id="line-2043"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XIEThingWith GhcRn
-&gt; LIEWrappedName GhcRn
-&gt; IEWildcard
-&gt; [LIEWrappedName GhcRn]
-&gt; Maybe (ExportDoc GhcRn)
-&gt; IE GhcRn
forall pass.
XIEThingWith pass
-&gt; LIEWrappedName pass
-&gt; IEWildcard
-&gt; [LIEWrappedName pass]
-&gt; Maybe (ExportDoc pass)
-&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingWith"><span class="hs-identifier hs-var">IEThingWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IEThingWithAnns
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn)
-&gt; LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; LocatedA (IdP GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053722"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IEWildcard
</span><a href="Language.Haskell.Syntax.ImpExp.html#NoIEWildcard"><span class="hs-identifier hs-var">NoIEWildcard</span></a></span><span>
</span><span id="line-2044"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn))
-&gt; [Name] -&gt; [GenLocated SrcSpanAnnA (IEWrappedName GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
GenLocated SrcSpanAnnA Name
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA Name
 -&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn))
-&gt; (Name -&gt; GenLocated SrcSpanAnnA Name)
-&gt; Name
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; GenLocated SrcSpanAnnA Name
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053722"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053730"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2045"></span><span>                                       </span><span class="hs-comment">-- Note [Overloaded field import]</span><span>
</span><span id="line-2046"></span><span>        </span><span id="local-6989586621683053732"><span class="annot"><span class="annottext">[[Name]]
</span><a href="#local-6989586621683053732"><span class="hs-identifier hs-var">_other</span></a></span></span><span>
</span><span id="line-2047"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053733"><span class="annot"><span class="annottext">infos :: [GlobalRdrElt]
</span><a href="#local-6989586621683053733"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; GlobalRdrElt) -&gt; [Name] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe GlobalRdrElt -&gt; GlobalRdrElt
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getMinimalImports AvailTC&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; GlobalRdrElt)
-&gt; (Name -&gt; Maybe GlobalRdrElt) -&gt; Name -&gt; GlobalRdrElt
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053720"><span class="hs-identifier hs-var">rdr_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053723"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-2048"></span><span>                      </span><span class="hs-special">(</span><span id="local-6989586621683053734"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053734"><span class="hs-identifier hs-var">ns_gres</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683053735"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053735"><span class="hs-identifier hs-var">fs_gres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; ([GlobalRdrElt], [GlobalRdrElt])
</span><a href="GHC.Rename.Names.html#classifyGREs"><span class="hs-identifier hs-var">classifyGREs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053733"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-2049"></span><span>                      </span><span id="local-6989586621683053736"><span class="annot"><span class="annottext">ns :: [Name]
</span><a href="#local-6989586621683053736"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053734"><span class="hs-identifier hs-var">ns_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053735"><span class="hs-identifier hs-var">fs_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2050"></span><span>                      </span><span id="local-6989586621683053737"><span class="annot"><span class="annottext">fs :: [RecFieldInfo]
</span><a href="#local-6989586621683053737"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; RecFieldInfo) -&gt; [GlobalRdrElt] -&gt; [RecFieldInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; GlobalRdrElt -&gt; RecFieldInfo
GlobalRdrElt -&gt; RecFieldInfo
</span><a href="GHC.Types.Name.Reader.html#fieldGREInfo"><span class="hs-identifier hs-var">fieldGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683053735"><span class="hs-identifier hs-var">fs_gres</span></a></span><span>
</span><span id="line-2051"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn])
-&gt; [IE GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [IE GhcRn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2052"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[RecFieldInfo] -&gt; Bool
</span><a href="#local-6989586621683053739"><span class="hs-identifier hs-var">all_non_overloaded</span></a></span><span> </span><span class="annot"><span class="annottext">[RecFieldInfo]
</span><a href="#local-6989586621683053737"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-2053"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IE GhcRn) -&gt; [Name] -&gt; [IE GhcRn]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683053740"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053740"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">XIEVar GhcRn
-&gt; LIEWrappedName GhcRn -&gt; Maybe (ExportDoc GhcRn) -&gt; IE GhcRn
forall pass.
XIEVar pass
-&gt; LIEWrappedName pass -&gt; Maybe (ExportDoc pass) -&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEVar"><span class="hs-identifier hs-var">IEVar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
XIEVar GhcRn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn_var"><span class="hs-identifier hs-var">to_ie_post_rn_var</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn)
-&gt; LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; LocatedA (IdP GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053740"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053736"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2054"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XIEThingWith GhcRn
-&gt; LIEWrappedName GhcRn
-&gt; IEWildcard
-&gt; [LIEWrappedName GhcRn]
-&gt; Maybe (ExportDoc GhcRn)
-&gt; IE GhcRn
forall pass.
XIEThingWith pass
-&gt; LIEWrappedName pass
-&gt; IEWildcard
-&gt; [LIEWrappedName pass]
-&gt; Maybe (ExportDoc pass)
-&gt; IE pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEThingWith"><span class="hs-identifier hs-var">IEThingWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnP (WarningTxt GhcRn))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IEThingWithAnns
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn)
-&gt; LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; LocatedA (IdP GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053722"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IEWildcard
</span><a href="Language.Haskell.Syntax.ImpExp.html#NoIEWildcard"><span class="hs-identifier hs-var">NoIEWildcard</span></a></span><span>
</span><span id="line-2055"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn))
-&gt; [Name] -&gt; [GenLocated SrcSpanAnnA (IEWrappedName GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
GenLocated SrcSpanAnnA Name
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var">to_ie_post_rn</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA Name
 -&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn))
-&gt; (Name -&gt; GenLocated SrcSpanAnnA Name)
-&gt; Name
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; GenLocated SrcSpanAnnA Name
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053722"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053736"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2056"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-2057"></span><span>
</span><span id="line-2058"></span><span>          </span><span id="local-6989586621683053728"><span class="annot"><span class="annottext">all_used :: [Name] -&gt; Bool
</span><a href="#local-6989586621683053728"><span class="hs-identifier hs-var hs-var">all_used</span></a></span></span><span> </span><span id="local-6989586621683053742"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053742"><span class="hs-identifier hs-var">avail_cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053723"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053742"><span class="hs-identifier hs-var">avail_cs</span></a></span><span>
</span><span id="line-2059"></span><span>
</span><span id="line-2060"></span><span>          </span><span id="local-6989586621683053739"><span class="annot"><span class="annottext">all_non_overloaded :: [RecFieldInfo] -&gt; Bool
</span><a href="#local-6989586621683053739"><span class="hs-identifier hs-var hs-var">all_non_overloaded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RecFieldInfo -&gt; Bool) -&gt; [RecFieldInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (RecFieldInfo -&gt; Bool) -&gt; RecFieldInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Bool
</span><a href="GHC.Types.FieldLabel.html#flIsOverloaded"><span class="hs-identifier hs-var">flIsOverloaded</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Bool)
-&gt; (RecFieldInfo -&gt; FieldLabel) -&gt; RecFieldInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RecFieldInfo -&gt; FieldLabel
</span><a href="GHC.Types.GREInfo.html#recFieldLabel"><span class="hs-identifier hs-var">recFieldLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2061"></span><span>
</span><span id="line-2062"></span><span>    </span><span class="annot"><a href="#local-6989586621683053663"><span class="hs-identifier hs-type">combine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2063"></span><span>    </span><span id="local-6989586621683053663"><span class="annot"><span class="annottext">combine :: [LImportDecl GhcRn] -&gt; [LImportDecl GhcRn]
</span><a href="#local-6989586621683053663"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))
 -&gt; GenLocated SrcSpanAnnA (ImportDecl GhcRn))
-&gt; [NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))]
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LImportDecl GhcRn) -&gt; LImportDecl GhcRn
NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))
-&gt; GenLocated SrcSpanAnnA (ImportDecl GhcRn)
</span><a href="#local-6989586621683053745"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">([NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))]
 -&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)])
-&gt; ([GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
    -&gt; [NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))])
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (ImportDecl GhcRn)
 -&gt; (Bool, Maybe ModuleName, ModuleName))
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
-&gt; [NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [NonEmpty a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#groupAllWith"><span class="hs-identifier hs-var">NE.groupAllWith</span></a></span><span> </span><span class="annot"><span class="annottext">LImportDecl GhcRn -&gt; (Bool, Maybe ModuleName, ModuleName)
GenLocated SrcSpanAnnA (ImportDecl GhcRn)
-&gt; (Bool, Maybe ModuleName, ModuleName)
</span><a href="#local-6989586621683053747"><span class="hs-identifier hs-var">getKey</span></a></span><span>
</span><span id="line-2064"></span><span>
</span><span id="line-2065"></span><span>    </span><span class="annot"><a href="#local-6989586621683053747"><span class="hs-identifier hs-type">getKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2066"></span><span>    </span><span id="local-6989586621683053747"><span class="annot"><span class="annottext">getKey :: LImportDecl GhcRn -&gt; (Bool, Maybe ModuleName, ModuleName)
</span><a href="#local-6989586621683053747"><span class="hs-identifier hs-var hs-var">getKey</span></a></span></span><span> </span><span id="local-6989586621683053748"><span class="annot"><span class="annottext">LImportDecl GhcRn
</span><a href="#local-6989586621683053748"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2067"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ImportDeclQualifiedStyle -&gt; Bool
</span><a href="GHC.Hs.ImpExp.html#isImportDeclQualified"><span class="hs-identifier hs-var">isImportDeclQualified</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportDeclQualifiedStyle -&gt; Bool)
-&gt; (ImportDecl GhcRn -&gt; ImportDeclQualifiedStyle)
-&gt; ImportDecl GhcRn
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; ImportDeclQualifiedStyle
forall pass. ImportDecl pass -&gt; ImportDeclQualifiedStyle
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclQualified"><span class="hs-identifier hs-var">ideclQualified</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportDecl GhcRn -&gt; Bool) -&gt; ImportDecl GhcRn -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053749"><span class="hs-identifier hs-var">idecl</span></a></span><span> </span><span class="hs-comment">-- is this qualified? (important that this be first)</span><span>
</span><span id="line-2068"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName)
-&gt; Maybe (GenLocated SrcSpanAnnA ModuleName) -&gt; Maybe ModuleName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; Maybe (XRec GhcRn ModuleName)
forall pass. ImportDecl pass -&gt; Maybe (XRec pass ModuleName)
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclAs"><span class="hs-identifier hs-var">ideclAs</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053749"><span class="hs-identifier hs-var">idecl</span></a></span><span> </span><span class="hs-comment">-- what is the qualifier (inside Maybe monad)</span><span>
</span><span id="line-2069"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName)
-&gt; (ImportDecl GhcRn -&gt; GenLocated SrcSpanAnnA ModuleName)
-&gt; ImportDecl GhcRn
-&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn -&gt; XRec GhcRn ModuleName
ImportDecl GhcRn -&gt; GenLocated SrcSpanAnnA ModuleName
forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportDecl GhcRn -&gt; ModuleName) -&gt; ImportDecl GhcRn -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053749"><span class="hs-identifier hs-var">idecl</span></a></span><span> </span><span class="hs-comment">-- Module Name</span><span>
</span><span id="line-2070"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-2071"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2072"></span><span>        </span><span class="annot"><a href="#local-6989586621683053749"><span class="hs-identifier hs-type">idecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2073"></span><span>        </span><span id="local-6989586621683053749"><span class="annot"><span class="annottext">idecl :: ImportDecl GhcRn
</span><a href="#local-6989586621683053749"><span class="hs-identifier hs-var hs-var">idecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; ImportDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LImportDecl GhcRn
GenLocated SrcSpanAnnA (ImportDecl GhcRn)
</span><a href="#local-6989586621683053748"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-2074"></span><span>
</span><span id="line-2075"></span><span>    </span><span class="annot"><a href="#local-6989586621683053745"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2076"></span><span>    </span><span id="local-6989586621683053745"><span class="annot"><span class="annottext">merge :: NonEmpty (LImportDecl GhcRn) -&gt; LImportDecl GhcRn
</span><a href="#local-6989586621683053745"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621683053750"><span class="annot"><span class="annottext">decls :: NonEmpty (LImportDecl GhcRn)
</span><a href="#local-6989586621683053750"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053751"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053751"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053752"><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053752"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; ImportDecl GhcRn -&gt; GenLocated SrcSpanAnnA (ImportDecl GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053751"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcRn
</span><a href="#local-6989586621683053752"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-type">noAnnSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053751"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053754"><span class="hs-identifier hs-type">lies</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2077"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683053754"><span class="annot"><span class="annottext">lies :: [LIE GhcRn]
</span><a href="#local-6989586621683053754"><span class="hs-identifier hs-var hs-var">lies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ImportListInterpretation, LocatedLI [LIE GhcRn]) -&gt; [LIE GhcRn])
-&gt; [(ImportListInterpretation, LocatedLI [LIE GhcRn])]
-&gt; [LIE GhcRn]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedLI [LIE GhcRn] -&gt; [LIE GhcRn]
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedLI [LIE GhcRn] -&gt; [LIE GhcRn])
-&gt; ((ImportListInterpretation, LocatedLI [LIE GhcRn])
    -&gt; LocatedLI [LIE GhcRn])
-&gt; (ImportListInterpretation, LocatedLI [LIE GhcRn])
-&gt; [LIE GhcRn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ImportListInterpretation, LocatedLI [LIE GhcRn])
-&gt; LocatedLI [LIE GhcRn]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ImportListInterpretation, LocatedLI [LIE GhcRn])]
 -&gt; [LIE GhcRn])
-&gt; [(ImportListInterpretation, LocatedLI [LIE GhcRn])]
-&gt; [LIE GhcRn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (ImportDecl GhcRn)
 -&gt; Maybe (ImportListInterpretation, LocatedLI [LIE GhcRn]))
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
-&gt; [(ImportListInterpretation, LocatedLI [LIE GhcRn])]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcRn
-&gt; Maybe (ImportListInterpretation, XRec GhcRn [LIE GhcRn])
ImportDecl GhcRn
-&gt; Maybe (ImportListInterpretation, LocatedLI [LIE GhcRn])
forall pass.
ImportDecl pass
-&gt; Maybe (ImportListInterpretation, XRec pass [LIE pass])
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportDecl GhcRn
 -&gt; Maybe (ImportListInterpretation, LocatedLI [LIE GhcRn]))
-&gt; (GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; ImportDecl GhcRn)
-&gt; GenLocated SrcSpanAnnA (ImportDecl GhcRn)
-&gt; Maybe (ImportListInterpretation, LocatedLI [LIE GhcRn])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; ImportDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
 -&gt; [(ImportListInterpretation, LocatedLI [LIE GhcRn])])
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
-&gt; [(ImportListInterpretation, LocatedLI [LIE GhcRn])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LImportDecl GhcRn)
NonEmpty (GenLocated SrcSpanAnnA (ImportDecl GhcRn))
</span><a href="#local-6989586621683053750"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span class="annot"><a href="GHC.Rename.Names.html#classifyGREs"><span class="hs-identifier hs-type">classifyGREs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#FieldGlobalRdrElt"><span class="hs-identifier hs-type">FieldGlobalRdrElt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2080"></span><span id="classifyGREs"><span class="annot"><span class="annottext">classifyGREs :: [GlobalRdrElt] -&gt; ([GlobalRdrElt], [GlobalRdrElt])
</span><a href="GHC.Rename.Names.html#classifyGREs"><span class="hs-identifier hs-var hs-var">classifyGREs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool)
-&gt; [GlobalRdrElt] -&gt; ([GlobalRdrElt], [GlobalRdrElt])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (GlobalRdrElt -&gt; Bool) -&gt; GlobalRdrElt -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>
</span><span id="line-2082"></span><span class="annot"><a href="GHC.Rename.Names.html#printMinimalImports"><span class="hs-identifier hs-type">printMinimalImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Names.html#ImportDeclUsage"><span class="hs-identifier hs-type">ImportDeclUsage</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2083"></span><span class="hs-comment">-- See Note [Printing minimal imports]</span><span>
</span><span id="line-2084"></span><span id="printMinimalImports"><span class="annot"><span class="annottext">printMinimalImports :: HscSource -&gt; [ImportDeclUsage] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#printMinimalImports"><span class="hs-identifier hs-var hs-var">printMinimalImports</span></a></span></span><span> </span><span id="local-6989586621683053756"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683053756"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span> </span><span id="local-6989586621683053757"><span class="annot"><span class="annottext">[ImportDeclUsage]
</span><a href="#local-6989586621683053757"><span class="hs-identifier hs-var">imports_w_usage</span></a></span></span><span>
</span><span id="line-2085"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683053758"><span class="annot"><a href="#local-6989586621683053758"><span class="hs-identifier hs-var">imports'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ImportDeclUsage] -&gt; RnM [LImportDecl GhcRn]
</span><a href="GHC.Rename.Names.html#getMinimalImports"><span class="hs-identifier hs-var">getMinimalImports</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportDeclUsage]
</span><a href="#local-6989586621683053757"><span class="hs-identifier hs-var">imports_w_usage</span></a></span><span>
</span><span id="line-2086"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683053759"><span class="annot"><a href="#local-6989586621683053759"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span>
</span><span id="line-2087"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683053761"><span class="annot"><a href="#local-6989586621683053761"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-2088"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">withFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053764"><span class="hs-identifier hs-type">mkFilename</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053761"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053759"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteMode</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683053766"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621683053766"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2089"></span><span>          </span><span class="annot"><span class="annottext">DynFlags -&gt; Handle -&gt; NamePprCtx -&gt; Depth -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Driver.Ppr.html#printForUser"><span class="hs-identifier hs-var">printForUser</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683053761"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621683053766"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="GHC.Utils.Outputable.html#neverQualify"><span class="hs-identifier hs-var">neverQualify</span></a></span><span> </span><span class="annot"><span class="annottext">Depth
</span><a href="GHC.Utils.Outputable.html#AllTheWay"><span class="hs-identifier hs-var">AllTheWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; SDoc)
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcRn)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (ImportDecl GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (ImportDecl GhcRn)]
</span><a href="#local-6989586621683053758"><span class="hs-identifier hs-var">imports'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2090"></span><span>              </span><span class="hs-comment">-- The neverQualify is important.  We are printing Names</span><span>
</span><span id="line-2091"></span><span>              </span><span class="hs-comment">-- but they are in the context of an 'import' decl, and</span><span>
</span><span id="line-2092"></span><span>              </span><span class="hs-comment">-- we never qualify things inside there</span><span>
</span><span id="line-2093"></span><span>              </span><span class="hs-comment">-- E.g.   import Blag( f, b )</span><span>
</span><span id="line-2094"></span><span>              </span><span class="hs-comment">-- not    import Blag( Blag.f, Blag.g )!</span><span>
</span><span id="line-2095"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-2096"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2097"></span><span>    </span><span id="local-6989586621683053764"><span class="annot"><span class="annottext">mkFilename :: DynFlags -&gt; Module -&gt; String
</span><a href="#local-6989586621683053764"><span class="hs-identifier hs-var hs-var">mkFilename</span></a></span></span><span> </span><span id="local-6989586621683053770"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683053770"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683053771"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683053771"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span>
</span><span id="line-2098"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053772"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683053772"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.DynFlags.html#dumpDir"><span class="hs-identifier hs-var">dumpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683053770"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683053772"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683053774"><span class="hs-identifier hs-var">basefn</span></a></span><span>
</span><span id="line-2099"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683053774"><span class="hs-identifier hs-var">basefn</span></a></span><span>
</span><span id="line-2100"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2101"></span><span>        </span><span id="local-6989586621683053775"><span class="annot"><span class="annottext">suffix :: String
</span><a href="#local-6989586621683053775"><span class="hs-identifier hs-var hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683053756"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2102"></span><span>                     </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.imports-boot&quot;</span></span><span>
</span><span id="line-2103"></span><span>                     </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.imports&quot;</span></span><span>
</span><span id="line-2104"></span><span>                     </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.imports&quot;</span></span><span>
</span><span id="line-2105"></span><span>        </span><span id="local-6989586621683053774"><span class="annot"><span class="annottext">basefn :: String
</span><a href="#local-6989586621683053774"><span class="hs-identifier hs-var hs-var">basefn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683053771"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683053775"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-2106"></span><span>
</span><span id="line-2107"></span><span>
</span><span id="line-2108"></span><span class="annot"><a href="GHC.Rename.Names.html#to_ie_post_rn_var"><span class="hs-identifier hs-type">to_ie_post_rn_var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#IdP"><span class="hs-identifier hs-type">IdP</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIEWrappedName"><span class="hs-identifier hs-type">LIEWrappedName</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2109"></span><span id="to_ie_post_rn_var"><span class="annot"><span class="annottext">to_ie_post_rn_var :: LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn_var"><span class="hs-identifier hs-var hs-var">to_ie_post_rn_var</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053779"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053779"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053780"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621683053780"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2110"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isDataOcc"><span class="hs-identifier hs-var">isDataOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; Bool) -&gt; OccName -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053780"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IEWrappedName GhcRn
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053779"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEPattern GhcRn -&gt; LIdP GhcRn -&gt; IEWrappedName GhcRn
forall p. XIEPattern p -&gt; LIdP p -&gt; IEWrappedName p
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEPattern"><span class="hs-identifier hs-var">IEPattern</span></a></span><span> </span><span class="annot"><span class="annottext">XIEPattern GhcRn
EpToken &quot;pattern&quot;
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpanAnnN
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053779"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053780"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2111"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IEWrappedName GhcRn
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053779"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEName GhcRn -&gt; LIdP GhcRn -&gt; IEWrappedName GhcRn
forall p. XIEName p -&gt; LIdP p -&gt; IEWrappedName p
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEName"><span class="hs-identifier hs-var">IEName</span></a></span><span>    </span><span class="annot"><span class="annottext">XIEName GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpanAnnN
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053779"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053780"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2112"></span><span>
</span><span id="line-2113"></span><span>
</span><span id="line-2114"></span><span class="annot"><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-type">to_ie_post_rn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#IdP"><span class="hs-identifier hs-type">IdP</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIEWrappedName"><span class="hs-identifier hs-type">LIEWrappedName</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2115"></span><span id="to_ie_post_rn"><span class="annot"><span class="annottext">to_ie_post_rn :: LocatedA (IdP GhcRn) -&gt; LIEWrappedName GhcRn
</span><a href="GHC.Rename.Names.html#to_ie_post_rn"><span class="hs-identifier hs-var hs-var">to_ie_post_rn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683053785"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053785"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683053786"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621683053786"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2116"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isTcOcc"><span class="hs-identifier hs-var">isTcOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053788"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isSymOcc"><span class="hs-identifier hs-var">isSymOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683053788"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IEWrappedName GhcRn
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053785"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEType GhcRn -&gt; LIdP GhcRn -&gt; IEWrappedName GhcRn
forall p. XIEType p -&gt; LIdP p -&gt; IEWrappedName p
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEType"><span class="hs-identifier hs-var">IEType</span></a></span><span> </span><span class="annot"><span class="annottext">XIEType GhcRn
EpToken &quot;type&quot;
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpanAnnN
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053785"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053786"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IEWrappedName GhcRn
-&gt; GenLocated SrcSpanAnnA (IEWrappedName GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053785"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIEName GhcRn -&gt; LIdP GhcRn -&gt; IEWrappedName GhcRn
forall p. XIEName p -&gt; LIdP p -&gt; IEWrappedName p
</span><a href="Language.Haskell.Syntax.ImpExp.html#IEName"><span class="hs-identifier hs-var">IEName</span></a></span><span> </span><span class="annot"><span class="annottext">XIEName GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpanAnnN
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683053785"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053786"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2118"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683053788"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683053788"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683053786"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2119"></span><span>
</span><span id="line-2120"></span><span class="hs-comment">{-
Note [Partial export]
~~~~~~~~~~~~~~~~~~~~~
Suppose we have

   module A( op ) where
     class C a where
       op :: a -&gt; a

   module B where
   import A
   f = ..op...

Then the minimal import for module B is
   import A( op )
not
   import A( C( op ) )
which we would usually generate if C was exported from B.  Hence
the availExportsDecl test when deciding what to generate.


Note [Overloaded field import]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
On the other hand, if we have

    {-# LANGUAGE DuplicateRecordFields #-}
    module A where
      data T = MkT { foo :: Int }

    module B where
      import A
      f = ...foo...

then the minimal import for module B must be
    import A ( T(foo) )
because when DuplicateRecordFields is enabled, field selectors are
not in scope without their enclosing datatype.

On the third hand, if we have

    {-# LANGUAGE DuplicateRecordFields #-}
    module A where
      pattern MkT { foo } = Just foo

    module B where
      import A
      f = ...foo...

then the minimal import for module B must be
    import A ( foo )
because foo doesn't have a parent.  This might actually be ambiguous if A
exports another field called foo, but there is no good answer to return and this
is a very obscure corner, so it seems to be the best we can do.  See
DRFPatSynExport for a test of this.


************************************************************************
*                                                                      *
\subsection{Errors}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2182"></span><span>
</span><span id="line-2183"></span><span class="annot"><a href="GHC.Rename.Names.html#badImportItemErr"><span class="hs-identifier hs-type">badImportItemErr</span></a></span><span>
</span><span id="line-2184"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#IsSubordinate"><span class="hs-identifier hs-type">IsSubordinate</span></a></span><span>
</span><span id="line-2185"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2186"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ImportLookupReason"><span class="hs-identifier hs-type">ImportLookupReason</span></a></span><span>
</span><span id="line-2187"></span><span id="badImportItemErr"><span class="annot"><span class="annottext">badImportItemErr :: ModIface
-&gt; ImpDeclSpec
-&gt; IE (GhcPass 'Parsed)
-&gt; IsSubordinate
-&gt; [AvailInfo]
-&gt; TcRn ImportLookupReason
</span><a href="GHC.Rename.Names.html#badImportItemErr"><span class="hs-identifier hs-var hs-var">badImportItemErr</span></a></span></span><span> </span><span id="local-6989586621683053791"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053791"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621683053792"><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053792"><span class="hs-identifier hs-var">decl_spec</span></a></span></span><span> </span><span id="local-6989586621683053793"><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053793"><span class="hs-identifier hs-var">ie</span></a></span></span><span> </span><span id="local-6989586621683053794"><span class="annot"><span class="annottext">IsSubordinate
</span><a href="#local-6989586621683053794"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621683053795"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053795"><span class="hs-identifier hs-var">avails</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2188"></span><span>  </span><span id="local-6989586621683053796"><span class="annot"><a href="#local-6989586621683053796"><span class="hs-identifier hs-var">patsyns_enabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.PatternSynonyms</span></span><span>
</span><span id="line-2189"></span><span>  </span><span id="local-6989586621683053798"><span class="annot"><a href="#local-6989586621683053798"><span class="hs-identifier hs-var">expl_ns_enabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.ExplicitNamespaces</span></span><span>
</span><span id="line-2190"></span><span>  </span><span id="local-6989586621683053800"><span class="annot"><a href="#local-6989586621683053800"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-2191"></span><span>  </span><span id="local-6989586621683053801"><span class="annot"><a href="#local-6989586621683053801"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-2192"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683053802"><span class="annot"><a href="#local-6989586621683053802"><span class="hs-identifier hs-var hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a></span><span>
</span><span id="line-2193"></span><span>              </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; GlobalRdrEnv) -&gt; [GlobalRdrElt] -&gt; GlobalRdrEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe ImportSpec -&gt; [AvailInfo] -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromAvails"><span class="hs-identifier hs-var">gresFromAvails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683053801"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportSpec -&gt; Maybe ImportSpec
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683053803"><span class="hs-identifier hs-var">imp_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053804"><span class="hs-identifier hs-var">all_avails</span></a></span><span>
</span><span id="line-2194"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ImportLookupBad"><span class="hs-identifier hs-type">ImportLookupBad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683053806"><span class="hs-identifier hs-type">importErrorKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053800"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053802"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053798"><span class="hs-identifier hs-type">expl_ns_enabled</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683053791"><span class="hs-identifier hs-type">iface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053792"><span class="hs-identifier hs-type">decl_spec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053793"><span class="hs-identifier hs-type">ie</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683053796"><span class="hs-identifier hs-type">patsyns_enabled</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2196"></span><span>    </span><span id="local-6989586621683053806"><span class="annot"><span class="annottext">importErrorKind :: DynFlags -&gt; GlobalRdrEnv -&gt; Bool -&gt; BadImportKind
</span><a href="#local-6989586621683053806"><span class="hs-identifier hs-var hs-var">importErrorKind</span></a></span></span><span> </span><span id="local-6989586621683053807"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683053807"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683053808"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053808"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621683053809"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053809"><span class="hs-identifier hs-var">expl_ns_enabled</span></a></span></span><span>
</span><span id="line-2197"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(AvailInfo -&gt; Bool) -&gt; [AvailInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053810"><span class="hs-identifier hs-var">checkIfTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053795"><span class="hs-identifier hs-var">avails</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="#local-6989586621683053794"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2198"></span><span>          </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="GHC.Rename.Names.html#IsNotSubordinate"><span class="hs-identifier hs-var">IsNotSubordinate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BadImportKind
</span><a href="GHC.Tc.Errors.Types.html#BadImportAvailTyCon"><span class="hs-identifier hs-var">BadImportAvailTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683053809"><span class="hs-identifier hs-var">expl_ns_enabled</span></a></span><span>
</span><span id="line-2199"></span><span>          </span><span class="annot"><span class="annottext">IsSubordinate
</span><a href="GHC.Rename.Names.html#IsSubordinate"><span class="hs-identifier hs-var">IsSubordinate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[OccName] -&gt; BadImportKind
</span><a href="GHC.Tc.Errors.Types.html#BadImportNotExportedSubordinates"><span class="hs-identifier hs-var">BadImportNotExportedSubordinates</span></a></span><span> </span><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621683053813"><span class="hs-identifier hs-var">unavailableChildren</span></a></span><span>
</span><span id="line-2200"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(AvailInfo -&gt; Bool) -&gt; [AvailInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053814"><span class="hs-identifier hs-var">checkIfVarName</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053795"><span class="hs-identifier hs-var">avails</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BadImportKind
</span><a href="GHC.Tc.Errors.Types.html#BadImportAvailVar"><span class="hs-identifier hs-var">BadImportAvailVar</span></a></span><span>
</span><span id="line-2201"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053816"><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053816"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(AvailInfo -&gt; Bool) -&gt; [AvailInfo] -&gt; Maybe AvailInfo
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053817"><span class="hs-identifier hs-var">checkIfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683053795"><span class="hs-identifier hs-var">avails</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; BadImportKind
</span><a href="GHC.Tc.Errors.Types.html#BadImportAvailDataCon"><span class="hs-identifier hs-var">BadImportAvailDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AvailInfo -&gt; OccName
</span><a href="#local-6989586621683053819"><span class="hs-identifier hs-var">availOccName</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683053816"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2202"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; BadImportKind
</span><a href="GHC.Tc.Errors.Types.html#BadImportNotExported"><span class="hs-identifier hs-var">BadImportNotExported</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683053821"><span class="hs-identifier hs-var">suggs</span></a></span><span>
</span><span id="line-2203"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-2204"></span><span>          </span><span id="local-6989586621683053821"><span class="annot"><span class="annottext">suggs :: [GhcHint]
</span><a href="#local-6989586621683053821"><span class="hs-identifier hs-var hs-var">suggs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683053822"><span class="hs-identifier hs-var">similar_suggs</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; [GhcHint] -&gt; [GhcHint]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; RdrName -&gt; [GhcHint]
</span><a href="GHC.Rename.Unbound.html#fieldSelectorSuggestions"><span class="hs-identifier hs-var">fieldSelectorSuggestions</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053808"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Parsed)
RdrName
</span><a href="#local-6989586621683053824"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-2205"></span><span>          </span><span id="local-6989586621683053825"><span class="annot"><span class="annottext">similar_names :: [SimilarName]
</span><a href="#local-6989586621683053825"><span class="hs-identifier hs-var hs-var">similar_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2206"></span><span>            </span><span class="annot"><span class="annottext">LookingFor
-&gt; DynFlags
-&gt; GlobalRdrEnv
-&gt; LocalRdrEnv
-&gt; RdrName
-&gt; [SimilarName]
</span><a href="GHC.Rename.Unbound.html#similarNameSuggestions"><span class="hs-identifier hs-var">similarNameSuggestions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">Unbound.LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_Global"><span class="hs-identifier hs-var">WL_Global</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2207"></span><span>              </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683053807"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683053808"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#emptyLocalRdrEnv"><span class="hs-identifier hs-var">emptyLocalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Parsed)
RdrName
</span><a href="#local-6989586621683053824"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-2208"></span><span>          </span><span id="local-6989586621683053822"><span class="annot"><span class="annottext">similar_suggs :: [GhcHint]
</span><a href="#local-6989586621683053822"><span class="hs-identifier hs-var hs-var">similar_suggs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2209"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[SimilarName] -&gt; Maybe (NonEmpty SimilarName)
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">NE.nonEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">([SimilarName] -&gt; Maybe (NonEmpty SimilarName))
-&gt; [SimilarName] -&gt; Maybe (NonEmpty SimilarName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SimilarName -&gt; Maybe SimilarName)
-&gt; [SimilarName] -&gt; [SimilarName]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">SimilarName -&gt; Maybe SimilarName
</span><a href="#local-6989586621683053832"><span class="hs-identifier hs-var">imported_item</span></a></span><span> </span><span class="annot"><span class="annottext">([SimilarName] -&gt; [SimilarName]) -&gt; [SimilarName] -&gt; [SimilarName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SimilarName]
</span><a href="#local-6989586621683053825"><span class="hs-identifier hs-var">similar_names</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2210"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053833"><span class="annot"><span class="annottext">NonEmpty SimilarName
</span><a href="#local-6989586621683053833"><span class="hs-identifier hs-var">similar</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; NonEmpty SimilarName -&gt; GhcHint
</span><a href="GHC.Types.Hint.html#SuggestSimilarNames"><span class="hs-identifier hs-var">SuggestSimilarNames</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Parsed)
RdrName
</span><a href="#local-6989586621683053824"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty SimilarName
</span><a href="#local-6989586621683053833"><span class="hs-identifier hs-var">similar</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2211"></span><span>              </span><span class="annot"><span class="annottext">Maybe (NonEmpty SimilarName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2212"></span><span>
</span><span id="line-2213"></span><span>          </span><span class="hs-comment">-- Only keep imported items, and set the &quot;HowInScope&quot; to</span><span>
</span><span id="line-2214"></span><span>          </span><span class="hs-comment">-- &quot;Nothing&quot; to avoid printing &quot;imported from...&quot; in the suggestion</span><span>
</span><span id="line-2215"></span><span>          </span><span class="hs-comment">-- error message.</span><span>
</span><span id="line-2216"></span><span>          </span><span id="local-6989586621683053832"><span class="annot"><span class="annottext">imported_item :: SimilarName -&gt; Maybe SimilarName
</span><a href="#local-6989586621683053832"><span class="hs-identifier hs-var hs-var">imported_item</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Hint.html#SimilarRdrName"><span class="hs-identifier hs-type">SimilarRdrName</span></a></span><span> </span><span id="local-6989586621683053836"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053836"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Hint.html#ImportedBy"><span class="hs-identifier hs-type">ImportedBy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2217"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimilarName -&gt; Maybe SimilarName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; Maybe HowInScope -&gt; SimilarName
</span><a href="GHC.Types.Hint.html#SimilarRdrName"><span class="hs-identifier hs-var">SimilarRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053836"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HowInScope
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-2218"></span><span>          </span><span class="annot"><a href="#local-6989586621683053832"><span class="hs-identifier hs-var">imported_item</span></a></span><span> </span><span class="annot"><span class="annottext">SimilarName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SimilarName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2219"></span><span>
</span><span id="line-2220"></span><span>    </span><span id="local-6989586621683053817"><span class="annot"><span class="annottext">checkIfDataCon :: AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053817"><span class="hs-identifier hs-var hs-var">checkIfDataCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053838"><span class="hs-identifier hs-var">checkIfAvailMatches</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isDataConName"><span class="hs-identifier hs-var">isDataConName</span></a></span><span>
</span><span id="line-2221"></span><span>    </span><span id="local-6989586621683053810"><span class="annot"><span class="annottext">checkIfTyCon :: AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053810"><span class="hs-identifier hs-var hs-var">checkIfTyCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053838"><span class="hs-identifier hs-var">checkIfAvailMatches</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isTyConName"><span class="hs-identifier hs-var">isTyConName</span></a></span><span>
</span><span id="line-2222"></span><span>    </span><span id="local-6989586621683053814"><span class="annot"><span class="annottext">checkIfVarName :: AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053814"><span class="hs-identifier hs-var hs-var">checkIfVarName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2223"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2224"></span><span>        </span><span class="annot"><a href="GHC.Types.Avail.html#AvailTC"><span class="hs-identifier hs-type">AvailTC</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2225"></span><span>        </span><span class="annot"><a href="GHC.Types.Avail.html#Avail"><span class="hs-identifier hs-type">Avail</span></a></span><span> </span><span id="local-6989586621683053841"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053841"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683053842"><span class="hs-identifier hs-var">importedFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053841"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2226"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isVarOcc"><span class="hs-identifier hs-var">isVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; Bool) -&gt; (OccName -&gt; Bool) -&gt; OccName -&gt; Bool
forall (f :: * -&gt; *). Applicative f =&gt; f Bool -&gt; f Bool -&gt; f Bool
</span><a href="GHC.Utils.Misc.html#%3C%7C%7C%3E"><span class="hs-operator hs-var">&lt;||&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isFieldOcc"><span class="hs-identifier hs-var">isFieldOcc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053841"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span>    </span><span id="local-6989586621683053838"><span class="annot"><span class="annottext">checkIfAvailMatches :: (Name -&gt; Bool) -&gt; AvailInfo -&gt; Bool
</span><a href="#local-6989586621683053838"><span class="hs-identifier hs-var hs-var">checkIfAvailMatches</span></a></span></span><span> </span><span id="local-6989586621683053846"><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683053846"><span class="hs-identifier hs-var">namePred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2228"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2229"></span><span>        </span><span class="annot"><a href="GHC.Types.Avail.html#AvailTC"><span class="hs-identifier hs-type">AvailTC</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053847"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053847"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2230"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; Maybe Name
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683053848"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053848"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683053842"><span class="hs-identifier hs-var">importedFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053848"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683053847"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2231"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683053849"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053849"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683053846"><span class="hs-identifier hs-var">namePred</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683053849"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2232"></span><span>            </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2233"></span><span>        </span><span class="annot"><a href="GHC.Types.Avail.html#Avail"><span class="hs-identifier hs-type">Avail</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2234"></span><span>    </span><span id="local-6989586621683053819"><span class="annot"><span class="annottext">availOccName :: AvailInfo -&gt; OccName
</span><a href="#local-6989586621683053819"><span class="hs-identifier hs-var hs-var">availOccName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; (AvailInfo -&gt; Name) -&gt; AvailInfo -&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; Name
</span><a href="GHC.Types.Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a></span><span>
</span><span id="line-2235"></span><span>    </span><span id="local-6989586621683053824"><span class="annot"><span class="annottext">rdr :: IdP (GhcPass 'Parsed)
</span><a href="#local-6989586621683053824"><span class="hs-identifier hs-var hs-var">rdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
forall (p :: Pass). IE (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieName"><span class="hs-identifier hs-var">ieName</span></a></span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053793"><span class="hs-identifier hs-var">ie</span></a></span><span>
</span><span id="line-2236"></span><span>    </span><span id="local-6989586621683053842"><span class="annot"><span class="annottext">importedFS :: FastString
</span><a href="#local-6989586621683053842"><span class="hs-identifier hs-var hs-var">importedFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString) -&gt; OccName -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Parsed)
RdrName
</span><a href="#local-6989586621683053824"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-2237"></span><span>    </span><span id="local-6989586621683053803"><span class="annot"><span class="annottext">imp_spec :: ImportSpec
</span><a href="#local-6989586621683053803"><span class="hs-identifier hs-var hs-var">imp_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpSpec"><span class="hs-identifier hs-type">ImpSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_decl :: ImpDeclSpec
</span><a href="GHC.Types.Name.Reader.html#is_decl"><span class="hs-identifier hs-var">is_decl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683053792"><span class="hs-identifier hs-var">decl_spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_item :: ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#is_item"><span class="hs-identifier hs-var">is_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2238"></span><span>    </span><span id="local-6989586621683053804"><span class="annot"><span class="annottext">all_avails :: [AvailInfo]
</span><a href="#local-6989586621683053804"><span class="hs-identifier hs-var hs-var">all_avails</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; [AvailInfo]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [AvailInfo]
</span><a href="GHC.Unit.Module.ModIface.html#mi_exports"><span class="hs-identifier hs-var">mi_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683053791"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-2239"></span><span>    </span><span id="local-6989586621683053813"><span class="annot"><span class="annottext">unavailableChildren :: [OccName]
</span><a href="#local-6989586621683053813"><span class="hs-identifier hs-var hs-var">unavailableChildren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><a href="#local-6989586621683053793"><span class="hs-identifier hs-var">ie</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2240"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IEThingWith"><span class="hs-identifier hs-type">IEThingWith</span></a></span><span> </span><span class="annot"><span class="annottext">XIEThingWith (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LIEWrappedName (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IEWildcard
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683053852"><span class="annot"><span class="annottext">[LIEWrappedName (GhcPass 'Parsed)]
</span><a href="#local-6989586621683053852"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExportDoc (GhcPass 'Parsed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
 -&gt; OccName)
-&gt; [GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
-&gt; [OccName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName)
-&gt; (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
    -&gt; RdrName)
-&gt; GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
-&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IEWrappedName (GhcPass 'Parsed) -&gt; IdP (GhcPass 'Parsed)
IEWrappedName (GhcPass 'Parsed) -&gt; RdrName
forall (p :: Pass). IEWrappedName (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.ImpExp.html#ieWrappedName"><span class="hs-identifier hs-var">ieWrappedName</span></a></span><span>  </span><span class="annot"><span class="annottext">(IEWrappedName (GhcPass 'Parsed) -&gt; RdrName)
-&gt; (GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
    -&gt; IEWrappedName (GhcPass 'Parsed))
-&gt; GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
-&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))
-&gt; IEWrappedName (GhcPass 'Parsed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LIEWrappedName (GhcPass 'Parsed)]
[GenLocated SrcSpanAnnA (IEWrappedName (GhcPass 'Parsed))]
</span><a href="#local-6989586621683053852"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2241"></span><span>      </span><span class="annot"><span class="annottext">IE (GhcPass 'Parsed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [OccName]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;importedChildren failed pattern match: no children&quot;</span></span><span>
</span><span id="line-2242"></span><span>
</span><span id="line-2243"></span><span class="annot"><a href="GHC.Rename.Names.html#addDupDeclErr"><span class="hs-identifier hs-type">addDupDeclErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2244"></span><span id="addDupDeclErr"><span class="annot"><span class="annottext">addDupDeclErr :: NonEmpty GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#addDupDeclErr"><span class="hs-identifier hs-var hs-var">addDupDeclErr</span></a></span></span><span> </span><span id="local-6989586621683053853"><span class="annot"><span class="annottext">gres :: NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683053853"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683053854"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053854"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2245"></span><span>  </span><span class="hs-comment">-- Report the error at the later location</span><span>
</span><span id="line-2246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty Name -&gt; Name
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#last"><span class="hs-identifier hs-var">NE.last</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621683053856"><span class="hs-identifier hs-var">sorted_names</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; NonEmpty Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnDuplicateDecls"><span class="hs-identifier hs-var">TcRnDuplicateDecls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; OccName
forall info. GlobalRdrEltX info -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683053854"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621683053856"><span class="hs-identifier hs-var">sorted_names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2248"></span><span>    </span><span id="local-6989586621683053856"><span class="annot"><span class="annottext">sorted_names :: NonEmpty Name
</span><a href="#local-6989586621683053856"><span class="hs-identifier hs-var hs-var">sorted_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2249"></span><span>      </span><span class="annot"><span class="annottext">(Name -&gt; Name -&gt; Ordering) -&gt; NonEmpty Name -&gt; NonEmpty Name
forall a. (a -&gt; a -&gt; Ordering) -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#sortBy"><span class="hs-identifier hs-var">NE.sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpan -&gt; Ordering
</span><a href="GHC.Types.SrcLoc.html#leftmost_smallest"><span class="hs-identifier hs-var">SrcLoc.leftmost_smallest</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; SrcSpan -&gt; Ordering)
-&gt; (Name -&gt; SrcSpan) -&gt; Name -&gt; Name -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2250"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; NonEmpty GlobalRdrElt -&gt; NonEmpty Name
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683053853"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2251"></span><span>
</span><span id="line-2252"></span><span class="hs-comment">-- This data decl will parse OK</span><span>
</span><span id="line-2253"></span><span class="hs-comment">--      data T = a Int</span><span>
</span><span id="line-2254"></span><span class="hs-comment">-- treating &quot;a&quot; as the constructor.</span><span>
</span><span id="line-2255"></span><span class="hs-comment">-- It is really hard to make the parser spot this malformation.</span><span>
</span><span id="line-2256"></span><span class="hs-comment">-- So the renamer has to check that the constructor is legal</span><span>
</span><span id="line-2257"></span><span class="hs-comment">--</span><span>
</span><span id="line-2258"></span><span class="hs-comment">-- We can get an operator as the constructor, even in the prefix form:</span><span>
</span><span id="line-2259"></span><span class="hs-comment">--      data T = :% Int Int</span><span>
</span><span id="line-2260"></span><span class="hs-comment">-- from interface files, which always print in prefix form</span><span>
</span><span id="line-2261"></span><span class="hs-comment">--</span><span>
</span><span id="line-2262"></span><span class="hs-comment">-- We also allow type constructor names, which are defined by &quot;type data&quot;</span><span>
</span><span id="line-2263"></span><span class="hs-comment">-- declarations.  See Note [Type data declarations] in GHC.Rename.Module.</span><span>
</span><span id="line-2264"></span><span>
</span><span id="line-2265"></span><span class="annot"><a href="GHC.Rename.Names.html#checkConName"><span class="hs-identifier hs-type">checkConName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2266"></span><span id="checkConName"><span class="annot"><span class="annottext">checkConName :: RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Names.html#checkConName"><span class="hs-identifier hs-var hs-var">checkConName</span></a></span></span><span> </span><span id="local-6989586621683053861"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053861"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2267"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRdrDataCon"><span class="hs-identifier hs-var">isRdrDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053861"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRdrTc"><span class="hs-identifier hs-var">isRdrTc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053861"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalDataCon"><span class="hs-identifier hs-var">TcRnIllegalDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683053861"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2268"></span></pre></body></html>