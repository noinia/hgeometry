<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Wasm.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Wasm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Wasm.html#spawnWasmInterp"><span class="hs-identifier">spawnWasmInterp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Types</span></a></span><span class="hs-cpp">

#if !defined(mingw32_HOST_OS)
</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Concurrent.MVar.html"><span class="hs-identifier">Control.Concurrent.MVar</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html"><span class="hs-identifier">GHC.Data.ShortText</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html"><span class="hs-identifier">GHCi.Message</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.html"><span class="hs-identifier">System.Posix.IO</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Posix</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../process-1.6.25.0-5f54/src/System.Process.html"><span class="hs-identifier">System.Process</span></a></span><span class="hs-cpp">

#else
</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Utils.Panic</span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-30"></span><span class="annot"><a href="GHC.Runtime.Interpreter.Wasm.html#spawnWasmInterp"><span class="hs-identifier hs-type">spawnWasmInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#WasmInterpConfig"><span class="hs-identifier hs-type">WasmInterpConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">

#if !defined(mingw32_HOST_OS)
</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- See Note [The Wasm Dynamic Linker] for details</span><span>
</span><span id="line-35"></span><span id="spawnWasmInterp"><span class="annot"><span class="annottext">spawnWasmInterp :: WasmInterpConfig -&gt; IO (ExtInterpInstance ())
</span><a href="GHC.Runtime.Interpreter.Wasm.html#spawnWasmInterp"><span class="hs-identifier hs-var hs-var">spawnWasmInterp</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#WasmInterpConfig"><span class="hs-identifier hs-type">WasmInterpConfig</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682934881"><span id="local-6989586621682934882"><span id="local-6989586621682934883"><span id="local-6989586621682934884"><span id="local-6989586621682934885"><span id="local-6989586621682934886"><span id="local-6989586621682934887"><span class="annot"><span class="annottext">Bool
String
[String]
Platform
UnitState
wasmInterpDyLD :: String
wasmInterpLibDir :: String
wasmInterpOpts :: [String]
wasmInterpTargetPlatform :: Platform
wasmInterpProfiled :: Bool
wasmInterpHsSoSuffix :: String
wasmInterpUnitState :: UnitState
wasmInterpUnitState :: WasmInterpConfig -&gt; UnitState
wasmInterpHsSoSuffix :: WasmInterpConfig -&gt; String
wasmInterpProfiled :: WasmInterpConfig -&gt; Bool
wasmInterpTargetPlatform :: WasmInterpConfig -&gt; Platform
wasmInterpOpts :: WasmInterpConfig -&gt; [String]
wasmInterpLibDir :: WasmInterpConfig -&gt; String
wasmInterpDyLD :: WasmInterpConfig -&gt; String
</span><a href="#local-6989586621682934881"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682934895"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682934895"><span class="hs-identifier hs-var hs-var">ghci_unit_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><span class="annottext">UnitState -&gt; PackageName -&gt; Maybe UnitId
</span><a href="GHC.Unit.State.html#lookupPackageName"><span class="hs-identifier hs-var">lookupPackageName</span></a></span><span>
</span><span id="line-38"></span><span>          </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682934887"><span class="hs-identifier hs-var">wasmInterpUnitState</span></a></span><span>
</span><span id="line-39"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; PackageName
</span><a href="GHC.Unit.Info.html#PackageName"><span class="hs-identifier hs-var">PackageName</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; PackageName) -&gt; FastString -&gt; PackageName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghci&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>      </span><span id="local-6989586621682934899"><span class="annot"><span class="annottext">ghci_unit_info :: UnitInfo
</span><a href="#local-6989586621682934899"><span class="hs-identifier hs-var hs-var hs-var">ghci_unit_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitState -&gt; UnitId -&gt; UnitInfo
UnitState -&gt; UnitId -&gt; UnitInfo
</span><a href="GHC.Unit.State.html#unsafeLookupUnitId"><span class="hs-identifier hs-var">unsafeLookupUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682934887"><span class="hs-identifier hs-var">wasmInterpUnitState</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682934895"><span class="hs-identifier hs-var">ghci_unit_id</span></a></span><span>
</span><span id="line-41"></span><span>      </span><span id="local-6989586621682934901"><span class="annot"><span class="annottext">ghci_so_dirs :: [String]
</span><a href="#local-6989586621682934901"><span class="hs-identifier hs-var hs-var hs-var">ghci_so_dirs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePathST -&gt; String) -&gt; [FilePathST] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FilePathST -&gt; String
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#unpack"><span class="hs-identifier hs-var">ST.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePathST] -&gt; [String]) -&gt; [FilePathST] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [FilePathST]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [FilePathST]
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Unit.Database.html#unitLibraryDynDirs"><span class="hs-identifier hs-var">unitLibraryDynDirs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621682934899"><span class="hs-identifier hs-var">ghci_unit_info</span></a></span><span>
</span><span id="line-42"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621682934904"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682934904"><span class="hs-identifier hs-var hs-var">ghci_lib_name</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePathST -&gt; String) -&gt; [FilePathST] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FilePathST -&gt; String
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#unpack"><span class="hs-identifier hs-var">ST.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePathST] -&gt; [String]) -&gt; [FilePathST] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [FilePathST]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [FilePathST]
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Unit.Database.html#unitLibraries"><span class="hs-identifier hs-var">unitLibraries</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621682934899"><span class="hs-identifier hs-var">ghci_unit_info</span></a></span><span>
</span><span id="line-43"></span><span>      </span><span id="local-6989586621682934906"><span class="annot"><span class="annottext">ghci_so_name :: String
</span><a href="#local-6989586621682934906"><span class="hs-identifier hs-var hs-var hs-var">ghci_so_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682934904"><span class="hs-identifier hs-var">ghci_lib_name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682934886"><span class="hs-identifier hs-var">wasmInterpHsSoSuffix</span></a></span><span>
</span><span id="line-44"></span><span>      </span><span id="local-6989586621682934907"><span class="annot"><span class="annottext">ghci_so_file :: String
</span><a href="#local-6989586621682934907"><span class="hs-identifier hs-var hs-var hs-var">ghci_so_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; String -&gt; String
</span><a href="GHC.Platform.html#platformHsSOName"><span class="hs-identifier hs-var">platformHsSOName</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682934884"><span class="hs-identifier hs-var">wasmInterpTargetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682934906"><span class="hs-identifier hs-var">ghci_so_name</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682934909"><span class="annot"><a href="#local-6989586621682934909"><span class="hs-identifier hs-var">ghci_so_path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String -&gt; IO (Maybe String)
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#findFile"><span class="hs-identifier hs-var">findFile</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682934901"><span class="hs-identifier hs-var">ghci_so_dirs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682934907"><span class="hs-identifier hs-var">ghci_so_file</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682934911"><span class="annot"><a href="#local-6989586621682934911"><span class="hs-identifier hs-var">rfd1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682934912"><span class="annot"><a href="#local-6989586621682934912"><span class="hs-identifier hs-var">wfd1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#createPipe"><span class="hs-identifier hs-type">Posix.createPipe</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682934914"><span class="annot"><a href="#local-6989586621682934914"><span class="hs-identifier hs-var">rfd2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682934915"><span class="annot"><a href="#local-6989586621682934915"><span class="hs-identifier hs-var">wfd2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#createPipe"><span class="hs-identifier hs-type">Posix.createPipe</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#setFdOption"><span class="hs-identifier hs-type">Posix.setFdOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682934911"><span class="hs-identifier hs-type">rfd1</span></a></span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#CloseOnExec"><span class="hs-identifier hs-type">Posix.CloseOnExec</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#setFdOption"><span class="hs-identifier hs-type">Posix.setFdOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682934915"><span class="hs-identifier hs-type">wfd2</span></a></span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#CloseOnExec"><span class="hs-identifier hs-type">Posix.CloseOnExec</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682934918"><span class="annot"><a href="#local-6989586621682934918"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="../../process-1.6.25.0-5f54/src/System.Process.html#createProcess"><span class="hs-identifier hs-type">createProcess</span></a></span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../process-1.6.25.0-5f54/src/System.Process.html#proc"><span class="hs-identifier hs-type">proc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682934881"><span class="hs-identifier hs-type">wasmInterpDyLD</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-53"></span><span>          </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682934882"><span class="hs-identifier hs-type">wasmInterpLibDir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682934909"><span class="hs-identifier hs-type">ghci_so_path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682934912"><span class="hs-identifier hs-type">wfd1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682934914"><span class="hs-identifier hs-type">rfd2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-54"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682934883"><span class="hs-identifier hs-type">wasmInterpOpts</span></a></span><span>
</span><span id="line-55"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;+RTS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;-H64m&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;-RTS&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-56"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#closeFd"><span class="hs-identifier hs-type">Posix.closeFd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682934912"><span class="hs-identifier hs-type">wfd1</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#closeFd"><span class="hs-identifier hs-type">Posix.closeFd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682934914"><span class="hs-identifier hs-type">rfd2</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621682934923"><span class="annot"><a href="#local-6989586621682934923"><span class="hs-identifier hs-var">rh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#fdToHandle"><span class="hs-identifier hs-type">Posix.fdToHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682934911"><span class="hs-identifier hs-type">rfd1</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span id="local-6989586621682934925"><span class="annot"><a href="#local-6989586621682934925"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.IO.Common.html#fdToHandle"><span class="hs-identifier hs-type">Posix.fdToHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682934915"><span class="hs-identifier hs-type">wfd2</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">hSetBuffering</span></span><span> </span><span class="annot"><a href="#local-6989586621682934925"><span class="hs-identifier hs-type">wh</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoBuffering</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">hSetBuffering</span></span><span> </span><span class="annot"><a href="#local-6989586621682934923"><span class="hs-identifier hs-type">rh</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoBuffering</span></span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621682934928"><span class="annot"><a href="#local-6989586621682934928"><span class="hs-identifier hs-var">lo_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-64"></span><span>  </span><span id="local-6989586621682934930"><span class="annot"><a href="#local-6989586621682934930"><span class="hs-identifier hs-var">pending_frees</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newMVar</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621682934932"><span class="annot"><a href="#local-6989586621682934932"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span>
</span><span id="line-68"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#instProcess"><span class="hs-identifier hs-var">instProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>          </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpProcess"><span class="hs-identifier hs-type">InterpProcess</span></a></span><span>
</span><span id="line-70"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#interpHandle"><span class="hs-identifier hs-var">interpHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682934918"><span class="hs-identifier hs-type">ph</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>              </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#interpPipe"><span class="hs-identifier hs-var">interpPipe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#pipeRead"><span class="hs-identifier hs-var">pipeRead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682934923"><span class="hs-identifier hs-type">rh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#pipeWrite"><span class="hs-identifier hs-var">pipeWrite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682934925"><span class="hs-identifier hs-type">wh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#pipeLeftovers"><span class="hs-identifier hs-var">pipeLeftovers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682934928"><span class="hs-identifier hs-type">lo_ref</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>              </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#interpLock"><span class="hs-identifier hs-var">interpLock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682934932"><span class="hs-identifier hs-type">lock</span></a></span><span>
</span><span id="line-73"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#instPendingFrees"><span class="hs-identifier hs-var">instPendingFrees</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682934930"><span class="hs-identifier hs-type">pending_frees</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#instExtra"><span class="hs-identifier hs-var">instExtra</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>      </span><span class="hs-special">}</span><span class="hs-cpp">

#else
</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- Due to difficulty of using inherited pipe file descriptor in</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- nodejs, unfortunately we don't support Win32 host yet</span><span>
</span><span id="line-82"></span><span class="hs-identifier">spawnWasmInterp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sorry</span><span> </span><span class="hs-string">&quot;Wasm iserv doesn't work on Win32 host yet&quot;</span><span class="hs-cpp">

#endif
</span></pre></body></html>