<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | The Name Cache</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html"><span class="hs-identifier">GHC.Types.Name.Cache</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier">NameCache</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#initNameCache"><span class="hs-identifier">initNameCache</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#takeUniqFromNameCache"><span class="hs-identifier">takeUniqFromNameCache</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#updateNameCache%27"><span class="hs-identifier">updateNameCache'</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#updateNameCache"><span class="hs-identifier">updateNameCache</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><span class="hs-comment">-- * OrigNameCache</span></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier">OrigNameCache</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#lookupOrigNameCache"><span class="hs-identifier">lookupOrigNameCache</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#extendOrigNameCache%27"><span class="hs-identifier">extendOrigNameCache'</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#extendOrigNameCache"><span class="hs-identifier">extendOrigNameCache</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Concurrent.MVar.html"><span class="hs-identifier">Control.Concurrent.MVar</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">{-

Note [The Name Cache]
~~~~~~~~~~~~~~~~~~~~~
The Name Cache makes sure that, during any invocation of GHC, each
External Name &quot;M.x&quot; has one, and only one globally-agreed Unique.

* The first time we come across M.x we make up a Unique and record that
  association in the Name Cache.

* When we come across &quot;M.x&quot; again, we look it up in the Name Cache,
  and get a hit.

The functions newGlobalBinder, allocateGlobalBinder do the main work.
When you make an External name, you should probably be calling one
of them.

Names in a NameCache are always stored as a Global, and have the SrcLoc of their
binding locations.  Actually that's not quite right.  When we first encounter
the original name, we might not be at its binding site (e.g. we are reading an
interface file); so we give it 'noSrcLoc' then.  Later, when we find its binding
site, we fix it up.


Note [Built-in syntax and the OrigNameCache]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Built-in syntax like unboxed sums and punned syntax like tuples are quite
ubiquitous. To lower their cost we use two tricks,

  a. We specially encode tuple and sum Names in interface files' symbol tables
     to avoid having to look up their names while loading interface files.
     Namely these names are encoded as by their Uniques. We know how to get from
     a Unique back to the Name which it represents via the mapping defined in
     the SumTupleUniques module. See Note [Symbol table representation of names]
     in GHC.Iface.Binary and for details.

  b. We don't include them in the Orig name cache but instead parse their
     OccNames (in isBuiltInOcc_maybe and isPunOcc_maybe) to avoid bloating
     the name cache with them.

Why is the second measure necessary? Good question; afterall, 1) the parser
emits built-in and punned syntax directly as Exact RdrNames, and 2) built-in
and punned syntax never needs to looked-up during interface loading due to (a).
It turns out that there are two reasons why we might look up an Orig RdrName
for built-in and punned syntax,

  * If you use setRdrNameSpace on an Exact RdrName it may be
    turned into an Orig RdrName.

  * Template Haskell turns a BuiltInSyntax Name into a TH.NameG
    (GHC.HsToCore.Quote.globalVar), and parses a NameG into an Orig RdrName
    (GHC.ThToHs.thRdrName).  So, e.g. $(do { reify '(,); ... }) will
    go this route (#8954).

-}</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | The NameCache makes sure that there is just one Unique assigned for</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- each original name; i.e. (module-name, occ-name) pair and provides</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- something of a lookup mechanism for those names.</span><span>
</span><span id="line-93"></span><span class="hs-keyword">data</span><span> </span><span id="NameCache"><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-var">NameCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NameCache"><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-var">NameCache</span></a></span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="nsUniqChar"><span class="annot"><span class="annottext">NameCache -&gt; Char
</span><a href="GHC.Types.Name.Cache.html#nsUniqChar"><span class="hs-identifier hs-var hs-var">nsUniqChar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="nsNames"><span class="annot"><span class="annottext">NameCache -&gt; MVar OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#nsNames"><span class="hs-identifier hs-var hs-var">nsNames</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><span class="hs-comment">-- | Per-module cache of original 'OccName's given 'Name's</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">type</span><span> </span><span id="OrigNameCache"><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-var">OrigNameCache</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Env.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><a href="GHC.Types.Name.Cache.html#takeUniqFromNameCache"><span class="hs-identifier hs-type">takeUniqFromNameCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span>
</span><span id="line-102"></span><span id="takeUniqFromNameCache"><span class="annot"><span class="annottext">takeUniqFromNameCache :: NameCache -&gt; IO Unique
</span><a href="GHC.Types.Name.Cache.html#takeUniqFromNameCache"><span class="hs-identifier hs-var hs-var">takeUniqFromNameCache</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span id="local-6989586621682597702"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682597702"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">MVar OrigNameCache
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; IO Unique
</span><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-identifier hs-var">uniqFromTag</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682597702"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="GHC.Types.Name.Cache.html#lookupOrigNameCache"><span class="hs-identifier hs-type">lookupOrigNameCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-105"></span><span id="lookupOrigNameCache"><span class="annot"><span class="annottext">lookupOrigNameCache :: OrigNameCache -&gt; Module -&gt; OccName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Cache.html#lookupOrigNameCache"><span class="hs-identifier hs-var hs-var">lookupOrigNameCache</span></a></span></span><span> </span><span id="local-6989586621682597704"><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621682597704"><span class="hs-identifier hs-var">nc</span></a></span></span><span> </span><span id="local-6989586621682597705"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597705"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682597706"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597706"><span class="hs-identifier hs-var">occ</span></a></span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597705"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="GHC.Builtin.Names.html#gHC_TYPES"><span class="hs-identifier hs-var">gHC_TYPES</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597705"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="GHC.Builtin.Names.html#gHC_PRIM"><span class="hs-identifier hs-var">gHC_PRIM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597705"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="GHC.Builtin.Names.html#gHC_INTERNAL_TUPLE"><span class="hs-identifier hs-var">gHC_INTERNAL_TUPLE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597705"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="GHC.Builtin.Names.html#gHC_CLASSES"><span class="hs-identifier hs-var">gHC_CLASSES</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682597712"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597712"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Maybe Name
</span><a href="GHC.Builtin.Types.html#isBuiltInOcc_maybe"><span class="hs-identifier hs-var">isBuiltInOcc_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597706"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Maybe Name -&gt; Maybe Name
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; Maybe Name
</span><a href="GHC.Builtin.Types.html#isPunOcc_maybe"><span class="hs-identifier hs-var">isPunOcc_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597705"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597706"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- See Note [Known-key names], 3(c) in GHC.Builtin.Names</span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-comment">-- Special case for tuples; there are too many</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-comment">-- of them to pre-populate the original-name cache</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597712"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OrigNameCache -&gt; Module -&gt; Maybe (OccEnv Name)
forall a. ModuleEnv a -&gt; Module -&gt; Maybe a
</span><a href="GHC.Unit.Module.Env.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621682597704"><span class="hs-identifier hs-var">nc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597705"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Maybe (OccEnv Name)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682597717"><span class="annot"><span class="annottext">OccEnv Name
</span><a href="#local-6989586621682597717"><span class="hs-identifier hs-var">occ_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccEnv Name -&gt; OccName -&gt; Maybe Name
forall a. OccEnv a -&gt; OccName -&gt; Maybe a
</span><a href="GHC.Types.Name.Occurrence.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">OccEnv Name
</span><a href="#local-6989586621682597717"><span class="hs-identifier hs-var">occ_env</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597706"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><a href="GHC.Types.Name.Cache.html#extendOrigNameCache%27"><span class="hs-identifier hs-type">extendOrigNameCache'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span>
</span><span id="line-119"></span><span id="extendOrigNameCache%27"><span class="annot"><span class="annottext">extendOrigNameCache' :: OrigNameCache -&gt; Name -&gt; OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#extendOrigNameCache%27"><span class="hs-identifier hs-var hs-var">extendOrigNameCache'</span></a></span></span><span> </span><span id="local-6989586621682597719"><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621682597719"><span class="hs-identifier hs-var">nc</span></a></span></span><span> </span><span id="local-6989586621682597720"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597720"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; OrigNameCache -&gt; OrigNameCache
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597720"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597720"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OrigNameCache -&gt; OrigNameCache) -&gt; OrigNameCache -&gt; OrigNameCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">OrigNameCache -&gt; Module -&gt; OccName -&gt; Name -&gt; OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#extendOrigNameCache"><span class="hs-identifier hs-var">extendOrigNameCache</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621682597719"><span class="hs-identifier hs-var">nc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Module
Name -&gt; Module
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597720"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597720"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597720"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="GHC.Types.Name.Cache.html#extendOrigNameCache"><span class="hs-identifier hs-type">extendOrigNameCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span>
</span><span id="line-124"></span><span id="extendOrigNameCache"><span class="annot"><span class="annottext">extendOrigNameCache :: OrigNameCache -&gt; Module -&gt; OccName -&gt; Name -&gt; OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#extendOrigNameCache"><span class="hs-identifier hs-var hs-var">extendOrigNameCache</span></a></span></span><span> </span><span id="local-6989586621682597726"><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621682597726"><span class="hs-identifier hs-var">nc</span></a></span></span><span> </span><span id="local-6989586621682597727"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597727"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682597728"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597728"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span id="local-6989586621682597729"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597729"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccEnv Name -&gt; OccEnv Name -&gt; OccEnv Name)
-&gt; OrigNameCache -&gt; Module -&gt; OccEnv Name -&gt; OrigNameCache
forall a.
(a -&gt; a -&gt; a) -&gt; ModuleEnv a -&gt; Module -&gt; a -&gt; ModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#extendModuleEnvWith"><span class="hs-identifier hs-var">extendModuleEnvWith</span></a></span><span> </span><span class="annot"><span class="annottext">OccEnv Name -&gt; OccEnv Name -&gt; OccEnv Name
</span><a href="#local-6989586621682597731"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621682597726"><span class="hs-identifier hs-var">nc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597727"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; Name -&gt; OccEnv Name
forall a. OccName -&gt; a -&gt; OccEnv a
</span><a href="GHC.Types.Name.Occurrence.html#unitOccEnv"><span class="hs-identifier hs-var">unitOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597728"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597729"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621682597731"><span class="annot"><span class="annottext">combine :: OccEnv Name -&gt; OccEnv Name -&gt; OccEnv Name
</span><a href="#local-6989586621682597731"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="annot"><span class="annottext">OccEnv Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682597733"><span class="annot"><span class="annottext">OccEnv Name
</span><a href="#local-6989586621682597733"><span class="hs-identifier hs-var">occ_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccEnv Name -&gt; OccName -&gt; Name -&gt; OccEnv Name
forall a. OccEnv a -&gt; OccName -&gt; a -&gt; OccEnv a
</span><a href="GHC.Types.Name.Occurrence.html#extendOccEnv"><span class="hs-identifier hs-var">extendOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">OccEnv Name
</span><a href="#local-6989586621682597733"><span class="hs-identifier hs-var">occ_env</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597728"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682597729"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="GHC.Types.Name.Cache.html#initNameCache"><span class="hs-identifier hs-type">initNameCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span>
</span><span id="line-130"></span><span id="initNameCache"><span class="annot"><span class="annottext">initNameCache :: Char -&gt; [Name] -&gt; IO NameCache
</span><a href="GHC.Types.Name.Cache.html#initNameCache"><span class="hs-identifier hs-var hs-var">initNameCache</span></a></span></span><span> </span><span id="local-6989586621682597735"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682597735"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682597736"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682597736"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; MVar OrigNameCache -&gt; NameCache
</span><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-var">NameCache</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682597735"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(MVar OrigNameCache -&gt; NameCache)
-&gt; IO (MVar OrigNameCache) -&gt; IO NameCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OrigNameCache -&gt; IO (MVar OrigNameCache)
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#initOrigNames"><span class="hs-identifier hs-var">initOrigNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682597736"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="GHC.Types.Name.Cache.html#initOrigNames"><span class="hs-identifier hs-type">initOrigNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span>
</span><span id="line-133"></span><span id="initOrigNames"><span class="annot"><span class="annottext">initOrigNames :: [Name] -&gt; OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#initOrigNames"><span class="hs-identifier hs-var hs-var">initOrigNames</span></a></span></span><span> </span><span id="local-6989586621682597740"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682597740"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OrigNameCache -&gt; Name -&gt; OrigNameCache)
-&gt; OrigNameCache -&gt; [Name] -&gt; OrigNameCache
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">OrigNameCache -&gt; Name -&gt; OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#extendOrigNameCache%27"><span class="hs-identifier hs-var">extendOrigNameCache'</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache
forall a. ModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#emptyModuleEnv"><span class="hs-identifier hs-var">emptyModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682597740"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><span class="hs-comment">-- | Update the name cache with the given function</span></span><span>
</span><span id="line-136"></span><span id="local-6989586621682597654"><span class="annot"><a href="GHC.Types.Name.Cache.html#updateNameCache%27"><span class="hs-identifier hs-type">updateNameCache'</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682597654"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- The updating function</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682597654"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-140"></span><span id="updateNameCache%27"><span class="annot"><span class="annottext">updateNameCache' :: forall c.
NameCache -&gt; (OrigNameCache -&gt; IO (OrigNameCache, c)) -&gt; IO c
</span><a href="GHC.Types.Name.Cache.html#updateNameCache%27"><span class="hs-identifier hs-var hs-var">updateNameCache'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span id="local-6989586621682597743"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682597743"><span class="hs-identifier hs-var">_c</span></a></span></span><span> </span><span id="local-6989586621682597744"><span class="annot"><span class="annottext">MVar OrigNameCache
</span><a href="#local-6989586621682597744"><span class="hs-identifier hs-var">nc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682597745"><span class="annot"><span class="annottext">OrigNameCache -&gt; IO (OrigNameCache, c)
</span><a href="#local-6989586621682597745"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar OrigNameCache
-&gt; (OrigNameCache -&gt; IO (OrigNameCache, c)) -&gt; IO c
forall a b. MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
</span><a href="GHC.Types.Name.Cache.html#modifyMVar%27"><span class="hs-identifier hs-var">modifyMVar'</span></a></span><span> </span><span class="annot"><span class="annottext">MVar OrigNameCache
</span><a href="#local-6989586621682597744"><span class="hs-identifier hs-var">nc</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache -&gt; IO (OrigNameCache, c)
</span><a href="#local-6989586621682597745"><span class="hs-identifier hs-var">upd_fn</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- this should be in `base`</span><span>
</span><span id="line-143"></span><span id="local-6989586621682597656"><span id="local-6989586621682597657"><span class="annot"><a href="GHC.Types.Name.Cache.html#modifyMVar%27"><span class="hs-identifier hs-type">modifyMVar'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="annot"><a href="#local-6989586621682597656"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682597656"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682597656"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682597657"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682597657"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-144"></span><span id="modifyMVar%27"><span class="annot"><span class="annottext">modifyMVar' :: forall a b. MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
</span><a href="GHC.Types.Name.Cache.html#modifyMVar%27"><span class="hs-identifier hs-var hs-var">modifyMVar'</span></a></span></span><span> </span><span id="local-6989586621682597751"><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621682597751"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682597752"><span class="annot"><span class="annottext">a -&gt; IO (a, b)
</span><a href="#local-6989586621682597752"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
forall a b. MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
</span><span class="hs-identifier hs-var">modifyMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621682597751"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">((a -&gt; IO (a, b)) -&gt; IO b) -&gt; (a -&gt; IO (a, b)) -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO (a, b)
</span><a href="#local-6989586621682597752"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; IO (a, b)) -&gt; ((a, b) -&gt; IO (a, b)) -&gt; a -&gt; IO (a, b)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682597755"><span class="annot"><span class="annottext">(a, b)
</span><a href="#local-6989586621682597755"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(a, b)
</span><a href="#local-6989586621682597755"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO (a, b) -&gt; IO (a, b)
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; IO (a, b)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(a, b)
</span><a href="#local-6989586621682597755"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Update the name cache with the given function</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- Additionally, it ensures that the given Module and OccName are evaluated.</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- If not, chaos can ensue:</span><span>
</span><span id="line-150"></span><span class="hs-comment">--      we read the name-cache</span><span>
</span><span id="line-151"></span><span class="hs-comment">--      then pull on mod (say)</span><span>
</span><span id="line-152"></span><span class="hs-comment">--      which does some stuff that modifies the name cache</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- This did happen, with tycon_mod in GHC.IfaceToCore.tcIfaceAlt (DataAlt..)</span><span>
</span><span id="line-154"></span><span id="local-6989586621682597670"><span class="annot"><a href="GHC.Types.Name.Cache.html#updateNameCache"><span class="hs-identifier hs-type">updateNameCache</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Cache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682597670"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682597670"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-160"></span><span id="updateNameCache"><span class="annot"><span class="annottext">updateNameCache :: forall c.
NameCache
-&gt; Module
-&gt; OccName
-&gt; (OrigNameCache -&gt; IO (OrigNameCache, c))
-&gt; IO c
</span><a href="GHC.Types.Name.Cache.html#updateNameCache"><span class="hs-identifier hs-var hs-var">updateNameCache</span></a></span></span><span> </span><span id="local-6989586621682597757"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621682597757"><span class="hs-identifier hs-var">name_cache</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682597758"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682597758"><span class="hs-identifier hs-var">_mod</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682597759"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682597759"><span class="hs-identifier hs-var">_occ</span></a></span></span><span> </span><span id="local-6989586621682597760"><span class="annot"><span class="annottext">OrigNameCache -&gt; IO (OrigNameCache, c)
</span><a href="#local-6989586621682597760"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameCache -&gt; (OrigNameCache -&gt; IO (OrigNameCache, c)) -&gt; IO c
forall c.
NameCache -&gt; (OrigNameCache -&gt; IO (OrigNameCache, c)) -&gt; IO c
</span><a href="GHC.Types.Name.Cache.html#updateNameCache%27"><span class="hs-identifier hs-var">updateNameCache'</span></a></span><span> </span><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621682597757"><span class="hs-identifier hs-var">name_cache</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache -&gt; IO (OrigNameCache, c)
</span><a href="#local-6989586621682597760"><span class="hs-identifier hs-var">upd_fn</span></a></span><span>
</span><span id="line-162"></span></pre></body></html>