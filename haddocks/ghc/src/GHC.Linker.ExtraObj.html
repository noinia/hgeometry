<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- GHC Extra object linking code</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- (c) The GHC Team 2017</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html"><span class="hs-identifier">GHC.Linker.ExtraObj</span></a></span><span>
</span><span id="line-10"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#mkExtraObj"><span class="hs-identifier">mkExtraObj</span></a></span><span>
</span><span id="line-11"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#mkExtraObjToLinkIntoBinary"><span class="hs-identifier">mkExtraObjToLinkIntoBinary</span></a></span><span>
</span><span id="line-12"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#mkNoteObjsToLinkIntoBinary"><span class="hs-identifier">mkNoteObjsToLinkIntoBinary</span></a></span><span>
</span><span id="line-13"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#checkLinkInfo"><span class="hs-identifier">checkLinkInfo</span></a></span><span>
</span><span id="line-14"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#getLinkInfo"><span class="hs-identifier">getLinkInfo</span></a></span><span>
</span><span id="line-15"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoSectionName"><span class="hs-identifier">ghcLinkInfoSectionName</span></a></span><span>
</span><span id="line-16"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoNoteName"><span class="hs-identifier">ghcLinkInfoNoteName</span></a></span><span>
</span><span id="line-17"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#platformSupportsSavingLinkOpts"><span class="hs-identifier">platformSupportsSavingLinkOpts</span></a></span><span>
</span><span id="line-18"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#haveRtsOptsFlags"><span class="hs-identifier">haveRtsOptsFlags</span></a></span><span>
</span><span id="line-19"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Asm.html"><span class="hs-identifier">GHC.Utils.Asm</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html"><span class="hs-identifier">GHC.Data.ShortText</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.Elf.html"><span class="hs-identifier">GHC.SysTools.Elf</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.Tasks.html"><span class="hs-identifier">GHC.SysTools.Tasks</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Unit.html"><span class="hs-identifier">GHC.Linker.Unit</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#mkExtraObj"><span class="hs-identifier hs-type">mkExtraObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-48"></span><span id="mkExtraObj"><span class="annot"><span class="annottext">mkExtraObj :: Logger
-&gt; TmpFs -&gt; DynFlags -&gt; UnitState -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Linker.ExtraObj.html#mkExtraObj"><span class="hs-identifier hs-var hs-var">mkExtraObj</span></a></span></span><span> </span><span id="local-6989586621682968011"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682968011"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682968012"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682968012"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682968013"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968013"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682968014"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682968014"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span id="local-6989586621682968015"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968015"><span class="hs-identifier hs-var">extn</span></a></span></span><span> </span><span id="local-6989586621682968016"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968016"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-49"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682968017"><span class="annot"><a href="#local-6989586621682968017"><span class="hs-identifier hs-var">cFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682968011"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682968012"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968013"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968015"><span class="hs-identifier hs-var">extn</span></a></span><span>
</span><span id="line-50"></span><span>      </span><span id="local-6989586621682968021"><span class="annot"><a href="#local-6989586621682968021"><span class="hs-identifier hs-var">oFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-type">newTempName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968011"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968012"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968013"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TFL_GhcSession"><span class="hs-identifier hs-type">TFL_GhcSession</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;o&quot;</span></span><span>
</span><span id="line-51"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">writeFile</span></span><span> </span><span class="annot"><a href="#local-6989586621682968017"><span class="hs-identifier hs-type">cFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968016"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-52"></span><span>      </span><span class="annot"><a href="GHC.SysTools.Tasks.html#runCc"><span class="hs-identifier hs-type">runCc</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682968011"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968012"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968013"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-53"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>        </span><span class="annot"><span class="hs-string">&quot;-c&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>              </span><span class="annot"><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-type">FileOption</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682968017"><span class="hs-identifier hs-type">cFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>              </span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>        </span><span class="annot"><span class="hs-string">&quot;-o&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>              </span><span class="annot"><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-type">FileOption</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682968021"><span class="hs-identifier hs-type">oFile</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-57"></span><span>              </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682968015"><span class="hs-identifier hs-type">extn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><span class="hs-string">&quot;s&quot;</span></span><span>
</span><span id="line-58"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682968028"><span class="hs-identifier hs-type">cOpts</span></a></span><span>
</span><span id="line-59"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682968021"><span class="hs-identifier hs-type">oFile</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-comment">-- Pass a different set of options to the C compiler depending one whether</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-comment">-- we're compiling C or assembler. When compiling C, we pass the usual</span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-comment">-- set of include directories and PIC flags.</span><span>
</span><span id="line-65"></span><span>      </span><span id="local-6989586621682968028"><span class="annot"><span class="annottext">cOpts :: [Option]
</span><a href="#local-6989586621682968028"><span class="hs-identifier hs-var hs-var">cOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#picCCOpts"><span class="hs-identifier hs-var">picCCOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968013"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(ShortText -&gt; Option) -&gt; [ShortText] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-I&quot;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; (ShortText -&gt; String) -&gt; ShortText -&gt; Option
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortText -&gt; String
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#unpack"><span class="hs-identifier hs-var">ST.unpack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo
  PackageId
  PackageName
  UnitId
  ModuleName
  (GenModule (GenUnit UnitId))
-&gt; [ShortText]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [ShortText]
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Unit.Database.html#unitIncludeDirs"><span class="hs-identifier hs-var">unitIncludeDirs</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo
   PackageId
   PackageName
   UnitId
   ModuleName
   (GenModule (GenUnit UnitId))
 -&gt; [ShortText])
-&gt; GenericUnitInfo
     PackageId
     PackageName
     UnitId
     ModuleName
     (GenModule (GenUnit UnitId))
-&gt; [ShortText]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
UnitState
-&gt; GenUnit UnitId
-&gt; GenericUnitInfo
     PackageId
     PackageName
     UnitId
     ModuleName
     (GenModule (GenUnit UnitId))
UnitState
-&gt; GenUnit UnitId
-&gt; GenericUnitInfo
     PackageId
     PackageName
     UnitId
     ModuleName
     (GenModule (GenUnit UnitId))
</span><a href="GHC.Unit.State.html#unsafeLookupUnit"><span class="hs-identifier hs-var">unsafeLookupUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682968014"><span class="hs-identifier hs-var">unit_state</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="GHC.Unit.Types.html#rtsUnit"><span class="hs-identifier hs-var">rtsUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- When linking a binary, we need to create a C main() function that</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- starts everything off.  This used to be compiled statically as part</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- of the RTS, but that made it hard to change the -rtsopts setting,</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- so now we generate and compile a main() stub as part of every</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- binary and pass the -rtsopts setting directly to the RTS (#5373)</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- On Windows, when making a shared library we also may need a DllMain.</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#mkExtraObjToLinkIntoBinary"><span class="hs-identifier hs-type">mkExtraObjToLinkIntoBinary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="mkExtraObjToLinkIntoBinary"><span class="annot"><span class="annottext">mkExtraObjToLinkIntoBinary :: Logger -&gt; TmpFs -&gt; DynFlags -&gt; UnitState -&gt; IO (Maybe String)
</span><a href="GHC.Linker.ExtraObj.html#mkExtraObjToLinkIntoBinary"><span class="hs-identifier hs-var hs-var">mkExtraObjToLinkIntoBinary</span></a></span></span><span> </span><span id="local-6989586621682968035"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682968035"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682968036"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682968036"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682968037"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682968038"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682968038"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_NoHsMain"><span class="hs-identifier hs-var">Opt_NoHsMain</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Linker.ExtraObj.html#haveRtsOptsFlags"><span class="hs-identifier hs-var">haveRtsOptsFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-80"></span><span>     </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#logInfo"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682968035"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PprStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-var">withPprStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="GHC.Utils.Outputable.html#defaultUserStyle"><span class="hs-identifier hs-var">defaultUserStyle</span></a></span><span>
</span><span id="line-81"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Warning: -rtsopts and -with-rtsopts have no effect with -no-hs-main.&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-82"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    Call hs_init_ghc() from your main() function to set these options.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.DynFlags.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-comment">-- Don't try to build the extra object if it is not needed.  Compiling the</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-comment">-- extra object assumes the presence of the RTS in the unit database</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-comment">-- (because the extra object imports Rts.h) but GHC's build system may try</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-comment">-- to build some helper programs before building and registering the RTS!</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-comment">-- See #18938 for an example where hp2ps failed to build because of a failed</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-comment">-- (unsafe) lookup for the RTS in the unit db.</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">GhcLink
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_NoHsMain"><span class="hs-identifier hs-var">Opt_NoHsMain</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-92"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.DynFlags.html#LinkDynLib"><span class="hs-identifier hs-var">LinkDynLib</span></a></span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier hs-var">OSMinGW32</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IO (Maybe String)
</span><a href="#local-6989586621682968053"><span class="hs-identifier hs-var">mk_extra_obj</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682968054"><span class="hs-identifier hs-var">dllMain</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><span class="annottext">GhcLink
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IO (Maybe String)
</span><a href="#local-6989586621682968053"><span class="hs-identifier hs-var">mk_extra_obj</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682968055"><span class="hs-identifier hs-var">exeMain</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621682968053"><span class="annot"><span class="annottext">mk_extra_obj :: SDoc -&gt; IO (Maybe String)
</span><a href="#local-6989586621682968053"><span class="hs-identifier hs-var hs-var">mk_extra_obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe String) -&gt; IO String -&gt; IO (Maybe String)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IO (Maybe String))
-&gt; (SDoc -&gt; IO String) -&gt; SDoc -&gt; IO (Maybe String)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; DynFlags -&gt; UnitState -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Linker.ExtraObj.html#mkExtraObj"><span class="hs-identifier hs-var">mkExtraObj</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682968035"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682968036"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682968038"><span class="hs-identifier hs-var">unit_state</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; (SDoc -&gt; String) -&gt; SDoc -&gt; IO String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; String
</span><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621682968055"><span class="annot"><span class="annottext">exeMain :: SDoc
</span><a href="#local-6989586621682968055"><span class="hs-identifier hs-var hs-var">exeMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#include &lt;Rts.h&gt;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extern StgClosure ZCMain_main_closure;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;int main(int argc, char *argv[])&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'{'</span></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; RtsConfig __conf = defaultRtsConfig;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; __conf.rts_opts_enabled = &quot;</span></span><span>
</span><span id="line-113"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RtsOptsEnabled -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; RtsOptsEnabled
</span><a href="GHC.Driver.DynFlags.html#rtsOptsEnabled"><span class="hs-identifier hs-var">rtsOptsEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; __conf.rts_opts_suggestions = &quot;</span></span><span>
</span><span id="line-115"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#rtsOptsSuggestions"><span class="hs-identifier hs-var">rtsOptsSuggestions</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-116"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;true&quot;</span></span><span>
</span><span id="line-117"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;false&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__conf.keep_cafs = &quot;</span></span><span>
</span><span id="line-119"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepCAFs"><span class="hs-identifier hs-var">Opt_KeepCAFs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-120"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;true&quot;</span></span><span>
</span><span id="line-121"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;false&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.DynFlags.html#rtsOpts"><span class="hs-identifier hs-var">rtsOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968037"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682968067"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968067"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    __conf.rts_opts= &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-125"></span><span>                          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968067"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; __conf.rts_hs_main = true;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; return hs_main(argc,argv,&amp;ZCMain_main_closure,__conf);&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'}'</span></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span> </span><span class="hs-comment">-- final newline, to keep gcc happy</span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621682968054"><span class="annot"><span class="annottext">dllMain :: SDoc
</span><a href="#local-6989586621682968054"><span class="hs-identifier hs-var hs-var">dllMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#include &lt;Rts.h&gt;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#include &lt;windows.h&gt;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#include &lt;stdbool.h&gt;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bool&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WINAPI&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DllMain ( HINSTANCE hInstance STG_UNUSED&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;        , DWORD reason STG_UNUSED&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;        , LPVOID reserved STG_UNUSED&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;        )&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;{&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  return true;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;}&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span> </span><span class="hs-comment">-- final newline, to keep gcc happy</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- Write out the link info section into a new assembly file. Previously</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- this was included as inline assembly in the main.c file but this</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- is pretty fragile. gas gets upset trying to calculate relative offsets</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- that span the .note section (notably .text) when debug info is present</span><span>
</span><span id="line-153"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#mkNoteObjsToLinkIntoBinary"><span class="hs-identifier hs-type">mkNoteObjsToLinkIntoBinary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span id="mkNoteObjsToLinkIntoBinary"><span class="annot"><span class="annottext">mkNoteObjsToLinkIntoBinary :: Logger -&gt; TmpFs -&gt; DynFlags -&gt; UnitEnv -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.Linker.ExtraObj.html#mkNoteObjsToLinkIntoBinary"><span class="hs-identifier hs-var hs-var">mkNoteObjsToLinkIntoBinary</span></a></span></span><span> </span><span id="local-6989586621682968087"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682968087"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682968088"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682968088"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682968089"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968089"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682968090"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968090"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682968091"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682968091"><span class="hs-identifier hs-var">dep_packages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>   </span><span id="local-6989586621682968092"><span class="annot"><a href="#local-6989586621682968092"><span class="hs-identifier hs-var">link_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitEnv -&gt; [UnitId] -&gt; IO String
</span><a href="GHC.Linker.ExtraObj.html#getLinkInfo"><span class="hs-identifier hs-var">getLinkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968089"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968090"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682968091"><span class="hs-identifier hs-var">dep_packages</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>   </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.ExtraObj.html#platformSupportsSavingLinkOpts"><span class="hs-identifier hs-type">platformSupportsSavingLinkOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-type">platformOS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968093"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#mkExtraObj"><span class="hs-identifier hs-type">mkExtraObj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968087"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968088"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968089"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968094"><span class="hs-identifier hs-type">unit_state</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-type">showSDoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968089"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682968095"><span class="hs-identifier hs-type">link_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968092"><span class="hs-identifier hs-type">link_info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621682968094"><span class="annot"><span class="annottext">unit_state :: UnitState
</span><a href="#local-6989586621682968094"><span class="hs-identifier hs-var hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; UnitState
UnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#ue_units"><span class="hs-identifier hs-var">ue_units</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968090"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621682968093"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682968093"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Platform
</span><a href="GHC.Unit.Env.html#ue_platform"><span class="hs-identifier hs-var">ue_platform</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968090"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621682968095"><span class="annot"><span class="annottext">link_opts :: String -&gt; SDoc
</span><a href="#local-6989586621682968095"><span class="hs-identifier hs-var hs-var">link_opts</span></a></span></span><span> </span><span id="local-6989586621682968098"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968098"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- &quot;link info&quot; section (see Note [LinkInfo section])</span><span>
</span><span id="line-166"></span><span>          </span><span class="annot"><span class="annottext">Platform -&gt; String -&gt; String -&gt; Word32 -&gt; String -&gt; SDoc
</span><a href="GHC.SysTools.Elf.html#makeElfNote"><span class="hs-identifier hs-var">makeElfNote</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682968093"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoSectionName"><span class="hs-identifier hs-var">ghcLinkInfoSectionName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoNoteName"><span class="hs-identifier hs-var">ghcLinkInfoNoteName</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968098"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-comment">-- ALL generated assembly must have this section to disable</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-comment">-- executable stacks.  See also</span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-comment">-- &quot;GHC.CmmToAsm&quot; for another instance</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-comment">-- where we need to do this.</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformHasGnuNonexecStack"><span class="hs-identifier hs-var">platformHasGnuNonexecStack</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682968093"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-173"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section .note.GNU-stack,\&quot;\&quot;,&quot;</span></span><span>
</span><span id="line-174"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; String -&gt; SDoc
forall doc. IsLine doc =&gt; Platform -&gt; String -&gt; doc
</span><a href="GHC.Utils.Asm.html#sectionType"><span class="hs-identifier hs-var">sectionType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682968093"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;progbits&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-175"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Return the &quot;link info&quot; string</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- See Note [LinkInfo section]</span><span>
</span><span id="line-181"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#getLinkInfo"><span class="hs-identifier hs-type">getLinkInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-182"></span><span id="getLinkInfo"><span class="annot"><span class="annottext">getLinkInfo :: DynFlags -&gt; UnitEnv -&gt; [UnitId] -&gt; IO String
</span><a href="GHC.Linker.ExtraObj.html#getLinkInfo"><span class="hs-identifier hs-var hs-var">getLinkInfo</span></a></span></span><span> </span><span id="local-6989586621682968103"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682968104"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968104"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682968105"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682968105"><span class="hs-identifier hs-var">dep_packages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621682968106"><span class="annot"><a href="#local-6989586621682968106"><span class="hs-identifier hs-var">package_link_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GhcNameVersion -&gt; Ways -&gt; UnitEnv -&gt; [UnitId] -&gt; IO UnitLinkOpts
</span><a href="GHC.Linker.Unit.html#getUnitLinkOpts"><span class="hs-identifier hs-var">getUnitLinkOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcNameVersion
</span><a href="GHC.Driver.DynFlags.html#ghcNameVersion"><span class="hs-identifier hs-var">ghcNameVersion</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Ways
</span><a href="GHC.Driver.DynFlags.html#ways"><span class="hs-identifier hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968104"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682968105"><span class="hs-identifier hs-var">dep_packages</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621682968110"><span class="annot"><a href="#local-6989586621682968110"><span class="hs-identifier hs-var">pkg_frameworks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#platformUsesFrameworks"><span class="hs-identifier hs-type">platformUsesFrameworks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Env.html#ue_platform"><span class="hs-identifier hs-var">ue_platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968104"><span class="hs-identifier hs-type">unit_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>         </span><span id="local-6989586621682968113"><span class="annot"><a href="#local-6989586621682968113"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-type">mayThrowUnitErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Env.html#preloadUnitsInfo%27"><span class="hs-identifier hs-type">preloadUnitsInfo'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968104"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968105"><span class="hs-identifier hs-type">dep_packages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#collectFrameworks"><span class="hs-identifier hs-type">collectFrameworks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968113"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682968117"><span class="annot"><a href="#local-6989586621682968117"><span class="hs-identifier hs-var hs-var">link_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>             </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UnitLinkOpts
</span><a href="#local-6989586621682968106"><span class="hs-identifier hs-var">package_link_opts</span></a></span><span>
</span><span id="line-191"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682968110"><span class="hs-identifier hs-var">pkg_frameworks</span></a></span><span>
</span><span id="line-192"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.DynFlags.html#rtsOpts"><span class="hs-identifier hs-var">rtsOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-193"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; RtsOptsEnabled
</span><a href="GHC.Driver.DynFlags.html#rtsOptsEnabled"><span class="hs-identifier hs-var">rtsOptsEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-194"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_NoHsMain"><span class="hs-identifier hs-var">Opt_NoHsMain</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-195"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Option -&gt; String) -&gt; [Option] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Option -&gt; String
</span><a href="GHC.Utils.CliOption.html#showOpt"><span class="hs-identifier hs-var">showOpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [Option]
</span><a href="GHC.Driver.DynFlags.html#ldInputs"><span class="hs-identifier hs-var">ldInputs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968103"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_l"><span class="hs-identifier hs-var">opt_l</span></a></span><span>
</span><span id="line-197"></span><span>             </span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682968117"><span class="hs-identifier hs-type">link_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#platformSupportsSavingLinkOpts"><span class="hs-identifier hs-type">platformSupportsSavingLinkOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OS</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-201"></span><span id="platformSupportsSavingLinkOpts"><span class="annot"><span class="annottext">platformSupportsSavingLinkOpts :: OS -&gt; Bool
</span><a href="GHC.Linker.ExtraObj.html#platformSupportsSavingLinkOpts"><span class="hs-identifier hs-var hs-var">platformSupportsSavingLinkOpts</span></a></span></span><span> </span><span id="local-6989586621682968122"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621682968122"><span class="hs-identifier hs-var">os</span></a></span></span><span>
</span><span id="line-202"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621682968122"><span class="hs-identifier hs-var">os</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier hs-var">OSSolaris2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- see #5382</span><span>
</span><span id="line-203"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><span class="hs-identifier hs-var">osElfTarget</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621682968122"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- See Note [LinkInfo section]</span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoSectionName"><span class="hs-identifier hs-type">ghcLinkInfoSectionName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-207"></span><span id="ghcLinkInfoSectionName"><span class="annot"><span class="annottext">ghcLinkInfoSectionName :: String
</span><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoSectionName"><span class="hs-identifier hs-var hs-var">ghcLinkInfoSectionName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.debug-ghc-link-info&quot;</span></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-comment">-- if we use the &quot;.debug&quot; prefix, then strip will strip it by default</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Identifier for the note (see Note [LinkInfo section])</span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoNoteName"><span class="hs-identifier hs-type">ghcLinkInfoNoteName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-212"></span><span id="ghcLinkInfoNoteName"><span class="annot"><span class="annottext">ghcLinkInfoNoteName :: String
</span><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoNoteName"><span class="hs-identifier hs-var hs-var">ghcLinkInfoNoteName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC link info&quot;</span></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- Returns 'False' if it was, and we can avoid linking, because the</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- previous binary was linked with &quot;the same options&quot;.</span><span>
</span><span id="line-216"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#checkLinkInfo"><span class="hs-identifier hs-type">checkLinkInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-217"></span><span id="checkLinkInfo"><span class="annot"><span class="annottext">checkLinkInfo :: Logger -&gt; DynFlags -&gt; UnitEnv -&gt; [UnitId] -&gt; String -&gt; IO Bool
</span><a href="GHC.Linker.ExtraObj.html#checkLinkInfo"><span class="hs-identifier hs-var hs-var">checkLinkInfo</span></a></span></span><span> </span><span id="local-6989586621682968125"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682968125"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682968126"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968126"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682968127"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968127"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682968128"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682968128"><span class="hs-identifier hs-var">pkg_deps</span></a></span></span><span> </span><span id="local-6989586621682968129"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968129"><span class="hs-identifier hs-var">exe_file</span></a></span></span><span>
</span><span id="line-218"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Linker.ExtraObj.html#platformSupportsSavingLinkOpts"><span class="hs-identifier hs-var">platformSupportsSavingLinkOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; Platform
</span><a href="GHC.Unit.Env.html#ue_platform"><span class="hs-identifier hs-var">ue_platform</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968127"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span> </span><span class="hs-comment">-- ToDo: Windows and OS X do not use the ELF binary format, so</span><span>
</span><span id="line-220"></span><span> </span><span class="hs-comment">-- readelf does not work there.  We need to find another way to do</span><span>
</span><span id="line-221"></span><span> </span><span class="hs-comment">-- this.</span><span>
</span><span id="line-222"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- conservatively we should return True, but not</span><span>
</span><span id="line-223"></span><span>                </span><span class="hs-comment">-- linking in this case was the behaviour for a long</span><span>
</span><span id="line-224"></span><span>                </span><span class="hs-comment">-- time so we leave it as-is.</span><span>
</span><span id="line-225"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-226"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>   </span><span id="local-6989586621682968130"><span class="annot"><a href="#local-6989586621682968130"><span class="hs-identifier hs-var">link_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitEnv -&gt; [UnitId] -&gt; IO String
</span><a href="GHC.Linker.ExtraObj.html#getLinkInfo"><span class="hs-identifier hs-var">getLinkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968126"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682968127"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682968128"><span class="hs-identifier hs-var">pkg_deps</span></a></span><span>
</span><span id="line-228"></span><span>   </span><span class="annot"><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-type">debugTraceMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968125"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Link info: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682968130"><span class="hs-identifier hs-type">link_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>   </span><span id="local-6989586621682968132"><span class="annot"><a href="#local-6989586621682968132"><span class="hs-identifier hs-var">m_exe_link_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.SysTools.Elf.html#readElfNoteAsString"><span class="hs-identifier hs-type">readElfNoteAsString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968125"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968129"><span class="hs-identifier hs-type">exe_file</span></a></span><span>
</span><span id="line-230"></span><span>                          </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoSectionName"><span class="hs-identifier hs-type">ghcLinkInfoSectionName</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html#ghcLinkInfoNoteName"><span class="hs-identifier hs-type">ghcLinkInfoNoteName</span></a></span><span>
</span><span id="line-231"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682968134"><span class="annot"><a href="#local-6989586621682968134"><span class="hs-identifier hs-var hs-var">sameLinkInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968130"><span class="hs-identifier hs-var">link_info</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Maybe String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682968132"><span class="hs-identifier hs-var">m_exe_link_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>   </span><span class="annot"><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-type">debugTraceMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682968125"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682968132"><span class="hs-identifier hs-type">m_exe_link_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-233"></span><span>     </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Exe link info: Not found&quot;</span></span><span>
</span><span id="line-234"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682968135"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968135"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682968134"><span class="hs-identifier hs-var">sameLinkInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Exe link info is the same&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Exe link info is different: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682968135"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682968134"><span class="hs-identifier hs-type">sameLinkInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">{- Note [LinkInfo section]
   ~~~~~~~~~~~~~~~~~~~~~~~

The &quot;link info&quot; is a string representing the parameters of the link. We save
this information in the binary, and the next time we link, if nothing else has
changed, we use the link info stored in the existing binary to decide whether
to re-link or not.

The &quot;link info&quot; string is stored in a ELF section called &quot;.debug-ghc-link-info&quot;
(see ghcLinkInfoSectionName) with the SHT_NOTE type.  For some time, it used to
not follow the specified record-based format (see #11022).

-}</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><a href="GHC.Linker.ExtraObj.html#haveRtsOptsFlags"><span class="hs-identifier hs-type">haveRtsOptsFlags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-254"></span><span id="haveRtsOptsFlags"><span class="annot"><span class="annottext">haveRtsOptsFlags :: DynFlags -&gt; Bool
</span><a href="GHC.Linker.ExtraObj.html#haveRtsOptsFlags"><span class="hs-identifier hs-var hs-var">haveRtsOptsFlags</span></a></span></span><span> </span><span id="local-6989586621682968136"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968136"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">Maybe String -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.DynFlags.html#rtsOpts"><span class="hs-identifier hs-var">rtsOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968136"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; RtsOptsEnabled
</span><a href="GHC.Driver.DynFlags.html#rtsOptsEnabled"><span class="hs-identifier hs-var">rtsOptsEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682968136"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-256"></span><span>                                       </span><span class="annot"><span class="annottext">RtsOptsEnabled
</span><a href="GHC.Driver.DynFlags.html#RtsOptsSafeOnly"><span class="hs-identifier hs-var">RtsOptsSafeOnly</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-257"></span><span>                                       </span><span class="annot"><span class="annottext">RtsOptsEnabled
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-258"></span></pre></body></html>