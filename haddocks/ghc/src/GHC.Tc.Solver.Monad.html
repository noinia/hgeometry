<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="annot"><span class="hs-comment">-- | Monadic definitions for the constraint solver</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html"><span class="hs-identifier">GHC.Tc.Solver.Monad</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-comment">-- The TcS monad</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier">TcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcS"><span class="hs-identifier">runTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSEarlyAbort"><span class="hs-identifier">runTcSEarlyAbort</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier">runTcSWithEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSInerts"><span class="hs-identifier">runTcSInerts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#failTcS"><span class="hs-identifier">failTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#warnTcS"><span class="hs-identifier">warnTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addErrTcS"><span class="hs-identifier">addErrTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier">wrapTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#ctLocWarnTcS"><span class="hs-identifier">ctLocWarnTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSEqualities"><span class="hs-identifier">runTcSEqualities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestTcS"><span class="hs-identifier">nestTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestImplicTcS"><span class="hs-identifier">nestImplicTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindsTcS"><span class="hs-identifier">setEvBindsTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier">emitImplicationTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitTvImplicationTcS"><span class="hs-identifier">emitTvImplicationTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitFunDepWanteds"><span class="hs-identifier">emitFunDepWanteds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#selectNextWorkItem"><span class="hs-identifier">selectNextWorkItem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getWorkList"><span class="hs-identifier">getWorkList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier">updWorkListTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier">pushLevelNoWorkList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcPluginTcS"><span class="hs-identifier">runTcPluginTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#recordUsedGREs"><span class="hs-identifier">recordUsedGREs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchGlobalInst"><span class="hs-identifier">matchGlobalInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier">TcM.ClsInstResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier">QCInst</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-comment">-- The pipeline</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier">StopOrContinue</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier">continueWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#stopWith"><span class="hs-identifier">stopWith</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#startAgainWith"><span class="hs-identifier">startAgainWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier">SolverStage</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier">Stage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runSolverStage"><span class="hs-identifier">runSolverStage</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#simpleStage"><span class="hs-identifier">simpleStage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#stopWithStage"><span class="hs-identifier">stopWithStage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nopStage"><span class="hs-identifier">nopStage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-comment">-- Tracing etc</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#panicTcS"><span class="hs-identifier">panicTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier">traceTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tryEarlyAbortTcS"><span class="hs-identifier">tryEarlyAbortTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-identifier">traceFireTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#bumpStepCountTcS"><span class="hs-identifier">bumpStepCountTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier">csTraceTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier">wrapErrTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapWarnTcS"><span class="hs-identifier">wrapWarnTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#resetUnificationFlag"><span class="hs-identifier">resetUnificationFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setUnificationFlag"><span class="hs-identifier">setUnificationFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-comment">-- Evidence creation and transformation</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier">MaybeNew</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#freshGoals"><span class="hs-identifier">freshGoals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier">isFresh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier">getEvExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier">CanonicalEvidence</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcEvBinds"><span class="hs-identifier">newTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newNoTcEvBinds"><span class="hs-identifier">newNoTcEvBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier">newWantedEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier">emitNewWantedEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier">newWanted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedNC"><span class="hs-identifier">newWantedNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier">newWantedEvVarNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier">newBoundEvVarId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyTyVar"><span class="hs-identifier">unifyTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#reportUnifications"><span class="hs-identifier">reportUnifications</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier">setEvBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier">setWantedEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier">setWantedEvTerm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier">setEvBindIfWanted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier">newEvVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier">newGivenEvVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewGivens"><span class="hs-identifier">emitNewGivens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkReductionDepth"><span class="hs-identifier">checkReductionDepth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSolvedDicts"><span class="hs-identifier">getSolvedDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setSolvedDicts"><span class="hs-identifier">setSolvedDicts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInstEnvs"><span class="hs-identifier">getInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getFamInstEnvs"><span class="hs-identifier">getFamInstEnvs</span></a></span><span class="hs-special">,</span><span>                </span><span class="hs-comment">-- Getting the environments</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTopEnv"><span class="hs-identifier">getTopEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier">getGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getLclEnv"><span class="hs-identifier">getLclEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setSrcSpan"><span class="hs-identifier">setSrcSpan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier">getTcEvBindsVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier">getTcLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvTyCoVars"><span class="hs-identifier">getTcEvTyCoVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsMap"><span class="hs-identifier">getTcEvBindsMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setTcEvBindsMap"><span class="hs-identifier">setTcEvBindsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupClass"><span class="hs-identifier">tcLookupClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupId"><span class="hs-identifier">tcLookupId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupTyCon"><span class="hs-identifier">tcLookupTyCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-comment">-- Inerts</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier">updInertSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier">updInertCans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getHasGivenEqs"><span class="hs-identifier">getHasGivenEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier">setInertCans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertEqs"><span class="hs-identifier">getInertEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier">getInertCans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier">getInertGivens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertInsols"><span class="hs-identifier">getInertInsols</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInnermostGivenEqLevel"><span class="hs-identifier">getInnermostGivenEqLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier">getInertSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertSet"><span class="hs-identifier">setInertSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getUnsolvedInerts"><span class="hs-identifier">getUnsolvedInerts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#removeInertCts"><span class="hs-identifier">removeInertCts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getPendingGivenScs"><span class="hs-identifier">getPendingGivenScs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#insertFunEq"><span class="hs-identifier">insertFunEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier">addInertForAll</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier">emitWorkNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier">emitWork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier">lookupInertDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- The Model</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier">kickOutAfterUnification</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier">kickOutRewritable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-comment">-- Inert Safe Haskell safe-overlap failures</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier">addInertSafehask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier">insertSafeOverlapFailureTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSafehask"><span class="hs-identifier">updInertSafehask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSafeOverlapFailures"><span class="hs-identifier">getSafeOverlapFailures</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-comment">-- Inert solved dictionaries</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updSolvedDicts"><span class="hs-identifier">updSolvedDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier">lookupSolvedDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-comment">-- Irreds</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#foldIrreds"><span class="hs-identifier">foldIrreds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-comment">-- The family application cache</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppInert"><span class="hs-identifier">lookupFamAppInert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppCache"><span class="hs-identifier">lookupFamAppCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendFamAppCache"><span class="hs-identifier">extendFamAppCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier">pprKicked</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-comment">-- Instantiation</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instDFunType"><span class="hs-identifier">instDFunType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-comment">-- Unification</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapUnifierTcS"><span class="hs-identifier">wrapUnifierTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyFunDeps"><span class="hs-identifier">unifyFunDeps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#uPairsTcM"><span class="hs-identifier">uPairsTcM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyForAllBody"><span class="hs-identifier">unifyForAllBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- MetaTyVars</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newFlexiTcSTy"><span class="hs-identifier">newFlexiTcSTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiX"><span class="hs-identifier">instFlexiX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#cloneMetaTyVar"><span class="hs-identifier">cloneMetaTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier">tcInstSkolTyVarsX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier">TcLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier">isFilledMetaTyVar_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar"><span class="hs-identifier">isFilledMetaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isUnfilledMetaTyVar"><span class="hs-identifier">isUnfilledMetaTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFV"><span class="hs-identifier">zonkTyCoVarsAndFV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcType"><span class="hs-identifier">zonkTcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTypes"><span class="hs-identifier">zonkTcTypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTyVar"><span class="hs-identifier">zonkTcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkCo"><span class="hs-identifier">zonkCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFVList"><span class="hs-identifier">zonkTyCoVarsAndFVList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkSimples"><span class="hs-identifier">zonkSimples</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkWC"><span class="hs-identifier">zonkWC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarKind"><span class="hs-identifier">zonkTyCoVarKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- References</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcRef"><span class="hs-identifier">newTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier">readTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier">writeTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier">updTcRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- Misc</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getDefaultInfo"><span class="hs-identifier">getDefaultInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier">getGlobalRdrEnvTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFam"><span class="hs-identifier">matchFam</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier">matchFamTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkWellStagedDFun"><span class="hs-identifier">checkWellStagedDFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprEq"><span class="hs-identifier">pprEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-comment">-- Enforcing invariants for type equalities</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkTypeEq"><span class="hs-identifier">checkTypeEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkTouchableTyVarEq"><span class="hs-identifier">checkTouchableTyVarEq</span></a></span><span>
</span><span id="line-126"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FamInst</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html"><span class="hs-identifier">GHC.Tc.Instance.Class</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchGlobalInst"><span class="hs-identifier">matchGlobalInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier">ClsInstResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-141"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#checkWellStaged"><span class="hs-identifier">checkWellStaged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcGetDefaultTys"><span class="hs-identifier">tcGetDefaultTys</span></a></span><span>
</span><span id="line-142"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier">tcLookupClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier">tcLookupId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier">tcLookupTyCon</span></a></span><span>
</span><span id="line-143"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#topIdLvl"><span class="hs-identifier">topIdLvl</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html"><span class="hs-identifier">GHC.Tc.Zonk.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier">ZonkM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html"><span class="hs-identifier">GHC.Tc.Zonk.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html"><span class="hs-identifier">GHC.Tc.Instance.Class</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier">safeOverlap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier">instanceReturnsDictCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.FunDeps.html"><span class="hs-identifier">GHC.Tc.Instance.FunDeps</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.FunDeps.html#FunDepEqn"><span class="hs-identifier">FunDepEqn</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html"><span class="hs-identifier">GHC.Tc.Solver.Types</span></a></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html"><span class="hs-identifier">GHC.Tc.Solver.InertSet</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html"><span class="hs-identifier">GHC.Tc.Types.CtLoc</span></a></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#unsatisfiableClassNameKey"><span class="hs-identifier">unsatisfiableClassNameKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rep</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#TypeEqn"><span class="hs-identifier">TypeEqn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html"><span class="hs-identifier">GHC.Core.Reduction</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html"><span class="hs-identifier">GHC.Types.DefaultEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier">DefaultEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-identifier">elementOfUniqSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#HasModule"><span class="hs-identifier">HasModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier">getModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#extractModule"><span class="hs-identifier">extractModule</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-192"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-193"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier">HasDebugCallStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bag</span></span><span>
</span><span id="line-196"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html"><span class="hs-identifier">GHC.Data.Pair</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">oneShot</span></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-202"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-203"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-205"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-206"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-207"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span class="hs-cpp">

#if defined(DEBUG)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Types.Unique.Set</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nonDetEltsUniqSet</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Data.Graph.Directed</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-214"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
               SolverStage and StopOrContinue
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">{- Note [The SolverStage monad]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The SolverStage monad allows us to write simple code like that in
GHC.Tc.Solver.solveEquality.   At the time of writing it looked like
this (may get out of date but the idea is clear):

solveEquality :: ... -&gt; SolverStage Void
solveEquality ev eq_rel ty1 ty2
  = do { Pair ty1' ty2' &lt;- zonkEqTypes ev eq_rel ty1 ty2
       ; mb_canon &lt;- canonicaliseEquality ev' eq_rel ty1' ty2'
       ; case mb_canon of {
            Left irred_ct -&gt; do { tryQCsIrredEqCt irred_ct
                                ; solveIrred irred_ct } ;
            Right eq_ct   -&gt; do { tryInertEqs eq_ct
                                ; tryFunDeps  eq_ct
                                ; tryQCsEqCt  eq_ct
                                ; simpleStage (updInertEqs eq_ct)
                                ; stopWithStage (eqCtEvidence eq_ct) &quot;..&quot; }}}

Each sub-stage can elect to
  (a) ContinueWith: continue to the next stasge
  (b) StartAgain:   start again at the beginning of the pipeline
  (c) Stop:         stop altogether; constraint is solved

These three possiblities are described by the `StopOrContinue` data type.
The `SolverStage` monad does the plumbing.

Notes:

(SM1) Each individual stage pretty quickly drops down into
         TcS (StopOrContinue a)
    because the monadic plumbing of `SolverStage` is relatively ineffienct,
    with that three-way split.

(SM2) We use `SolverStage Void` to express the idea that ContinueWith is
    impossible; we don't need to pattern match on it as a possible outcome:A
    see GHC.Tc.Solver.Solve.solveOne.   To that end, ContinueWith is strict.
-}</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-keyword">data</span><span> </span><span id="StopOrContinue"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-var">StopOrContinue</span></a></span></span><span> </span><span id="local-6989586621683037318"><span class="annot"><a href="#local-6989586621683037318"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="StartAgain"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StartAgain"><span class="hs-identifier hs-var">StartAgain</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>     </span><span class="hs-comment">-- Constraint is not solved, but some unifications</span><span>
</span><span id="line-261"></span><span>                      </span><span class="hs-comment">--   happened, so go back to the beginning of the pipeline</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ContinueWith"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#ContinueWith"><span class="hs-identifier hs-var">ContinueWith</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621683037318"><span class="hs-identifier hs-type">a</span></a></span><span>   </span><span class="hs-comment">-- The constraint was not solved, although it may have</span><span>
</span><span id="line-264"></span><span>                      </span><span class="hs-comment">--   been rewritten.  It is strict so that</span><span>
</span><span id="line-265"></span><span>                      </span><span class="hs-comment">--   ContinueWith Void can't happen; see (SM2) in</span><span>
</span><span id="line-266"></span><span>                      </span><span class="hs-comment">--   Note [The SolverStage monad]</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Stop"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>   </span><span class="hs-comment">-- The (rewritten) constraint was solved</span><span>
</span><span id="line-269"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>         </span><span class="hs-comment">-- Tells how it was solved</span><span>
</span><span id="line-270"></span><span>                      </span><span class="hs-comment">-- Any new sub-goals have been put on the work list</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683038313"><span id="local-6989586621683038315"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b)
-&gt; (forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a)
-&gt; Functor StopOrContinue
forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a
forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b
fmap :: forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b
$c&lt;$ :: forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a
&lt;$ :: forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683037297"><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037297"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037297"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>  </span><span id="local-6989586621683038336"><span class="annot"><span class="annottext">ppr :: StopOrContinue a -&gt; SDoc
</span><a href="#local-6989586621683038336"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Stop"><span class="hs-identifier hs-type">Stop</span></a></span><span> </span><span id="local-6989586621683038338"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038338"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683038339"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038339"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Stop&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038339"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ev:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038338"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#ContinueWith"><span class="hs-identifier hs-type">ContinueWith</span></a></span><span> </span><span id="local-6989586621683038345"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038345"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ContinueWith&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038345"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StartAgain"><span class="hs-identifier hs-type">StartAgain</span></a></span><span> </span><span id="local-6989586621683038346"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038346"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;StartAgain&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038346"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-keyword">newtype</span><span> </span><span id="SolverStage"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-var">SolverStage</span></a></span></span><span> </span><span id="local-6989586621683037301"><span class="annot"><a href="#local-6989586621683037301"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stage"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="runSolverStage"><span class="annot"><span class="annottext">forall a. SolverStage a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#runSolverStage"><span class="hs-identifier hs-var hs-var">runSolverStage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037301"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span id="local-6989586621683038348"><span id="local-6989586621683038352"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; SolverStage a -&gt; SolverStage b)
-&gt; (forall a b. a -&gt; SolverStage b -&gt; SolverStage a)
-&gt; Functor SolverStage
forall a b. a -&gt; SolverStage b -&gt; SolverStage a
forall a b. (a -&gt; b) -&gt; SolverStage a -&gt; SolverStage b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; SolverStage a -&gt; SolverStage b
fmap :: forall a b. (a -&gt; b) -&gt; SolverStage a -&gt; SolverStage b
$c&lt;$ :: forall a b. a -&gt; SolverStage b -&gt; SolverStage a
&lt;$ :: forall a b. a -&gt; SolverStage b -&gt; SolverStage a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683038361"><span id="local-6989586621683038365"><span id="local-6989586621683038368"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-282"></span><span>  </span><span id="local-6989586621683038372"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; SolverStage a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621683038373"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038373"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue a) -&gt; SolverStage a
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StopOrContinue a -&gt; TcS (StopOrContinue a)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; StopOrContinue a
forall a. a -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Monad.html#ContinueWith"><span class="hs-identifier hs-var">ContinueWith</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038373"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621683038376"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. SolverStage (a -&gt; b) -&gt; SolverStage a -&gt; SolverStage b
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SolverStage (a -&gt; b) -&gt; SolverStage a -&gt; SolverStage b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683038382"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-286"></span><span>  </span><span id="local-6989586621683038387"><span class="annot"><span class="annottext">return :: forall a. a -&gt; SolverStage a
</span><span class="hs-identifier hs-var hs-var hs-var">return</span></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SolverStage a
forall a. a -&gt; SolverStage a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-type">Stage</span></a></span><span> </span><span id="local-6989586621683038391"><span class="annot"><span class="annottext">TcS (StopOrContinue a)
</span><a href="#local-6989586621683038391"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683038392"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. SolverStage a -&gt; (a -&gt; SolverStage b) -&gt; SolverStage b
</span><span class="hs-operator hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621683038393"><span class="annot"><span class="annottext">a -&gt; SolverStage b
</span><a href="#local-6989586621683038393"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue b) -&gt; SolverStage b
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue b) -&gt; SolverStage b)
-&gt; TcS (StopOrContinue b) -&gt; SolverStage b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-288"></span><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038394"><span class="annot"><a href="#local-6989586621683038394"><span class="hs-identifier hs-var">soc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue a)
</span><a href="#local-6989586621683038391"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-289"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683038394"><span class="hs-identifier hs-type">soc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StartAgain"><span class="hs-identifier hs-type">StartAgain</span></a></span><span> </span><span id="local-6989586621683038395"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038395"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StopOrContinue b -&gt; TcS (StopOrContinue b)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; StopOrContinue b
forall a. Ct -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Monad.html#StartAgain"><span class="hs-identifier hs-var">StartAgain</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038395"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Stop"><span class="hs-identifier hs-type">Stop</span></a></span><span> </span><span id="local-6989586621683038396"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038396"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683038397"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038397"><span class="hs-identifier hs-var">d</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StopOrContinue b -&gt; TcS (StopOrContinue b)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc -&gt; StopOrContinue b
forall a. CtEvidence -&gt; SDoc -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Monad.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038396"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038397"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#ContinueWith"><span class="hs-identifier hs-type">ContinueWith</span></a></span><span> </span><span id="local-6989586621683038398"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038398"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SolverStage b -&gt; TcS (StopOrContinue b)
forall a. SolverStage a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#runSolverStage"><span class="hs-identifier hs-var">runSolverStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SolverStage b
</span><a href="#local-6989586621683038393"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038398"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span id="local-6989586621683038399"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nopStage"><span class="hs-identifier hs-type">nopStage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621683038399"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038399"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-295"></span><span id="nopStage"><span class="annot"><span class="annottext">nopStage :: forall a. a -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#nopStage"><span class="hs-identifier hs-var hs-var">nopStage</span></a></span></span><span> </span><span id="local-6989586621683038400"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038400"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue a) -&gt; SolverStage a
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcS (StopOrContinue a)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038400"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span id="local-6989586621683037337"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#simpleStage"><span class="hs-identifier hs-type">simpleStage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037337"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037337"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-298"></span><span class="hs-comment">-- Always does a ContinueWith; no Stop or StartAgain</span><span>
</span><span id="line-299"></span><span id="simpleStage"><span class="annot"><span class="annottext">simpleStage :: forall a. TcS a -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#simpleStage"><span class="hs-identifier hs-var hs-var">simpleStage</span></a></span></span><span> </span><span id="local-6989586621683038402"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038402"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue a) -&gt; SolverStage a
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038403"><span class="annot"><a href="#local-6989586621683038403"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038402"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier hs-type">continueWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038403"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621683037339"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#startAgainWith"><span class="hs-identifier hs-type">startAgainWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037339"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-302"></span><span id="startAgainWith"><span class="annot"><span class="annottext">startAgainWith :: forall a. Ct -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#startAgainWith"><span class="hs-identifier hs-var hs-var">startAgainWith</span></a></span></span><span> </span><span id="local-6989586621683038405"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038405"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StopOrContinue a -&gt; TcS (StopOrContinue a)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; StopOrContinue a
forall a. Ct -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Monad.html#StartAgain"><span class="hs-identifier hs-var">StartAgain</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038405"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="local-6989586621683037336"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier hs-type">continueWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621683037336"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037336"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-305"></span><span id="continueWith"><span class="annot"><span class="annottext">continueWith :: forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#continueWith"><span class="hs-identifier hs-var hs-var">continueWith</span></a></span></span><span> </span><span id="local-6989586621683038407"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038407"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StopOrContinue a -&gt; TcS (StopOrContinue a)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; StopOrContinue a
forall a. a -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Monad.html#ContinueWith"><span class="hs-identifier hs-var">ContinueWith</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038407"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span id="local-6989586621683037342"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#stopWith"><span class="hs-identifier hs-type">stopWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037342"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-308"></span><span id="stopWith"><span class="annot"><span class="annottext">stopWith :: forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#stopWith"><span class="hs-identifier hs-var hs-var">stopWith</span></a></span></span><span> </span><span id="local-6989586621683038410"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038410"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683038411"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038411"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StopOrContinue a -&gt; TcS (StopOrContinue a)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc -&gt; StopOrContinue a
forall a. CtEvidence -&gt; SDoc -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Monad.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038410"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038411"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span id="local-6989586621683037344"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#stopWithStage"><span class="hs-identifier hs-type">stopWithStage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#SolverStage"><span class="hs-identifier hs-type">SolverStage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037344"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-311"></span><span id="stopWithStage"><span class="annot"><span class="annottext">stopWithStage :: forall a. CtEvidence -&gt; String -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#stopWithStage"><span class="hs-identifier hs-var hs-var">stopWithStage</span></a></span></span><span> </span><span id="local-6989586621683038412"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038412"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683038413"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038413"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue a) -&gt; SolverStage a
forall a. TcS (StopOrContinue a) -&gt; SolverStage a
</span><a href="GHC.Tc.Solver.Monad.html#Stage"><span class="hs-identifier hs-var">Stage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Monad.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038412"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038413"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Inert instances: inert_insts
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier hs-type">addInertForAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- Add a local Given instance, typically arising from a type signature</span><span>
</span><span id="line-322"></span><span id="addInertForAll"><span class="annot"><span class="annottext">addInertForAll :: QCInst -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier hs-var hs-var">addInertForAll</span></a></span></span><span> </span><span id="local-6989586621683038414"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038414"><span class="hs-identifier hs-var">new_qci</span></a></span></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038415"><span class="annot"><a href="#local-6989586621683038415"><span class="hs-identifier hs-var">ics</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-324"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038416"><span class="annot"><a href="#local-6989586621683038416"><span class="hs-identifier hs-var">ics1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683038417"><span class="hs-identifier hs-type">add_qci</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038415"><span class="hs-identifier hs-type">ics</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>       </span><span class="hs-comment">-- Update given equalities. C.f updateGivenEqs</span><span>
</span><span id="line-327"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038418"><span class="annot"><a href="#local-6989586621683038418"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-328"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038419"><span class="annot"><a href="#local-6989586621683038419"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#qci_pred"><span class="hs-identifier hs-var">qci_pred</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038414"><span class="hs-identifier hs-var">new_qci</span></a></span><span>
</span><span id="line-329"></span><span>             </span><span id="local-6989586621683038421"><span class="annot"><a href="#local-6989586621683038421"><span class="hs-identifier hs-var hs-var">not_equality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isClassPred"><span class="hs-identifier hs-var">isClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683038419"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqPred"><span class="hs-identifier hs-var">isEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683038419"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>                  </span><span class="hs-comment">-- True &lt;=&gt; definitely not an equality</span><span>
</span><span id="line-331"></span><span>                  </span><span class="hs-comment">-- A qci_pred like (f a) might be an equality</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>             </span><span id="local-6989586621683038426"><span class="annot"><a href="#local-6989586621683038426"><span class="hs-identifier hs-var hs-var">ics2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683038421"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038416"><span class="hs-identifier hs-var">ics1</span></a></span><span>
</span><span id="line-334"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038416"><span class="hs-identifier hs-var">ics1</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038418"><span class="hs-identifier hs-type">tclvl</span></a></span><span>
</span><span id="line-335"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-type">setInertCans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038426"><span class="hs-identifier hs-type">ics2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><a href="#local-6989586621683038417"><span class="hs-identifier hs-type">add_qci</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- See Note [Do not add duplicate quantified instances]</span><span>
</span><span id="line-341"></span><span>    </span><span id="local-6989586621683038417"><span class="annot"><span class="annottext">add_qci :: InertCans -&gt; TcS InertCans
</span><a href="#local-6989586621683038417"><span class="hs-identifier hs-var hs-var">add_qci</span></a></span></span><span> </span><span id="local-6989586621683038429"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621683038429"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038432"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621683038432"><span class="hs-identifier hs-var">qcis</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(QCInst -&gt; Bool) -&gt; [QCInst] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Bool
</span><a href="#local-6989586621683038434"><span class="hs-identifier hs-var">same_qci</span></a></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621683038432"><span class="hs-identifier hs-var">qcis</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;skipping duplicate quantified instance&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038414"><span class="hs-identifier hs-var">new_qci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcS InertCans
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038429"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;adding new inert quantified instance&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038414"><span class="hs-identifier hs-var">new_qci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcS InertCans
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038429"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038414"><span class="hs-identifier hs-type">new_qci</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683038432"><span class="hs-identifier hs-type">qcis</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621683038434"><span class="annot"><span class="annottext">same_qci :: QCInst -&gt; Bool
</span><a href="#local-6989586621683038434"><span class="hs-identifier hs-var hs-var">same_qci</span></a></span></span><span> </span><span id="local-6989586621683038435"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038435"><span class="hs-identifier hs-var">old_qci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038435"><span class="hs-identifier hs-var">old_qci</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038414"><span class="hs-identifier hs-var">new_qci</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">{- Note [Do not add duplicate quantified instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As an optimisation, we avoid adding duplicate quantified instances to the
inert set; we use a simple duplicate check using tcEqType for simplicity,
even though it doesn't account for superficial differences, e.g. it will count
the following two constraints as different (#22223):

  - forall a b. C a b
  - forall b a. C a b

The main logic that allows us to pick local instances, even in the presence of
duplicates, is explained in Note [Use only the best matching quantified constraint]
in GHC.Tc.Solver.Dict.
-}</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                  Kicking out
*                                                                      *
************************************************************************
-}</span></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-----------------------------------------</span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier hs-type">kickOutRewritable</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KickOutSpec"><span class="hs-identifier hs-type">KickOutSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span id="kickOutRewritable"><span class="annot"><span class="annottext">kickOutRewritable :: KickOutSpec -&gt; CtFlavourRole -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier hs-var hs-var">kickOutRewritable</span></a></span></span><span> </span><span id="local-6989586621683038439"><span class="annot"><span class="annottext">KickOutSpec
</span><a href="#local-6989586621683038439"><span class="hs-identifier hs-var">ko_spec</span></a></span></span><span> </span><span id="local-6989586621683038440"><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621683038440"><span class="hs-identifier hs-var">new_fr</span></a></span></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038441"><span class="annot"><a href="#local-6989586621683038441"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-380"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683038442"><span class="annot"><a href="#local-6989586621683038442"><span class="hs-identifier hs-var">kicked_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683038443"><span class="annot"><a href="#local-6989586621683038443"><span class="hs-identifier hs-var">ics'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#kickOutRewritableLHS"><span class="hs-identifier hs-type">kickOutRewritableLHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038439"><span class="hs-identifier hs-type">ko_spec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038440"><span class="hs-identifier hs-type">new_fr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038441"><span class="hs-identifier hs-type">ics</span></a></span><span>
</span><span id="line-381"></span><span>             </span><span id="local-6989586621683038445"><span class="annot"><a href="#local-6989586621683038445"><span class="hs-identifier hs-var hs-var">n_kicked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; Int
forall a. Bag a -&gt; Int
</span><a href="GHC.Data.Bag.html#lengthBag"><span class="hs-identifier hs-var">lengthBag</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683038442"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-382"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-type">setInertCans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038443"><span class="hs-identifier hs-type">ics'</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-type">isEmptyBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038442"><span class="hs-identifier hs-type">kicked_out</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-385"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-type">emitWork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038442"><span class="hs-identifier hs-type">kicked_out</span></a></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>              </span><span class="hs-comment">-- The famapp-cache contains Given evidence from the inert set.</span><span>
</span><span id="line-388"></span><span>              </span><span class="hs-comment">-- If we're kicking out Givens, we need to remove this evidence</span><span>
</span><span id="line-389"></span><span>              </span><span class="hs-comment">-- from the cache, too.</span><span>
</span><span id="line-390"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038449"><span class="annot"><a href="#local-6989586621683038449"><span class="hs-identifier hs-var hs-var">kicked_given_ev_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; VarSet -&gt; VarSet) -&gt; VarSet -&gt; Cts -&gt; VarSet
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Bag a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; VarSet -&gt; VarSet
</span><a href="#local-6989586621683038451"><span class="hs-identifier hs-var">add_one</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683038442"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-391"></span><span>                  </span><span class="annot"><a href="#local-6989586621683038451"><span class="hs-identifier hs-type">add_one</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span>
</span><span id="line-392"></span><span>                  </span><span id="local-6989586621683038451"><span class="annot"><a href="#local-6989586621683038451"><span class="hs-identifier hs-var hs-var">add_one</span></a></span></span><span> </span><span id="local-6989586621683038453"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038453"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683038454"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683038454"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038457"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683038457"><span class="hs-identifier hs-var">ev_var</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038453"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-393"></span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683038454"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcTyVar -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-operator hs-var">`extendVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683038457"><span class="hs-identifier hs-var">ev_var</span></a></span><span>
</span><span id="line-394"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683038454"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038440"><span class="hs-identifier hs-type">new_fr</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#eqCanRewriteFR"><span class="hs-operator hs-type">`eqCanRewriteFR`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-type">Given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-type">NomEq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span>
</span><span id="line-397"></span><span>                   </span><span class="hs-comment">-- if this isn't true, no use looking through the constraints</span><span>
</span><span id="line-398"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-type">isEmptyVarSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038449"><span class="hs-identifier hs-type">kicked_given_ev_vars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-399"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Given(s) have been kicked out; drop from famapp-cache&quot;</span></span><span>
</span><span id="line-400"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038449"><span class="hs-identifier hs-type">kicked_given_ev_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#dropFromFamAppCache"><span class="hs-identifier hs-type">dropFromFamAppCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038449"><span class="hs-identifier hs-type">kicked_given_ev_vars</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-type">csTraceTcS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-404"></span><span>              </span><span class="annot"><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-type">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Kick out&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>                 </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;n-kicked =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-type">int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038445"><span class="hs-identifier hs-type">n_kicked</span></a></span><span>
</span><span id="line-406"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kicked_out =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038442"><span class="hs-identifier hs-type">kicked_out</span></a></span><span>
</span><span id="line-407"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Residual inerts =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038443"><span class="hs-identifier hs-type">ics'</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier hs-type">kickOutAfterUnification</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span id="kickOutAfterUnification"><span class="annot"><span class="annottext">kickOutAfterUnification :: [TcTyVar] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier hs-var hs-var">kickOutAfterUnification</span></a></span></span><span> </span><span id="local-6989586621683038469"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683038469"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683038469"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038471"><span class="annot"><span class="annottext">tv_set :: VarSet
</span><a href="#local-6989586621683038471"><span class="hs-identifier hs-var hs-var hs-var">tv_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683038469"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038473"><span class="annot"><a href="#local-6989586621683038473"><span class="hs-identifier hs-var">n_kicked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KickOutSpec -&gt; CtFlavourRole -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier hs-var">kickOutRewritable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; KickOutSpec
</span><a href="GHC.Tc.Solver.InertSet.html#KOAfterUnify"><span class="hs-identifier hs-var">KOAfterUnify</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683038471"><span class="hs-identifier hs-var">tv_set</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>                     </span><span class="hs-comment">-- Given because the tv := xi is given; NomEq because</span><span>
</span><span id="line-418"></span><span>                     </span><span class="hs-comment">-- only nominal equalities are solved by unification</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>       </span><span class="hs-comment">-- Set the unification flag if we have done outer unifications</span><span>
</span><span id="line-421"></span><span>       </span><span class="hs-comment">-- that might affect an earlier implication constraint</span><span>
</span><span id="line-422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038475"><span class="annot"><a href="#local-6989586621683038475"><span class="hs-identifier hs-var hs-var">min_tv_lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLevel -&gt; TcLevel -&gt; TcLevel) -&gt; [TcLevel] -&gt; TcLevel
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#minTcLevel"><span class="hs-identifier hs-var">minTcLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcTyVar -&gt; TcLevel) -&gt; [TcTyVar] -&gt; [TcLevel]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683038469"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038479"><span class="annot"><a href="#local-6989586621683038479"><span class="hs-identifier hs-var">ambient_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-424"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038479"><span class="hs-identifier hs-type">ambient_lvl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-type">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038475"><span class="hs-identifier hs-type">min_tv_lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-425"></span><span>         </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setUnificationFlag"><span class="hs-identifier hs-type">setUnificationFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038475"><span class="hs-identifier hs-type">min_tv_lvl</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kickOutAfterUnification&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038469"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;n_kicked =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038473"><span class="hs-identifier hs-type">n_kicked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683038473"><span class="hs-identifier hs-type">n_kicked</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterFillingCoercionHole"><span class="hs-identifier hs-type">kickOutAfterFillingCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- See Wrinkle (EIK2a) in Note [Equalities with incompatible kinds] in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- It's possible that this could just go ahead and unify, but could there be occurs-check</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- problems? Seems simpler just to kick out.</span><span>
</span><span id="line-434"></span><span id="kickOutAfterFillingCoercionHole"><span class="annot"><span class="annottext">kickOutAfterFillingCoercionHole :: CoercionHole -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#kickOutAfterFillingCoercionHole"><span class="hs-identifier hs-var hs-var">kickOutAfterFillingCoercionHole</span></a></span></span><span> </span><span id="local-6989586621683038482"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683038482"><span class="hs-identifier hs-var">hole</span></a></span></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038483"><span class="annot"><a href="#local-6989586621683038483"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683038484"><span class="annot"><a href="#local-6989586621683038484"><span class="hs-identifier hs-var">kicked_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683038485"><span class="annot"><a href="#local-6989586621683038485"><span class="hs-identifier hs-var">ics'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038486"><span class="hs-identifier hs-type">kick_out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038483"><span class="hs-identifier hs-type">ics</span></a></span><span>
</span><span id="line-437"></span><span>             </span><span id="local-6989586621683038487"><span class="annot"><a href="#local-6989586621683038487"><span class="hs-identifier hs-var hs-var">n_kicked</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag IrredCt -&gt; Int
forall a. Bag a -&gt; Int
</span><a href="GHC.Data.Bag.html#lengthBag"><span class="hs-identifier hs-var">lengthBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038484"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038487"><span class="hs-identifier hs-type">n_kicked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-440"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-type">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCts"><span class="hs-identifier hs-type">extendWorkListCts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038484"><span class="hs-identifier hs-type">kicked_out</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-type">csTraceTcS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-442"></span><span>              </span><span class="annot"><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-type">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Kick out, hole =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038482"><span class="hs-identifier hs-type">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>                 </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;n-kicked =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-type">int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038487"><span class="hs-identifier hs-type">n_kicked</span></a></span><span>
</span><span id="line-444"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kicked_out =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038484"><span class="hs-identifier hs-type">kicked_out</span></a></span><span>
</span><span id="line-445"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Residual inerts =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038485"><span class="hs-identifier hs-type">ics'</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-type">setInertCans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038485"><span class="hs-identifier hs-type">ics'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><a href="#local-6989586621683038486"><span class="hs-identifier hs-type">kick_out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>    </span><span id="local-6989586621683038486"><span class="annot"><span class="annottext">kick_out :: InertCans -&gt; (Bag IrredCt, InertCans)
</span><a href="#local-6989586621683038486"><span class="hs-identifier hs-var hs-var">kick_out</span></a></span></span><span> </span><span id="local-6989586621683038490"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621683038490"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; Bag IrredCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038492"><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038492"><span class="hs-identifier hs-var">irreds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- We only care about irreds here, because any constraint blocked</span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-comment">-- by a coercion hole is an irred.  See wrinkle (EIK2a) in</span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-comment">-- Note [Equalities with incompatible kinds] in GHC.Tc.Solver.Canonical</span><span>
</span><span id="line-454"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038493"><span class="hs-identifier hs-var">irreds_to_kick</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038490"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038494"><span class="hs-identifier hs-type">irreds_to_keep</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683038493"><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038493"><span class="hs-identifier hs-var">irreds_to_kick</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683038494"><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038494"><span class="hs-identifier hs-var">irreds_to_keep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Bool) -&gt; Bag IrredCt -&gt; (Bag IrredCt, Bag IrredCt)
forall a. (a -&gt; Bool) -&gt; Bag a -&gt; (Bag a, Bag a)
</span><a href="GHC.Data.Bag.html#partitionBag"><span class="hs-identifier hs-var">partitionBag</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Bool
</span><a href="#local-6989586621683038496"><span class="hs-identifier hs-var">kick_ct</span></a></span><span> </span><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038492"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><a href="#local-6989586621683038496"><span class="hs-identifier hs-type">kick_ct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-459"></span><span>         </span><span class="hs-comment">-- True: kick out; False: keep.</span><span>
</span><span id="line-460"></span><span>    </span><span id="local-6989586621683038496"><span class="annot"><span class="annottext">kick_ct :: IrredCt -&gt; Bool
</span><a href="#local-6989586621683038496"><span class="hs-identifier hs-var hs-var">kick_ct</span></a></span></span><span> </span><span id="local-6989586621683038497"><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621683038497"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ev :: IrredCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038500"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038500"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ir_reason :: IrredCt -&gt; CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#ir_reason"><span class="hs-identifier hs-var">ir_reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038502"><span class="annot"><span class="annottext">CtIrredReason
</span><a href="#local-6989586621683038502"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621683038497"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span id="local-6989586621683038506"><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621683038506"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038500"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-463"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NonCanonicalReason"><span class="hs-identifier hs-type">NonCanonicalReason</span></a></span><span> </span><span id="local-6989586621683038508"><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683038508"><span class="hs-identifier hs-var">ctyeq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="#local-6989586621683038502"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683038508"><span class="hs-identifier hs-var">ctyeq</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; CheckTyEqProblem -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cterHasProblem"><span class="hs-operator hs-var">`cterHasProblem`</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteCoercionHole"><span class="hs-identifier hs-var">cteCoercionHole</span></a></span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683038482"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; UniqSet CoercionHole -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621683038506"><span class="hs-identifier hs-var">rewriters</span></a></span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-467"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-468"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-471"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier hs-type">addInertSafehask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-472"></span><span id="addInertSafehask"><span class="annot"><span class="annottext">addInertSafehask :: InertCans -&gt; DictCt -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier hs-var hs-var">addInertSafehask</span></a></span></span><span> </span><span id="local-6989586621683038511"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038511"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span id="local-6989586621683038512"><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038512"><span class="hs-identifier hs-var">item</span></a></span></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038511"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addDict"><span class="hs-identifier hs-type">addDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038512"><span class="hs-identifier hs-type">item</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038511"><span class="hs-identifier hs-type">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier hs-type">insertSafeOverlapFailureTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation] in GHC.Tc.Solver</span><span>
</span><span id="line-477"></span><span id="insertSafeOverlapFailureTcS"><span class="annot"><span class="annottext">insertSafeOverlapFailureTcS :: InstanceWhat -&gt; DictCt -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier hs-var hs-var">insertSafeOverlapFailureTcS</span></a></span></span><span> </span><span id="local-6989586621683038516"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683038516"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683038517"><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038517"><span class="hs-identifier hs-var">item</span></a></span></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">InstanceWhat -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier hs-var">safeOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683038516"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683038518"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038518"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; DictCt -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier hs-var">addInertSafehask</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038518"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038517"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSafeOverlapFailures"><span class="hs-identifier hs-type">getSafeOverlapFailures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation] in GHC.Tc.Solver</span><span>
</span><span id="line-483"></span><span id="getSafeOverlapFailures"><span class="annot"><span class="annottext">getSafeOverlapFailures :: TcS (Bag DictCt)
</span><a href="GHC.Tc.Solver.Monad.html#getSafeOverlapFailures"><span class="hs-identifier hs-var hs-var">getSafeOverlapFailures</span></a></span></span><span>
</span><span id="line-484"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038519"><span class="annot"><a href="#local-6989586621683038519"><span class="hs-identifier hs-var">safehask</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#foldDicts"><span class="hs-identifier hs-type">foldDicts</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#consBag"><span class="hs-identifier hs-type">consBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038519"><span class="hs-identifier hs-type">safehask</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-type">emptyBag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-488"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updSolvedDicts"><span class="hs-identifier hs-type">updSolvedDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- Conditionally add a new item in the solved set of the monad</span><span>
</span><span id="line-490"></span><span class="hs-comment">-- See Note [Solved dictionaries] in GHC.Tc.Solver.InertSet</span><span>
</span><span id="line-491"></span><span id="updSolvedDicts"><span class="annot"><span class="annottext">updSolvedDicts :: InstanceWhat -&gt; DictCt -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updSolvedDicts"><span class="hs-identifier hs-var hs-var">updSolvedDicts</span></a></span></span><span> </span><span id="local-6989586621683038523"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683038523"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683038524"><span class="annot"><span class="annottext">dict_ct :: DictCt
</span><a href="#local-6989586621683038524"><span class="hs-identifier hs-var">dict_ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_ev :: DictCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#di_ev"><span class="hs-identifier hs-var">di_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038527"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038527"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isWanted"><span class="hs-identifier hs-var">isWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038527"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InstanceWhat -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-var">instanceReturnsDictCon</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683038523"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;updSolvedDicts:&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038524"><span class="hs-identifier hs-var">dict_ct</span></a></span><span>
</span><span id="line-495"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-var">updInertSet</span></a></span><span> </span><span class="annot"><span class="annottext">((InertSet -&gt; InertSet) -&gt; TcS ())
-&gt; (InertSet -&gt; InertSet) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683038529"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038529"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-496"></span><span>         </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038529"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addSolvedDict"><span class="hs-identifier hs-type">addSolvedDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038524"><span class="hs-identifier hs-type">dict_ct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038529"><span class="hs-identifier hs-type">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSolvedDicts"><span class="hs-identifier hs-type">getSolvedDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span id="getSolvedDicts"><span class="annot"><span class="annottext">getSolvedDicts :: TcS (DictMap DictCt)
</span><a href="GHC.Tc.Solver.Monad.html#getSolvedDicts"><span class="hs-identifier hs-var hs-var">getSolvedDicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038532"><span class="annot"><a href="#local-6989586621683038532"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-var">getInertSet</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038532"><span class="hs-identifier hs-type">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setSolvedDicts"><span class="hs-identifier hs-type">setSolvedDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span id="setSolvedDicts"><span class="annot"><span class="annottext">setSolvedDicts :: DictMap DictCt -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setSolvedDicts"><span class="hs-identifier hs-var hs-var">setSolvedDicts</span></a></span></span><span> </span><span id="local-6989586621683038533"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038533"><span class="hs-identifier hs-var">solved_dicts</span></a></span></span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-var">updInertSet</span></a></span><span> </span><span class="annot"><span class="annottext">((InertSet -&gt; InertSet) -&gt; TcS ())
-&gt; (InertSet -&gt; InertSet) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683038534"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038534"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038534"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038533"><span class="hs-identifier hs-type">solved_dicts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                  Other inert-set operations
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-type">updInertSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-516"></span><span id="updInertSet"><span class="annot"><span class="annottext">updInertSet :: (InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-var hs-var">updInertSet</span></a></span></span><span> </span><span id="local-6989586621683038535"><span class="annot"><span class="annottext">InertSet -&gt; InertSet
</span><a href="#local-6989586621683038535"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-517"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038536"><span class="annot"><a href="#local-6989586621683038536"><span class="hs-identifier hs-var">is_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getInertSetRef"><span class="hs-identifier hs-var">getInertSetRef</span></a></span><span>
</span><span id="line-518"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038538"><span class="annot"><a href="#local-6989586621683038538"><span class="hs-identifier hs-var">curr_inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038536"><span class="hs-identifier hs-type">is_var</span></a></span><span>
</span><span id="line-519"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038536"><span class="hs-identifier hs-type">is_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038535"><span class="hs-identifier hs-type">upd_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038538"><span class="hs-identifier hs-type">curr_inert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-type">getInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-522"></span><span id="getInertCans"><span class="annot"><span class="annottext">getInertCans :: TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var hs-var">getInertCans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038541"><span class="annot"><a href="#local-6989586621683038541"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-var">getInertSet</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038541"><span class="hs-identifier hs-type">inerts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-type">setInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span id="setInertCans"><span class="annot"><span class="annottext">setInertCans :: InertCans -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-var hs-var">setInertCans</span></a></span></span><span> </span><span id="local-6989586621683038543"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038543"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-var">updInertSet</span></a></span><span> </span><span class="annot"><span class="annottext">((InertSet -&gt; InertSet) -&gt; TcS ())
-&gt; (InertSet -&gt; InertSet) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683038544"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038544"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038544"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038543"><span class="hs-identifier hs-type">ics</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span id="local-6989586621683037387"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updRetInertCans"><span class="hs-identifier hs-type">updRetInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037387"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037387"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-528"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-529"></span><span id="updRetInertCans"><span class="annot"><span class="annottext">updRetInertCans :: forall a. (InertCans -&gt; (a, InertCans)) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#updRetInertCans"><span class="hs-identifier hs-var hs-var">updRetInertCans</span></a></span></span><span> </span><span id="local-6989586621683038552"><span class="annot"><span class="annottext">InertCans -&gt; (a, InertCans)
</span><a href="#local-6989586621683038552"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038553"><span class="annot"><a href="#local-6989586621683038553"><span class="hs-identifier hs-var">is_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getInertSetRef"><span class="hs-identifier hs-var">getInertSetRef</span></a></span><span>
</span><span id="line-531"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038554"><span class="annot"><a href="#local-6989586621683038554"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038553"><span class="hs-identifier hs-type">is_var</span></a></span><span>
</span><span id="line-532"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683038555"><span class="annot"><a href="#local-6989586621683038555"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683038556"><span class="annot"><a href="#local-6989586621683038556"><span class="hs-identifier hs-var">cans'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038552"><span class="hs-identifier hs-type">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038554"><span class="hs-identifier hs-type">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038553"><span class="hs-identifier hs-type">is_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038554"><span class="hs-identifier hs-type">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038556"><span class="hs-identifier hs-type">cans'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683038555"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-type">updInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-538"></span><span id="updInertCans"><span class="annot"><span class="annottext">updInertCans :: (InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var hs-var">updInertCans</span></a></span></span><span> </span><span id="local-6989586621683038557"><span class="annot"><span class="annottext">InertCans -&gt; InertCans
</span><a href="#local-6989586621683038557"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-var">updInertSet</span></a></span><span> </span><span class="annot"><span class="annottext">((InertSet -&gt; InertSet) -&gt; TcS ())
-&gt; (InertSet -&gt; InertSet) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683038558"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038558"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038558"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038557"><span class="hs-identifier hs-type">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038558"><span class="hs-identifier hs-type">inerts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSafehask"><span class="hs-identifier hs-type">updInertSafehask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-543"></span><span id="updInertSafehask"><span class="annot"><span class="annottext">updInertSafehask :: (DictMap DictCt -&gt; DictMap DictCt) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSafehask"><span class="hs-identifier hs-var hs-var">updInertSafehask</span></a></span></span><span> </span><span id="local-6989586621683038559"><span class="annot"><span class="annottext">DictMap DictCt -&gt; DictMap DictCt
</span><a href="#local-6989586621683038559"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a></span><span> </span><span class="annot"><span class="annottext">((InertCans -&gt; InertCans) -&gt; TcS ())
-&gt; (InertCans -&gt; InertCans) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683038560"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038560"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038560"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038559"><span class="hs-identifier hs-type">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038560"><span class="hs-identifier hs-type">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertEqs"><span class="hs-identifier hs-type">getInertEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-547"></span><span id="getInertEqs"><span class="annot"><span class="annottext">getInertEqs :: TcS InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#getInertEqs"><span class="hs-identifier hs-var hs-var">getInertEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038561"><span class="annot"><a href="#local-6989586621683038561"><span class="hs-identifier hs-var">inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038561"><span class="hs-identifier hs-type">inert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInnermostGivenEqLevel"><span class="hs-identifier hs-type">getInnermostGivenEqLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-550"></span><span id="getInnermostGivenEqLevel"><span class="annot"><span class="annottext">getInnermostGivenEqLevel :: TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getInnermostGivenEqLevel"><span class="hs-identifier hs-var hs-var">getInnermostGivenEqLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038563"><span class="annot"><a href="#local-6989586621683038563"><span class="hs-identifier hs-var">inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-551"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038563"><span class="hs-identifier hs-type">inert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="hs-comment">-- | Retrieves all insoluble constraints from the inert set,</span><span>
</span><span id="line-554"></span><span class="hs-comment">-- specifically including Given constraints.</span><span>
</span><span id="line-555"></span><span class="hs-comment">--</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- This consists of:</span><span>
</span><span id="line-557"></span><span class="hs-comment">--</span><span>
</span><span id="line-558"></span><span class="hs-comment">--  - insoluble equalities, such as @Int ~# Bool@;</span><span>
</span><span id="line-559"></span><span class="hs-comment">--  - constraints that are top-level custom type errors, of the form</span><span>
</span><span id="line-560"></span><span class="hs-comment">--    @TypeError msg@, but not constraints such as @Eq (TypeError msg)@</span><span>
</span><span id="line-561"></span><span class="hs-comment">--    in which the type error is nested;</span><span>
</span><span id="line-562"></span><span class="hs-comment">--  - unsatisfiable constraints, of the form @Unsatisfiable msg@.</span><span>
</span><span id="line-563"></span><span class="hs-comment">--</span><span>
</span><span id="line-564"></span><span class="hs-comment">-- The inclusion of Givens is important for pattern match warnings, as we</span><span>
</span><span id="line-565"></span><span class="hs-comment">-- want to consider a pattern match that introduces insoluble Givens to be</span><span>
</span><span id="line-566"></span><span class="hs-comment">-- redundant (see Note [Pattern match warnings with insoluble Givens] in GHC.Tc.Solver).</span><span>
</span><span id="line-567"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertInsols"><span class="hs-identifier hs-type">getInertInsols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-568"></span><span id="getInertInsols"><span class="annot"><span class="annottext">getInertInsols :: TcS Cts
</span><a href="GHC.Tc.Solver.Monad.html#getInertInsols"><span class="hs-identifier hs-var hs-var">getInertInsols</span></a></span></span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038564"><span class="annot"><a href="#local-6989586621683038564"><span class="hs-identifier hs-var">inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-570"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038565"><span class="annot"><a href="#local-6989586621683038565"><span class="hs-identifier hs-var hs-var">insols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Bool) -&gt; Bag IrredCt -&gt; Bag IrredCt
forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#insolubleIrredCt"><span class="hs-identifier hs-var">insolubleIrredCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; Bag IrredCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038564"><span class="hs-identifier hs-var">inert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>             </span><span id="local-6989586621683038568"><span class="annot"><a href="#local-6989586621683038568"><span class="hs-identifier hs-var hs-var">unsats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt -&gt; Unique -&gt; Bag DictCt
forall a. DictMap a -&gt; Unique -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#findDictsByTyConKey"><span class="hs-identifier hs-var">findDictsByTyConKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038564"><span class="hs-identifier hs-var">inert</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unsatisfiableClassNameKey"><span class="hs-identifier hs-var">unsatisfiableClassNameKey</span></a></span><span>
</span><span id="line-572"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038568"><span class="hs-identifier hs-type">unsats</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038565"><span class="hs-identifier hs-type">insols</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier hs-type">getInertGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-575"></span><span class="hs-comment">-- Returns the Given constraints in the inert set</span><span>
</span><span id="line-576"></span><span id="getInertGivens"><span class="annot"><span class="annottext">getInertGivens :: TcS [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier hs-var hs-var">getInertGivens</span></a></span></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038572"><span class="annot"><a href="#local-6989586621683038572"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-578"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038573"><span class="annot"><a href="#local-6989586621683038573"><span class="hs-identifier hs-var hs-var">all_cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; [Ct] -&gt; [Ct]) -&gt; Bag IrredCt -&gt; [Ct] -&gt; [Ct]
forall b. (IrredCt -&gt; b -&gt; b) -&gt; Bag IrredCt -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldIrreds"><span class="hs-identifier hs-var">foldIrreds</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; [Ct] -&gt; [Ct]) -&gt; (IrredCt -&gt; Ct) -&gt; IrredCt -&gt; [Ct] -&gt; [Ct]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; Bag IrredCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038572"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>                     </span><span class="annot"><span class="annottext">([Ct] -&gt; [Ct]) -&gt; [Ct] -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; [Ct] -&gt; [Ct]) -&gt; DictMap DictCt -&gt; [Ct] -&gt; [Ct]
forall a b. (a -&gt; b -&gt; b) -&gt; DictMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; [Ct] -&gt; [Ct]) -&gt; (DictCt -&gt; Ct) -&gt; DictCt -&gt; [Ct] -&gt; [Ct]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038572"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>                     </span><span class="annot"><span class="annottext">([Ct] -&gt; [Ct]) -&gt; [Ct] -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; [Ct] -&gt; [Ct]) -&gt; FunEqMap EqualCtList -&gt; [Ct] -&gt; [Ct]
forall b. (EqCt -&gt; b -&gt; b) -&gt; FunEqMap EqualCtList -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; [Ct] -&gt; [Ct]) -&gt; (EqCt -&gt; Ct) -&gt; EqCt -&gt; [Ct] -&gt; [Ct]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-var">CEqCan</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038572"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>                     </span><span class="annot"><span class="annottext">([Ct] -&gt; [Ct]) -&gt; [Ct] -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; [Ct] -&gt; [Ct]) -&gt; InertEqs -&gt; [Ct] -&gt; [Ct]
forall b. (EqCt -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; [Ct] -&gt; [Ct]) -&gt; (EqCt -&gt; Ct) -&gt; EqCt -&gt; [Ct] -&gt; [Ct]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-var">CEqCan</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038572"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>                     </span><span class="annot"><span class="annottext">([Ct] -&gt; [Ct]) -&gt; [Ct] -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-583"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#isGivenCt"><span class="hs-identifier hs-type">isGivenCt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038573"><span class="hs-identifier hs-type">all_cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getPendingGivenScs"><span class="hs-identifier hs-type">getPendingGivenScs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- Find all inert Given dictionaries, or quantified constraints, such that</span><span>
</span><span id="line-587"></span><span class="hs-comment">--     1. cc_pend_sc flag has fuel strictly &gt; 0</span><span>
</span><span id="line-588"></span><span class="hs-comment">--     2. belongs to the current level</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- For each such dictionary:</span><span>
</span><span id="line-590"></span><span class="annot"><span class="hs-comment">-- * Return it (with unmodified cc_pend_sc) in sc_pending</span></span><span>
</span><span id="line-591"></span><span class="annot"><span class="hs-comment">-- * Modify the dict in the inert set to have cc_pend_sc = doNotExpand</span></span><span>
</span><span id="line-592"></span><span class="hs-comment">--   to record that we have expanded superclasses for this dict</span><span>
</span><span id="line-593"></span><span id="getPendingGivenScs"><span class="annot"><span class="annottext">getPendingGivenScs :: TcS [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#getPendingGivenScs"><span class="hs-identifier hs-var hs-var">getPendingGivenScs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038580"><span class="annot"><a href="#local-6989586621683038580"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-594"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updRetInertCans"><span class="hs-identifier hs-type">updRetInertCans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#get_sc_pending"><span class="hs-identifier hs-type">get_sc_pending</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038580"><span class="hs-identifier hs-type">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#get_sc_pending"><span class="hs-identifier hs-type">get_sc_pending</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span id="get_sc_pending"><span class="annot"><span class="annottext">get_sc_pending :: TcLevel -&gt; InertCans -&gt; ([Ct], InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#get_sc_pending"><span class="hs-identifier hs-var hs-var">get_sc_pending</span></a></span></span><span> </span><span id="local-6989586621683038582"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683038582"><span class="hs-identifier hs-var">this_lvl</span></a></span></span><span> </span><span id="local-6989586621683038583"><span class="annot"><span class="annottext">ic :: InertCans
</span><a href="#local-6989586621683038583"><span class="hs-identifier hs-var">ic</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038584"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038584"><span class="hs-identifier hs-var">dicts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038585"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621683038585"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ([Ct], InertCans) -&gt; ([Ct], InertCans)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; [Ct] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038588"><span class="hs-identifier hs-var">sc_pending</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038588"><span class="hs-identifier hs-var">sc_pending</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>       </span><span class="hs-comment">-- When getPendingScDics is called,</span><span>
</span><span id="line-600"></span><span>       </span><span class="hs-comment">-- there are never any Wanteds in the inert set</span><span>
</span><span id="line-601"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038588"><span class="hs-identifier hs-var">sc_pending</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038583"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038589"><span class="hs-identifier hs-type">dicts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038590"><span class="hs-identifier hs-type">insts'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-603"></span><span>    </span><span id="local-6989586621683038588"><span class="annot"><span class="annottext">sc_pending :: [Ct]
</span><a href="#local-6989586621683038588"><span class="hs-identifier hs-var hs-var">sc_pending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038591"><span class="hs-identifier hs-var">sc_pend_insts</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; Ct) -&gt; [DictCt] -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a></span><span> </span><span class="annot"><span class="annottext">[DictCt]
</span><a href="#local-6989586621683038592"><span class="hs-identifier hs-var">sc_pend_dicts</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><a href="#local-6989586621683038592"><span class="hs-identifier hs-type">sc_pend_dicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621683038592"><span class="annot"><span class="annottext">sc_pend_dicts :: [DictCt]
</span><a href="#local-6989586621683038592"><span class="hs-identifier hs-var hs-var">sc_pend_dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; [DictCt] -&gt; [DictCt])
-&gt; DictMap DictCt -&gt; [DictCt] -&gt; [DictCt]
forall a b. (a -&gt; b -&gt; b) -&gt; DictMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; [DictCt] -&gt; [DictCt]
</span><a href="#local-6989586621683038593"><span class="hs-identifier hs-var">get_pending</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038584"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-607"></span><span>    </span><span id="local-6989586621683038589"><span class="annot"><span class="annottext">dicts' :: DictMap DictCt
</span><a href="#local-6989586621683038589"><span class="hs-identifier hs-var hs-var">dicts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; DictMap DictCt -&gt; DictMap DictCt)
-&gt; DictMap DictCt -&gt; [DictCt] -&gt; DictMap DictCt
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; DictMap DictCt -&gt; DictMap DictCt
</span><a href="#local-6989586621683038594"><span class="hs-identifier hs-var">exhaustAndAdd</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038584"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">[DictCt]
</span><a href="#local-6989586621683038592"><span class="hs-identifier hs-var">sc_pend_dicts</span></a></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683038591"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038591"><span class="hs-identifier hs-var">sc_pend_insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683038590"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621683038590"><span class="hs-identifier hs-var">insts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ct] -&gt; QCInst -&gt; ([Ct], QCInst))
-&gt; [Ct] -&gt; [QCInst] -&gt; ([Ct], [QCInst])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; QCInst -&gt; ([Ct], QCInst)
</span><a href="#local-6989586621683038595"><span class="hs-identifier hs-var">get_pending_inst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621683038585"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><a href="#local-6989586621683038594"><span class="hs-identifier hs-type">exhaustAndAdd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621683038594"><span class="annot"><span class="annottext">exhaustAndAdd :: DictCt -&gt; DictMap DictCt -&gt; DictMap DictCt
</span><a href="#local-6989586621683038594"><span class="hs-identifier hs-var hs-var">exhaustAndAdd</span></a></span></span><span> </span><span id="local-6989586621683038596"><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038596"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683038597"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038597"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; DictMap DictCt -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#addDict"><span class="hs-identifier hs-var">addDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038596"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#di_pend_sc"><span class="hs-identifier hs-var">di_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#doNotExpand"><span class="hs-identifier hs-type">doNotExpand</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038597"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-comment">-- Exhaust the fuel for this constraint before adding it as</span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-comment">-- we don't want to expand these constraints again</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><a href="#local-6989586621683038593"><span class="hs-identifier hs-type">get_pending</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Get dicts with cc_pend_sc &gt; 0</span><span>
</span><span id="line-617"></span><span>    </span><span id="local-6989586621683038593"><span class="annot"><span class="annottext">get_pending :: DictCt -&gt; [DictCt] -&gt; [DictCt]
</span><a href="#local-6989586621683038593"><span class="hs-identifier hs-var hs-var">get_pending</span></a></span></span><span> </span><span id="local-6989586621683038600"><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038600"><span class="hs-identifier hs-var">dict</span></a></span></span><span> </span><span id="local-6989586621683038601"><span class="annot"><span class="annottext">[DictCt]
</span><a href="#local-6989586621683038601"><span class="hs-identifier hs-var">dicts</span></a></span></span><span>
</span><span id="line-618"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isPendingScDictCt"><span class="hs-identifier hs-var">isPendingScDictCt</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038600"><span class="hs-identifier hs-var">dict</span></a></span><span>
</span><span id="line-619"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="#local-6989586621683038603"><span class="hs-identifier hs-var">belongs_to_this_level</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#dictCtEvidence"><span class="hs-identifier hs-var">dictCtEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038600"><span class="hs-identifier hs-var">dict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038600"><span class="hs-identifier hs-var">dict</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; [DictCt] -&gt; [DictCt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[DictCt]
</span><a href="#local-6989586621683038601"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-621"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-622"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DictCt]
</span><a href="#local-6989586621683038601"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span>    </span><span class="annot"><a href="#local-6989586621683038595"><span class="hs-identifier hs-type">get_pending_inst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>    </span><span id="local-6989586621683038595"><span class="annot"><span class="annottext">get_pending_inst :: [Ct] -&gt; QCInst -&gt; ([Ct], QCInst)
</span><a href="#local-6989586621683038595"><span class="hs-identifier hs-var hs-var">get_pending_inst</span></a></span></span><span> </span><span id="local-6989586621683038605"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038605"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621683038606"><span class="annot"><span class="annottext">qci :: QCInst
</span><a href="#local-6989586621683038606"><span class="hs-identifier hs-var">qci</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_ev :: QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038608"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038608"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683038609"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038609"><span class="hs-identifier hs-var">qci'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Maybe QCInst
</span><a href="GHC.Tc.Types.Constraint.html#pendingScInst_maybe"><span class="hs-identifier hs-var">pendingScInst_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038606"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-627"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="#local-6989586621683038603"><span class="hs-identifier hs-var">belongs_to_this_level</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038608"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-628"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-var">CQuantCan</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038606"><span class="hs-identifier hs-var">qci</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; [Ct] -&gt; [Ct]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038605"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038609"><span class="hs-identifier hs-var">qci'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>       </span><span class="hs-comment">-- qci' have their fuel exhausted</span><span>
</span><span id="line-630"></span><span>       </span><span class="hs-comment">-- we don't want to expand these constraints again</span><span>
</span><span id="line-631"></span><span>       </span><span class="hs-comment">-- qci is expanded</span><span>
</span><span id="line-632"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-633"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038605"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621683038606"><span class="hs-identifier hs-var">qci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621683038603"><span class="annot"><span class="annottext">belongs_to_this_level :: CtEvidence -&gt; Bool
</span><a href="#local-6989586621683038603"><span class="hs-identifier hs-var hs-var">belongs_to_this_level</span></a></span></span><span> </span><span id="local-6989586621683038612"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038612"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcLevel
</span><a href="GHC.Tc.Types.CtLoc.html#ctLocLevel"><span class="hs-identifier hs-var">ctLocLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038612"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#sameDepthAs"><span class="hs-operator hs-var">`sameDepthAs`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683038582"><span class="hs-identifier hs-var">this_lvl</span></a></span><span>
</span><span id="line-636"></span><span>    </span><span class="hs-comment">-- We only want Givens from this level; see (3a) in</span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-comment">-- Note [The superclass story] in GHC.Tc.Solver.Dict</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getUnsolvedInerts"><span class="hs-identifier hs-type">getUnsolvedInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span>
</span><span id="line-640"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- All simple constraints</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- Return all the unsolved [Wanted] constraints</span><span>
</span><span id="line-642"></span><span class="hs-comment">--</span><span>
</span><span id="line-643"></span><span class="hs-comment">-- Post-condition: the returned simple constraints are all fully zonked</span><span>
</span><span id="line-644"></span><span class="hs-comment">--                     (because they come from the inert set)</span><span>
</span><span id="line-645"></span><span class="hs-comment">--                 the unsolved implics may not be</span><span>
</span><span id="line-646"></span><span id="getUnsolvedInerts"><span class="annot"><span class="annottext">getUnsolvedInerts :: TcS (Bag Implication, Cts)
</span><a href="GHC.Tc.Solver.Monad.html#getUnsolvedInerts"><span class="hs-identifier hs-var hs-var">getUnsolvedInerts</span></a></span></span><span>
</span><span id="line-647"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038616"><span class="annot"><a href="#local-6989586621683038616"><span class="hs-identifier hs-var">tv_eqs</span></a></span></span><span>
</span><span id="line-648"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038617"><span class="annot"><a href="#local-6989586621683038617"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span>
</span><span id="line-649"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038618"><span class="annot"><a href="#local-6989586621683038618"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-650"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038619"><span class="annot"><a href="#local-6989586621683038619"><span class="hs-identifier hs-var">idicts</span></a></span></span><span>
</span><span id="line-651"></span><span>           </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038620"><span class="annot"><a href="#local-6989586621683038620"><span class="hs-identifier hs-var hs-var">unsolved_tv_eqs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Cts -&gt; Cts) -&gt; InertEqs -&gt; Cts -&gt; Cts
forall b. (EqCt -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqCt -&gt; Ct) -&gt; EqCt -&gt; Cts -&gt; Cts
forall a. (a -&gt; Ct) -&gt; a -&gt; Cts -&gt; Cts
</span><a href="#local-6989586621683038621"><span class="hs-identifier hs-var">add_if_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-var">CEqCan</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621683038616"><span class="hs-identifier hs-var">tv_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span>
</span><span id="line-654"></span><span>            </span><span id="local-6989586621683038623"><span class="annot"><a href="#local-6989586621683038623"><span class="hs-identifier hs-var hs-var">unsolved_fun_eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Cts -&gt; Cts) -&gt; FunEqMap EqualCtList -&gt; Cts -&gt; Cts
forall b. (EqCt -&gt; b -&gt; b) -&gt; FunEqMap EqualCtList -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqCt -&gt; Ct) -&gt; EqCt -&gt; Cts -&gt; Cts
forall a. (a -&gt; Ct) -&gt; a -&gt; Cts -&gt; Cts
</span><a href="#local-6989586621683038621"><span class="hs-identifier hs-var">add_if_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-var">CEqCan</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621683038617"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span>
</span><span id="line-655"></span><span>            </span><span id="local-6989586621683038624"><span class="annot"><a href="#local-6989586621683038624"><span class="hs-identifier hs-var hs-var">unsolved_irreds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Cts -&gt; Cts) -&gt; Cts -&gt; Bag IrredCt -&gt; Cts
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Bag a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IrredCt -&gt; Ct) -&gt; IrredCt -&gt; Cts -&gt; Cts
forall a. (a -&gt; Ct) -&gt; a -&gt; Cts -&gt; Cts
</span><a href="#local-6989586621683038621"><span class="hs-identifier hs-var">add_if_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span> </span><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038618"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-656"></span><span>            </span><span id="local-6989586621683038625"><span class="annot"><a href="#local-6989586621683038625"><span class="hs-identifier hs-var hs-var">unsolved_dicts</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; Cts -&gt; Cts) -&gt; DictMap DictCt -&gt; Cts -&gt; Cts
forall a b. (a -&gt; b -&gt; b) -&gt; DictMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DictCt -&gt; Ct) -&gt; DictCt -&gt; Cts -&gt; Cts
forall a. (a -&gt; Ct) -&gt; a -&gt; Cts -&gt; Cts
</span><a href="#local-6989586621683038621"><span class="hs-identifier hs-var">add_if_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038619"><span class="hs-identifier hs-var">idicts</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038626"><span class="annot"><a href="#local-6989586621683038626"><span class="hs-identifier hs-var">implics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getWorkListImplics"><span class="hs-identifier hs-type">getWorkListImplics</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;getUnsolvedInerts&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-661"></span><span>        </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; tv eqs =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038620"><span class="hs-identifier hs-type">unsolved_tv_eqs</span></a></span><span>
</span><span id="line-662"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;fun eqs =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038623"><span class="hs-identifier hs-type">unsolved_fun_eqs</span></a></span><span>
</span><span id="line-663"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;dicts =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038625"><span class="hs-identifier hs-type">unsolved_dicts</span></a></span><span>
</span><span id="line-664"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;irreds =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038624"><span class="hs-identifier hs-type">unsolved_irreds</span></a></span><span>
</span><span id="line-665"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;implics =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038626"><span class="hs-identifier hs-type">implics</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683038626"><span class="hs-identifier hs-type">implics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683038620"><span class="hs-identifier hs-type">unsolved_tv_eqs</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span>
</span><span id="line-668"></span><span>                          </span><span class="annot"><a href="#local-6989586621683038623"><span class="hs-identifier hs-type">unsolved_fun_eqs</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span>
</span><span id="line-669"></span><span>                          </span><span class="annot"><a href="#local-6989586621683038624"><span class="hs-identifier hs-type">unsolved_irreds</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span>
</span><span id="line-670"></span><span>                          </span><span class="annot"><a href="#local-6989586621683038625"><span class="hs-identifier hs-type">unsolved_dicts</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-672"></span><span>    </span><span id="local-6989586621683037411"><span class="annot"><a href="#local-6989586621683038621"><span class="hs-identifier hs-type">add_if_unsolved</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037411"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683037411"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span></span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621683038621"><span class="annot"><span class="annottext">add_if_unsolved :: forall a. (a -&gt; Ct) -&gt; a -&gt; Cts -&gt; Cts
</span><a href="#local-6989586621683038621"><span class="hs-identifier hs-var hs-var">add_if_unsolved</span></a></span></span><span> </span><span id="local-6989586621683038628"><span class="annot"><span class="annottext">a -&gt; Ct
</span><a href="#local-6989586621683038628"><span class="hs-identifier hs-var">mk_ct</span></a></span></span><span> </span><span id="local-6989586621683038629"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038629"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span id="local-6989586621683038630"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683038630"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-674"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isWantedCt"><span class="hs-identifier hs-var">isWantedCt</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038632"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038632"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Cts -&gt; Cts
</span><a href="GHC.Tc.Types.Constraint.html#consCts"><span class="hs-operator hs-var">`consCts`</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683038630"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-675"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683038630"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-676"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-677"></span><span>        </span><span id="local-6989586621683038632"><span class="annot"><span class="annottext">ct :: Ct
</span><a href="#local-6989586621683038632"><span class="hs-identifier hs-var hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Ct
</span><a href="#local-6989586621683038628"><span class="hs-identifier hs-var">mk_ct</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038629"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getHasGivenEqs"><span class="hs-identifier hs-type">getHasGivenEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>             </span><span class="hs-comment">-- TcLevel of this implication</span><span>
</span><span id="line-680"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HasGivenEqs"><span class="hs-identifier hs-type">HasGivenEqs</span></a></span><span>   </span><span class="hs-comment">-- are there Given equalities?</span><span>
</span><span id="line-681"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Insoluble equalities arising from givens</span><span>
</span><span id="line-682"></span><span class="hs-comment">-- See Note [Tracking Given equalities] in GHC.Tc.Solver.InertSet</span><span>
</span><span id="line-683"></span><span id="getHasGivenEqs"><span class="annot"><span class="annottext">getHasGivenEqs :: TcLevel -&gt; TcS (HasGivenEqs, Bag IrredCt)
</span><a href="GHC.Tc.Solver.Monad.html#getHasGivenEqs"><span class="hs-identifier hs-var hs-var">getHasGivenEqs</span></a></span></span><span> </span><span id="local-6989586621683038635"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683038635"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038636"><span class="annot"><a href="#local-6989586621683038636"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038637"><span class="annot"><a href="#local-6989586621683038637"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-685"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038638"><span class="annot"><a href="#local-6989586621683038638"><span class="hs-identifier hs-var">given_eqs</span></a></span></span><span>
</span><span id="line-686"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038639"><span class="annot"><a href="#local-6989586621683038639"><span class="hs-identifier hs-var">ge_lvl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-688"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038640"><span class="annot"><a href="#local-6989586621683038640"><span class="hs-identifier hs-var hs-var">given_insols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Bool) -&gt; Bag IrredCt -&gt; Bag IrredCt
forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Bool
</span><a href="#local-6989586621683038641"><span class="hs-identifier hs-var">insoluble_given_equality</span></a></span><span> </span><span class="annot"><span class="annottext">Bag IrredCt
</span><a href="#local-6989586621683038637"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-689"></span><span>                      </span><span class="hs-comment">-- Specifically includes ones that originated in some</span><span>
</span><span id="line-690"></span><span>                      </span><span class="hs-comment">-- outer context but were refined to an insoluble by</span><span>
</span><span id="line-691"></span><span>                      </span><span class="hs-comment">-- a local equality; so no level-check needed</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>             </span><span class="hs-comment">-- See Note [HasGivenEqs] in GHC.Tc.Types.Constraint, and</span><span>
</span><span id="line-694"></span><span>             </span><span class="hs-comment">-- Note [Tracking Given equalities] in GHC.Tc.Solver.InertSet</span><span>
</span><span id="line-695"></span><span>             </span><span id="local-6989586621683038642"><span class="annot"><a href="#local-6989586621683038642"><span class="hs-identifier hs-var hs-var">has_ge</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683038639"><span class="hs-identifier hs-var">ge_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#sameDepthAs"><span class="hs-operator hs-var">`sameDepthAs`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683038635"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasGivenEqs
</span><a href="GHC.Tc.Types.Constraint.html#MaybeGivenEqs"><span class="hs-identifier hs-var">MaybeGivenEqs</span></a></span><span>
</span><span id="line-696"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683038638"><span class="hs-identifier hs-var">given_eqs</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasGivenEqs
</span><a href="GHC.Tc.Types.Constraint.html#LocalGivenEqs"><span class="hs-identifier hs-var">LocalGivenEqs</span></a></span><span>
</span><span id="line-697"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasGivenEqs
</span><a href="GHC.Tc.Types.Constraint.html#NoGivenEqs"><span class="hs-identifier hs-var">NoGivenEqs</span></a></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;getHasGivenEqs&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-700"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;given_eqs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038638"><span class="hs-identifier hs-type">given_eqs</span></a></span><span>
</span><span id="line-701"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ge_lvl:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038639"><span class="hs-identifier hs-type">ge_lvl</span></a></span><span>
</span><span id="line-702"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ambient level:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038635"><span class="hs-identifier hs-type">tclvl</span></a></span><span>
</span><span id="line-703"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Inerts:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038636"><span class="hs-identifier hs-type">inerts</span></a></span><span>
</span><span id="line-704"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Insols:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038640"><span class="hs-identifier hs-type">given_insols</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-705"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038642"><span class="hs-identifier hs-type">has_ge</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683038640"><span class="hs-identifier hs-type">given_insols</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-707"></span><span>    </span><span class="annot"><a href="#local-6989586621683038641"><span class="hs-identifier hs-type">insoluble_given_equality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-comment">-- Check for unreachability; specifically do not include UserError/Unsatisfiable</span><span>
</span><span id="line-709"></span><span>    </span><span id="local-6989586621683038641"><span class="annot"><span class="annottext">insoluble_given_equality :: IrredCt -&gt; Bool
</span><a href="#local-6989586621683038641"><span class="hs-identifier hs-var hs-var">insoluble_given_equality</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ev :: IrredCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038646"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038646"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ir_reason :: IrredCt -&gt; CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#ir_reason"><span class="hs-identifier hs-var">ir_reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038647"><span class="annot"><span class="annottext">CtIrredReason
</span><a href="#local-6989586621683038647"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtIrredReason -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isInsolubleReason"><span class="hs-identifier hs-var">isInsolubleReason</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="#local-6989586621683038647"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038646"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#removeInertCts"><span class="hs-identifier hs-type">removeInertCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-713"></span><span class="hs-comment">-- ^ Remove inert constraints from the 'InertCans', for use when a</span><span>
</span><span id="line-714"></span><span class="hs-comment">-- typechecker plugin wishes to discard a given.</span><span>
</span><span id="line-715"></span><span id="removeInertCts"><span class="annot"><span class="annottext">removeInertCts :: [Ct] -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#removeInertCts"><span class="hs-identifier hs-var hs-var">removeInertCts</span></a></span></span><span> </span><span id="local-6989586621683038650"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038650"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621683038651"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038651"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; Ct -&gt; InertCans) -&gt; InertCans -&gt; [Ct] -&gt; InertCans
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#removeInertCt"><span class="hs-identifier hs-var">removeInertCt</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038651"><span class="hs-identifier hs-var">icans</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621683038650"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#removeInertCt"><span class="hs-identifier hs-type">removeInertCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-718"></span><span id="removeInertCt"><span class="annot"><span class="annottext">removeInertCt :: InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#removeInertCt"><span class="hs-identifier hs-var hs-var">removeInertCt</span></a></span></span><span> </span><span id="local-6989586621683038654"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038654"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span id="local-6989586621683038655"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038655"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-719"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683038655"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-720"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span id="local-6989586621683038656"><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621683038656"><span class="hs-identifier hs-var">dict_ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038654"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#delDict"><span class="hs-identifier hs-type">delDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038656"><span class="hs-identifier hs-type">dict_ct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038654"><span class="hs-identifier hs-type">is</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-721"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span>    </span><span id="local-6989586621683038658"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621683038658"><span class="hs-identifier hs-var">eq_ct</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#delEq"><span class="hs-identifier hs-var">delEq</span></a></span><span>    </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621683038658"><span class="hs-identifier hs-var">eq_ct</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038654"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-722"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span id="local-6989586621683038660"><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621683038660"><span class="hs-identifier hs-var">ir_ct</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#delIrred"><span class="hs-identifier hs-var">delIrred</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621683038660"><span class="hs-identifier hs-var">ir_ct</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683038654"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-723"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-type">CQuantCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InertCans
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removeInertCt: CQuantCan&quot;</span></span><span>
</span><span id="line-724"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CNonCanonical"><span class="hs-identifier hs-type">CNonCanonical</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InertCans
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removeInertCt: CNonCanonical&quot;</span></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span class="annot"><span class="hs-comment">-- | Looks up a family application in the inerts.</span></span><span>
</span><span id="line-727"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppInert"><span class="hs-identifier hs-type">lookupFamAppInert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- can it rewrite the target?</span><span>
</span><span id="line-728"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span id="lookupFamAppInert"><span class="annot"><span class="annottext">lookupFamAppInert :: (CtFlavourRole -&gt; Bool)
-&gt; TyCon -&gt; [Type] -&gt; TcS (Maybe (Reduction, CtFlavourRole))
</span><a href="GHC.Tc.Solver.Monad.html#lookupFamAppInert"><span class="hs-identifier hs-var hs-var">lookupFamAppInert</span></a></span></span><span> </span><span id="local-6989586621683038664"><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621683038664"><span class="hs-identifier hs-var">rewrite_pred</span></a></span></span><span> </span><span id="local-6989586621683038665"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683038665"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621683038666"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038666"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038668"><span class="annot"><a href="#local-6989586621683038668"><span class="hs-identifier hs-var">inert_funeqs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-var">getInertSet</span></a></span><span>
</span><span id="line-731"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038669"><span class="hs-identifier hs-type">lookup_inerts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038668"><span class="hs-identifier hs-type">inert_funeqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-733"></span><span>    </span><span id="local-6989586621683038669"><span class="annot"><span class="annottext">lookup_inerts :: FunEqMap EqualCtList -&gt; Maybe (Reduction, CtFlavourRole)
</span><a href="#local-6989586621683038669"><span class="hs-identifier hs-var hs-var">lookup_inerts</span></a></span></span><span> </span><span id="local-6989586621683038670"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621683038670"><span class="hs-identifier hs-var">inert_funeqs</span></a></span></span><span>
</span><span id="line-734"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683038671"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621683038671"><span class="hs-identifier hs-var">ecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList -&gt; TyCon -&gt; [Type] -&gt; Maybe EqualCtList
forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621683038670"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683038665"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038666"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-735"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_ev :: EqCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#eq_ev"><span class="hs-identifier hs-var">eq_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038675"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038675"><span class="hs-identifier hs-var">ctev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_rhs :: EqCt -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#eq_rhs"><span class="hs-identifier hs-var">eq_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038677"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683038677"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Bool) -&gt; EqualCtList -&gt; Maybe EqCt
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621683038664"><span class="hs-identifier hs-var">rewrite_pred</span></a></span><span> </span><span class="annot"><span class="annottext">(CtFlavourRole -&gt; Bool) -&gt; (EqCt -&gt; CtFlavourRole) -&gt; EqCt -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#eqCtFlavourRole"><span class="hs-identifier hs-var">eqCtFlavourRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621683038671"><span class="hs-identifier hs-var">ecl</span></a></span><span>
</span><span id="line-737"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reduction, CtFlavourRole) -&gt; Maybe (Reduction, CtFlavourRole)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; Coercion
CtEvidence -&gt; Coercion
</span><a href="GHC.Tc.Types.Constraint.html#ctEvCoercion"><span class="hs-identifier hs-var">ctEvCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038675"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683038677"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; CtFlavourRole
CtEvidence -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavourRole"><span class="hs-identifier hs-var">ctEvFlavourRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038675"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Reduction, CtFlavourRole)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupInInerts"><span class="hs-identifier hs-type">lookupInInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span class="hs-comment">-- Is this exact predicate type cached in the solved or canonicals of the InertSet?</span><span>
</span><span id="line-742"></span><span id="lookupInInerts"><span class="annot"><span class="annottext">lookupInInerts :: CtLoc -&gt; Type -&gt; TcS (Maybe CtEvidence)
</span><a href="GHC.Tc.Solver.Monad.html#lookupInInerts"><span class="hs-identifier hs-var hs-var">lookupInInerts</span></a></span></span><span> </span><span id="local-6989586621683038685"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038685"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683038686"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683038686"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621683038688"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683038688"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683038689"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038689"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683038686"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038691"><span class="annot"><a href="#local-6989586621683038691"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-var">getInertSet</span></a></span><span>
</span><span id="line-745"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038692"><span class="annot"><a href="#local-6989586621683038692"><span class="hs-identifier hs-var hs-var">mb_solved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier hs-var">lookupSolvedDict</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038691"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038685"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683038688"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038689"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-746"></span><span>             </span><span id="local-6989586621683038693"><span class="annot"><a href="#local-6989586621683038693"><span class="hs-identifier hs-var hs-var">mb_inert</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; CtEvidence) -&gt; Maybe DictCt -&gt; Maybe CtEvidence
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#dictCtEvidence"><span class="hs-identifier hs-var">dictCtEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe DictCt
</span><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier hs-var">lookupInertDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038691"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038685"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683038688"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038689"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Maybe monad</span><span>
</span><span id="line-748"></span><span>            </span><span id="local-6989586621683038694"><span class="annot"><a href="#local-6989586621683038694"><span class="hs-identifier hs-var">found_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683038692"><span class="hs-identifier hs-type">mb_solved</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`mplus`</span></span><span> </span><span class="annot"><a href="#local-6989586621683038693"><span class="hs-identifier hs-type">mb_inert</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>            </span><span class="hs-comment">-- We're about to &quot;solve&quot; the wanted we're looking up, so we</span><span>
</span><span id="line-751"></span><span>            </span><span class="hs-comment">-- must make sure doing so wouldn't run afoul of</span><span>
</span><span id="line-752"></span><span>            </span><span class="hs-comment">-- Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance.</span><span>
</span><span id="line-753"></span><span>            </span><span class="hs-comment">-- Forgetting this led to #20666.</span><span>
</span><span id="line-754"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">guard</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-type">prohibitedSuperClassSolve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-type">ctEvLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038694"><span class="hs-identifier hs-type">found_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683038685"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683038694"><span class="hs-identifier hs-type">found_ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-comment">-- NB: No caching for equalities, IPs, holes, or errors</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CtEvidence -&gt; TcS (Maybe CtEvidence)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe CtEvidence
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span class="annot"><span class="hs-comment">-- | Look up a dictionary inert.</span></span><span>
</span><span id="line-761"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier hs-type">lookupInertDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-762"></span><span id="lookupInertDict"><span class="annot"><span class="annottext">lookupInertDict :: InertCans -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe DictCt
</span><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier hs-var hs-var">lookupInertDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038697"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038697"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683038698"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038698"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683038699"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683038699"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683038700"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038700"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe DictCt
forall a. DictMap a -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findDict"><span class="hs-identifier hs-var">findDict</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038697"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038698"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683038699"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038700"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="annot"><span class="hs-comment">-- | Look up a solved inert.</span></span><span>
</span><span id="line-766"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier hs-type">lookupSolvedDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-767"></span><span class="hs-comment">-- Returns just if exactly this predicate type exists in the solved.</span><span>
</span><span id="line-768"></span><span id="lookupSolvedDict"><span class="annot"><span class="annottext">lookupSolvedDict :: InertSet -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier hs-var hs-var">lookupSolvedDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: InertSet -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038702"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038702"><span class="hs-identifier hs-var">solved</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683038703"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038703"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683038704"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683038704"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683038705"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038705"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; CtEvidence) -&gt; Maybe DictCt -&gt; Maybe CtEvidence
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#dictCtEvidence"><span class="hs-identifier hs-var">dictCtEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictMap DictCt -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe DictCt
forall a. DictMap a -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findDict"><span class="hs-identifier hs-var">findDict</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621683038702"><span class="hs-identifier hs-var">solved</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038703"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683038704"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038705"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-772"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppCache"><span class="hs-identifier hs-type">lookupFamAppCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span id="lookupFamAppCache"><span class="annot"><span class="annottext">lookupFamAppCache :: TyCon -&gt; [Type] -&gt; TcS (Maybe Reduction)
</span><a href="GHC.Tc.Solver.Monad.html#lookupFamAppCache"><span class="hs-identifier hs-var hs-var">lookupFamAppCache</span></a></span></span><span> </span><span id="local-6989586621683038706"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683038706"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621683038707"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038707"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-774"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038709"><span class="annot"><a href="#local-6989586621683038709"><span class="hs-identifier hs-var">famapp_cache</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-var">getInertSet</span></a></span><span>
</span><span id="line-775"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#findFunEq"><span class="hs-identifier hs-type">findFunEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038709"><span class="hs-identifier hs-type">famapp_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038706"><span class="hs-identifier hs-type">fam_tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038707"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-776"></span><span>           </span><span id="local-6989586621683038710"><span class="annot"><span class="annottext">result :: Maybe Reduction
</span><a href="#local-6989586621683038710"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683038711"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683038711"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-777"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;famapp_cache hit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683038706"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038707"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683038711"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Reduction -&gt; TcS (Maybe Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Reduction
</span><a href="#local-6989586621683038710"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-780"></span><span>           </span><span class="annot"><span class="annottext">Maybe Reduction
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Reduction -&gt; TcS (Maybe Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Reduction
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendFamAppCache"><span class="hs-identifier hs-type">extendFamAppCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span class="hs-comment">-- NB: co :: rhs ~ F tys, to match expectations of rewriter</span><span>
</span><span id="line-784"></span><span id="extendFamAppCache"><span class="annot"><span class="annottext">extendFamAppCache :: TyCon -&gt; [Type] -&gt; Reduction -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#extendFamAppCache"><span class="hs-identifier hs-var hs-var">extendFamAppCache</span></a></span></span><span> </span><span id="local-6989586621683038713"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683038713"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683038714"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683038714"><span class="hs-identifier hs-var">xi_args</span></a></span></span><span> </span><span id="local-6989586621683038715"><span class="annot"><span class="annottext">stuff :: Reduction
</span><a href="#local-6989586621683038715"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683038717"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683038717"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038718"><span class="annot"><a href="#local-6989586621683038718"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-786"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-type">gopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_FamAppCache"><span class="hs-identifier hs-type">Opt_FamAppCache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038718"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-787"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;extendFamAppCache&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038713"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038714"><span class="hs-identifier hs-type">xi_args</span></a></span><span>
</span><span id="line-788"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038717"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-type">updInertSet</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683038721"><span class="annot"><span class="annottext">is :: InertSet
</span><a href="#local-6989586621683038721"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: InertSet -&gt; FunEqMap Reduction
</span><a href="GHC.Tc.Solver.InertSet.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038722"><span class="annot"><span class="annottext">FunEqMap Reduction
</span><a href="#local-6989586621683038722"><span class="hs-identifier hs-var">fc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-790"></span><span>            </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038721"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#insertFunEq"><span class="hs-identifier hs-type">insertFunEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038722"><span class="hs-identifier hs-type">fc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038713"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038714"><span class="hs-identifier hs-type">xi_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038715"><span class="hs-identifier hs-type">stuff</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="hs-comment">-- Remove entries from the cache whose evidence mentions variables in the</span><span>
</span><span id="line-793"></span><span class="hs-comment">-- supplied set</span><span>
</span><span id="line-794"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#dropFromFamAppCache"><span class="hs-identifier hs-type">dropFromFamAppCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span id="dropFromFamAppCache"><span class="annot"><span class="annottext">dropFromFamAppCache :: VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#dropFromFamAppCache"><span class="hs-identifier hs-var hs-var">dropFromFamAppCache</span></a></span></span><span> </span><span id="local-6989586621683038723"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683038723"><span class="hs-identifier hs-var">varset</span></a></span></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-var">updInertSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683038724"><span class="annot"><span class="annottext">inerts :: InertSet
</span><a href="#local-6989586621683038724"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: InertSet -&gt; FunEqMap Reduction
</span><a href="GHC.Tc.Solver.InertSet.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683038725"><span class="annot"><span class="annottext">FunEqMap Reduction
</span><a href="#local-6989586621683038725"><span class="hs-identifier hs-var">famapp_cache</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-797"></span><span>                   </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038724"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#filterTcAppMap"><span class="hs-identifier hs-type">filterTcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038727"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038725"><span class="hs-identifier hs-type">famapp_cache</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-799"></span><span>    </span><span class="annot"><a href="#local-6989586621683038727"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-800"></span><span>    </span><span id="local-6989586621683038727"><span class="annot"><span class="annottext">check :: Reduction -&gt; Bool
</span><a href="#local-6989586621683038727"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621683038728"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683038728"><span class="hs-identifier hs-var">redn</span></a></span></span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfCo"><span class="hs-identifier hs-var">anyFreeVarsOfCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683038723"><span class="hs-identifier hs-var">varset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Bool) -&gt; Coercion -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; Coercion
</span><a href="GHC.Core.Reduction.html#reductionCoercion"><span class="hs-identifier hs-var">reductionCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683038728"><span class="hs-identifier hs-var">redn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
*              The TcS solver monad                                    *
*                                                                      *
************************************************************************

Note [The TcS monad]
~~~~~~~~~~~~~~~~~~~~
The TcS monad is a weak form of the main Tc monad

All you can do is
    * fail
    * allocate new variables
    * fill in evidence variables

Filling in a dictionary evidence variable means to create a binding
for it, so TcS carries a mutable location where the binding can be
added.  This is initialised from the innermost implication constraint.
-}</span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span class="hs-keyword">data</span><span> </span><span id="TcSEnv"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a></span></span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TcSEnv"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-826"></span><span>      </span><span id="tcs_ev_binds"><span class="annot"><span class="annottext">TcSEnv -&gt; EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var hs-var">tcs_ev_binds</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span>      </span><span id="tcs_unified"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var hs-var">tcs_unified</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-829"></span><span>         </span><span class="hs-comment">-- The number of unification variables we have filled</span><span>
</span><span id="line-830"></span><span>         </span><span class="hs-comment">-- The important thing is whether it is non-zero, so it</span><span>
</span><span id="line-831"></span><span>         </span><span class="hs-comment">-- could equally well be a Bool instead of an Int.</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span>      </span><span id="tcs_unif_lvl"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var hs-var">tcs_unif_lvl</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-834"></span><span>         </span><span class="hs-comment">-- The Unification Level Flag</span><span>
</span><span id="line-835"></span><span>         </span><span class="hs-comment">-- Outermost level at which we have unified a meta tyvar</span><span>
</span><span id="line-836"></span><span>         </span><span class="hs-comment">-- Starts at Nothing, then (Just i), then (Just j) where j&lt;i</span><span>
</span><span id="line-837"></span><span>         </span><span class="hs-comment">-- See Note [The Unification Level Flag]</span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span>      </span><span id="tcs_count"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var hs-var">tcs_count</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Global step count</span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span>      </span><span id="tcs_inerts"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var hs-var">tcs_inerts</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Current inert set</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>      </span><span class="hs-comment">-- Whether to throw an exception if we come across an insoluble constraint.</span><span>
</span><span id="line-844"></span><span>      </span><span class="hs-comment">-- Used to fail-fast when checking for hole-fits. See Note [Speeding up</span><span>
</span><span id="line-845"></span><span>      </span><span class="hs-comment">-- valid hole-fits].</span><span>
</span><span id="line-846"></span><span>      </span><span id="tcs_abort_on_insoluble"><span class="annot"><span class="annottext">TcSEnv -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#tcs_abort_on_insoluble"><span class="hs-identifier hs-var hs-var">tcs_abort_on_insoluble</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span>      </span><span class="hs-comment">-- See Note [WorkList priorities] in GHC.Tc.Solver.InertSet</span><span>
</span><span id="line-849"></span><span>      </span><span id="tcs_worklist"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var hs-var">tcs_worklist</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-comment">-- Current worklist</span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-853"></span><span class="hs-keyword">newtype</span><span> </span><span id="TcS"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span></span><span> </span><span id="local-6989586621683037435"><span class="annot"><a href="#local-6989586621683037435"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TcS"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unTcS"><span class="annot"><span class="annottext">forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var hs-var">unTcS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037435"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683038743"><span id="local-6989586621683038747"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; TcS a -&gt; TcS b)
-&gt; (forall a b. a -&gt; TcS b -&gt; TcS a) -&gt; Functor TcS
forall a b. a -&gt; TcS b -&gt; TcS a
forall a b. (a -&gt; b) -&gt; TcS a -&gt; TcS b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; TcS a -&gt; TcS b
fmap :: forall a b. (a -&gt; b) -&gt; TcS a -&gt; TcS b
$c&lt;$ :: forall a b. a -&gt; TcS b -&gt; TcS a
&lt;$ :: forall a b. a -&gt; TcS b -&gt; TcS a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-857"></span><span>  </span><span id="local-6989586621683038756"><span class="annot"><span class="annottext">mfix :: forall a. (a -&gt; TcS a) -&gt; TcS a
</span><span class="hs-identifier hs-var hs-var hs-var">mfix</span></span></span><span> </span><span id="local-6989586621683038757"><span class="annot"><span class="annottext">a -&gt; TcS a
</span><a href="#local-6989586621683038757"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683038758"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038758"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; TcM a) -&gt; TcM a
forall a.
(a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadFix m =&gt; (a -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">mfix</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683038759"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038759"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcS a -&gt; TcSEnv -&gt; TcM a
forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var">unTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcS a
</span><a href="#local-6989586621683038757"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038759"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038758"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span class="hs-comment">-- | Smart constructor for 'TcS', as describe in Note [The one-shot state</span><span>
</span><span id="line-860"></span><span class="hs-comment">-- monad trick] in &quot;GHC.Utils.Monad&quot;.</span><span>
</span><span id="line-861"></span><span id="local-6989586621683038760"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-type">mkTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038760"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038760"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-862"></span><span id="mkTcS"><span class="annot"><span class="annottext">mkTcS :: forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var hs-var">mkTcS</span></a></span></span><span> </span><span id="local-6989586621683038762"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683038762"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcSEnv -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">oneShot</span></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683038762"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683038768"><span id="local-6989586621683038771"><span id="local-6989586621683038774"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-865"></span><span>  </span><span id="local-6989586621683038777"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; TcS a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621683038778"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038778"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TcSEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038778"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-866"></span><span>  </span><span id="local-6989586621683038780"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. TcS (a -&gt; b) -&gt; TcS a -&gt; TcS b
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (a -&gt; b) -&gt; TcS a -&gt; TcS b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683038785"><span id="local-6989586621683038788"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-869"></span><span>  </span><span id="local-6989586621683038791"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038791"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683038792"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. TcS a -&gt; (a -&gt; TcS b) -&gt; TcS b
</span><span class="hs-operator hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621683038793"><span class="annot"><span class="annottext">a -&gt; TcS b
</span><a href="#local-6989586621683038793"><span class="hs-identifier hs-var">k</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM b) -&gt; TcS b
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM b) -&gt; TcS b) -&gt; (TcSEnv -&gt; TcM b) -&gt; TcS b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683038794"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038794"><span class="hs-identifier hs-var">ebs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-870"></span><span>    </span><span class="annot"><span class="annottext">TcS a -&gt; TcSEnv -&gt; TcM a
forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var">unTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038791"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038794"><span class="hs-identifier hs-var">ebs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; (a -&gt; TcM b) -&gt; TcM b
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683038795"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038795"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcS b -&gt; TcSEnv -&gt; TcM b
forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var">unTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcS b
</span><a href="#local-6989586621683038793"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683038795"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038794"><span class="hs-identifier hs-var">ebs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-873"></span><span>  </span><span id="local-6989586621683038802"><span class="annot"><span class="annottext">liftIO :: forall a. IO a -&gt; TcS a
</span><a href="#local-6989586621683038802"><span class="hs-identifier hs-var hs-var hs-var">liftIO</span></a></span></span><span> </span><span id="local-6989586621683038804"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621683038804"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683038805"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038805"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; TcM a
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621683038804"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-876"></span><span>  </span><span id="local-6989586621683038813"><span class="annot"><span class="annottext">fail :: forall a. String -&gt; TcS a
</span><span class="hs-identifier hs-var hs-var hs-var">fail</span></span></span><span> </span><span id="local-6989586621683038814"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038814"><span class="hs-identifier hs-var">err</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TcSEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM a
forall a. String -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038814"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683038819"><span id="local-6989586621683038823"><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-879"></span><span>   </span><span id="local-6989586621683038828"><span class="annot"><span class="annottext">getUniqueSupplyM :: TcS UniqSupply
</span><a href="#local-6989586621683038828"><span class="hs-identifier hs-var hs-var hs-var">getUniqueSupplyM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM UniqSupply -&gt; TcS UniqSupply
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM UniqSupply
forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#HasModule"><span class="hs-identifier hs-type">HasModule</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-882"></span><span>   </span><span id="local-6989586621683038837"><span class="annot"><span class="annottext">getModule :: TcS Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var hs-var hs-var">getModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Module -&gt; TcS Module
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683038842"><span id="local-6989586621683038846"><span id="local-6989586621683038849"><span class="annot"><a href="GHC.Types.TyThing.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-885"></span><span>   </span><span id="local-6989586621683038854"><span class="annot"><span class="annottext">lookupThing :: Name -&gt; TcS TyThing
</span><a href="#local-6989586621683038854"><span class="hs-identifier hs-var hs-var hs-var">lookupThing</span></a></span></span><span> </span><span id="local-6989586621683038856"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683038856"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TyThing -&gt; TcS TyThing
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcM TyThing
forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m TyThing
</span><a href="GHC.Types.TyThing.html#lookupThing"><span class="hs-identifier hs-var">lookupThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683038856"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span class="hs-comment">-- Basic functionality</span><span>
</span><span id="line-888"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-889"></span><span id="local-6989586621683037381"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037381"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037381"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-890"></span><span class="hs-comment">-- Do not export wrapTcS, because it promotes an arbitrary TcM to TcS,</span><span>
</span><span id="line-891"></span><span class="hs-comment">-- and TcS is supposed to have limited functionality</span><span>
</span><span id="line-892"></span><span id="wrapTcS"><span class="annot"><span class="annottext">wrapTcS :: forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var hs-var">wrapTcS</span></a></span></span><span> </span><span id="local-6989586621683038857"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683038857"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683038858"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038858"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683038857"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-comment">-- a TcM action will not use the TcEvBinds</span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span id="local-6989586621683037472"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-type">liftZonkTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037472"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037472"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-895"></span><span id="liftZonkTcS"><span class="annot"><span class="annottext">liftZonkTcS :: forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var hs-var">liftZonkTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcS a
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcS a) -&gt; (ZonkM a -&gt; TcM a) -&gt; ZonkM a -&gt; TcS a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ZonkM a -&gt; TcM a
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">TcM.liftZonkM</span></a></span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span id="local-6989586621683037475"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrap2TcS"><span class="hs-identifier hs-type">wrap2TcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037475"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037475"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-898"></span><span id="wrap2TcS"><span class="annot"><span class="annottext">wrap2TcS :: forall a. (TcM a -&gt; TcM a) -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrap2TcS"><span class="hs-identifier hs-var hs-var">wrap2TcS</span></a></span></span><span> </span><span id="local-6989586621683038862"><span class="annot"><span class="annottext">TcM a -&gt; TcM a
</span><a href="#local-6989586621683038862"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621683038863"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683038863"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683038864"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038864"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM a
</span><a href="#local-6989586621683038862"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683038863"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038864"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span id="local-6989586621683038865"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier hs-type">wrapErrTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038865"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038865"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-901"></span><span class="hs-comment">-- The thing wrapped should just fail</span><span>
</span><span id="line-902"></span><span class="hs-comment">-- There's no static check; it's up to the user</span><span>
</span><span id="line-903"></span><span class="hs-comment">-- Having a variant for each error message is too painful</span><span>
</span><span id="line-904"></span><span id="wrapErrTcS"><span class="annot"><span class="annottext">wrapErrTcS :: forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier hs-var hs-var">wrapErrTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcS a
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span id="local-6989586621683038866"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapWarnTcS"><span class="hs-identifier hs-type">wrapWarnTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038866"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038866"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-907"></span><span class="hs-comment">-- The thing wrapped should just add a warning, or no-op</span><span>
</span><span id="line-908"></span><span class="hs-comment">-- There's no static check; it's up to the user</span><span>
</span><span id="line-909"></span><span id="wrapWarnTcS"><span class="annot"><span class="annottext">wrapWarnTcS :: forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapWarnTcS"><span class="hs-identifier hs-var hs-var">wrapWarnTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcS a
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span id="local-6989586621683037484"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#panicTcS"><span class="hs-identifier hs-type">panicTcS</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037484"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-912"></span><span id="local-6989586621683037480"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#failTcS"><span class="hs-identifier hs-type">failTcS</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037480"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-913"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#warnTcS"><span class="hs-identifier hs-type">warnTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addErrTcS"><span class="hs-identifier hs-type">addErrTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span id="failTcS"><span class="annot"><span class="annottext">failTcS :: forall a. TcRnMessage -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#failTcS"><span class="hs-identifier hs-var hs-var">failTcS</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcS a
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcS a) -&gt; (TcRnMessage -&gt; TcM a) -&gt; TcRnMessage -&gt; TcS a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM a
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">TcM.failWith</span></a></span><span>
</span><span id="line-915"></span><span id="warnTcS"><span class="annot"><span class="annottext">warnTcS :: TcRnMessage -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#warnTcS"><span class="hs-identifier hs-var hs-var">warnTcS</span></a></span></span><span> </span><span id="local-6989586621683038868"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621683038868"><span class="hs-identifier hs-var">msg</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">TcM.addDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621683038868"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span id="addErrTcS"><span class="annot"><span class="annottext">addErrTcS :: TcRnMessage -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addErrTcS"><span class="hs-identifier hs-var hs-var">addErrTcS</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ())
-&gt; (TcRnMessage -&gt; TcM ()) -&gt; TcRnMessage -&gt; TcS ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">TcM.addErr</span></a></span><span>
</span><span id="line-917"></span><span id="panicTcS"><span class="annot"><span class="annottext">panicTcS :: forall a. SDoc -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#panicTcS"><span class="hs-identifier hs-var hs-var">panicTcS</span></a></span></span><span> </span><span id="local-6989586621683038873"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038873"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Solver.Monad&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038873"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tryEarlyAbortTcS"><span class="hs-identifier hs-type">tryEarlyAbortTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span class="hs-comment">-- Abort (fail in the monad) if the abort_on_insoluble flag is on</span><span>
</span><span id="line-921"></span><span id="tryEarlyAbortTcS"><span class="annot"><span class="annottext">tryEarlyAbortTcS :: TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#tryEarlyAbortTcS"><span class="hs-identifier hs-var hs-var">tryEarlyAbortTcS</span></a></span></span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683038875"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038875"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#tcs_abort_on_insoluble"><span class="hs-identifier hs-var">tcs_abort_on_insoluble</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038875"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">TcM.failM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="annot"><span class="hs-comment">-- | Emit a warning within the 'TcS' monad at the location given by the 'CtLoc'.</span></span><span>
</span><span id="line-925"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#ctLocWarnTcS"><span class="hs-identifier hs-type">ctLocWarnTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span id="ctLocWarnTcS"><span class="annot"><span class="annottext">ctLocWarnTcS :: CtLoc -&gt; TcRnMessage -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#ctLocWarnTcS"><span class="hs-identifier hs-var hs-var">ctLocWarnTcS</span></a></span></span><span> </span><span id="local-6989586621683038878"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038878"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683038879"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621683038879"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ()) -&gt; TcM () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcM () -&gt; TcM ()
forall a. CtLoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-var">TcM.setCtLocM</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683038878"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">TcM.addDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621683038879"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-929"></span><span id="traceTcS"><span class="annot"><span class="annottext">traceTcS :: String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var hs-var">traceTcS</span></a></span></span><span> </span><span id="local-6989586621683038881"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038881"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621683038882"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038882"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683038881"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038882"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-pragma hs-type">traceTcS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span id="local-6989586621683037490"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcPluginTcS"><span class="hs-identifier hs-type">runTcPluginTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037490"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037490"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-933"></span><span id="runTcPluginTcS"><span class="annot"><span class="annottext">runTcPluginTcS :: forall a. TcPluginM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#runTcPluginTcS"><span class="hs-identifier hs-var hs-var">runTcPluginTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcS a
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcS a) -&gt; (TcPluginM a -&gt; TcM a) -&gt; TcPluginM a -&gt; TcS a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcPluginM a -&gt; TcM a
forall a. TcPluginM a -&gt; TcM a
</span><a href="GHC.Tc.Types.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a></span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-936"></span><span>    </span><span id="local-6989586621683038891"><span class="annot"><span class="annottext">getDynFlags :: TcS DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var hs-var hs-var">getDynFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM DynFlags -&gt; TcS DynFlags
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier hs-type">getGlobalRdrEnvTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-939"></span><span id="getGlobalRdrEnvTcS"><span class="annot"><span class="annottext">getGlobalRdrEnvTcS :: TcS GlobalRdrEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier hs-var hs-var">getGlobalRdrEnvTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM GlobalRdrEnv -&gt; TcS GlobalRdrEnv
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">TcM.getGlobalRdrEnv</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#bumpStepCountTcS"><span class="hs-identifier hs-type">bumpStepCountTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span id="bumpStepCountTcS"><span class="annot"><span class="annottext">bumpStepCountTcS :: TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#bumpStepCountTcS"><span class="hs-identifier hs-var hs-var">bumpStepCountTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM ()) -&gt; TcS ()) -&gt; (TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683038893"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038893"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-943"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038894"><span class="annot"><span class="annottext">ref :: IORef Int
</span><a href="#local-6989586621683038894"><span class="hs-identifier hs-var hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038893"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-944"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038895"><span class="annot"><a href="#local-6989586621683038895"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621683038894"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-945"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038894"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038895"><span class="hs-identifier hs-type">n</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-type">csTraceTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span id="csTraceTcS"><span class="annot"><span class="annottext">csTraceTcS :: SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-var hs-var">csTraceTcS</span></a></span></span><span> </span><span id="local-6989586621683038897"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038897"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-949"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ()) -&gt; TcM () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; TcM SDoc
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038897"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-pragma hs-type">csTraceTcS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-identifier hs-type">traceFireTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span class="hs-comment">-- Dump a rule-firing trace</span><span>
</span><span id="line-954"></span><span id="traceFireTcS"><span class="annot"><span class="annottext">traceFireTcS :: CtEvidence -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-identifier hs-var hs-var">traceFireTcS</span></a></span></span><span> </span><span id="local-6989586621683038899"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683038899"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683038900"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683038900"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM ()) -&gt; TcS ()) -&gt; (TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683038901"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038901"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM SDoc -&gt; TcM ()) -&gt; TcM SDoc -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-956"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038902"><span class="annot"><a href="#local-6989586621683038902"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038901"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038903"><span class="annot"><a href="#local-6989586621683038903"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">TcM.getTcLevel</span></a></span><span>
</span><span id="line-958"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-type">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Step&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-type">int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038902"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-959"></span><span>                       </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;l:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038903"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span>
</span><span id="line-960"></span><span>                                    </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;d:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctLocDepth"><span class="hs-identifier hs-type">ctLocDepth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-type">ctEvLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038899"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>                       </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038900"><span class="hs-identifier hs-type">doc</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-type">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>                     </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038899"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-963"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-pragma hs-type">traceFireTcS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-type">csTraceTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span class="hs-comment">-- Constraint-solver tracing, -ddump-cs-trace</span><span>
</span><span id="line-967"></span><span id="csTraceTcM"><span class="annot"><span class="annottext">csTraceTcM :: TcM SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-var hs-var">csTraceTcM</span></a></span></span><span> </span><span id="local-6989586621683038909"><span class="annot"><span class="annottext">TcM SDoc
</span><a href="#local-6989586621683038909"><span class="hs-identifier hs-var">mk_doc</span></a></span></span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038910"><span class="annot"><a href="#local-6989586621683038910"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-969"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span>  </span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038910"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_cs_trace"><span class="hs-identifier hs-type">Opt_D_dump_cs_trace</span></a></span><span>
</span><span id="line-970"></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038910"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-type">Opt_D_dump_tc_trace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038916"><span class="annot"><a href="#local-6989586621683038916"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683038909"><span class="hs-identifier hs-type">mk_doc</span></a></span><span>
</span><span id="line-972"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-type">TcM.dumpTcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-973"></span><span>                       </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_cs_trace"><span class="hs-identifier hs-type">Opt_D_dump_cs_trace</span></a></span><span>
</span><span id="line-974"></span><span>                       </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-type">FormatText</span></a></span><span>
</span><span id="line-975"></span><span>                       </span><span class="annot"><a href="#local-6989586621683038916"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-976"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-pragma hs-type">csTraceTcM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span id="local-6989586621683037504"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcS"><span class="hs-identifier hs-type">runTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037504"><span class="hs-identifier hs-type">a</span></a></span><span>                </span><span class="hs-comment">-- What to run</span><span>
</span><span id="line-979"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-980"></span><span id="runTcS"><span class="annot"><span class="annottext">runTcS :: forall a. TcS a -&gt; TcM (a, EvBindMap)
</span><a href="GHC.Tc.Solver.Monad.html#runTcS"><span class="hs-identifier hs-var hs-var">runTcS</span></a></span></span><span> </span><span id="local-6989586621683038923"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038923"><span class="hs-identifier hs-var">tcs</span></a></span></span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038924"><span class="annot"><a href="#local-6989586621683038924"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-982"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038926"><span class="annot"><a href="#local-6989586621683038926"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-type">runTcSWithEvBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038924"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038923"><span class="hs-identifier hs-type">tcs</span></a></span><span>
</span><span id="line-983"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038927"><span class="annot"><a href="#local-6989586621683038927"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-type">TcM.getTcEvBindsMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038924"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span>
</span><span id="line-984"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038926"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683038927"><span class="hs-identifier hs-type">ev_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="hs-comment">-- | This variant of 'runTcS' will immediately fail upon encountering an</span><span>
</span><span id="line-987"></span><span class="hs-comment">-- insoluble ct. See Note [Speeding up valid hole-fits]. Its one usage</span><span>
</span><span id="line-988"></span><span class="hs-comment">-- site does not need the ev_binds, so we do not return them.</span><span>
</span><span id="line-989"></span><span id="local-6989586621683037508"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSEarlyAbort"><span class="hs-identifier hs-type">runTcSEarlyAbort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037508"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037508"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-990"></span><span id="runTcSEarlyAbort"><span class="annot"><span class="annottext">runTcSEarlyAbort :: forall a. TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSEarlyAbort"><span class="hs-identifier hs-var hs-var">runTcSEarlyAbort</span></a></span></span><span> </span><span id="local-6989586621683038930"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038930"><span class="hs-identifier hs-var">tcs</span></a></span></span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038931"><span class="annot"><a href="#local-6989586621683038931"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-992"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-type">runTcSWithEvBinds'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683038931"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038930"><span class="hs-identifier hs-type">tcs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span class="annot"><span class="hs-comment">-- | This can deal only with equality constraints.</span></span><span>
</span><span id="line-995"></span><span id="local-6989586621683038933"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSEqualities"><span class="hs-identifier hs-type">runTcSEqualities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038933"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038933"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-996"></span><span id="runTcSEqualities"><span class="annot"><span class="annottext">runTcSEqualities :: forall a. TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSEqualities"><span class="hs-identifier hs-var hs-var">runTcSEqualities</span></a></span></span><span> </span><span id="local-6989586621683038935"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038935"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-997"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038936"><span class="annot"><a href="#local-6989586621683038936"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var">TcM.newNoTcEvBinds</span></a></span><span>
</span><span id="line-998"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-type">runTcSWithEvBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038936"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038935"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="hs-comment">-- | A variant of 'runTcS' that takes and returns an 'InertSet' for</span><span>
</span><span id="line-1001"></span><span class="hs-comment">-- later resumption of the 'TcS' session.</span><span>
</span><span id="line-1002"></span><span id="local-6989586621683037512"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSInerts"><span class="hs-identifier hs-type">runTcSInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037512"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037512"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1003"></span><span id="runTcSInerts"><span class="annot"><span class="annottext">runTcSInerts :: forall a. InertSet -&gt; TcS a -&gt; TcM (a, InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#runTcSInerts"><span class="hs-identifier hs-var hs-var">runTcSInerts</span></a></span></span><span> </span><span id="local-6989586621683038943"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683038943"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span id="local-6989586621683038944"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038944"><span class="hs-identifier hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1004"></span><span>  </span><span id="local-6989586621683038945"><span class="annot"><a href="#local-6989586621683038945"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-1005"></span><span>  </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-type">runTcSWithEvBinds'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621683038945"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1006"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertSet"><span class="hs-identifier hs-type">setInertSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038943"><span class="hs-identifier hs-type">inerts</span></a></span><span>
</span><span id="line-1007"></span><span>    </span><span id="local-6989586621683038946"><span class="annot"><a href="#local-6989586621683038946"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683038944"><span class="hs-identifier hs-type">tcs</span></a></span><span>
</span><span id="line-1008"></span><span>    </span><span id="local-6989586621683038947"><span class="annot"><a href="#local-6989586621683038947"><span class="hs-identifier hs-var">new_inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-type">getInertSet</span></a></span><span>
</span><span id="line-1009"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038946"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683038947"><span class="hs-identifier hs-type">new_inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1010"></span><span>
</span><span id="line-1011"></span><span id="local-6989586621683037507"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-type">runTcSWithEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1012"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037507"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1013"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037507"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1014"></span><span id="runTcSWithEvBinds"><span class="annot"><span class="annottext">runTcSWithEvBinds :: forall a. EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var hs-var">runTcSWithEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; EvBindsVar -&gt; TcS a -&gt; TcM a
forall a. Bool -&gt; Bool -&gt; EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-var">runTcSWithEvBinds'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span id="local-6989586621683037510"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-type">runTcSWithEvBinds'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ Restore type variable cycles afterwards?</span><span>
</span><span id="line-1017"></span><span>                           </span><span class="hs-comment">-- Don't if you want to reuse the InertSet.</span><span>
</span><span id="line-1018"></span><span>                           </span><span class="hs-comment">-- See also Note [Type equality cycles]</span><span>
</span><span id="line-1019"></span><span>                           </span><span class="hs-comment">-- in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-1020"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1021"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1022"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037510"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1023"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037510"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1024"></span><span id="runTcSWithEvBinds%27"><span class="annot"><span class="annottext">runTcSWithEvBinds' :: forall a. Bool -&gt; Bool -&gt; EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-var hs-var">runTcSWithEvBinds'</span></a></span></span><span> </span><span id="local-6989586621683038976"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683038976"><span class="hs-identifier hs-var">restore_cycles</span></a></span></span><span> </span><span id="local-6989586621683038977"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683038977"><span class="hs-identifier hs-var">abort_on_insoluble</span></a></span></span><span> </span><span id="local-6989586621683038978"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683038978"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span id="local-6989586621683038979"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621683038979"><span class="hs-identifier hs-var">tcs</span></a></span></span><span>
</span><span id="line-1025"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038980"><span class="annot"><a href="#local-6989586621683038980"><span class="hs-identifier hs-var">unified_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef Int)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1026"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038982"><span class="annot"><a href="#local-6989586621683038982"><span class="hs-identifier hs-var">step_count</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-1027"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038983"><span class="annot"><a href="#local-6989586621683038983"><span class="hs-identifier hs-var">inert_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyInert"><span class="hs-identifier hs-type">emptyInert</span></a></span><span>
</span><span id="line-1028"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038985"><span class="annot"><a href="#local-6989586621683038985"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyWorkList"><span class="hs-identifier hs-type">emptyWorkList</span></a></span><span>
</span><span id="line-1029"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038987"><span class="annot"><a href="#local-6989586621683038987"><span class="hs-identifier hs-var">unif_lvl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1030"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683038988"><span class="annot"><a href="#local-6989586621683038988"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_ev_binds :: EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683038978"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-1031"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unified :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621683038980"><span class="hs-identifier hs-var">unified_var</span></a></span><span>
</span><span id="line-1032"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unif_lvl :: IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621683038987"><span class="hs-identifier hs-var">unif_lvl_var</span></a></span><span>
</span><span id="line-1033"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_count :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621683038982"><span class="hs-identifier hs-var">step_count</span></a></span><span>
</span><span id="line-1034"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621683038983"><span class="hs-identifier hs-var">inert_var</span></a></span><span>
</span><span id="line-1035"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_abort_on_insoluble :: Bool
</span><a href="GHC.Tc.Solver.Monad.html#tcs_abort_on_insoluble"><span class="hs-identifier hs-var">tcs_abort_on_insoluble</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683038977"><span class="hs-identifier hs-var">abort_on_insoluble</span></a></span><span>
</span><span id="line-1036"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_worklist :: IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621683038985"><span class="hs-identifier hs-var">wl_var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span>             </span><span class="hs-comment">-- Run the computation</span><span>
</span><span id="line-1039"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038989"><span class="annot"><a href="#local-6989586621683038989"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var">unTcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038979"><span class="hs-identifier hs-type">tcs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038988"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683038990"><span class="annot"><a href="#local-6989586621683038990"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038982"><span class="hs-identifier hs-type">step_count</span></a></span><span>
</span><span id="line-1042"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683038990"><span class="hs-identifier hs-type">count</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1043"></span><span>         </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-type">csTraceTcM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Constraint solver steps =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-type">int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038990"><span class="hs-identifier hs-type">count</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621683038976"><span class="hs-identifier hs-type">restore_cycles</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1046"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683038992"><span class="annot"><a href="#local-6989586621683038992"><span class="hs-identifier hs-var">inert_set</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038983"><span class="hs-identifier hs-type">inert_var</span></a></span><span>
</span><span id="line-1047"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-type">restoreTyVarCycles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683038992"><span class="hs-identifier hs-type">inert_set</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-cpp">

#if defined(DEBUG)
</span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">TcM.getTcEvBindsMap</span><span> </span><span class="hs-identifier">ev_binds_var</span><span>
</span><span id="line-1051"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-identifier">ev_binds</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1054"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683038989"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span class="hs-comment">----------------------------</span><span class="hs-cpp">
#if defined(DEBUG)
</span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">EvBindMap</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-identifier">ev_binds_map</span><span>
</span><span id="line-1060"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">cycles</span><span>
</span><span id="line-1061"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1062"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">coercion_cycles</span><span>
</span><span id="line-1063"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TcM.traceTc</span><span> </span><span class="hs-string">&quot;Cycle in evidence binds&quot;</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cycles</span><span>
</span><span id="line-1064"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>
</span><span id="line-1065"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;Cycle in coercion bindings&quot;</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">coercion_cycles</span><span>
</span><span id="line-1066"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1067"></span><span>    </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">evBindMapBinds</span><span> </span><span class="hs-identifier">ev_binds_map</span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span>    </span><span class="hs-identifier">cycles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier">EvBind</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1070"></span><span>    </span><span class="hs-identifier">cycles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CyclicSCC</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">stronglyConnCompFromEdgedVerticesUniq</span><span> </span><span class="hs-identifier">edges</span><span class="hs-special">]</span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span>    </span><span class="hs-identifier">coercion_cycles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">cycles</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">is_co_bind</span><span> </span><span class="hs-identifier">c</span><span class="hs-special">]</span><span>
</span><span id="line-1073"></span><span>    </span><span class="hs-identifier">is_co_bind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">EvBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isEqPrimPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span>    </span><span class="hs-identifier">edges</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">Node</span><span> </span><span class="hs-identifier">EvVar</span><span> </span><span class="hs-identifier">EvBind</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1076"></span><span>    </span><span class="hs-identifier">edges</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">DigraphNode</span><span> </span><span class="hs-identifier">bind</span><span> </span><span class="hs-identifier">bndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nonDetEltsUniqSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">evVarsOfTerm</span><span> </span><span class="hs-identifier">rhs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">bind</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">EvBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bndr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eb_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rhs</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">bagToList</span><span> </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1078"></span><span>            </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here as</span><span>
</span><span id="line-1079"></span><span>            </span><span class="hs-comment">-- stronglyConnCompFromEdgedVertices is still deterministic even</span><span>
</span><span id="line-1080"></span><span>            </span><span class="hs-comment">-- if the edges are in nondeterministic order as explained in</span><span>
</span><span id="line-1081"></span><span>            </span><span class="hs-comment">-- Note [Deterministic SCC] in GHC.Data.Graph.Directed.</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1084"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1085"></span><span id="local-6989586621683037519"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindsTcS"><span class="hs-identifier hs-type">setEvBindsTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037519"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037519"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1086"></span><span id="setEvBindsTcS"><span class="annot"><span class="annottext">setEvBindsTcS :: forall a. EvBindsVar -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#setEvBindsTcS"><span class="hs-identifier hs-var hs-var">setEvBindsTcS</span></a></span></span><span> </span><span id="local-6989586621683038994"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683038994"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621683038995"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683038995"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683038996"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038996"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683038995"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683038996"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683038994"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span id="local-6989586621683037521"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestImplicTcS"><span class="hs-identifier hs-type">nestImplicTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1090"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037521"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1091"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037521"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1092"></span><span id="nestImplicTcS"><span class="annot"><span class="annottext">nestImplicTcS :: forall a. EvBindsVar -&gt; TcLevel -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#nestImplicTcS"><span class="hs-identifier hs-var hs-var">nestImplicTcS</span></a></span></span><span> </span><span id="local-6989586621683039008"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039008"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621683039009"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039009"><span class="hs-identifier hs-var">inner_tclvl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621683039010"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683039010"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1093"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_unified :: TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039011"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621683039011"><span class="hs-identifier hs-var">unified_var</span></a></span></span><span>
</span><span id="line-1094"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039012"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621683039012"><span class="hs-identifier hs-var">old_inert_var</span></a></span></span><span>
</span><span id="line-1095"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_count :: TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039013"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621683039013"><span class="hs-identifier hs-var">count</span></a></span></span><span>
</span><span id="line-1096"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unif_lvl :: TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039014"><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621683039014"><span class="hs-identifier hs-var">unif_lvl</span></a></span></span><span>
</span><span id="line-1097"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_abort_on_insoluble :: TcSEnv -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#tcs_abort_on_insoluble"><span class="hs-identifier hs-var">tcs_abort_on_insoluble</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039015"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683039015"><span class="hs-identifier hs-var">abort_on_insoluble</span></a></span></span><span>
</span><span id="line-1098"></span><span>                   </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1099"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039016"><span class="annot"><a href="#local-6989586621683039016"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef InertSet -&gt; IOEnv (Env TcGblEnv TcLclEnv) InertSet
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621683039012"><span class="hs-identifier hs-var">old_inert_var</span></a></span><span>
</span><span id="line-1100"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039017"><span class="annot"><a href="#local-6989586621683039017"><span class="hs-identifier hs-var hs-var">nest_inert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683039016"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#pushCycleBreakerVarStack"><span class="hs-identifier hs-type">pushCycleBreakerVarStack</span></a></span><span>
</span><span id="line-1101"></span><span>                                                            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039016"><span class="hs-identifier hs-type">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039016"><span class="hs-identifier hs-type">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>                                                   </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1104"></span><span>                 </span><span class="hs-comment">-- All other InertSet fields are inherited</span><span>
</span><span id="line-1105"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039020"><span class="annot"><a href="#local-6989586621683039020"><span class="hs-identifier hs-var">new_inert_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039017"><span class="hs-identifier hs-type">nest_inert</span></a></span><span>
</span><span id="line-1106"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039021"><span class="annot"><a href="#local-6989586621683039021"><span class="hs-identifier hs-var">new_wl_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyWorkList"><span class="hs-identifier hs-type">emptyWorkList</span></a></span><span>
</span><span id="line-1107"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039022"><span class="annot"><a href="#local-6989586621683039022"><span class="hs-identifier hs-var hs-var">nest_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_count :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621683039013"><span class="hs-identifier hs-var">count</span></a></span><span>     </span><span class="hs-comment">-- Inherited</span><span>
</span><span id="line-1108"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unif_lvl :: IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621683039014"><span class="hs-identifier hs-var">unif_lvl</span></a></span><span>  </span><span class="hs-comment">-- Inherited</span><span>
</span><span id="line-1109"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_ev_binds :: EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039008"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1110"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unified :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621683039011"><span class="hs-identifier hs-var">unified_var</span></a></span><span>
</span><span id="line-1111"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621683039020"><span class="hs-identifier hs-var">new_inert_var</span></a></span><span>
</span><span id="line-1112"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_abort_on_insoluble :: Bool
</span><a href="GHC.Tc.Solver.Monad.html#tcs_abort_on_insoluble"><span class="hs-identifier hs-var">tcs_abort_on_insoluble</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683039015"><span class="hs-identifier hs-var">abort_on_insoluble</span></a></span><span>
</span><span id="line-1113"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_worklist :: IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621683039021"><span class="hs-identifier hs-var">new_wl_var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1114"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039023"><span class="annot"><a href="#local-6989586621683039023"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier hs-type">TcM.setTcLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039009"><span class="hs-identifier hs-type">inner_tclvl</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1115"></span><span>                </span><span class="annot"><a href="#local-6989586621683039010"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039022"><span class="hs-identifier hs-type">nest_env</span></a></span><span>
</span><span id="line-1116"></span><span>
</span><span id="line-1117"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039025"><span class="annot"><a href="#local-6989586621683039025"><span class="hs-identifier hs-var">out_inert_set</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039020"><span class="hs-identifier hs-type">new_inert_var</span></a></span><span>
</span><span id="line-1118"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-type">restoreTyVarCycles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039025"><span class="hs-identifier hs-type">out_inert_set</span></a></span><span class="hs-cpp">

#if defined(DEBUG)
</span><span>       </span><span class="hs-comment">-- Perform a check that the thing_inside did not cause cycles</span><span>
</span><span id="line-1122"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">TcM.getTcEvBindsMap</span><span> </span><span class="hs-identifier">ref</span><span>
</span><span id="line-1123"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-identifier">ev_binds</span><span class="hs-cpp">
#endif
</span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683039023"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span id="local-6989586621683037525"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestTcS"><span class="hs-identifier hs-type">nestTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037525"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037525"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1128"></span><span class="hs-comment">-- Use the current untouchables, augmenting the current</span><span>
</span><span id="line-1129"></span><span class="hs-comment">-- evidence bindings, and solved dictionaries</span><span>
</span><span id="line-1130"></span><span class="hs-comment">-- But have no effect on the InertCans, or on the inert_famapp_cache</span><span>
</span><span id="line-1131"></span><span class="hs-comment">-- (we want to inherit the latter from processing the Givens)</span><span>
</span><span id="line-1132"></span><span id="nestTcS"><span class="annot"><span class="annottext">nestTcS :: forall a. TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#nestTcS"><span class="hs-identifier hs-var hs-var">nestTcS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621683039038"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683039038"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM a) -&gt; TcS a
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM a) -&gt; TcS a) -&gt; (TcSEnv -&gt; TcM a) -&gt; TcS a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683039039"><span class="annot"><span class="annottext">env :: TcSEnv
</span><a href="#local-6989586621683039039"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039040"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621683039040"><span class="hs-identifier hs-var">inerts_var</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1134"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039041"><span class="annot"><a href="#local-6989586621683039041"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef InertSet -&gt; IOEnv (Env TcGblEnv TcLclEnv) InertSet
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621683039040"><span class="hs-identifier hs-var">inerts_var</span></a></span><span>
</span><span id="line-1135"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039042"><span class="annot"><a href="#local-6989586621683039042"><span class="hs-identifier hs-var">new_inert_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039041"><span class="hs-identifier hs-type">inerts</span></a></span><span>
</span><span id="line-1136"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039043"><span class="annot"><a href="#local-6989586621683039043"><span class="hs-identifier hs-var">new_wl_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyWorkList"><span class="hs-identifier hs-type">emptyWorkList</span></a></span><span>
</span><span id="line-1137"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039044"><span class="annot"><a href="#local-6989586621683039044"><span class="hs-identifier hs-var hs-var">nest_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039039"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039042"><span class="hs-identifier hs-type">new_inert_var</span></a></span><span>
</span><span id="line-1138"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039043"><span class="hs-identifier hs-type">new_wl_var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039045"><span class="annot"><a href="#local-6989586621683039045"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683039038"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039044"><span class="hs-identifier hs-type">nest_env</span></a></span><span>
</span><span id="line-1141"></span><span>
</span><span id="line-1142"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039046"><span class="annot"><a href="#local-6989586621683039046"><span class="hs-identifier hs-var">new_inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039042"><span class="hs-identifier hs-type">new_inert_var</span></a></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>       </span><span class="hs-comment">-- we want to propagate the safe haskell failures</span><span>
</span><span id="line-1145"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039047"><span class="annot"><a href="#local-6989586621683039047"><span class="hs-identifier hs-var hs-var">old_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683039041"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-1146"></span><span>             </span><span id="local-6989586621683039048"><span class="annot"><a href="#local-6989586621683039048"><span class="hs-identifier hs-var hs-var">new_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683039046"><span class="hs-identifier hs-var">new_inerts</span></a></span><span>
</span><span id="line-1147"></span><span>             </span><span id="local-6989586621683039049"><span class="annot"><a href="#local-6989586621683039049"><span class="hs-identifier hs-var hs-var">nxt_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621683039047"><span class="hs-identifier hs-var">old_ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039048"><span class="hs-identifier hs-type">new_ic</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039040"><span class="hs-identifier hs-type">inerts_var</span></a></span><span>  </span><span class="hs-comment">-- See Note [Propagate the solved dictionaries]</span><span>
</span><span id="line-1150"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039041"><span class="hs-identifier hs-type">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039046"><span class="hs-identifier hs-type">new_inerts</span></a></span><span>
</span><span id="line-1151"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039049"><span class="hs-identifier hs-type">nxt_ic</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683039045"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier hs-type">emitImplicationTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfoAnon"><span class="hs-identifier hs-type">SkolemInfoAnon</span></a></span><span>
</span><span id="line-1156"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Skolems</span><span>
</span><span id="line-1157"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- Givens</span><span>
</span><span id="line-1158"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>              </span><span class="hs-comment">-- Wanteds</span><span>
</span><span id="line-1159"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-type">TcEvBinds</span></a></span><span>
</span><span id="line-1160"></span><span class="hs-comment">-- Add an implication to the TcS monad work-list</span><span>
</span><span id="line-1161"></span><span id="emitImplicationTcS"><span class="annot"><span class="annottext">emitImplicationTcS :: TcLevel
-&gt; SkolemInfoAnon -&gt; [TcTyVar] -&gt; [TcTyVar] -&gt; Cts -&gt; TcS TcEvBinds
</span><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier hs-var hs-var">emitImplicationTcS</span></a></span></span><span> </span><span id="local-6989586621683039051"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039051"><span class="hs-identifier hs-var">new_tclvl</span></a></span></span><span> </span><span id="local-6989586621683039052"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621683039052"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683039053"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039053"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span> </span><span id="local-6989586621683039054"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039054"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span id="local-6989586621683039055"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039055"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span>
</span><span id="line-1162"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039056"><span class="annot"><span class="annottext">wc :: WantedConstraints
</span><a href="#local-6989586621683039056"><span class="hs-identifier hs-var hs-var hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039055"><span class="hs-identifier hs-type">wanteds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1163"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039059"><span class="annot"><a href="#local-6989586621683039059"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Implication -&gt; TcS Implication
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Implication -&gt; TcS Implication)
-&gt; TcM Implication -&gt; TcS Implication
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1164"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039060"><span class="annot"><a href="#local-6989586621683039060"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-1165"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039061"><span class="annot"><a href="#local-6989586621683039061"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newImplication"><span class="hs-identifier hs-type">TcM.newImplication</span></a></span><span>
</span><span id="line-1166"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039061"><span class="hs-identifier hs-type">imp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_tclvl"><span class="hs-identifier hs-var">ic_tclvl</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039051"><span class="hs-identifier hs-type">new_tclvl</span></a></span><span>
</span><span id="line-1167"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_skols"><span class="hs-identifier hs-var">ic_skols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039053"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span>
</span><span id="line-1168"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_given"><span class="hs-identifier hs-var">ic_given</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039054"><span class="hs-identifier hs-type">givens</span></a></span><span>
</span><span id="line-1169"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039056"><span class="hs-identifier hs-type">wc</span></a></span><span>
</span><span id="line-1170"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039060"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span>
</span><span id="line-1171"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_info"><span class="hs-identifier hs-var">ic_info</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039052"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-type">emitImplication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039059"><span class="hs-identifier hs-type">imp</span></a></span><span>
</span><span id="line-1174"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-type">TcEvBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039059"><span class="hs-identifier hs-type">imp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1175"></span><span>
</span><span id="line-1176"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitTvImplicationTcS"><span class="hs-identifier hs-type">emitTvImplicationTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfoAnon"><span class="hs-identifier hs-type">SkolemInfoAnon</span></a></span><span>
</span><span id="line-1177"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Skolems</span><span>
</span><span id="line-1178"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>              </span><span class="hs-comment">-- Wanteds</span><span>
</span><span id="line-1179"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- Just like emitImplicationTcS but no givens and no bindings</span><span>
</span><span id="line-1181"></span><span id="emitTvImplicationTcS"><span class="annot"><span class="annottext">emitTvImplicationTcS :: TcLevel -&gt; SkolemInfoAnon -&gt; [TcTyVar] -&gt; Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitTvImplicationTcS"><span class="hs-identifier hs-var hs-var">emitTvImplicationTcS</span></a></span></span><span> </span><span id="local-6989586621683039071"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039071"><span class="hs-identifier hs-var">new_tclvl</span></a></span></span><span> </span><span id="local-6989586621683039072"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621683039072"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683039073"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039073"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span> </span><span id="local-6989586621683039074"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039074"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span>
</span><span id="line-1182"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039075"><span class="annot"><span class="annottext">wc :: WantedConstraints
</span><a href="#local-6989586621683039075"><span class="hs-identifier hs-var hs-var hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039074"><span class="hs-identifier hs-type">wanteds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1183"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039076"><span class="annot"><a href="#local-6989586621683039076"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Implication -&gt; TcS Implication
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Implication -&gt; TcS Implication)
-&gt; TcM Implication -&gt; TcS Implication
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1184"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039077"><span class="annot"><a href="#local-6989586621683039077"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var">TcM.newNoTcEvBinds</span></a></span><span>
</span><span id="line-1185"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039078"><span class="annot"><a href="#local-6989586621683039078"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newImplication"><span class="hs-identifier hs-type">TcM.newImplication</span></a></span><span>
</span><span id="line-1186"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039078"><span class="hs-identifier hs-type">imp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_tclvl"><span class="hs-identifier hs-var">ic_tclvl</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039071"><span class="hs-identifier hs-type">new_tclvl</span></a></span><span>
</span><span id="line-1187"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_skols"><span class="hs-identifier hs-var">ic_skols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039073"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span>
</span><span id="line-1188"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039075"><span class="hs-identifier hs-type">wc</span></a></span><span>
</span><span id="line-1189"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039077"><span class="hs-identifier hs-type">ev_binds_var</span></a></span><span>
</span><span id="line-1190"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_info"><span class="hs-identifier hs-var">ic_info</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039072"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-type">emitImplication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039076"><span class="hs-identifier hs-type">imp</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span>
</span><span id="line-1195"></span><span class="hs-comment">{- Note [Propagate the solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's really quite important that nestTcS does not discard the solved
dictionaries from the thing_inside.
Consider
   Eq [a]
   forall b. empty =&gt;  Eq [a]
We solve the simple (Eq [a]), under nestTcS, and then turn our attention to
the implications.  It's definitely fine to use the solved dictionaries on
the inner implications, and it can make a significant performance difference
if you do so.
-}</span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span class="hs-comment">-- Getters and setters of GHC.Tc.Utils.Env fields</span><span>
</span><span id="line-1209"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getUnifiedRef"><span class="hs-identifier hs-type">getUnifiedRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span id="getUnifiedRef"><span class="annot"><span class="annottext">getUnifiedRef :: TcS (IORef Int)
</span><a href="GHC.Tc.Solver.Monad.html#getUnifiedRef"><span class="hs-identifier hs-var hs-var">getUnifiedRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef Int))
-&gt; TcS (IORef Int)
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef Int)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(IORef Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef Int))
-&gt; (TcSEnv -&gt; IORef Int)
-&gt; TcSEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef Int)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span class="hs-comment">-- Getter of inerts and worklist</span><span>
</span><span id="line-1215"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertSetRef"><span class="hs-identifier hs-type">getInertSetRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span id="getInertSetRef"><span class="annot"><span class="annottext">getInertSetRef :: TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getInertSetRef"><span class="hs-identifier hs-var hs-var">getInertSetRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef InertSet))
-&gt; TcS (IORef InertSet)
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef InertSet -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef InertSet)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(IORef InertSet -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef InertSet))
-&gt; (TcSEnv -&gt; IORef InertSet)
-&gt; TcSEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef InertSet)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-type">getInertSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span>
</span><span id="line-1219"></span><span id="getInertSet"><span class="annot"><span class="annottext">getInertSet :: TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getInertSet"><span class="hs-identifier hs-var hs-var">getInertSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getInertSetRef"><span class="hs-identifier hs-var">getInertSetRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
-&gt; (IORef InertSet -&gt; TcS InertSet) -&gt; TcS InertSet
forall a b. TcS a -&gt; (a -&gt; TcS b) -&gt; TcS b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IORef InertSet -&gt; TcS InertSet
forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span>
</span><span id="line-1220"></span><span>
</span><span id="line-1221"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertSet"><span class="hs-identifier hs-type">setInertSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span id="setInertSet"><span class="annot"><span class="annottext">setInertSet :: InertSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setInertSet"><span class="hs-identifier hs-var hs-var">setInertSet</span></a></span></span><span> </span><span id="local-6989586621683039080"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683039080"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039081"><span class="annot"><a href="#local-6989586621683039081"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getInertSetRef"><span class="hs-identifier hs-var">getInertSetRef</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039081"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039080"><span class="hs-identifier hs-type">is</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-type">getTcSWorkListRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1225"></span><span id="getTcSWorkListRef"><span class="annot"><span class="annottext">getTcSWorkListRef :: TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var hs-var">getTcSWorkListRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef WorkList))
-&gt; TcS (IORef WorkList)
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef WorkList -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef WorkList)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(IORef WorkList -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef WorkList))
-&gt; (TcSEnv -&gt; IORef WorkList)
-&gt; TcSEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef WorkList)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getWorkListImplics"><span class="hs-identifier hs-type">getWorkListImplics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span id="getWorkListImplics"><span class="annot"><span class="annottext">getWorkListImplics :: TcS (Bag Implication)
</span><a href="GHC.Tc.Solver.Monad.html#getWorkListImplics"><span class="hs-identifier hs-var hs-var">getWorkListImplics</span></a></span></span><span>
</span><span id="line-1229"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039083"><span class="annot"><a href="#local-6989586621683039083"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-1230"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039084"><span class="annot"><a href="#local-6989586621683039084"><span class="hs-identifier hs-var">wl_curr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039083"><span class="hs-identifier hs-type">wl_var</span></a></span><span>
</span><span id="line-1231"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039084"><span class="hs-identifier hs-type">wl_curr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span id="local-6989586621683037532"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier hs-type">pushLevelNoWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037532"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683037532"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1234"></span><span class="hs-comment">-- Push the level and run thing_inside</span><span>
</span><span id="line-1235"></span><span class="hs-comment">-- However, thing_inside should not generate any work items</span><span class="hs-cpp">
#if defined(DEBUG)
</span><span class="hs-identifier">pushLevelNoWorkList</span><span> </span><span class="hs-identifier">err_doc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TcS</span><span> </span><span class="hs-identifier">thing_inside</span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TcS</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM.pushTcLevelM</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-1239"></span><span>                 </span><span class="hs-identifier">thing_inside</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">env</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_worklist</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">wl_panic</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1240"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1242"></span><span>    </span><span class="hs-identifier">wl_panic</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;GHC.Tc.Solver.Monad.buildImplication&quot;</span><span> </span><span class="hs-identifier">err_doc</span><span>
</span><span id="line-1243"></span><span>                         </span><span class="hs-comment">-- This panic checks that the thing-inside</span><span>
</span><span id="line-1244"></span><span>                         </span><span class="hs-comment">-- does not emit any work-list constraints</span><span class="hs-cpp">
#else
</span><span id="pushLevelNoWorkList"><span class="annot"><span class="annottext">pushLevelNoWorkList :: forall a. SDoc -&gt; TcS a -&gt; TcS (TcLevel, a)
</span><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier hs-var hs-var">pushLevelNoWorkList</span></a></span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621683039086"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683039086"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1247"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM (TcLevel, a)) -&gt; TcS (TcLevel, a)
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683039087"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039087"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (TcLevel, a)
forall a. TcM a -&gt; TcM (TcLevel, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-var">TcM.pushTcLevelM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683039086"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039087"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Don't check</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1250"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-type">updWorkListTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span id="updWorkListTcS"><span class="annot"><span class="annottext">updWorkListTcS :: (WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var hs-var">updWorkListTcS</span></a></span></span><span> </span><span id="local-6989586621683039089"><span class="annot"><span class="annottext">WorkList -&gt; WorkList
</span><a href="#local-6989586621683039089"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-1252"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039090"><span class="annot"><a href="#local-6989586621683039090"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-1253"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039090"><span class="hs-identifier hs-type">wl_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039089"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-type">emitWorkNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span id="emitWorkNC"><span class="annot"><span class="annottext">emitWorkNC :: [CtEvidence] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-var hs-var">emitWorkNC</span></a></span></span><span> </span><span id="local-6989586621683039091"><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621683039091"><span class="hs-identifier hs-var">evs</span></a></span></span><span>
</span><span id="line-1257"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[CtEvidence] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621683039091"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-1258"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1260"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; Cts
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; [CtEvidence] -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621683039091"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span>
</span><span id="line-1262"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-type">emitWork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1263"></span><span id="emitWork"><span class="annot"><span class="annottext">emitWork :: Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var hs-var">emitWork</span></a></span></span><span> </span><span id="local-6989586621683039094"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039094"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-1264"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039094"><span class="hs-identifier hs-var">cts</span></a></span><span>    </span><span class="hs-comment">-- Avoid printing, among other work</span><span>
</span><span id="line-1265"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Emitting fresh work&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cts -&gt; SDoc
forall a. Outputable a =&gt; Bag a -&gt; SDoc
</span><a href="GHC.Data.Bag.html#pprBag"><span class="hs-identifier hs-var">pprBag</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039094"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>         </span><span class="hs-comment">-- Zonk the rewriter set of Wanteds, because that affects</span><span>
</span><span id="line-1269"></span><span>         </span><span class="hs-comment">-- the prioritisation of the work-list. Suppose a constraint</span><span>
</span><span id="line-1270"></span><span>         </span><span class="hs-comment">-- c1 is rewritten by another, c2.  When c2 gets solved,</span><span>
</span><span id="line-1271"></span><span>         </span><span class="hs-comment">-- c1 has no rewriters, and can be prioritised; see</span><span>
</span><span id="line-1272"></span><span>         </span><span class="hs-comment">-- Note [Prioritise Wanteds with empty RewriterSet]</span><span>
</span><span id="line-1273"></span><span>         </span><span class="hs-comment">-- in GHC.Tc.Types.Constraint wrinkle (WRW1)</span><span>
</span><span id="line-1274"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039096"><span class="annot"><a href="#local-6989586621683039096"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Cts -&gt; TcS Cts
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Cts -&gt; TcS Cts) -&gt; TcM Cts -&gt; TcS Cts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; IOEnv (Env TcGblEnv TcLclEnv) Ct) -&gt; Cts -&gt; TcM Cts
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Bag a -&gt; m (Bag b)
</span><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; IOEnv (Env TcGblEnv TcLclEnv) Ct
</span><a href="GHC.Tc.Zonk.Type.html#zonkCtRewriterSet"><span class="hs-identifier hs-var">TcM.zonkCtRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039094"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-1275"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-type">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCts"><span class="hs-identifier hs-type">extendWorkListCts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039096"><span class="hs-identifier hs-type">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-type">emitImplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1278"></span><span id="emitImplication"><span class="annot"><span class="annottext">emitImplication :: Implication -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-var hs-var">emitImplication</span></a></span></span><span> </span><span id="local-6989586621683039099"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621683039099"><span class="hs-identifier hs-var">implic</span></a></span></span><span>
</span><span id="line-1279"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Implication -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListImplic"><span class="hs-identifier hs-var">extendWorkListImplic</span></a></span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621683039099"><span class="hs-identifier hs-var">implic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span id="local-6989586621683037541"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcRef"><span class="hs-identifier hs-type">newTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621683037541"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1282"></span><span id="newTcRef"><span class="annot"><span class="annottext">newTcRef :: forall a. a -&gt; TcS (TcRef a)
</span><a href="GHC.Tc.Solver.Monad.html#newTcRef"><span class="hs-identifier hs-var hs-var">newTcRef</span></a></span></span><span> </span><span id="local-6989586621683039102"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683039102"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (TcRef a) -&gt; TcS (TcRef a)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcM (TcRef a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683039102"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span>
</span><span id="line-1284"></span><span id="local-6989586621683037530"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037530"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037530"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1285"></span><span id="readTcRef"><span class="annot"><span class="annottext">readTcRef :: forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var hs-var">readTcRef</span></a></span></span><span> </span><span id="local-6989586621683039104"><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621683039104"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcS a
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRef a -&gt; TcM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621683039104"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span id="local-6989586621683037531"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037531"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683037531"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1288"></span><span id="writeTcRef"><span class="annot"><span class="annottext">writeTcRef :: forall a. TcRef a -&gt; a -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-var hs-var">writeTcRef</span></a></span></span><span> </span><span id="local-6989586621683039106"><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621683039106"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621683039107"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683039107"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRef a -&gt; a -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621683039106"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683039107"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1289"></span><span>
</span><span id="line-1290"></span><span id="local-6989586621683037535"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037535"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037535"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="#local-6989586621683037535"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1291"></span><span id="updTcRef"><span class="annot"><span class="annottext">updTcRef :: forall a. TcRef a -&gt; (a -&gt; a) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier hs-var hs-var">updTcRef</span></a></span></span><span> </span><span id="local-6989586621683039109"><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621683039109"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621683039110"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621683039110"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRef a -&gt; (a -&gt; a) -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-var">TcM.updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621683039109"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621683039110"><span class="hs-identifier hs-var">upd_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-type">getTcEvBindsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1294"></span><span id="getTcEvBindsVar"><span class="annot"><span class="annottext">getTcEvBindsVar :: TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var hs-var">getTcEvBindsVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM EvBindsVar) -&gt; TcS EvBindsVar
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindsVar
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(EvBindsVar -&gt; TcM EvBindsVar)
-&gt; (TcSEnv -&gt; EvBindsVar) -&gt; TcSEnv -&gt; TcM EvBindsVar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1295"></span><span>
</span><span id="line-1296"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-1297"></span><span id="getTcLevel"><span class="annot"><span class="annottext">getTcLevel :: TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var hs-var">getTcLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel -&gt; TcS TcLevel
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">TcM.getTcLevel</span></a></span><span>
</span><span id="line-1298"></span><span>
</span><span id="line-1299"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-type">getTcEvTyCoVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>
</span><span id="line-1300"></span><span id="getTcEvTyCoVars"><span class="annot"><span class="annottext">getTcEvTyCoVars :: EvBindsVar -&gt; TcS VarSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-var hs-var">getTcEvTyCoVars</span></a></span></span><span> </span><span id="local-6989586621683039113"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039113"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span>
</span><span id="line-1301"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM VarSet -&gt; TcS VarSet
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM VarSet -&gt; TcS VarSet) -&gt; TcM VarSet -&gt; TcS VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM VarSet
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-var">TcM.getTcEvTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039113"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-1302"></span><span>
</span><span id="line-1303"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-type">getTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span>
</span><span id="line-1304"></span><span id="getTcEvBindsMap"><span class="annot"><span class="annottext">getTcEvBindsMap :: EvBindsVar -&gt; TcS EvBindMap
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var hs-var">getTcEvBindsMap</span></a></span></span><span> </span><span id="local-6989586621683039115"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039115"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM EvBindMap -&gt; TcS EvBindMap
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM EvBindMap -&gt; TcS EvBindMap) -&gt; TcM EvBindMap -&gt; TcS EvBindMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindMap
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var">TcM.getTcEvBindsMap</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039115"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-1306"></span><span>
</span><span id="line-1307"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-type">setTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1308"></span><span id="setTcEvBindsMap"><span class="annot"><span class="annottext">setTcEvBindsMap :: EvBindsVar -&gt; EvBindMap -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var hs-var">setTcEvBindsMap</span></a></span></span><span> </span><span id="local-6989586621683039116"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039116"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span id="local-6989586621683039117"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621683039117"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-1309"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ()) -&gt; TcM () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; EvBindMap -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var">TcM.setTcEvBindsMap</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039116"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621683039117"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1310"></span><span>
</span><span id="line-1311"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyTyVar"><span class="hs-identifier hs-type">unifyTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1312"></span><span class="hs-comment">-- Unify a meta-tyvar with a type</span><span>
</span><span id="line-1313"></span><span class="hs-comment">-- We keep track of how many unifications have happened in tcs_unified,</span><span>
</span><span id="line-1314"></span><span class="hs-comment">--</span><span>
</span><span id="line-1315"></span><span class="hs-comment">-- We should never unify the same variable twice!</span><span>
</span><span id="line-1316"></span><span id="unifyTyVar"><span class="annot"><span class="annottext">unifyTyVar :: TcTyVar -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#unifyTyVar"><span class="hs-identifier hs-var hs-var">unifyTyVar</span></a></span></span><span> </span><span id="local-6989586621683039120"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039120"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683039121"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039121"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1317"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcS () -&gt; TcS ()
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039120"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039120"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS () -&gt; TcS ()) -&gt; TcS () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1318"></span><span>    </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM ()) -&gt; TcS ()) -&gt; (TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683039123"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039123"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1319"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unifyTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039120"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039121"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1320"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcM ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">TcM.liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcM ()) -&gt; ZonkM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcTyVar -&gt; Type -&gt; ZonkM ()
TcTyVar -&gt; Type -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">TcM.writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039120"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039121"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1321"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef Int -&gt; (Int -&gt; Int) -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-var">TcM.updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039123"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1322"></span><span>
</span><span id="line-1323"></span><span id="local-6989586621683037548"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#reportUnifications"><span class="hs-identifier hs-type">reportUnifications</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037548"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683037548"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1324"></span><span class="hs-comment">-- Record how many unifications are done by thing_inside</span><span>
</span><span id="line-1325"></span><span class="hs-comment">-- We could return a Bool instead of an Int;</span><span>
</span><span id="line-1326"></span><span class="hs-comment">-- all that matters is whether it is no-zero</span><span>
</span><span id="line-1327"></span><span id="reportUnifications"><span class="annot"><span class="annottext">reportUnifications :: forall a. TcS a -&gt; TcS (Int, a)
</span><a href="GHC.Tc.Solver.Monad.html#reportUnifications"><span class="hs-identifier hs-var hs-var">reportUnifications</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621683039135"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621683039135"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1328"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM (Int, a)) -&gt; TcS (Int, a)
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM (Int, a)) -&gt; TcS (Int, a))
-&gt; (TcSEnv -&gt; TcM (Int, a)) -&gt; TcS (Int, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683039136"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039136"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1329"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039137"><span class="annot"><a href="#local-6989586621683039137"><span class="hs-identifier hs-var">inner_unified</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef Int)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1330"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039138"><span class="annot"><a href="#local-6989586621683039138"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683039135"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039136"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039137"><span class="hs-identifier hs-type">inner_unified</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1331"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039139"><span class="annot"><a href="#local-6989586621683039139"><span class="hs-identifier hs-var">n_unifs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039137"><span class="hs-identifier hs-type">inner_unified</span></a></span><span>
</span><span id="line-1332"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">TcM.updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039136"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">+</span></span><span> </span><span class="annot"><span class="hs-identifier">n_unifs</span></span><span class="hs-special">)</span><span>
</span><span id="line-1333"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039139"><span class="hs-identifier hs-type">n_unifs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039138"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1334"></span><span>
</span><span id="line-1335"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getDefaultInfo"><span class="hs-identifier hs-type">getDefaultInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier hs-type">DefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-1336"></span><span id="getDefaultInfo"><span class="annot"><span class="annottext">getDefaultInfo :: TcS (DefaultEnv, Bool)
</span><a href="GHC.Tc.Solver.Monad.html#getDefaultInfo"><span class="hs-identifier hs-var hs-var">getDefaultInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (DefaultEnv, Bool) -&gt; TcS (DefaultEnv, Bool)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM (DefaultEnv, Bool)
</span><a href="GHC.Tc.Utils.Env.html#tcGetDefaultTys"><span class="hs-identifier hs-var">TcM.tcGetDefaultTys</span></a></span><span>
</span><span id="line-1337"></span><span>
</span><span id="line-1338"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getWorkList"><span class="hs-identifier hs-type">getWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-1339"></span><span id="getWorkList"><span class="annot"><span class="annottext">getWorkList :: TcS WorkList
</span><a href="GHC.Tc.Solver.Monad.html#getWorkList"><span class="hs-identifier hs-var hs-var">getWorkList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039140"><span class="annot"><a href="#local-6989586621683039140"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-1340"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039140"><span class="hs-identifier hs-type">wl_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1341"></span><span>
</span><span id="line-1342"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#selectNextWorkItem"><span class="hs-identifier hs-type">selectNextWorkItem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span class="hs-comment">-- Pick which work item to do next</span><span>
</span><span id="line-1344"></span><span class="hs-comment">-- See Note [Prioritise equalities]</span><span>
</span><span id="line-1345"></span><span id="selectNextWorkItem"><span class="annot"><span class="annottext">selectNextWorkItem :: TcS (Maybe Ct)
</span><a href="GHC.Tc.Solver.Monad.html#selectNextWorkItem"><span class="hs-identifier hs-var hs-var">selectNextWorkItem</span></a></span></span><span>
</span><span id="line-1346"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039141"><span class="annot"><a href="#local-6989586621683039141"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-1347"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039142"><span class="annot"><a href="#local-6989586621683039142"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039141"><span class="hs-identifier hs-type">wl_var</span></a></span><span>
</span><span id="line-1348"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#selectWorkItem"><span class="hs-identifier hs-type">selectWorkItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039142"><span class="hs-identifier hs-type">wl</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1349"></span><span>           </span><span class="annot"><span class="annottext">Maybe (Ct, WorkList)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Ct -&gt; TcS (Maybe Ct)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Ct
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1350"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039144"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683039144"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039145"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621683039145"><span class="hs-identifier hs-var">new_wl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1351"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- checkReductionDepth (ctLoc ct) (ctPred ct)</span><span>
</span><span id="line-1352"></span><span>         </span><span class="hs-comment">-- This is done by GHC.Tc.Solver.Dict.chooseInstance</span><span>
</span><span id="line-1353"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef WorkList -&gt; WorkList -&gt; TcS ()
forall a. TcRef a -&gt; a -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621683039141"><span class="hs-identifier hs-var">wl_var</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621683039145"><span class="hs-identifier hs-var">new_wl</span></a></span><span>
</span><span id="line-1354"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Ct -&gt; TcS (Maybe Ct)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Maybe Ct
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683039144"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1355"></span><span>
</span><span id="line-1356"></span><span class="hs-comment">-- Just get some environments needed for instance looking up and matching</span><span>
</span><span id="line-1357"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1358"></span><span>
</span><span id="line-1359"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInstEnvs"><span class="hs-identifier hs-type">getInstEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnvs"><span class="hs-identifier hs-type">InstEnvs</span></a></span><span>
</span><span id="line-1360"></span><span id="getInstEnvs"><span class="annot"><span class="annottext">getInstEnvs :: TcS InstEnvs
</span><a href="GHC.Tc.Solver.Monad.html#getInstEnvs"><span class="hs-identifier hs-var hs-var">getInstEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs -&gt; TcS InstEnvs
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM InstEnvs -&gt; TcS InstEnvs) -&gt; TcM InstEnvs -&gt; TcS InstEnvs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">TcM.tcGetInstEnvs</span></a></span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getFamInstEnvs"><span class="hs-identifier hs-type">getFamInstEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1363"></span><span id="getFamInstEnvs"><span class="annot"><span class="annottext">getFamInstEnvs :: TcS (FamInstEnv, FamInstEnv)
</span><a href="GHC.Tc.Solver.Monad.html#getFamInstEnvs"><span class="hs-identifier hs-var hs-var">getFamInstEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (FamInstEnv, FamInstEnv) -&gt; TcS (FamInstEnv, FamInstEnv)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (FamInstEnv, FamInstEnv) -&gt; TcS (FamInstEnv, FamInstEnv))
-&gt; TcM (FamInstEnv, FamInstEnv) -&gt; TcS (FamInstEnv, FamInstEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM (FamInstEnv, FamInstEnv)
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">FamInst.tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1364"></span><span>
</span><span id="line-1365"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1366"></span><span id="getTopEnv"><span class="annot"><span class="annottext">getTopEnv :: TcS HscEnv
</span><a href="GHC.Tc.Solver.Monad.html#getTopEnv"><span class="hs-identifier hs-var hs-var">getTopEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM HscEnv -&gt; TcS HscEnv
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM HscEnv -&gt; TcS HscEnv) -&gt; TcM HscEnv -&gt; TcS HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">TcM.getTopEnv</span></a></span><span>
</span><span id="line-1367"></span><span>
</span><span id="line-1368"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1369"></span><span id="getGblEnv"><span class="annot"><span class="annottext">getGblEnv :: TcS TcGblEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier hs-var hs-var">getGblEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TcGblEnv -&gt; TcS TcGblEnv
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcGblEnv -&gt; TcS TcGblEnv) -&gt; TcM TcGblEnv -&gt; TcS TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">TcM.getGblEnv</span></a></span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getLclEnv"><span class="hs-identifier hs-type">getLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span>
</span><span id="line-1372"></span><span id="getLclEnv"><span class="annot"><span class="annottext">getLclEnv :: TcS TcLclEnv
</span><a href="GHC.Tc.Solver.Monad.html#getLclEnv"><span class="hs-identifier hs-var hs-var">getLclEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TcLclEnv -&gt; TcS TcLclEnv
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcLclEnv -&gt; TcS TcLclEnv) -&gt; TcM TcLclEnv -&gt; TcS TcLclEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">TcM.getLclEnv</span></a></span><span>
</span><span id="line-1373"></span><span>
</span><span id="line-1374"></span><span id="local-6989586621683037562"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setSrcSpan"><span class="hs-identifier hs-type">setSrcSpan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037562"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037562"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1375"></span><span id="setSrcSpan"><span class="annot"><span class="annottext">setSrcSpan :: forall a. RealSrcSpan -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#setSrcSpan"><span class="hs-identifier hs-var hs-var">setSrcSpan</span></a></span></span><span> </span><span id="local-6989586621683039155"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621683039155"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcS a -&gt; TcS a
forall a. (TcM a -&gt; TcM a) -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrap2TcS"><span class="hs-identifier hs-var">wrap2TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM a -&gt; TcM a
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">TcM.setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Maybe BufSpan -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-var">RealSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621683039155"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupClass"><span class="hs-identifier hs-type">tcLookupClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>
</span><span id="line-1378"></span><span id="tcLookupClass"><span class="annot"><span class="annottext">tcLookupClass :: Name -&gt; TcS Class
</span><a href="GHC.Tc.Solver.Monad.html#tcLookupClass"><span class="hs-identifier hs-var hs-var">tcLookupClass</span></a></span></span><span> </span><span id="local-6989586621683039158"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683039158"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Class -&gt; TcS Class
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Class -&gt; TcS Class) -&gt; TcM Class -&gt; TcS Class
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">TcM.tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683039158"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1379"></span><span>
</span><span id="line-1380"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupId"><span class="hs-identifier hs-type">tcLookupId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-1381"></span><span id="tcLookupId"><span class="annot"><span class="annottext">tcLookupId :: Name -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#tcLookupId"><span class="hs-identifier hs-var hs-var">tcLookupId</span></a></span></span><span> </span><span id="local-6989586621683039160"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683039160"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TcTyVar -&gt; TcS TcTyVar
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcTyVar -&gt; TcS TcTyVar) -&gt; TcM TcTyVar -&gt; TcS TcTyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">TcM.tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683039160"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1382"></span><span>
</span><span id="line-1383"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupTyCon"><span class="hs-identifier hs-type">tcLookupTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-1384"></span><span id="tcLookupTyCon"><span class="annot"><span class="annottext">tcLookupTyCon :: Name -&gt; TcS TyCon
</span><a href="GHC.Tc.Solver.Monad.html#tcLookupTyCon"><span class="hs-identifier hs-var hs-var">tcLookupTyCon</span></a></span></span><span> </span><span id="local-6989586621683039161"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683039161"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TyCon -&gt; TcS TyCon
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TyCon -&gt; TcS TyCon) -&gt; TcM TyCon -&gt; TcS TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">TcM.tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683039161"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1385"></span><span>
</span><span id="line-1386"></span><span class="hs-comment">-- Any use of this function is a bit suspect, because it violates the</span><span>
</span><span id="line-1387"></span><span class="hs-comment">-- pure veneer of TcS. But it's just about warnings around unused imports</span><span>
</span><span id="line-1388"></span><span class="hs-comment">-- and local constructors (GHC will issue fewer warnings than it otherwise</span><span>
</span><span id="line-1389"></span><span class="hs-comment">-- might), so it's not worth losing sleep over.</span><span>
</span><span id="line-1390"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#recordUsedGREs"><span class="hs-identifier hs-type">recordUsedGREs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1391"></span><span id="recordUsedGREs"><span class="annot"><span class="annottext">recordUsedGREs :: Bag GlobalRdrElt -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#recordUsedGREs"><span class="hs-identifier hs-var hs-var">recordUsedGREs</span></a></span></span><span> </span><span id="local-6989586621683039162"><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621683039162"><span class="hs-identifier hs-var">gres</span></a></span></span><span>
</span><span id="line-1392"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ()) -&gt; TcM () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings -&gt; [GlobalRdrElt] -&gt; TcM ()
</span><a href="GHC.Rename.Env.html#addUsedGREs"><span class="hs-identifier hs-var">TcM.addUsedGREs</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="GHC.Rename.Utils.html#NoDeprecationWarnings"><span class="hs-identifier hs-var">NoDeprecationWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683039165"><span class="hs-identifier hs-var">gre_list</span></a></span><span>
</span><span id="line-1393"></span><span>         </span><span class="hs-comment">-- If a newtype constructor was imported, don't warn about not</span><span>
</span><span id="line-1394"></span><span>         </span><span class="hs-comment">-- importing it...</span><span>
</span><span id="line-1395"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ()) -&gt; TcM () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; TcM ()) -&gt; [GlobalRdrElt] -&gt; TcM ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var">TcM.keepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcM ())
-&gt; (GlobalRdrElt -&gt; Name) -&gt; GlobalRdrElt -&gt; TcM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683039165"><span class="hs-identifier hs-var">gre_list</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1396"></span><span>         </span><span class="hs-comment">-- ...and similarly, if a newtype constructor was defined in the same</span><span>
</span><span id="line-1397"></span><span>         </span><span class="hs-comment">-- module, don't warn about it being unused.</span><span>
</span><span id="line-1398"></span><span>         </span><span class="hs-comment">-- See Note [Tracking unused binding and imports] in GHC.Tc.Utils.</span><span>
</span><span id="line-1399"></span><span>
</span><span id="line-1400"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1401"></span><span>    </span><span id="local-6989586621683039165"><span class="annot"><span class="annottext">gre_list :: [GlobalRdrElt]
</span><a href="#local-6989586621683039165"><span class="hs-identifier hs-var hs-var">gre_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt -&gt; [GlobalRdrElt]
forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621683039162"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1402"></span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- Various smaller utilities [TODO, maybe will be absorbed in the instance matcher]</span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1405"></span><span>
</span><span id="line-1406"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkWellStagedDFun"><span class="hs-identifier hs-type">checkWellStagedDFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1407"></span><span class="hs-comment">-- Check that we do not try to use an instance before it is available.  E.g.</span><span>
</span><span id="line-1408"></span><span class="hs-comment">--    instance Eq T where ...</span><span>
</span><span id="line-1409"></span><span class="hs-comment">--    f x = $( ... (\(p::T) -&gt; p == p)... )</span><span>
</span><span id="line-1410"></span><span class="hs-comment">-- Here we can't use the equality function from the instance in the splice</span><span>
</span><span id="line-1411"></span><span>
</span><span id="line-1412"></span><span id="checkWellStagedDFun"><span class="annot"><span class="annottext">checkWellStagedDFun :: CtLoc -&gt; InstanceWhat -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#checkWellStagedDFun"><span class="hs-identifier hs-var hs-var">checkWellStagedDFun</span></a></span></span><span> </span><span id="local-6989586621683039171"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039171"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039172"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683039172"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683039173"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039173"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-1413"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1414"></span><span>      </span><span id="local-6989586621683039174"><span class="annot"><a href="#local-6989586621683039174"><span class="hs-identifier hs-var">mbind_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceWhat -&gt; TcS (Maybe Int)
</span><a href="GHC.Tc.Solver.Monad.html#checkWellStagedInstanceWhat"><span class="hs-identifier hs-var">checkWellStagedInstanceWhat</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683039172"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-1415"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039174"><span class="hs-identifier hs-type">mbind_lvl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1416"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683039176"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683039176"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683039176"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Tc.Types.TH.html#impLevel"><span class="hs-identifier hs-var">impLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1417"></span><span>          </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ()) -&gt; TcM () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcM () -&gt; TcM ()
forall a. CtLoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-var">TcM.setCtLocM</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039171"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1418"></span><span>              </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039178"><span class="annot"><a href="#local-6989586621683039178"><span class="hs-identifier hs-var">use_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">TcM.getStage</span></a></span><span>
</span><span id="line-1419"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#checkWellStaged"><span class="hs-identifier hs-type">TcM.checkWellStaged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#StageCheckInstance"><span class="hs-identifier hs-type">StageCheckInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039172"><span class="hs-identifier hs-type">what</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039173"><span class="hs-identifier hs-type">pred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683039176"><span class="hs-identifier hs-type">bind_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#thLevel"><span class="hs-identifier hs-type">thLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039178"><span class="hs-identifier hs-type">use_stage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1420"></span><span>        </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1421"></span><span>          </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span class="hs-comment">-- | Returns the ThLevel of evidence for the solved constraint (if it has evidence)</span><span>
</span><span id="line-1424"></span><span class="hs-comment">-- See Note [Well-staged instance evidence]</span><span>
</span><span id="line-1425"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkWellStagedInstanceWhat"><span class="hs-identifier hs-type">checkWellStagedInstanceWhat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1426"></span><span id="checkWellStagedInstanceWhat"><span class="annot"><span class="annottext">checkWellStagedInstanceWhat :: InstanceWhat -&gt; TcS (Maybe Int)
</span><a href="GHC.Tc.Solver.Monad.html#checkWellStagedInstanceWhat"><span class="hs-identifier hs-var hs-var">checkWellStagedInstanceWhat</span></a></span></span><span> </span><span id="local-6989586621683039183"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683039183"><span class="hs-identifier hs-var">what</span></a></span></span><span>
</span><span id="line-1427"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TopLevInstance"><span class="hs-identifier hs-type">TopLevInstance</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">iw_dfun_id :: InstanceWhat -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Origin.html#iw_dfun_id"><span class="hs-identifier hs-var">iw_dfun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039186"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039186"><span class="hs-identifier hs-var">dfun_id</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683039183"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-1428"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; TcS (Maybe Int)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; TcS (Maybe Int)) -&gt; Maybe Int -&gt; TcS (Maybe Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Int
</span><a href="GHC.Tc.Utils.Env.html#topIdLvl"><span class="hs-identifier hs-var">TcM.topIdLvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039186"><span class="hs-identifier hs-var">dfun_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1429"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#BuiltinTypeableInstance"><span class="hs-identifier hs-type">BuiltinTypeableInstance</span></a></span><span> </span><span id="local-6989586621683039188"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039188"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683039183"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-1430"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1431"></span><span>        </span><span id="local-6989586621683039189"><span class="annot"><a href="#local-6989586621683039189"><span class="hs-identifier hs-var">cur_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
forall t. ContainsModule t =&gt; t -&gt; Module
</span><a href="GHC.Unit.Module.html#extractModule"><span class="hs-identifier hs-var">extractModule</span></a></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; Module) -&gt; TcS TcGblEnv -&gt; TcS Module
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcS TcGblEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1432"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-type">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039189"><span class="hs-identifier hs-type">cur_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039188"><span class="hs-identifier hs-type">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1433"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#outerLevel"><span class="hs-identifier hs-type">outerLevel</span></a></span><span>
</span><span id="line-1434"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#impLevel"><span class="hs-identifier hs-type">impLevel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; TcS (Maybe Int)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span class="hs-comment">{-
Note [Well-staged instance evidence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Evidence for instances must obey the same level restrictions as normal bindings.
In particular, it is forbidden to use an instance in a top-level splice in the
module which the instance is defined. This is because the evidence is bound at
the top-level and top-level definitions are forbidden from being using in top-level splices in
the same module.

For example, suppose you have a function..  foo :: Show a =&gt; Code Q a -&gt; Code Q ()
then the following program is disallowed,

```
data T a = T a deriving (Show)

main :: IO ()
main =
  let x = $$(foo [|| T () ||])
  in return ()
```

because the `foo` function (used in a top-level splice) requires `Show T` evidence,
which is defined at the top-level and therefore fails with an error that we have violated
the stage restriction.

```
Main.hs:12:14: error:
    &#8226; GHC stage restriction:
        instance for &#8216;Show
                        (T ())&#8217; is used in a top-level splice, quasi-quote, or annotation,
        and must be imported, not defined locally
    &#8226; In the expression: foo [|| T () ||]
      In the Template Haskell splice $$(foo [|| T () ||])
      In the expression: $$(foo [|| T () ||])
   |
12 |   let x = $$(foo [|| T () ||])
   |
```

Solving a `Typeable (T t1 ...tn)` constraint generates code that relies on
`$tcT`, the `TypeRep` for `T`; and we must check that this reference to `$tcT`
is well staged.  It's easy to know the stage of `$tcT`: for imported TyCons it
will be `impLevel`, and for local TyCons it will be `toplevel`.

Therefore the `InstanceWhat` type had to be extended with
a special case for `Typeable`, which recorded the TyCon the evidence was for and
could them be used to check that we were not attempting to evidence in a stage incorrect
manner.

-}</span><span>
</span><span id="line-1488"></span><span>
</span><span id="line-1489"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprEq"><span class="hs-identifier hs-type">pprEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1490"></span><span id="pprEq"><span class="annot"><span class="annottext">pprEq :: Type -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.Solver.Monad.html#pprEq"><span class="hs-identifier hs-var hs-var">pprEq</span></a></span></span><span> </span><span id="local-6989586621683039194"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039194"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683039195"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039195"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039194"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'~'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039195"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1491"></span><span>
</span><span id="line-1492"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-type">isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span id="isFilledMetaTyVar_maybe"><span class="annot"><span class="annottext">isFilledMetaTyVar_maybe :: TcTyVar -&gt; TcS (Maybe Type)
</span><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var hs-var">isFilledMetaTyVar_maybe</span></a></span></span><span> </span><span id="local-6989586621683039198"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039198"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe Type) -&gt; TcS (Maybe Type)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM (Maybe Type)
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var">TcM.isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039198"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar"><span class="hs-identifier hs-type">isFilledMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1496"></span><span id="isFilledMetaTyVar"><span class="annot"><span class="annottext">isFilledMetaTyVar :: TcTyVar -&gt; TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar"><span class="hs-identifier hs-var hs-var">isFilledMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683039200"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039200"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Bool -&gt; TcS Bool
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar"><span class="hs-identifier hs-var">TcM.isFilledMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039200"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span><span>
</span><span id="line-1498"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isUnfilledMetaTyVar"><span class="hs-identifier hs-type">isUnfilledMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1499"></span><span id="isUnfilledMetaTyVar"><span class="annot"><span class="annottext">isUnfilledMetaTyVar :: TcTyVar -&gt; TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#isUnfilledMetaTyVar"><span class="hs-identifier hs-var hs-var">isUnfilledMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683039202"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039202"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Bool -&gt; TcS Bool
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Bool -&gt; TcS Bool) -&gt; TcM Bool -&gt; TcS Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isUnfilledMetaTyVar"><span class="hs-identifier hs-var">TcM.isUnfilledMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039202"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-type">zonkTyCoVarsAndFV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a></span><span>
</span><span id="line-1502"></span><span id="zonkTyCoVarsAndFV"><span class="annot"><span class="annottext">zonkTyCoVarsAndFV :: VarSet -&gt; TcS VarSet
</span><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var hs-var">zonkTyCoVarsAndFV</span></a></span></span><span> </span><span id="local-6989586621683039205"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683039205"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM VarSet -&gt; TcS VarSet
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; ZonkM VarSet
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">TcM.zonkTyCoVarsAndFV</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683039205"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-type">zonkTyCoVarsAndFVList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1505"></span><span id="zonkTyCoVarsAndFVList"><span class="annot"><span class="annottext">zonkTyCoVarsAndFVList :: [TcTyVar] -&gt; TcS [TcTyVar]
</span><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-var hs-var">zonkTyCoVarsAndFVList</span></a></span></span><span> </span><span id="local-6989586621683039208"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039208"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM [TcTyVar] -&gt; TcS [TcTyVar]
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; ZonkM [TcTyVar]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-var">TcM.zonkTyCoVarsAndFVList</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039208"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkCo"><span class="hs-identifier hs-type">zonkCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1508"></span><span id="zonkCo"><span class="annot"><span class="annottext">zonkCo :: Coercion -&gt; TcS Coercion
</span><a href="GHC.Tc.Solver.Monad.html#zonkCo"><span class="hs-identifier hs-var hs-var">zonkCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Coercion -&gt; TcS Coercion
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Coercion -&gt; TcS Coercion)
-&gt; (Coercion -&gt; TcM Coercion) -&gt; Coercion -&gt; TcS Coercion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ZonkM Coercion -&gt; TcM Coercion)
-&gt; (Coercion -&gt; ZonkM Coercion) -&gt; Coercion -&gt; TcM Coercion
forall a b. (a -&gt; b) -&gt; (Coercion -&gt; a) -&gt; Coercion -&gt; b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ZonkM Coercion -&gt; TcM Coercion
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">TcM.liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ZonkM Coercion
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCo"><span class="hs-identifier hs-var">TcM.zonkCo</span></a></span><span>
</span><span id="line-1509"></span><span>
</span><span id="line-1510"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1511"></span><span id="zonkTcType"><span class="annot"><span class="annottext">zonkTcType :: Type -&gt; TcS Type
</span><a href="GHC.Tc.Solver.Monad.html#zonkTcType"><span class="hs-identifier hs-var hs-var">zonkTcType</span></a></span></span><span> </span><span id="local-6989586621683039211"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039211"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM Type -&gt; TcS Type
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">TcM.zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039211"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1512"></span><span>
</span><span id="line-1513"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTypes"><span class="hs-identifier hs-type">zonkTcTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1514"></span><span id="zonkTcTypes"><span class="annot"><span class="annottext">zonkTcTypes :: [Type] -&gt; TcS [Type]
</span><a href="GHC.Tc.Solver.Monad.html#zonkTcTypes"><span class="hs-identifier hs-var hs-var">zonkTcTypes</span></a></span></span><span> </span><span id="local-6989586621683039213"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039213"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM [Type] -&gt; TcS [Type]
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; ZonkM [Type]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypes"><span class="hs-identifier hs-var">TcM.zonkTcTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039213"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1515"></span><span>
</span><span id="line-1516"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTyVar"><span class="hs-identifier hs-type">zonkTcTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1517"></span><span id="zonkTcTyVar"><span class="annot"><span class="annottext">zonkTcTyVar :: TcTyVar -&gt; TcS Type
</span><a href="GHC.Tc.Solver.Monad.html#zonkTcTyVar"><span class="hs-identifier hs-var hs-var">zonkTcTyVar</span></a></span></span><span> </span><span id="local-6989586621683039215"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039215"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM Type -&gt; TcS Type
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-var">TcM.zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039215"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1518"></span><span>
</span><span id="line-1519"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkSimples"><span class="hs-identifier hs-type">zonkSimples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-1520"></span><span id="zonkSimples"><span class="annot"><span class="annottext">zonkSimples :: Cts -&gt; TcS Cts
</span><a href="GHC.Tc.Solver.Monad.html#zonkSimples"><span class="hs-identifier hs-var hs-var">zonkSimples</span></a></span></span><span> </span><span id="local-6989586621683039217"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039217"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM Cts -&gt; TcS Cts
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cts -&gt; ZonkM Cts
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSimples"><span class="hs-identifier hs-var">TcM.zonkSimples</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039217"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1521"></span><span>
</span><span id="line-1522"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkWC"><span class="hs-identifier hs-type">zonkWC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-1523"></span><span id="zonkWC"><span class="annot"><span class="annottext">zonkWC :: WantedConstraints -&gt; TcS WantedConstraints
</span><a href="GHC.Tc.Solver.Monad.html#zonkWC"><span class="hs-identifier hs-var hs-var">zonkWC</span></a></span></span><span> </span><span id="local-6989586621683039219"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683039219"><span class="hs-identifier hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM WantedConstraints -&gt; TcS WantedConstraints
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; ZonkM WantedConstraints
</span><a href="GHC.Tc.Zonk.TcType.html#zonkWC"><span class="hs-identifier hs-var">TcM.zonkWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683039219"><span class="hs-identifier hs-var">wc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1524"></span><span>
</span><span id="line-1525"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarKind"><span class="hs-identifier hs-type">zonkTyCoVarKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span>
</span><span id="line-1526"></span><span id="zonkTyCoVarKind"><span class="annot"><span class="annottext">zonkTyCoVarKind :: TcTyVar -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarKind"><span class="hs-identifier hs-var hs-var">zonkTyCoVarKind</span></a></span></span><span> </span><span id="local-6989586621683039221"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039221"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM TcTyVar -&gt; TcS TcTyVar
forall a. ZonkM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#liftZonkTcS"><span class="hs-identifier hs-var">liftZonkTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">TcM.zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039221"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1527"></span><span>
</span><span id="line-1528"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1529"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier hs-type">pprKicked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1530"></span><span id="pprKicked"><span class="annot"><span class="annottext">pprKicked :: Int -&gt; SDoc
</span><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier hs-var hs-var">pprKicked</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1531"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier hs-var">pprKicked</span></a></span><span> </span><span id="local-6989586621683039224"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683039224"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683039224"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kicked out&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
*              The Unification Level Flag                              *
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1538"></span><span>
</span><span id="line-1539"></span><span class="hs-comment">{- Note [The Unification Level Flag]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a deep tree of implication constraints
   forall[1] a.                              -- Outer-implic
      C alpha[1]                               -- Simple
      forall[2] c. ....(C alpha[1])....        -- Implic-1
      forall[2] b. ....(alpha[1] ~ Int)....    -- Implic-2

The (C alpha) is insoluble until we know alpha.  We solve alpha
by unifying alpha:=Int somewhere deep inside Implic-2. But then we
must try to solve the Outer-implic all over again. This time we can
solve (C alpha) both in Outer-implic, and nested inside Implic-1.

When should we iterate solving a level-n implication?
Answer: if any unification of a tyvar at level n takes place
        in the ic_implics of that implication.

* What if a unification takes place at level n-1? Then don't iterate
  level n, because we'll iterate level n-1, and that will in turn iterate
  level n.

* What if a unification takes place at level n, in the ic_simples of
  level n?  No need to track this, because the kick-out mechanism deals
  with it.  (We can't drop kick-out in favour of iteration, because kick-out
  works for skolem-equalities, not just unifications.)

So the monad-global Unification Level Flag, kept in tcs_unif_lvl keeps
track of
  - Whether any unifications at all have taken place (Nothing =&gt; no unifications)
  - If so, what is the outermost level that has seen a unification (Just lvl)

The iteration is done in the simplify_loop/maybe_simplify_again loop in GHC.Tc.Solver.

It helpful not to iterate unless there is a chance of progress.  #8474 is
an example:

  * There's a deeply-nested chain of implication constraints.
       ?x:alpha =&gt; ?y1:beta1 =&gt; ... ?yn:betan =&gt; [W] ?x:Int

  * From the innermost one we get a [W] alpha[1] ~ Int,
    so we can unify.

  * It's better not to iterate the inner implications, but go all the
    way out to level 1 before iterating -- because iterating level 1
    will iterate the inner levels anyway.

(In the olden days when we &quot;floated&quot; thse Derived constraints, this was
much, much more important -- we got exponential behaviour, as each iteration
produced the same Derived constraint.)
-}</span><span>
</span><span id="line-1589"></span><span>
</span><span id="line-1590"></span><span>
</span><span id="line-1591"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#resetUnificationFlag"><span class="hs-identifier hs-type">resetUnificationFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1592"></span><span class="hs-comment">-- We are at ambient level i</span><span>
</span><span id="line-1593"></span><span class="hs-comment">-- If the unification flag = Just i, reset it to Nothing and return True</span><span>
</span><span id="line-1594"></span><span class="hs-comment">-- Otherwise leave it unchanged and return False</span><span>
</span><span id="line-1595"></span><span id="resetUnificationFlag"><span class="annot"><span class="annottext">resetUnificationFlag :: TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#resetUnificationFlag"><span class="hs-identifier hs-var hs-var">resetUnificationFlag</span></a></span></span><span>
</span><span id="line-1596"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM Bool) -&gt; TcS Bool
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM Bool) -&gt; TcS Bool)
-&gt; (TcSEnv -&gt; TcM Bool) -&gt; TcS Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683039225"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039225"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1597"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039226"><span class="annot"><span class="annottext">ref :: IORef (Maybe TcLevel)
</span><a href="#local-6989586621683039226"><span class="hs-identifier hs-var hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039225"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1598"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039227"><span class="annot"><a href="#local-6989586621683039227"><span class="hs-identifier hs-var">ambient_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">TcM.getTcLevel</span></a></span><span>
</span><span id="line-1599"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039228"><span class="annot"><a href="#local-6989586621683039228"><span class="hs-identifier hs-var">mb_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039226"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-1600"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;resetUnificationFlag&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1601"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ambient:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039227"><span class="hs-identifier hs-type">ambient_lvl</span></a></span><span>
</span><span id="line-1602"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;unif_lvl:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039228"><span class="hs-identifier hs-type">mb_lvl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1603"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039228"><span class="hs-identifier hs-type">mb_lvl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1604"></span><span>           </span><span class="annot"><span class="annottext">Maybe TcLevel
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1605"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683039229"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039229"><span class="hs-identifier hs-var">unif_lvl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039227"><span class="hs-identifier hs-var">ambient_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039229"><span class="hs-identifier hs-var">unif_lvl</span></a></span><span>
</span><span id="line-1606"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1607"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1608"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel) -&gt; Maybe TcLevel -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621683039226"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TcLevel
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1609"></span><span>                               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1610"></span><span>
</span><span id="line-1611"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setUnificationFlag"><span class="hs-identifier hs-type">setUnificationFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1612"></span><span class="hs-comment">-- (setUnificationFlag i) sets the unification level to (Just i)</span><span>
</span><span id="line-1613"></span><span class="hs-comment">-- unless it already is (Just j) where j &lt;= i</span><span>
</span><span id="line-1614"></span><span id="setUnificationFlag"><span class="annot"><span class="annottext">setUnificationFlag :: TcLevel -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setUnificationFlag"><span class="hs-identifier hs-var hs-var">setUnificationFlag</span></a></span></span><span> </span><span id="local-6989586621683039230"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039230"><span class="hs-identifier hs-var">lvl</span></a></span></span><span>
</span><span id="line-1615"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">((TcSEnv -&gt; TcM ()) -&gt; TcS ()) -&gt; (TcSEnv -&gt; TcM ()) -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683039231"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039231"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1616"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039232"><span class="annot"><span class="annottext">ref :: IORef (Maybe TcLevel)
</span><a href="#local-6989586621683039232"><span class="hs-identifier hs-var hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621683039231"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1617"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039233"><span class="annot"><a href="#local-6989586621683039233"><span class="hs-identifier hs-var">mb_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcLevel)
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621683039232"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1618"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039233"><span class="hs-identifier hs-type">mb_lvl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1619"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683039234"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039234"><span class="hs-identifier hs-var">unif_lvl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039230"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#deeperThanOrSame"><span class="hs-operator hs-var">`deeperThanOrSame`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039234"><span class="hs-identifier hs-var">unif_lvl</span></a></span><span>
</span><span id="line-1620"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1621"></span><span>           </span><span class="annot"><span class="annottext">Maybe TcLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel) -&gt; Maybe TcLevel -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621683039232"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; Maybe TcLevel
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039230"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1622"></span><span>
</span><span id="line-1623"></span><span>
</span><span id="line-1624"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
*                Instantiation etc.
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1629"></span><span>
</span><span id="line-1630"></span><span class="hs-comment">-- Instantiations</span><span>
</span><span id="line-1631"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instDFunType"><span class="hs-identifier hs-type">instDFunType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span id="instDFunType"><span class="annot"><span class="annottext">instDFunType :: TcTyVar -&gt; [Maybe Type] -&gt; TcS ([Type], [Type])
</span><a href="GHC.Tc.Solver.Monad.html#instDFunType"><span class="hs-identifier hs-var hs-var">instDFunType</span></a></span></span><span> </span><span id="local-6989586621683039239"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039239"><span class="hs-identifier hs-var">dfun_id</span></a></span></span><span> </span><span id="local-6989586621683039240"><span class="annot"><span class="annottext">[Maybe Type]
</span><a href="#local-6989586621683039240"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span>
</span><span id="line-1635"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM ([Type], [Type]) -&gt; TcS ([Type], [Type])
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([Type], [Type]) -&gt; TcS ([Type], [Type]))
-&gt; TcM ([Type], [Type]) -&gt; TcS ([Type], [Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; [Maybe Type] -&gt; TcM ([Type], [Type])
</span><a href="GHC.Tc.Utils.Instantiate.html#instDFunType"><span class="hs-identifier hs-var">TcM.instDFunType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039239"><span class="hs-identifier hs-var">dfun_id</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Type]
</span><a href="#local-6989586621683039240"><span class="hs-identifier hs-var">inst_tys</span></a></span><span>
</span><span id="line-1636"></span><span>
</span><span id="line-1637"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newFlexiTcSTy"><span class="hs-identifier hs-type">newFlexiTcSTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1638"></span><span id="newFlexiTcSTy"><span class="annot"><span class="annottext">newFlexiTcSTy :: Type -&gt; TcS Type
</span><a href="GHC.Tc.Solver.Monad.html#newFlexiTcSTy"><span class="hs-identifier hs-var hs-var">newFlexiTcSTy</span></a></span></span><span> </span><span id="local-6989586621683039243"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039243"><span class="hs-identifier hs-var">knd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Type -&gt; TcS Type
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">TcM.newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039243"><span class="hs-identifier hs-var">knd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#cloneMetaTyVar"><span class="hs-identifier hs-type">cloneMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-1641"></span><span id="cloneMetaTyVar"><span class="annot"><span class="annottext">cloneMetaTyVar :: TcTyVar -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#cloneMetaTyVar"><span class="hs-identifier hs-var hs-var">cloneMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683039245"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039245"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TcTyVar -&gt; TcS TcTyVar
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVar"><span class="hs-identifier hs-var">TcM.cloneMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039245"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiX"><span class="hs-identifier hs-type">instFlexiX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TKVar"><span class="hs-identifier hs-type">TKVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-1644"></span><span id="instFlexiX"><span class="annot"><span class="annottext">instFlexiX :: Subst -&gt; [TcTyVar] -&gt; TcS Subst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiX"><span class="hs-identifier hs-var hs-var">instFlexiX</span></a></span></span><span> </span><span id="local-6989586621683039248"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039248"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683039249"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039249"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Subst -&gt; TcS Subst
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; [TcTyVar] -&gt; TcM Subst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiXTcM"><span class="hs-identifier hs-var">instFlexiXTcM</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039248"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039249"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>
</span><span id="line-1646"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiXTcM"><span class="hs-identifier hs-type">instFlexiXTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TKVar"><span class="hs-identifier hs-type">TKVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-1647"></span><span class="hs-comment">-- Makes fresh tyvar, extends the substitution, and the in-scope set</span><span>
</span><span id="line-1648"></span><span class="hs-comment">-- Takes account of the case [k::Type, a::k, ...],</span><span>
</span><span id="line-1649"></span><span class="hs-comment">-- where we must substitute for k in a's kind</span><span>
</span><span id="line-1650"></span><span id="instFlexiXTcM"><span class="annot"><span class="annottext">instFlexiXTcM :: Subst -&gt; [TcTyVar] -&gt; TcM Subst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiXTcM"><span class="hs-identifier hs-var hs-var">instFlexiXTcM</span></a></span></span><span> </span><span id="local-6989586621683039251"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039251"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1651"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcM Subst
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039251"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1652"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiXTcM"><span class="hs-identifier hs-var">instFlexiXTcM</span></a></span><span> </span><span id="local-6989586621683039252"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039252"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039253"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039253"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683039254"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039254"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1653"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039255"><span class="annot"><a href="#local-6989586621683039255"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">TcM.newUnique</span></a></span><span>
</span><span id="line-1654"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039257"><span class="annot"><a href="#local-6989586621683039257"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-type">TcM.newMetaDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-type">TauTv</span></a></span><span>
</span><span id="line-1655"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039260"><span class="annot"><a href="#local-6989586621683039260"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Name
</span><a href="GHC.Types.Name.html#setNameUnique"><span class="hs-identifier hs-var">setNameUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039253"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683039255"><span class="hs-identifier hs-var">uniq</span></a></span><span>
</span><span id="line-1656"></span><span>             </span><span id="local-6989586621683039263"><span class="annot"><a href="#local-6989586621683039263"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039252"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039253"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1657"></span><span>             </span><span id="local-6989586621683039266"><span class="annot"><a href="#local-6989586621683039266"><span class="hs-identifier hs-var hs-var">tv'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683039260"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039263"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683039257"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-1658"></span><span>             </span><span id="local-6989586621683039268"><span class="annot"><a href="#local-6989586621683039268"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; TcTyVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039252"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039253"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039266"><span class="hs-identifier hs-var">tv'</span></a></span><span>
</span><span id="line-1659"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiXTcM"><span class="hs-identifier hs-type">instFlexiXTcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039268"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039254"><span class="hs-identifier hs-type">tvs</span></a></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1660"></span><span>
</span><span id="line-1661"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchGlobalInst"><span class="hs-identifier hs-type">matchGlobalInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-1662"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True &lt;=&gt; caller is the short-cut solver</span><span>
</span><span id="line-1663"></span><span>                             </span><span class="hs-comment">-- See Note [Shortcut solving: overlap]</span><span>
</span><span id="line-1664"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">TcM.ClsInstResult</span></a></span><span>
</span><span id="line-1665"></span><span id="matchGlobalInst"><span class="annot"><span class="annottext">matchGlobalInst :: DynFlags -&gt; Bool -&gt; Class -&gt; [Type] -&gt; CtLoc -&gt; TcS ClsInstResult
</span><a href="GHC.Tc.Solver.Monad.html#matchGlobalInst"><span class="hs-identifier hs-var hs-var">matchGlobalInst</span></a></span></span><span> </span><span id="local-6989586621683039270"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683039270"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683039271"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683039271"><span class="hs-identifier hs-var">short_cut</span></a></span></span><span> </span><span id="local-6989586621683039272"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683039272"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683039273"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039273"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621683039274"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039274"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-1666"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM ClsInstResult -&gt; TcS ClsInstResult
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ClsInstResult -&gt; TcS ClsInstResult)
-&gt; TcM ClsInstResult -&gt; TcS ClsInstResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcM ClsInstResult -&gt; TcM ClsInstResult
forall a. CtLoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-var">TcM.setCtLocM</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039274"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ClsInstResult -&gt; TcM ClsInstResult)
-&gt; TcM ClsInstResult -&gt; TcM ClsInstResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [Type] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchGlobalInst"><span class="hs-identifier hs-var">TcM.matchGlobalInst</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683039270"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683039271"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683039272"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039273"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-type">tcInstSkolTyVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1669"></span><span id="tcInstSkolTyVarsX"><span class="annot"><span class="annottext">tcInstSkolTyVarsX :: SkolemInfo -&gt; Subst -&gt; [TcTyVar] -&gt; TcS (Subst, [TcTyVar])
</span><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var hs-var">tcInstSkolTyVarsX</span></a></span></span><span> </span><span id="local-6989586621683039276"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683039276"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683039277"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039277"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683039278"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039278"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (Subst, [TcTyVar]) -&gt; TcS (Subst, [TcTyVar])
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Subst, [TcTyVar]) -&gt; TcS (Subst, [TcTyVar]))
-&gt; TcM (Subst, [TcTyVar]) -&gt; TcS (Subst, [TcTyVar])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; Subst -&gt; [TcTyVar] -&gt; TcM (Subst, [TcTyVar])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">TcM.tcInstSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683039276"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039277"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039278"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1670"></span><span>
</span><span id="line-1671"></span><span class="hs-comment">-- Creating and setting evidence variables and CtFlavors</span><span>
</span><span id="line-1672"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1673"></span><span>
</span><span id="line-1674"></span><span class="hs-keyword">data</span><span> </span><span id="MaybeNew"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-var">MaybeNew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Fresh"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Cached"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a></span><span>
</span><span id="line-1675"></span><span>
</span><span id="line-1676"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier hs-type">isFresh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1677"></span><span id="isFresh"><span class="annot"><span class="annottext">isFresh :: MaybeNew -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier hs-var hs-var">isFresh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1678"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier hs-var">isFresh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1679"></span><span>
</span><span id="line-1680"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#freshGoals"><span class="hs-identifier hs-type">freshGoals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1681"></span><span id="freshGoals"><span class="annot"><span class="annottext">freshGoals :: [MaybeNew] -&gt; [CtEvidence]
</span><a href="GHC.Tc.Solver.Monad.html#freshGoals"><span class="hs-identifier hs-var hs-var">freshGoals</span></a></span></span><span> </span><span id="local-6989586621683039282"><span class="annot"><span class="annottext">[MaybeNew]
</span><a href="#local-6989586621683039282"><span class="hs-identifier hs-var">mns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039283"><span class="hs-identifier hs-var">ctev</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span> </span><span id="local-6989586621683039283"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039283"><span class="hs-identifier hs-var">ctev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MaybeNew]
</span><a href="#local-6989586621683039282"><span class="hs-identifier hs-var">mns</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1682"></span><span>
</span><span id="line-1683"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-type">getEvExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a></span><span>
</span><span id="line-1684"></span><span id="getEvExpr"><span class="annot"><span class="annottext">getEvExpr :: MaybeNew -&gt; EvExpr
</span><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-var hs-var">getEvExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span> </span><span id="local-6989586621683039284"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039284"><span class="hs-identifier hs-var">ctev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; EvExpr
CtEvidence -&gt; EvExpr
</span><a href="GHC.Tc.Types.Constraint.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039284"><span class="hs-identifier hs-var">ctev</span></a></span><span>
</span><span id="line-1685"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-var">getEvExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span id="local-6989586621683039286"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683039286"><span class="hs-identifier hs-var">evt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683039286"><span class="hs-identifier hs-var">evt</span></a></span><span>
</span><span id="line-1686"></span><span>
</span><span id="line-1687"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-type">setEvBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1688"></span><span id="setEvBind"><span class="annot"><span class="annottext">setEvBind :: EvBind -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-var hs-var">setEvBind</span></a></span></span><span> </span><span id="local-6989586621683039287"><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621683039287"><span class="hs-identifier hs-var">ev_bind</span></a></span></span><span>
</span><span id="line-1689"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039288"><span class="annot"><a href="#local-6989586621683039288"><span class="hs-identifier hs-var">evb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var">getTcEvBindsVar</span></a></span><span>
</span><span id="line-1690"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-type">TcM.addTcEvBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039288"><span class="hs-identifier hs-type">evb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039287"><span class="hs-identifier hs-type">ev_bind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1691"></span><span>
</span><span id="line-1692"></span><span class="annot"><span class="hs-comment">-- | Mark variables as used filling a coercion hole</span></span><span>
</span><span id="line-1693"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-type">useVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#CoVarSet"><span class="hs-identifier hs-type">CoVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1694"></span><span id="useVars"><span class="annot"><span class="annottext">useVars :: VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-var hs-var">useVars</span></a></span></span><span> </span><span id="local-6989586621683039292"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683039292"><span class="hs-identifier hs-var">co_vars</span></a></span></span><span>
</span><span id="line-1695"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039293"><span class="annot"><a href="#local-6989586621683039293"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var">getTcEvBindsVar</span></a></span><span>
</span><span id="line-1696"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039294"><span class="annot"><a href="#local-6989586621683039294"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; IORef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683039293"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-1697"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1698"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039296"><span class="annot"><a href="#local-6989586621683039296"><span class="hs-identifier hs-var">tcvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039294"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-1699"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039297"><span class="annot"><a href="#local-6989586621683039297"><span class="hs-identifier hs-var hs-var">tcvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683039296"><span class="hs-identifier hs-var">tcvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621683039292"><span class="hs-identifier hs-var">co_vars</span></a></span><span>
</span><span id="line-1700"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039294"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039297"><span class="hs-identifier hs-type">tcvs'</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1701"></span><span>
</span><span id="line-1702"></span><span class="annot"><span class="hs-comment">-- | Equalities only</span></span><span>
</span><span id="line-1703"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-type">setWantedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1704"></span><span id="setWantedEq"><span class="annot"><span class="annottext">setWantedEq :: HasDebugCallStack =&gt; TcEvDest -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var hs-var">setWantedEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span id="local-6989586621683039305"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039305"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683039306"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039306"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1705"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-var">useVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039306"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1706"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var">fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039305"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039306"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1707"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-type">EvVarDest</span></a></span><span> </span><span id="local-6989586621683039310"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039310"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setWantedEq: EvVarDest&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039310"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1708"></span><span>
</span><span id="line-1709"></span><span class="annot"><span class="hs-comment">-- | Good for both equalities and non-equalities</span></span><span>
</span><span id="line-1710"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-type">setWantedEvTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1711"></span><span id="setWantedEvTerm"><span class="annot"><span class="annottext">setWantedEvTerm :: TcEvDest -&gt; CanonicalEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var hs-var">setWantedEvTerm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span id="local-6989586621683039311"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039311"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683039312"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683039312"><span class="hs-identifier hs-var">_canonical</span></a></span></span><span> </span><span id="local-6989586621683039313"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039313"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-1712"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683039314"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039314"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; Maybe Coercion
</span><a href="GHC.Tc.Types.Evidence.html#evTermCoercion_maybe"><span class="hs-identifier hs-var">evTermCoercion_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039313"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1713"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-var">useVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039314"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1714"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var">fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039311"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039314"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1715"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1716"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Yukky eq_sel for a HoleDest]</span><span>
</span><span id="line-1717"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039316"><span class="annot"><span class="annottext">co_var :: TcTyVar
</span><a href="#local-6989586621683039316"><span class="hs-identifier hs-var hs-var hs-var">co_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; TcTyVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039311"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-1718"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EvBind -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; CanonicalEvidence -&gt; EvTerm -&gt; EvBind
</span><a href="GHC.Tc.Types.Evidence.html#mkWantedEvBind"><span class="hs-identifier hs-var">mkWantedEvBind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039316"><span class="hs-identifier hs-var">co_var</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039313"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1719"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var">fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039311"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039316"><span class="hs-identifier hs-var">co_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-type">EvVarDest</span></a></span><span> </span><span id="local-6989586621683039321"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039321"><span class="hs-identifier hs-var">ev_id</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683039322"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683039322"><span class="hs-identifier hs-var">canonical</span></a></span></span><span> </span><span id="local-6989586621683039323"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039323"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-1722"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBind -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; CanonicalEvidence -&gt; EvTerm -&gt; EvBind
</span><a href="GHC.Tc.Types.Evidence.html#mkWantedEvBind"><span class="hs-identifier hs-var">mkWantedEvBind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039321"><span class="hs-identifier hs-var">ev_id</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683039322"><span class="hs-identifier hs-var">canonical</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039323"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span class="hs-comment">{- Note [Yukky eq_sel for a HoleDest]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
How can it be that a Wanted with HoleDest gets evidence that isn't
just a coercion? i.e. evTermCoercion_maybe returns Nothing.

Consider [G] forall a. blah =&gt; a ~ T
         [W] S ~# T

Then doTopReactEqPred carefully looks up the (boxed) constraint (S ~ T)
in the quantified constraints, and wraps the (boxed) evidence it
gets back in an eq_sel to extract the unboxed (S ~# T).  We can't put
that term into a coercion, so we add a value binding
    h = eq_sel (...)
and the coercion variable h to fill the coercion hole.
We even re-use the CoHole's Id for this binding!

Yuk!
-}</span><span>
</span><span id="line-1742"></span><span>
</span><span id="line-1743"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-type">fillCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1744"></span><span id="fillCoercionHole"><span class="annot"><span class="annottext">fillCoercionHole :: CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var hs-var">fillCoercionHole</span></a></span></span><span> </span><span id="local-6989586621683039324"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039324"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span id="local-6989586621683039325"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039325"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1745"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcS ()
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcS ()) -&gt; TcM () -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcM ()
</span><a href="GHC.Tc.Utils.TcMType.html#fillCoercionHole"><span class="hs-identifier hs-var">TcM.fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039324"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039325"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1746"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#kickOutAfterFillingCoercionHole"><span class="hs-identifier hs-var">kickOutAfterFillingCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039324"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1747"></span><span>
</span><span id="line-1748"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier hs-type">setEvBindIfWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1749"></span><span id="setEvBindIfWanted"><span class="annot"><span class="annottext">setEvBindIfWanted :: CtEvidence -&gt; CanonicalEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier hs-var hs-var">setEvBindIfWanted</span></a></span></span><span> </span><span id="local-6989586621683039327"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039327"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039328"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683039328"><span class="hs-identifier hs-var">canonical</span></a></span></span><span> </span><span id="local-6989586621683039329"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039329"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-1750"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039327"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1751"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039331"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621683039331"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcEvDest -&gt; CanonicalEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621683039331"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683039328"><span class="hs-identifier hs-var">canonical</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039329"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1752"></span><span>      </span><span class="annot"><span class="annottext">CtEvidence
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1753"></span><span>
</span><span id="line-1754"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcEvBinds"><span class="hs-identifier hs-type">newTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1755"></span><span id="newTcEvBinds"><span class="annot"><span class="annottext">newTcEvBinds :: TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var hs-var">newTcEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar -&gt; TcS EvBindsVar
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-1756"></span><span>
</span><span id="line-1757"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-type">newNoTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1758"></span><span id="newNoTcEvBinds"><span class="annot"><span class="annottext">newNoTcEvBinds :: TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var hs-var">newNoTcEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar -&gt; TcS EvBindsVar
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var">TcM.newNoTcEvBinds</span></a></span><span>
</span><span id="line-1759"></span><span>
</span><span id="line-1760"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-type">newEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-1761"></span><span id="newEvVar"><span class="annot"><span class="annottext">newEvVar :: Type -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-var hs-var">newEvVar</span></a></span></span><span> </span><span id="local-6989586621683039332"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039332"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM TcTyVar -&gt; TcS TcTyVar
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM TcTyVar
forall gbl lcl. Type -&gt; TcRnIf gbl lcl TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-var">TcM.newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039332"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1762"></span><span>
</span><span id="line-1763"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-type">newGivenEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-1764"></span><span class="hs-comment">-- Make a new variable of the given PredType,</span><span>
</span><span id="line-1765"></span><span class="hs-comment">-- immediately bind it to the given term</span><span>
</span><span id="line-1766"></span><span class="hs-comment">-- and return its CtEvidence</span><span>
</span><span id="line-1767"></span><span class="hs-comment">-- See Note [Bind new Givens immediately] in GHC.Tc.Types.Constraint</span><span>
</span><span id="line-1768"></span><span id="newGivenEvVar"><span class="annot"><span class="annottext">newGivenEvVar :: CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var hs-var">newGivenEvVar</span></a></span></span><span> </span><span id="local-6989586621683039334"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039334"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039335"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039335"><span class="hs-identifier hs-var">pred</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039336"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039336"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1769"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039337"><span class="annot"><a href="#local-6989586621683039337"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; EvTerm -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier hs-var">newBoundEvVarId</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039335"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039336"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1770"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039335"><span class="hs-identifier hs-type">pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039337"><span class="hs-identifier hs-type">new_ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039334"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1771"></span><span>
</span><span id="line-1772"></span><span class="hs-comment">-- | Make a new 'Id' of the given type, bound (in the monad's EvBinds) to the</span><span>
</span><span id="line-1773"></span><span class="hs-comment">-- given term</span><span>
</span><span id="line-1774"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier hs-type">newBoundEvVarId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-1775"></span><span id="newBoundEvVarId"><span class="annot"><span class="annottext">newBoundEvVarId :: Type -&gt; EvTerm -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier hs-var hs-var">newBoundEvVarId</span></a></span></span><span> </span><span id="local-6989586621683039340"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039340"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621683039341"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039341"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-1776"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039342"><span class="annot"><a href="#local-6989586621683039342"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039340"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-1777"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-type">setEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkGivenEvBind"><span class="hs-identifier hs-type">mkGivenEvBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039342"><span class="hs-identifier hs-type">new_ev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039341"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1778"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683039342"><span class="hs-identifier hs-type">new_ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1779"></span><span>
</span><span id="line-1780"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewGivens"><span class="hs-identifier hs-type">emitNewGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1781"></span><span id="emitNewGivens"><span class="annot"><span class="annottext">emitNewGivens :: CtLoc -&gt; [(Role, Coercion)] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitNewGivens"><span class="hs-identifier hs-var hs-var">emitNewGivens</span></a></span></span><span> </span><span id="local-6989586621683039345"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039345"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039346"><span class="annot"><span class="annottext">[(Role, Coercion)]
</span><a href="#local-6989586621683039346"><span class="hs-identifier hs-var">pts</span></a></span></span><span>
</span><span id="line-1782"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emitNewGivens&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Role, Coercion)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Role, Coercion)]
</span><a href="#local-6989586621683039346"><span class="hs-identifier hs-var">pts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1783"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039347"><span class="annot"><a href="#local-6989586621683039347"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Type, EvTerm) -&gt; TcS CtEvidence)
-&gt; [(Type, EvTerm)] -&gt; TcS [CtEvidence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039345"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Type, EvTerm)] -&gt; TcS [CtEvidence])
-&gt; [(Type, EvTerm)] -&gt; TcS [CtEvidence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1784"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039350"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039351"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039352"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039354"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1785"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039350"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039350"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039354"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039354"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Role, Coercion)]
</span><a href="#local-6989586621683039346"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-1786"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621683039351"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039351"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683039352"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039352"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; TypeEqn
Coercion -&gt; TypeEqn
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039354"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1787"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039351"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039352"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Kill reflexive Givens at birth</span><span>
</span><span id="line-1788"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-type">emitWorkNC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039347"><span class="hs-identifier hs-type">evs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1789"></span><span>
</span><span id="line-1790"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier hs-type">emitNewWantedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1791"></span><span class="annot"><span class="hs-comment">-- | Emit a new Wanted equality into the work-list</span></span><span>
</span><span id="line-1792"></span><span id="emitNewWantedEq"><span class="annot"><span class="annottext">emitNewWantedEq :: CtLoc -&gt; RewriterSet -&gt; Role -&gt; Type -&gt; Type -&gt; TcS Coercion
</span><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier hs-var hs-var">emitNewWantedEq</span></a></span></span><span> </span><span id="local-6989586621683039357"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039357"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039358"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039358"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621683039359"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039359"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621683039360"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039360"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683039361"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039361"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1793"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039362"><span class="annot"><a href="#local-6989586621683039362"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039363"><span class="annot"><a href="#local-6989586621683039363"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039357"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039358"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039359"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039360"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039361"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1794"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-type">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEq"><span class="hs-identifier hs-type">extendWorkListEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039358"><span class="hs-identifier hs-type">rewriters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-type">mkNonCanonical</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039362"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1795"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683039363"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1796"></span><span>
</span><span id="line-1797"></span><span class="hs-comment">-- | Create a new Wanted constraint holding a coercion hole</span><span>
</span><span id="line-1798"></span><span class="hs-comment">-- for an equality between the two types at the given 'Role'.</span><span>
</span><span id="line-1799"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-type">newWantedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1800"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1801"></span><span id="newWantedEq"><span class="annot"><span class="annottext">newWantedEq :: CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var hs-var">newWantedEq</span></a></span></span><span> </span><span id="local-6989586621683039365"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039365"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039366"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039366"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621683039367"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039367"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621683039368"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039368"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683039369"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039369"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1802"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039370"><span class="annot"><a href="#local-6989586621683039370"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM CoercionHole -&gt; TcS CoercionHole
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM CoercionHole -&gt; TcS CoercionHole)
-&gt; TcM CoercionHole -&gt; TcS CoercionHole
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcM CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">TcM.newCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039365"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039372"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1803"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039372"><span class="hs-identifier hs-type">pty</span></a></span><span>
</span><span id="line-1804"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039370"><span class="hs-identifier hs-type">hole</span></a></span><span>
</span><span id="line-1805"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039365"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-1806"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039366"><span class="hs-identifier hs-type">rewriters</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1807"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier hs-type">mkHoleCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039370"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1808"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1809"></span><span>    </span><span id="local-6989586621683039372"><span class="annot"><span class="annottext">pty :: Type
</span><a href="#local-6989586621683039372"><span class="hs-identifier hs-var hs-var">pty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039367"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039368"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039369"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1810"></span><span>
</span><span id="line-1811"></span><span class="hs-comment">-- | Create a new Wanted constraint holding an evidence variable.</span><span>
</span><span id="line-1812"></span><span class="hs-comment">--</span><span>
</span><span id="line-1813"></span><span class="hs-comment">-- Don't use this for equality constraints: use 'newWantedEq' instead.</span><span>
</span><span id="line-1814"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-type">newWantedEvVarNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span>
</span><span id="line-1815"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-1816"></span><span class="hs-comment">-- Don't look up in the solved/inerts; we know it's not there</span><span>
</span><span id="line-1817"></span><span id="newWantedEvVarNC"><span class="annot"><span class="annottext">newWantedEvVarNC :: CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-var hs-var">newWantedEvVarNC</span></a></span></span><span> </span><span id="local-6989586621683039374"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039374"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039375"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039375"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621683039376"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039376"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-1818"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039377"><span class="annot"><a href="#local-6989586621683039377"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039376"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1819"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Emitting new wanted&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039377"><span class="hs-identifier hs-type">new_ev</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039376"><span class="hs-identifier hs-type">pty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-1820"></span><span>                                         </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#pprCtLoc"><span class="hs-identifier hs-type">pprCtLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039374"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1821"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039376"><span class="hs-identifier hs-type">pty</span></a></span><span>
</span><span id="line-1822"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-type">EvVarDest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039377"><span class="hs-identifier hs-type">new_ev</span></a></span><span>
</span><span id="line-1823"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039374"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-1824"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039375"><span class="hs-identifier hs-type">rewriters</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-1825"></span><span>
</span><span id="line-1826"></span><span class="hs-comment">-- | Like 'newWantedEvVarNC', except it might look up in the inert set</span><span>
</span><span id="line-1827"></span><span class="hs-comment">-- to see if an inert already exists, and uses that instead of creating</span><span>
</span><span id="line-1828"></span><span class="hs-comment">-- a new Wanted constraint.</span><span>
</span><span id="line-1829"></span><span class="hs-comment">--</span><span>
</span><span id="line-1830"></span><span class="hs-comment">-- Don't use this for equality constraints: this function is only for</span><span>
</span><span id="line-1831"></span><span class="hs-comment">-- constraints with 'EvVarDest'.</span><span>
</span><span id="line-1832"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar"><span class="hs-identifier hs-type">newWantedEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span>
</span><span id="line-1833"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span>
</span><span id="line-1834"></span><span class="hs-comment">-- For anything except ClassPred, this is the same as newWantedEvVarNC</span><span>
</span><span id="line-1835"></span><span id="newWantedEvVar"><span class="annot"><span class="annottext">newWantedEvVar :: CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar"><span class="hs-identifier hs-var hs-var">newWantedEvVar</span></a></span></span><span> </span><span id="local-6989586621683039381"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039381"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039382"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039382"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621683039383"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039383"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-1836"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcS MaybeNew -&gt; TcS MaybeNew
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqPrimPred"><span class="hs-identifier hs-var">isEqPrimPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039383"><span class="hs-identifier hs-var">pty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1837"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newWantedEvVar: HoleDestPred&quot;</span></span><span>
</span><span id="line-1838"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pty:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039383"><span class="hs-identifier hs-var">pty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS MaybeNew -&gt; TcS MaybeNew) -&gt; TcS MaybeNew -&gt; TcS MaybeNew
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1839"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039385"><span class="annot"><a href="#local-6989586621683039385"><span class="hs-identifier hs-var">mb_ct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcS (Maybe CtEvidence)
</span><a href="GHC.Tc.Solver.Monad.html#lookupInInerts"><span class="hs-identifier hs-var">lookupInInerts</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039381"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039383"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1840"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039385"><span class="hs-identifier hs-type">mb_ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1841"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683039386"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039386"><span class="hs-identifier hs-var">ctev</span></a></span></span><span>
</span><span id="line-1842"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newWantedEvVar/cache hit&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039386"><span class="hs-identifier hs-var">ctev</span></a></span><span>
</span><span id="line-1843"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">MaybeNew -&gt; TcS MaybeNew
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MaybeNew -&gt; TcS MaybeNew) -&gt; MaybeNew -&gt; TcS MaybeNew
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; EvExpr
CtEvidence -&gt; EvExpr
</span><a href="GHC.Tc.Types.Constraint.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039386"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1844"></span><span>            </span><span class="annot"><span class="annottext">Maybe CtEvidence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039387"><span class="annot"><a href="#local-6989586621683039387"><span class="hs-identifier hs-var">ctev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-var">newWantedEvVarNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039381"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039382"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039383"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1845"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039387"><span class="hs-identifier hs-type">ctev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1846"></span><span>
</span><span id="line-1847"></span><span class="hs-comment">-- | Create a new Wanted constraint, potentially looking up</span><span>
</span><span id="line-1848"></span><span class="hs-comment">-- non-equality constraints in the cache instead of creating</span><span>
</span><span id="line-1849"></span><span class="hs-comment">-- a new one from scratch.</span><span>
</span><span id="line-1850"></span><span class="hs-comment">--</span><span>
</span><span id="line-1851"></span><span class="hs-comment">-- Deals with both equality and non-equality constraints.</span><span>
</span><span id="line-1852"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier hs-type">newWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span>
</span><span id="line-1853"></span><span id="newWanted"><span class="annot"><span class="annottext">newWanted :: CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier hs-var hs-var">newWanted</span></a></span></span><span> </span><span id="local-6989586621683039388"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039388"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039389"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039389"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621683039390"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039390"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-1854"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039391"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039391"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039392"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039392"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039393"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039393"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Role, Type, Type)
</span><a href="GHC.Core.Predicate.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039390"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1855"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; MaybeNew)
-&gt; ((CtEvidence, Coercion) -&gt; CtEvidence)
-&gt; (CtEvidence, Coercion)
-&gt; MaybeNew
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence, Coercion) -&gt; CtEvidence
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((CtEvidence, Coercion) -&gt; MaybeNew)
-&gt; TcS (CtEvidence, Coercion) -&gt; TcS MaybeNew
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039388"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039389"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039391"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039392"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039393"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1856"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1857"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar"><span class="hs-identifier hs-var">newWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039388"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039389"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039390"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1858"></span><span>
</span><span id="line-1859"></span><span class="hs-comment">-- | Create a new Wanted constraint.</span><span>
</span><span id="line-1860"></span><span class="hs-comment">--</span><span>
</span><span id="line-1861"></span><span class="hs-comment">-- Deals with both equality and non-equality constraints.</span><span>
</span><span id="line-1862"></span><span class="hs-comment">--</span><span>
</span><span id="line-1863"></span><span class="hs-comment">-- Does not attempt to re-use non-equality constraints that already</span><span>
</span><span id="line-1864"></span><span class="hs-comment">-- exist in the inert set.</span><span>
</span><span id="line-1865"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedNC"><span class="hs-identifier hs-type">newWantedNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-1866"></span><span id="newWantedNC"><span class="annot"><span class="annottext">newWantedNC :: CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedNC"><span class="hs-identifier hs-var hs-var">newWantedNC</span></a></span></span><span> </span><span id="local-6989586621683039396"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039396"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039397"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039397"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621683039398"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039398"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-1867"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039399"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039399"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039400"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039400"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039401"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039401"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Role, Type, Type)
</span><a href="GHC.Core.Predicate.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039398"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1868"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CtEvidence, Coercion) -&gt; CtEvidence
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((CtEvidence, Coercion) -&gt; CtEvidence)
-&gt; TcS (CtEvidence, Coercion) -&gt; TcS CtEvidence
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039396"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039397"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039399"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039400"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039401"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1869"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1870"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-var">newWantedEvVarNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039396"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039397"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039398"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-1871"></span><span>
</span><span id="line-1872"></span><span class="hs-comment">-- | Checks if the depth of the given location is too much. Fails if</span><span>
</span><span id="line-1873"></span><span class="hs-comment">-- it's too big, with an appropriate error message.</span><span>
</span><span id="line-1874"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkReductionDepth"><span class="hs-identifier hs-type">checkReductionDepth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ type being reduced</span></span><span>
</span><span id="line-1875"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1876"></span><span id="checkReductionDepth"><span class="annot"><span class="annottext">checkReductionDepth :: CtLoc -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#checkReductionDepth"><span class="hs-identifier hs-var hs-var">checkReductionDepth</span></a></span></span><span> </span><span id="local-6989586621683039402"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039402"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039403"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039403"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1877"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039404"><span class="annot"><a href="#local-6989586621683039404"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1878"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#subGoalDepthExceeded"><span class="hs-identifier hs-type">subGoalDepthExceeded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#reductionDepth"><span class="hs-identifier hs-var">reductionDepth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039404"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctLocDepth"><span class="hs-identifier hs-type">ctLocDepth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039402"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1879"></span><span>         </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier hs-type">wrapErrTcS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#solverDepthError"><span class="hs-identifier hs-type">solverDepthError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039402"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039403"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1880"></span><span>
</span><span id="line-1881"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFam"><span class="hs-identifier hs-type">matchFam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ReductionN"><span class="hs-identifier hs-type">ReductionN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1882"></span><span id="matchFam"><span class="annot"><span class="annottext">matchFam :: TyCon -&gt; [Type] -&gt; TcS (Maybe Reduction)
</span><a href="GHC.Tc.Solver.Monad.html#matchFam"><span class="hs-identifier hs-var hs-var">matchFam</span></a></span></span><span> </span><span id="local-6989586621683039409"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039409"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621683039410"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039410"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe Reduction) -&gt; TcS (Maybe Reduction)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe Reduction) -&gt; TcS (Maybe Reduction))
-&gt; TcM (Maybe Reduction) -&gt; TcS (Maybe Reduction)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TcM (Maybe Reduction)
</span><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier hs-var">matchFamTcM</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039409"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039410"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1883"></span><span>
</span><span id="line-1884"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier hs-type">matchFamTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ReductionN"><span class="hs-identifier hs-type">ReductionN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1885"></span><span class="hs-comment">-- Given (F tys) return (ty, co), where co :: F tys ~N ty</span><span>
</span><span id="line-1886"></span><span id="matchFamTcM"><span class="annot"><span class="annottext">matchFamTcM :: TyCon -&gt; [Type] -&gt; TcM (Maybe Reduction)
</span><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier hs-var hs-var">matchFamTcM</span></a></span></span><span> </span><span id="local-6989586621683039411"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039411"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621683039412"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039412"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1887"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039413"><span class="annot"><a href="#local-6989586621683039413"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (FamInstEnv, FamInstEnv)
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">FamInst.tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1888"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039414"><span class="annot"><a href="#local-6989586621683039414"><span class="hs-identifier hs-var hs-var">match_fam_result</span></a></span></span><span>
</span><span id="line-1889"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
-&gt; Role -&gt; TyCon -&gt; [Type] -&gt; Maybe Reduction
</span><a href="GHC.Core.FamInstEnv.html#reduceTyFamApp_maybe"><span class="hs-identifier hs-var">reduceTyFamApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621683039413"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039411"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039412"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1890"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;matchFamTcM&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1891"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Matching:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039411"><span class="hs-identifier hs-type">tycon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039412"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039417"><span class="hs-identifier hs-type">ppr_res</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039414"><span class="hs-identifier hs-type">match_fam_result</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1893"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683039414"><span class="hs-identifier hs-type">match_fam_result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1894"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1895"></span><span>    </span><span id="local-6989586621683039417"><span class="annot"><span class="annottext">ppr_res :: Maybe Reduction -&gt; SDoc
</span><a href="#local-6989586621683039417"><span class="hs-identifier hs-var hs-var">ppr_res</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Reduction
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Match failed&quot;</span></span><span>
</span><span id="line-1896"></span><span>    </span><span class="annot"><a href="#local-6989586621683039417"><span class="hs-identifier hs-var">ppr_res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621683039427"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039427"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621683039428"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039428"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1897"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Match succeeded:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1898"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Rewrites to:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039428"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1899"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Coercion:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683039427"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span id="local-6989586621683037608"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#solverDepthError"><span class="hs-identifier hs-type">solverDepthError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037608"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1902"></span><span id="solverDepthError"><span class="annot"><span class="annottext">solverDepthError :: forall a. CtLoc -&gt; Type -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#solverDepthError"><span class="hs-identifier hs-var hs-var">solverDepthError</span></a></span></span><span> </span><span id="local-6989586621683039433"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039433"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683039434"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039434"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1903"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcM a -&gt; TcM a
forall a. CtLoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-var">TcM.setCtLocM</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039433"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1904"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039435"><span class="annot"><a href="#local-6989586621683039435"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039436"><span class="annot"><a href="#local-6989586621683039436"><span class="hs-identifier hs-var">env0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM (Type, TidyEnv) -&gt; TcM (Type, TidyEnv)
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">TcM.liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM (Type, TidyEnv) -&gt; TcM (Type, TidyEnv))
-&gt; ZonkM (Type, TidyEnv) -&gt; TcM (Type, TidyEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1905"></span><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039437"><span class="annot"><a href="#local-6989586621683039437"><span class="hs-identifier hs-var">ty</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">TcM.zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039434"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1906"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039438"><span class="annot"><a href="#local-6989586621683039438"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-type">TcM.tcInitTidyEnv</span></a></span><span>
</span><span id="line-1907"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039437"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039438"><span class="hs-identifier hs-type">env0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039440"><span class="annot"><a href="#local-6989586621683039440"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039441"><span class="annot"><a href="#local-6989586621683039441"><span class="hs-identifier hs-var">tidy_ty</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier hs-type">tidyOpenTypeX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039436"><span class="hs-identifier hs-type">env0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039435"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-1909"></span><span>             </span><span id="local-6989586621683039443"><span class="annot"><a href="#local-6989586621683039443"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SubGoalDepth -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnSolverDepthError"><span class="hs-identifier hs-var">TcRnSolverDepthError</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039441"><span class="hs-identifier hs-var">tidy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SubGoalDepth
</span><a href="#local-6989586621683039445"><span class="hs-identifier hs-var">depth</span></a></span><span>
</span><span id="line-1910"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-type">TcM.failWithTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039440"><span class="hs-identifier hs-type">tidy_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039443"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1911"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1912"></span><span>    </span><span id="local-6989586621683039445"><span class="annot"><span class="annottext">depth :: SubGoalDepth
</span><a href="#local-6989586621683039445"><span class="hs-identifier hs-var hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; SubGoalDepth
</span><a href="GHC.Tc.Types.CtLoc.html#ctLocDepth"><span class="hs-identifier hs-var">ctLocDepth</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039433"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1913"></span><span>
</span><span id="line-1914"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Emitting equalities arising from fundeps
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1921"></span><span>
</span><span id="line-1922"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitFunDepWanteds"><span class="hs-identifier hs-type">emitFunDepWanteds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>  </span><span class="hs-comment">-- The work item</span><span>
</span><span id="line-1923"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Instance.FunDeps.html#FunDepEqn"><span class="hs-identifier hs-type">FunDepEqn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1924"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="hs-comment">-- True &lt;=&gt; some unification happened</span><span>
</span><span id="line-1925"></span><span>
</span><span id="line-1926"></span><span id="emitFunDepWanteds"><span class="annot"><span class="annottext">emitFunDepWanteds :: CtEvidence -&gt; [FunDepEqn (CtLoc, RewriterSet)] -&gt; TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#emitFunDepWanteds"><span class="hs-identifier hs-var hs-var">emitFunDepWanteds</span></a></span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcS Bool
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- common case noop</span><span>
</span><span id="line-1927"></span><span class="hs-comment">-- See Note [FunDep and implicit parameter reactions]</span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitFunDepWanteds"><span class="hs-identifier hs-var">emitFunDepWanteds</span></a></span><span> </span><span id="local-6989586621683039447"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039447"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039448"><span class="annot"><span class="annottext">[FunDepEqn (CtLoc, RewriterSet)]
</span><a href="#local-6989586621683039448"><span class="hs-identifier hs-var">fd_eqns</span></a></span></span><span>
</span><span id="line-1930"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Role -&gt; (UnifyEnv -&gt; TcM ()) -&gt; TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#unifyFunDeps"><span class="hs-identifier hs-var">unifyFunDeps</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039447"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM ()
</span><a href="#local-6989586621683039449"><span class="hs-identifier hs-var">do_fundeps</span></a></span><span>
</span><span id="line-1931"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1932"></span><span>    </span><span class="annot"><a href="#local-6989586621683039449"><span class="hs-identifier hs-type">do_fundeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UnifyEnv"><span class="hs-identifier hs-type">UnifyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1933"></span><span>    </span><span id="local-6989586621683039449"><span class="annot"><span class="annottext">do_fundeps :: UnifyEnv -&gt; TcM ()
</span><a href="#local-6989586621683039449"><span class="hs-identifier hs-var hs-var">do_fundeps</span></a></span></span><span> </span><span id="local-6989586621683039450"><span class="annot"><span class="annottext">UnifyEnv
</span><a href="#local-6989586621683039450"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDepEqn (CtLoc, RewriterSet) -&gt; TcM ())
-&gt; [FunDepEqn (CtLoc, RewriterSet)] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnifyEnv -&gt; FunDepEqn (CtLoc, RewriterSet) -&gt; TcM ()
</span><a href="#local-6989586621683039452"><span class="hs-identifier hs-var">do_one</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyEnv
</span><a href="#local-6989586621683039450"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDepEqn (CtLoc, RewriterSet)]
</span><a href="#local-6989586621683039448"><span class="hs-identifier hs-var">fd_eqns</span></a></span><span>
</span><span id="line-1934"></span><span>
</span><span id="line-1935"></span><span>    </span><span class="annot"><a href="#local-6989586621683039452"><span class="hs-identifier hs-type">do_one</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UnifyEnv"><span class="hs-identifier hs-type">UnifyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.FunDeps.html#FunDepEqn"><span class="hs-identifier hs-type">FunDepEqn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1936"></span><span>    </span><span id="local-6989586621683039452"><span class="annot"><span class="annottext">do_one :: UnifyEnv -&gt; FunDepEqn (CtLoc, RewriterSet) -&gt; TcM ()
</span><a href="#local-6989586621683039452"><span class="hs-identifier hs-var hs-var">do_one</span></a></span></span><span> </span><span id="local-6989586621683039453"><span class="annot"><span class="annottext">UnifyEnv
</span><a href="#local-6989586621683039453"><span class="hs-identifier hs-var">uenv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Instance.FunDeps.html#FDEqn"><span class="hs-identifier hs-type">FDEqn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fd_qtvs :: forall loc. FunDepEqn loc -&gt; [TcTyVar]
</span><a href="GHC.Tc.Instance.FunDeps.html#fd_qtvs"><span class="hs-identifier hs-var">fd_qtvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039456"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039456"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fd_eqs :: forall loc. FunDepEqn loc -&gt; [TypeEqn]
</span><a href="GHC.Tc.Instance.FunDeps.html#fd_eqs"><span class="hs-identifier hs-var">fd_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039458"><span class="annot"><span class="annottext">[TypeEqn]
</span><a href="#local-6989586621683039458"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fd_loc :: forall loc. FunDepEqn loc -&gt; loc
</span><a href="GHC.Tc.Instance.FunDeps.html#fd_loc"><span class="hs-identifier hs-var">fd_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039460"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039460"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039461"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039461"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1937"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039462"><span class="annot"><a href="#local-6989586621683039462"><span class="hs-identifier hs-var">eqs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TypeEqn] -&gt; TcM [TypeEqn]
</span><a href="#local-6989586621683039463"><span class="hs-identifier hs-var">instantiate_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039456"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeEqn] -&gt; [TypeEqn]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[TypeEqn]
</span><a href="#local-6989586621683039458"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1938"></span><span>                     </span><span class="hs-comment">-- (reverse eqs): See Note [Reverse order of fundep equations]</span><span>
</span><span id="line-1939"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#uPairsTcM"><span class="hs-identifier hs-type">uPairsTcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039465"><span class="hs-identifier hs-type">env_one</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039462"><span class="hs-identifier hs-type">eqs'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1940"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1941"></span><span>        </span><span id="local-6989586621683039465"><span class="annot"><span class="annottext">env_one :: UnifyEnv
</span><a href="#local-6989586621683039465"><span class="hs-identifier hs-var hs-var">env_one</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyEnv
</span><a href="#local-6989586621683039453"><span class="hs-identifier hs-var">uenv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#u_rewriters"><span class="hs-identifier hs-var">u_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#u_rewriters"><span class="hs-identifier hs-var">u_rewriters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039453"><span class="hs-identifier hs-type">uenv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">S.&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683039461"><span class="hs-identifier hs-type">rewriters</span></a></span><span>
</span><span id="line-1942"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#u_loc"><span class="hs-identifier hs-var">u_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683039460"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1943"></span><span>
</span><span id="line-1944"></span><span>    </span><span class="annot"><a href="#local-6989586621683039463"><span class="hs-identifier hs-type">instantiate_eqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#TypeEqn"><span class="hs-identifier hs-type">TypeEqn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#TypeEqn"><span class="hs-identifier hs-type">TypeEqn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1945"></span><span>    </span><span id="local-6989586621683039463"><span class="annot"><span class="annottext">instantiate_eqs :: [TcTyVar] -&gt; [TypeEqn] -&gt; TcM [TypeEqn]
</span><a href="#local-6989586621683039463"><span class="hs-identifier hs-var hs-var">instantiate_eqs</span></a></span></span><span> </span><span id="local-6989586621683039468"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039468"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621683039469"><span class="annot"><span class="annottext">[TypeEqn]
</span><a href="#local-6989586621683039469"><span class="hs-identifier hs-var">eqs</span></a></span></span><span>
</span><span id="line-1946"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039468"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1947"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TypeEqn] -&gt; TcM [TypeEqn]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[TypeEqn]
</span><a href="#local-6989586621683039469"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-1948"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1949"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emitFunDepWanteds 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039468"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeEqn] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeEqn]
</span><a href="#local-6989586621683039469"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1950"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039470"><span class="annot"><a href="#local-6989586621683039470"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [TcTyVar] -&gt; TcM Subst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiXTcM"><span class="hs-identifier hs-var">instFlexiXTcM</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683039468"><span class="hs-identifier hs-var">tvs</span></a></span><span>  </span><span class="hs-comment">-- Takes account of kind substitution</span><span>
</span><span id="line-1951"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-type">substTyUnchecked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039472"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039473"><span class="hs-identifier hs-type">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683039474"><span class="hs-identifier hs-type">ty2</span></a></span><span>
</span><span id="line-1952"></span><span>                           </span><span class="hs-comment">-- ty2 does not mention fd_qtvs, so no need to subst it.</span><span>
</span><span id="line-1953"></span><span>                           </span><span class="hs-comment">-- See GHC.Tc.Instance.Fundeps Note [Improving against instances]</span><span>
</span><span id="line-1954"></span><span>                           </span><span class="hs-comment">--     Wrinkle (1)</span><span>
</span><span id="line-1955"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621683039473"><span class="annot"><a href="#local-6989586621683039473"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683039474"><span class="annot"><a href="#local-6989586621683039474"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683039469"><span class="hs-identifier hs-type">eqs</span></a></span><span>
</span><span id="line-1956"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039472"><span class="annot"><a href="#local-6989586621683039472"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; VarSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScopeSet"><span class="hs-identifier hs-var">extendSubstInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683039470"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039473"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1957"></span><span>                          </span><span class="hs-comment">-- The free vars of ty1 aren't just fd_qtvs: ty1 is the result</span><span>
</span><span id="line-1958"></span><span>                          </span><span class="hs-comment">-- of matching with the [W] constraint. So we add its free</span><span>
</span><span id="line-1959"></span><span>                          </span><span class="hs-comment">-- vars to InScopeSet, to satisfy substTy's invariants, even</span><span>
</span><span id="line-1960"></span><span>                          </span><span class="hs-comment">-- though ty1 will never (currently) be a poytype, so this</span><span>
</span><span id="line-1961"></span><span>                          </span><span class="hs-comment">-- InScopeSet will never be looked at.</span><span>
</span><span id="line-1962"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1963"></span><span>
</span><span id="line-1964"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Unification
*                                                                      *
************************************************************************

Note [wrapUnifierTcS]
~~~~~~~~~~~~~~~~~~~
When decomposing equalities we often create new wanted constraints for
(s ~ t).  But what if s=t?  Then it'd be faster to return Refl right away.

Rather than making an equality test (which traverses the structure of the type,
perhaps fruitlessly), we call uType (via wrapUnifierTcS) to traverse the common
structure, and bales out when it finds a difference by creating a new deferred
Wanted constraint.  But where it succeeds in finding common structure, it just
builds a coercion to reflect it.

This is all much faster than creating a new constraint, putting it in the
work list, picking it out, canonicalising it, etc etc.

Note [unifyFunDeps]
~~~~~~~~~~~~~~~~~~~
The Bool returned by `unifyFunDeps` is True if we have unified a variable
that occurs in the constraint we are trying to solve; it is not in the
inert set so `wrapUnifierTcS` won't kick it out.  Instead we want to send it
back to the start of the pipeline.  Hence the Bool.

It's vital that we don't return (not (null unified)) because the fundeps
may create fresh variables; unifying them (alone) should not make us send
the constraint back to the start, or we'll get an infinite loop.  See
Note [Fundeps with instances, and equality orientation] in GHC.Tc.Solver.Dict
and Note [Improvement orientation] in GHC.Tc.Solver.Equality.
-}</span><span>
</span><span id="line-1998"></span><span>
</span><span id="line-1999"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#uPairsTcM"><span class="hs-identifier hs-type">uPairsTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UnifyEnv"><span class="hs-identifier hs-type">UnifyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#TypeEqn"><span class="hs-identifier hs-type">TypeEqn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2000"></span><span id="uPairsTcM"><span class="annot"><span class="annottext">uPairsTcM :: UnifyEnv -&gt; [TypeEqn] -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#uPairsTcM"><span class="hs-identifier hs-var hs-var">uPairsTcM</span></a></span></span><span> </span><span id="local-6989586621683039477"><span class="annot"><span class="annottext">UnifyEnv
</span><a href="#local-6989586621683039477"><span class="hs-identifier hs-var">uenv</span></a></span></span><span> </span><span id="local-6989586621683039478"><span class="annot"><span class="annottext">[TypeEqn]
</span><a href="#local-6989586621683039478"><span class="hs-identifier hs-var">eqns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeEqn -&gt; TcM Coercion) -&gt; [TypeEqn] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621683039479"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039479"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683039480"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039480"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnifyEnv -&gt; Type -&gt; Type -&gt; TcM Coercion
</span><a href="GHC.Tc.Utils.Unify.html#uType"><span class="hs-identifier hs-var">uType</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyEnv
</span><a href="#local-6989586621683039477"><span class="hs-identifier hs-var">uenv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039479"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039480"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TypeEqn]
</span><a href="#local-6989586621683039478"><span class="hs-identifier hs-var">eqns</span></a></span><span>
</span><span id="line-2001"></span><span>
</span><span id="line-2002"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyFunDeps"><span class="hs-identifier hs-type">unifyFunDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-2003"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UnifyEnv"><span class="hs-identifier hs-type">UnifyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2004"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2005"></span><span id="unifyFunDeps"><span class="annot"><span class="annottext">unifyFunDeps :: CtEvidence -&gt; Role -&gt; (UnifyEnv -&gt; TcM ()) -&gt; TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#unifyFunDeps"><span class="hs-identifier hs-var hs-var">unifyFunDeps</span></a></span></span><span> </span><span id="local-6989586621683039482"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039482"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039483"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039483"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621683039484"><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM ()
</span><a href="#local-6989586621683039484"><span class="hs-identifier hs-var">do_unifications</span></a></span></span><span>
</span><span id="line-2006"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039485"><span class="annot"><a href="#local-6989586621683039485"><span class="hs-identifier hs-var">unified</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; Role -&gt; (UnifyEnv -&gt; TcM ()) -&gt; TcS ((), Cts, [TcTyVar])
forall a.
CtEvidence
-&gt; Role -&gt; (UnifyEnv -&gt; TcM a) -&gt; TcS (a, Cts, [TcTyVar])
</span><a href="GHC.Tc.Solver.Monad.html#wrapUnifierTcS"><span class="hs-identifier hs-var">wrapUnifierTcS</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039482"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039483"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM ()
</span><a href="#local-6989586621683039484"><span class="hs-identifier hs-var">do_unifications</span></a></span><span>
</span><span id="line-2007"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`elemVarSet`</span></span><span> </span><span class="annot"><span class="hs-identifier">fvs</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683039485"><span class="hs-identifier hs-type">unified</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2008"></span><span>         </span><span class="hs-comment">-- See Note [unifyFunDeps]</span><span>
</span><span id="line-2009"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2010"></span><span>    </span><span id="local-6989586621683039486"><span class="annot"><span class="annottext">fvs :: VarSet
</span><a href="#local-6989586621683039486"><span class="hs-identifier hs-var hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039482"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2011"></span><span>
</span><span id="line-2012"></span><span id="local-6989586621683037625"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyForAllBody"><span class="hs-identifier hs-type">unifyForAllBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UnifyEnv"><span class="hs-identifier hs-type">UnifyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037625"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2013"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037625"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2014"></span><span class="hs-comment">-- We /return/ the equality constraints we generate,</span><span>
</span><span id="line-2015"></span><span class="hs-comment">-- rather than emitting them into the monad.</span><span>
</span><span id="line-2016"></span><span class="hs-comment">-- See See (SF5) in Note [Solving forall equalities] in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-2017"></span><span id="unifyForAllBody"><span class="annot"><span class="annottext">unifyForAllBody :: forall a. CtEvidence -&gt; Role -&gt; (UnifyEnv -&gt; TcM a) -&gt; TcS (a, Cts)
</span><a href="GHC.Tc.Solver.Monad.html#unifyForAllBody"><span class="hs-identifier hs-var hs-var">unifyForAllBody</span></a></span></span><span> </span><span id="local-6989586621683039490"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039490"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039491"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039491"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621683039492"><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM a
</span><a href="#local-6989586621683039492"><span class="hs-identifier hs-var">unify_body</span></a></span></span><span>
</span><span id="line-2018"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039493"><span class="annot"><a href="#local-6989586621683039493"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039494"><span class="annot"><a href="#local-6989586621683039494"><span class="hs-identifier hs-var">cts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039495"><span class="annot"><a href="#local-6989586621683039495"><span class="hs-identifier hs-var">unified</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039496"><span class="annot"><a href="#local-6989586621683039496"><span class="hs-identifier hs-var">_rewriters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; Role
-&gt; (UnifyEnv -&gt; TcM a)
-&gt; TcS (a, Cts, [TcTyVar], RewriterSet)
forall a.
CtEvidence
-&gt; Role
-&gt; (UnifyEnv -&gt; TcM a)
-&gt; TcS (a, Cts, [TcTyVar], RewriterSet)
</span><a href="GHC.Tc.Solver.Monad.html#wrapUnifierX"><span class="hs-identifier hs-var">wrapUnifierX</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039490"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039491"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM a
</span><a href="#local-6989586621683039492"><span class="hs-identifier hs-var">unify_body</span></a></span><span>
</span><span id="line-2019"></span><span>         </span><span class="hs-comment">-- Ignore the rewriters. They are used in wrapUnifierTcS only</span><span>
</span><span id="line-2020"></span><span>         </span><span class="hs-comment">-- as an optimistion to prioritise the work list; but they are</span><span>
</span><span id="line-2021"></span><span>         </span><span class="hs-comment">-- /also/ stored in each individual constraint we return.</span><span>
</span><span id="line-2022"></span><span>
</span><span id="line-2023"></span><span>       </span><span class="hs-comment">-- Kick out any inert constraint that we have unified</span><span>
</span><span id="line-2024"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier hs-type">kickOutAfterUnification</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039495"><span class="hs-identifier hs-type">unified</span></a></span><span>
</span><span id="line-2025"></span><span>
</span><span id="line-2026"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039493"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039494"><span class="hs-identifier hs-type">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2027"></span><span>
</span><span id="line-2028"></span><span id="local-6989586621683037624"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapUnifierTcS"><span class="hs-identifier hs-type">wrapUnifierTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-2029"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UnifyEnv"><span class="hs-identifier hs-type">UnifyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037624"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Some calls to uType</span><span>
</span><span id="line-2030"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037624"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-2031"></span><span class="hs-comment">-- Invokes the do_unifications argument, with a suitable UnifyEnv.</span><span>
</span><span id="line-2032"></span><span class="hs-comment">-- Emit deferred equalities and kick-out from the inert set as a</span><span>
</span><span id="line-2033"></span><span class="hs-comment">-- result of any unifications.</span><span>
</span><span id="line-2034"></span><span class="hs-comment">-- Very good short-cut when the two types are equal, or nearly so</span><span>
</span><span id="line-2035"></span><span class="hs-comment">-- See Note [wrapUnifierTcS]</span><span>
</span><span id="line-2036"></span><span class="hs-comment">--</span><span>
</span><span id="line-2037"></span><span class="hs-comment">-- The [TcTyVar] is the list of unification variables that were</span><span>
</span><span id="line-2038"></span><span class="hs-comment">-- unified the process; the (Bag Ct) are the deferred constraints.</span><span>
</span><span id="line-2039"></span><span>
</span><span id="line-2040"></span><span id="wrapUnifierTcS"><span class="annot"><span class="annottext">wrapUnifierTcS :: forall a.
CtEvidence
-&gt; Role -&gt; (UnifyEnv -&gt; TcM a) -&gt; TcS (a, Cts, [TcTyVar])
</span><a href="GHC.Tc.Solver.Monad.html#wrapUnifierTcS"><span class="hs-identifier hs-var hs-var">wrapUnifierTcS</span></a></span></span><span> </span><span id="local-6989586621683039503"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039503"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039504"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039504"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621683039505"><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM a
</span><a href="#local-6989586621683039505"><span class="hs-identifier hs-var">do_unifications</span></a></span></span><span>
</span><span id="line-2041"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039506"><span class="annot"><a href="#local-6989586621683039506"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039507"><span class="annot"><a href="#local-6989586621683039507"><span class="hs-identifier hs-var">cts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039508"><span class="annot"><a href="#local-6989586621683039508"><span class="hs-identifier hs-var">unified</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039509"><span class="annot"><a href="#local-6989586621683039509"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; Role
-&gt; (UnifyEnv -&gt; TcM a)
-&gt; TcS (a, Cts, [TcTyVar], RewriterSet)
forall a.
CtEvidence
-&gt; Role
-&gt; (UnifyEnv -&gt; TcM a)
-&gt; TcS (a, Cts, [TcTyVar], RewriterSet)
</span><a href="GHC.Tc.Solver.Monad.html#wrapUnifierX"><span class="hs-identifier hs-var">wrapUnifierX</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039503"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039504"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM a
</span><a href="#local-6989586621683039505"><span class="hs-identifier hs-var">do_unifications</span></a></span><span>
</span><span id="line-2042"></span><span>
</span><span id="line-2043"></span><span>       </span><span class="hs-comment">-- Emit the deferred constraints</span><span>
</span><span id="line-2044"></span><span>       </span><span class="hs-comment">-- See Note [Work-list ordering] in GHC.Tc.Solved.Equality</span><span>
</span><span id="line-2045"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-2046"></span><span>       </span><span class="hs-comment">-- All the constraints in `cts` share the same rewriter set so,</span><span>
</span><span id="line-2047"></span><span>       </span><span class="hs-comment">-- rather than looking at it one by one, we pass it to</span><span>
</span><span id="line-2048"></span><span>       </span><span class="hs-comment">-- extendWorkListEqs; just a small optimisation.</span><span>
</span><span id="line-2049"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-type">isEmptyBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039507"><span class="hs-identifier hs-type">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2050"></span><span>         </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-type">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEqs"><span class="hs-identifier hs-type">extendWorkListEqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039509"><span class="hs-identifier hs-type">rewriters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039507"><span class="hs-identifier hs-type">cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2051"></span><span>
</span><span id="line-2052"></span><span>       </span><span class="hs-comment">-- And kick out any inert constraint that we have unified</span><span>
</span><span id="line-2053"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier hs-type">kickOutAfterUnification</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039508"><span class="hs-identifier hs-type">unified</span></a></span><span>
</span><span id="line-2054"></span><span>
</span><span id="line-2055"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039506"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039507"><span class="hs-identifier hs-type">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039508"><span class="hs-identifier hs-type">unified</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2056"></span><span>
</span><span id="line-2057"></span><span id="local-6989586621683037627"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapUnifierX"><span class="hs-identifier hs-type">wrapUnifierX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-2058"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UnifyEnv"><span class="hs-identifier hs-type">UnifyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037627"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Some calls to uType</span><span>
</span><span id="line-2059"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683037627"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2060"></span><span id="wrapUnifierX"><span class="annot"><span class="annottext">wrapUnifierX :: forall a.
CtEvidence
-&gt; Role
-&gt; (UnifyEnv -&gt; TcM a)
-&gt; TcS (a, Cts, [TcTyVar], RewriterSet)
</span><a href="GHC.Tc.Solver.Monad.html#wrapUnifierX"><span class="hs-identifier hs-var hs-var">wrapUnifierX</span></a></span></span><span> </span><span id="local-6989586621683039529"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039529"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039530"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039530"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621683039531"><span class="annot"><span class="annottext">UnifyEnv -&gt; TcM a
</span><a href="#local-6989586621683039531"><span class="hs-identifier hs-var">do_unifications</span></a></span></span><span>
</span><span id="line-2061"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039532"><span class="annot"><a href="#local-6989586621683039532"><span class="hs-identifier hs-var">unif_count_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef Int)
</span><a href="GHC.Tc.Solver.Monad.html#getUnifiedRef"><span class="hs-identifier hs-var">getUnifiedRef</span></a></span><span>
</span><span id="line-2062"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2063"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039533"><span class="annot"><a href="#local-6989586621683039533"><span class="hs-identifier hs-var">defer_ref</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-type">emptyBag</span></a></span><span>
</span><span id="line-2064"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039534"><span class="annot"><a href="#local-6989586621683039534"><span class="hs-identifier hs-var">unified_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">TcM.newTcRef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2065"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039535"><span class="annot"><a href="#local-6989586621683039535"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#zonkRewriterSet"><span class="hs-identifier hs-type">TcM.zonkRewriterSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvRewriters"><span class="hs-identifier hs-type">ctEvRewriters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039529"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2066"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039538"><span class="annot"><a href="#local-6989586621683039538"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#UE"><span class="hs-identifier hs-type">UE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">u_role :: Role
</span><a href="GHC.Tc.Utils.Unify.html#u_role"><span class="hs-identifier hs-var">u_role</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683039530"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-2067"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">u_rewriters :: RewriterSet
</span><a href="GHC.Tc.Utils.Unify.html#u_rewriters"><span class="hs-identifier hs-var">u_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621683039535"><span class="hs-identifier hs-var">rewriters</span></a></span><span>
</span><span id="line-2068"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">u_loc :: CtLoc
</span><a href="GHC.Tc.Utils.Unify.html#u_loc"><span class="hs-identifier hs-var">u_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039529"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2069"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">u_defer :: TcRef Cts
</span><a href="GHC.Tc.Utils.Unify.html#u_defer"><span class="hs-identifier hs-var">u_defer</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef Cts
</span><a href="#local-6989586621683039533"><span class="hs-identifier hs-var">defer_ref</span></a></span><span>
</span><span id="line-2070"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">u_unified :: Maybe (TcRef [TcTyVar])
</span><a href="GHC.Tc.Utils.Unify.html#u_unified"><span class="hs-identifier hs-var">u_unified</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef [TcTyVar] -&gt; Maybe (TcRef [TcTyVar])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TcRef [TcTyVar]
</span><a href="#local-6989586621683039534"><span class="hs-identifier hs-var">unified_ref</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2071"></span><span>
</span><span id="line-2072"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039543"><span class="annot"><a href="#local-6989586621683039543"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683039531"><span class="hs-identifier hs-type">do_unifications</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039538"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-2073"></span><span>
</span><span id="line-2074"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039544"><span class="annot"><a href="#local-6989586621683039544"><span class="hs-identifier hs-var">cts</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039533"><span class="hs-identifier hs-type">defer_ref</span></a></span><span>
</span><span id="line-2075"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039545"><span class="annot"><a href="#local-6989586621683039545"><span class="hs-identifier hs-var">unified</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">TcM.readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039534"><span class="hs-identifier hs-type">unified_ref</span></a></span><span>
</span><span id="line-2076"></span><span>
</span><span id="line-2077"></span><span>            </span><span class="hs-comment">-- Don't forget to update the count of variables</span><span>
</span><span id="line-2078"></span><span>            </span><span class="hs-comment">-- unified, lest we forget to iterate (#24146)</span><span>
</span><span id="line-2079"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683039545"><span class="hs-identifier hs-type">unified</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2080"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">TcM.updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039532"><span class="hs-identifier hs-type">unif_count_ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">length</span></span><span> </span><span class="annot"><span class="hs-identifier">unified</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>
</span><span id="line-2082"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039543"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039544"><span class="hs-identifier hs-type">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039545"><span class="hs-identifier hs-type">unified</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039535"><span class="hs-identifier hs-type">rewriters</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2083"></span><span>
</span><span id="line-2084"></span><span>
</span><span id="line-2085"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Breaking type variable cycles
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2092"></span><span>
</span><span id="line-2093"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkTouchableTyVarEq"><span class="hs-identifier hs-type">checkTouchableTyVarEq</span></a></span><span>
</span><span id="line-2094"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-2095"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>    </span><span class="hs-comment">-- A touchable meta-tyvar</span><span>
</span><span id="line-2096"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>     </span><span class="hs-comment">-- The RHS</span><span>
</span><span id="line-2097"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuResult"><span class="hs-identifier hs-type">PuResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2098"></span><span class="hs-comment">-- Used for Nominal, Wanted equalities, with a touchable meta-tyvar on LHS</span><span>
</span><span id="line-2099"></span><span class="hs-comment">-- If checkTouchableTyVarEq tv ty = PuOK cts redn</span><span>
</span><span id="line-2100"></span><span class="hs-comment">--   then we can unify</span><span>
</span><span id="line-2101"></span><span class="hs-comment">--       tv := ty |&gt; redn</span><span>
</span><span id="line-2102"></span><span class="hs-comment">--   with extra wanteds 'cts'</span><span>
</span><span id="line-2103"></span><span class="hs-comment">-- If it returns (PuFail reason) we can't unify, and the reason explains why.</span><span>
</span><span id="line-2104"></span><span id="checkTouchableTyVarEq"><span class="annot"><span class="annottext">checkTouchableTyVarEq :: CtEvidence -&gt; TcTyVar -&gt; Type -&gt; TcS (PuResult () Reduction)
</span><a href="GHC.Tc.Solver.Monad.html#checkTouchableTyVarEq"><span class="hs-identifier hs-var hs-var">checkTouchableTyVarEq</span></a></span></span><span> </span><span id="local-6989586621683039547"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039547"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039548"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span></span><span> </span><span id="local-6989586621683039549"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039549"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-2105"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnifyCheckCaller -&gt; TcTyVar -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.Unify.html#simpleUnifyCheck"><span class="hs-identifier hs-var">simpleUnifyCheck</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyCheckCaller
</span><a href="GHC.Tc.Utils.Unify.html#UC_Solver"><span class="hs-identifier hs-var">UC_Solver</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039549"><span class="hs-identifier hs-var">rhs</span></a></span><span>   </span><span class="hs-comment">-- An (optional) short-cut</span><span>
</span><span id="line-2106"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkTouchableTyVarEq: simple-check wins&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039549"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2107"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PuResult () Reduction -&gt; TcS (PuResult () Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reduction -&gt; PuResult () Reduction
forall a. a -&gt; PuResult () a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039549"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2108"></span><span>
</span><span id="line-2109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2110"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkTouchableTyVarEq {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039549"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2111"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039553"><span class="annot"><a href="#local-6989586621683039553"><span class="hs-identifier hs-var">check_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (PuResult Ct Reduction) -&gt; TcS (PuResult Ct Reduction)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM (PuResult Ct Reduction)
</span><a href="#local-6989586621683039554"><span class="hs-identifier hs-var">check_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039549"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2112"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkTouchableTyVarEq }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039548"><span class="hs-identifier hs-type">lhs_tv</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039553"><span class="hs-identifier hs-type">check_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2113"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039553"><span class="hs-identifier hs-type">check_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2114"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuFail"><span class="hs-identifier hs-type">PuFail</span></a></span><span> </span><span id="local-6989586621683039556"><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683039556"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PuResult () Reduction -&gt; TcS (PuResult () Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; PuResult () Reduction
forall a b. CheckTyEqResult -&gt; PuResult a b
</span><a href="GHC.Tc.Utils.Unify.html#PuFail"><span class="hs-identifier hs-var">PuFail</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683039556"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2115"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuOK"><span class="hs-identifier hs-type">PuOK</span></a></span><span> </span><span id="local-6989586621683039558"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039558"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621683039559"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683039559"><span class="hs-identifier hs-var">redn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039558"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-2116"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PuResult () Reduction -&gt; TcS (PuResult () Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reduction -&gt; PuResult () Reduction
forall a. a -&gt; PuResult () a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683039559"><span class="hs-identifier hs-var">redn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2117"></span><span>
</span><span id="line-2118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2119"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683039560"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683039560"><span class="hs-identifier hs-var">lhs_tv_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039561"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039561"><span class="hs-identifier hs-var">lhs_tv_lvl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2120"></span><span>       </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_info :: TcTyVarDetails -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039565"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683039565"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_tclvl :: TcTyVarDetails -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683039567"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039567"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683039565"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039567"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2121"></span><span>       </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; (MetaInfo, TcLevel)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkTouchableTyVarEq&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2122"></span><span>            </span><span class="hs-comment">-- lhs_tv should be a meta-tyvar</span><span>
</span><span id="line-2123"></span><span>
</span><span id="line-2124"></span><span>    </span><span id="local-6989586621683039568"><span class="annot"><span class="annottext">is_concrete_lhs_tv :: Bool
</span><a href="#local-6989586621683039568"><span class="hs-identifier hs-var hs-var">is_concrete_lhs_tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isConcreteInfo"><span class="hs-identifier hs-var">isConcreteInfo</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683039560"><span class="hs-identifier hs-var">lhs_tv_info</span></a></span><span>
</span><span id="line-2125"></span><span>
</span><span id="line-2126"></span><span>    </span><span id="local-6989586621683039554"><span class="annot"><span class="annottext">check_rhs :: Type -&gt; TcM (PuResult Ct Reduction)
</span><a href="#local-6989586621683039554"><span class="hs-identifier hs-var hs-var">check_rhs</span></a></span></span><span> </span><span id="local-6989586621683039570"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039570"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-2127"></span><span>       </span><span class="hs-comment">-- Crucial special case for  alpha ~ F tys</span><span>
</span><span id="line-2128"></span><span>       </span><span class="hs-comment">-- We don't want to flatten that (F tys)!</span><span>
</span><span id="line-2129"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621683039572"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039572"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683039573"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039573"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#canTyFamEqLHS_maybe"><span class="hs-identifier hs-var">canTyFamEqLHS_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039570"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2130"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683039568"><span class="hs-identifier hs-var">is_concrete_lhs_tv</span></a></span><span>
</span><span id="line-2131"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; TcM (PuResult Ct Reduction)
forall a b. CheckTyEqResult -&gt; TcM (PuResult a b)
</span><a href="GHC.Tc.Utils.Unify.html#failCheckWith"><span class="hs-identifier hs-var">failCheckWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckTyEqProblem -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Types.Constraint.html#cteProblem"><span class="hs-identifier hs-var">cteProblem</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteConcrete"><span class="hs-identifier hs-var">cteConcrete</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2132"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TyEqFlags Ct -&gt; TyCon -&gt; [Type] -&gt; TcM (PuResult Ct Reduction)
forall a.
TyEqFlags a -&gt; TyCon -&gt; [Type] -&gt; TcM (PuResult a Reduction)
</span><a href="GHC.Tc.Utils.Unify.html#recurseIntoTyConApp"><span class="hs-identifier hs-var">recurseIntoTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyEqFlags Ct
</span><a href="#local-6989586621683039579"><span class="hs-identifier hs-var">arg_flags</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039572"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039573"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2133"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2134"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEqFlags Ct -&gt; Type -&gt; TcM (PuResult Ct Reduction)
forall a. TyEqFlags a -&gt; Type -&gt; TcM (PuResult a Reduction)
</span><a href="GHC.Tc.Utils.Unify.html#checkTyEqRhs"><span class="hs-identifier hs-var">checkTyEqRhs</span></a></span><span> </span><span class="annot"><span class="annottext">TyEqFlags Ct
</span><a href="#local-6989586621683039581"><span class="hs-identifier hs-var">flags</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039570"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2135"></span><span>
</span><span id="line-2136"></span><span>    </span><span id="local-6989586621683039581"><span class="annot"><span class="annottext">flags :: TyEqFlags Ct
</span><a href="#local-6989586621683039581"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#TEF"><span class="hs-identifier hs-type">TEF</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tef_foralls :: Bool
</span><a href="GHC.Tc.Utils.Unify.html#tef_foralls"><span class="hs-identifier hs-var">tef_foralls</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- isRuntimeUnkSkol lhs_tv</span><span>
</span><span id="line-2137"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_fam_app :: TyEqFamApp Ct
</span><a href="GHC.Tc.Utils.Unify.html#tef_fam_app"><span class="hs-identifier hs-var">tef_fam_app</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; (Type -&gt; TcM (PuResult Ct Reduction)) -&gt; TyEqFamApp Ct
forall a. CtEvidence -&gt; EqRel -&gt; FamAppBreaker a -&gt; TyEqFamApp a
</span><a href="GHC.Tc.Solver.Monad.html#mkTEFA_Break"><span class="hs-identifier hs-var">mkTEFA_Break</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039547"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (PuResult Ct Reduction)
</span><a href="#local-6989586621683039586"><span class="hs-identifier hs-var">break_wanted</span></a></span><span>
</span><span id="line-2138"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_unifying :: AreUnifying
</span><a href="GHC.Tc.Utils.Unify.html#tef_unifying"><span class="hs-identifier hs-var">tef_unifying</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcLevel -&gt; LevelCheck -&gt; AreUnifying
</span><a href="GHC.Tc.Utils.Unify.html#Unifying"><span class="hs-identifier hs-var">Unifying</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683039560"><span class="hs-identifier hs-var">lhs_tv_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039561"><span class="hs-identifier hs-var">lhs_tv_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; LevelCheck
</span><a href="GHC.Tc.Utils.Unify.html#LC_Promote"><span class="hs-identifier hs-var">LC_Promote</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-2139"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_lhs :: CanEqLHS
</span><a href="GHC.Tc.Utils.Unify.html#tef_lhs"><span class="hs-identifier hs-var">tef_lhs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-var">TyVarLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span>
</span><span id="line-2140"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_occurs :: CheckTyEqProblem
</span><a href="GHC.Tc.Utils.Unify.html#tef_occurs"><span class="hs-identifier hs-var">tef_occurs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteInsolubleOccurs"><span class="hs-identifier hs-var">cteInsolubleOccurs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2141"></span><span>
</span><span id="line-2142"></span><span>    </span><span id="local-6989586621683039579"><span class="annot"><span class="annottext">arg_flags :: TyEqFlags Ct
</span><a href="#local-6989586621683039579"><span class="hs-identifier hs-var hs-var">arg_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEqFlags Ct -&gt; TyEqFlags Ct
forall a. TyEqFlags a -&gt; TyEqFlags a
</span><a href="GHC.Tc.Utils.Unify.html#famAppArgFlags"><span class="hs-identifier hs-var">famAppArgFlags</span></a></span><span> </span><span class="annot"><span class="annottext">TyEqFlags Ct
</span><a href="#local-6989586621683039581"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-2143"></span><span>
</span><span id="line-2144"></span><span>    </span><span class="annot"><a href="#local-6989586621683039586"><span class="hs-identifier hs-type">break_wanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#FamAppBreaker"><span class="hs-identifier hs-type">FamAppBreaker</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-2145"></span><span>    </span><span id="local-6989586621683039586"><span class="annot"><span class="annottext">break_wanted :: Type -&gt; TcM (PuResult Ct Reduction)
</span><a href="#local-6989586621683039586"><span class="hs-identifier hs-var hs-var">break_wanted</span></a></span></span><span> </span><span id="local-6989586621683039595"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039595"><span class="hs-identifier hs-var">fam_app</span></a></span></span><span>
</span><span id="line-2146"></span><span>      </span><span class="hs-comment">-- Occurs check or skolem escape; so flatten</span><span>
</span><span id="line-2147"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039596"><span class="annot"><span class="annottext">fam_app_kind :: Type
</span><a href="#local-6989586621683039596"><span class="hs-identifier hs-var hs-var hs-var">fam_app_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039595"><span class="hs-identifier hs-var">fam_app</span></a></span><span>
</span><span id="line-2148"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039598"><span class="annot"><a href="#local-6989586621683039598"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
-&gt; TcTyVar -&gt; TcLevel -&gt; VarSet -&gt; TcM CheckTyEqResult
</span><a href="GHC.Tc.Utils.Unify.html#checkPromoteFreeVars"><span class="hs-identifier hs-var">checkPromoteFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteInsolubleOccurs"><span class="hs-identifier hs-var">cteInsolubleOccurs</span></a></span><span>
</span><span id="line-2149"></span><span>                            </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039548"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039561"><span class="hs-identifier hs-var">lhs_tv_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039596"><span class="hs-identifier hs-var">fam_app_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2150"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#cterHasNoProblem"><span class="hs-identifier hs-type">cterHasNoProblem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039598"><span class="hs-identifier hs-type">reason</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Failed to promote free vars</span><span>
</span><span id="line-2151"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#failCheckWith"><span class="hs-identifier hs-type">failCheckWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039598"><span class="hs-identifier hs-type">reason</span></a></span><span>
</span><span id="line-2152"></span><span>             </span><span class="hs-keyword">else</span><span>
</span><span id="line-2153"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039601"><span class="annot"><a href="#local-6989586621683039601"><span class="hs-identifier hs-var">new_tv_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2154"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039560"><span class="hs-identifier hs-type">lhs_tv_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2155"></span><span>                </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTv"><span class="hs-identifier hs-type">ConcreteTv</span></a></span><span> </span><span id="local-6989586621683039603"><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683039603"><span class="hs-identifier hs-var">conc_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2156"></span><span>                  </span><span class="hs-comment">-- Make a concrete tyvar if lhs_tv is concrete</span><span>
</span><span id="line-2157"></span><span>                  </span><span class="hs-comment">-- e.g.  alpha[2,conc] ~ Maybe (F beta[4])</span><span>
</span><span id="line-2158"></span><span>                  </span><span class="hs-comment">--       We want to flatten to</span><span>
</span><span id="line-2159"></span><span>                  </span><span class="hs-comment">--       alpha[2,conc] ~ Maybe gamma[2,conc]</span><span>
</span><span id="line-2160"></span><span>                  </span><span class="hs-comment">--       gamma[2,conc] ~ F beta[4]</span><span>
</span><span id="line-2161"></span><span>                  </span><span class="annot"><span class="annottext">ConcreteTvOrigin -&gt; TcLevel -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarTyAtLevel"><span class="hs-identifier hs-var">TcM.newConcreteTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683039603"><span class="hs-identifier hs-var">conc_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039561"><span class="hs-identifier hs-var">lhs_tv_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039596"><span class="hs-identifier hs-var">fam_app_kind</span></a></span><span>
</span><span id="line-2162"></span><span>                </span><span class="annot"><span class="annottext">MetaInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-var">TcM.newMetaTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683039561"><span class="hs-identifier hs-var">lhs_tv_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039596"><span class="hs-identifier hs-var">fam_app_kind</span></a></span><span>
</span><span id="line-2163"></span><span>
</span><span id="line-2164"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039606"><span class="annot"><a href="#local-6989586621683039606"><span class="hs-identifier hs-var hs-var">pty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039595"><span class="hs-identifier hs-var">fam_app</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039601"><span class="hs-identifier hs-var">new_tv_ty</span></a></span><span>
</span><span id="line-2165"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039607"><span class="annot"><a href="#local-6989586621683039607"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newVanillaCoercionHole"><span class="hs-identifier hs-type">TcM.newVanillaCoercionHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039606"><span class="hs-identifier hs-type">pty</span></a></span><span>
</span><span id="line-2166"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683039609"><span class="annot"><a href="#local-6989586621683039609"><span class="hs-identifier hs-var hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039606"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-2167"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683039607"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-2168"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039610"><span class="hs-identifier hs-var">cb_loc</span></a></span><span>
</span><span id="line-2169"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRewriters"><span class="hs-identifier hs-var">ctEvRewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039547"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2170"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuOK"><span class="hs-identifier hs-type">PuOK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#singleCt"><span class="hs-identifier hs-type">singleCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-type">mkNonCanonical</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039609"><span class="hs-identifier hs-type">new_ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2171"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-type">mkReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039607"><span class="hs-identifier hs-type">hole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683039601"><span class="hs-identifier hs-type">new_tv_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2172"></span><span>
</span><span id="line-2173"></span><span>    </span><span class="hs-comment">-- See Detail (7) of the Note</span><span>
</span><span id="line-2174"></span><span>    </span><span id="local-6989586621683039610"><span class="annot"><span class="annottext">cb_loc :: CtLoc
</span><a href="#local-6989586621683039610"><span class="hs-identifier hs-var hs-var">cb_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (CtOrigin -&gt; CtOrigin) -&gt; CtLoc
</span><a href="GHC.Tc.Types.CtLoc.html#updateCtLocOrigin"><span class="hs-identifier hs-var">updateCtLocOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039547"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#CycleBreakerOrigin"><span class="hs-identifier hs-var">CycleBreakerOrigin</span></a></span><span>
</span><span id="line-2175"></span><span>
</span><span id="line-2176"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-2177"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkTypeEq"><span class="hs-identifier hs-type">checkTypeEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-2178"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuResult"><span class="hs-identifier hs-type">PuResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2179"></span><span class="hs-comment">-- Used for general CanEqLHSs, ones that do</span><span>
</span><span id="line-2180"></span><span class="hs-comment">-- not have a touchable type variable on the LHS (i.e. not unifying)</span><span>
</span><span id="line-2181"></span><span id="checkTypeEq"><span class="annot"><span class="annottext">checkTypeEq :: CtEvidence
-&gt; EqRel -&gt; CanEqLHS -&gt; Type -&gt; TcS (PuResult () Reduction)
</span><a href="GHC.Tc.Solver.Monad.html#checkTypeEq"><span class="hs-identifier hs-var hs-var">checkTypeEq</span></a></span></span><span> </span><span id="local-6989586621683039615"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039615"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039616"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683039616"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621683039617"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621683039617"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621683039618"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039618"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-2182"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039615"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2183"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkTypeEq {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lhs:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621683039617"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2184"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rhs:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039618"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2185"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683039619"><span class="annot"><a href="#local-6989586621683039619"><span class="hs-identifier hs-var">check_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (PuResult (TcTyVar, Type) Reduction)
-&gt; TcS (PuResult (TcTyVar, Type) Reduction)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM (PuResult (TcTyVar, Type) Reduction)
</span><a href="#local-6989586621683039620"><span class="hs-identifier hs-var">check_given_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039618"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2186"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkTypeEq }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039619"><span class="hs-identifier hs-type">check_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2187"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039619"><span class="hs-identifier hs-type">check_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2188"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuFail"><span class="hs-identifier hs-type">PuFail</span></a></span><span> </span><span id="local-6989586621683039621"><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683039621"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PuResult () Reduction -&gt; TcS (PuResult () Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; PuResult () Reduction
forall a b. CheckTyEqResult -&gt; PuResult a b
</span><a href="GHC.Tc.Utils.Unify.html#PuFail"><span class="hs-identifier hs-var">PuFail</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683039621"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2189"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuOK"><span class="hs-identifier hs-type">PuOK</span></a></span><span> </span><span id="local-6989586621683039622"><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621683039622"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span id="local-6989586621683039623"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683039623"><span class="hs-identifier hs-var">redn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039624"><span class="annot"><a href="#local-6989586621683039624"><span class="hs-identifier hs-var">new_givens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((TcTyVar, Type) -&gt; TcS Ct) -&gt; Bag (TcTyVar, Type) -&gt; TcS Cts
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Bag a -&gt; m (Bag b)
</span><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcTyVar, Type) -&gt; TcS Ct
</span><a href="#local-6989586621683039625"><span class="hs-identifier hs-var">mk_new_given</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621683039622"><span class="hs-identifier hs-var">prs</span></a></span><span>
</span><span id="line-2190"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-type">emitWork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039624"><span class="hs-identifier hs-type">new_givens</span></a></span><span>
</span><span id="line-2191"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSet"><span class="hs-identifier hs-type">updInertSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addCycleBreakerBindings"><span class="hs-identifier hs-type">addCycleBreakerBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039622"><span class="hs-identifier hs-type">prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2192"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621683039623"><span class="hs-identifier hs-type">redn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2193"></span><span>
</span><span id="line-2194"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- Wanted</span><span>
</span><span id="line-2195"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039627"><span class="annot"><a href="#local-6989586621683039627"><span class="hs-identifier hs-var">check_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (PuResult Ct Reduction) -&gt; TcS (PuResult Ct Reduction)
forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEqFlags Ct -&gt; Type -&gt; TcM (PuResult Ct Reduction)
forall a. TyEqFlags a -&gt; Type -&gt; TcM (PuResult a Reduction)
</span><a href="GHC.Tc.Utils.Unify.html#checkTyEqRhs"><span class="hs-identifier hs-var">checkTyEqRhs</span></a></span><span> </span><span class="annot"><span class="annottext">TyEqFlags Ct
</span><a href="#local-6989586621683039628"><span class="hs-identifier hs-var">wanted_flags</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039618"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2196"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683039627"><span class="hs-identifier hs-type">check_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2197"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuFail"><span class="hs-identifier hs-type">PuFail</span></a></span><span> </span><span id="local-6989586621683039629"><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683039629"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PuResult () Reduction -&gt; TcS (PuResult () Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; PuResult () Reduction
forall a b. CheckTyEqResult -&gt; PuResult a b
</span><a href="GHC.Tc.Utils.Unify.html#PuFail"><span class="hs-identifier hs-var">PuFail</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621683039629"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2198"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuOK"><span class="hs-identifier hs-type">PuOK</span></a></span><span> </span><span id="local-6989586621683039630"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039630"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621683039631"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683039631"><span class="hs-identifier hs-var">redn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Cts -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683039630"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-2199"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PuResult () Reduction -&gt; TcS (PuResult () Reduction)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reduction -&gt; PuResult () Reduction
forall a. a -&gt; PuResult () a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621683039631"><span class="hs-identifier hs-var">redn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2200"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2201"></span><span>    </span><span class="annot"><a href="#local-6989586621683039620"><span class="hs-identifier hs-type">check_given_rhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuResult"><span class="hs-identifier hs-type">PuResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2202"></span><span>    </span><span id="local-6989586621683039620"><span class="annot"><span class="annottext">check_given_rhs :: Type -&gt; TcM (PuResult (TcTyVar, Type) Reduction)
</span><a href="#local-6989586621683039620"><span class="hs-identifier hs-var hs-var">check_given_rhs</span></a></span></span><span> </span><span id="local-6989586621683039632"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039632"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-2203"></span><span>       </span><span class="hs-comment">-- See Note [Special case for top-level of Given equality]</span><span>
</span><span id="line-2204"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621683039633"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039633"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683039634"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039634"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#canTyFamEqLHS_maybe"><span class="hs-identifier hs-var">canTyFamEqLHS_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039632"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2205"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEqFlags (TcTyVar, Type)
-&gt; TyCon -&gt; [Type] -&gt; TcM (PuResult (TcTyVar, Type) Reduction)
forall a.
TyEqFlags a -&gt; TyCon -&gt; [Type] -&gt; TcM (PuResult a Reduction)
</span><a href="GHC.Tc.Utils.Unify.html#recurseIntoTyConApp"><span class="hs-identifier hs-var">recurseIntoTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyEqFlags (TcTyVar, Type)
</span><a href="#local-6989586621683039635"><span class="hs-identifier hs-var">arg_flags</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683039633"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683039634"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2206"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2207"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEqFlags (TcTyVar, Type)
-&gt; Type -&gt; TcM (PuResult (TcTyVar, Type) Reduction)
forall a. TyEqFlags a -&gt; Type -&gt; TcM (PuResult a Reduction)
</span><a href="GHC.Tc.Utils.Unify.html#checkTyEqRhs"><span class="hs-identifier hs-var">checkTyEqRhs</span></a></span><span> </span><span class="annot"><span class="annottext">TyEqFlags (TcTyVar, Type)
</span><a href="#local-6989586621683039636"><span class="hs-identifier hs-var">given_flags</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039632"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span>    </span><span id="local-6989586621683039635"><span class="annot"><span class="annottext">arg_flags :: TyEqFlags (TcTyVar, Type)
</span><a href="#local-6989586621683039635"><span class="hs-identifier hs-var hs-var">arg_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEqFlags (TcTyVar, Type) -&gt; TyEqFlags (TcTyVar, Type)
forall a. TyEqFlags a -&gt; TyEqFlags a
</span><a href="GHC.Tc.Utils.Unify.html#famAppArgFlags"><span class="hs-identifier hs-var">famAppArgFlags</span></a></span><span> </span><span class="annot"><span class="annottext">TyEqFlags (TcTyVar, Type)
</span><a href="#local-6989586621683039636"><span class="hs-identifier hs-var">given_flags</span></a></span><span>
</span><span id="line-2210"></span><span>
</span><span id="line-2211"></span><span>    </span><span class="annot"><a href="#local-6989586621683039636"><span class="hs-identifier hs-type">given_flags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#TyEqFlags"><span class="hs-identifier hs-type">TyEqFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2212"></span><span>    </span><span id="local-6989586621683039636"><span class="annot"><span class="annottext">given_flags :: TyEqFlags (TcTyVar, Type)
</span><a href="#local-6989586621683039636"><span class="hs-identifier hs-var hs-var">given_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#TEF"><span class="hs-identifier hs-type">TEF</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tef_lhs :: CanEqLHS
</span><a href="GHC.Tc.Utils.Unify.html#tef_lhs"><span class="hs-identifier hs-var">tef_lhs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621683039617"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2213"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_foralls :: Bool
</span><a href="GHC.Tc.Utils.Unify.html#tef_foralls"><span class="hs-identifier hs-var">tef_foralls</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2214"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_unifying :: AreUnifying
</span><a href="GHC.Tc.Utils.Unify.html#tef_unifying"><span class="hs-identifier hs-var">tef_unifying</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AreUnifying
</span><a href="GHC.Tc.Utils.Unify.html#NotUnifying"><span class="hs-identifier hs-var">NotUnifying</span></a></span><span>
</span><span id="line-2215"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_fam_app :: TyEqFamApp (TcTyVar, Type)
</span><a href="GHC.Tc.Utils.Unify.html#tef_fam_app"><span class="hs-identifier hs-var">tef_fam_app</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; (Type -&gt; TcM (PuResult (TcTyVar, Type) Reduction))
-&gt; TyEqFamApp (TcTyVar, Type)
forall a. CtEvidence -&gt; EqRel -&gt; FamAppBreaker a -&gt; TyEqFamApp a
</span><a href="GHC.Tc.Solver.Monad.html#mkTEFA_Break"><span class="hs-identifier hs-var">mkTEFA_Break</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039615"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683039616"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (PuResult (TcTyVar, Type) Reduction)
</span><a href="#local-6989586621683039638"><span class="hs-identifier hs-var">break_given</span></a></span><span>
</span><span id="line-2216"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_occurs :: CheckTyEqProblem
</span><a href="GHC.Tc.Utils.Unify.html#tef_occurs"><span class="hs-identifier hs-var">tef_occurs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="#local-6989586621683039639"><span class="hs-identifier hs-var">occ_prob</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2217"></span><span>        </span><span class="hs-comment">-- TEFA_Break used for: [G] a ~ Maybe (F a)</span><span>
</span><span id="line-2218"></span><span>        </span><span class="hs-comment">--                   or [W] F a ~ Maybe (F a)</span><span>
</span><span id="line-2219"></span><span>
</span><span id="line-2220"></span><span>    </span><span id="local-6989586621683039628"><span class="annot"><span class="annottext">wanted_flags :: TyEqFlags Ct
</span><a href="#local-6989586621683039628"><span class="hs-identifier hs-var hs-var">wanted_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#TEF"><span class="hs-identifier hs-type">TEF</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tef_lhs :: CanEqLHS
</span><a href="GHC.Tc.Utils.Unify.html#tef_lhs"><span class="hs-identifier hs-var">tef_lhs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621683039617"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2221"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_foralls :: Bool
</span><a href="GHC.Tc.Utils.Unify.html#tef_foralls"><span class="hs-identifier hs-var">tef_foralls</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2222"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_unifying :: AreUnifying
</span><a href="GHC.Tc.Utils.Unify.html#tef_unifying"><span class="hs-identifier hs-var">tef_unifying</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AreUnifying
</span><a href="GHC.Tc.Utils.Unify.html#NotUnifying"><span class="hs-identifier hs-var">NotUnifying</span></a></span><span>
</span><span id="line-2223"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_fam_app :: TyEqFamApp Ct
</span><a href="GHC.Tc.Utils.Unify.html#tef_fam_app"><span class="hs-identifier hs-var">tef_fam_app</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEqFamApp Ct
forall a. TyEqFamApp a
</span><a href="GHC.Tc.Utils.Unify.html#TEFA_Recurse"><span class="hs-identifier hs-var">TEFA_Recurse</span></a></span><span>
</span><span id="line-2224"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tef_occurs :: CheckTyEqProblem
</span><a href="GHC.Tc.Utils.Unify.html#tef_occurs"><span class="hs-identifier hs-var">tef_occurs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="#local-6989586621683039639"><span class="hs-identifier hs-var">occ_prob</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2225"></span><span>        </span><span class="hs-comment">-- TEFA_Recurse: see Note [Don't cycle-break Wanteds when not unifying]</span><span>
</span><span id="line-2226"></span><span>
</span><span id="line-2227"></span><span>    </span><span class="hs-comment">-- occ_prob: see Note [Occurs check and representational equality]</span><span>
</span><span id="line-2228"></span><span>    </span><span id="local-6989586621683039639"><span class="annot"><span class="annottext">occ_prob :: CheckTyEqProblem
</span><a href="#local-6989586621683039639"><span class="hs-identifier hs-var hs-var">occ_prob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683039616"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2229"></span><span>                 </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteInsolubleOccurs"><span class="hs-identifier hs-var">cteInsolubleOccurs</span></a></span><span>
</span><span id="line-2230"></span><span>                 </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteSolubleOccurs"><span class="hs-identifier hs-var">cteSolubleOccurs</span></a></span><span>
</span><span id="line-2231"></span><span>
</span><span id="line-2232"></span><span>    </span><span class="annot"><a href="#local-6989586621683039638"><span class="hs-identifier hs-type">break_given</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuResult"><span class="hs-identifier hs-type">PuResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2233"></span><span>    </span><span id="local-6989586621683039638"><span class="annot"><span class="annottext">break_given :: Type -&gt; TcM (PuResult (TcTyVar, Type) Reduction)
</span><a href="#local-6989586621683039638"><span class="hs-identifier hs-var hs-var">break_given</span></a></span></span><span> </span><span id="local-6989586621683039643"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039643"><span class="hs-identifier hs-var">fam_app</span></a></span></span><span>
</span><span id="line-2234"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683039644"><span class="annot"><a href="#local-6989586621683039644"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newCycleBreakerTyVar"><span class="hs-identifier hs-var">TcM.newCycleBreakerTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039643"><span class="hs-identifier hs-var">fam_app</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2235"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#PuOK"><span class="hs-identifier hs-type">PuOK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-type">unitBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683039644"><span class="hs-identifier hs-type">new_tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683039643"><span class="hs-identifier hs-type">fam_app</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2236"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-type">mkReflRedn</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-type">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683039644"><span class="hs-identifier hs-type">new_tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2237"></span><span>                    </span><span class="hs-comment">-- Why reflexive? See Detail (4) of the Note</span><span>
</span><span id="line-2238"></span><span>
</span><span id="line-2239"></span><span>    </span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-2240"></span><span>    </span><span class="annot"><a href="#local-6989586621683039625"><span class="hs-identifier hs-type">mk_new_given</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-2241"></span><span>    </span><span id="local-6989586621683039625"><span class="annot"><span class="annottext">mk_new_given :: (TcTyVar, Type) -&gt; TcS Ct
</span><a href="#local-6989586621683039625"><span class="hs-identifier hs-var hs-var">mk_new_given</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683039648"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039648"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683039649"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039649"><span class="hs-identifier hs-var">fam_app</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2242"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcS CtEvidence -&gt; TcS Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683039650"><span class="hs-identifier hs-var">cb_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039651"><span class="hs-identifier hs-var">given_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683039652"><span class="hs-identifier hs-var">given_term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2243"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2244"></span><span>        </span><span id="local-6989586621683039653"><span class="annot"><span class="annottext">new_ty :: Type
</span><a href="#local-6989586621683039653"><span class="hs-identifier hs-var hs-var">new_ty</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683039648"><span class="hs-identifier hs-var">new_tv</span></a></span><span>
</span><span id="line-2245"></span><span>        </span><span id="local-6989586621683039651"><span class="annot"><span class="annottext">given_pred :: Type
</span><a href="#local-6989586621683039651"><span class="hs-identifier hs-var hs-var">given_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039649"><span class="hs-identifier hs-var">fam_app</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039653"><span class="hs-identifier hs-var">new_ty</span></a></span><span>
</span><span id="line-2246"></span><span>        </span><span id="local-6989586621683039652"><span class="annot"><span class="annottext">given_term :: EvTerm
</span><a href="#local-6989586621683039652"><span class="hs-identifier hs-var hs-var">given_term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; EvTerm) -&gt; Coercion -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683039653"><span class="hs-identifier hs-var">new_ty</span></a></span><span>  </span><span class="hs-comment">-- See Detail (4) of Note</span><span>
</span><span id="line-2247"></span><span>
</span><span id="line-2248"></span><span>    </span><span class="hs-comment">-- See Detail (7) of the Note</span><span>
</span><span id="line-2249"></span><span>    </span><span id="local-6989586621683039650"><span class="annot"><span class="annottext">cb_loc :: CtLoc
</span><a href="#local-6989586621683039650"><span class="hs-identifier hs-var hs-var">cb_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (CtOrigin -&gt; CtOrigin) -&gt; CtLoc
</span><a href="GHC.Tc.Types.CtLoc.html#updateCtLocOrigin"><span class="hs-identifier hs-var">updateCtLocOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039615"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#CycleBreakerOrigin"><span class="hs-identifier hs-var">CycleBreakerOrigin</span></a></span><span>
</span><span id="line-2250"></span><span>
</span><span id="line-2251"></span><span id="local-6989586621683037641"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#mkTEFA_Break"><span class="hs-identifier hs-type">mkTEFA_Break</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#FamAppBreaker"><span class="hs-identifier hs-type">FamAppBreaker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037641"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#TyEqFamApp"><span class="hs-identifier hs-type">TyEqFamApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037641"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2252"></span><span id="mkTEFA_Break"><span class="annot"><span class="annottext">mkTEFA_Break :: forall a. CtEvidence -&gt; EqRel -&gt; FamAppBreaker a -&gt; TyEqFamApp a
</span><a href="GHC.Tc.Solver.Monad.html#mkTEFA_Break"><span class="hs-identifier hs-var hs-var">mkTEFA_Break</span></a></span></span><span> </span><span id="local-6989586621683039656"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039656"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621683039657"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683039657"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621683039658"><span class="annot"><span class="annottext">FamAppBreaker a
</span><a href="#local-6989586621683039658"><span class="hs-identifier hs-var">breaker</span></a></span></span><span>
</span><span id="line-2253"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621683039657"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-2254"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683039659"><span class="hs-identifier hs-var">cycle_breaker_origin</span></a></span><span>
</span><span id="line-2255"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamAppBreaker a -&gt; TyEqFamApp a
forall a. FamAppBreaker a -&gt; TyEqFamApp a
</span><a href="GHC.Tc.Utils.Unify.html#TEFA_Break"><span class="hs-identifier hs-var">TEFA_Break</span></a></span><span> </span><span class="annot"><span class="annottext">FamAppBreaker a
</span><a href="#local-6989586621683039658"><span class="hs-identifier hs-var">breaker</span></a></span><span>
</span><span id="line-2256"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2257"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEqFamApp a
forall a. TyEqFamApp a
</span><a href="GHC.Tc.Utils.Unify.html#TEFA_Recurse"><span class="hs-identifier hs-var">TEFA_Recurse</span></a></span><span>
</span><span id="line-2258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2259"></span><span>    </span><span class="hs-comment">-- cycle_breaker_origin: see Detail (7) of Note [Type equality cycles]</span><span>
</span><span id="line-2260"></span><span>    </span><span class="hs-comment">-- in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-2261"></span><span>    </span><span id="local-6989586621683039659"><span class="annot"><span class="annottext">cycle_breaker_origin :: Bool
</span><a href="#local-6989586621683039659"><span class="hs-identifier hs-var hs-var">cycle_breaker_origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.CtLoc.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683039656"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2262"></span><span>                              </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CycleBreakerOrigin"><span class="hs-identifier hs-type">CycleBreakerOrigin</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2263"></span><span>                              </span><span class="annot"><span class="annottext">CtOrigin
</span><span class="hs-identifier">_</span></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2264"></span><span>
</span><span id="line-2265"></span><span class="hs-comment">-------------------------</span><span>
</span><span id="line-2266"></span><span class="hs-comment">-- | Fill in CycleBreakerTvs with the variables they stand for.</span><span>
</span><span id="line-2267"></span><span class="hs-comment">-- See Note [Type equality cycles] in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-2268"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-type">restoreTyVarCycles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2269"></span><span id="restoreTyVarCycles"><span class="annot"><span class="annottext">restoreTyVarCycles :: InertSet -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-var hs-var">restoreTyVarCycles</span></a></span></span><span> </span><span id="local-6989586621683039662"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683039662"><span class="hs-identifier hs-var">is</span></a></span></span><span>
</span><span id="line-2270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcM ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">TcM.liftZonkM</span></a></span><span>
</span><span id="line-2271"></span><span>  </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcM ()) -&gt; ZonkM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CycleBreakerVarStack -&gt; (TcTyVar -&gt; Type -&gt; ZonkM ()) -&gt; ZonkM ()
forall (m :: * -&gt; *).
Monad m =&gt;
CycleBreakerVarStack -&gt; (TcTyVar -&gt; Type -&gt; m ()) -&gt; m ()
</span><a href="GHC.Tc.Solver.InertSet.html#forAllCycleBreakerBindings_"><span class="hs-identifier hs-var">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621683039662"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcTyVar -&gt; Type -&gt; ZonkM ()
TcTyVar -&gt; Type -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">TcM.writeMetaTyVar</span></a></span><span>
</span><span id="line-2272"></span><span class="hs-pragma">{-# SPECIALISE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#forAllCycleBreakerBindings_"><span class="hs-pragma hs-type">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-pragma">::</span><span>
</span><span id="line-2273"></span><span>      </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#CycleBreakerVarStack"><span class="hs-pragma hs-type">CycleBreakerVarStack</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-pragma hs-type">TcTyVar</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-pragma hs-type">TcType</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-pragma hs-type">ZonkM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-pragma hs-type">ZonkM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2274"></span><span>
</span><span id="line-2275"></span><span>
</span><span id="line-2276"></span><span class="hs-comment">{- Note [Occurs check and representational equality]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(a ~R# b a) is soluble if b later turns out to be Identity
So we treat this as a &quot;soluble occurs check&quot;.

Note [Special case for top-level of Given equality]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We take care when examining
    [G] F ty ~ G (...(F ty)...)
where both sides are TyFamLHSs.  We don't want to flatten that RHS to
    [G] F ty ~ cbv
    [G] G (...(F ty)...) ~ cbv
Instead we'd like to say &quot;occurs-check&quot; and swap LHS and RHS, which yields a
canonical constraint
    [G] G (...(F ty)...) ~ F ty
That tents to rewrite a big type to smaller one. This happens in T15703,
where we had:
    [G] Pure g ~ From1 (To1 (Pure g))
Making a loop breaker and rewriting left to right just makes much bigger
types than swapping it over.

(We might hope to have swapped it over before getting to checkTypeEq,
but better safe than sorry.)

NB: We never see a TyVarLHS here, such as
    [G] a ~ F tys here
because we'd have swapped it to
   [G] F tys ~ a
in canEqCanLHS2, before getting to checkTypeEq.

Note [Don't cycle-break Wanteds when not unifying]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consdier
  [W] a[2] ~ Maybe (F a[2])

Should we cycle-break this Wanted, thus?

  [W] a[2] ~ Maybe delta[2]
  [W] delta[2] ~ F a[2]

For a start, this is dodgy because we might just unify delta, thus undoing
what we have done, and getting an infinite loop in the solver.  Even if we
somehow prevented ourselves from doing so, is there any merit in the split?
Maybe: perhaps we can use that equality on `a` to unlock other constraints?
Consider
  type instance F (Maybe _) = Bool

  [G] g1: a ~ Maybe Bool
  [W] w1: a ~ Maybe (F a)

If we loop-break w1 to get
  [W] w1': a ~ Maybe gamma
  [W] w3:  gamma ~ F a
Now rewrite w3 with w1'
  [W] w3':  gamma ~ F (Maybe gamma)
Now use the type instance to get
  gamma := Bool
Now we are left with
  [W] w1': a ~ Maybe Bool
which we can solve from the Given.

BUT in this situation we could have rewritten the
/original/ Wanted from the Given, like this:
  [W] w1': Maybe Bool ~ Maybe (F (Maybe Bool))
and that is readily soluble.

In short: loop-breaking Wanteds, when we aren't unifying,
seems of no merit.  Hence TEFA_Recurse, rather than TEFA_Break,
in `wanted_flags` in `checkTypeEq`.
-}</span><span>
</span><span id="line-2346"></span></pre></body></html>