<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds     #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE CPP                 #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf          #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns        #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-record-updates #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

Renaming of expressions

Basically dependency analysis.

Handles @Match@, @GRHSs@, @HsExpr@, and @Qualifier@ datatypes.  In
general, all of these functions return a renamed thing, and a set of
free variables.
-}</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html"><span class="hs-identifier">GHC.Rename.Expr</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier">rnLExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier">rnExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmts"><span class="hs-identifier">rnStmts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier">AnnoBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#UnexpectedStatement"><span class="hs-identifier">UnexpectedStatement</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html"><span class="hs-identifier">GHC.Rename.Bind</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rnLocalBindsAndThen"><span class="hs-identifier">rnLocalBindsAndThen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rnLocalValBindsLHS"><span class="hs-identifier">rnLocalValBindsLHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rnLocalValBindsRHS"><span class="hs-identifier">rnLocalValBindsRHS</span></a></span><span>
</span><span id="line-36"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rnMatchGroup"><span class="hs-identifier">rnMatchGroup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rnGRHS"><span class="hs-identifier">rnGRHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#makeMiniFixityEnv"><span class="hs-identifier">makeMiniFixityEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#isBrackStage"><span class="hs-identifier">isBrackStage</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier">getModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier">isInteractiveModule</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html"><span class="hs-identifier">GHC.Rename.Fixity</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#bindLocalNamesFV"><span class="hs-identifier">bindLocalNamesFV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#checkDupNames"><span class="hs-identifier">checkDupNames</span></a></span><span>
</span><span id="line-45"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#bindLocalNames"><span class="hs-identifier">bindLocalNames</span></a></span><span>
</span><span id="line-46"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#mapMaybeFvRn"><span class="hs-identifier">mapMaybeFvRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#mapFvRn"><span class="hs-identifier">mapFvRn</span></a></span><span>
</span><span id="line-47"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#warnUnusedLocalBinds"><span class="hs-identifier">warnUnusedLocalBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#typeAppErr"><span class="hs-identifier">typeAppErr</span></a></span><span>
</span><span id="line-48"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#checkUnusedRecordWildcard"><span class="hs-identifier">checkUnusedRecordWildcard</span></a></span><span>
</span><span id="line-49"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier">wrapGenSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genHsIntegralLit"><span class="hs-identifier">genHsIntegralLit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genHsTyLit"><span class="hs-identifier">genHsTyLit</span></a></span><span>
</span><span id="line-50"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genHsVar"><span class="hs-identifier">genHsVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genLHsVar"><span class="hs-identifier">genLHsVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genHsApp"><span class="hs-identifier">genHsApp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genHsApps"><span class="hs-identifier">genHsApps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genHsApps%27"><span class="hs-identifier">genHsApps'</span></a></span><span>
</span><span id="line-51"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#genAppType"><span class="hs-identifier">genAppType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html"><span class="hs-identifier">GHC.Rename.Unbound</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html#reportUnboundName"><span class="hs-identifier">reportUnboundName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html"><span class="hs-identifier">GHC.Rename.Splice</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnTypedBracket"><span class="hs-identifier">rnTypedBracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnUntypedBracket"><span class="hs-identifier">rnUntypedBracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnTypedSplice"><span class="hs-identifier">rnTypedSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnUntypedSpliceExpr"><span class="hs-identifier">rnUntypedSpliceExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#checkThLocalName"><span class="hs-identifier">checkThLocalName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html"><span class="hs-identifier">GHC.Rename.HsType</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Pat.html"><span class="hs-identifier">GHC.Rename.Pat</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#nilDataConName"><span class="hs-identifier">nilDataConName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier">TypeOrKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier">TypeLevel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html"><span class="hs-identifier">GHC.Types.FieldLabel</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.html"><span class="hs-identifier">GHC.Types.Fixity</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#removeDupsOn"><span class="hs-identifier">removeDupsOn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier">FieldLabelString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">minimumBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier">nonEmpty</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.html"><span class="hs-identifier">Data.Array</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier">HscEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">{- Note [Handling overloaded and rebindable constructs]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Nomenclature
-------------
* Expansion (`HsExpr GhcRn -&gt; HsExpr GhcRn`): expand between renaming and
  typechecking, using the `XXExprGhcRn` constructor of `HsExpr`.
* Desugaring (`HsExpr GhcTc -&gt; Core.Expr`): convert the typechecked `HsSyn` to Core.  This is done in GHC.HsToCore


For overloaded constructs (overloaded literals, lists, strings), and
rebindable constructs (e.g. if-then-else), our general plan is this,
using overloaded labels #foo as an example:

* In the RENAMER: transform
      HsOverLabel &quot;foo&quot;
      ==&gt; XExpr (ExpandedThingRn (HsOverLabel #foo)
                                 (fromLabel `HsAppType` &quot;foo&quot;))
  We write this more compactly in concrete-syntax form like this
      #foo  ==&gt;  fromLabel @&quot;foo&quot;

  Recall that in (ExpandedThingRn orig expanded), 'orig' is the original term
  the user wrote, and 'expanded' is the expanded or desugared version
  to be typechecked.

* In the TYPECHECKER: typecheck the expansion, in this case
      fromLabel @&quot;foo&quot;
  The typechecker (and desugarer) will never see HsOverLabel

In effect, the renamer does a bit of desugaring. Recall GHC.Hs.Expr
Note [Rebindable syntax and XXExprGhcRn], which describes the use of XXExprGhcRn.

RebindableSyntax:
  If RebindableSyntax is off we use the built-in 'fromLabel', defined in
     GHC.Builtin.Names.fromLabelClassOpName
  If RebindableSyntax if ON, we look up &quot;fromLabel&quot; in the environment
     to get whichever one is in scope.
This is accomplished by lookupSyntaxName, and it applies to all the
constructs below.

See also Note [Handling overloaded and rebindable patterns] in GHC.Rename.Pat
for the story with patterns.

Here are the expressions that we transform in this way. Some are uniform,
but several have a little bit of special treatment:

* HsIf (if-the-else)
     if b then e1 else e2  ==&gt;  ifThenElse b e1 e2
  We do this /only/ if rebindable syntax is on, because the coverage
  checker looks for HsIf (see GHC.HsToCore.Ticks.addTickHsExpr)
  That means the typechecker and desugarer need to understand HsIf
  for the non-rebindable-syntax case.

* OverLabel (overloaded labels, #lbl)
     #lbl  ==&gt;  fromLabel @&quot;lbl&quot;
  As ever, we use lookupSyntaxName to look up 'fromLabel'
  See Note [Overloaded labels] below

* ExplicitList (explicit lists [a,b,c])
  When (and only when) OverloadedLists is on
     [e1,e2]  ==&gt;  fromListN 2 [e1,e2]
  NB: the type checker and desugarer still see ExplicitList,
      but to them it always means the built-in lists.

* SectionL and SectionR (left and right sections)
     (`op` e) ==&gt; rightSection op e
     (e `op`) ==&gt; leftSection  (op e)
  where `leftSection` and `rightSection` are representation-polymorphic
  wired-in Ids. See Note [Left and right sections]

* To understand why expansions for `OpApp` is done in `GHC.Tc.Gen.Head.splitHsApps`
  see Note [Doing XXExprGhcRn in the Renamer vs Typechecker] below.

* RecordUpd: we desugar record updates into case expressions,
  in GHC.Tc.Gen.Expr.tcExpr.

  Example:

    data T p q = T1 { x :: Int, y :: Bool, z :: Char }
               | T2 { v :: Char }
               | T3 { x :: Int }
               | T4 { p :: Float, y :: Bool, x :: Int }
               | T5

    e { x=e1, y=e2 }
      ===&gt;
    let { x' = e1; y' = e2 } in
    case e of
       T1 _ _ z -&gt; T1 x' y' z
       T4 p _ _ -&gt; T4 p y' x'

  See Note [Record Updates] in GHC.Tc.Gen.Expr for more details.

  To understand Why is this done in the typechecker, and not in the renamer
  see Note [Doing XXExprGhcRn in the Renamer vs Typechecker]

* HsDo: We expand `HsDo` statements in `Ghc.Tc.Gen.Do`.

    - For example, a user written code:

                  do { x &lt;- e1 ; g x ; return (f x) }

      is expanded to:

                   (&gt;&gt;=) e1
                         (\x -&gt; ((&gt;&gt;) (g x)
                                      (return (f x))))

     See Note [Expanding HsDo with XXExprGhcRn] in `Ghc.Tc.Gen.Do` for more details.
     To understand why is this done in the typechecker and not in the renamer.
     See Note [Doing XXExprGhcRn in the Renamer vs Typechecker]

Note [Overloaded labels]
~~~~~~~~~~~~~~~~~~~~~~~~
For overloaded labels, note that we /only/ apply `fromLabel` to the
Symbol argument, so the resulting expression has type
    fromLabel @&quot;foo&quot; :: forall a. IsLabel &quot;foo&quot; a =&gt; a
Now ordinary Visible Type Application can be used to instantiate the 'a':
the user may have written (#foo @Int).

Notice that this all works fine in a kind-polymorphic setting (#19154).
Suppose we have
    fromLabel :: forall {k1} {k2} (a:k1). blah

Then we want to instantiate those inferred quantifiers k1,k2, before
type-applying to &quot;foo&quot;, so we get
    fromLabel @Symbol @blah @&quot;foo&quot; ...

And those inferred kind quantifiers will indeed be instantiated when we
typecheck the renamed-syntax call (fromLabel @&quot;foo&quot;).

Note [Doing XXExprGhcRn in the Renamer vs Typechecker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We expand some `HsExpr GhcRn` code at various places, usually, on the fly,
depending on when it is more convenient. It may be beneficial to have a
separate `HsExpr GhcRn -&gt; HsExpr GhcRn` pass that does this expansion uniformly
in the future when we have enough cases to cater for. For the time being,
this note documents which language feature is expanded at which phase,
and the reasons for doing so.

  ** `HsIf` Expansions
  --------------------
  `HsIf` expansions are expanded in the Renamer becuase it is more convinent
  to do so there and then not worry about it in the later stage.
  `-XRebindableSyntax` is used to decide whether we use the `HsIf` or user defined if


  ** `OpApp` Expansions
  ---------------------
  The typechecker turns `OpApp` into a use of `XXExprGhcRn`
  on the fly, in `GHC.Tc.Gen.Head.splitHsApps`.
  The language extension `RebindableSyntax` does not affect this behaviour.

  It's a bit painful to transform `OpApp e1 op e2` to a `XXExprGhcRn`
  form, because the renamer does precedence rearrangement after name
  resolution. So the renamer leaves an `OpApp` as an `OpApp`.

  ** Record Update Syntax `RecordUpd` Expansions
  ----------------------------------------------
  This is done in the typechecker on the fly (`GHC.Tc.Expr.tcExpr`), and not the renamer, for two reasons:

    - (Until we implement GHC proposal #366)
      We need to know the type of the record to disambiguate its fields.

    - We use the type signature of the data constructor to provide `IdSigs`
      to the let-bound variables (x', y' in the example of
      Note [Handling overloaded and rebindable constructs] above).
      This is needed to accept programs such as

          data R b = MkR { f :: (forall a. a -&gt; a) -&gt; (Int,b), c :: Int }
          foo r = r { f = \ k -&gt; (k 3, k 'x') }

      in which an updated field has a higher-rank type.
      See Wrinkle [Using IdSig] in Note [Record Updates] in GHC.Tc.Gen.Expr.

  ** `HsDo` Statement Expansions
  -----------------------------------
  The expansion for do block statements is done on the fly right before typechecking in `GHC.Tc.Gen.Expr`
  using `GHC.Tc.Gen.Do.expandDoStmts`. There are 2 main reasons:

  -  During the renaming phase, we may not have all the constructor details `HsConDetails` populated in the
     data structure. This would result in an inaccurate irrefutability analysis causing
     the continuation lambda body to be wrapped with `fail` alternatives when not needed.
     See Part 1. of Note [Expanding HsDo with XXExprGhcRn] (test pattern-fails.hs)

  -  If the expansion is done on the fly during renaming, expressions that
     have explicit type applications using (-XTypeApplciations) will not work (cf. Let statements expansion)
     as the name freshening happens from the root of the AST to the leaves,
     but the expansion happens in the opposite direction (from leaves to the root),
     causing the renamer to miss the scoped type variables.
-}</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{Expressions}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExprs"><span class="hs-identifier hs-type">rnExprs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span id="rnExprs"><span class="annot"><span class="annottext">rnExprs :: [LHsExpr GhcPs] -&gt; RnM ([XRec GhcRn (HsExpr GhcRn)], FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExprs"><span class="hs-identifier hs-var hs-var">rnExprs</span></a></span></span><span> </span><span id="local-6989586621683067142"><span class="annot"><span class="annottext">[LHsExpr GhcPs]
</span><a href="#local-6989586621683067142"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcPs)]
-&gt; FreeVars
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated SrcSpanAnnA (HsExpr GhcRn)], FreeVars)
</span><a href="#local-6989586621683067143"><span class="hs-identifier hs-var">rnExprs'</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcPs]
[GenLocated SrcSpanAnnA (HsExpr GhcPs)]
</span><a href="#local-6989586621683067142"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span>
</span><span id="line-292"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621683067143"><span class="annot"><span class="annottext">rnExprs' :: [GenLocated SrcSpanAnnA (HsExpr GhcPs)]
-&gt; FreeVars
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated SrcSpanAnnA (HsExpr GhcRn)], FreeVars)
</span><a href="#local-6989586621683067143"><span class="hs-identifier hs-var hs-var">rnExprs'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683067149"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067149"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (HsExpr GhcRn)], FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated SrcSpanAnnA (HsExpr GhcRn)], FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067149"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><a href="#local-6989586621683067143"><span class="hs-identifier hs-var">rnExprs'</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067150"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683067150"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683067151"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcPs)]
</span><a href="#local-6989586621683067151"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683067152"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067152"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-295"></span><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067153"><span class="annot"><a href="#local-6989586621683067153"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067154"><span class="annot"><a href="#local-6989586621683067154"><span class="hs-identifier hs-var">fvExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683067150"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-comment">-- Now we do a &quot;seq&quot; on the free vars because typically it's small</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-comment">-- or empty, especially in very long lists of constants</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621683067155"><span class="annot"><a href="#local-6989586621683067155"><span class="hs-identifier hs-var hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067152"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067154"><span class="hs-identifier hs-var">fvExpr</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067157"><span class="annot"><a href="#local-6989586621683067157"><span class="hs-identifier hs-var">exprs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067158"><span class="annot"><a href="#local-6989586621683067158"><span class="hs-identifier hs-var">fvExprs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683067155"><span class="hs-identifier hs-type">acc'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><a href="#local-6989586621683067143"><span class="hs-identifier hs-type">rnExprs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067151"><span class="hs-identifier hs-type">exprs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067155"><span class="hs-identifier hs-type">acc'</span></a></span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067153"><span class="hs-identifier hs-type">expr'</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683067157"><span class="hs-identifier hs-type">exprs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067158"><span class="hs-identifier hs-type">fvExprs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- Variables. We look up the variable and return the resulting name.</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span id="rnLExpr"><span class="annot"><span class="annottext">rnLExpr :: LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var hs-var">rnLExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
forall a b c ann.
(a -&gt; TcM (b, c))
-&gt; GenLocated (EpAnn ann) a -&gt; TcM (GenLocated (EpAnn ann) b, c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocFstMA"><span class="hs-identifier hs-var">wrapLocFstMA</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-type">rnExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="GHC.Rename.Expr.html#finishHsVar"><span class="hs-identifier hs-type">finishHsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- Separated from rnExpr because it's also used</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- when renaming infix expressions</span><span>
</span><span id="line-312"></span><span id="finishHsVar"><span class="annot"><span class="annottext">finishHsVar :: LocatedA Name -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#finishHsVar"><span class="hs-identifier hs-var hs-var">finishHsVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067162"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067162"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683067163"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067163"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067164"><span class="annot"><a href="#local-6989586621683067164"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-314"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-type">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067164"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067163"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-315"></span><span>        </span><span class="annot"><a href="GHC.Rename.Splice.html#checkThLocalName"><span class="hs-identifier hs-type">checkThLocalName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067163"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-type">l2l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067162"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067163"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-type">unitFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067163"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnUnboundVar"><span class="hs-identifier hs-type">rnUnboundVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span id="rnUnboundVar"><span class="annot"><span class="annottext">rnUnboundVar :: RdrName -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnUnboundVar"><span class="hs-identifier hs-var hs-var">rnUnboundVar</span></a></span></span><span> </span><span id="local-6989586621683067172"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683067172"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>  </span><span id="local-6989586621683067173"><span class="annot"><a href="#local-6989586621683067173"><span class="hs-identifier hs-var">deferOutofScopeVariables</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_DeferOutOfScopeVariables"><span class="hs-identifier hs-var">Opt_DeferOutOfScopeVariables</span></a></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-comment">-- See Note [Reporting unbound names] for difference between qualified and unqualified names.</span><span>
</span><span id="line-322"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#isUnqual"><span class="hs-identifier hs-type">isUnqual</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067172"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621683067173"><span class="hs-identifier hs-type">deferOutofScopeVariables</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Unbound.html#reportUnboundName"><span class="hs-identifier hs-type">reportUnboundName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067172"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067172"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span id="rnExpr"><span class="annot"><span class="annottext">rnExpr :: HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var hs-var">rnExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067181"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683067181"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683067182"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683067182"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067183"><span class="annot"><a href="#local-6989586621683067183"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-327"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067185"><span class="annot"><a href="#local-6989586621683067185"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupExprOccRn"><span class="hs-identifier hs-type">lookupExprOccRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067182"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-328"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683067185"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-329"></span><span>           </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnUnboundVar"><span class="hs-identifier hs-var">rnUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683067182"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-330"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683067187"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683067187"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067188"><span class="annot"><span class="annottext">nm :: Name
</span><a href="#local-6989586621683067188"><span class="hs-identifier hs-var hs-var">nm</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683067187"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-332"></span><span>             </span><span id="local-6989586621683067190"><span class="annot"><span class="annottext">info :: GREInfo
</span><a href="#local-6989586621683067190"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; GREInfo
</span><a href="GHC.Types.Name.Reader.html#greInfo"><span class="hs-identifier hs-var">greInfo</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683067187"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-333"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#IAmRecField"><span class="hs-identifier hs-type">IAmRecField</span></a></span><span> </span><span id="local-6989586621683067193"><span class="annot"><span class="annottext">RecFieldInfo
</span><a href="#local-6989586621683067193"><span class="hs-identifier hs-var">fld_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683067190"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-comment">-- Since GHC 9.4, such occurrences of record fields must be</span><span>
</span><span id="line-335"></span><span>            </span><span class="hs-comment">-- unambiguous. For ambiguous occurrences, we arbitrarily pick one</span><span>
</span><span id="line-336"></span><span>            </span><span class="hs-comment">-- matching GRE and add a name clash error</span><span>
</span><span id="line-337"></span><span>            </span><span class="hs-comment">-- (see lookupGlobalOccRn_overloaded, called by lookupExprOccRn).</span><span>
</span><span id="line-338"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067194"><span class="annot"><span class="annottext">sel_name :: Name
</span><a href="#local-6989586621683067194"><span class="hs-identifier hs-var hs-var hs-var">sel_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; FieldLabel -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecFieldInfo -&gt; FieldLabel
</span><a href="GHC.Types.GREInfo.html#recFieldLabel"><span class="hs-identifier hs-var">recFieldLabel</span></a></span><span> </span><span class="annot"><span class="annottext">RecFieldInfo
</span><a href="#local-6989586621683067193"><span class="hs-identifier hs-var">fld_info</span></a></span><span>
</span><span id="line-339"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067197"><span class="annot"><a href="#local-6989586621683067197"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-340"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-type">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067197"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067194"><span class="hs-identifier hs-type">sel_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-341"></span><span>                      </span><span class="annot"><a href="GHC.Rename.Splice.html#checkThLocalName"><span class="hs-identifier hs-type">checkThLocalName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067194"><span class="hs-identifier hs-type">sel_name</span></a></span><span>
</span><span id="line-342"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecSelRn"><span class="hs-identifier hs-type">HsRecSelRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067182"><span class="hs-identifier hs-type">v</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067181"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067194"><span class="hs-identifier hs-type">sel_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-type">unitFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067194"><span class="hs-identifier hs-type">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067188"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Types.html#nilDataConName"><span class="hs-identifier hs-var">nilDataConName</span></a></span><span>
</span><span id="line-345"></span><span>              </span><span class="hs-comment">-- Treat [] as an ExplicitList, so that</span><span>
</span><span id="line-346"></span><span>              </span><span class="hs-comment">-- OverloadedLists works correctly</span><span>
</span><span id="line-347"></span><span>              </span><span class="hs-comment">-- Note [Empty lists] in GHC.Hs.Expr</span><span>
</span><span id="line-348"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.OverloadedLists</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683067183"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-349"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XExplicitList GhcPs -&gt; [LHsExpr GhcPs] -&gt; HsExpr GhcPs
forall p. XExplicitList p -&gt; [LHsExpr p] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcPs
AnnList ()
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-352"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocatedA Name -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#finishHsVar"><span class="hs-identifier hs-var">finishHsVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; Name -&gt; LocatedA Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; SrcSpanAnnA
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683067181"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067188"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsIPVar"><span class="hs-identifier hs-type">HsIPVar</span></a></span><span> </span><span id="local-6989586621683067206"><span class="annot"><span class="annottext">XIPVar GhcPs
</span><a href="#local-6989586621683067206"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067207"><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683067207"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIPVar GhcRn -&gt; HsIPName -&gt; HsExpr GhcRn
forall p. XIPVar p -&gt; HsIPName -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsIPVar"><span class="hs-identifier hs-var">HsIPVar</span></a></span><span> </span><span class="annot"><span class="annottext">XIPVar GhcPs
XIPVar GhcRn
</span><a href="#local-6989586621683067206"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683067207"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">XUnboundVar GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067208"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683067208"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnboundVar GhcRn -&gt; RdrName -&gt; HsExpr GhcRn
forall p. XUnboundVar p -&gt; RdrName -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-var">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">XUnboundVar GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683067208"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="hs-comment">-- HsOverLabel: see Note [Handling overloaded and rebindable constructs]</span><span>
</span><span id="line-362"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLabel"><span class="hs-identifier hs-type">HsOverLabel</span></a></span><span> </span><span id="local-6989586621683067210"><span class="annot"><span class="annottext">XOverLabel GhcPs
</span><a href="#local-6989586621683067210"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621683067211"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683067211"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067212"><span class="annot"><a href="#local-6989586621683067212"><span class="hs-identifier hs-var">from_label</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067213"><span class="annot"><a href="#local-6989586621683067213"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Name, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fromLabelClassOpName"><span class="hs-identifier hs-var">fromLabelClassOpName</span></a></span><span>
</span><span id="line-364"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-type">mkExpandedExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLabel"><span class="hs-identifier hs-type">HsOverLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067210"><span class="hs-identifier hs-type">src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067211"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-365"></span><span>                  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Utils.html#genLHsVar"><span class="hs-identifier hs-type">genLHsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067212"><span class="hs-identifier hs-type">from_label</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067218"><span class="hs-identifier hs-type">hs_ty_arg</span></a></span><span>
</span><span id="line-366"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067213"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621683067218"><span class="annot"><span class="annottext">hs_ty_arg :: HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsType GhcRn))
</span><a href="#local-6989586621683067218"><span class="hs-identifier hs-var hs-var">hs_ty_arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsType GhcRn))
forall thing. thing -&gt; HsWildCardBndrs GhcRn thing
</span><a href="GHC.Hs.Type.html#mkEmptyWildCardBndrs"><span class="hs-identifier hs-var">mkEmptyWildCardBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn)
 -&gt; HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsType GhcRn)))
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; HsWildCardBndrs GhcRn (GenLocated SrcSpanAnnA (HsType GhcRn))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn))
-&gt; HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-369"></span><span>                </span><span class="annot"><span class="annottext">XTyLit GhcRn -&gt; HsTyLit GhcRn -&gt; HsType GhcRn
forall pass. XTyLit pass -&gt; HsTyLit pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">XTyLit GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XStrTy GhcRn -&gt; FastString -&gt; HsTyLit GhcRn
forall pass. XStrTy pass -&gt; FastString -&gt; HsTyLit pass
</span><a href="Language.Haskell.Syntax.Type.html#HsStrTy"><span class="hs-identifier hs-var">HsStrTy</span></a></span><span> </span><span class="annot"><span class="annottext">XStrTy GhcRn
SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683067211"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span id="local-6989586621683067224"><span class="annot"><span class="annottext">XLitE GhcPs
</span><a href="#local-6989586621683067224"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067225"><span class="annot"><span class="annottext">HsLit GhcPs
</span><a href="#local-6989586621683067225"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067226"><span class="annot"><span class="annottext">XHsString GhcPs
</span><a href="#local-6989586621683067226"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067227"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683067227"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLit GhcPs -&gt; Maybe (XHsString GhcPs, FastString)
</span><a href="#local-6989586621683067228"><span class="hs-identifier hs-var">stringLike</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcPs
</span><a href="#local-6989586621683067225"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067229"><span class="annot"><a href="#local-6989586621683067229"><span class="hs-identifier hs-var">opt_OverloadedStrings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.OverloadedStrings</span></span><span>
</span><span id="line-373"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683067229"><span class="hs-identifier hs-type">opt_OverloadedStrings</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-type">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067224"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsIsString"><span class="hs-identifier hs-type">mkHsIsString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067226"><span class="hs-identifier hs-type">src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067227"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-376"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Pat.html#rnLit"><span class="hs-identifier hs-type">rnLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067225"><span class="hs-identifier hs-type">lit</span></a></span><span>
</span><span id="line-377"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067224"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-type">convertLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067225"><span class="hs-identifier hs-type">lit</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621683067228"><span class="annot"><span class="annottext">stringLike :: HsLit GhcPs -&gt; Maybe (XHsString GhcPs, FastString)
</span><a href="#local-6989586621683067228"><span class="hs-identifier hs-var hs-var">stringLike</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsString"><span class="hs-identifier hs-type">HsString</span></a></span><span> </span><span id="local-6989586621683067237"><span class="annot"><span class="annottext">XHsString GhcPs
</span><a href="#local-6989586621683067237"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621683067238"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683067238"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(XHsString GhcPs, FastString)
-&gt; Maybe (XHsString GhcPs, FastString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsString GhcPs
</span><a href="#local-6989586621683067237"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683067238"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsMultilineString"><span class="hs-identifier hs-type">HsMultilineString</span></a></span><span> </span><span id="local-6989586621683067240"><span class="annot"><span class="annottext">XHsMultilineString GhcPs
</span><a href="#local-6989586621683067240"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621683067241"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683067241"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(XHsString GhcPs, FastString)
-&gt; Maybe (XHsString GhcPs, FastString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsMultilineString GhcPs
XHsString GhcPs
</span><a href="#local-6989586621683067240"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683067241"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>      </span><span class="annot"><span class="annottext">HsLit GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (XHsString GhcPs, FastString)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span id="local-6989586621683067242"><span class="annot"><span class="annottext">XLitE GhcPs
</span><a href="#local-6989586621683067242"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067243"><span class="annot"><span class="annottext">HsLit GhcPs
</span><a href="#local-6989586621683067243"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsLit GhcPs -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall p. HsLit p -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Pat.html#rnLit"><span class="hs-identifier hs-var">rnLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcPs
</span><a href="#local-6989586621683067243"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-386"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLitE GhcRn -&gt; HsLit GhcRn -&gt; HsExpr GhcRn
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcPs
XLitE GhcRn
</span><a href="#local-6989586621683067242"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLit GhcPs -&gt; HsLit GhcRn
forall (p1 :: Pass) (p2 :: Pass).
HsLit (GhcPass p1) -&gt; HsLit (GhcPass p2)
</span><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-var">convertLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcPs
</span><a href="#local-6989586621683067243"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span id="local-6989586621683067244"><span class="annot"><span class="annottext">XOverLitE GhcPs
</span><a href="#local-6989586621683067244"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067245"><span class="annot"><span class="annottext">HsOverLit GhcPs
</span><a href="#local-6989586621683067245"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683067246"><span class="annot"><a href="#local-6989586621683067246"><span class="hs-identifier hs-var">lit'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067247"><span class="annot"><a href="#local-6989586621683067247"><span class="hs-identifier hs-var">mb_neg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067248"><span class="annot"><a href="#local-6989586621683067248"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcPs
-&gt; RnM ((HsOverLit GhcRn, Maybe (HsExpr GhcRn)), FreeVars)
forall t.
(XXOverLit t ~ DataConCantHappen) =&gt;
HsOverLit t
-&gt; RnM ((HsOverLit GhcRn, Maybe (HsExpr GhcRn)), FreeVars)
</span><a href="GHC.Rename.Pat.html#rnOverLit"><span class="hs-identifier hs-var">rnOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcPs
</span><a href="#local-6989586621683067245"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-comment">-- See Note [Negative zero]</span><span>
</span><span id="line-390"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683067247"><span class="hs-identifier hs-type">mb_neg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>              </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XOverLitE GhcRn -&gt; HsOverLit GhcRn -&gt; HsExpr GhcRn
forall p. XOverLitE p -&gt; HsOverLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-var">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE GhcPs
XOverLitE GhcRn
</span><a href="#local-6989586621683067244"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621683067246"><span class="hs-identifier hs-var">lit'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067248"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683067250"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683067250"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>                 </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XApp GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683067250"><span class="hs-identifier hs-var">neg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XOverLitE GhcRn -&gt; HsOverLit GhcRn -&gt; HsExpr GhcRn
forall p. XOverLitE p -&gt; HsOverLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-var">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE GhcPs
XOverLitE GhcRn
</span><a href="#local-6989586621683067244"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621683067246"><span class="hs-identifier hs-var">lit'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067248"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span id="local-6989586621683067253"><span class="annot"><span class="annottext">XApp GhcPs
</span><a href="#local-6989586621683067253"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067254"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067254"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683067255"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067255"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067256"><span class="annot"><a href="#local-6989586621683067256"><span class="hs-identifier hs-var">fun'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067257"><span class="annot"><a href="#local-6989586621683067257"><span class="hs-identifier hs-var">fvFun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067254"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-398"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067258"><span class="annot"><a href="#local-6989586621683067258"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067259"><span class="annot"><a href="#local-6989586621683067259"><span class="hs-identifier hs-var">fvArg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067255"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-399"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067253"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067256"><span class="hs-identifier hs-type">fun'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067258"><span class="hs-identifier hs-type">arg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067257"><span class="hs-identifier hs-type">fvFun</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067259"><span class="hs-identifier hs-type">fvArg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067260"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067260"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683067261"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcPs)
</span><a href="#local-6989586621683067261"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067262"><span class="annot"><a href="#local-6989586621683067262"><span class="hs-identifier hs-var">type_app</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TypeApplications</span></span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621683067262"><span class="hs-identifier hs-type">type_app</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#typeAppErr"><span class="hs-identifier hs-type">typeAppErr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-type">TypeLevel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hswc_body"><span class="hs-identifier hs-var">hswc_body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067261"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-404"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067266"><span class="annot"><a href="#local-6989586621683067266"><span class="hs-identifier hs-var">fun'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067267"><span class="annot"><a href="#local-6989586621683067267"><span class="hs-identifier hs-var">fvFun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067260"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-405"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067268"><span class="annot"><a href="#local-6989586621683067268"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067269"><span class="annot"><a href="#local-6989586621683067269"><span class="hs-identifier hs-var">fvArg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#rnHsWcType"><span class="hs-identifier hs-type">rnHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#HsTypeCtx"><span class="hs-identifier hs-type">HsTypeCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067261"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-406"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067266"><span class="hs-identifier hs-type">fun'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067268"><span class="hs-identifier hs-type">arg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067267"><span class="hs-identifier hs-type">fvFun</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067269"><span class="hs-identifier hs-type">fvArg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OpApp"><span class="hs-identifier hs-type">OpApp</span></a></span><span> </span><span class="annot"><span class="annottext">XOpApp GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067273"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067273"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621683067274"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067274"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621683067275"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067275"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067276"><span class="annot"><a href="#local-6989586621683067276"><span class="hs-identifier hs-var">e1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067277"><span class="annot"><a href="#local-6989586621683067277"><span class="hs-identifier hs-var">fv_e1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067273"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067278"><span class="annot"><a href="#local-6989586621683067278"><span class="hs-identifier hs-var">e2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067279"><span class="annot"><a href="#local-6989586621683067279"><span class="hs-identifier hs-var">fv_e2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067275"><span class="hs-identifier hs-type">e2</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067280"><span class="annot"><a href="#local-6989586621683067280"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067281"><span class="annot"><a href="#local-6989586621683067281"><span class="hs-identifier hs-var">fv_op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067274"><span class="hs-identifier hs-type">op</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-comment">-- Deal with fixity</span><span>
</span><span id="line-414"></span><span>        </span><span class="hs-comment">-- When renaming code synthesised from &quot;deriving&quot; declarations</span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-comment">-- we used to avoid fixity stuff, but we can't easily tell any</span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-comment">-- more, so I've removed the test.  Adding HsPars in GHC.Tc.Deriv.Generate</span><span>
</span><span id="line-417"></span><span>        </span><span class="hs-comment">-- should prevent bad things happening.</span><span>
</span><span id="line-418"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067282"><span class="annot"><a href="#local-6989586621683067282"><span class="hs-identifier hs-var">fixity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683067280"><span class="hs-identifier hs-type">op'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-419"></span><span>              </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067283"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067283"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Fixity
</span><a href="GHC.Rename.Fixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067283"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-420"></span><span>              </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecSelRn"><span class="hs-identifier hs-type">HsRecSelRn</span></a></span><span> </span><span id="local-6989586621683067285"><span class="annot"><span class="annottext">FieldOcc GhcRn
</span><a href="#local-6989586621683067285"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldOcc GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) Fixity
</span><a href="GHC.Rename.Fixity.html#lookupFieldFixityRn"><span class="hs-identifier hs-var">lookupFieldFixityRn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldOcc GhcRn
</span><a href="#local-6989586621683067285"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-421"></span><span>              </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Fixity -&gt; IOEnv (Env TcGblEnv TcLclEnv) Fixity
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FixityDirection -&gt; Fixity
</span><a href="Language.Haskell.Syntax.Basic.html#Fixity"><span class="hs-identifier hs-var">Fixity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Types.Fixity.html#minPrecedence"><span class="hs-identifier hs-var">minPrecedence</span></a></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="Language.Haskell.Syntax.Basic.html#InfixL"><span class="hs-identifier hs-var">InfixL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                   </span><span class="hs-comment">-- c.f. lookupFixity for unbound</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067290"><span class="annot"><a href="#local-6989586621683067290"><span class="hs-identifier hs-var">lexical_negation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.LexicalNegation</span></span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067292"><span class="annot"><a href="#local-6989586621683067292"><span class="hs-identifier hs-var hs-var">negation_handling</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683067290"><span class="hs-identifier hs-var">lexical_negation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NegationHandling
</span><a href="GHC.Rename.HsType.html#KeepNegationIntact"><span class="hs-identifier hs-var">KeepNegationIntact</span></a></span><span>
</span><span id="line-426"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NegationHandling
</span><a href="GHC.Rename.HsType.html#ReassociateNegation"><span class="hs-identifier hs-var">ReassociateNegation</span></a></span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067295"><span class="annot"><a href="#local-6989586621683067295"><span class="hs-identifier hs-var">final_e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#mkOpAppRn"><span class="hs-identifier hs-type">mkOpAppRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067292"><span class="hs-identifier hs-type">negation_handling</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067276"><span class="hs-identifier hs-type">e1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067280"><span class="hs-identifier hs-type">op'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067282"><span class="hs-identifier hs-type">fixity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067278"><span class="hs-identifier hs-type">e2'</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067295"><span class="hs-identifier hs-type">final_e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067277"><span class="hs-identifier hs-type">fv_e1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067281"><span class="hs-identifier hs-type">fv_op</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067279"><span class="hs-identifier hs-type">fv_e2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#NegApp"><span class="hs-identifier hs-type">NegApp</span></a></span><span> </span><span class="annot"><span class="annottext">XNegApp GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067298"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067298"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067299"><span class="annot"><a href="#local-6989586621683067299"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067300"><span class="annot"><a href="#local-6989586621683067300"><span class="hs-identifier hs-var">fv_e</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067298"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-432"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067301"><span class="annot"><a href="#local-6989586621683067301"><span class="hs-identifier hs-var">neg_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067302"><span class="annot"><a href="#local-6989586621683067302"><span class="hs-identifier hs-var">fv_neg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntax"><span class="hs-identifier hs-type">lookupSyntax</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#negateName"><span class="hs-identifier hs-type">negateName</span></a></span><span>
</span><span id="line-433"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067305"><span class="annot"><a href="#local-6989586621683067305"><span class="hs-identifier hs-var">final_e</span></a></span></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#mkNegAppRn"><span class="hs-identifier hs-type">mkNegAppRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067299"><span class="hs-identifier hs-type">e'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067301"><span class="hs-identifier hs-type">neg_name</span></a></span><span>
</span><span id="line-434"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067305"><span class="hs-identifier hs-type">final_e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067300"><span class="hs-identifier hs-type">fv_e</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067302"><span class="hs-identifier hs-type">fv_neg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-comment">------------------------------------------</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- Record dot syntax</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsGetField"><span class="hs-identifier hs-type">HsGetField</span></a></span><span> </span><span class="annot"><span class="annottext">XGetField GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067308"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067308"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683067309"><span class="annot"><span class="annottext">XRec GhcPs (DotFieldOcc GhcPs)
</span><a href="#local-6989586621683067309"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067310"><span class="annot"><a href="#local-6989586621683067310"><span class="hs-identifier hs-var">getField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067311"><span class="annot"><a href="#local-6989586621683067311"><span class="hs-identifier hs-var">fv_getField</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Name, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#getFieldName"><span class="hs-identifier hs-var">getFieldName</span></a></span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067313"><span class="annot"><a href="#local-6989586621683067313"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067314"><span class="annot"><a href="#local-6989586621683067314"><span class="hs-identifier hs-var">fv_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067308"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-442"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067315"><span class="annot"><a href="#local-6989586621683067315"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DotFieldOcc GhcPs -&gt; DotFieldOcc GhcRn
</span><a href="GHC.Rename.Expr.html#rnDotFieldOcc"><span class="hs-identifier hs-var">rnDotFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(DotFieldOcc GhcPs -&gt; DotFieldOcc GhcRn)
-&gt; GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcPs)
-&gt; GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">XRec GhcPs (DotFieldOcc GhcPs)
GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcPs)
</span><a href="#local-6989586621683067309"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-443"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-type">mkExpandedExpr</span></a></span><span>
</span><span id="line-444"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsGetField"><span class="hs-identifier hs-type">HsGetField</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067313"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067315"><span class="hs-identifier hs-type">f'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#mkGetField"><span class="hs-identifier hs-type">mkGetField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067310"><span class="hs-identifier hs-type">getField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067313"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#dfoLabel"><span class="hs-identifier hs-var">dfoLabel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067315"><span class="hs-identifier hs-type">f'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067314"><span class="hs-identifier hs-type">fv_e</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067311"><span class="hs-identifier hs-type">fv_getField</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProjection"><span class="hs-identifier hs-type">HsProjection</span></a></span><span> </span><span class="annot"><span class="annottext">XProjection GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067323"><span class="annot"><span class="annottext">NonEmpty (DotFieldOcc GhcPs)
</span><a href="#local-6989586621683067323"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067324"><span class="annot"><a href="#local-6989586621683067324"><span class="hs-identifier hs-var">getField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067325"><span class="annot"><a href="#local-6989586621683067325"><span class="hs-identifier hs-var">fv_getField</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Name, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#getFieldName"><span class="hs-identifier hs-var">getFieldName</span></a></span><span>
</span><span id="line-450"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067326"><span class="annot"><a href="#local-6989586621683067326"><span class="hs-identifier hs-var">circ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier hs-type">lookupOccRn</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#compose_RDR"><span class="hs-identifier hs-type">compose_RDR</span></a></span><span>
</span><span id="line-451"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067329"><span class="annot"><a href="#local-6989586621683067329"><span class="hs-identifier hs-var hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DotFieldOcc GhcPs -&gt; DotFieldOcc GhcRn)
-&gt; NonEmpty (DotFieldOcc GhcPs) -&gt; NonEmpty (DotFieldOcc GhcRn)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#map"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DotFieldOcc GhcPs -&gt; DotFieldOcc GhcRn
</span><a href="GHC.Rename.Expr.html#rnDotFieldOcc"><span class="hs-identifier hs-var">rnDotFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (DotFieldOcc GhcPs)
</span><a href="#local-6989586621683067323"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-452"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-type">mkExpandedExpr</span></a></span><span>
</span><span id="line-453"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProjection"><span class="hs-identifier hs-type">HsProjection</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067329"><span class="hs-identifier hs-type">fs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#mkProjection"><span class="hs-identifier hs-type">mkProjection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067324"><span class="hs-identifier hs-type">getField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067326"><span class="hs-identifier hs-type">circ</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#map"><span class="hs-identifier hs-type">NE.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#dfoLabel"><span class="hs-identifier hs-var">dfoLabel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067329"><span class="hs-identifier hs-type">fs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-type">unitFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067326"><span class="hs-identifier hs-type">circ</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067325"><span class="hs-identifier hs-type">fv_getField</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">------------------------------------------</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- Template Haskell extensions</span><span>
</span><span id="line-459"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span id="local-6989586621683067332"><span class="annot"><span class="annottext">e :: HsExpr GhcPs
</span><a href="#local-6989586621683067332"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedBracket"><span class="hs-identifier hs-type">HsTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">XTypedBracket GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067334"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067334"><span class="hs-identifier hs-var">br_body</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; LHsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Splice.html#rnTypedBracket"><span class="hs-identifier hs-var">rnTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067332"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067334"><span class="hs-identifier hs-var">br_body</span></a></span><span>
</span><span id="line-460"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span id="local-6989586621683067335"><span class="annot"><span class="annottext">e :: HsExpr GhcPs
</span><a href="#local-6989586621683067335"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedBracket"><span class="hs-identifier hs-type">HsUntypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">XUntypedBracket GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067337"><span class="annot"><span class="annottext">HsQuote GhcPs
</span><a href="#local-6989586621683067337"><span class="hs-identifier hs-var">br_body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; HsQuote GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Splice.html#rnUntypedBracket"><span class="hs-identifier hs-var">rnUntypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067335"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsQuote GhcPs
</span><a href="#local-6989586621683067337"><span class="hs-identifier hs-var">br_body</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span>   </span><span class="annot"><span class="annottext">XTypedSplice GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067339"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067339"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Splice.html#rnTypedSplice"><span class="hs-identifier hs-var">rnTypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067339"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-463"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XUntypedSplice GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067341"><span class="annot"><span class="annottext">HsUntypedSplice GhcPs
</span><a href="#local-6989586621683067341"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Splice.html#rnUntypedSpliceExpr"><span class="hs-identifier hs-var">rnUntypedSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice GhcPs
</span><a href="#local-6989586621683067341"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="hs-comment">---------------------------------------------</span><span>
</span><span id="line-466"></span><span class="hs-comment">--      Sections</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- See Note [Parsing sections] in GHC.Parser</span><span>
</span><span id="line-468"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067343"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067343"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067344"><span class="annot"><span class="annottext">section :: HsExpr GhcPs
</span><a href="#local-6989586621683067344"><span class="hs-identifier hs-var">section</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionL"><span class="hs-identifier hs-type">SectionL</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067346"><span class="annot"><a href="#local-6989586621683067346"><span class="hs-identifier hs-var">section'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067347"><span class="annot"><a href="#local-6989586621683067347"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-var">rnSection</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067344"><span class="hs-identifier hs-var">section</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067343"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067346"><span class="hs-identifier hs-type">section'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067347"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067349"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067349"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067350"><span class="annot"><span class="annottext">section :: HsExpr GhcPs
</span><a href="#local-6989586621683067350"><span class="hs-identifier hs-var">section</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionR"><span class="hs-identifier hs-type">SectionR</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067352"><span class="annot"><a href="#local-6989586621683067352"><span class="hs-identifier hs-var">section'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067353"><span class="annot"><a href="#local-6989586621683067353"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-var">rnSection</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067350"><span class="hs-identifier hs-var">section</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067349"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067352"><span class="hs-identifier hs-type">section'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067353"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067354"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067354"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067355"><span class="annot"><a href="#local-6989586621683067355"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067356"><span class="annot"><a href="#local-6989586621683067356"><span class="hs-identifier hs-var">fvs_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067354"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-478"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067355"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067356"><span class="hs-identifier hs-type">fvs_e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span id="local-6989586621683067357"><span class="annot"><span class="annottext">expr :: HsExpr GhcPs
</span><a href="#local-6989586621683067357"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionL"><span class="hs-identifier hs-type">SectionL</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcRnMessage
</span><a href="GHC.Rename.Expr.html#sectionErr"><span class="hs-identifier hs-var">sectionErr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067357"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-var">rnSection</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067357"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-482"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span id="local-6989586621683067359"><span class="annot"><span class="annottext">expr :: HsExpr GhcPs
</span><a href="#local-6989586621683067359"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionR"><span class="hs-identifier hs-type">SectionR</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcRnMessage
</span><a href="GHC.Rename.Expr.html#sectionErr"><span class="hs-identifier hs-var">sectionErr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067359"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-var">rnSection</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067359"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">---------------------------------------------</span><span>
</span><span id="line-486"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span id="local-6989586621683067361"><span class="annot"><span class="annottext">XPragE GhcPs
</span><a href="#local-6989586621683067361"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067362"><span class="annot"><span class="annottext">HsPragE GhcPs
</span><a href="#local-6989586621683067362"><span class="hs-identifier hs-var">prag</span></a></span></span><span> </span><span id="local-6989586621683067363"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067363"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067364"><span class="annot"><a href="#local-6989586621683067364"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067365"><span class="annot"><a href="#local-6989586621683067365"><span class="hs-identifier hs-var">fvs_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067363"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-488"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067361"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067366"><span class="hs-identifier hs-type">rn_prag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067362"><span class="hs-identifier hs-type">prag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067364"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067365"><span class="hs-identifier hs-type">fvs_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><a href="#local-6989586621683067366"><span class="hs-identifier hs-type">rn_prag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span id="local-6989586621683067366"><span class="annot"><span class="annottext">rn_prag :: HsPragE GhcPs -&gt; HsPragE GhcRn
</span><a href="#local-6989586621683067366"><span class="hs-identifier hs-var hs-var">rn_prag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragSCC"><span class="hs-identifier hs-type">HsPragSCC</span></a></span><span> </span><span id="local-6989586621683067368"><span class="annot"><span class="annottext">XSCC GhcPs
</span><a href="#local-6989586621683067368"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067369"><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621683067369"><span class="hs-identifier hs-var">ann</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XSCC GhcRn -&gt; StringLiteral -&gt; HsPragE GhcRn
forall p. XSCC p -&gt; StringLiteral -&gt; HsPragE p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPragSCC"><span class="hs-identifier hs-var">HsPragSCC</span></a></span><span> </span><span class="annot"><span class="annottext">XSCC GhcPs
XSCC GhcRn
</span><a href="#local-6989586621683067368"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621683067369"><span class="hs-identifier hs-var">ann</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLam"><span class="hs-identifier hs-type">HsLam</span></a></span><span> </span><span id="local-6989586621683067371"><span class="annot"><span class="annottext">XLam GhcPs
</span><a href="#local-6989586621683067371"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067372"><span class="annot"><span class="annottext">HsLamVariant
</span><a href="#local-6989586621683067372"><span class="hs-identifier hs-var">lam_variant</span></a></span></span><span> </span><span id="local-6989586621683067373"><span class="annot"><span class="annottext">MatchGroup GhcPs (LHsExpr GhcPs)
</span><a href="#local-6989586621683067373"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067374"><span class="annot"><a href="#local-6989586621683067374"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067375"><span class="annot"><a href="#local-6989586621683067375"><span class="hs-identifier hs-var">fvs_ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcPs)
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars))
-&gt; MatchGroup GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
-&gt; RnM
     (MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)),
      FreeVars)
forall (body :: * -&gt; *).
(Outputable (body GhcPs), AnnoBody body) =&gt;
HsMatchContextRn
-&gt; (LocatedA (body GhcPs) -&gt; RnM (LocatedA (body GhcRn), FreeVars))
-&gt; MatchGroup GhcPs (LocatedA (body GhcPs))
-&gt; RnM (MatchGroup GhcRn (LocatedA (body GhcRn)), FreeVars)
</span><a href="GHC.Rename.Bind.html#rnMatchGroup"><span class="hs-identifier hs-var">rnMatchGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLamVariant -&gt; HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. HsLamVariant -&gt; HsMatchContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#LamAlt"><span class="hs-identifier hs-var">LamAlt</span></a></span><span> </span><span class="annot"><span class="annottext">HsLamVariant
</span><a href="#local-6989586621683067372"><span class="hs-identifier hs-var">lam_variant</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
GenLocated SrcSpanAnnA (HsExpr GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcPs (LHsExpr GhcPs)
MatchGroup GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683067373"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-495"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLam"><span class="hs-identifier hs-type">HsLam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067371"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067372"><span class="hs-identifier hs-type">lam_variant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067374"><span class="hs-identifier hs-type">matches'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067375"><span class="hs-identifier hs-type">fvs_ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-type">HsCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCase GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067378"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067378"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621683067379"><span class="annot"><span class="annottext">MatchGroup GhcPs (LHsExpr GhcPs)
</span><a href="#local-6989586621683067379"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067380"><span class="annot"><a href="#local-6989586621683067380"><span class="hs-identifier hs-var">new_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067381"><span class="annot"><a href="#local-6989586621683067381"><span class="hs-identifier hs-var">e_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067378"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-499"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067382"><span class="annot"><a href="#local-6989586621683067382"><span class="hs-identifier hs-var">new_matches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067383"><span class="annot"><a href="#local-6989586621683067383"><span class="hs-identifier hs-var">ms_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rnMatchGroup"><span class="hs-identifier hs-type">rnMatchGroup</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067379"><span class="hs-identifier hs-type">matches</span></a></span><span>
</span><span id="line-500"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-type">HsCase</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067380"><span class="hs-identifier hs-type">new_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067382"><span class="hs-identifier hs-type">new_matches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067381"><span class="hs-identifier hs-type">e_fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067383"><span class="hs-identifier hs-type">ms_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLet"><span class="hs-identifier hs-type">HsLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067386"><span class="annot"><span class="annottext">HsLocalBinds GhcPs
</span><a href="#local-6989586621683067386"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621683067387"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067387"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
-&gt; (HsLocalBinds GhcRn -&gt; FreeVars -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars)
forall result.
HsLocalBinds GhcPs
-&gt; (HsLocalBinds GhcRn -&gt; FreeVars -&gt; RnM (result, FreeVars))
-&gt; RnM (result, FreeVars)
</span><a href="GHC.Rename.Bind.html#rnLocalBindsAndThen"><span class="hs-identifier hs-var">rnLocalBindsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
</span><a href="#local-6989586621683067386"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">((HsLocalBinds GhcRn -&gt; FreeVars -&gt; TcM (HsExpr GhcRn, FreeVars))
 -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; (HsLocalBinds GhcRn -&gt; FreeVars -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683067388"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621683067388"><span class="hs-identifier hs-var">binds'</span></a></span></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067389"><span class="annot"><a href="#local-6989586621683067389"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067390"><span class="annot"><a href="#local-6989586621683067390"><span class="hs-identifier hs-var">fvExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067387"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-505"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLet"><span class="hs-identifier hs-type">HsLet</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067388"><span class="hs-identifier hs-type">binds'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067389"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067390"><span class="hs-identifier hs-type">fvExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><span class="annottext">XDo GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067392"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683067392"><span class="hs-identifier hs-var">do_or_lc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067393"><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><a href="#local-6989586621683067393"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683067394"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))]
</span><a href="#local-6989586621683067394"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683067395"><span class="annot"><a href="#local-6989586621683067395"><span class="hs-identifier hs-var">stmts1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067396"><span class="annot"><a href="#local-6989586621683067396"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-509"></span><span>          </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; [LStmt GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))]
-&gt; ([Name] -&gt; RnM ((), FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)),
         FreeVars)],
       ()),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)], thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmtsWithFreeVars"><span class="hs-identifier hs-var">rnStmtsWithFreeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683067392"><span class="hs-identifier hs-var">do_or_lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))]
</span><a href="#local-6989586621683067394"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-510"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((), FreeVars) -&gt; RnM ((), FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067399"><span class="annot"><a href="#local-6989586621683067399"><span class="hs-identifier hs-var">pp_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067400"><span class="annot"><a href="#local-6989586621683067400"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#postProcessStmtsForApplicativeDo"><span class="hs-identifier hs-type">postProcessStmtsForApplicativeDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067392"><span class="hs-identifier hs-type">do_or_lc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067395"><span class="hs-identifier hs-type">stmts1</span></a></span><span>
</span><span id="line-512"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067392"><span class="hs-identifier hs-type">do_or_lc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067393"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067399"><span class="hs-identifier hs-type">pp_stmts</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067396"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067400"><span class="hs-identifier hs-type">fvs2</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- ExplicitList: see Note [Handling overloaded and rebindable constructs]</span><span>
</span><span id="line-514"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-type">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067402"><span class="annot"><span class="annottext">[LHsExpr GhcPs]
</span><a href="#local-6989586621683067402"><span class="hs-identifier hs-var">exps</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067403"><span class="annot"><a href="#local-6989586621683067403"><span class="hs-identifier hs-var">exps'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067404"><span class="annot"><a href="#local-6989586621683067404"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcPs] -&gt; RnM ([XRec GhcRn (HsExpr GhcRn)], FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExprs"><span class="hs-identifier hs-var">rnExprs</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcPs]
</span><a href="#local-6989586621683067402"><span class="hs-identifier hs-var">exps</span></a></span><span>
</span><span id="line-516"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067405"><span class="annot"><a href="#local-6989586621683067405"><span class="hs-identifier hs-var">opt_OverloadedLists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.OverloadedLists</span></span><span>
</span><span id="line-517"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683067405"><span class="hs-identifier hs-type">opt_OverloadedLists</span></a></span><span>
</span><span id="line-518"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-type">ExplicitList</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067403"><span class="hs-identifier hs-type">exps'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067404"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067407"><span class="annot"><a href="#local-6989586621683067407"><span class="hs-identifier hs-var">from_list_n_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067408"><span class="annot"><a href="#local-6989586621683067408"><span class="hs-identifier hs-var">fvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-type">lookupSyntaxName</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#fromListNName"><span class="hs-identifier hs-type">fromListNName</span></a></span><span>
</span><span id="line-521"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067410"><span class="annot"><a href="#local-6989586621683067410"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span> </span><span class="hs-comment">-- See Note [Source locations for implicit function calls]</span><span>
</span><span id="line-522"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067412"><span class="annot"><a href="#local-6989586621683067412"><span class="hs-identifier hs-var hs-var">rn_list</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcRn -&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn
forall p. XExplicitList p -&gt; [LHsExpr p] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">[XRec GhcRn (HsExpr GhcRn)]
[GenLocated SrcSpanAnnA (HsExpr GhcRn)]
</span><a href="#local-6989586621683067403"><span class="hs-identifier hs-var">exps'</span></a></span><span>
</span><span id="line-523"></span><span>             </span><span id="local-6989586621683067413"><span class="annot"><a href="#local-6989586621683067413"><span class="hs-identifier hs-var hs-var">lit_n</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntegralLit
forall a. Integral a =&gt; a -&gt; IntegralLit
</span><a href="GHC.Types.SourceText.html#mkIntegralLit"><span class="hs-identifier hs-var">mkIntegralLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcPs)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcPs]
[GenLocated SrcSpanAnnA (HsExpr GhcPs)]
</span><a href="#local-6989586621683067402"><span class="hs-identifier hs-var">exps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>             </span><span id="local-6989586621683067416"><span class="annot"><a href="#local-6989586621683067416"><span class="hs-identifier hs-var hs-var">hs_lit</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntegralLit -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an. NoAnn an =&gt; IntegralLit -&gt; LocatedAn an (HsExpr GhcRn)
</span><a href="GHC.Rename.Utils.html#genHsIntegralLit"><span class="hs-identifier hs-var">genHsIntegralLit</span></a></span><span> </span><span class="annot"><span class="annottext">IntegralLit
</span><a href="#local-6989586621683067413"><span class="hs-identifier hs-var">lit_n</span></a></span><span>
</span><span id="line-525"></span><span>             </span><span id="local-6989586621683067417"><span class="annot"><a href="#local-6989586621683067417"><span class="hs-identifier hs-var hs-var">exp_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
-&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApps%27"><span class="hs-identifier hs-var">genHsApps'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnN
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683067410"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067407"><span class="hs-identifier hs-var">from_list_n_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067416"><span class="hs-identifier hs-var">hs_lit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683067412"><span class="hs-identifier hs-var">rn_list</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-526"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-type">mkExpandedExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067412"><span class="hs-identifier hs-type">rn_list</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067417"><span class="hs-identifier hs-type">exp_list</span></a></span><span>
</span><span id="line-527"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067404"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067408"><span class="hs-identifier hs-type">fvs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-type">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067420"><span class="annot"><span class="annottext">[HsTupArg GhcPs]
</span><a href="#local-6989586621683067420"><span class="hs-identifier hs-var">tup_args</span></a></span></span><span> </span><span id="local-6989586621683067421"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621683067421"><span class="hs-identifier hs-var">boxity</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcPs] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkTupleSection"><span class="hs-identifier hs-var">checkTupleSection</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcPs]
</span><a href="#local-6989586621683067420"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-531"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067423"><span class="annot"><a href="#local-6989586621683067423"><span class="hs-identifier hs-var">tup_args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067424"><span class="annot"><a href="#local-6989586621683067424"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsTupArg GhcPs
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcRn, FreeVars))
-&gt; [HsTupArg GhcPs]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([HsTupArg GhcRn], [FreeVars])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="annot"><span class="annottext">HsTupArg GhcPs
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcRn, FreeVars)
</span><a href="#local-6989586621683067426"><span class="hs-identifier hs-var">rnTupArg</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcPs]
</span><a href="#local-6989586621683067420"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-532"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-type">ExplicitTuple</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067423"><span class="hs-identifier hs-type">tup_args'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067421"><span class="hs-identifier hs-type">boxity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067424"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-534"></span><span>    </span><span id="local-6989586621683067426"><span class="annot"><span class="annottext">rnTupArg :: HsTupArg GhcPs
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcRn, FreeVars)
</span><a href="#local-6989586621683067426"><span class="hs-identifier hs-var hs-var">rnTupArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Present"><span class="hs-identifier hs-type">Present</span></a></span><span> </span><span id="local-6989586621683067432"><span class="annot"><span class="annottext">XPresent GhcPs
</span><a href="#local-6989586621683067432"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067433"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067433"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067434"><span class="annot"><a href="#local-6989586621683067434"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067435"><span class="annot"><a href="#local-6989586621683067435"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067433"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-535"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Present"><span class="hs-identifier hs-type">Present</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067432"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067434"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067435"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-536"></span><span>    </span><span class="annot"><a href="#local-6989586621683067426"><span class="hs-identifier hs-var">rnTupArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="annot"><span class="annottext">XMissing GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsTupArg GhcRn, FreeVars)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XMissing GhcRn -&gt; HsTupArg GhcRn
forall id. XMissing id -&gt; HsTupArg id
</span><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span><span> </span><span class="annot"><span class="annottext">XMissing GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitSum"><span class="hs-identifier hs-type">ExplicitSum</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitSum GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067438"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683067438"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621683067439"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683067439"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621683067440"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067440"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067441"><span class="annot"><a href="#local-6989586621683067441"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067442"><span class="annot"><a href="#local-6989586621683067442"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067440"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-540"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitSum"><span class="hs-identifier hs-type">ExplicitSum</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067438"><span class="hs-identifier hs-type">alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067439"><span class="hs-identifier hs-type">arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067441"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067442"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_con :: forall p. HsExpr p -&gt; XRec p (ConLikeP p)
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_con"><span class="hs-identifier hs-var">rcon_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683067445"><span class="annot"><span class="annottext">XRec GhcPs (ConLikeP GhcPs)
</span><a href="#local-6989586621683067445"><span class="hs-identifier hs-var">con_rdr</span></a></span></span><span>
</span><span id="line-543"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_flds :: forall p. HsExpr p -&gt; HsRecordBinds p
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683067447"><span class="annot"><span class="annottext">rec_binds :: HsRecordBinds GhcPs
</span><a href="#local-6989586621683067447"><span class="hs-identifier hs-var">rec_binds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rec_dotdot :: forall p arg. HsRecFields p arg -&gt; Maybe (XRec p RecFieldsDotDot)
</span><a href="Language.Haskell.Syntax.Pat.html#rec_dotdot"><span class="hs-identifier hs-var">rec_dotdot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683067450"><span class="annot"><span class="annottext">Maybe (XRec GhcPs RecFieldsDotDot)
</span><a href="#local-6989586621683067450"><span class="hs-identifier hs-var">dd</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067451"><span class="annot"><a href="#local-6989586621683067451"><span class="hs-identifier hs-var">con_lname</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067452"><span class="annot"><a href="#local-6989586621683067452"><span class="hs-identifier hs-var">con_name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName
-&gt; TcRn (GenLocated SrcSpanAnnN Name)
forall ann.
GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedOccRnConstr"><span class="hs-identifier hs-var">lookupLocatedOccRnConstr</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcPs (ConLikeP GhcPs)
GenLocated SrcSpanAnnN RdrName
</span><a href="#local-6989586621683067445"><span class="hs-identifier hs-var">con_rdr</span></a></span><span>
</span><span id="line-545"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067454"><span class="annot"><a href="#local-6989586621683067454"><span class="hs-identifier hs-var">flds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067455"><span class="annot"><a href="#local-6989586621683067455"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Pat.html#rnHsRecFields"><span class="hs-identifier hs-type">rnHsRecFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Pat.html#HsRecFieldCon"><span class="hs-identifier hs-type">HsRecFieldCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067452"><span class="hs-identifier hs-type">con_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067458"><span class="hs-identifier hs-type">mk_hs_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067447"><span class="hs-identifier hs-type">rec_binds</span></a></span><span>
</span><span id="line-546"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067459"><span class="annot"><a href="#local-6989586621683067459"><span class="hs-identifier hs-var">flds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067460"><span class="annot"><a href="#local-6989586621683067460"><span class="hs-identifier hs-var">fvss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapAndUnzipM</span></span><span> </span><span class="annot"><a href="#local-6989586621683067461"><span class="hs-identifier hs-type">rn_field</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067454"><span class="hs-identifier hs-type">flds</span></a></span><span>
</span><span id="line-547"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067462"><span class="annot"><a href="#local-6989586621683067462"><span class="hs-identifier hs-var hs-var">rec_binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rec_ext :: XHsRecFields GhcRn
</span><a href="Language.Haskell.Syntax.Pat.html#rec_ext"><span class="hs-identifier hs-var">rec_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NoExtField
XHsRecFields GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rec_flds :: [LHsRecField GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="Language.Haskell.Syntax.Pat.html#rec_flds"><span class="hs-identifier hs-var">rec_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsRecField GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcRn))
      (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683067459"><span class="hs-identifier hs-var">flds'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rec_dotdot :: Maybe (XRec GhcRn RecFieldsDotDot)
</span><a href="Language.Haskell.Syntax.Pat.html#rec_dotdot"><span class="hs-identifier hs-var">rec_dotdot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (XRec GhcPs RecFieldsDotDot)
Maybe (XRec GhcRn RecFieldsDotDot)
</span><a href="#local-6989586621683067450"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-548"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#rcon_ext"><span class="hs-identifier hs-var">rcon_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span>
</span><span id="line-549"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#rcon_con"><span class="hs-identifier hs-var">rcon_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683067451"><span class="hs-identifier hs-type">con_lname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683067462"><span class="hs-identifier hs-type">rec_binds'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-550"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067455"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067460"><span class="hs-identifier hs-type">fvss</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#addOneFV"><span class="hs-operator hs-type">`addOneFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067452"><span class="hs-identifier hs-type">con_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-551"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-552"></span><span>    </span><span id="local-6989586621683067458"><span class="annot"><span class="annottext">mk_hs_var :: SrcSpan -&gt; IdP p -&gt; HsExpr p
</span><a href="#local-6989586621683067458"><span class="hs-identifier hs-var hs-var">mk_hs_var</span></a></span></span><span> </span><span id="local-6989586621683067473"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683067473"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683067474"><span class="annot"><span class="annottext">IdP p
</span><a href="#local-6989586621683067474"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XVar p -&gt; XRec p (IdP p) -&gt; HsExpr p
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar p
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">l -&gt; IdP p -&gt; GenLocated l (IdP p)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; l
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683067473"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP p
</span><a href="#local-6989586621683067474"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>    </span><span id="local-6989586621683067461"><span class="annot"><span class="annottext">rn_field :: GenLocated
  l (HsFieldBind lhs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        l (HsFieldBind lhs (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
</span><a href="#local-6989586621683067461"><span class="hs-identifier hs-var hs-var">rn_field</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067477"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683067477"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683067478"><span class="annot"><span class="annottext">HsFieldBind lhs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683067478"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067479"><span class="annot"><a href="#local-6989586621683067479"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067480"><span class="annot"><a href="#local-6989586621683067480"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsFieldBind lhs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcPs)
forall lhs rhs. HsFieldBind lhs rhs -&gt; rhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind lhs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683067478"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067477"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067478"><span class="hs-identifier hs-type">fld</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683067479"><span class="hs-identifier hs-type">arg'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067480"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: forall p. HsExpr p -&gt; LHsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067484"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067484"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683067485"><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067485"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: forall p. HsExpr p -&gt; LHsRecUpdFields p
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683067487"><span class="annot"><span class="annottext">LHsRecUpdFields GhcPs
</span><a href="#local-6989586621683067487"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; TcM (HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067484"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LHsRecUpdFields GhcPs
</span><a href="#local-6989586621683067487"><span class="hs-identifier hs-var">rbinds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span>      </span><span class="hs-comment">-- 'OverloadedRecordUpdate' is not in effect. Regular record update.</span><span>
</span><span id="line-561"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RegularRecUpdFields"><span class="hs-identifier hs-type">RegularRecUpdFields</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recUpdFields :: forall p. LHsRecUpdFields p -&gt; [LHsRecUpdField p p]
</span><a href="Language.Haskell.Syntax.Expr.html#recUpdFields"><span class="hs-identifier hs-var">recUpdFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683067491"><span class="annot"><span class="annottext">[LHsRecUpdField GhcPs GhcPs]
</span><a href="#local-6989586621683067491"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067492"><span class="annot"><a href="#local-6989586621683067492"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067493"><span class="annot"><a href="#local-6989586621683067493"><span class="hs-identifier hs-var">fv_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067485"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-563"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067494"><span class="annot"><a href="#local-6989586621683067494"><span class="hs-identifier hs-var">parents</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067495"><span class="annot"><a href="#local-6989586621683067495"><span class="hs-identifier hs-var">flds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067496"><span class="annot"><a href="#local-6989586621683067496"><span class="hs-identifier hs-var">fv_flds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Pat.html#rnHsRecUpdFields"><span class="hs-identifier hs-type">rnHsRecUpdFields</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067491"><span class="hs-identifier hs-type">flds</span></a></span><span>
</span><span id="line-564"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067498"><span class="annot"><a href="#local-6989586621683067498"><span class="hs-identifier hs-var hs-var">upd_flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-565"></span><span>                    </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RegularRecUpdFields"><span class="hs-identifier hs-type">RegularRecUpdFields</span></a></span><span>
</span><span id="line-566"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xRecUpdFields :: XLHsRecUpdLabels GhcRn
</span><a href="Language.Haskell.Syntax.Expr.html#xRecUpdFields"><span class="hs-identifier hs-var">xRecUpdFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (HsRecUpdParent GhcRn)
XLHsRecUpdLabels GhcRn
</span><a href="#local-6989586621683067494"><span class="hs-identifier hs-var">parents</span></a></span><span>
</span><span id="line-567"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recUpdFields :: [LHsRecUpdField GhcRn GhcRn]
</span><a href="Language.Haskell.Syntax.Expr.html#recUpdFields"><span class="hs-identifier hs-var">recUpdFields</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcRn))
      (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683067495"><span class="hs-identifier hs-var">flds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-568"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067484"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067492"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067498"><span class="hs-identifier hs-type">upd_flds</span></a></span><span>
</span><span id="line-569"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067493"><span class="hs-identifier hs-type">fv_e</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067496"><span class="hs-identifier hs-type">fv_flds</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>      </span><span class="hs-comment">-- 'OverloadedRecordUpdate' is in effect. Record dot update desugaring.</span><span>
</span><span id="line-572"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OverloadedRecUpdFields"><span class="hs-identifier hs-type">OverloadedRecUpdFields</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">olRecUpdFields :: forall p. LHsRecUpdFields p -&gt; [LHsRecUpdProj p]
</span><a href="Language.Haskell.Syntax.Expr.html#olRecUpdFields"><span class="hs-identifier hs-var">olRecUpdFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683067502"><span class="annot"><span class="annottext">[LHsRecUpdProj GhcPs]
</span><a href="#local-6989586621683067502"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Extension
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier hs-var">unlessXOptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-574"></span><span>               </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnNoRebindableSyntaxRecordDot"><span class="hs-identifier hs-var">TcRnNoRebindableSyntaxRecordDot</span></a></span><span>
</span><span id="line-575"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067506"><span class="annot"><span class="annottext">punnedFields :: [HsFieldBind
   (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
   (GenLocated SrcSpanAnnA (HsExpr GhcPs))]
</span><a href="#local-6989586621683067506"><span class="hs-identifier hs-var hs-var hs-var">punnedFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
  (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683067507"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067507"><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
  (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683067507"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdProj GhcPs]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
      (GenLocated SrcSpanAnnA (HsExpr GhcPs)))]
</span><a href="#local-6989586621683067502"><span class="hs-identifier hs-var">flds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
  (GenLocated SrcSpanAnnA (HsExpr GhcPs))
-&gt; Bool
forall lhs rhs. HsFieldBind lhs rhs -&gt; Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hfbPun"><span class="hs-identifier hs-var">hfbPun</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
  (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683067507"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-576"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067509"><span class="annot"><a href="#local-6989586621683067509"><span class="hs-identifier hs-var">punsEnabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.NamedFieldPuns</span></span><span>
</span><span id="line-577"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683067506"><span class="hs-identifier hs-type">punnedFields</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621683067509"><span class="hs-identifier hs-type">punsEnabled</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-578"></span><span>               </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnNoFieldPunsRecordDot"><span class="hs-identifier hs-type">TcRnNoFieldPunsRecordDot</span></a></span><span>
</span><span id="line-579"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067513"><span class="annot"><a href="#local-6989586621683067513"><span class="hs-identifier hs-var">getField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067514"><span class="annot"><a href="#local-6989586621683067514"><span class="hs-identifier hs-var">fv_getField</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-type">lookupSyntaxName</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#getFieldName"><span class="hs-identifier hs-type">getFieldName</span></a></span><span>
</span><span id="line-580"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067515"><span class="annot"><a href="#local-6989586621683067515"><span class="hs-identifier hs-var">setField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067516"><span class="annot"><a href="#local-6989586621683067516"><span class="hs-identifier hs-var">fv_setField</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-type">lookupSyntaxName</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#setFieldName"><span class="hs-identifier hs-type">setFieldName</span></a></span><span>
</span><span id="line-581"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067518"><span class="annot"><a href="#local-6989586621683067518"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067519"><span class="annot"><a href="#local-6989586621683067519"><span class="hs-identifier hs-var">fv_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-type">rnExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067485"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-582"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067520"><span class="annot"><a href="#local-6989586621683067520"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067521"><span class="annot"><a href="#local-6989586621683067521"><span class="hs-identifier hs-var">fv_us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnHsUpdProjs"><span class="hs-identifier hs-type">rnHsUpdProjs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067502"><span class="hs-identifier hs-type">flds</span></a></span><span>
</span><span id="line-583"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067523"><span class="annot"><a href="#local-6989586621683067523"><span class="hs-identifier hs-var hs-var">upd_flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OverloadedRecUpdFields"><span class="hs-identifier hs-type">OverloadedRecUpdFields</span></a></span><span>
</span><span id="line-584"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xOLRecUpdFields :: XLHsOLRecUpdLabels GhcRn
</span><a href="Language.Haskell.Syntax.Expr.html#xOLRecUpdFields"><span class="hs-identifier hs-var">xOLRecUpdFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XLHsOLRecUpdLabels GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-585"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">olRecUpdFields :: [LHsRecUpdProj GhcRn]
</span><a href="Language.Haskell.Syntax.Expr.html#olRecUpdFields"><span class="hs-identifier hs-var">olRecUpdFields</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdProj GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
      (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683067520"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-586"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-type">mkExpandedExpr</span></a></span><span>
</span><span id="line-587"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067484"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067518"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067523"><span class="hs-identifier hs-type">upd_flds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#mkRecordDotUpd"><span class="hs-identifier hs-type">mkRecordDotUpd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067513"><span class="hs-identifier hs-type">getField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067515"><span class="hs-identifier hs-type">setField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067484"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067518"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067520"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683067514"><span class="hs-identifier hs-type">fv_getField</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067516"><span class="hs-identifier hs-type">fv_setField</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067519"><span class="hs-identifier hs-type">fv_e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067521"><span class="hs-identifier hs-type">fv_us</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">XExprWithTySig GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067527"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067527"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621683067528"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcPs)
</span><a href="#local-6989586621683067528"><span class="hs-identifier hs-var">pty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067529"><span class="annot"><a href="#local-6989586621683067529"><span class="hs-identifier hs-var">pty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067530"><span class="annot"><a href="#local-6989586621683067530"><span class="hs-identifier hs-var">fvTy</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDocContext
-&gt; LHsSigWcType GhcPs -&gt; RnM (LHsSigWcType GhcRn, FreeVars)
</span><a href="GHC.Rename.HsType.html#rnHsSigWcType"><span class="hs-identifier hs-var">rnHsSigWcType</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="GHC.Tc.Errors.Types.html#ExprWithTySigCtx"><span class="hs-identifier hs-var">ExprWithTySigCtx</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcPs)
LHsSigWcType GhcPs
</span><a href="#local-6989586621683067528"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067533"><span class="annot"><a href="#local-6989586621683067533"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067534"><span class="annot"><a href="#local-6989586621683067534"><span class="hs-identifier hs-var">fvExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#bindSigTyVarsFV"><span class="hs-identifier hs-type">bindSigTyVarsFV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#hsWcScopedTvs"><span class="hs-identifier hs-type">hsWcScopedTvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067529"><span class="hs-identifier hs-type">pty'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-595"></span><span>                             </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067527"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067533"><span class="hs-identifier hs-type">expr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067529"><span class="hs-identifier hs-type">pty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067534"><span class="hs-identifier hs-type">fvExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067530"><span class="hs-identifier hs-type">fvTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="hs-comment">-- HsIf: see Note [Handling overloaded and rebindable constructs]</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- Because of the coverage checker it is most convenient /not/ to</span><span>
</span><span id="line-600"></span><span class="hs-comment">-- expand HsIf; unless we are in rebindable syntax.</span><span>
</span><span id="line-601"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsIf"><span class="hs-identifier hs-type">HsIf</span></a></span><span> </span><span class="annot"><span class="annottext">XIf GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067538"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067538"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683067539"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067539"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621683067540"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067540"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
-&gt; LHsExpr GhcPs -&gt; LHsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnHsIf"><span class="hs-identifier hs-var">rnHsIf</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067538"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067539"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067540"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMultiIf"><span class="hs-identifier hs-type">HsMultiIf</span></a></span><span> </span><span class="annot"><span class="annottext">XMultiIf GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067543"><span class="annot"><span class="annottext">[LGRHS GhcPs (LHsExpr GhcPs)]
</span><a href="#local-6989586621683067543"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067544"><span class="annot"><a href="#local-6989586621683067544"><span class="hs-identifier hs-var">alts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067545"><span class="annot"><a href="#local-6989586621683067545"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   (Anno (GRHS GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))))
   (GRHS GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
 -&gt; RnM
      (GenLocated
         (Anno (GRHS GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
         (GRHS GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars))
-&gt; [GenLocated
      (Anno (GRHS GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))))
      (GRHS GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))]
-&gt; RnM
     ([GenLocated
         (Anno (GRHS GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
         (GRHS GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
      FreeVars)
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
(a -&gt; RnM (b, FreeVars)) -&gt; f a -&gt; RnM (f b, FreeVars)
</span><a href="GHC.Rename.Utils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcPs)
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars))
-&gt; LGRHS GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
-&gt; RnM
     (LGRHS GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsMatchContextRn
-&gt; (LocatedA (body GhcPs) -&gt; RnM (LocatedA (body GhcRn), FreeVars))
-&gt; LGRHS GhcPs (LocatedA (body GhcPs))
-&gt; RnM (LGRHS GhcRn (LocatedA (body GhcRn)), FreeVars)
</span><a href="GHC.Rename.Bind.html#rnGRHS"><span class="hs-identifier hs-var">rnGRHS</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. HsMatchContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#IfAlt"><span class="hs-identifier hs-var">IfAlt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
GenLocated SrcSpanAnnA (HsExpr GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcPs (LHsExpr GhcPs)]
[GenLocated
   (Anno (GRHS GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))))
   (GRHS GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs)))]
</span><a href="#local-6989586621683067543"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-605"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMultiIf"><span class="hs-identifier hs-type">HsMultiIf</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067544"><span class="hs-identifier hs-type">alts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067545"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-type">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcPs)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067548"><span class="annot"><span class="annottext">ArithSeqInfo GhcPs
</span><a href="#local-6989586621683067548"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067549"><span class="annot"><a href="#local-6989586621683067549"><span class="hs-identifier hs-var">opt_OverloadedLists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.OverloadedLists</span></span><span>
</span><span id="line-609"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067550"><span class="annot"><a href="#local-6989586621683067550"><span class="hs-identifier hs-var">new_seq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067551"><span class="annot"><a href="#local-6989586621683067551"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnArithSeq"><span class="hs-identifier hs-type">rnArithSeq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067548"><span class="hs-identifier hs-type">seq</span></a></span><span>
</span><span id="line-610"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683067549"><span class="hs-identifier hs-type">opt_OverloadedLists</span></a></span><span>
</span><span id="line-611"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-612"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067553"><span class="annot"><a href="#local-6989586621683067553"><span class="hs-identifier hs-var">from_list_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067554"><span class="annot"><a href="#local-6989586621683067554"><span class="hs-identifier hs-var">fvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntax"><span class="hs-identifier hs-type">lookupSyntax</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#fromListName"><span class="hs-identifier hs-type">fromListName</span></a></span><span>
</span><span id="line-613"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-type">ArithSeq</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683067553"><span class="hs-identifier hs-type">from_list_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067550"><span class="hs-identifier hs-type">new_seq</span></a></span><span>
</span><span id="line-614"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067551"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067554"><span class="hs-identifier hs-type">fvs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-615"></span><span>           </span><span class="hs-keyword">else</span><span>
</span><span id="line-616"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-type">ArithSeq</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621683067550"><span class="hs-identifier hs-type">new_seq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067551"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsEmbTy"><span class="hs-identifier hs-type">HsEmbTy</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTy GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067557"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcPs)
</span><a href="#local-6989586621683067557"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067558"><span class="annot"><a href="#local-6989586621683067558"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067559"><span class="annot"><a href="#local-6989586621683067559"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDocContext
-&gt; HsWildCardBndrs GhcPs (LHsType GhcPs)
-&gt; RnM (LHsWcType GhcRn, FreeVars)
</span><a href="GHC.Rename.HsType.html#rnHsWcType"><span class="hs-identifier hs-var">rnHsWcType</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="GHC.Tc.Errors.Types.html#HsTypeCtx"><span class="hs-identifier hs-var">HsTypeCtx</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcPs)
HsWildCardBndrs GhcPs (LHsType GhcPs)
</span><a href="#local-6989586621683067557"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-620"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#checkTypeSyntaxExtension"><span class="hs-identifier hs-type">checkTypeSyntaxExtension</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TypeKeywordSyntax"><span class="hs-identifier hs-type">TypeKeywordSyntax</span></a></span><span>
</span><span id="line-621"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsEmbTy"><span class="hs-identifier hs-type">HsEmbTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067558"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067559"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQual"><span class="hs-identifier hs-type">HsQual</span></a></span><span> </span><span class="annot"><span class="annottext">XQual GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067563"><span class="annot"><span class="annottext">SrcSpanAnnC
</span><a href="#local-6989586621683067563"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621683067564"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcPs)]
</span><a href="#local-6989586621683067564"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683067565"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067565"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067566"><span class="annot"><a href="#local-6989586621683067566"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067567"><span class="annot"><a href="#local-6989586621683067567"><span class="hs-identifier hs-var">fvs_ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcPs)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars))
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcPs)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated SrcSpanAnnA (HsExpr GhcRn)], [FreeVars])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
GenLocated SrcSpanAnnA (HsExpr GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcPs)]
</span><a href="#local-6989586621683067564"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-625"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067568"><span class="annot"><a href="#local-6989586621683067568"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067569"><span class="annot"><a href="#local-6989586621683067569"><span class="hs-identifier hs-var">fvs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067565"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-626"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#checkTypeSyntaxExtension"><span class="hs-identifier hs-type">checkTypeSyntaxExtension</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ContextArrowSyntax"><span class="hs-identifier hs-type">ContextArrowSyntax</span></a></span><span>
</span><span id="line-627"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQual"><span class="hs-identifier hs-type">HsQual</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067563"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067566"><span class="hs-identifier hs-type">ctxt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067568"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067567"><span class="hs-identifier hs-type">fvs_ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067569"><span class="hs-identifier hs-type">fvs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsForAll"><span class="hs-identifier hs-type">HsForAll</span></a></span><span> </span><span class="annot"><span class="annottext">XForAll GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067572"><span class="annot"><span class="annottext">HsForAllTelescope GhcPs
</span><a href="#local-6989586621683067572"><span class="hs-identifier hs-var">tele</span></a></span></span><span> </span><span id="local-6989586621683067573"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067573"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDocContext
-&gt; HsForAllTelescope GhcPs
-&gt; (HsForAllTelescope GhcRn -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars)
forall a.
HsDocContext
-&gt; HsForAllTelescope GhcPs
-&gt; (HsForAllTelescope GhcRn -&gt; RnM (a, FreeVars))
-&gt; RnM (a, FreeVars)
</span><a href="GHC.Rename.HsType.html#bindHsForAllTelescope"><span class="hs-identifier hs-var">bindHsForAllTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="GHC.Tc.Errors.Types.html#HsTypeCtx"><span class="hs-identifier hs-var">HsTypeCtx</span></a></span><span> </span><span class="annot"><span class="annottext">HsForAllTelescope GhcPs
</span><a href="#local-6989586621683067572"><span class="hs-identifier hs-var">tele</span></a></span><span> </span><span class="annot"><span class="annottext">((HsForAllTelescope GhcRn -&gt; TcM (HsExpr GhcRn, FreeVars))
 -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; (HsForAllTelescope GhcRn -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683067575"><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683067575"><span class="hs-identifier hs-var">tele'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067576"><span class="annot"><a href="#local-6989586621683067576"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067577"><span class="annot"><a href="#local-6989586621683067577"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067573"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-632"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#checkTypeSyntaxExtension"><span class="hs-identifier hs-type">checkTypeSyntaxExtension</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ForallTelescopeSyntax"><span class="hs-identifier hs-type">ForallTelescopeSyntax</span></a></span><span>
</span><span id="line-633"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsForAll"><span class="hs-identifier hs-type">HsForAll</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067575"><span class="hs-identifier hs-type">tele'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067576"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067577"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsFunArr"><span class="hs-identifier hs-type">HsFunArr</span></a></span><span> </span><span class="annot"><span class="annottext">XFunArr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067580"><span class="annot"><span class="annottext">HsArrowOf (LHsExpr GhcPs) GhcPs
</span><a href="#local-6989586621683067580"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683067581"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067581"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683067582"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067582"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067583"><span class="annot"><a href="#local-6989586621683067583"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067584"><span class="annot"><a href="#local-6989586621683067584"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067581"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-637"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067585"><span class="annot"><a href="#local-6989586621683067585"><span class="hs-identifier hs-var">mult'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067586"><span class="annot"><a href="#local-6989586621683067586"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#rnHsArrowWith"><span class="hs-identifier hs-type">rnHsArrowWith</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067580"><span class="hs-identifier hs-type">mult</span></a></span><span>
</span><span id="line-638"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067588"><span class="annot"><a href="#local-6989586621683067588"><span class="hs-identifier hs-var">res'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067589"><span class="annot"><a href="#local-6989586621683067589"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067582"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-639"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#checkTypeSyntaxExtension"><span class="hs-identifier hs-type">checkTypeSyntaxExtension</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#FunctionArrowSyntax"><span class="hs-identifier hs-type">FunctionArrowSyntax</span></a></span><span>
</span><span id="line-640"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsFunArr"><span class="hs-identifier hs-type">HsFunArr</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067585"><span class="hs-identifier hs-type">mult'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067583"><span class="hs-identifier hs-type">arg'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067588"><span class="hs-identifier hs-type">res'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683067584"><span class="hs-identifier hs-type">fvs1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067586"><span class="hs-identifier hs-type">fvs2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067589"><span class="hs-identifier hs-type">fvs3</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Static values
*                                                                      *
************************************************************************

For the static form we check that it is not used in splices.
We also collect the free variables of the term which come from
this module. See Note [Grand plan for static forms] in GHC.Iface.Tidy.StaticPtrTable.
-}</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span id="local-6989586621683067591"><span class="annot"><span class="annottext">e :: HsExpr GhcPs
</span><a href="#local-6989586621683067591"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStatic"><span class="hs-identifier hs-type">HsStatic</span></a></span><span> </span><span class="annot"><span class="annottext">XStatic GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067593"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067593"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>    </span><span class="hs-comment">-- Normally, you wouldn't be able to construct a static expression without</span><span>
</span><span id="line-656"></span><span>    </span><span class="hs-comment">-- first enabling -XStaticPointers in the first place, since that extension</span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-comment">-- is what makes the parser treat `static` as a keyword. But this is not a</span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-comment">-- sufficient safeguard, as one can construct static expressions by another</span><span>
</span><span id="line-659"></span><span>    </span><span class="hs-comment">-- mechanism: Template Haskell (see #14204). To ensure that GHC is</span><span>
</span><span id="line-660"></span><span>    </span><span class="hs-comment">-- absolutely prepared to cope with static forms, we check for</span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-comment">-- -XStaticPointers here as well.</span><span>
</span><span id="line-662"></span><span>    </span><span class="annot"><span class="annottext">Extension
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier hs-var">unlessXOptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.StaticPointers</span></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalStaticExpression"><span class="hs-identifier hs-var">TcRnIllegalStaticExpression</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067591"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-664"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683067596"><span class="annot"><a href="#local-6989586621683067596"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067597"><span class="annot"><a href="#local-6989586621683067597"><span class="hs-identifier hs-var">fvExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067593"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-665"></span><span>    </span><span id="local-6989586621683067598"><span class="annot"><a href="#local-6989586621683067598"><span class="hs-identifier hs-var">stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-type">getStage</span></a></span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683067598"><span class="hs-identifier hs-type">stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-667"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.TH.html#Splice"><span class="hs-identifier hs-type">Splice</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">THError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTHError"><span class="hs-identifier hs-var">TcRnTHError</span></a></span><span> </span><span class="annot"><span class="annottext">(THError -&gt; TcRnMessage) -&gt; THError -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; THError
</span><a href="GHC.Tc.Errors.Types.html#IllegalStaticFormInSplice"><span class="hs-identifier hs-var">IllegalStaticFormInSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067591"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>    </span><span id="local-6989586621683067603"><span class="annot"><a href="#local-6989586621683067603"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067604"><span class="annot"><a href="#local-6989586621683067604"><span class="hs-identifier hs-var hs-var">fvExpr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#filterNameSet"><span class="hs-identifier hs-var">filterNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683067603"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683067597"><span class="hs-identifier hs-var">fvExpr</span></a></span><span>
</span><span id="line-671"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStatic"><span class="hs-identifier hs-type">HsStatic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067604"><span class="hs-identifier hs-type">fvExpr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067596"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067597"><span class="hs-identifier hs-type">fvExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Arrow notation
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProc"><span class="hs-identifier hs-type">HsProc</span></a></span><span> </span><span id="local-6989586621683067607"><span class="annot"><span class="annottext">XProc GhcPs
</span><a href="#local-6989586621683067607"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067608"><span class="annot"><span class="annottext">LPat GhcPs
</span><a href="#local-6989586621683067608"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683067609"><span class="annot"><span class="annottext">LHsCmdTop GhcPs
</span><a href="#local-6989586621683067609"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#newArrowScope"><span class="hs-identifier hs-var">newArrowScope</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-682"></span><span>    </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; LPat GhcPs
-&gt; (LPat GhcRn -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars)
forall a.
HsMatchContextRn
-&gt; LPat GhcPs
-&gt; (LPat GhcRn -&gt; RnM (a, FreeVars))
-&gt; RnM (a, FreeVars)
</span><a href="GHC.Rename.Pat.html#rnPat"><span class="hs-identifier hs-var">rnPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsArrowMatchContext -&gt; HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. HsArrowMatchContext -&gt; HsMatchContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-var">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrowMatchContext
</span><a href="Language.Haskell.Syntax.Expr.html#ProcExpr"><span class="hs-identifier hs-var">ProcExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat GhcPs
</span><a href="#local-6989586621683067608"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">((LPat GhcRn -&gt; TcM (HsExpr GhcRn, FreeVars))
 -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; (LPat GhcRn -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; TcM (HsExpr GhcRn, FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683067614"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683067614"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067615"><span class="annot"><a href="#local-6989586621683067615"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067616"><span class="annot"><a href="#local-6989586621683067616"><span class="hs-identifier hs-var">fvBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcPs -&gt; RnM (LHsCmdTop GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnCmdTop"><span class="hs-identifier hs-var">rnCmdTop</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcPs
</span><a href="#local-6989586621683067609"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProc"><span class="hs-identifier hs-type">HsProc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067607"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067614"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067615"><span class="hs-identifier hs-type">body'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067616"><span class="hs-identifier hs-type">fvBody</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Type syntax
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span class="annot"><a href="GHC.Rename.Expr.html#checkTypeSyntaxExtension"><span class="hs-identifier hs-type">checkTypeSyntaxExtension</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TypeSyntax"><span class="hs-identifier hs-type">TypeSyntax</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span id="checkTypeSyntaxExtension"><span class="annot"><span class="annottext">checkTypeSyntaxExtension :: TypeSyntax -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkTypeSyntaxExtension"><span class="hs-identifier hs-var hs-var">checkTypeSyntaxExtension</span></a></span></span><span> </span><span id="local-6989586621683067618"><span class="annot"><span class="annottext">TypeSyntax
</span><a href="#local-6989586621683067618"><span class="hs-identifier hs-var">syntax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-696"></span><span>  </span><span class="annot"><span class="annottext">Extension
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier hs-var">unlessXOptM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeSyntax -&gt; Extension
</span><a href="GHC.Tc.Errors.Types.html#typeSyntaxExtension"><span class="hs-identifier hs-var">typeSyntaxExtension</span></a></span><span> </span><span class="annot"><span class="annottext">TypeSyntax
</span><a href="#local-6989586621683067618"><span class="hs-identifier hs-var">syntax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-697"></span><span>  </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeSyntax -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnexpectedTypeSyntaxInTerms"><span class="hs-identifier hs-var">TcRnUnexpectedTypeSyntaxInTerms</span></a></span><span> </span><span class="annot"><span class="annottext">TypeSyntax
</span><a href="#local-6989586621683067618"><span class="hs-identifier hs-var">syntax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Operator sections
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-type">rnSection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span class="hs-comment">-- See Note [Parsing sections] in GHC.Parser</span><span>
</span><span id="line-709"></span><span class="hs-comment">-- Also see Note [Handling overloaded and rebindable constructs]</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span id="rnSection"><span class="annot"><span class="annottext">rnSection :: HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-var hs-var">rnSection</span></a></span></span><span> </span><span id="local-6989586621683067621"><span class="annot"><span class="annottext">section :: HsExpr GhcPs
</span><a href="#local-6989586621683067621"><span class="hs-identifier hs-var">section</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionR"><span class="hs-identifier hs-type">SectionR</span></a></span><span> </span><span id="local-6989586621683067622"><span class="annot"><span class="annottext">XSectionR GhcPs
</span><a href="#local-6989586621683067622"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067623"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067623"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621683067624"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067624"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-comment">-- See Note [Left and right sections]</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067625"><span class="annot"><a href="#local-6989586621683067625"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067626"><span class="annot"><a href="#local-6989586621683067626"><span class="hs-identifier hs-var">fvs_op</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067623"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-714"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067627"><span class="annot"><a href="#local-6989586621683067627"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067628"><span class="annot"><a href="#local-6989586621683067628"><span class="hs-identifier hs-var">fvs_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067624"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-715"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#checkSectionPrec"><span class="hs-identifier hs-type">checkSectionPrec</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#InfixR"><span class="hs-identifier hs-type">InfixR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067621"><span class="hs-identifier hs-type">section</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067625"><span class="hs-identifier hs-type">op'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067627"><span class="hs-identifier hs-type">expr'</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067631"><span class="annot"><a href="#local-6989586621683067631"><span class="hs-identifier hs-var hs-var">rn_section</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XSectionR GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XSectionR p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#SectionR"><span class="hs-identifier hs-var">SectionR</span></a></span><span> </span><span class="annot"><span class="annottext">XSectionR GhcPs
XSectionR GhcRn
</span><a href="#local-6989586621683067622"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067625"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067627"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-717"></span><span>              </span><span id="local-6989586621683067632"><span class="annot"><a href="#local-6989586621683067632"><span class="hs-identifier hs-var hs-var">ds_section</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApps"><span class="hs-identifier hs-var">genHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Types.Id.Make.html#rightSectionName"><span class="hs-identifier hs-var">rightSectionName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067625"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067627"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-718"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-type">mkExpandedExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067631"><span class="hs-identifier hs-type">rn_section</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067632"><span class="hs-identifier hs-type">ds_section</span></a></span><span>
</span><span id="line-719"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067626"><span class="hs-identifier hs-type">fvs_op</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067628"><span class="hs-identifier hs-type">fvs_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-var">rnSection</span></a></span><span> </span><span id="local-6989586621683067634"><span class="annot"><span class="annottext">section :: HsExpr GhcPs
</span><a href="#local-6989586621683067634"><span class="hs-identifier hs-var">section</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionL"><span class="hs-identifier hs-type">SectionL</span></a></span><span> </span><span id="local-6989586621683067635"><span class="annot"><span class="annottext">XSectionL GhcPs
</span><a href="#local-6989586621683067635"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067636"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067636"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621683067637"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067637"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-comment">-- See Note [Left and right sections]</span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067638"><span class="annot"><a href="#local-6989586621683067638"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067639"><span class="annot"><a href="#local-6989586621683067639"><span class="hs-identifier hs-var">fvs_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067636"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-724"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067640"><span class="annot"><a href="#local-6989586621683067640"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067641"><span class="annot"><a href="#local-6989586621683067641"><span class="hs-identifier hs-var">fvs_op</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067637"><span class="hs-identifier hs-type">op</span></a></span><span>
</span><span id="line-725"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#checkSectionPrec"><span class="hs-identifier hs-type">checkSectionPrec</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#InfixL"><span class="hs-identifier hs-type">InfixL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067634"><span class="hs-identifier hs-type">section</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067640"><span class="hs-identifier hs-type">op'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067638"><span class="hs-identifier hs-type">expr'</span></a></span><span>
</span><span id="line-726"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067642"><span class="annot"><a href="#local-6989586621683067642"><span class="hs-identifier hs-var">postfix_ops</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.PostfixOperators</span></span><span>
</span><span id="line-727"></span><span>                        </span><span class="hs-comment">-- Note [Left and right sections]</span><span>
</span><span id="line-728"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067644"><span class="annot"><a href="#local-6989586621683067644"><span class="hs-identifier hs-var hs-var">rn_section</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XSectionL GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XSectionL p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#SectionL"><span class="hs-identifier hs-var">SectionL</span></a></span><span> </span><span class="annot"><span class="annottext">XSectionL GhcPs
XSectionL GhcRn
</span><a href="#local-6989586621683067635"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067638"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067640"><span class="hs-identifier hs-var">op'</span></a></span><span>
</span><span id="line-729"></span><span>              </span><span id="local-6989586621683067645"><span class="annot"><a href="#local-6989586621683067645"><span class="hs-identifier hs-var hs-var">ds_section</span></a></span></span><span>
</span><span id="line-730"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683067642"><span class="hs-identifier hs-var">postfix_ops</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067640"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067638"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-731"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApps"><span class="hs-identifier hs-var">genHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Types.Id.Make.html#leftSectionName"><span class="hs-identifier hs-var">leftSectionName</span></a></span><span>
</span><span id="line-732"></span><span>                                   </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067640"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683067638"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-type">mkExpandedExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067644"><span class="hs-identifier hs-type">rn_section</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067645"><span class="hs-identifier hs-type">ds_section</span></a></span><span>
</span><span id="line-734"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067641"><span class="hs-identifier hs-type">fvs_op</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067639"><span class="hs-identifier hs-type">fvs_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnSection"><span class="hs-identifier hs-var">rnSection</span></a></span><span> </span><span id="local-6989586621683067647"><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067647"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnSection&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621683067647"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span class="hs-comment">{- Note [Left and right sections]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Dealing with left sections (x *) and right sections (* x) is
surprisingly fiddly.  We expand like this
     (`op` e) ==&gt; rightSection op e
     (e `op`) ==&gt; leftSection  (op e)

Using an auxiliary function in this way avoids the awkwardness of
generating a lambda, esp if `e` is a redex, so we *don't* want
to generate `(\x -&gt; op x e)`. See Historical
Note [Desugaring operator sections]

Here are their definitions:
   leftSection :: forall r1 r2 n (a::TYPE r1) (b::TYPE r2).
                  (a %n-&gt; b) -&gt; a %n-&gt; b
   leftSection f x = f x

   rightSection :: forall r1 r2 r3 n1 n2 (a::TYPE r1) (b::TYPE r2) (c::TYPE r3).
                   (a %n1 -&gt; b %n2-&gt; c) -&gt; b %n2-&gt; a %n1-&gt; c
   rightSection f y x = f x y

Note the wrinkles:

* We do /not/ use lookupSyntaxName, which would make left and right
  section fall under RebindableSyntax.  Reason: it would be a user-
  facing change, and there are some tricky design choices (#19354).
  Plus, infix operator applications would be trickier to make
  rebindable, so it'd be inconsistent to do so for sections.

  TL;DR: we still use the renamer-expansion mechanism for operator
  sections, but only to eliminate special-purpose code paths in the
  renamer and desugarer.

* leftSection and rightSection must be representation-polymorphic, to allow
  (+# 4#) and (4# +#) to work. See
  Note [Wired-in Ids for rebindable syntax] in GHC.Types.Id.Make.

* leftSection and rightSection must be multiplicity-polymorphic.
  (Test linear/should_compile/OldList showed this up.)

* Because they are representation-polymorphic, we have to define them
  as wired-in Ids, with compulsory inlining.  See
  GHC.Types.Id.Make.leftSectionId, rightSectionId.

* leftSection is just ($) really; but unlike ($) it is
  representation-polymorphic in the result type, so we can write
  `(x +#)`, say.

* The type of leftSection must have an arrow in its first argument,
  because (x `ord`) should be rejected, because ord does not take two
  arguments

* It's important that we define leftSection in an eta-expanded way,
  (i.e. not leftSection f = f), so that
      (True `undefined`) `seq` ()
      = (leftSection (undefined True) `seq` ())
  evaluates to () and not undefined

* If PostfixOperators is ON, then we expand a left section like this:
      (e `op`)  ==&gt;   op e
  with no auxiliary function at all.  Simple!

* leftSection and rightSection switch on ImpredicativeTypes locally,
  during Quick Look; see GHC.Tc.Gen.App.wantQuickLook. Consider
  test DeepSubsumption08:
     type Setter st t a b = forall f. Identical f =&gt; blah
     (.~) :: Setter s t a b -&gt; b -&gt; s -&gt; t
     clear :: Setter a a' b (Maybe b') -&gt; a -&gt; a'
     clear = (.~ Nothing)
   The expansion look like (rightSection (.~) Nothing).  So we must
   instantiate `rightSection` first type argument to a polytype!
   Hence the special magic in App.wantQuickLook.

Historical Note [Desugaring operator sections]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This Note explains some historical trickiness in desugaring left and
right sections.  That trickiness has completely disappeared now that
we desugar to calls to 'leftSection` and `rightSection`, but I'm
leaving it here to remind us how nice the new story is.

Desugaring left sections with -XPostfixOperators is straightforward: convert
(expr `op`) to (op expr).

Without -XPostfixOperators it's a bit more tricky. At first it looks as if we
can convert

    (expr `op`)

naively to

    \x -&gt; op expr x

But no!  expr might be a redex, and we can lose laziness badly this
way.  Consider

    map (expr `op`) xs

for example. If expr were a redex then eta-expanding naively would
result in multiple evaluations where the user might only have expected one.

So we convert instead to

    let y = expr in \x -&gt; op y x

Also, note that we must do this for both right and (perhaps surprisingly) left
sections. Why are left sections necessary? Consider the program (found in #18151),

    seq (True `undefined`) ()

according to the Haskell Report this should reduce to () (as it specifies
desugaring via eta expansion). However, if we fail to eta expand we will rather
bottom. Consequently, we must eta expand even in the case of a left section.

If `expr` is actually just a variable, say, then the simplifier
will inline `y`, eliminating the redundant `let`.

Note that this works even in the case that `expr` is unlifted. In this case
bindNonRec will automatically do the right thing, giving us:

    case expr of y -&gt; (\x -&gt; op y x)

See #18151.

Note [Reporting unbound names]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Faced with an out-of-scope `RdrName` there are two courses of action
A. Report an error immediately (and return a HsUnboundVar). This will halt GHC after the renamer is complete
B. Return a HsUnboundVar without reporting an error.  That will allow the typechecker to run, which in turn
   can give a better error message, notably giving the type of the variable via the &quot;typed holes&quot; mechanism.

When `-fdefer-out-of-scope-variables` is on we follow plan B.

When it is not, we follow plan B for unqualified names, and plan A for qualified names.

If a name is qualified, and out of scope, then by default an error will be raised
because the user was already more precise. They specified a specific qualification
and either
  * The qualification didn't exist, so that precision was wrong.
  * Or the qualification existed and the thing we were looking for wasn't where
    the qualification said it would be.

However we can still defer this error completely, and we do defer it if
`-fdefer-out-of-scope-variables` is enabled.

-}</span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Field Labels
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnDotFieldOcc"><span class="hs-identifier hs-type">rnDotFieldOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DotFieldOcc"><span class="hs-identifier hs-type">DotFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DotFieldOcc"><span class="hs-identifier hs-type">DotFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-893"></span><span id="rnDotFieldOcc"><span class="annot"><span class="annottext">rnDotFieldOcc :: DotFieldOcc GhcPs -&gt; DotFieldOcc GhcRn
</span><a href="GHC.Rename.Expr.html#rnDotFieldOcc"><span class="hs-identifier hs-var hs-var">rnDotFieldOcc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DotFieldOcc"><span class="hs-identifier hs-type">DotFieldOcc</span></a></span><span> </span><span id="local-6989586621683067651"><span class="annot"><span class="annottext">XCDotFieldOcc GhcPs
</span><a href="#local-6989586621683067651"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067652"><span class="annot"><span class="annottext">XRec GhcPs FieldLabelString
</span><a href="#local-6989586621683067652"><span class="hs-keyword hs-var">label</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XCDotFieldOcc GhcRn
-&gt; XRec GhcRn FieldLabelString -&gt; DotFieldOcc GhcRn
forall p.
XCDotFieldOcc p -&gt; XRec p FieldLabelString -&gt; DotFieldOcc p
</span><a href="Language.Haskell.Syntax.Expr.html#DotFieldOcc"><span class="hs-identifier hs-var">DotFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">XCDotFieldOcc GhcPs
XCDotFieldOcc GhcRn
</span><a href="#local-6989586621683067651"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcPs FieldLabelString
XRec GhcRn FieldLabelString
</span><a href="#local-6989586621683067652"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnFieldLabelStrings"><span class="hs-identifier hs-type">rnFieldLabelStrings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FieldLabelStrings"><span class="hs-identifier hs-type">FieldLabelStrings</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FieldLabelStrings"><span class="hs-identifier hs-type">FieldLabelStrings</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-896"></span><span id="rnFieldLabelStrings"><span class="annot"><span class="annottext">rnFieldLabelStrings :: FieldLabelStrings GhcPs -&gt; FieldLabelStrings GhcRn
</span><a href="GHC.Rename.Expr.html#rnFieldLabelStrings"><span class="hs-identifier hs-var hs-var">rnFieldLabelStrings</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FieldLabelStrings"><span class="hs-identifier hs-type">FieldLabelStrings</span></a></span><span> </span><span id="local-6989586621683067655"><span class="annot"><span class="annottext">[XRec GhcPs (DotFieldOcc GhcPs)]
</span><a href="#local-6989586621683067655"><span class="hs-identifier hs-var">fls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[XRec GhcRn (DotFieldOcc GhcRn)] -&gt; FieldLabelStrings GhcRn
forall p. [XRec p (DotFieldOcc p)] -&gt; FieldLabelStrings p
</span><a href="Language.Haskell.Syntax.Expr.html#FieldLabelStrings"><span class="hs-identifier hs-var">FieldLabelStrings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcPs)
 -&gt; GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn))
-&gt; [GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcPs)]
-&gt; [GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DotFieldOcc GhcPs -&gt; DotFieldOcc GhcRn)
-&gt; GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcPs)
-&gt; GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn)
forall a b.
(a -&gt; b)
-&gt; GenLocated (EpAnn NoEpAnns) a -&gt; GenLocated (EpAnn NoEpAnns) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DotFieldOcc GhcPs -&gt; DotFieldOcc GhcRn
</span><a href="GHC.Rename.Expr.html#rnDotFieldOcc"><span class="hs-identifier hs-var">rnDotFieldOcc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[XRec GhcPs (DotFieldOcc GhcPs)]
[GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcPs)]
</span><a href="#local-6989586621683067655"><span class="hs-identifier hs-var">fls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Arrow commands
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmdArgs"><span class="hs-identifier hs-type">rnCmdArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmdTop"><span class="hs-identifier hs-type">LHsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmdTop"><span class="hs-identifier hs-type">LHsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span id="rnCmdArgs"><span class="annot"><span class="annottext">rnCmdArgs :: [LHsCmdTop GhcPs] -&gt; RnM ([LHsCmdTop GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#rnCmdArgs"><span class="hs-identifier hs-var hs-var">rnCmdArgs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenLocated (EpAnn NoEpAnns) (HsCmdTop GhcRn)], FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated (EpAnn NoEpAnns) (HsCmdTop GhcRn)], FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmdArgs"><span class="hs-identifier hs-var">rnCmdArgs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067657"><span class="annot"><span class="annottext">LHsCmdTop GhcPs
</span><a href="#local-6989586621683067657"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683067658"><span class="annot"><span class="annottext">[LHsCmdTop GhcPs]
</span><a href="#local-6989586621683067658"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067659"><span class="annot"><a href="#local-6989586621683067659"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067660"><span class="annot"><a href="#local-6989586621683067660"><span class="hs-identifier hs-var">fvArg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcPs -&gt; RnM (LHsCmdTop GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnCmdTop"><span class="hs-identifier hs-var">rnCmdTop</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcPs
</span><a href="#local-6989586621683067657"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-910"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067661"><span class="annot"><a href="#local-6989586621683067661"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067662"><span class="annot"><a href="#local-6989586621683067662"><span class="hs-identifier hs-var">fvArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmdArgs"><span class="hs-identifier hs-type">rnCmdArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067658"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-911"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067659"><span class="hs-identifier hs-type">arg'</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683067661"><span class="hs-identifier hs-type">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067660"><span class="hs-identifier hs-type">fvArg</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067662"><span class="hs-identifier hs-type">fvArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmdTop"><span class="hs-identifier hs-type">rnCmdTop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmdTop"><span class="hs-identifier hs-type">LHsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmdTop"><span class="hs-identifier hs-type">LHsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span id="rnCmdTop"><span class="annot"><span class="annottext">rnCmdTop :: LHsCmdTop GhcPs -&gt; RnM (LHsCmdTop GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnCmdTop"><span class="hs-identifier hs-var hs-var">rnCmdTop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsCmdTop GhcPs -&gt; TcM (HsCmdTop GhcRn, FreeVars))
-&gt; GenLocated (EpAnn NoEpAnns) (HsCmdTop GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated (EpAnn NoEpAnns) (HsCmdTop GhcRn), FreeVars)
forall a b c ann.
(a -&gt; TcM (b, c))
-&gt; GenLocated (EpAnn ann) a -&gt; TcM (GenLocated (EpAnn ann) b, c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocFstMA"><span class="hs-identifier hs-var">wrapLocFstMA</span></a></span><span> </span><span class="annot"><span class="annottext">HsCmdTop GhcPs -&gt; TcM (HsCmdTop GhcRn, FreeVars)
</span><a href="#local-6989586621683067663"><span class="hs-identifier hs-var">rnCmdTop'</span></a></span><span>
</span><span id="line-915"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-916"></span><span>  </span><span class="annot"><a href="#local-6989586621683067663"><span class="hs-identifier hs-type">rnCmdTop'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdTop"><span class="hs-identifier hs-type">HsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdTop"><span class="hs-identifier hs-type">HsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>  </span><span id="local-6989586621683067663"><span class="annot"><span class="annottext">rnCmdTop' :: HsCmdTop GhcPs -&gt; TcM (HsCmdTop GhcRn, FreeVars)
</span><a href="#local-6989586621683067663"><span class="hs-identifier hs-var hs-var">rnCmdTop'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdTop"><span class="hs-identifier hs-type">HsCmdTop</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdTop GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067665"><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067665"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067666"><span class="annot"><a href="#local-6989586621683067666"><span class="hs-identifier hs-var">cmd'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067667"><span class="annot"><a href="#local-6989586621683067667"><span class="hs-identifier hs-var">fvCmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs -&gt; RnM (LHsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-var">rnLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067665"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-919"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067669"><span class="annot"><a href="#local-6989586621683067669"><span class="hs-identifier hs-var hs-var">cmd_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#arrAName"><span class="hs-identifier hs-var">arrAName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#composeAName"><span class="hs-identifier hs-var">composeAName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#firstAName"><span class="hs-identifier hs-var">firstAName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-920"></span><span>                          </span><span class="annot"><span class="annottext">FreeVars -&gt; [Name]
</span><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsCmd GhcRn) -&gt; HsCmd GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsCmd GhcRn)
</span><a href="#local-6989586621683067666"><span class="hs-identifier hs-var">cmd'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>        </span><span class="hs-comment">-- Generate the rebindable syntax for the monad</span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067675"><span class="annot"><a href="#local-6989586621683067675"><span class="hs-identifier hs-var">cmd_names'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067676"><span class="annot"><a href="#local-6989586621683067676"><span class="hs-identifier hs-var">cmd_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxNames"><span class="hs-identifier hs-type">lookupSyntaxNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067669"><span class="hs-identifier hs-type">cmd_names</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdTop"><span class="hs-identifier hs-type">HsCmdTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067669"><span class="hs-identifier hs-type">cmd_names</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`zip`</span></span><span> </span><span class="annot"><a href="#local-6989586621683067675"><span class="hs-identifier hs-type">cmd_names'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067666"><span class="hs-identifier hs-type">cmd'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-925"></span><span>                  </span><span class="annot"><a href="#local-6989586621683067667"><span class="hs-identifier hs-type">fvCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067676"><span class="hs-identifier hs-type">cmd_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-type">rnLCmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span id="rnLCmd"><span class="annot"><span class="annottext">rnLCmd :: LHsCmd GhcPs -&gt; RnM (LHsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-var hs-var">rnLCmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsCmd GhcPs -&gt; TcM (HsCmd GhcRn, FreeVars))
-&gt; GenLocated SrcSpanAnnA (HsCmd GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsCmd GhcRn), FreeVars)
forall a b c ann.
(a -&gt; TcM (b, c))
-&gt; GenLocated (EpAnn ann) a -&gt; TcM (GenLocated (EpAnn ann) b, c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocFstMA"><span class="hs-identifier hs-var">wrapLocFstMA</span></a></span><span> </span><span class="annot"><span class="annottext">HsCmd GhcPs -&gt; TcM (HsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-type">rnCmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmd"><span class="hs-identifier hs-type">HsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmd"><span class="hs-identifier hs-type">HsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span id="rnCmd"><span class="annot"><span class="annottext">rnCmd :: HsCmd GhcPs -&gt; TcM (HsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var hs-var">rnCmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrApp"><span class="hs-identifier hs-type">HsCmdArrApp</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrApp GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067680"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067680"><span class="hs-identifier hs-var">arrow</span></a></span></span><span> </span><span id="local-6989586621683067681"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067681"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683067682"><span class="annot"><span class="annottext">HsArrAppType
</span><a href="#local-6989586621683067682"><span class="hs-identifier hs-var">ho</span></a></span></span><span> </span><span id="local-6989586621683067683"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683067683"><span class="hs-identifier hs-var">rtl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067684"><span class="annot"><a href="#local-6989586621683067684"><span class="hs-identifier hs-var">arrow'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067685"><span class="annot"><a href="#local-6989586621683067685"><span class="hs-identifier hs-var">fvArrow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="#local-6989586621683067686"><span class="hs-identifier hs-var">select_arrow_scope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067680"><span class="hs-identifier hs-var">arrow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067687"><span class="annot"><a href="#local-6989586621683067687"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067688"><span class="annot"><a href="#local-6989586621683067688"><span class="hs-identifier hs-var">fvArg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067681"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-935"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrApp"><span class="hs-identifier hs-type">HsCmdArrApp</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067684"><span class="hs-identifier hs-type">arrow'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067687"><span class="hs-identifier hs-type">arg'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067682"><span class="hs-identifier hs-type">ho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067683"><span class="hs-identifier hs-type">rtl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-936"></span><span>                 </span><span class="annot"><a href="#local-6989586621683067685"><span class="hs-identifier hs-type">fvArrow</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067688"><span class="hs-identifier hs-type">fvArg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-937"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-938"></span><span>    </span><span id="local-6989586621683067686"><span class="annot"><span class="annottext">select_arrow_scope :: IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="#local-6989586621683067686"><span class="hs-identifier hs-var hs-var">select_arrow_scope</span></a></span></span><span> </span><span id="local-6989586621683067689"><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="#local-6989586621683067689"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsArrAppType
</span><a href="#local-6989586621683067682"><span class="hs-identifier hs-var">ho</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-939"></span><span>        </span><span class="annot"><span class="annottext">HsArrAppType
</span><a href="Language.Haskell.Syntax.Expr.html#HsHigherOrderApp"><span class="hs-identifier hs-var">HsHigherOrderApp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="#local-6989586621683067689"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-940"></span><span>        </span><span class="annot"><span class="annottext">HsArrAppType
</span><a href="Language.Haskell.Syntax.Expr.html#HsFirstOrderApp"><span class="hs-identifier hs-var">HsFirstOrderApp</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier hs-var">escapeArrowScope</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="#local-6989586621683067689"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-941"></span><span>        </span><span class="hs-comment">-- See Note [Escaping the arrow scope] in GHC.Tc.Types</span><span>
</span><span id="line-942"></span><span>        </span><span class="hs-comment">-- Before renaming 'arrow', use the environment of the enclosing</span><span>
</span><span id="line-943"></span><span>        </span><span class="hs-comment">-- proc for the (-&lt;) case.</span><span>
</span><span id="line-944"></span><span>        </span><span class="hs-comment">-- Local bindings, inside the enclosing proc, are not in scope</span><span>
</span><span id="line-945"></span><span>        </span><span class="hs-comment">-- inside 'arrow'.  In the higher-order case (-&lt;&lt;), they are.</span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrForm"><span class="hs-identifier hs-type">HsCmdArrForm</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrForm GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067694"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067694"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621683067695"><span class="annot"><span class="annottext">LexicalFixity
</span><a href="#local-6989586621683067695"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683067696"><span class="annot"><span class="annottext">[LHsCmdTop GhcPs]
</span><a href="#local-6989586621683067696"><span class="hs-identifier hs-var">cmds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067697"><span class="annot"><a href="#local-6989586621683067697"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067698"><span class="annot"><a href="#local-6989586621683067698"><span class="hs-identifier hs-var">fvOp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier hs-var">escapeArrowScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067694"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067699"><span class="annot"><a href="#local-6989586621683067699"><span class="hs-identifier hs-var">cmds'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067700"><span class="annot"><a href="#local-6989586621683067700"><span class="hs-identifier hs-var">fvCmds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmdArgs"><span class="hs-identifier hs-type">rnCmdArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067696"><span class="hs-identifier hs-type">cmds</span></a></span><span>
</span><span id="line-950"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrForm"><span class="hs-identifier hs-type">HsCmdArrForm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621683067697"><span class="hs-identifier hs-type">op'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067695"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067699"><span class="hs-identifier hs-type">cmds'</span></a></span><span>
</span><span id="line-951"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067698"><span class="hs-identifier hs-type">fvOp</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067700"><span class="hs-identifier hs-type">fvCmds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdApp"><span class="hs-identifier hs-type">HsCmdApp</span></a></span><span> </span><span id="local-6989586621683067702"><span class="annot"><span class="annottext">XCmdApp GhcPs
</span><a href="#local-6989586621683067702"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067703"><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067703"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683067704"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067704"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067705"><span class="annot"><a href="#local-6989586621683067705"><span class="hs-identifier hs-var">fun'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067706"><span class="annot"><a href="#local-6989586621683067706"><span class="hs-identifier hs-var">fvFun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs -&gt; RnM (LHsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-var">rnLCmd</span></a></span><span>  </span><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067703"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-955"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067707"><span class="annot"><a href="#local-6989586621683067707"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067708"><span class="annot"><a href="#local-6989586621683067708"><span class="hs-identifier hs-var">fvArg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067704"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-956"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdApp"><span class="hs-identifier hs-type">HsCmdApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067702"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067705"><span class="hs-identifier hs-type">fun'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067707"><span class="hs-identifier hs-type">arg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067706"><span class="hs-identifier hs-type">fvFun</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067708"><span class="hs-identifier hs-type">fvArg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLam"><span class="hs-identifier hs-type">HsCmdLam</span></a></span><span> </span><span id="local-6989586621683067710"><span class="annot"><span class="annottext">XCmdLamCase GhcPs
</span><a href="#local-6989586621683067710"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683067711"><span class="annot"><span class="annottext">HsLamVariant
</span><a href="#local-6989586621683067711"><span class="hs-identifier hs-var">lam_variant</span></a></span></span><span> </span><span id="local-6989586621683067712"><span class="annot"><span class="annottext">MatchGroup GhcPs (LHsCmd GhcPs)
</span><a href="#local-6989586621683067712"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067713"><span class="annot"><span class="annottext">ctxt :: HsMatchContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621683067713"><span class="hs-identifier hs-var hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsArrowMatchContext -&gt; HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. HsArrowMatchContext -&gt; HsMatchContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-var">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">(HsArrowMatchContext
 -&gt; HsMatchContext (GenLocated SrcSpanAnnN Name))
-&gt; HsArrowMatchContext
-&gt; HsMatchContext (GenLocated SrcSpanAnnN Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsLamVariant -&gt; HsArrowMatchContext
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowLamAlt"><span class="hs-identifier hs-var">ArrowLamAlt</span></a></span><span> </span><span class="annot"><span class="annottext">HsLamVariant
</span><a href="#local-6989586621683067711"><span class="hs-identifier hs-var">lam_variant</span></a></span><span>
</span><span id="line-960"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067715"><span class="annot"><a href="#local-6989586621683067715"><span class="hs-identifier hs-var">new_matches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067716"><span class="annot"><a href="#local-6989586621683067716"><span class="hs-identifier hs-var">ms_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; (GenLocated SrcSpanAnnA (HsCmd GhcPs)
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (GenLocated SrcSpanAnnA (HsCmd GhcRn), FreeVars))
-&gt; MatchGroup GhcPs (GenLocated SrcSpanAnnA (HsCmd GhcPs))
-&gt; RnM
     (MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)), FreeVars)
forall (body :: * -&gt; *).
(Outputable (body GhcPs), AnnoBody body) =&gt;
HsMatchContextRn
-&gt; (LocatedA (body GhcPs) -&gt; RnM (LocatedA (body GhcRn), FreeVars))
-&gt; MatchGroup GhcPs (LocatedA (body GhcPs))
-&gt; RnM (MatchGroup GhcRn (LocatedA (body GhcRn)), FreeVars)
</span><a href="GHC.Rename.Bind.html#rnMatchGroup"><span class="hs-identifier hs-var">rnMatchGroup</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621683067713"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs -&gt; RnM (LHsCmd GhcRn, FreeVars)
GenLocated SrcSpanAnnA (HsCmd GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsCmd GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-var">rnLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcPs (LHsCmd GhcPs)
MatchGroup GhcPs (GenLocated SrcSpanAnnA (HsCmd GhcPs))
</span><a href="#local-6989586621683067712"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-961"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLam"><span class="hs-identifier hs-type">HsCmdLam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067710"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067711"><span class="hs-identifier hs-type">lam_variant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067715"><span class="hs-identifier hs-type">new_matches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067716"><span class="hs-identifier hs-type">ms_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdPar"><span class="hs-identifier hs-type">HsCmdPar</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdPar GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067718"><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067718"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067719"><span class="annot"><a href="#local-6989586621683067719"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067720"><span class="annot"><a href="#local-6989586621683067720"><span class="hs-identifier hs-var">fvs_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs -&gt; RnM (LHsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-var">rnLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067718"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdPar"><span class="hs-identifier hs-type">HsCmdPar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067719"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067720"><span class="hs-identifier hs-type">fvs_e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdCase"><span class="hs-identifier hs-type">HsCmdCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdCase GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067722"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067722"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621683067723"><span class="annot"><span class="annottext">MatchGroup GhcPs (LHsCmd GhcPs)
</span><a href="#local-6989586621683067723"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067724"><span class="annot"><a href="#local-6989586621683067724"><span class="hs-identifier hs-var">new_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067725"><span class="annot"><a href="#local-6989586621683067725"><span class="hs-identifier hs-var">e_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067722"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-969"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067726"><span class="annot"><a href="#local-6989586621683067726"><span class="hs-identifier hs-var">new_matches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067727"><span class="annot"><a href="#local-6989586621683067727"><span class="hs-identifier hs-var">ms_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rnMatchGroup"><span class="hs-identifier hs-type">rnMatchGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-type">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArrowCaseAlt"><span class="hs-identifier hs-type">ArrowCaseAlt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-type">rnLCmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067723"><span class="hs-identifier hs-type">matches</span></a></span><span>
</span><span id="line-970"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdCase"><span class="hs-identifier hs-type">HsCmdCase</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067724"><span class="hs-identifier hs-type">new_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067726"><span class="hs-identifier hs-type">new_matches</span></a></span><span>
</span><span id="line-971"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067725"><span class="hs-identifier hs-type">e_fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067727"><span class="hs-identifier hs-type">ms_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-972"></span><span>
</span><span id="line-973"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdIf"><span class="hs-identifier hs-type">HsCmdIf</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdIf GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067730"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067730"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683067731"><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067731"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621683067732"><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067732"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067733"><span class="annot"><a href="#local-6989586621683067733"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067734"><span class="annot"><a href="#local-6989586621683067734"><span class="hs-identifier hs-var">fvP</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067730"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-975"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067735"><span class="annot"><a href="#local-6989586621683067735"><span class="hs-identifier hs-var">b1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067736"><span class="annot"><a href="#local-6989586621683067736"><span class="hs-identifier hs-var">fvB1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-type">rnLCmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067731"><span class="hs-identifier hs-type">b1</span></a></span><span>
</span><span id="line-976"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067737"><span class="annot"><a href="#local-6989586621683067737"><span class="hs-identifier hs-var">b2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067738"><span class="annot"><a href="#local-6989586621683067738"><span class="hs-identifier hs-var">fvB2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-type">rnLCmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067732"><span class="hs-identifier hs-type">b2</span></a></span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067739"><span class="annot"><a href="#local-6989586621683067739"><span class="hs-identifier hs-var">mb_ite</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupIfThenElse"><span class="hs-identifier hs-type">lookupIfThenElse</span></a></span><span>
</span><span id="line-979"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067741"><span class="annot"><a href="#local-6989586621683067741"><span class="hs-identifier hs-var">ite</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067742"><span class="annot"><a href="#local-6989586621683067742"><span class="hs-identifier hs-var">fvITE</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683067739"><span class="hs-identifier hs-type">mb_ite</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-980"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683067743"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067743"><span class="hs-identifier hs-var">ite_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067743"><span class="hs-identifier hs-var">ite_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683067743"><span class="hs-identifier hs-var">ite_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>                </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#NoSyntaxExprRn"><span class="hs-identifier hs-var">NoSyntaxExprRn</span></a></span><span class="hs-special">,</span><span>          </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdIf"><span class="hs-identifier hs-type">HsCmdIf</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067741"><span class="hs-identifier hs-type">ite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067733"><span class="hs-identifier hs-type">p'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067735"><span class="hs-identifier hs-type">b1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067737"><span class="hs-identifier hs-type">b2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683067742"><span class="hs-identifier hs-type">fvITE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067734"><span class="hs-identifier hs-type">fvP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067736"><span class="hs-identifier hs-type">fvB1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067738"><span class="hs-identifier hs-type">fvB2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLet"><span class="hs-identifier hs-type">HsCmdLet</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdLet GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067747"><span class="annot"><span class="annottext">HsLocalBinds GhcPs
</span><a href="#local-6989586621683067747"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621683067748"><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067748"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
-&gt; (HsLocalBinds GhcRn -&gt; FreeVars -&gt; TcM (HsCmd GhcRn, FreeVars))
-&gt; TcM (HsCmd GhcRn, FreeVars)
forall result.
HsLocalBinds GhcPs
-&gt; (HsLocalBinds GhcRn -&gt; FreeVars -&gt; RnM (result, FreeVars))
-&gt; RnM (result, FreeVars)
</span><a href="GHC.Rename.Bind.html#rnLocalBindsAndThen"><span class="hs-identifier hs-var">rnLocalBindsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
</span><a href="#local-6989586621683067747"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">((HsLocalBinds GhcRn -&gt; FreeVars -&gt; TcM (HsCmd GhcRn, FreeVars))
 -&gt; TcM (HsCmd GhcRn, FreeVars))
-&gt; (HsLocalBinds GhcRn -&gt; FreeVars -&gt; TcM (HsCmd GhcRn, FreeVars))
-&gt; TcM (HsCmd GhcRn, FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683067749"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621683067749"><span class="hs-identifier hs-var">binds'</span></a></span></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-987"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067750"><span class="annot"><a href="#local-6989586621683067750"><span class="hs-identifier hs-var">cmd'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683067751"><span class="annot"><a href="#local-6989586621683067751"><span class="hs-identifier hs-var">fvExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs -&gt; RnM (LHsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLCmd"><span class="hs-identifier hs-var">rnLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcPs
</span><a href="#local-6989586621683067748"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-988"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLet"><span class="hs-identifier hs-type">HsCmdLet</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067749"><span class="hs-identifier hs-type">binds'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067750"><span class="hs-identifier hs-type">cmd'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067751"><span class="hs-identifier hs-type">fvExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdDo"><span class="hs-identifier hs-type">HsCmdDo</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdDo GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067753"><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><a href="#local-6989586621683067753"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683067754"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsCmd GhcPs)))]
</span><a href="#local-6989586621683067754"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683067755"><span class="annot"><a href="#local-6989586621683067755"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067756"><span class="annot"><a href="#local-6989586621683067756"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-992"></span><span>            </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (HsCmd GhcPs -&gt; TcM (HsCmd GhcRn, FreeVars))
-&gt; [LStmt GhcPs (GenLocated SrcSpanAnnA (HsCmd GhcPs))]
-&gt; ([Name] -&gt; RnM ((), FreeVars))
-&gt; RnM
     (([LStmt GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn))], ()),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM (([LStmt GhcRn (LocatedA (body GhcRn))], thing), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmts"><span class="hs-identifier hs-var">rnStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowExpr"><span class="hs-identifier hs-var">ArrowExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsCmd GhcPs -&gt; TcM (HsCmd GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnCmd"><span class="hs-identifier hs-var">rnCmd</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (GenLocated SrcSpanAnnA (HsCmd GhcPs))]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsCmd GhcPs)))]
</span><a href="#local-6989586621683067754"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((), FreeVars) -&gt; RnM ((), FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdDo"><span class="hs-identifier hs-type">HsCmdDo</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067753"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067755"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067756"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-996"></span><span class="hs-keyword">type</span><span> </span><span id="CmdNeeds"><span class="annot"><a href="GHC.Rename.Expr.html#CmdNeeds"><span class="hs-identifier hs-var">CmdNeeds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>        </span><span class="hs-comment">-- Only inhabitants are</span><span>
</span><span id="line-997"></span><span>                                </span><span class="hs-comment">--      appAName, choiceAName, loopAName</span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span class="hs-comment">-- find what methods the Cmd needs (loop, choice, apply)</span><span>
</span><span id="line-1000"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-type">methodNamesLCmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#CmdNeeds"><span class="hs-identifier hs-type">CmdNeeds</span></a></span><span>
</span><span id="line-1001"></span><span id="methodNamesLCmd"><span class="annot"><span class="annottext">methodNamesLCmd :: LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var hs-var">methodNamesLCmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="annot"><span class="annottext">(HsCmd GhcRn -&gt; FreeVars)
-&gt; (GenLocated SrcSpanAnnA (HsCmd GhcRn) -&gt; HsCmd GhcRn)
-&gt; GenLocated SrcSpanAnnA (HsCmd GhcRn)
-&gt; FreeVars
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsCmd GhcRn) -&gt; HsCmd GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-type">methodNamesCmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmd"><span class="hs-identifier hs-type">HsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#CmdNeeds"><span class="hs-identifier hs-type">CmdNeeds</span></a></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span id="methodNamesCmd"><span class="annot"><span class="annottext">methodNamesCmd :: HsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var hs-var">methodNamesCmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrApp"><span class="hs-identifier hs-type">HsCmdArrApp</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrApp GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067760"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683067760"><span class="hs-identifier hs-var">_arrow</span></a></span></span><span> </span><span id="local-6989586621683067761"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683067761"><span class="hs-identifier hs-var">_arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsArrAppType
</span><a href="Language.Haskell.Syntax.Expr.html#HsFirstOrderApp"><span class="hs-identifier hs-var">HsFirstOrderApp</span></a></span><span> </span><span id="local-6989586621683067762"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683067762"><span class="hs-identifier hs-var">_rtl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span>
</span><span id="line-1007"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrApp"><span class="hs-identifier hs-type">HsCmdArrApp</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrApp GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067763"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683067763"><span class="hs-identifier hs-var">_arrow</span></a></span></span><span> </span><span id="local-6989586621683067764"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683067764"><span class="hs-identifier hs-var">_arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsArrAppType
</span><a href="Language.Haskell.Syntax.Expr.html#HsHigherOrderApp"><span class="hs-identifier hs-var">HsHigherOrderApp</span></a></span><span> </span><span id="local-6989586621683067765"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683067765"><span class="hs-identifier hs-var">_rtl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#appAName"><span class="hs-identifier hs-var">appAName</span></a></span><span>
</span><span id="line-1009"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrForm"><span class="hs-identifier hs-type">HsCmdArrForm</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span>
</span><span id="line-1010"></span><span>
</span><span id="line-1011"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdPar"><span class="hs-identifier hs-type">HsCmdPar</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdPar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067767"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067767"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067767"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdIf"><span class="hs-identifier hs-type">HsCmdIf</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdIf GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067768"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067768"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621683067769"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067769"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067768"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067769"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#addOneFV"><span class="hs-operator hs-var">`addOneFV`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#choiceAName"><span class="hs-identifier hs-var">choiceAName</span></a></span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLet"><span class="hs-identifier hs-type">HsCmdLet</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdLet GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067771"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067771"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067771"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1017"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdDo"><span class="hs-identifier hs-type">HsCmdDo</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdDo GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067772"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067772"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CmdLStmt GhcRn] -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesStmts"><span class="hs-identifier hs-var">methodNamesStmts</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067772"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-1018"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdApp"><span class="hs-identifier hs-type">HsCmdApp</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdApp GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067774"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067774"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067774"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdCase"><span class="hs-identifier hs-type">HsCmdCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdCase GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067775"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn)
</span><a href="#local-6989586621683067775"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesMatch"><span class="hs-identifier hs-var">methodNamesMatch</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn)
</span><a href="#local-6989586621683067775"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#addOneFV"><span class="hs-operator hs-var">`addOneFV`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#choiceAName"><span class="hs-identifier hs-var">choiceAName</span></a></span><span>
</span><span id="line-1021"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLam"><span class="hs-identifier hs-type">HsCmdLam</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdLamCase GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsLamVariant
</span><a href="Language.Haskell.Syntax.Expr.html#LamSingle"><span class="hs-identifier hs-var">LamSingle</span></a></span><span> </span><span id="local-6989586621683067778"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn)
</span><a href="#local-6989586621683067778"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesMatch"><span class="hs-identifier hs-var">methodNamesMatch</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn)
</span><a href="#local-6989586621683067778"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-1022"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesCmd"><span class="hs-identifier hs-var">methodNamesCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLam"><span class="hs-identifier hs-type">HsCmdLam</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdLamCase GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsLamVariant
</span><span class="hs-identifier">_</span></span><span>         </span><span id="local-6989586621683067779"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn)
</span><a href="#local-6989586621683067779"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesMatch"><span class="hs-identifier hs-var">methodNamesMatch</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsCmd GhcRn)
</span><a href="#local-6989586621683067779"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#addOneFV"><span class="hs-operator hs-var">`addOneFV`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#choiceAName"><span class="hs-identifier hs-var">choiceAName</span></a></span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span class="hs-comment">--methodNamesCmd _ = emptyFVs</span><span>
</span><span id="line-1025"></span><span>   </span><span class="hs-comment">-- Other forms can't occur in commands, but it's not convenient</span><span>
</span><span id="line-1026"></span><span>   </span><span class="hs-comment">-- to error here so we just do what's convenient.</span><span>
</span><span id="line-1027"></span><span>   </span><span class="hs-comment">-- The type checker will complain later</span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-1030"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesMatch"><span class="hs-identifier hs-type">methodNamesMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>
</span><span id="line-1031"></span><span id="methodNamesMatch"><span class="annot"><span class="annottext">methodNamesMatch :: MatchGroup GhcRn (LHsCmd GhcRn) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesMatch"><span class="hs-identifier hs-var hs-var">methodNamesMatch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067782"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067782"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1032"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
 -&gt; FreeVars)
-&gt; [GenLocated
      SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
-&gt; [FreeVars]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; FreeVars
forall {l}.
GenLocated l (Match GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; FreeVars
</span><a href="#local-6989586621683067783"><span class="hs-identifier hs-var">do_one</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067782"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1033"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1034"></span><span>    </span><span id="local-6989586621683067783"><span class="annot"><span class="annottext">do_one :: GenLocated l (Match GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; FreeVars
</span><a href="#local-6989586621683067783"><span class="hs-identifier hs-var hs-var">do_one</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_grhss :: forall p body. Match p body -&gt; GRHSs p body
</span><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683067786"><span class="annot"><span class="annottext">GRHSs GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn))
</span><a href="#local-6989586621683067786"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsCmd GhcRn) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesGRHSs"><span class="hs-identifier hs-var">methodNamesGRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsCmd GhcRn)
GRHSs GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn))
</span><a href="#local-6989586621683067786"><span class="hs-identifier hs-var">grhss</span></a></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span class="hs-comment">-------------------------------------------------</span><span>
</span><span id="line-1037"></span><span class="hs-comment">-- gaw 2004</span><span>
</span><span id="line-1038"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesGRHSs"><span class="hs-identifier hs-type">methodNamesGRHSs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>
</span><span id="line-1039"></span><span id="methodNamesGRHSs"><span class="annot"><span class="annottext">methodNamesGRHSs :: GRHSs GhcRn (LHsCmd GhcRn) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesGRHSs"><span class="hs-identifier hs-var hs-var">methodNamesGRHSs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHSs GhcRn (LHsCmd GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067789"><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsCmd GhcRn)]
</span><a href="#local-6989586621683067789"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocatedAn
   NoEpAnns (GRHS GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
 -&gt; FreeVars)
-&gt; [LocatedAn
      NoEpAnns (GRHS GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
-&gt; [FreeVars]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LocatedAn NoEpAnns (GRHS GhcRn (LHsCmd GhcRn)) -&gt; FreeVars
LocatedAn
  NoEpAnns (GRHS GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesGRHS"><span class="hs-identifier hs-var">methodNamesGRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsCmd GhcRn)]
[LocatedAn
   NoEpAnns (GRHS GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067789"><span class="hs-identifier hs-var">grhss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span class="hs-comment">-------------------------------------------------</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesGRHS"><span class="hs-identifier hs-type">methodNamesGRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedAn"><span class="hs-identifier hs-type">LocatedAn</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#NoEpAnns"><span class="hs-identifier hs-type">NoEpAnns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#CmdNeeds"><span class="hs-identifier hs-type">CmdNeeds</span></a></span><span>
</span><span id="line-1044"></span><span id="methodNamesGRHS"><span class="annot"><span class="annottext">methodNamesGRHS :: LocatedAn NoEpAnns (GRHS GhcRn (LHsCmd GhcRn)) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesGRHS"><span class="hs-identifier hs-var hs-var">methodNamesGRHS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn NoEpAnns
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHS GhcRn (LHsCmd GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067792"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067792"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067792"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-1047"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmts"><span class="hs-identifier hs-type">methodNamesStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmtLR"><span class="hs-identifier hs-type">LStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>
</span><span id="line-1048"></span><span id="methodNamesStmts"><span class="annot"><span class="annottext">methodNamesStmts :: [CmdLStmt GhcRn] -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesStmts"><span class="hs-identifier hs-var hs-var">methodNamesStmts</span></a></span></span><span> </span><span id="local-6989586621683067793"><span class="annot"><span class="annottext">[CmdLStmt GhcRn]
</span><a href="#local-6989586621683067793"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
 -&gt; FreeVars)
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
-&gt; [FreeVars]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CmdLStmt GhcRn -&gt; FreeVars
GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLStmt"><span class="hs-identifier hs-var">methodNamesLStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067793"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-1051"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesLStmt"><span class="hs-identifier hs-type">methodNamesLStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmtLR"><span class="hs-identifier hs-type">LStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>
</span><span id="line-1052"></span><span id="methodNamesLStmt"><span class="annot"><span class="annottext">methodNamesLStmt :: CmdLStmt GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLStmt"><span class="hs-identifier hs-var hs-var">methodNamesLStmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StmtLR GhcRn GhcRn (LHsCmd GhcRn) -&gt; FreeVars
StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn))
-&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn))
 -&gt; FreeVars)
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
    -&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; FreeVars
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-type">methodNamesStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtLR"><span class="hs-identifier hs-type">StmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>
</span><span id="line-1055"></span><span id="methodNamesStmt"><span class="annot"><span class="annottext">methodNamesStmt :: StmtLR GhcRn GhcRn (LHsCmd GhcRn) -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var hs-var">methodNamesStmt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt GhcRn GhcRn (LHsCmd GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067797"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067797"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067797"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-1056"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcRn (LHsCmd GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067799"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067799"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067799"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-1057"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (LHsCmd GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067801"><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067801"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesLCmd"><span class="hs-identifier hs-var">methodNamesLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd GhcRn
</span><a href="#local-6989586621683067801"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-1058"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recS_stmts :: forall idL idR body.
StmtLR idL idR body -&gt; XRec idR [LStmtLR idL idR body]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067804"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067804"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1059"></span><span>  </span><span class="annot"><span class="annottext">[CmdLStmt GhcRn] -&gt; FreeVars
</span><a href="GHC.Rename.Expr.html#methodNamesStmts"><span class="hs-identifier hs-var">methodNamesStmts</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsCmd GhcRn)))]
</span><a href="#local-6989586621683067804"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#addOneFV"><span class="hs-operator hs-var">`addOneFV`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#loopAName"><span class="hs-identifier hs-var">loopAName</span></a></span><span>
</span><span id="line-1060"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span>
</span><span id="line-1061"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span>
</span><span id="line-1062"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span>
</span><span id="line-1063"></span><span class="annot"><a href="GHC.Rename.Expr.html#methodNamesStmt"><span class="hs-identifier hs-var">methodNamesStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XStmtLR"><span class="hs-identifier hs-type">XStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeStmt"><span class="hs-identifier hs-type">ApplicativeStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span>
</span><span id="line-1064"></span><span>   </span><span class="hs-comment">-- ParStmt and TransStmt can't occur in commands, but it's not</span><span>
</span><span id="line-1065"></span><span>   </span><span class="hs-comment">-- convenient to error here so we just do what's convenient</span><span>
</span><span id="line-1066"></span><span>
</span><span id="line-1067"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Arithmetic sequences
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnArithSeq"><span class="hs-identifier hs-type">rnArithSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeqInfo"><span class="hs-identifier hs-type">ArithSeqInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeqInfo"><span class="hs-identifier hs-type">ArithSeqInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1076"></span><span id="rnArithSeq"><span class="annot"><span class="annottext">rnArithSeq :: ArithSeqInfo GhcPs -&gt; RnM (ArithSeqInfo GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnArithSeq"><span class="hs-identifier hs-var hs-var">rnArithSeq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#From"><span class="hs-identifier hs-type">From</span></a></span><span> </span><span id="local-6989586621683067812"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067812"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067813"><span class="annot"><a href="#local-6989586621683067813"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067814"><span class="annot"><a href="#local-6989586621683067814"><span class="hs-identifier hs-var">fvExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067812"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1078"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#From"><span class="hs-identifier hs-type">From</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067813"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067814"><span class="hs-identifier hs-type">fvExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnArithSeq"><span class="hs-identifier hs-var">rnArithSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThen"><span class="hs-identifier hs-type">FromThen</span></a></span><span> </span><span id="local-6989586621683067816"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067816"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621683067817"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067817"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067818"><span class="annot"><a href="#local-6989586621683067818"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067819"><span class="annot"><a href="#local-6989586621683067819"><span class="hs-identifier hs-var">fvExpr1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067816"><span class="hs-identifier hs-var">expr1</span></a></span><span>
</span><span id="line-1082"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067820"><span class="annot"><a href="#local-6989586621683067820"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067821"><span class="annot"><a href="#local-6989586621683067821"><span class="hs-identifier hs-var">fvExpr2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067817"><span class="hs-identifier hs-type">expr2</span></a></span><span>
</span><span id="line-1083"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThen"><span class="hs-identifier hs-type">FromThen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067818"><span class="hs-identifier hs-type">expr1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067820"><span class="hs-identifier hs-type">expr2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067819"><span class="hs-identifier hs-type">fvExpr1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067821"><span class="hs-identifier hs-type">fvExpr2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnArithSeq"><span class="hs-identifier hs-var">rnArithSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromTo"><span class="hs-identifier hs-type">FromTo</span></a></span><span> </span><span id="local-6989586621683067823"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067823"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621683067824"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067824"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067825"><span class="annot"><a href="#local-6989586621683067825"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067826"><span class="annot"><a href="#local-6989586621683067826"><span class="hs-identifier hs-var">fvExpr1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067823"><span class="hs-identifier hs-var">expr1</span></a></span><span>
</span><span id="line-1087"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067827"><span class="annot"><a href="#local-6989586621683067827"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067828"><span class="annot"><a href="#local-6989586621683067828"><span class="hs-identifier hs-var">fvExpr2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067824"><span class="hs-identifier hs-type">expr2</span></a></span><span>
</span><span id="line-1088"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromTo"><span class="hs-identifier hs-type">FromTo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067825"><span class="hs-identifier hs-type">expr1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067827"><span class="hs-identifier hs-type">expr2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067826"><span class="hs-identifier hs-type">fvExpr1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067828"><span class="hs-identifier hs-type">fvExpr2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnArithSeq"><span class="hs-identifier hs-var">rnArithSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThenTo"><span class="hs-identifier hs-type">FromThenTo</span></a></span><span> </span><span id="local-6989586621683067830"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067830"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621683067831"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067831"><span class="hs-identifier hs-var">expr2</span></a></span></span><span> </span><span id="local-6989586621683067832"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067832"><span class="hs-identifier hs-var">expr3</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067833"><span class="annot"><a href="#local-6989586621683067833"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067834"><span class="annot"><a href="#local-6989586621683067834"><span class="hs-identifier hs-var">fvExpr1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683067830"><span class="hs-identifier hs-var">expr1</span></a></span><span>
</span><span id="line-1092"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067835"><span class="annot"><a href="#local-6989586621683067835"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067836"><span class="annot"><a href="#local-6989586621683067836"><span class="hs-identifier hs-var">fvExpr2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067831"><span class="hs-identifier hs-type">expr2</span></a></span><span>
</span><span id="line-1093"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067837"><span class="annot"><a href="#local-6989586621683067837"><span class="hs-identifier hs-var">expr3'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067838"><span class="annot"><a href="#local-6989586621683067838"><span class="hs-identifier hs-var">fvExpr3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067832"><span class="hs-identifier hs-type">expr3</span></a></span><span>
</span><span id="line-1094"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThenTo"><span class="hs-identifier hs-type">FromThenTo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067833"><span class="hs-identifier hs-type">expr1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067835"><span class="hs-identifier hs-type">expr2'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067837"><span class="hs-identifier hs-type">expr3'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1095"></span><span>                </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683067834"><span class="hs-identifier hs-type">fvExpr1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067836"><span class="hs-identifier hs-type">fvExpr2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067838"><span class="hs-identifier hs-type">fvExpr3</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{@Stmt@s: in @do@ expressions}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span class="hs-comment">{-
Note [Deterministic ApplicativeDo and RecursiveDo desugaring]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Both ApplicativeDo and RecursiveDo need to create tuples not
present in the source text.

For ApplicativeDo we create:

  (a,b,c) &lt;- (\c b a -&gt; (a,b,c)) &lt;$&gt;

For RecursiveDo we create:

  mfix (\ ~(a,b,c) -&gt; do ...; return (a',b',c'))

The order of the components in those tuples needs to be stable
across recompilations, otherwise they can get optimized differently
and we end up with incompatible binaries.
To get a stable order we use nameSetElemsStable.
See Note [Deterministic UniqFM] to learn more about nondeterminism.
-}</span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span class="hs-keyword">type</span><span> </span><span id="AnnoBody"><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-var">AnnoBody</span></a></span></span><span> </span><span id="local-6989586621683067839"><span class="annot"><a href="#local-6989586621683067839"><span class="hs-identifier hs-type">body</span></a></span></span><span>
</span><span id="line-1127"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067839"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="annot"><span class="hs-comment">-- | Rename some Stmts</span></span><span>
</span><span id="line-1131"></span><span id="local-6989586621683066229"><span id="local-6989586621683066230"><span class="annot"><a href="GHC.Rename.Expr.html#rnStmts"><span class="hs-identifier hs-type">rnStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066229"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-1132"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1133"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066229"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066229"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ How to rename the body of each statement (e.g. rnLExpr)</span></span><span>
</span><span id="line-1135"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066229"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1136"></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Statements</span></span><span>
</span><span id="line-1137"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066230"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>           </span><span class="hs-comment">-- ^ if these statements scope over something, this renames it</span><span>
</span><span id="line-1139"></span><span>           </span><span class="hs-comment">-- and returns the result.</span><span>
</span><span id="line-1140"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066229"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683066230"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1141"></span><span id="rnStmts"><span class="annot"><span class="annottext">rnStmts :: forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM (([LStmt GhcRn (LocatedA (body GhcRn))], thing), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmts"><span class="hs-identifier hs-var hs-var">rnStmts</span></a></span></span><span> </span><span id="local-6989586621683067844"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067844"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683067845"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067845"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span id="local-6989586621683067846"><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
</span><a href="#local-6989586621683067846"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621683067847"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067847"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1142"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683067848"><span class="annot"><a href="#local-6989586621683067848"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067849"><span class="annot"><a href="#local-6989586621683067849"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067850"><span class="annot"><a href="#local-6989586621683067850"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)], thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmtsWithFreeVars"><span class="hs-identifier hs-var">rnStmtsWithFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067844"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067845"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
</span><a href="#local-6989586621683067846"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067847"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1143"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621683067848"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067849"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067850"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span class="annot"><span class="hs-comment">-- | maybe rearrange statements according to the ApplicativeDo transformation</span></span><span>
</span><span id="line-1146"></span><span class="annot"><a href="GHC.Rename.Expr.html#postProcessStmtsForApplicativeDo"><span class="hs-identifier hs-type">postProcessStmtsForApplicativeDo</span></a></span><span>
</span><span id="line-1147"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span>
</span><span id="line-1148"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1149"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1150"></span><span id="postProcessStmtsForApplicativeDo"><span class="annot"><span class="annottext">postProcessStmtsForApplicativeDo :: HsDoFlavour
-&gt; [(ExprLStmt GhcRn, FreeVars)]
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#postProcessStmtsForApplicativeDo"><span class="hs-identifier hs-var hs-var">postProcessStmtsForApplicativeDo</span></a></span></span><span> </span><span id="local-6989586621683067852"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683067852"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683067853"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683067853"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-1151"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1152"></span><span>       </span><span class="hs-comment">-- rearrange the statements using ApplicativeStmt if</span><span>
</span><span id="line-1153"></span><span>       </span><span class="hs-comment">-- -XApplicativeDo is on.  Also strip out the FreeVars attached</span><span>
</span><span id="line-1154"></span><span>       </span><span class="hs-comment">-- to each Stmt body.</span><span>
</span><span id="line-1155"></span><span>         </span><span id="local-6989586621683067854"><span class="annot"><a href="#local-6989586621683067854"><span class="hs-identifier hs-var">ado_is_on</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ApplicativeDo</span></span><span>
</span><span id="line-1156"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683067856"><span class="annot"><a href="#local-6989586621683067856"><span class="hs-identifier hs-var hs-var">is_do_expr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-type">DoExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683067852"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1157"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1158"></span><span>       </span><span class="hs-comment">-- don't apply the transformation inside TH brackets, because</span><span>
</span><span id="line-1159"></span><span>       </span><span class="hs-comment">-- GHC.HsToCore.Quote does not handle ApplicativeDo.</span><span>
</span><span id="line-1160"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683067858"><span class="annot"><a href="#local-6989586621683067858"><span class="hs-identifier hs-var">in_th_bracket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#isBrackStage"><span class="hs-identifier hs-type">isBrackStage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-type">getStage</span></a></span><span>
</span><span id="line-1161"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683067854"><span class="hs-identifier hs-type">ado_is_on</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621683067856"><span class="hs-identifier hs-type">is_do_expr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683067858"><span class="hs-identifier hs-type">in_th_bracket</span></a></span><span>
</span><span id="line-1162"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ppsfa&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067853"><span class="hs-identifier hs-type">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rearrangeForApplicativeDo"><span class="hs-identifier hs-type">rearrangeForApplicativeDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067852"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067853"><span class="hs-identifier hs-type">stmts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1164"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#noPostProcessStmts"><span class="hs-identifier hs-type">noPostProcessStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067852"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067853"><span class="hs-identifier hs-type">stmts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1165"></span><span>
</span><span id="line-1166"></span><span class="annot"><span class="hs-comment">-- | strip the FreeVars annotations from statements</span></span><span>
</span><span id="line-1167"></span><span id="local-6989586621683066255"><span class="annot"><a href="GHC.Rename.Expr.html#noPostProcessStmts"><span class="hs-identifier hs-type">noPostProcessStmts</span></a></span><span>
</span><span id="line-1168"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1169"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066255"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1170"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066255"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1171"></span><span id="noPostProcessStmts"><span class="annot"><span class="annottext">noPostProcessStmts :: forall (body :: * -&gt; *).
HsStmtContextRn
-&gt; [(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)]
-&gt; RnM ([LStmt GhcRn (LocatedA (body GhcRn))], FreeVars)
</span><a href="GHC.Rename.Expr.html#noPostProcessStmts"><span class="hs-identifier hs-var hs-var">noPostProcessStmts</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683067864"><span class="annot"><span class="annottext">[(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)]
</span><a href="#local-6989586621683067864"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn)))],
 FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn)))],
      FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
  FreeVars)
 -&gt; GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))
-&gt; [(GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
     FreeVars)]
-&gt; [GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
 FreeVars)
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn)))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)]
[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683067864"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span id="local-6989586621683066101"><span id="local-6989586621683066103"><span class="annot"><a href="GHC.Rename.Expr.html#rnStmtsWithFreeVars"><span class="hs-identifier hs-type">rnStmtsWithFreeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066101"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-1175"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1176"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066101"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066101"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1177"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066101"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1178"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066103"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1179"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066101"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683066103"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1181"></span><span class="hs-comment">-- Each Stmt body is annotated with its FreeVars, so that</span><span>
</span><span id="line-1182"></span><span class="hs-comment">-- we can rearrange statements for ApplicativeDo.</span><span>
</span><span id="line-1183"></span><span class="hs-comment">--</span><span>
</span><span id="line-1184"></span><span class="hs-comment">-- Variables bound by the Stmts, and mentioned in thing_inside,</span><span>
</span><span id="line-1185"></span><span class="hs-comment">-- do not appear in the result FreeVars</span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span id="rnStmtsWithFreeVars"><span class="annot"><span class="annottext">rnStmtsWithFreeVars :: forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)], thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmtsWithFreeVars"><span class="hs-identifier hs-var hs-var">rnStmtsWithFreeVars</span></a></span></span><span> </span><span id="local-6989586621683067894"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067894"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683067895"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067895"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1188"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkEmptyStmts"><span class="hs-identifier hs-var">checkEmptyStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067894"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1189"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067897"><span class="annot"><a href="#local-6989586621683067897"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067898"><span class="annot"><a href="#local-6989586621683067898"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067895"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1190"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067897"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067898"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmtsWithFreeVars"><span class="hs-identifier hs-var">rnStmtsWithFreeVars</span></a></span><span> </span><span id="local-6989586621683067899"><span class="annot"><span class="annottext">mDoExpr :: HsStmtContextRn
</span><a href="#local-6989586621683067899"><span class="hs-identifier hs-var">mDoExpr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MDoExpr"><span class="hs-identifier hs-type">MDoExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683067901"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067901"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; Maybe
     (NonEmpty
        (GenLocated
           SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))))
[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
-&gt; Maybe
     (NonEmpty
        (GenLocated
           SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">nonEmpty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683067902"><span class="annot"><span class="annottext">NonEmpty
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683067902"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683067903"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067903"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>    </span><span class="hs-comment">-- Deal with mdo</span><span>
</span><span id="line-1193"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Behave like do { rec { ...all but last... }; last }</span><span>
</span><span id="line-1194"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683067904"><span class="annot"><a href="#local-6989586621683067904"><span class="hs-identifier hs-var">stmts1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067905"><span class="annot"><a href="#local-6989586621683067905"><span class="hs-identifier hs-var">stmts2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067906"><span class="annot"><a href="#local-6989586621683067906"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067907"><span class="annot"><a href="#local-6989586621683067907"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; ([Name]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([(GenLocated
               SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
             FreeVars)],
           thing),
          FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)], thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067899"><span class="hs-identifier hs-var">mDoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067901"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
 -&gt; GenLocated
      SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
-&gt; StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnList (EpToken &quot;rec&quot;)
-&gt; LocatedLW [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
forall (idL :: Pass) bodyR.
(Anno
   [GenLocated
      (Anno (StmtLR (GhcPass idL) GhcPs bodyR))
      (StmtLR (GhcPass idL) GhcPs bodyR)]
 ~ SrcSpanAnnLW) =&gt;
AnnList (EpToken &quot;rec&quot;)
-&gt; LocatedLW [LStmtLR (GhcPass idL) GhcPs bodyR]
-&gt; StmtLR (GhcPass idL) GhcPs bodyR
</span><a href="GHC.Hs.Utils.html#mkRecStmt"><span class="hs-identifier hs-var">mkRecStmt</span></a></span><span> </span><span class="annot"><span class="annottext">AnnList (EpToken &quot;rec&quot;)
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
-&gt; GenLocated
     SrcSpanAnnLW
     [GenLocated
        SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
-&gt; [GenLocated
      SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#init"><span class="hs-identifier hs-var">NE.init</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683067902"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Name]
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       (([(GenLocated
             SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
           FreeVars)],
         thing),
        FreeVars))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        ([(GenLocated
             SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
           FreeVars)],
         thing)),
       FreeVars))
-&gt; ([Name]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([(GenLocated
               SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
             FreeVars)],
           thing),
          FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1196"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067911"><span class="annot"><a href="#local-6989586621683067911"><span class="hs-identifier hs-var">last_stmt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; RnM (LStmt GhcPs (LocatedA (body GhcPs)))
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; RnM (LStmt GhcPs (LocatedA (body GhcPs)))
</span><a href="GHC.Rename.Expr.html#checkLastStmt"><span class="hs-identifier hs-var">checkLastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067899"><span class="hs-identifier hs-var">mDoExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#last"><span class="hs-identifier hs-var">NE.last</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683067902"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-type">rnStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067899"><span class="hs-identifier hs-type">mDoExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067901"><span class="hs-identifier hs-type">rnBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067911"><span class="hs-identifier hs-type">last_stmt'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067903"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1198"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067904"><span class="hs-identifier hs-type">stmts1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683067905"><span class="hs-identifier hs-type">stmts2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067906"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067907"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmtsWithFreeVars"><span class="hs-identifier hs-var">rnStmtsWithFreeVars</span></a></span><span> </span><span id="local-6989586621683067914"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067914"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683067915"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067915"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067916"><span class="annot"><span class="annottext">lstmt :: LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683067916"><span class="hs-identifier hs-var">lstmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067917"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067917"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683067918"><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
</span><a href="#local-6989586621683067918"><span class="hs-identifier hs-var">lstmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683067919"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067919"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1201"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
</span><a href="#local-6989586621683067918"><span class="hs-identifier hs-var">lstmts</span></a></span><span>
</span><span id="line-1202"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067917"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
       FreeVars)],
     thing),
    FreeVars)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing),
       FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1203"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683067920"><span class="annot"><a href="#local-6989586621683067920"><span class="hs-identifier hs-var">lstmt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; RnM (LStmt GhcPs (LocatedA (body GhcPs)))
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; RnM (LStmt GhcPs (LocatedA (body GhcPs)))
</span><a href="GHC.Rename.Expr.html#checkLastStmt"><span class="hs-identifier hs-var">checkLastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067914"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683067916"><span class="hs-identifier hs-var">lstmt</span></a></span><span>
</span><span id="line-1204"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-type">rnStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067914"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067915"><span class="hs-identifier hs-type">rnBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067920"><span class="hs-identifier hs-type">lstmt'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067919"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1205"></span><span>
</span><span id="line-1206"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1207"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683067921"><span class="annot"><a href="#local-6989586621683067921"><span class="hs-identifier hs-var">stmts1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067922"><span class="annot"><a href="#local-6989586621683067922"><span class="hs-identifier hs-var">stmts2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067923"><span class="annot"><a href="#local-6989586621683067923"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067924"><span class="annot"><a href="#local-6989586621683067924"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(GenLocated
           SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(GenLocated
           SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067917"><span class="hs-identifier hs-var">loc</span></a></span><span>                  </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   (([(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
       FreeVars)],
     ([(GenLocated
          SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
        FreeVars)],
      thing)),
    FreeVars)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        ([(GenLocated
             SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
           FreeVars)],
         thing)),
       FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(GenLocated
           SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(GenLocated
           SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1209"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkStmt"><span class="hs-identifier hs-var">checkStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067914"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683067916"><span class="hs-identifier hs-var">lstmt</span></a></span><span>
</span><span id="line-1210"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; ([Name]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([(GenLocated
               SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
             FreeVars)],
           thing),
          FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)], thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067914"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067915"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683067916"><span class="hs-identifier hs-var">lstmt</span></a></span><span> </span><span class="annot"><span class="annottext">(([Name]
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       (([(GenLocated
             SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
           FreeVars)],
         thing),
        FreeVars))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        ([(GenLocated
             SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
           FreeVars)],
         thing)),
       FreeVars))
-&gt; ([Name]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([(GenLocated
               SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
             FreeVars)],
           thing),
          FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       ([(GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing)),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683067926"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683067926"><span class="hs-identifier hs-var">bndrs1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1211"></span><span>                    </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)], thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmtsWithFreeVars"><span class="hs-identifier hs-var">rnStmtsWithFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067914"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067915"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
</span><a href="#local-6989586621683067918"><span class="hs-identifier hs-var">lstmts</span></a></span><span>  </span><span class="annot"><span class="annottext">(([Name] -&gt; RnM (thing, FreeVars))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing),
       FreeVars))
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683067927"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683067927"><span class="hs-identifier hs-var">bndrs2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1212"></span><span>                    </span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067919"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683067926"><span class="hs-identifier hs-var">bndrs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683067927"><span class="hs-identifier hs-var">bndrs2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1213"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683067921"><span class="hs-identifier hs-type">stmts1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683067922"><span class="hs-identifier hs-type">stmts2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067923"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067924"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span class="hs-comment">{-
Note [Failing pattern matches in Stmts]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Many things desugar to HsStmts including monadic things like `do` and `mdo`
statements, pattern guards, and list comprehensions (see 'HsStmtContext' for an
exhaustive list). How we deal with pattern match failure is context-dependent.

 * In the case of list comprehensions and pattern guards we don't need any
   'fail' function; the desugarer ignores the fail function of 'BindStmt'
   entirely. So, for list comprehensions, the fail function is set to 'Nothing'
   for clarity.

* In the case of monadic contexts (e.g. monad comprehensions, do, and mdo
   expressions) we want pattern match failure to be desugared to the
   'fail' function (from MonadFail type class).

At one point we failed to make this distinction, leading to #11216.
-}</span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span id="local-6989586621683066261"><span id="local-6989586621683066262"><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-type">rnStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066261"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-1238"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1239"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066261"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066261"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1240"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ How to rename the body of the statement</span></span><span>
</span><span id="line-1241"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066261"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The statement</span></span><span>
</span><span id="line-1243"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066262"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Rename the stuff that this statement scopes over</span></span><span>
</span><span id="line-1245"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066261"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683066262"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1247"></span><span class="hs-comment">-- Variables bound by the Stmt, and mentioned in thing_inside,</span><span>
</span><span id="line-1248"></span><span class="hs-comment">-- do not appear in the result FreeVars</span><span>
</span><span id="line-1249"></span><span>
</span><span id="line-1250"></span><span id="rnStmt"><span class="annot"><span class="annottext">rnStmt :: forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)], thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var hs-var">rnStmt</span></a></span></span><span> </span><span id="local-6989586621683067981"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067981"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683067982"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067982"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067983"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067983"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683067984"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683067984"><span class="hs-identifier hs-var">lb</span></a></span></span><span> </span><span id="local-6989586621683067985"><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683067985"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683067986"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621683067986"><span class="hs-identifier hs-var">noret</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683067987"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683067987"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1251"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067988"><span class="annot"><a href="#local-6989586621683067988"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067989"><span class="annot"><a href="#local-6989586621683067989"><span class="hs-identifier hs-var">fv_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067982"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683067985"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1252"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067990"><span class="annot"><a href="#local-6989586621683067990"><span class="hs-identifier hs-var">ret_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683067991"><span class="annot"><a href="#local-6989586621683067991"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#isMonadCompContext"><span class="hs-identifier hs-type">isMonadCompContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067981"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1253"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-type">lookupStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067981"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#returnMName"><span class="hs-identifier hs-type">returnMName</span></a></span><span>
</span><span id="line-1254"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>                            </span><span class="hs-comment">-- The 'return' in a LastStmt is used only</span><span>
</span><span id="line-1256"></span><span>                            </span><span class="hs-comment">-- for MonadComp; and we don't want to report</span><span>
</span><span id="line-1257"></span><span>                            </span><span class="hs-comment">-- &quot;not in scope: return&quot; in other cases</span><span>
</span><span id="line-1258"></span><span>                            </span><span class="hs-comment">-- #15607</span><span>
</span><span id="line-1259"></span><span>
</span><span id="line-1260"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683067996"><span class="annot"><a href="#local-6989586621683067996"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span>  </span><span id="local-6989586621683067997"><span class="annot"><a href="#local-6989586621683067997"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683067987"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1261"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067983"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067984"><span class="hs-identifier hs-type">lb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067988"><span class="hs-identifier hs-type">body'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683067986"><span class="hs-identifier hs-type">noret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067990"><span class="hs-identifier hs-type">ret_op</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067989"><span class="hs-identifier hs-type">fv_expr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1262"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067996"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683067989"><span class="hs-identifier hs-type">fv_expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067991"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067997"><span class="hs-identifier hs-type">fvs3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span id="local-6989586621683067998"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683067998"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683067999"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067999"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068000"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068000"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068001"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068001"><span class="hs-identifier hs-var">lb</span></a></span></span><span> </span><span id="local-6989586621683068002"><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068002"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068003"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068003"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1265"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068004"><span class="annot"><a href="#local-6989586621683068004"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068005"><span class="annot"><a href="#local-6989586621683068005"><span class="hs-identifier hs-var">fv_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683067999"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068002"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1266"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068006"><span class="annot"><a href="#local-6989586621683068006"><span class="hs-identifier hs-var">then_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068007"><span class="annot"><a href="#local-6989586621683068007"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-type">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067998"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#thenMName"><span class="hs-identifier hs-type">thenMName</span></a></span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068010"><span class="annot"><a href="#local-6989586621683068010"><span class="hs-identifier hs-var">guard_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068011"><span class="annot"><a href="#local-6989586621683068011"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#isComprehensionContext"><span class="hs-identifier hs-type">isComprehensionContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067998"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1269"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-type">lookupStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683067998"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#guardMName"><span class="hs-identifier hs-type">guardMName</span></a></span><span>
</span><span id="line-1270"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span><span>                              </span><span class="hs-comment">-- Only list/monad comprehensions use 'guard'</span><span>
</span><span id="line-1272"></span><span>                              </span><span class="hs-comment">-- Also for sub-stmts of same eg [ e | x&lt;-xs, gd | blah ]</span><span>
</span><span id="line-1273"></span><span>                              </span><span class="hs-comment">-- Here &quot;gd&quot; is a guard</span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068014"><span class="annot"><a href="#local-6989586621683068014"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068015"><span class="annot"><a href="#local-6989586621683068015"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683068003"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1276"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068000"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068001"><span class="hs-identifier hs-type">lb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068004"><span class="hs-identifier hs-type">body'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068006"><span class="hs-identifier hs-type">then_op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068010"><span class="hs-identifier hs-type">guard_op</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068005"><span class="hs-identifier hs-type">fv_expr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1277"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068014"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068005"><span class="hs-identifier hs-type">fv_expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068007"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068011"><span class="hs-identifier hs-type">fvs2</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068015"><span class="hs-identifier hs-type">fvs3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1278"></span><span>
</span><span id="line-1279"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span id="local-6989586621683068016"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068016"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068017"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068017"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068018"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068018"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068019"><span class="annot"><span class="annottext">LPat GhcPs
</span><a href="#local-6989586621683068019"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068020"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068020"><span class="hs-identifier hs-var">lb</span></a></span></span><span> </span><span id="local-6989586621683068021"><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068021"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068022"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068022"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1280"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068023"><span class="annot"><a href="#local-6989586621683068023"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068024"><span class="annot"><a href="#local-6989586621683068024"><span class="hs-identifier hs-var">fv_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068017"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068021"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1281"></span><span>                </span><span class="hs-comment">-- The binders do not scope over the expression</span><span>
</span><span id="line-1282"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068025"><span class="annot"><a href="#local-6989586621683068025"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068026"><span class="annot"><a href="#local-6989586621683068026"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-type">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068016"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#bindMName"><span class="hs-identifier hs-type">bindMName</span></a></span><span>
</span><span id="line-1283"></span><span>
</span><span id="line-1284"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Pat.html#rnPat"><span class="hs-identifier hs-type">rnPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068016"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068019"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683068029"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068029"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1285"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068030"><span class="annot"><a href="#local-6989586621683068030"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068031"><span class="annot"><a href="#local-6989586621683068031"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068022"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; LPat GhcRn -&gt; [IdP GhcRn]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068029"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068034"><span class="annot"><a href="#local-6989586621683068034"><span class="hs-identifier hs-var">fail_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068035"><span class="annot"><a href="#local-6989586621683068035"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#monadFailOp"><span class="hs-identifier hs-type">monadFailOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068029"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068016"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1287"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068037"><span class="annot"><a href="#local-6989586621683068037"><span class="hs-identifier hs-var hs-var">xbsrn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#XBindStmtRn"><span class="hs-identifier hs-type">XBindStmtRn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xbsrn_bindOp :: SyntaxExpr GhcRn
</span><a href="GHC.Hs.Expr.html#xbsrn_bindOp"><span class="hs-identifier hs-var">xbsrn_bindOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621683068025"><span class="hs-identifier hs-var">bind_op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbsrn_failOp :: Maybe (SyntaxExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#xbsrn_failOp"><span class="hs-identifier hs-var">xbsrn_failOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
Maybe SyntaxExprRn
</span><a href="#local-6989586621683068034"><span class="hs-identifier hs-var">fail_op</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1288"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068018"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068037"><span class="hs-identifier hs-type">xbsrn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068029"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068020"><span class="hs-identifier hs-type">lb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068023"><span class="hs-identifier hs-type">body'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068024"><span class="hs-identifier hs-type">fv_expr</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1289"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068030"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1290"></span><span>                  </span><span class="annot"><a href="#local-6989586621683068024"><span class="hs-identifier hs-type">fv_expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068026"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068031"><span class="hs-identifier hs-type">fvs2</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068035"><span class="hs-identifier hs-type">fvs3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1291"></span><span>       </span><span class="hs-comment">-- fv_expr shouldn't really be filtered by the rnPatsAndThen</span><span>
</span><span id="line-1292"></span><span>        </span><span class="hs-comment">-- but it does not matter because the names are unique</span><span>
</span><span id="line-1293"></span><span>
</span><span id="line-1294"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068041"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068041"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068042"><span class="annot"><span class="annottext">HsLocalBinds GhcPs
</span><a href="#local-6989586621683068042"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068043"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068043"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1295"></span><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
-&gt; (HsLocalBinds GhcRn
    -&gt; FreeVars
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
             FreeVars)],
           thing),
          FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
forall result.
HsLocalBinds GhcPs
-&gt; (HsLocalBinds GhcRn -&gt; FreeVars -&gt; RnM (result, FreeVars))
-&gt; RnM (result, FreeVars)
</span><a href="GHC.Rename.Bind.html#rnLocalBindsAndThen"><span class="hs-identifier hs-var">rnLocalBindsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
</span><a href="#local-6989586621683068042"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">((HsLocalBinds GhcRn
  -&gt; FreeVars
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
           FreeVars)],
         thing),
        FreeVars))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
          FreeVars)],
        thing),
       FreeVars))
-&gt; (HsLocalBinds GhcRn
    -&gt; FreeVars
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
             FreeVars)],
           thing),
          FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
         FreeVars)],
       thing),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683068044"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621683068044"><span class="hs-identifier hs-var">binds'</span></a></span></span><span> </span><span id="local-6989586621683068045"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068045"><span class="hs-identifier hs-var">bind_fvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1296"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068046"><span class="annot"><a href="#local-6989586621683068046"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068047"><span class="annot"><a href="#local-6989586621683068047"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068043"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; HsLocalBinds GhcRn -&gt; [IdP GhcRn]
forall (idL :: Pass) (idR :: Pass).
CollectPass (GhcPass idL) =&gt;
CollectFlag (GhcPass idL)
-&gt; HsLocalBindsLR (GhcPass idL) (GhcPass idR)
-&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLocalBinders"><span class="hs-identifier hs-var">collectLocalBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621683068044"><span class="hs-identifier hs-var">binds'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1297"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068041"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068044"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068045"><span class="hs-identifier hs-type">bind_fvs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068046"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1298"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068047"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1299"></span><span>
</span><span id="line-1300"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span id="local-6989586621683068049"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068049"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068050"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068050"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068051"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068051"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recS_stmts :: forall idL idR body.
StmtLR idL idR body -&gt; XRec idR [LStmtLR idL idR body]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068052"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
</span><a href="#local-6989586621683068052"><span class="hs-identifier hs-var">rec_stmts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068053"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068053"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1301"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068054"><span class="annot"><a href="#local-6989586621683068054"><span class="hs-identifier hs-var">return_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068055"><span class="annot"><a href="#local-6989586621683068055"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-var">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068049"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a></span><span>
</span><span id="line-1302"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068056"><span class="annot"><a href="#local-6989586621683068056"><span class="hs-identifier hs-var">mfix_op</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621683068057"><span class="annot"><a href="#local-6989586621683068057"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-type">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068049"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#mfixName"><span class="hs-identifier hs-type">mfixName</span></a></span><span>
</span><span id="line-1303"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068059"><span class="annot"><a href="#local-6989586621683068059"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621683068060"><span class="annot"><a href="#local-6989586621683068060"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-type">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068049"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#bindMName"><span class="hs-identifier hs-type">bindMName</span></a></span><span>
</span><span id="line-1304"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068061"><span class="annot"><a href="#local-6989586621683068061"><span class="hs-identifier hs-var hs-var">empty_rec_stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068062"><span class="annot"><span class="annottext">StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
forall bodyR.
(Anno
   [GenLocated
      (Anno (StmtLR GhcRn GhcRn bodyR)) (StmtLR GhcRn GhcRn bodyR)]
 ~ SrcSpanAnnLW) =&gt;
StmtLR GhcRn GhcRn bodyR
forall {body :: * -&gt; *}. StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
</span><a href="GHC.Hs.Utils.html#emptyRecStmtName"><span class="hs-identifier hs-var">emptyRecStmtName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtLR"><span class="hs-identifier hs-type">StmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068062"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span class="hs-special">)</span><span>
</span><span id="line-1305"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_ret_fn"><span class="hs-identifier hs-var">recS_ret_fn</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068054"><span class="hs-identifier hs-type">return_op</span></a></span><span>
</span><span id="line-1306"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_mfix_fn"><span class="hs-identifier hs-var">recS_mfix_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068056"><span class="hs-identifier hs-type">mfix_op</span></a></span><span>
</span><span id="line-1307"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_bind_fn"><span class="hs-identifier hs-var">recS_bind_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068059"><span class="hs-identifier hs-type">bind_op</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1308"></span><span>
</span><span id="line-1309"></span><span>        </span><span class="hs-comment">-- Step1: Bring all the binders of the mdo into scope</span><span>
</span><span id="line-1310"></span><span>        </span><span class="hs-comment">-- (Remember that this also removes the binders from the</span><span>
</span><span id="line-1311"></span><span>        </span><span class="hs-comment">-- finally-returned free-vars.)</span><span>
</span><span id="line-1312"></span><span>        </span><span class="hs-comment">-- And rename each individual stmt, making a</span><span>
</span><span id="line-1313"></span><span>        </span><span class="hs-comment">-- singleton segment.  At this stage the FwdRefs field</span><span>
</span><span id="line-1314"></span><span>        </span><span class="hs-comment">-- isn't finished: it's empty for all except a BindStmt</span><span>
</span><span id="line-1315"></span><span>        </span><span class="hs-comment">-- for which it's the fwd refs within the bind itself</span><span>
</span><span id="line-1316"></span><span>        </span><span class="hs-comment">-- (This set may not be empty, because we're in a recursive</span><span>
</span><span id="line-1317"></span><span>        </span><span class="hs-comment">-- context.)</span><span>
</span><span id="line-1318"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnRecStmtsAndThen"><span class="hs-identifier hs-type">rnRecStmtsAndThen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068049"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068050"><span class="hs-identifier hs-type">rnBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068052"><span class="hs-identifier hs-type">rec_stmts</span></a></span><span>   </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683068070"><span class="annot"><span class="annottext">[(FreeVars, FreeVars, FreeVars,
  XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
</span><a href="#local-6989586621683068070"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1319"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068071"><span class="annot"><span class="annottext">bndrs :: [Name]
</span><a href="#local-6989586621683068071"><span class="hs-identifier hs-var hs-var hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; [Name]
</span><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a></span><span> </span><span class="annot"><span class="annottext">(FreeVars -&gt; [Name]) -&gt; FreeVars -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1320"></span><span>                        </span><span class="annot"><span class="annottext">((FreeVars, FreeVars, FreeVars,
  GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))
 -&gt; FreeVars -&gt; FreeVars)
-&gt; FreeVars
-&gt; [(FreeVars, FreeVars, FreeVars,
     GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
-&gt; FreeVars
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">(FreeVars -&gt; FreeVars -&gt; FreeVars)
-&gt; ((FreeVars, FreeVars, FreeVars,
     GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))
    -&gt; FreeVars)
-&gt; (FreeVars, FreeVars, FreeVars,
    GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))
-&gt; FreeVars
-&gt; FreeVars
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683068074"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068074"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn)))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068074"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1321"></span><span>                              </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span>
</span><span id="line-1322"></span><span>                              </span><span class="annot"><span class="annottext">[(FreeVars, FreeVars, FreeVars,
  XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
[(FreeVars, FreeVars, FreeVars,
  GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
</span><a href="#local-6989586621683068070"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-1323"></span><span>          </span><span class="hs-comment">-- See Note [Deterministic ApplicativeDo and RecursiveDo desugaring]</span><span>
</span><span id="line-1324"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068075"><span class="annot"><a href="#local-6989586621683068075"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068076"><span class="annot"><a href="#local-6989586621683068076"><span class="hs-identifier hs-var">fvs_later</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068053"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068071"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1325"></span><span>        </span><span class="hs-comment">-- In interactive mode, all variables could be used later. So we pass whether</span><span>
</span><span id="line-1326"></span><span>        </span><span class="hs-comment">-- we are in GHCi along to segmentRecStmts. See Note [What is &quot;used later&quot; in a rec stmt]</span><span>
</span><span id="line-1327"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683068077"><span class="annot"><a href="#local-6989586621683068077"><span class="hs-identifier hs-var">is_interactive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-type">isInteractiveModule</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-1328"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1329"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621683068080"><span class="annot"><a href="#local-6989586621683068080"><span class="hs-identifier hs-var">rec_stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068081"><span class="annot"><a href="#local-6989586621683068081"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#segmentRecStmts"><span class="hs-identifier hs-type">segmentRecStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068051"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068049"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068061"><span class="hs-identifier hs-type">empty_rec_stmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068070"><span class="hs-identifier hs-type">segs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068076"><span class="hs-identifier hs-type">fvs_later</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068077"><span class="hs-identifier hs-type">is_interactive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1330"></span><span>        </span><span class="hs-comment">-- We aren't going to try to group RecStmts with</span><span>
</span><span id="line-1331"></span><span>        </span><span class="hs-comment">-- ApplicativeDo, so attaching empty FVs is fine.</span><span>
</span><span id="line-1332"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621683068080"><span class="hs-identifier hs-type">rec_stmts'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">repeat</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068075"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1333"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068081"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068055"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068057"><span class="hs-identifier hs-type">fvs2</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068060"><span class="hs-identifier hs-type">fvs3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1334"></span><span>
</span><span id="line-1335"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span id="local-6989586621683068085"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068085"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068086"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068086"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XParStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068087"><span class="annot"><span class="annottext">[ParStmtBlock GhcPs GhcPs]
</span><a href="#local-6989586621683068087"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068088"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068088"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1336"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068089"><span class="annot"><a href="#local-6989586621683068089"><span class="hs-identifier hs-var">mzip_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068090"><span class="annot"><a href="#local-6989586621683068090"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Name -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupStmtNamePoly"><span class="hs-identifier hs-var">lookupStmtNamePoly</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068085"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#mzipName"><span class="hs-identifier hs-var">mzipName</span></a></span><span>
</span><span id="line-1337"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068093"><span class="annot"><a href="#local-6989586621683068093"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068094"><span class="annot"><a href="#local-6989586621683068094"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-type">lookupStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068085"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#bindMName"><span class="hs-identifier hs-type">bindMName</span></a></span><span>
</span><span id="line-1338"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068095"><span class="annot"><a href="#local-6989586621683068095"><span class="hs-identifier hs-var">return_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068096"><span class="annot"><a href="#local-6989586621683068096"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-type">lookupStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068085"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#returnMName"><span class="hs-identifier hs-type">returnMName</span></a></span><span>
</span><span id="line-1339"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068097"><span class="annot"><a href="#local-6989586621683068097"><span class="hs-identifier hs-var">segs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068098"><span class="annot"><a href="#local-6989586621683068098"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068099"><span class="annot"><a href="#local-6989586621683068099"><span class="hs-identifier hs-var">fvs4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnParallelStmts"><span class="hs-identifier hs-type">rnParallelStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtCtxt"><span class="hs-identifier hs-type">ParStmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068085"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068095"><span class="hs-identifier hs-type">return_op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068087"><span class="hs-identifier hs-type">segs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068088"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1340"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068086"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068097"><span class="hs-identifier hs-type">segs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068089"><span class="hs-identifier hs-type">mzip_op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068093"><span class="hs-identifier hs-type">bind_op</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068099"><span class="hs-identifier hs-type">fvs4</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068098"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068090"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068094"><span class="hs-identifier hs-type">fvs2</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068096"><span class="hs-identifier hs-type">fvs3</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068099"><span class="hs-identifier hs-type">fvs4</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1342"></span><span>
</span><span id="line-1343"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmt"><span class="hs-identifier hs-var">rnStmt</span></a></span><span> </span><span id="local-6989586621683068102"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068102"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068103"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068103"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">trS_stmts :: forall idL idR body. StmtLR idL idR body -&gt; [ExprLStmt idL]
</span><a href="Language.Haskell.Syntax.Expr.html#trS_stmts"><span class="hs-identifier hs-var">trS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683068105"><span class="annot"><span class="annottext">[ExprLStmt GhcPs]
</span><a href="#local-6989586621683068105"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_by :: forall idL idR body. StmtLR idL idR body -&gt; Maybe (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Expr.html#trS_by"><span class="hs-identifier hs-var">trS_by</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683068107"><span class="annot"><span class="annottext">Maybe (LHsExpr GhcPs)
</span><a href="#local-6989586621683068107"><span class="hs-identifier hs-var">by</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_form :: forall idL idR body. StmtLR idL idR body -&gt; TransForm
</span><a href="Language.Haskell.Syntax.Expr.html#trS_form"><span class="hs-identifier hs-var">trS_form</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683068109"><span class="annot"><span class="annottext">TransForm
</span><a href="#local-6989586621683068109"><span class="hs-identifier hs-var">form</span></a></span></span><span>
</span><span id="line-1344"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_using :: forall idL idR body. StmtLR idL idR body -&gt; LHsExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#trS_using"><span class="hs-identifier hs-var">trS_using</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683068111"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683068111"><span class="hs-identifier hs-var">using</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068112"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068112"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1345"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Rename the 'using' expression in the context before the transform is begun</span><span>
</span><span id="line-1346"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621683068113"><span class="annot"><a href="#local-6989586621683068113"><span class="hs-identifier hs-var">using'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068114"><span class="annot"><a href="#local-6989586621683068114"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683068111"><span class="hs-identifier hs-var">using</span></a></span><span>
</span><span id="line-1347"></span><span>
</span><span id="line-1348"></span><span>         </span><span class="hs-comment">-- Rename the stmts and the 'by' expression</span><span>
</span><span id="line-1349"></span><span>         </span><span class="hs-comment">-- Keep track of the variables mentioned in the 'by' expression</span><span>
</span><span id="line-1350"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068115"><span class="annot"><a href="#local-6989586621683068115"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068116"><span class="annot"><a href="#local-6989586621683068116"><span class="hs-identifier hs-var">by'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068117"><span class="annot"><a href="#local-6989586621683068117"><span class="hs-identifier hs-var">used_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068118"><span class="annot"><a href="#local-6989586621683068118"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068119"><span class="annot"><a href="#local-6989586621683068119"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1351"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnStmts"><span class="hs-identifier hs-type">rnStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmtCtxt"><span class="hs-identifier hs-type">TransStmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068102"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-type">rnExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068105"><span class="hs-identifier hs-type">stmts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683068121"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068121"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1352"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068122"><span class="annot"><a href="#local-6989586621683068122"><span class="hs-identifier hs-var">by'</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621683068123"><span class="annot"><a href="#local-6989586621683068123"><span class="hs-identifier hs-var">fvs_by</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcPs)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars))
-&gt; Maybe (GenLocated SrcSpanAnnA (HsExpr GhcPs))
-&gt; RnM (Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)
forall a b.
(a -&gt; RnM (b, FreeVars)) -&gt; Maybe a -&gt; RnM (Maybe b, FreeVars)
</span><a href="GHC.Rename.Utils.html#mapMaybeFvRn"><span class="hs-identifier hs-var">mapMaybeFvRn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
GenLocated SrcSpanAnnA (HsExpr GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcPs)
Maybe (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683068107"><span class="hs-identifier hs-var">by</span></a></span><span>
</span><span id="line-1353"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068124"><span class="annot"><a href="#local-6989586621683068124"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068125"><span class="annot"><a href="#local-6989586621683068125"><span class="hs-identifier hs-var">fvs_thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683068112"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068121"><span class="hs-identifier hs-type">bndrs</span></a></span><span>
</span><span id="line-1354"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068126"><span class="annot"><a href="#local-6989586621683068126"><span class="hs-identifier hs-var hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068123"><span class="hs-identifier hs-var">fvs_by</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068125"><span class="hs-identifier hs-var">fvs_thing</span></a></span><span>
</span><span id="line-1355"></span><span>                         </span><span id="local-6989586621683068127"><span class="annot"><a href="#local-6989586621683068127"><span class="hs-identifier hs-var hs-var">used_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068126"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068121"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1356"></span><span>                         </span><span class="hs-comment">-- The paper (Fig 5) has a bug here; we must treat any free variable</span><span>
</span><span id="line-1357"></span><span>                         </span><span class="hs-comment">-- of the &quot;thing inside&quot;, **or of the by-expression**, as used</span><span>
</span><span id="line-1358"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068122"><span class="hs-identifier hs-type">by'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068127"><span class="hs-identifier hs-type">used_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068124"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068126"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span>       </span><span class="hs-comment">-- Lookup `return`, `(&gt;&gt;=)` and `liftM` for monad comprehensions</span><span>
</span><span id="line-1361"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068129"><span class="annot"><a href="#local-6989586621683068129"><span class="hs-identifier hs-var">return_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068130"><span class="annot"><a href="#local-6989586621683068130"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-type">lookupStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068102"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#returnMName"><span class="hs-identifier hs-type">returnMName</span></a></span><span>
</span><span id="line-1362"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068131"><span class="annot"><a href="#local-6989586621683068131"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621683068132"><span class="annot"><a href="#local-6989586621683068132"><span class="hs-identifier hs-var">fvs4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-type">lookupStmtName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068102"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#bindMName"><span class="hs-identifier hs-type">bindMName</span></a></span><span>
</span><span id="line-1363"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068133"><span class="annot"><a href="#local-6989586621683068133"><span class="hs-identifier hs-var">fmap_op</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621683068134"><span class="annot"><a href="#local-6989586621683068134"><span class="hs-identifier hs-var">fvs5</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683068109"><span class="hs-identifier hs-type">form</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1364"></span><span>                                </span><span class="annot"><span class="annottext">TransForm
</span><a href="Language.Haskell.Syntax.Expr.html#ThenForm"><span class="hs-identifier hs-var">ThenForm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn
forall (p :: Pass). HsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#noExpr"><span class="hs-identifier hs-var">noExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1365"></span><span>                                </span><span class="annot"><span class="annottext">TransForm
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Name -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupStmtNamePoly"><span class="hs-identifier hs-var">lookupStmtNamePoly</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068102"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fmapName"><span class="hs-identifier hs-var">fmapName</span></a></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068138"><span class="annot"><a href="#local-6989586621683068138"><span class="hs-identifier hs-var hs-var">all_fvs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068114"><span class="hs-identifier hs-var">fvs1</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068119"><span class="hs-identifier hs-var">fvs2</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068130"><span class="hs-identifier hs-var">fvs3</span></a></span><span>
</span><span id="line-1368"></span><span>                             </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068132"><span class="hs-identifier hs-var">fvs4</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068134"><span class="hs-identifier hs-var">fvs5</span></a></span><span>
</span><span id="line-1369"></span><span>             </span><span id="local-6989586621683068139"><span class="annot"><a href="#local-6989586621683068139"><span class="hs-identifier hs-var hs-var">bndr_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068117"><span class="hs-identifier hs-var">used_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [(Name, Name)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068117"><span class="hs-identifier hs-var">used_bndrs</span></a></span><span>
</span><span id="line-1370"></span><span>             </span><span class="hs-comment">-- See Note [TransStmt binder map] in GHC.Hs.Expr</span><span>
</span><span id="line-1371"></span><span>
</span><span id="line-1372"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rnStmt: implicitly rebound these used binders:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068139"><span class="hs-identifier hs-type">bndr_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1373"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068103"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_ext"><span class="hs-identifier hs-var">trS_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span>
</span><span id="line-1374"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_stmts"><span class="hs-identifier hs-var">trS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068115"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_bndrs"><span class="hs-identifier hs-var">trS_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068139"><span class="hs-identifier hs-type">bndr_map</span></a></span><span>
</span><span id="line-1375"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_by"><span class="hs-identifier hs-var">trS_by</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068116"><span class="hs-identifier hs-type">by'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_using"><span class="hs-identifier hs-var">trS_using</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068113"><span class="hs-identifier hs-type">using'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_form"><span class="hs-identifier hs-var">trS_form</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068109"><span class="hs-identifier hs-type">form</span></a></span><span>
</span><span id="line-1376"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_ret"><span class="hs-identifier hs-var">trS_ret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068129"><span class="hs-identifier hs-type">return_op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_bind"><span class="hs-identifier hs-var">trS_bind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068131"><span class="hs-identifier hs-type">bind_op</span></a></span><span>
</span><span id="line-1377"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_fmap"><span class="hs-identifier hs-var">trS_fmap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068133"><span class="hs-identifier hs-type">fmap_op</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068119"><span class="hs-identifier hs-type">fvs2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068118"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068138"><span class="hs-identifier hs-type">all_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnParallelStmts"><span class="hs-identifier hs-type">rnParallelStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683066300"><span class="annot"><a href="#local-6989586621683066300"><span class="hs-identifier hs-type">thing</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1380"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1381"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1382"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066300"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1383"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683066300"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1384"></span><span class="hs-comment">-- Note [Renaming parallel Stmts]</span><span>
</span><span id="line-1385"></span><span id="rnParallelStmts"><span class="annot"><span class="annottext">rnParallelStmts :: forall thing.
HsStmtContextRn
-&gt; SyntaxExpr GhcRn
-&gt; [ParStmtBlock GhcPs GhcPs]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM (([ParStmtBlock GhcRn GhcRn], thing), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnParallelStmts"><span class="hs-identifier hs-var hs-var">rnParallelStmts</span></a></span></span><span> </span><span id="local-6989586621683068158"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068158"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068159"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621683068159"><span class="hs-identifier hs-var">return_op</span></a></span></span><span> </span><span id="local-6989586621683068160"><span class="annot"><span class="annottext">[ParStmtBlock GhcPs GhcPs]
</span><a href="#local-6989586621683068160"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span id="local-6989586621683068161"><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068161"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683068162"><span class="annot"><a href="#local-6989586621683068162"><span class="hs-identifier hs-var">orig_lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a></span><span>
</span><span id="line-1387"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683068164"><span class="hs-identifier hs-type">rn_segs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068162"><span class="hs-identifier hs-type">orig_lcl_env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683068160"><span class="hs-identifier hs-type">segs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1388"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1389"></span><span>    </span><span class="annot"><a href="#local-6989586621683068164"><span class="hs-identifier hs-type">rn_segs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a></span><span>
</span><span id="line-1390"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1391"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683066300"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1392"></span><span>    </span><span id="local-6989586621683068164"><span class="annot"><span class="annottext">rn_segs :: LocalRdrEnv
-&gt; [Name]
-&gt; [ParStmtBlock GhcPs GhcPs]
-&gt; RnM (([ParStmtBlock GhcRn GhcRn], thing), FreeVars)
</span><a href="#local-6989586621683068164"><span class="hs-identifier hs-var hs-var">rn_segs</span></a></span></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068165"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068165"><span class="hs-identifier hs-var">bndrs_so_far</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1393"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068166"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068166"><span class="hs-identifier hs-var hs-var">bndrs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068167"><span class="annot"><span class="annottext">[NonEmpty Name]
</span><a href="#local-6989586621683068167"><span class="hs-identifier hs-var hs-var">dups</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; [Name] -&gt; ([Name], [NonEmpty Name])
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; ([a], [NonEmpty a])
</span><a href="GHC.Data.List.SetOps.html#removeDupsOn"><span class="hs-identifier hs-var">removeDupsOn</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068165"><span class="hs-identifier hs-var">bndrs_so_far</span></a></span><span>
</span><span id="line-1394"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(NonEmpty Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; [NonEmpty Name] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683068170"><span class="hs-identifier hs-var">dupErr</span></a></span><span> </span><span class="annot"><span class="annottext">[NonEmpty Name]
</span><a href="#local-6989586621683068167"><span class="hs-identifier hs-var">dups</span></a></span><span>
</span><span id="line-1395"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068171"><span class="annot"><a href="#local-6989586621683068171"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068172"><span class="annot"><a href="#local-6989586621683068172"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars) -&gt; RnM (thing, FreeVars)
forall a. [Name] -&gt; RnM a -&gt; RnM a
</span><a href="GHC.Rename.Utils.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068166"><span class="hs-identifier hs-var">bndrs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; RnM (thing, FreeVars)
</span><a href="#local-6989586621683068161"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068166"><span class="hs-identifier hs-var">bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1396"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068171"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068172"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1397"></span><span>
</span><span id="line-1398"></span><span>    </span><span class="annot"><a href="#local-6989586621683068164"><span class="hs-identifier hs-var">rn_segs</span></a></span><span> </span><span id="local-6989586621683068173"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621683068173"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621683068174"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068174"><span class="hs-identifier hs-var">bndrs_so_far</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span id="local-6989586621683068176"><span class="annot"><span class="annottext">XParStmtBlock GhcPs GhcPs
</span><a href="#local-6989586621683068176"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683068177"><span class="annot"><span class="annottext">[ExprLStmt GhcPs]
</span><a href="#local-6989586621683068177"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="annot"><span class="annottext">[IdP GhcPs]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068178"><span class="annot"><span class="annottext">[ParStmtBlock GhcPs GhcPs]
</span><a href="#local-6989586621683068178"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068179"><span class="annot"><a href="#local-6989586621683068179"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068180"><span class="annot"><a href="#local-6989586621683068180"><span class="hs-identifier hs-var">used_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068181"><span class="annot"><a href="#local-6989586621683068181"><span class="hs-identifier hs-var">segs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068182"><span class="annot"><a href="#local-6989586621683068182"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068183"><span class="annot"><a href="#local-6989586621683068183"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1400"></span><span>                    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars))
-&gt; [LStmt GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))]
-&gt; ([Name]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))],
       ([Name], [ParStmtBlock GhcRn GhcRn], thing)),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM (([LStmt GhcRn (LocatedA (body GhcRn))], thing), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmts"><span class="hs-identifier hs-var">rnStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068158"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcPs]
[LStmt GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))]
</span><a href="#local-6989586621683068177"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">(([Name]
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))],
        ([Name], [ParStmtBlock GhcRn GhcRn], thing)),
       FreeVars))
-&gt; ([Name]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))],
       ([Name], [ParStmtBlock GhcRn GhcRn], thing)),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683068184"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068184"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1401"></span><span>                       </span><span class="annot"><span class="annottext">LocalRdrEnv
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars)
forall a. LocalRdrEnv -&gt; RnM a -&gt; RnM a
</span><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier hs-var">setLocalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621683068173"><span class="hs-identifier hs-var">env</span></a></span><span>       </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([Name], [ParStmtBlock GhcRn GhcRn], thing), FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1402"></span><span>                       </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068186"><span class="annot"><a href="#local-6989586621683068186"><span class="hs-identifier hs-var">segs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068187"><span class="annot"><a href="#local-6989586621683068187"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068188"><span class="annot"><a href="#local-6989586621683068188"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
-&gt; [Name]
-&gt; [ParStmtBlock GhcPs GhcPs]
-&gt; RnM (([ParStmtBlock GhcRn GhcRn], thing), FreeVars)
</span><a href="#local-6989586621683068164"><span class="hs-identifier hs-var">rn_segs</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621683068173"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068184"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068174"><span class="hs-identifier hs-var">bndrs_so_far</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ParStmtBlock GhcPs GhcPs]
</span><a href="#local-6989586621683068178"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-1403"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068189"><span class="annot"><a href="#local-6989586621683068189"><span class="hs-identifier hs-var hs-var">used_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068188"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068184"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1404"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068189"><span class="hs-identifier hs-type">used_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068186"><span class="hs-identifier hs-type">segs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068187"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068188"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1405"></span><span>
</span><span id="line-1406"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068190"><span class="annot"><a href="#local-6989586621683068190"><span class="hs-identifier hs-var hs-var">seg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XParStmtBlock GhcRn GhcRn
-&gt; [ExprLStmt GhcRn]
-&gt; [IdP GhcRn]
-&gt; SyntaxExpr GhcRn
-&gt; ParStmtBlock GhcRn GhcRn
forall idL idR.
XParStmtBlock idL idR
-&gt; [ExprLStmt idL]
-&gt; [IdP idR]
-&gt; SyntaxExpr idR
-&gt; ParStmtBlock idL idR
</span><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-var">ParStmtBlock</span></a></span><span> </span><span class="annot"><span class="annottext">XParStmtBlock GhcPs GhcPs
XParStmtBlock GhcRn GhcRn
</span><a href="#local-6989586621683068176"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683068179"><span class="hs-identifier hs-var">stmts'</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683068180"><span class="hs-identifier hs-var">used_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621683068159"><span class="hs-identifier hs-var">return_op</span></a></span><span>
</span><span id="line-1407"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068190"><span class="hs-identifier hs-type">seg'</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683068181"><span class="hs-identifier hs-type">segs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068182"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068183"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1408"></span><span>
</span><span id="line-1409"></span><span>    </span><span id="local-6989586621683068170"><span class="annot"><span class="annottext">dupErr :: NonEmpty Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683068170"><span class="hs-identifier hs-var hs-var">dupErr</span></a></span></span><span> </span><span id="local-6989586621683068191"><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621683068191"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnListComprehensionDuplicateBinding"><span class="hs-identifier hs-var">TcRnListComprehensionDuplicateBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty Name -&gt; Name
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-var">NE.head</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621683068191"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1410"></span><span>
</span><span id="line-1411"></span><span class="annot"><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-type">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1412"></span><span class="hs-comment">-- Like lookupStmtName, but respects QualifiedDo</span><span>
</span><span id="line-1413"></span><span id="lookupQualifiedDoStmtName"><span class="annot"><span class="annottext">lookupQualifiedDoStmtName :: HsStmtContextRn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-var hs-var">lookupQualifiedDoStmtName</span></a></span></span><span> </span><span id="local-6989586621683068194"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068194"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068195"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068195"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-1414"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsStmtContext (GenLocated SrcSpanAnnN Name) -&gt; Maybe ModuleName
forall fn. HsStmtContext fn -&gt; Maybe ModuleName
</span><a href="Language.Haskell.Syntax.Expr.html#qualifiedDoModuleName_maybe"><span class="hs-identifier hs-var">qualifiedDoModuleName_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
HsStmtContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621683068194"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1415"></span><span>      </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-var">lookupStmtName</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068194"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068195"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1416"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683068197"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683068197"><span class="hs-identifier hs-var">modName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1417"></span><span>        </span><span class="annot"><span class="annottext">(Name -&gt; SyntaxExprRn)
-&gt; (Name, FreeVars) -&gt; (SyntaxExprRn, FreeVars)
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkSyntaxExpr"><span class="hs-identifier hs-var">mkSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn -&gt; SyntaxExprRn)
-&gt; (Name -&gt; HsExpr GhcRn) -&gt; Name -&gt; SyntaxExprRn
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; HsExpr GhcRn
Name -&gt; HsExpr GhcRn
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; HsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nl_HsVar"><span class="hs-identifier hs-var">nl_HsVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Name, FreeVars) -&gt; (SyntaxExprRn, FreeVars))
-&gt; RnM (Name, FreeVars)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (SyntaxExprRn, FreeVars)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ModuleName -&gt; RnM (Name, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupNameWithQualifier"><span class="hs-identifier hs-var">lookupNameWithQualifier</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068195"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683068197"><span class="hs-identifier hs-var">modName</span></a></span><span>
</span><span id="line-1418"></span><span>
</span><span id="line-1419"></span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-type">lookupStmtName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1420"></span><span class="hs-comment">-- Like lookupSyntax, but respects contexts</span><span>
</span><span id="line-1421"></span><span id="lookupStmtName"><span class="annot"><span class="annottext">lookupStmtName :: HsStmtContextRn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupStmtName"><span class="hs-identifier hs-var hs-var">lookupStmtName</span></a></span></span><span> </span><span id="local-6989586621683068201"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068201"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068202"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068202"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-1422"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Bool
</span><a href="GHC.Rename.Expr.html#rebindableContext"><span class="hs-identifier hs-var">rebindableContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068201"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1423"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupSyntax"><span class="hs-identifier hs-var">lookupSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068202"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1424"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1425"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SyntaxExprRn, FreeVars)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (SyntaxExprRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068202"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span class="annot"><a href="GHC.Rename.Expr.html#lookupStmtNamePoly"><span class="hs-identifier hs-type">lookupStmtNamePoly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span id="lookupStmtNamePoly"><span class="annot"><span class="annottext">lookupStmtNamePoly :: HsStmtContextRn -&gt; Name -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupStmtNamePoly"><span class="hs-identifier hs-var hs-var">lookupStmtNamePoly</span></a></span></span><span> </span><span id="local-6989586621683068204"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068204"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068205"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068205"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1429"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Bool
</span><a href="GHC.Rename.Expr.html#rebindableContext"><span class="hs-identifier hs-var">rebindableContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068204"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1430"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683068206"><span class="annot"><a href="#local-6989586621683068206"><span class="hs-identifier hs-var">rebindable_on</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span></span><span>
</span><span id="line-1431"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683068206"><span class="hs-identifier hs-type">rebindable_on</span></a></span><span>
</span><span id="line-1432"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683068207"><span class="annot"><a href="#local-6989586621683068207"><span class="hs-identifier hs-var">fm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier hs-type">lookupOccRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-type">nameRdrName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068205"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1433"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068207"><span class="hs-identifier hs-type">fm</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-type">unitFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068207"><span class="hs-identifier hs-type">fm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1434"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621683068209"><span class="hs-identifier hs-type">not_rebindable</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1436"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcRn, FreeVars)
</span><a href="#local-6989586621683068209"><span class="hs-identifier hs-var">not_rebindable</span></a></span><span>
</span><span id="line-1437"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1438"></span><span>    </span><span id="local-6989586621683068209"><span class="annot"><span class="annottext">not_rebindable :: TcM (HsExpr GhcRn, FreeVars)
</span><a href="#local-6989586621683068209"><span class="hs-identifier hs-var hs-var">not_rebindable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcRn -&gt; XRec GhcRn (IdP GhcRn) -&gt; HsExpr GhcRn
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; GenLocated SrcSpanAnnN Name
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068205"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1439"></span><span>
</span><span id="line-1440"></span><span class="hs-comment">-- | Is this a context where we respect RebindableSyntax?</span><span>
</span><span id="line-1441"></span><span class="hs-comment">-- but ListComp are never rebindable</span><span>
</span><span id="line-1442"></span><span class="hs-comment">-- Neither is ArrowExpr, which has its own desugarer in GHC.HsToCore.Arrows</span><span>
</span><span id="line-1443"></span><span class="annot"><a href="GHC.Rename.Expr.html#rebindableContext"><span class="hs-identifier hs-type">rebindableContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1444"></span><span id="rebindableContext"><span class="annot"><span class="annottext">rebindableContext :: HsStmtContextRn -&gt; Bool
</span><a href="GHC.Rename.Expr.html#rebindableContext"><span class="hs-identifier hs-var hs-var">rebindableContext</span></a></span></span><span> </span><span id="local-6989586621683068210"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068210"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068210"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1445"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span id="local-6989586621683068211"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068211"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour -&gt; Bool
</span><a href="GHC.Rename.Expr.html#rebindableDoStmtContext"><span class="hs-identifier hs-var">rebindableDoStmtContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068211"><span class="hs-identifier hs-var">flavour</span></a></span><span>
</span><span id="line-1446"></span><span>  </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowExpr"><span class="hs-identifier hs-var">ArrowExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1447"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#PatGuard"><span class="hs-identifier hs-type">PatGuard</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span>
</span><span id="line-1450"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtCtxt"><span class="hs-identifier hs-type">ParStmtCtxt</span></a></span><span>   </span><span id="local-6989586621683068214"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068214"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Bool
</span><a href="GHC.Rename.Expr.html#rebindableContext"><span class="hs-identifier hs-var">rebindableContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068214"><span class="hs-identifier hs-var">c</span></a></span><span>     </span><span class="hs-comment">-- Look inside to</span><span>
</span><span id="line-1451"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmtCtxt"><span class="hs-identifier hs-type">TransStmtCtxt</span></a></span><span> </span><span id="local-6989586621683068215"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068215"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Bool
</span><a href="GHC.Rename.Expr.html#rebindableContext"><span class="hs-identifier hs-var">rebindableContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068215"><span class="hs-identifier hs-var">c</span></a></span><span>     </span><span class="hs-comment">-- the parent context</span><span>
</span><span id="line-1452"></span><span>
</span><span id="line-1453"></span><span class="annot"><a href="GHC.Rename.Expr.html#rebindableDoStmtContext"><span class="hs-identifier hs-type">rebindableDoStmtContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1454"></span><span id="rebindableDoStmtContext"><span class="annot"><span class="annottext">rebindableDoStmtContext :: HsDoFlavour -&gt; Bool
</span><a href="GHC.Rename.Expr.html#rebindableDoStmtContext"><span class="hs-identifier hs-var hs-var">rebindableDoStmtContext</span></a></span></span><span> </span><span id="local-6989586621683068216"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068216"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068216"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1455"></span><span>  </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#ListComp"><span class="hs-identifier hs-var">ListComp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1456"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-type">DoExpr</span></a></span><span> </span><span id="local-6989586621683068218"><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621683068218"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621683068218"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1457"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MDoExpr"><span class="hs-identifier hs-type">MDoExpr</span></a></span><span> </span><span id="local-6989586621683068220"><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621683068220"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621683068220"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1458"></span><span>  </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#MonadComp"><span class="hs-identifier hs-var">MonadComp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1459"></span><span>  </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- I suppose?</span><span>
</span><span id="line-1460"></span><span>
</span><span id="line-1461"></span><span class="hs-comment">{-
Note [Renaming parallel Stmts]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Renaming parallel statements is painful.  Given, say
     [ a+c | a &lt;- as, bs &lt;- bss
           | c &lt;- bs, a &lt;- ds ]
Note that
  (a) In order to report &quot;Defined but not used&quot; about 'bs', we must
      rename each group of Stmts with a thing_inside whose FreeVars
      include at least {a,c}

  (b) We want to report that 'a' is illegally bound in both branches

  (c) The 'bs' in the second group must obviously not be captured by
      the binding in the first group

To satisfy (a) we nest the segments.
To satisfy (b) we check for duplicates just before thing_inside.
To satisfy (c) we reset the LocalRdrEnv each time.

************************************************************************
*                                                                      *
\subsubsection{mdo expressions}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1487"></span><span>
</span><span id="line-1488"></span><span class="hs-keyword">type</span><span> </span><span id="FwdRefs"><span class="annot"><a href="GHC.Rename.Expr.html#FwdRefs"><span class="hs-identifier hs-var">FwdRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>
</span><span id="line-1489"></span><span class="hs-keyword">type</span><span> </span><span id="Segment"><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-var">Segment</span></a></span></span><span> </span><span id="local-6989586621683068225"><span class="annot"><a href="#local-6989586621683068225"><span class="hs-identifier hs-type">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1490"></span><span>                      </span><span class="annot"><a href="GHC.Types.Name.Set.html#Uses"><span class="hs-identifier hs-type">Uses</span></a></span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- May include defs</span><span>
</span><span id="line-1491"></span><span>                      </span><span class="annot"><a href="GHC.Rename.Expr.html#FwdRefs"><span class="hs-identifier hs-type">FwdRefs</span></a></span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- A subset of uses that are</span><span>
</span><span id="line-1492"></span><span>                                </span><span class="hs-comment">--   (a) used before they are bound in this segment, or</span><span>
</span><span id="line-1493"></span><span>                                </span><span class="hs-comment">--   (b) used here, and bound in subsequent segments</span><span>
</span><span id="line-1494"></span><span>                      </span><span class="annot"><a href="#local-6989586621683068225"><span class="hs-identifier hs-type">stmts</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Either Stmt or [Stmt]</span><span>
</span><span id="line-1495"></span><span>
</span><span id="line-1496"></span><span>
</span><span id="line-1497"></span><span class="hs-comment">-- wrapper that does both the left- and right-hand sides</span><span>
</span><span id="line-1498"></span><span id="local-6989586621683066287"><span id="local-6989586621683066289"><span class="annot"><a href="GHC.Rename.Expr.html#rnRecStmtsAndThen"><span class="hs-identifier hs-type">rnRecStmtsAndThen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066287"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-1499"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1500"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066287"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066287"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1501"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066287"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1502"></span><span>                         </span><span class="hs-comment">-- assumes that the FreeVars returned includes</span><span>
</span><span id="line-1503"></span><span>                         </span><span class="hs-comment">-- the FreeVars of the Segments</span><span>
</span><span id="line-1504"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066287"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1505"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066289"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1506"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066289"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1507"></span><span id="rnRecStmtsAndThen"><span class="annot"><span class="annottext">rnRecStmtsAndThen :: forall (body :: * -&gt; *) a.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
    -&gt; RnM (a, FreeVars))
-&gt; RnM (a, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnRecStmtsAndThen"><span class="hs-identifier hs-var hs-var">rnRecStmtsAndThen</span></a></span></span><span> </span><span id="local-6989586621683068246"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068246"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068247"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068247"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span id="local-6989586621683068248"><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
</span><a href="#local-6989586621683068248"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621683068249"><span class="annot"><span class="annottext">[Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
-&gt; RnM (a, FreeVars)
</span><a href="#local-6989586621683068249"><span class="hs-identifier hs-var">cont</span></a></span></span><span>
</span><span id="line-1508"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- (A) Make the mini fixity env for all of the stmts</span><span>
</span><span id="line-1509"></span><span>          </span><span id="local-6989586621683068250"><span class="annot"><a href="#local-6989586621683068250"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LFixitySig GhcPs] -&gt; RnM MiniFixityEnv
</span><a href="GHC.Rename.Bind.html#makeMiniFixityEnv"><span class="hs-identifier hs-var">makeMiniFixityEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))] -&gt; [LFixitySig GhcPs]
forall body. [LStmtLR GhcPs GhcPs body] -&gt; [LFixitySig GhcPs]
</span><a href="GHC.Rename.Expr.html#collectRecStmtsFixities"><span class="hs-identifier hs-var">collectRecStmtsFixities</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
</span><a href="#local-6989586621683068248"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1510"></span><span>
</span><span id="line-1511"></span><span>          </span><span class="hs-comment">-- (B) Do the LHSes</span><span>
</span><span id="line-1512"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683068252"><span class="annot"><a href="#local-6989586621683068252"><span class="hs-identifier hs-var">new_lhs_and_fv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmts_lhs"><span class="hs-identifier hs-type">rn_rec_stmts_lhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068250"><span class="hs-identifier hs-type">fix_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068248"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1513"></span><span>
</span><span id="line-1514"></span><span>          </span><span class="hs-comment">--    ...bring them and their fixities into scope</span><span>
</span><span id="line-1515"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068254"><span class="annot"><a href="#local-6989586621683068254"><span class="hs-identifier hs-var hs-var">bound_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
-&gt; [LStmtLR GhcRn GhcPs (LocatedA (body GhcPs))] -&gt; [IdP GhcRn]
forall (idL :: Pass) (idR :: Pass) body.
(IsPass idL, IsPass idR, CollectPass (GhcPass idL)) =&gt;
CollectFlag (GhcPass idL)
-&gt; [LStmtLR (GhcPass idL) (GhcPass idR) body]
-&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLStmtsBinders"><span class="hs-identifier hs-var">collectLStmtsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)
 -&gt; GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))))
-&gt; [(GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
     FreeVars)]
-&gt; [GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)]
</span><a href="#local-6989586621683068252"><span class="hs-identifier hs-var">new_lhs_and_fv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1516"></span><span>              </span><span class="hs-comment">-- Fake uses of variables introduced implicitly (warning suppression, see #4404)</span><span>
</span><span id="line-1517"></span><span>              </span><span id="local-6989586621683068256"><span class="annot"><a href="#local-6989586621683068256"><span class="hs-identifier hs-var hs-var">rec_uses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LStmtLR GhcRn GhcPs (LocatedA (body GhcPs))]
-&gt; [(SrcSpan, [ImplicitFieldBinders])]
forall (idR :: Pass) (body :: * -&gt; *).
IsPass idR =&gt;
[LStmtLR GhcRn (GhcPass idR) (LocatedA (body (GhcPass idR)))]
-&gt; [(SrcSpan, [ImplicitFieldBinders])]
</span><a href="GHC.Hs.Utils.html#lStmtsImplicits"><span class="hs-identifier hs-var">lStmtsImplicits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)
 -&gt; GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))))
-&gt; [(GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
     FreeVars)]
-&gt; [GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)]
</span><a href="#local-6989586621683068252"><span class="hs-identifier hs-var">new_lhs_and_fv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1518"></span><span>              </span><span id="local-6989586621683068258"><span class="annot"><a href="#local-6989586621683068258"><span class="hs-identifier hs-var hs-var">implicit_uses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; FreeVars) -&gt; [Name] -&gt; FreeVars
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((SrcSpan, [ImplicitFieldBinders]) -&gt; [Name])
-&gt; [(SrcSpan, [ImplicitFieldBinders])] -&gt; [Name]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImplicitFieldBinders -&gt; [Name])
-&gt; [ImplicitFieldBinders] -&gt; [Name]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ImplicitFieldBinders -&gt; [Name]
</span><a href="GHC.Hs.Utils.html#implFlBndr_binders"><span class="hs-identifier hs-var">implFlBndr_binders</span></a></span><span> </span><span class="annot"><span class="annottext">([ImplicitFieldBinders] -&gt; [Name])
-&gt; ((SrcSpan, [ImplicitFieldBinders]) -&gt; [ImplicitFieldBinders])
-&gt; (SrcSpan, [ImplicitFieldBinders])
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SrcSpan, [ImplicitFieldBinders]) -&gt; [ImplicitFieldBinders]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(SrcSpan, [ImplicitFieldBinders])] -&gt; [Name])
-&gt; [(SrcSpan, [ImplicitFieldBinders])] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(SrcSpan, [ImplicitFieldBinders])]
</span><a href="#local-6989586621683068256"><span class="hs-identifier hs-var">rec_uses</span></a></span><span>
</span><span id="line-1519"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#bindLocalNamesFV"><span class="hs-identifier hs-type">bindLocalNamesFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068254"><span class="hs-identifier hs-type">bound_names</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1520"></span><span>          </span><span class="annot"><a href="GHC.Rename.Fixity.html#addLocalFixities"><span class="hs-identifier hs-type">addLocalFixities</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068250"><span class="hs-identifier hs-type">fix_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068254"><span class="hs-identifier hs-type">bound_names</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1521"></span><span>
</span><span id="line-1522"></span><span>          </span><span class="hs-comment">-- (C) do the right-hand-sides and thing-inside</span><span>
</span><span id="line-1523"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683068264"><span class="annot"><a href="#local-6989586621683068264"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmts"><span class="hs-identifier hs-type">rn_rec_stmts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068246"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068247"><span class="hs-identifier hs-type">rnBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068254"><span class="hs-identifier hs-type">bound_names</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068252"><span class="hs-identifier hs-type">new_lhs_and_fv</span></a></span><span>
</span><span id="line-1524"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068266"><span class="annot"><a href="#local-6989586621683068266"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068267"><span class="annot"><a href="#local-6989586621683068267"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683068249"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068264"><span class="hs-identifier hs-type">segs</span></a></span><span>
</span><span id="line-1525"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683068268"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683068268"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068269"><span class="annot"><span class="annottext">[ImplicitFieldBinders]
</span><a href="#local-6989586621683068269"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; FreeVars
-&gt; Maybe [ImplicitFieldBinders]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#checkUnusedRecordWildcard"><span class="hs-identifier hs-var">checkUnusedRecordWildcard</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683068268"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068267"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ImplicitFieldBinders] -&gt; Maybe [ImplicitFieldBinders]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[ImplicitFieldBinders]
</span><a href="#local-6989586621683068269"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>                </span><span class="annot"><a href="#local-6989586621683068256"><span class="hs-identifier hs-type">rec_uses</span></a></span><span>
</span><span id="line-1527"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#warnUnusedLocalBinds"><span class="hs-identifier hs-type">warnUnusedLocalBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068254"><span class="hs-identifier hs-type">bound_names</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068267"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-type">`unionNameSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068258"><span class="hs-identifier hs-type">implicit_uses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1528"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068266"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068267"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span class="hs-comment">-- get all the fixity decls in any Let stmt</span><span>
</span><span id="line-1531"></span><span id="local-6989586621683066346"><span class="annot"><a href="GHC.Rename.Expr.html#collectRecStmtsFixities"><span class="hs-identifier hs-type">collectRecStmtsFixities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmtLR"><span class="hs-identifier hs-type">LStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066346"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1532"></span><span id="collectRecStmtsFixities"><span class="annot"><span class="annottext">collectRecStmtsFixities :: forall body. [LStmtLR GhcPs GhcPs body] -&gt; [LFixitySig GhcPs]
</span><a href="GHC.Rename.Expr.html#collectRecStmtsFixities"><span class="hs-identifier hs-var hs-var">collectRecStmtsFixities</span></a></span></span><span> </span><span id="local-6989586621683068272"><span class="annot"><span class="annottext">[LStmtLR GhcPs GhcPs body]
</span><a href="#local-6989586621683068272"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1533"></span><span>    </span><span class="annot"><span class="annottext">(GenLocated
   (Anno (StmtLR GhcPs GhcPs body)) (StmtLR GhcPs GhcPs body)
 -&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
 -&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)])
-&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
-&gt; [GenLocated
      (Anno (StmtLR GhcPs GhcPs body)) (StmtLR GhcPs GhcPs body)]
-&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683068273"><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcPs GhcPs body)) (StmtLR GhcPs GhcPs body)
</span><a href="#local-6989586621683068273"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683068274"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (FixitySig GhcPs)]
</span><a href="#local-6989586621683068274"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcPs GhcPs body)) (StmtLR GhcPs GhcPs body)
</span><a href="#local-6989586621683068273"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1534"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">Anno (StmtLR GhcPs GhcPs body)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcPs GhcPs body
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XHsValBinds GhcPs GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#ValBinds"><span class="hs-identifier hs-type">ValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XValBinds GhcPs GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsBindsLR GhcPs GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068277"><span class="annot"><span class="annottext">[LSig GhcPs]
</span><a href="#local-6989586621683068277"><span class="hs-identifier hs-var">sigs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1535"></span><span>              </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Sig GhcPs)
 -&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
 -&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)])
-&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
-&gt; [GenLocated SrcSpanAnnA (Sig GhcPs)]
-&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683068278"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Sig GhcPs)
</span><a href="#local-6989586621683068278"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683068279"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (FixitySig GhcPs)]
</span><a href="#local-6989586621683068279"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Sig GhcPs)
</span><a href="#local-6989586621683068278"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1536"></span><span>                                         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068280"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068280"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FixSig"><span class="hs-identifier hs-type">FixSig</span></a></span><span> </span><span class="annot"><span class="annottext">XFixSig GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068282"><span class="annot"><span class="annottext">FixitySig GhcPs
</span><a href="#local-6989586621683068282"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; FixitySig GhcPs -&gt; GenLocated SrcSpanAnnA (FixitySig GhcPs)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068280"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FixitySig GhcPs
</span><a href="#local-6989586621683068282"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (FixitySig GhcPs)
-&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
-&gt; [GenLocated SrcSpanAnnA (FixitySig GhcPs)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (FixitySig GhcPs)]
</span><a href="#local-6989586621683068279"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1537"></span><span>                                         </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Sig GhcPs)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (FixitySig GhcPs)]
</span><a href="#local-6989586621683068279"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (FixitySig GhcPs)]
</span><a href="#local-6989586621683068274"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcPs]
[GenLocated SrcSpanAnnA (Sig GhcPs)]
</span><a href="#local-6989586621683068277"><span class="hs-identifier hs-var">sigs</span></a></span><span>
</span><span id="line-1538"></span><span>            </span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcPs GhcPs body)) (StmtLR GhcPs GhcPs body)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (FixitySig GhcPs)]
</span><a href="#local-6989586621683068274"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[LStmtLR GhcPs GhcPs body]
[GenLocated
   (Anno (StmtLR GhcPs GhcPs body)) (StmtLR GhcPs GhcPs body)]
</span><a href="#local-6989586621683068272"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1539"></span><span>
</span><span id="line-1540"></span><span class="hs-comment">-- left-hand sides</span><span>
</span><span id="line-1541"></span><span>
</span><span id="line-1542"></span><span id="local-6989586621683066370"><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-type">rn_rec_stmt_lhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066370"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a></span><span>
</span><span id="line-1543"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066370"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1544"></span><span>                   </span><span class="hs-comment">-- rename LHS, and return its FVs</span><span>
</span><span id="line-1545"></span><span>                   </span><span class="hs-comment">-- Warning: we will only need the FreeVars below in the case of a BindStmt,</span><span>
</span><span id="line-1546"></span><span>                   </span><span class="hs-comment">-- so we don't bother to compute it accurately in the other cases</span><span>
</span><span id="line-1547"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmtLR"><span class="hs-identifier hs-type">LStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066370"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-1548"></span><span>
</span><span id="line-1549"></span><span id="rn_rec_stmt_lhs"><span class="annot"><span class="annottext">rn_rec_stmt_lhs :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
MiniFixityEnv
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; RnM [(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)]
</span><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var hs-var">rn_rec_stmt_lhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068309"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068309"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068310"><span class="annot"><span class="annottext">LocatedA (body GhcPs)
</span><a href="#local-6989586621683068310"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621683068311"><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><a href="#local-6989586621683068311"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621683068312"><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><a href="#local-6989586621683068312"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR GhcRn GhcPs (LocatedA (body GhcPs))
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068309"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcPs (LocatedA (body GhcPs))
-&gt; LocatedA (body GhcPs)
-&gt; SyntaxExpr GhcPs
-&gt; SyntaxExpr GhcPs
-&gt; StmtLR GhcRn GhcPs (LocatedA (body GhcPs))
forall idL idR body.
XBodyStmt idL idR body
-&gt; body -&gt; SyntaxExpr idR -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcPs (LocatedA (body GhcPs))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (body GhcPs)
</span><a href="#local-6989586621683068310"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><a href="#local-6989586621683068311"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><a href="#local-6989586621683068312"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1551"></span><span>
</span><span id="line-1552"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068313"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068313"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068314"><span class="annot"><span class="annottext">LocatedA (body GhcPs)
</span><a href="#local-6989586621683068314"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621683068315"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621683068315"><span class="hs-identifier hs-var">noret</span></a></span></span><span> </span><span id="local-6989586621683068316"><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><a href="#local-6989586621683068316"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1553"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR GhcRn GhcPs (LocatedA (body GhcPs))
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068313"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLastStmt GhcRn GhcPs (LocatedA (body GhcPs))
-&gt; LocatedA (body GhcPs)
-&gt; Maybe Bool
-&gt; SyntaxExpr GhcPs
-&gt; StmtLR GhcRn GhcPs (LocatedA (body GhcPs))
forall idL idR body.
XLastStmt idL idR body
-&gt; body -&gt; Maybe Bool -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-var">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt GhcRn GhcPs (LocatedA (body GhcPs))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (body GhcPs)
</span><a href="#local-6989586621683068314"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621683068315"><span class="hs-identifier hs-var">noret</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><a href="#local-6989586621683068316"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1554"></span><span>
</span><span id="line-1555"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span id="local-6989586621683068317"><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068317"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068318"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068318"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068319"><span class="annot"><span class="annottext">LPat GhcPs
</span><a href="#local-6989586621683068319"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683068320"><span class="annot"><span class="annottext">LocatedA (body GhcPs)
</span><a href="#local-6989586621683068320"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1557"></span><span>      </span><span class="hs-comment">-- should the ctxt be MDo instead?</span><span>
</span><span id="line-1558"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683068321"><span class="annot"><a href="#local-6989586621683068321"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068322"><span class="annot"><a href="#local-6989586621683068322"><span class="hs-identifier hs-var">fv_pat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameMaker -&gt; LPat GhcPs -&gt; RnM (LPat GhcRn, FreeVars)
</span><a href="GHC.Rename.Pat.html#rnBindPat"><span class="hs-identifier hs-var">rnBindPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniFixityEnv -&gt; NameMaker
</span><a href="GHC.Rename.Pat.html#localRecNameMaker"><span class="hs-identifier hs-var">localRecNameMaker</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068317"><span class="hs-identifier hs-var">fix_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat GhcPs
</span><a href="#local-6989586621683068319"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-1559"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068318"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068321"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068320"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068322"><span class="hs-identifier hs-type">fv_pat</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1560"></span><span>
</span><span id="line-1561"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068325"><span class="annot"><span class="annottext">binds :: HsLocalBinds GhcPs
</span><a href="#local-6989586621683068325"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsIPBinds"><span class="hs-identifier hs-type">HsIPBinds</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1562"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (HsLocalBinds GhcPs) (HsLocalBindsLR GhcRn GhcPs)
-&gt; TcRnMessage
</span><a href="GHC.Rename.Expr.html#badIpBinds"><span class="hs-identifier hs-var">badIpBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
-&gt; Either (HsLocalBinds GhcPs) (HsLocalBindsLR GhcRn GhcPs)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcPs
</span><a href="#local-6989586621683068325"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1563"></span><span>
</span><span id="line-1564"></span><span>
</span><span id="line-1565"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span id="local-6989586621683068329"><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068329"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068330"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068330"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span id="local-6989586621683068331"><span class="annot"><span class="annottext">XHsValBinds GhcPs GhcPs
</span><a href="#local-6989586621683068331"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683068332"><span class="annot"><span class="annottext">HsValBindsLR GhcPs GhcPs
</span><a href="#local-6989586621683068332"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1566"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068333"><span class="annot"><a href="#local-6989586621683068333"><span class="hs-identifier hs-var">_bound_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068334"><span class="annot"><a href="#local-6989586621683068334"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
-&gt; HsValBindsLR GhcPs GhcPs
-&gt; RnM ([Name], HsValBindsLR GhcRn GhcPs)
</span><a href="GHC.Rename.Bind.html#rnLocalValBindsLHS"><span class="hs-identifier hs-var">rnLocalValBindsLHS</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068329"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">HsValBindsLR GhcPs GhcPs
</span><a href="#local-6989586621683068332"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1567"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068330"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068331"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068334"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1568"></span><span>                 </span><span class="hs-comment">-- Warning: this is bogus; see function invariant</span><span>
</span><span id="line-1569"></span><span>                 </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span>
</span><span id="line-1570"></span><span>                 </span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1571"></span><span>
</span><span id="line-1572"></span><span class="hs-comment">-- XXX Do we need to do something with the return and mfix names?</span><span>
</span><span id="line-1573"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span id="local-6989586621683068335"><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068335"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recS_stmts :: forall idL idR body.
StmtLR idL idR body -&gt; XRec idR [LStmtLR idL idR body]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068336"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
</span><a href="#local-6989586621683068336"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Flatten Rec inside Rec</span><span>
</span><span id="line-1574"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(XRec GhcRn (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall (body :: * -&gt; *).
AnnoBody body =&gt;
MiniFixityEnv
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; RnM [(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)]
</span><a href="GHC.Rename.Expr.html#rn_rec_stmts_lhs"><span class="hs-identifier hs-var">rn_rec_stmts_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068335"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
</span><a href="#local-6989586621683068336"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-1575"></span><span>
</span><span id="line-1576"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068337"><span class="annot"><span class="annottext">stmt :: LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683068337"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Syntactically illegal in mdo</span><span>
</span><span id="line-1577"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_rec_stmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
</span><a href="#local-6989586621683068337"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068338"><span class="annot"><span class="annottext">stmt :: LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683068338"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Syntactically illegal in mdo</span><span>
</span><span id="line-1580"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_rec_stmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
</span><a href="#local-6989586621683068338"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>
</span><span id="line-1582"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#EmptyLocalBinds"><span class="hs-identifier hs-type">EmptyLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XEmptyLocalBinds GhcPs GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_rec_stmt LetStmt EmptyLocalBinds&quot;</span></span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span id="local-6989586621683066347"><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmts_lhs"><span class="hs-identifier hs-type">rn_rec_stmts_lhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066347"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a></span><span>
</span><span id="line-1586"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066347"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1587"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmtLR"><span class="hs-identifier hs-type">LStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066347"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-1588"></span><span id="rn_rec_stmts_lhs"><span class="annot"><span class="annottext">rn_rec_stmts_lhs :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
MiniFixityEnv
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; RnM [(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)]
</span><a href="GHC.Rename.Expr.html#rn_rec_stmts_lhs"><span class="hs-identifier hs-var hs-var">rn_rec_stmts_lhs</span></a></span></span><span> </span><span id="local-6989586621683068351"><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068351"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span id="local-6989586621683068352"><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
</span><a href="#local-6989586621683068352"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-1589"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683068353"><span class="annot"><a href="#local-6989586621683068353"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      [(GenLocated
          SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
        FreeVars)])
-&gt; [GenLocated
      SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniFixityEnv
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(XRec GhcRn (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
       FreeVars)]
forall (body :: * -&gt; *).
AnnoBody body =&gt;
MiniFixityEnv
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; RnM [(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)]
</span><a href="GHC.Rename.Expr.html#rn_rec_stmt_lhs"><span class="hs-identifier hs-var">rn_rec_stmt_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MiniFixityEnv
</span><a href="#local-6989586621683068351"><span class="hs-identifier hs-var">fix_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LStmt GhcPs (LocatedA (body GhcPs))]
[GenLocated
   SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))]
</span><a href="#local-6989586621683068352"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-1590"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068355"><span class="annot"><a href="#local-6989586621683068355"><span class="hs-identifier hs-var hs-var">boundNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
-&gt; [XRec GhcRn (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))]
-&gt; [IdP GhcRn]
forall (idL :: Pass) (idR :: Pass) body.
(IsPass idL, IsPass idR, CollectPass (GhcPass idL)) =&gt;
CollectFlag (GhcPass idL)
-&gt; [LStmtLR (GhcPass idL) (GhcPass idR) body]
-&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLStmtsBinders"><span class="hs-identifier hs-var">collectLStmtsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)
 -&gt; GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))))
-&gt; [(GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
     FreeVars)]
-&gt; [GenLocated
      SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs)))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)]
</span><a href="#local-6989586621683068353"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1591"></span><span>            </span><span class="hs-comment">-- First do error checking: we need to check for dups here because we</span><span>
</span><span id="line-1592"></span><span>            </span><span class="hs-comment">-- don't bind all of the variables from the Stmt at once</span><span>
</span><span id="line-1593"></span><span>            </span><span class="hs-comment">-- with bindLocatedLocals.</span><span>
</span><span id="line-1594"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#checkDupNames"><span class="hs-identifier hs-type">checkDupNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068355"><span class="hs-identifier hs-type">boundNames</span></a></span><span>
</span><span id="line-1595"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683068353"><span class="hs-identifier hs-type">ls</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1596"></span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span class="hs-comment">-- right-hand-sides</span><span>
</span><span id="line-1599"></span><span>
</span><span id="line-1600"></span><span id="local-6989586621683066389"><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-type">rn_rec_stmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066389"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1601"></span><span>               </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1602"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066389"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066389"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1603"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1604"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmtLR"><span class="hs-identifier hs-type">LStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066389"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1605"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066389"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-1606"></span><span>        </span><span class="hs-comment">-- Rename a Stmt that is inside a RecStmt (or mdo)</span><span>
</span><span id="line-1607"></span><span>        </span><span class="hs-comment">-- Assumes all binders are already in scope</span><span>
</span><span id="line-1608"></span><span>        </span><span class="hs-comment">-- Turns each stmt into a singleton Stmt</span><span>
</span><span id="line-1609"></span><span id="rn_rec_stmt"><span class="annot"><span class="annottext">rn_rec_stmt :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [Name]
-&gt; (LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
-&gt; RnM [Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var hs-var">rn_rec_stmt</span></a></span></span><span> </span><span id="local-6989586621683068391"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068391"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068392"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068392"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068393"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068393"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt GhcRn GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068394"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068394"><span class="hs-identifier hs-var">lb</span></a></span></span><span> </span><span id="local-6989586621683068395"><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068395"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068396"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621683068396"><span class="hs-identifier hs-var">noret</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068397"><span class="annot"><a href="#local-6989586621683068397"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068398"><span class="annot"><a href="#local-6989586621683068398"><span class="hs-identifier hs-var">fv_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068392"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068395"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1611"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068399"><span class="annot"><a href="#local-6989586621683068399"><span class="hs-identifier hs-var">ret_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068400"><span class="annot"><a href="#local-6989586621683068400"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDo"><span class="hs-identifier hs-type">lookupQualifiedDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068391"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#returnMName"><span class="hs-identifier hs-type">returnMName</span></a></span><span>
</span><span id="line-1612"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068398"><span class="hs-identifier hs-type">fv_expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068400"><span class="hs-identifier hs-type">fvs1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1613"></span><span>                   </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068393"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068394"><span class="hs-identifier hs-type">lb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068397"><span class="hs-identifier hs-type">body'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068396"><span class="hs-identifier hs-type">noret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068399"><span class="hs-identifier hs-type">ret_op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1614"></span><span>
</span><span id="line-1615"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span id="local-6989586621683068402"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068402"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068403"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068403"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068404"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068404"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068405"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068405"><span class="hs-identifier hs-var">lb</span></a></span></span><span> </span><span id="local-6989586621683068406"><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068406"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1616"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068407"><span class="annot"><a href="#local-6989586621683068407"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068408"><span class="annot"><a href="#local-6989586621683068408"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068403"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068406"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1617"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068409"><span class="annot"><a href="#local-6989586621683068409"><span class="hs-identifier hs-var">then_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068410"><span class="annot"><a href="#local-6989586621683068410"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDo"><span class="hs-identifier hs-type">lookupQualifiedDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068402"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#thenMName"><span class="hs-identifier hs-type">thenMName</span></a></span><span>
</span><span id="line-1618"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068408"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068410"><span class="hs-identifier hs-type">fvs1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1619"></span><span>                 </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068404"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068405"><span class="hs-identifier hs-type">lb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068407"><span class="hs-identifier hs-type">body'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068409"><span class="hs-identifier hs-type">then_op</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span id="local-6989586621683068411"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068411"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068412"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068412"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068413"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068413"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068414"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068414"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068415"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068415"><span class="hs-identifier hs-var">lb</span></a></span></span><span> </span><span id="local-6989586621683068416"><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068416"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068417"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068417"><span class="hs-identifier hs-var">fv_pat</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068418"><span class="annot"><a href="#local-6989586621683068418"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068419"><span class="annot"><a href="#local-6989586621683068419"><span class="hs-identifier hs-var">fv_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068412"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs
</span><a href="#local-6989586621683068416"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1623"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068420"><span class="annot"><a href="#local-6989586621683068420"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068421"><span class="annot"><a href="#local-6989586621683068421"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDo"><span class="hs-identifier hs-type">lookupQualifiedDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068411"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#bindMName"><span class="hs-identifier hs-type">bindMName</span></a></span><span>
</span><span id="line-1624"></span><span>
</span><span id="line-1625"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068422"><span class="annot"><a href="#local-6989586621683068422"><span class="hs-identifier hs-var">fail_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068423"><span class="annot"><a href="#local-6989586621683068423"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#getMonadFailOp"><span class="hs-identifier hs-type">getMonadFailOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068411"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1626"></span><span>
</span><span id="line-1627"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068425"><span class="annot"><a href="#local-6989586621683068425"><span class="hs-identifier hs-var hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag GhcRn -&gt; LPat GhcRn -&gt; [IdP GhcRn]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068414"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1628"></span><span>             </span><span id="local-6989586621683068426"><span class="annot"><a href="#local-6989586621683068426"><span class="hs-identifier hs-var hs-var">fvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068419"><span class="hs-identifier hs-var">fv_expr</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068417"><span class="hs-identifier hs-var">fv_pat</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068421"><span class="hs-identifier hs-var">fvs1</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068423"><span class="hs-identifier hs-var">fvs2</span></a></span><span>
</span><span id="line-1629"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068427"><span class="annot"><a href="#local-6989586621683068427"><span class="hs-identifier hs-var hs-var">xbsrn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#XBindStmtRn"><span class="hs-identifier hs-type">XBindStmtRn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xbsrn_bindOp :: SyntaxExpr GhcRn
</span><a href="GHC.Hs.Expr.html#xbsrn_bindOp"><span class="hs-identifier hs-var">xbsrn_bindOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621683068420"><span class="hs-identifier hs-var">bind_op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbsrn_failOp :: Maybe (SyntaxExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#xbsrn_failOp"><span class="hs-identifier hs-var">xbsrn_failOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
Maybe SyntaxExprRn
</span><a href="#local-6989586621683068422"><span class="hs-identifier hs-var">fail_op</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1630"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068425"><span class="hs-identifier hs-type">bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068426"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068425"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#intersectNameSet"><span class="hs-operator hs-type">`intersectNameSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068426"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1631"></span><span>                  </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068413"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068427"><span class="hs-identifier hs-type">xbsrn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068414"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068415"><span class="hs-identifier hs-type">lb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068418"><span class="hs-identifier hs-type">body'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcRn GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068429"><span class="annot"><span class="annottext">binds :: HsLocalBindsLR GhcRn GhcPs
</span><a href="#local-6989586621683068429"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsIPBinds"><span class="hs-identifier hs-type">HsIPBinds</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(FreeVars, FreeVars, FreeVars,
       GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (HsLocalBinds GhcPs) (HsLocalBindsLR GhcRn GhcPs)
-&gt; TcRnMessage
</span><a href="GHC.Rename.Expr.html#badIpBinds"><span class="hs-identifier hs-var">badIpBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLocalBindsLR GhcRn GhcPs
-&gt; Either (HsLocalBinds GhcPs) (HsLocalBindsLR GhcRn GhcPs)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">HsLocalBindsLR GhcRn GhcPs
</span><a href="#local-6989586621683068429"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1635"></span><span>
</span><span id="line-1636"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068430"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068430"><span class="hs-identifier hs-var">all_bndrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068431"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068431"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcRn GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span id="local-6989586621683068432"><span class="annot"><span class="annottext">XHsValBinds GhcRn GhcPs
</span><a href="#local-6989586621683068432"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683068433"><span class="annot"><span class="annottext">HsValBindsLR GhcRn GhcPs
</span><a href="#local-6989586621683068433"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068434"><span class="annot"><a href="#local-6989586621683068434"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068435"><span class="annot"><a href="#local-6989586621683068435"><span class="hs-identifier hs-var">du_binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FreeVars
-&gt; HsValBindsLR GhcRn GhcPs -&gt; RnM (HsValBinds GhcRn, DefUses)
</span><a href="GHC.Rename.Bind.html#rnLocalValBindsRHS"><span class="hs-identifier hs-var">rnLocalValBindsRHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068430"><span class="hs-identifier hs-var">all_bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsValBindsLR GhcRn GhcPs
</span><a href="#local-6989586621683068433"><span class="hs-identifier hs-var">binds'</span></a></span><span>
</span><span id="line-1638"></span><span>           </span><span class="hs-comment">-- fixities and unused are handled above in rnRecStmtsAndThen</span><span>
</span><span id="line-1639"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068436"><span class="annot"><a href="#local-6989586621683068436"><span class="hs-identifier hs-var hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefUses -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#allUses"><span class="hs-identifier hs-var">allUses</span></a></span><span> </span><span class="annot"><span class="annottext">DefUses
</span><a href="#local-6989586621683068435"><span class="hs-identifier hs-var">du_binds</span></a></span><span>
</span><span id="line-1640"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#duDefs"><span class="hs-identifier hs-type">duDefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068435"><span class="hs-identifier hs-type">du_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068436"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1641"></span><span>                 </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068431"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068432"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068434"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span class="hs-comment">-- no RecStmt case because they get flattened above when doing the LHSes</span><span>
</span><span id="line-1644"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068439"><span class="annot"><span class="annottext">stmt :: (LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
</span><a href="#local-6989586621683068439"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(FreeVars, FreeVars, FreeVars,
       GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_rec_stmt: RecStmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
</span><a href="#local-6989586621683068439"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068440"><span class="annot"><span class="annottext">stmt :: (LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
</span><a href="#local-6989586621683068440"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Syntactically illegal in mdo</span><span>
</span><span id="line-1648"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(FreeVars, FreeVars, FreeVars,
       GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_rec_stmt: ParStmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
</span><a href="#local-6989586621683068440"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1649"></span><span>
</span><span id="line-1650"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068441"><span class="annot"><span class="annottext">stmt :: (LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
</span><a href="#local-6989586621683068441"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Syntactically illegal in mdo</span><span>
</span><span id="line-1651"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(FreeVars, FreeVars, FreeVars,
       GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_rec_stmt: TransStmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
(GenLocated
   SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
 FreeVars)
</span><a href="#local-6989586621683068441"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1652"></span><span>
</span><span id="line-1653"></span><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcRn GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#EmptyLocalBinds"><span class="hs-identifier hs-type">EmptyLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XEmptyLocalBinds GhcRn GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(FreeVars, FreeVars, FreeVars,
       GenLocated
         SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_rec_stmt: LetStmt EmptyLocalBinds&quot;</span></span><span>
</span><span id="line-1655"></span><span>
</span><span id="line-1656"></span><span id="local-6989586621683066360"><span class="annot"><a href="GHC.Rename.Expr.html#rn_rec_stmts"><span class="hs-identifier hs-type">rn_rec_stmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066360"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-1657"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1658"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066360"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066360"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1659"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1660"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmtLR"><span class="hs-identifier hs-type">LStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066360"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1661"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066360"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-1662"></span><span id="rn_rec_stmts"><span class="annot"><span class="annottext">rn_rec_stmts :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [Name]
-&gt; [(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)]
-&gt; RnM [Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="GHC.Rename.Expr.html#rn_rec_stmts"><span class="hs-identifier hs-var hs-var">rn_rec_stmts</span></a></span></span><span> </span><span id="local-6989586621683068449"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068449"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068450"><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068450"><span class="hs-identifier hs-var">rnBody</span></a></span></span><span> </span><span id="local-6989586621683068451"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068451"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621683068452"><span class="annot"><span class="annottext">[(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)]
</span><a href="#local-6989586621683068452"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-1663"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683068453"><span class="annot"><a href="#local-6989586621683068453"><span class="hs-identifier hs-var">segs_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      [Segment
         (GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))])
-&gt; [(GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
     FreeVars)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [[Segment
         (GenLocated
            SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [Name]
-&gt; (LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(FreeVars, FreeVars, FreeVars,
       XRec GhcRn (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))))]
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body GhcRn, FreeVars))
-&gt; [Name]
-&gt; (LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)
-&gt; RnM [Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="GHC.Rename.Expr.html#rn_rec_stmt"><span class="hs-identifier hs-var">rn_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068449"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">body GhcPs -&gt; RnM (body GhcRn, FreeVars)
</span><a href="#local-6989586621683068450"><span class="hs-identifier hs-var">rnBody</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683068451"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LStmtLR GhcRn GhcPs (LocatedA (body GhcPs)), FreeVars)]
[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcPs (LocatedA (body GhcPs))),
  FreeVars)]
</span><a href="#local-6989586621683068452"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-1664"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621683068453"><span class="hs-identifier hs-type">segs_s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1665"></span><span>
</span><span id="line-1666"></span><span class="hs-comment">---------------------------------------------</span><span>
</span><span id="line-1667"></span><span id="local-6989586621683066294"><span class="annot"><a href="GHC.Rename.Expr.html#segmentRecStmts"><span class="hs-identifier hs-type">segmentRecStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1668"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Stmt"><span class="hs-identifier hs-type">Stmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066294"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1669"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066294"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1670"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-1671"></span><span>                    </span><span class="hs-comment">-- ^ The free variables used in later statements.</span><span>
</span><span id="line-1672"></span><span>                    </span><span class="hs-comment">-- If the boolean is 'True', this might be an underestimate</span><span>
</span><span id="line-1673"></span><span>                    </span><span class="hs-comment">-- because we are in GHCi, and might thus be missing some &quot;used later&quot;</span><span>
</span><span id="line-1674"></span><span>                    </span><span class="hs-comment">-- FVs. See Note [What is &quot;used later&quot; in a rec stmt]</span><span>
</span><span id="line-1675"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066294"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1676"></span><span>
</span><span id="line-1677"></span><span id="segmentRecStmts"><span class="annot"><span class="annottext">segmentRecStmts :: forall (body :: * -&gt; *).
SrcSpan
-&gt; HsStmtContextRn
-&gt; Stmt GhcRn (LocatedA (body GhcRn))
-&gt; [Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
-&gt; (FreeVars, Bool)
-&gt; ([LStmt GhcRn (LocatedA (body GhcRn))], FreeVars)
</span><a href="GHC.Rename.Expr.html#segmentRecStmts"><span class="hs-identifier hs-var hs-var">segmentRecStmts</span></a></span></span><span> </span><span id="local-6989586621683068461"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683068461"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683068462"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068462"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068463"><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068463"><span class="hs-identifier hs-var">empty_rec_stmt</span></a></span></span><span> </span><span id="local-6989586621683068464"><span class="annot"><span class="annottext">[Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621683068464"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068465"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068465"><span class="hs-identifier hs-var">fvs_later</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068466"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068466"><span class="hs-identifier hs-var">might_be_more_fvs_later</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1678"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
[Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
</span><a href="#local-6989586621683068464"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-1679"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068467"><span class="hs-identifier hs-var">final_fv_uses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>
</span><span id="line-1681"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MDoExpr"><span class="hs-identifier hs-type">MDoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068462"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1682"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
-&gt; [Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
-&gt; FreeVars
-&gt; ([LStmt GhcRn (LocatedA (body GhcRn))], FreeVars)
forall (body :: * -&gt; *).
Stmt GhcRn (LocatedA (body GhcRn))
-&gt; [Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
-&gt; FreeVars
-&gt; ([LStmt GhcRn (LocatedA (body GhcRn))], FreeVars)
</span><a href="GHC.Rename.Expr.html#segsToStmts"><span class="hs-identifier hs-var">segsToStmts</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068463"><span class="hs-identifier hs-var">empty_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
</span><a href="#local-6989586621683068469"><span class="hs-identifier hs-var">grouped_segs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068465"><span class="hs-identifier hs-var">fvs_later</span></a></span><span>
</span><span id="line-1683"></span><span>               </span><span class="hs-comment">-- Step 4: Turn the segments into Stmts</span><span>
</span><span id="line-1684"></span><span>                </span><span class="hs-comment">--         Use RecStmt when and only when there are fwd refs</span><span>
</span><span id="line-1685"></span><span>                </span><span class="hs-comment">--         Also gather up the uses from the end towards the</span><span>
</span><span id="line-1686"></span><span>                </span><span class="hs-comment">--         start, so we can tell the RecStmt which things are</span><span>
</span><span id="line-1687"></span><span>                </span><span class="hs-comment">--         used 'after' the RecStmt</span><span>
</span><span id="line-1688"></span><span>
</span><span id="line-1689"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1690"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; Stmt GhcRn (LocatedA (body GhcRn))
-&gt; GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683068461"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stmt GhcRn (LocatedA (body GhcRn))
 -&gt; GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))
-&gt; Stmt GhcRn (LocatedA (body GhcRn))
-&gt; GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1691"></span><span>       </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068463"><span class="hs-identifier hs-var">empty_rec_stmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068470"><span class="hs-identifier hs-type">ss</span></a></span><span>
</span><span id="line-1692"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_later_ids"><span class="hs-identifier hs-var">recS_later_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-type">nameSetElemsStable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068472"><span class="hs-identifier hs-type">final_fvs_later</span></a></span><span>
</span><span id="line-1693"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_rec_ids"><span class="hs-identifier hs-var">recS_rec_ids</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-type">nameSetElemsStable</span></a></span><span>
</span><span id="line-1694"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068474"><span class="hs-identifier hs-type">defs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#intersectNameSet"><span class="hs-operator hs-type">`intersectNameSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068475"><span class="hs-identifier hs-type">uses</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><span id="line-1695"></span><span>          </span><span class="hs-comment">-- See Note [Deterministic ApplicativeDo and RecursiveDo desugaring]</span><span>
</span><span id="line-1696"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068475"><span class="hs-identifier hs-var">uses</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068467"><span class="hs-identifier hs-var">final_fv_uses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1697"></span><span>
</span><span id="line-1698"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1699"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683068467"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068467"><span class="hs-identifier hs-var">final_fv_uses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068472"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068472"><span class="hs-identifier hs-var">final_fvs_later</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1700"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068466"><span class="hs-identifier hs-var">might_be_more_fvs_later</span></a></span><span>
</span><span id="line-1701"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068474"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068474"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1702"></span><span>        </span><span class="hs-comment">-- If there might be more uses later (e.g. we are in GHCi and have not</span><span>
</span><span id="line-1703"></span><span>        </span><span class="hs-comment">-- yet seen the whole rec statement), conservatively assume that everything</span><span>
</span><span id="line-1704"></span><span>        </span><span class="hs-comment">-- will be used later (as is possible).</span><span>
</span><span id="line-1705"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1706"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068475"><span class="hs-identifier hs-var">uses</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068465"><span class="hs-identifier hs-var">fvs_later</span></a></span><span>
</span><span id="line-1707"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068474"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#intersectNameSet"><span class="hs-operator hs-var">`intersectNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068465"><span class="hs-identifier hs-var">fvs_later</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1708"></span><span>
</span><span id="line-1709"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683068476"><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068476"><span class="hs-identifier hs-var">defs_s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068477"><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068477"><span class="hs-identifier hs-var">uses_s</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FreeVars]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068470"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621683068470"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
-&gt; ([FreeVars], [FreeVars], [FreeVars],
    [GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))])
forall a b c d. [(a, b, c, d)] -&gt; ([a], [b], [c], [d])
</span><span class="hs-identifier hs-var">unzip4</span></span><span> </span><span class="annot"><span class="annottext">[Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
[Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
</span><a href="#local-6989586621683068464"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-1710"></span><span>    </span><span id="local-6989586621683068474"><span class="annot"><span class="annottext">defs :: FreeVars
</span><a href="#local-6989586621683068474"><span class="hs-identifier hs-var hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068476"><span class="hs-identifier hs-var">defs_s</span></a></span><span>
</span><span id="line-1711"></span><span>    </span><span id="local-6989586621683068475"><span class="annot"><span class="annottext">uses :: FreeVars
</span><a href="#local-6989586621683068475"><span class="hs-identifier hs-var hs-var">uses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068477"><span class="hs-identifier hs-var">uses_s</span></a></span><span>
</span><span id="line-1712"></span><span>
</span><span id="line-1713"></span><span>                </span><span class="hs-comment">-- Step 2: Fill in the fwd refs.</span><span>
</span><span id="line-1714"></span><span>                </span><span class="hs-comment">--         The segments are all singletons, but their fwd-ref</span><span>
</span><span id="line-1715"></span><span>                </span><span class="hs-comment">--         field mentions all the things used by the segment</span><span>
</span><span id="line-1716"></span><span>                </span><span class="hs-comment">--         that are bound after their use</span><span>
</span><span id="line-1717"></span><span>    </span><span id="local-6989586621683068478"><span class="annot"><span class="annottext">segs_w_fwd_refs :: [Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
</span><a href="#local-6989586621683068478"><span class="hs-identifier hs-var hs-var">segs_w_fwd_refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
-&gt; [Segment
      (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
forall a. [Segment a] -&gt; [Segment a]
</span><a href="GHC.Rename.Expr.html#addFwdRefs"><span class="hs-identifier hs-var">addFwdRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
[Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
</span><a href="#local-6989586621683068464"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-1718"></span><span>
</span><span id="line-1719"></span><span>                </span><span class="hs-comment">-- Step 3: Group together the segments to make bigger segments</span><span>
</span><span id="line-1720"></span><span>                </span><span class="hs-comment">--         Invariant: in the result, no segment uses a variable</span><span>
</span><span id="line-1721"></span><span>                </span><span class="hs-comment">--                    bound in a later segment</span><span>
</span><span id="line-1722"></span><span>    </span><span id="local-6989586621683068469"><span class="annot"><span class="annottext">grouped_segs :: [Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
</span><a href="#local-6989586621683068469"><span class="hs-identifier hs-var hs-var">grouped_segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; [Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
-&gt; [Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
forall body.
HsStmtContextRn
-&gt; [Segment (LStmt GhcRn body)] -&gt; [Segment [LStmt GhcRn body]]
</span><a href="GHC.Rename.Expr.html#glomSegments"><span class="hs-identifier hs-var">glomSegments</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068462"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Segment (LStmt GhcRn (LocatedA (body GhcRn)))]
[Segment
   (GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn))))]
</span><a href="#local-6989586621683068478"><span class="hs-identifier hs-var">segs_w_fwd_refs</span></a></span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1725"></span><span id="local-6989586621683066408"><span class="annot"><a href="GHC.Rename.Expr.html#addFwdRefs"><span class="hs-identifier hs-type">addFwdRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1726"></span><span class="hs-comment">-- So far the segments only have forward refs *within* the Stmt</span><span>
</span><span id="line-1727"></span><span class="hs-comment">--      (which happens for bind:  x &lt;- ...x...)</span><span>
</span><span id="line-1728"></span><span class="hs-comment">-- This function adds the cross-seg fwd ref info</span><span>
</span><span id="line-1729"></span><span>
</span><span id="line-1730"></span><span id="addFwdRefs"><span class="annot"><span class="annottext">addFwdRefs :: forall a. [Segment a] -&gt; [Segment a]
</span><a href="GHC.Rename.Expr.html#addFwdRefs"><span class="hs-identifier hs-var hs-var">addFwdRefs</span></a></span></span><span> </span><span id="local-6989586621683068482"><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068482"><span class="hs-identifier hs-var">segs</span></a></span></span><span>
</span><span id="line-1731"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Segment a], FreeVars) -&gt; [Segment a]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Segment a -&gt; ([Segment a], FreeVars) -&gt; ([Segment a], FreeVars))
-&gt; ([Segment a], FreeVars)
-&gt; [Segment a]
-&gt; ([Segment a], FreeVars)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Segment a -&gt; ([Segment a], FreeVars) -&gt; ([Segment a], FreeVars)
forall {d}.
(FreeVars, FreeVars, FreeVars, d)
-&gt; ([(FreeVars, FreeVars, FreeVars, d)], FreeVars)
-&gt; ([(FreeVars, FreeVars, FreeVars, d)], FreeVars)
</span><a href="#local-6989586621683068483"><span class="hs-identifier hs-var">mk_seg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068482"><span class="hs-identifier hs-var">segs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1733"></span><span>    </span><span id="local-6989586621683068483"><span class="annot"><span class="annottext">mk_seg :: (FreeVars, FreeVars, FreeVars, d)
-&gt; ([(FreeVars, FreeVars, FreeVars, d)], FreeVars)
-&gt; ([(FreeVars, FreeVars, FreeVars, d)], FreeVars)
</span><a href="#local-6989586621683068483"><span class="hs-identifier hs-var hs-var">mk_seg</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068484"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068484"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068485"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068485"><span class="hs-identifier hs-var">uses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068486"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068486"><span class="hs-identifier hs-var">fwds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068487"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621683068487"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068488"><span class="annot"><span class="annottext">[(FreeVars, FreeVars, FreeVars, d)]
</span><a href="#local-6989586621683068488"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068489"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068489"><span class="hs-identifier hs-var">later_defs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1734"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FreeVars, FreeVars, FreeVars, d)
</span><a href="#local-6989586621683068490"><span class="hs-identifier hs-var">new_seg</span></a></span><span> </span><span class="annot"><span class="annottext">(FreeVars, FreeVars, FreeVars, d)
-&gt; [(FreeVars, FreeVars, FreeVars, d)]
-&gt; [(FreeVars, FreeVars, FreeVars, d)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(FreeVars, FreeVars, FreeVars, d)]
</span><a href="#local-6989586621683068488"><span class="hs-identifier hs-var">segs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068491"><span class="hs-identifier hs-var">all_defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1735"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-1736"></span><span>          </span><span id="local-6989586621683068490"><span class="annot"><span class="annottext">new_seg :: (FreeVars, FreeVars, FreeVars, d)
</span><a href="#local-6989586621683068490"><span class="hs-identifier hs-var hs-var">new_seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068484"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068485"><span class="hs-identifier hs-var">uses</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068492"><span class="hs-identifier hs-var">new_fwds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621683068487"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1737"></span><span>          </span><span id="local-6989586621683068491"><span class="annot"><span class="annottext">all_defs :: FreeVars
</span><a href="#local-6989586621683068491"><span class="hs-identifier hs-var hs-var">all_defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068489"><span class="hs-identifier hs-var">later_defs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-var">`unionNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068484"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-1738"></span><span>          </span><span id="local-6989586621683068492"><span class="annot"><span class="annottext">new_fwds :: FreeVars
</span><a href="#local-6989586621683068492"><span class="hs-identifier hs-var hs-var">new_fwds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068486"><span class="hs-identifier hs-var">fwds</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-var">`unionNameSet`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068485"><span class="hs-identifier hs-var">uses</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#intersectNameSet"><span class="hs-operator hs-var">`intersectNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068489"><span class="hs-identifier hs-var">later_defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1739"></span><span>                </span><span class="hs-comment">-- Add the downstream fwd refs here</span><span>
</span><span id="line-1740"></span><span>
</span><span id="line-1741"></span><span class="hs-comment">{-
Note [Segmenting mdo]
~~~~~~~~~~~~~~~~~~~~~
NB. June 7 2012: We only glom segments that appear in an explicit mdo;
and leave those found in &quot;do rec&quot;'s intact.  See
https://gitlab.haskell.org/ghc/ghc/issues/4148 for the discussion
leading to this design choice.  Hence the test in segmentRecStmts.

Note [Glomming segments]
~~~~~~~~~~~~~~~~~~~~~~~~
Glomming the singleton segments of an mdo into minimal recursive groups.

At first I thought this was just strongly connected components, but
there's an important constraint: the order of the stmts must not change.

Consider
     mdo { x &lt;- ...y...
           p &lt;- z
           y &lt;- ...x...
           q &lt;- x
           z &lt;- y
           r &lt;- x }

Here, the first stmt mention 'y', which is bound in the third.
But that means that the innocent second stmt (p &lt;- z) gets caught
up in the recursion.  And that in turn means that the binding for
'z' has to be included... and so on.

Start at the tail { r &lt;- x }
Now add the next one { z &lt;- y ; r &lt;- x }
Now add one more     { q &lt;- x ; z &lt;- y ; r &lt;- x }
Now one more... but this time we have to group a bunch into rec
     { rec { y &lt;- ...x... ; q &lt;- x ; z &lt;- y } ; r &lt;- x }
Now one more, which we can add on without a rec
     { p &lt;- z ;
       rec { y &lt;- ...x... ; q &lt;- x ; z &lt;- y } ;
       r &lt;- x }
Finally we add the last one; since it mentions y we have to
glom it together with the first two groups
     { rec { x &lt;- ...y...; p &lt;- z ; y &lt;- ...x... ;
             q &lt;- x ; z &lt;- y } ;
       r &lt;- x }

Note [What is &quot;used later&quot; in a rec stmt]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We desugar a recursive Stmt to something like

  (a,_,c) &lt;- mfix (\(a,b,_) -&gt; do { ... ; return (a,b,c) })
  ...stuff after the rec...

The knot-tied tuple must contain
* All the variables that are used before they are bound in the `rec` block
* All the variables that are used after the entire `rec` block

In the case of GHCi, however, we don't know what variables will be used
after the `rec` (#20206).  For example, we might have
    ghci&gt;  rec { x &lt;- e1; y &lt;- e2 }
    ghci&gt;  print x
    ghci&gt;  print y

So we have to assume that *all* the variables bound in the `rec` are used
afterwards.  We pass a Boolean to segmentRecStmts to signal such a situation,
in which case that function conservatively assumes that everything might well
be used later.
-}</span><span>
</span><span id="line-1806"></span><span>
</span><span id="line-1807"></span><span id="local-6989586621683066409"><span class="annot"><a href="GHC.Rename.Expr.html#glomSegments"><span class="hs-identifier hs-type">glomSegments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1808"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066409"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1809"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066409"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span></span><span>
</span><span id="line-1810"></span><span>                                  </span><span class="hs-comment">-- Each segment has a non-empty list of Stmts</span><span>
</span><span id="line-1811"></span><span class="hs-comment">-- See Note [Glomming segments]</span><span>
</span><span id="line-1812"></span><span>
</span><span id="line-1813"></span><span id="glomSegments"><span class="annot"><span class="annottext">glomSegments :: forall body.
HsStmtContextRn
-&gt; [Segment (LStmt GhcRn body)] -&gt; [Segment [LStmt GhcRn body]]
</span><a href="GHC.Rename.Expr.html#glomSegments"><span class="hs-identifier hs-var hs-var">glomSegments</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1814"></span><span class="annot"><a href="GHC.Rename.Expr.html#glomSegments"><span class="hs-identifier hs-var">glomSegments</span></a></span><span> </span><span id="local-6989586621683068494"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068494"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068495"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068495"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068496"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068496"><span class="hs-identifier hs-var">uses</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068497"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068497"><span class="hs-identifier hs-var">fwds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068498"><span class="annot"><span class="annottext">LStmt GhcRn body
</span><a href="#local-6989586621683068498"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068499"><span class="annot"><span class="annottext">[Segment (LStmt GhcRn body)]
</span><a href="#local-6989586621683068499"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1815"></span><span>        </span><span class="hs-comment">-- Actually stmts will always be a singleton</span><span>
</span><span id="line-1816"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068500"><span class="hs-identifier hs-var">seg_defs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068501"><span class="hs-identifier hs-var">seg_uses</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068502"><span class="hs-identifier hs-var">seg_fwds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]
</span><a href="#local-6989586621683068503"><span class="hs-identifier hs-var">seg_stmts</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Segment
  [GenLocated
     (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]
-&gt; [Segment
      [GenLocated
         (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
-&gt; [Segment
      [GenLocated
         (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Segment
   [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
</span><a href="#local-6989586621683068504"><span class="hs-identifier hs-var">others</span></a></span><span>
</span><span id="line-1817"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1818"></span><span>    </span><span id="local-6989586621683068505"><span class="annot"><span class="annottext">segs' :: [(FreeVars, FreeVars, FreeVars, [LStmt GhcRn body])]
</span><a href="#local-6989586621683068505"><span class="hs-identifier hs-var hs-var">segs'</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; [Segment (LStmt GhcRn body)]
-&gt; [(FreeVars, FreeVars, FreeVars, [LStmt GhcRn body])]
forall body.
HsStmtContextRn
-&gt; [Segment (LStmt GhcRn body)] -&gt; [Segment [LStmt GhcRn body]]
</span><a href="GHC.Rename.Expr.html#glomSegments"><span class="hs-identifier hs-var">glomSegments</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683068494"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Segment (LStmt GhcRn body)]
</span><a href="#local-6989586621683068499"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-1819"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683068506"><span class="annot"><span class="annottext">[Segment
   [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
</span><a href="#local-6989586621683068506"><span class="hs-identifier hs-var">extras</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068504"><span class="annot"><span class="annottext">[Segment
   [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
</span><a href="#local-6989586621683068504"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
-&gt; [Segment
      [GenLocated
         (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
-&gt; ([Segment
       [GenLocated
          (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]],
    [Segment
       [GenLocated
          (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]])
forall a. FreeVars -&gt; [Segment a] -&gt; ([Segment a], [Segment a])
</span><a href="#local-6989586621683068507"><span class="hs-identifier hs-var">grab</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068496"><span class="hs-identifier hs-var">uses</span></a></span><span> </span><span class="annot"><span class="annottext">[(FreeVars, FreeVars, FreeVars, [LStmt GhcRn body])]
[Segment
   [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
</span><a href="#local-6989586621683068505"><span class="hs-identifier hs-var">segs'</span></a></span><span>
</span><span id="line-1820"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683068508"><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068508"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068509"><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068509"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068510"><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068510"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068511"><span class="annot"><span class="annottext">[[GenLocated
    (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
</span><a href="#local-6989586621683068511"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Segment
   [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
-&gt; ([FreeVars], [FreeVars], [FreeVars],
    [[GenLocated
        (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]])
forall a b c d. [(a, b, c, d)] -&gt; ([a], [b], [c], [d])
</span><span class="hs-identifier hs-var">unzip4</span></span><span> </span><span class="annot"><span class="annottext">[Segment
   [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
</span><a href="#local-6989586621683068506"><span class="hs-identifier hs-var">extras</span></a></span><span>
</span><span id="line-1821"></span><span>
</span><span id="line-1822"></span><span>    </span><span id="local-6989586621683068500"><span class="annot"><span class="annottext">seg_defs :: FreeVars
</span><a href="#local-6989586621683068500"><span class="hs-identifier hs-var hs-var">seg_defs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068508"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068495"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-1823"></span><span>    </span><span id="local-6989586621683068501"><span class="annot"><span class="annottext">seg_uses :: FreeVars
</span><a href="#local-6989586621683068501"><span class="hs-identifier hs-var hs-var">seg_uses</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068509"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068496"><span class="hs-identifier hs-var">uses</span></a></span><span>
</span><span id="line-1824"></span><span>    </span><span id="local-6989586621683068502"><span class="annot"><span class="annottext">seg_fwds :: FreeVars
</span><a href="#local-6989586621683068502"><span class="hs-identifier hs-var hs-var">seg_fwds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="annot"><span class="annottext">[FreeVars]
</span><a href="#local-6989586621683068510"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068497"><span class="hs-identifier hs-var">fwds</span></a></span><span>
</span><span id="line-1825"></span><span>    </span><span id="local-6989586621683068503"><span class="annot"><span class="annottext">seg_stmts :: [GenLocated
   (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]
</span><a href="#local-6989586621683068503"><span class="hs-identifier hs-var hs-var">seg_stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LStmt GhcRn body
GenLocated
  (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)
</span><a href="#local-6989586621683068498"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)
-&gt; [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]
-&gt; [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[GenLocated
    (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
-&gt; [GenLocated
      (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[GenLocated
    (Anno (StmtLR GhcRn GhcRn body)) (StmtLR GhcRn GhcRn body)]]
</span><a href="#local-6989586621683068511"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-1826"></span><span>
</span><span id="line-1827"></span><span>    </span><span id="local-6989586621683066413"><span class="annot"><a href="#local-6989586621683068507"><span class="hs-identifier hs-type">grab</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>             </span><span class="hs-comment">-- The client</span><span>
</span><span id="line-1828"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066413"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1829"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066413"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Needed by the 'client'</span><span>
</span><span id="line-1830"></span><span>             </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066413"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>       </span><span class="hs-comment">-- Not needed by the client</span><span>
</span><span id="line-1831"></span><span>        </span><span class="hs-comment">-- The result is simply a split of the input</span><span>
</span><span id="line-1832"></span><span>    </span><span id="local-6989586621683068507"><span class="annot"><span class="annottext">grab :: forall a. FreeVars -&gt; [Segment a] -&gt; ([Segment a], [Segment a])
</span><a href="#local-6989586621683068507"><span class="hs-identifier hs-var hs-var">grab</span></a></span></span><span> </span><span id="local-6989586621683068512"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068512"><span class="hs-identifier hs-var">uses</span></a></span></span><span> </span><span id="local-6989586621683068513"><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068513"><span class="hs-identifier hs-var">dus</span></a></span></span><span>
</span><span id="line-1833"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Segment a] -&gt; [Segment a]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068515"><span class="hs-identifier hs-var">yeses</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Segment a] -&gt; [Segment a]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068516"><span class="hs-identifier hs-var">noes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1834"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-1835"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683068516"><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068516"><span class="hs-identifier hs-var">noes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068515"><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068515"><span class="hs-identifier hs-var">yeses</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Segment a -&gt; Bool) -&gt; [Segment a] -&gt; ([Segment a], [Segment a])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">span</span></span><span> </span><span class="annot"><span class="annottext">Segment a -&gt; Bool
</span><a href="#local-6989586621683068518"><span class="hs-identifier hs-var">not_needed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Segment a] -&gt; [Segment a]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Segment a]
</span><a href="#local-6989586621683068513"><span class="hs-identifier hs-var">dus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1836"></span><span>          </span><span id="local-6989586621683068518"><span class="annot"><span class="annottext">not_needed :: Segment a -&gt; Bool
</span><a href="#local-6989586621683068518"><span class="hs-identifier hs-var hs-var">not_needed</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068519"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068519"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#disjointNameSet"><span class="hs-identifier hs-var">disjointNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068519"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068512"><span class="hs-identifier hs-var">uses</span></a></span><span>
</span><span id="line-1837"></span><span>
</span><span id="line-1838"></span><span class="hs-comment">----------------------------------------------------</span><span>
</span><span id="line-1839"></span><span id="local-6989586621683066403"><span class="annot"><a href="GHC.Rename.Expr.html#segsToStmts"><span class="hs-identifier hs-type">segsToStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Stmt"><span class="hs-identifier hs-type">Stmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066403"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1840"></span><span>                                  </span><span class="hs-comment">-- A RecStmt with the SyntaxOps filled in</span><span>
</span><span id="line-1841"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066403"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1842"></span><span>                                  </span><span class="hs-comment">-- Each Segment has a non-empty list of Stmts</span><span>
</span><span id="line-1843"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>           </span><span class="hs-comment">-- Free vars used 'later'</span><span>
</span><span id="line-1844"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066403"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span id="segsToStmts"><span class="annot"><span class="annottext">segsToStmts :: forall (body :: * -&gt; *).
Stmt GhcRn (LocatedA (body GhcRn))
-&gt; [Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
-&gt; FreeVars
-&gt; ([LStmt GhcRn (LocatedA (body GhcRn))], FreeVars)
</span><a href="GHC.Rename.Expr.html#segsToStmts"><span class="hs-identifier hs-var hs-var">segsToStmts</span></a></span></span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683068531"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068531"><span class="hs-identifier hs-var">fvs_later</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068531"><span class="hs-identifier hs-var">fvs_later</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1847"></span><span class="annot"><a href="GHC.Rename.Expr.html#segsToStmts"><span class="hs-identifier hs-var">segsToStmts</span></a></span><span> </span><span id="local-6989586621683068532"><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068532"><span class="hs-identifier hs-var">empty_rec_stmt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068533"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068533"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068534"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068534"><span class="hs-identifier hs-var">uses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068535"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068535"><span class="hs-identifier hs-var">fwds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068536"><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621683068536"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068537"><span class="annot"><span class="annottext">[Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
</span><a href="#local-6989586621683068537"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068538"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068538"><span class="hs-identifier hs-var">fvs_later</span></a></span></span><span>
</span><span id="line-1848"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ([GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))],
    FreeVars)
-&gt; ([GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))],
    FreeVars)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621683068536"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621683068540"><span class="hs-identifier hs-var">new_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
-&gt; [GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
-&gt; [GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621683068541"><span class="hs-identifier hs-var">later_stmts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068542"><span class="hs-identifier hs-var">later_uses</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068534"><span class="hs-identifier hs-var">uses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1850"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1851"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683068541"><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621683068541"><span class="hs-identifier hs-var">later_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068542"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068542"><span class="hs-identifier hs-var">later_uses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
-&gt; [Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
-&gt; FreeVars
-&gt; ([LStmt GhcRn (LocatedA (body GhcRn))], FreeVars)
forall (body :: * -&gt; *).
Stmt GhcRn (LocatedA (body GhcRn))
-&gt; [Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
-&gt; FreeVars
-&gt; ([LStmt GhcRn (LocatedA (body GhcRn))], FreeVars)
</span><a href="GHC.Rename.Expr.html#segsToStmts"><span class="hs-identifier hs-var">segsToStmts</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068532"><span class="hs-identifier hs-var">empty_rec_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Segment [LStmt GhcRn (LocatedA (body GhcRn))]]
</span><a href="#local-6989586621683068537"><span class="hs-identifier hs-var">segs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068538"><span class="hs-identifier hs-var">fvs_later</span></a></span><span>
</span><span id="line-1852"></span><span>    </span><span id="local-6989586621683068540"><span class="annot"><span class="annottext">new_stmt :: GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621683068540"><span class="hs-identifier hs-var hs-var">new_stmt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068543"><span class="hs-identifier hs-var">non_rec</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
-&gt; GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621683068536"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-1853"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; Stmt GhcRn (LocatedA (body GhcRn))
-&gt; GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
-&gt; SrcSpanAnnA
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
-&gt; GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621683068536"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068546"><span class="hs-identifier hs-var">rec_stmt</span></a></span><span>
</span><span id="line-1854"></span><span>    </span><span id="local-6989586621683068546"><span class="annot"><span class="annottext">rec_stmt :: Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068546"><span class="hs-identifier hs-var hs-var">rec_stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621683068532"><span class="hs-identifier hs-var">empty_rec_stmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068536"><span class="hs-identifier hs-type">ss</span></a></span><span>
</span><span id="line-1855"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_later_ids"><span class="hs-identifier hs-var">recS_later_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-type">nameSetElemsStable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068547"><span class="hs-identifier hs-type">used_later</span></a></span><span>
</span><span id="line-1856"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_rec_ids"><span class="hs-identifier hs-var">recS_rec_ids</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-type">nameSetElemsStable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068535"><span class="hs-identifier hs-type">fwds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1857"></span><span>          </span><span class="hs-comment">-- See Note [Deterministic ApplicativeDo and RecursiveDo desugaring]</span><span>
</span><span id="line-1858"></span><span>    </span><span id="local-6989586621683068543"><span class="annot"><span class="annottext">non_rec :: Bool
</span><a href="#local-6989586621683068543"><span class="hs-identifier hs-var hs-var">non_rec</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
-&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
[GenLocated SrcSpanAnnA (Stmt GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621683068536"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068535"><span class="hs-identifier hs-var">fwds</span></a></span><span>
</span><span id="line-1859"></span><span>    </span><span id="local-6989586621683068547"><span class="annot"><span class="annottext">used_later :: FreeVars
</span><a href="#local-6989586621683068547"><span class="hs-identifier hs-var hs-var">used_later</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068533"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#intersectNameSet"><span class="hs-operator hs-var">`intersectNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068542"><span class="hs-identifier hs-var">later_uses</span></a></span><span>
</span><span id="line-1860"></span><span>                                </span><span class="hs-comment">-- The ones needed after the RecStmt</span><span>
</span><span id="line-1861"></span><span>
</span><span id="line-1862"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
ApplicativeDo
*                                                                      *
************************************************************************

Note [ApplicativeDo]
~~~~~~~~~~~~~~~~~~~~
= Example =

For a sequence of statements

 do
     x &lt;- A
     y &lt;- B x
     z &lt;- C
     return (f x y z)

We want to transform this to

  (\(x,y) z -&gt; f x y z) &lt;$&gt; (do x &lt;- A; y &lt;- B x; return (x,y)) &lt;*&gt; C

It would be easy to notice that &quot;y &lt;- B x&quot; and &quot;z &lt;- C&quot; are
independent and do something like this:

 do
     x &lt;- A
     (y,z) &lt;- (,) &lt;$&gt; B x &lt;*&gt; C
     return (f x y z)

But this isn't enough! If A and C were also independent, then this
transformation loses the ability to do A and C in parallel.

The algorithm works by first splitting the sequence of statements into
independent &quot;segments&quot;, and a separate &quot;tail&quot; (the final statement). In
our example above, the segments would be

     [ x &lt;- A
     , y &lt;- B x ]

     [ z &lt;- C ]

and the tail is:

     return (f x y z)

Then we take these segments and make an Applicative expression from them:

     (\(x,y) z -&gt; return (f x y z))
       &lt;$&gt; do { x &lt;- A; y &lt;- B x; return (x,y) }
       &lt;*&gt; C

Finally, we recursively apply the transformation to each segment, to
discover any nested parallelism.

= Syntax &amp; spec =

  expr ::= ... | do {stmt_1; ..; stmt_n} expr | ...

  stmt ::= pat &lt;- expr
         | (arg_1 | ... | arg_n)  -- applicative composition, n&gt;=1
         | ...                    -- other kinds of statement (e.g. let)

  arg ::= pat &lt;- expr
        | {stmt_1; ..; stmt_n} {var_1..var_n}

(note that in the actual implementation,the expr in a do statement is
represented by a LastStmt as the final stmt, this is just a
representational issue and may change later.)

== Transformation to introduce applicative stmts ==

ado {} tail = tail
ado {pat &lt;- expr} {return expr'} = (mkArg(pat &lt;- expr)); return expr'
ado {one} tail = one : tail
ado stmts tail
  | n == 1 = ado before (ado after tail)
    where (before,after) = split(stmts_1)
  | n &gt; 1  = (mkArg(stmts_1) | ... | mkArg(stmts_n)); tail
  where
    {stmts_1 .. stmts_n} = segments(stmts)

segments(stmts) =
  -- divide stmts into segments with no interdependencies

mkArg({pat &lt;- expr}) = (pat &lt;- expr)
mkArg({stmt_1; ...; stmt_n}) =
  {stmt_1; ...; stmt_n} {vars(stmt_1) u .. u vars(stmt_n)}

split({stmt_1; ..; stmt_n) =
  ({stmt_1; ..; stmt_i}, {stmt_i+1; ..; stmt_n})
  -- 1 &lt;= i &lt;= n
  -- i is a good place to insert a bind

== Desugaring for do ==

dsDo {} expr = expr

dsDo {pat &lt;- rhs; stmts} expr =
   rhs &gt;&gt;= \pat -&gt; dsDo stmts expr

dsDo {(arg_1 | ... | arg_n)} (return expr) =
  (\argpat (arg_1) .. argpat(arg_n) -&gt; expr)
     &lt;$&gt; argexpr(arg_1)
     &lt;*&gt; ...
     &lt;*&gt; argexpr(arg_n)

dsDo {(arg_1 | ... | arg_n); stmts} expr =
  join (\argpat (arg_1) .. argpat(arg_n) -&gt; dsDo stmts expr)
     &lt;$&gt; argexpr(arg_1)
     &lt;*&gt; ...
     &lt;*&gt; argexpr(arg_n)

== Special cases ==

If a do-expression contains only &quot;return E&quot; or &quot;return $ E&quot; plus
zero or more let-statements, we replace the &quot;return&quot; with &quot;pure&quot;.
See Section 3.6 of the paper.

= Relevant modules in the rest of the compiler =

ApplicativeDo touches a few phases in the compiler:

* Renamer: The journey begins here in the renamer, where do-blocks are
  scheduled as outlined above and transformed into applicative
  combinators.  However, the code is still represented as a do-block
  with special forms of applicative statements. This allows us to
  recover the original do-block when e.g. printing type errors, where
  we don't want to show any of the applicative combinators since they
  don't exist in the source code.
  See ApplicativeStmt and ApplicativeArg in HsExpr.

* Typechecker: ApplicativeDo passes through the typechecker much like any
  other form of expression. The only crux is that the typechecker has to
  be aware of the special ApplicativeDo statements in the do-notation, and
  typecheck them appropriately.
  Relevant module: GHC.Tc.Gen.Match

* Desugarer: Any do-block which contains applicative statements is desugared
  as outlined above, to use the Applicative combinators.
  Relevant module: GHC.HsToCore.Expr

-}</span><span>
</span><span id="line-2006"></span><span>
</span><span id="line-2007"></span><span class="hs-comment">-- | The 'Name's of @return@ and @pure@. These may not be 'returnName' and</span><span>
</span><span id="line-2008"></span><span class="hs-comment">-- 'pureName' due to @QualifiedDo@ or @RebindableSyntax@.</span><span>
</span><span id="line-2009"></span><span class="hs-keyword">data</span><span> </span><span id="MonadNames"><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-var">MonadNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MonadNames"><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-var">MonadNames</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="return_name"><span class="annot"><span class="annottext">MonadNames -&gt; Name
</span><a href="GHC.Rename.Expr.html#return_name"><span class="hs-identifier hs-var hs-var">return_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="pure_name"><span class="annot"><span class="annottext">MonadNames -&gt; Name
</span><a href="GHC.Rename.Expr.html#pure_name"><span class="hs-identifier hs-var hs-var">pure_name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2010"></span><span>
</span><span id="line-2011"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-type">MonadNames</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2012"></span><span>  </span><span id="local-6989586621683068563"><span class="annot"><span class="annottext">ppr :: MonadNames -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-type">MonadNames</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">return_name :: MonadNames -&gt; Name
</span><a href="GHC.Rename.Expr.html#return_name"><span class="hs-identifier hs-var">return_name</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683068564"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068564"><span class="hs-identifier hs-var">return_name</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">pure_name :: MonadNames -&gt; Name
</span><a href="GHC.Rename.Expr.html#pure_name"><span class="hs-identifier hs-var">pure_name</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683068565"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068565"><span class="hs-identifier hs-var">pure_name</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2013"></span><span>    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span>
</span><span id="line-2014"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MonadNames { return_name = &quot;</span></span><span>
</span><span id="line-2015"></span><span>    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068564"><span class="hs-identifier hs-var">return_name</span></a></span><span>
</span><span id="line-2016"></span><span>    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, pure_name = &quot;</span></span><span>
</span><span id="line-2017"></span><span>    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068565"><span class="hs-identifier hs-var">pure_name</span></a></span><span>
</span><span id="line-2018"></span><span>    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;}&quot;</span></span><span>
</span><span id="line-2019"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-2020"></span><span>
</span><span id="line-2021"></span><span class="hs-comment">-- | rearrange a list of statements using ApplicativeDoStmt.  See</span><span>
</span><span id="line-2022"></span><span class="hs-comment">-- Note [ApplicativeDo].</span><span>
</span><span id="line-2023"></span><span class="annot"><a href="GHC.Rename.Expr.html#rearrangeForApplicativeDo"><span class="hs-identifier hs-type">rearrangeForApplicativeDo</span></a></span><span>
</span><span id="line-2024"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span>
</span><span id="line-2025"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2026"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2027"></span><span>
</span><span id="line-2028"></span><span id="rearrangeForApplicativeDo"><span class="annot"><span class="annottext">rearrangeForApplicativeDo :: HsDoFlavour
-&gt; [(ExprLStmt GhcRn, FreeVars)]
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#rearrangeForApplicativeDo"><span class="hs-identifier hs-var hs-var">rearrangeForApplicativeDo</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
 FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
      FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2029"></span><span class="hs-comment">-- If the do-block contains a single @return@ statement, change it to</span><span>
</span><span id="line-2030"></span><span class="hs-comment">-- @pure@ if ApplicativeDo is turned on. See Note [ApplicativeDo].</span><span>
</span><span id="line-2031"></span><span class="annot"><a href="GHC.Rename.Expr.html#rearrangeForApplicativeDo"><span class="hs-identifier hs-var">rearrangeForApplicativeDo</span></a></span><span> </span><span id="local-6989586621683068568"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068568"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621683068569"><span class="annot"><span class="annottext">ExprLStmt GhcRn
</span><a href="#local-6989586621683068569"><span class="hs-identifier hs-var">one</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2032"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683068570"><span class="annot"><a href="#local-6989586621683068570"><span class="hs-identifier hs-var">return_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContext (ZonkAny 2) -&gt; Name -&gt; RnM (Name, FreeVars)
forall fn. HsStmtContext fn -&gt; Name -&gt; RnM (Name, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier hs-var">lookupQualifiedDoName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (ZonkAny 2)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068568"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a></span><span>
</span><span id="line-2033"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683068572"><span class="annot"><a href="#local-6989586621683068572"><span class="hs-identifier hs-var">pure_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier hs-type">lookupQualifiedDoName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068568"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#pureAName"><span class="hs-identifier hs-type">pureAName</span></a></span><span>
</span><span id="line-2034"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068574"><span class="annot"><a href="#local-6989586621683068574"><span class="hs-identifier hs-var hs-var">pure_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; HsExpr GhcRn
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; HsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nl_HsVar"><span class="hs-identifier hs-var">nl_HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683068572"><span class="hs-identifier hs-var">pure_name</span></a></span><span>
</span><span id="line-2035"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068575"><span class="annot"><a href="#local-6989586621683068575"><span class="hs-identifier hs-var hs-var">monad_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-type">MonadNames</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">return_name :: Name
</span><a href="GHC.Rename.Expr.html#return_name"><span class="hs-identifier hs-var">return_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068570"><span class="hs-identifier hs-var">return_name</span></a></span><span>
</span><span id="line-2036"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pure_name :: Name
</span><a href="GHC.Rename.Expr.html#pure_name"><span class="hs-identifier hs-var">pure_name</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068572"><span class="hs-identifier hs-var">pure_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2037"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-type">needJoin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068575"><span class="hs-identifier hs-type">monad_names</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683068569"><span class="hs-identifier hs-type">one</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683068574"><span class="hs-identifier hs-type">pure_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2038"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068577"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068577"><span class="hs-identifier hs-var">one'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683068577"><span class="hs-identifier hs-var">one'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2039"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">ExprLStmt GhcRn
GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068569"><span class="hs-identifier hs-var">one</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2040"></span><span class="annot"><a href="GHC.Rename.Expr.html#rearrangeForApplicativeDo"><span class="hs-identifier hs-var">rearrangeForApplicativeDo</span></a></span><span> </span><span id="local-6989586621683068578"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068578"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068579"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068579"><span class="hs-identifier hs-var">stmts0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2041"></span><span>  </span><span id="local-6989586621683068580"><span class="annot"><a href="#local-6989586621683068580"><span class="hs-identifier hs-var">optimal_ado</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_OptimalApplicativeDo"><span class="hs-identifier hs-var">Opt_OptimalApplicativeDo</span></a></span><span>
</span><span id="line-2042"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068582"><span class="annot"><a href="#local-6989586621683068582"><span class="hs-identifier hs-var hs-var">stmt_tree</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068580"><span class="hs-identifier hs-var">optimal_ado</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; ExprStmtTree
</span><a href="GHC.Rename.Expr.html#mkStmtTreeOptimal"><span class="hs-identifier hs-var">mkStmtTreeOptimal</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068584"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2043"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; ExprStmtTree
</span><a href="GHC.Rename.Expr.html#mkStmtTreeHeuristic"><span class="hs-identifier hs-var">mkStmtTreeHeuristic</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068584"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2044"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rearrangeForADo&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068582"><span class="hs-identifier hs-type">stmt_tree</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2045"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683068586"><span class="annot"><a href="#local-6989586621683068586"><span class="hs-identifier hs-var">return_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier hs-type">lookupQualifiedDoName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068578"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#returnMName"><span class="hs-identifier hs-type">returnMName</span></a></span><span>
</span><span id="line-2046"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683068587"><span class="annot"><a href="#local-6989586621683068587"><span class="hs-identifier hs-var">pure_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier hs-type">lookupQualifiedDoName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068578"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#pureAName"><span class="hs-identifier hs-type">pureAName</span></a></span><span>
</span><span id="line-2047"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068588"><span class="annot"><a href="#local-6989586621683068588"><span class="hs-identifier hs-var hs-var">monad_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-type">MonadNames</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">return_name :: Name
</span><a href="GHC.Rename.Expr.html#return_name"><span class="hs-identifier hs-var">return_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068586"><span class="hs-identifier hs-var">return_name</span></a></span><span>
</span><span id="line-2048"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pure_name :: Name
</span><a href="GHC.Rename.Expr.html#pure_name"><span class="hs-identifier hs-var">pure_name</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683068587"><span class="hs-identifier hs-var">pure_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2049"></span><span>  </span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-type">stmtTreeToStmts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068588"><span class="hs-identifier hs-type">monad_names</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068578"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068582"><span class="hs-identifier hs-type">stmt_tree</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683068590"><span class="hs-identifier hs-type">last</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683068591"><span class="hs-identifier hs-type">last_fvs</span></a></span><span>
</span><span id="line-2050"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2051"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683068584"><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068584"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621683068590"><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068590"><span class="hs-identifier hs-var">last</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068591"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068591"><span class="hs-identifier hs-var">last_fvs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; ([(GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)],
    (GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars))
forall {a}. [a] -&gt; ([a], a)
</span><a href="#local-6989586621683068592"><span class="hs-identifier hs-var">findLast</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068579"><span class="hs-identifier hs-var">stmts0</span></a></span><span>
</span><span id="line-2052"></span><span>    </span><span id="local-6989586621683068592"><span class="annot"><span class="annottext">findLast :: [a] -&gt; ([a], a)
</span><a href="#local-6989586621683068592"><span class="hs-identifier hs-var hs-var">findLast</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ([a], a)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;findLast&quot;</span></span><span>
</span><span id="line-2053"></span><span>    </span><span class="annot"><a href="#local-6989586621683068592"><span class="hs-identifier hs-var">findLast</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683068596"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068596"><span class="hs-identifier hs-var">last</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068596"><span class="hs-identifier hs-var">last</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2054"></span><span>    </span><span class="annot"><a href="#local-6989586621683068592"><span class="hs-identifier hs-var">findLast</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068597"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068597"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683068598"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068598"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068597"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068599"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068600"><span class="hs-identifier hs-var">last</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068599"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068599"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068600"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068600"><span class="hs-identifier hs-var">last</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; ([a], a)
</span><a href="#local-6989586621683068592"><span class="hs-identifier hs-var">findLast</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068598"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2055"></span><span>
</span><span id="line-2056"></span><span class="annot"><span class="hs-comment">-- | A tree of statements using a mixture of applicative and bind constructs.</span></span><span>
</span><span id="line-2057"></span><span class="hs-keyword">data</span><span> </span><span id="StmtTree"><span class="annot"><a href="GHC.Rename.Expr.html#StmtTree"><span class="hs-identifier hs-var">StmtTree</span></a></span></span><span> </span><span id="local-6989586621683066437"><span class="annot"><a href="#local-6989586621683066437"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2058"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="StmtTreeOne"><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621683066437"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-2059"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="StmtTreeBind"><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeBind"><span class="hs-identifier hs-var">StmtTreeBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTree"><span class="hs-identifier hs-type">StmtTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066437"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTree"><span class="hs-identifier hs-type">StmtTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066437"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2060"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="StmtTreeApplicative"><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeApplicative"><span class="hs-identifier hs-var">StmtTreeApplicative</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTree"><span class="hs-identifier hs-type">StmtTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066437"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2061"></span><span>
</span><span id="line-2062"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683065960"><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683065960"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTree"><span class="hs-identifier hs-type">StmtTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683065960"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2063"></span><span>  </span><span id="local-6989586621683068620"><span class="annot"><span class="annottext">ppr :: StmtTree a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span id="local-6989586621683068621"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068621"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;StmtTreeOne&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068621"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2064"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeBind"><span class="hs-identifier hs-type">StmtTreeBind</span></a></span><span> </span><span id="local-6989586621683068624"><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068624"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683068625"><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068625"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;StmtTreeBind&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2065"></span><span>                                            </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StmtTree a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068624"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StmtTree a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068625"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2066"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeApplicative"><span class="hs-identifier hs-type">StmtTreeApplicative</span></a></span><span> </span><span id="local-6989586621683068628"><span class="annot"><span class="annottext">[StmtTree a]
</span><a href="#local-6989586621683068628"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;StmtTreeApplicative&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2067"></span><span>                                            </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(StmtTree a -&gt; SDoc) -&gt; [StmtTree a] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">StmtTree a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[StmtTree a]
</span><a href="#local-6989586621683068628"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2068"></span><span>
</span><span id="line-2069"></span><span id="local-6989586621683066434"><span class="annot"><a href="GHC.Rename.Expr.html#flattenStmtTree"><span class="hs-identifier hs-type">flattenStmtTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTree"><span class="hs-identifier hs-type">StmtTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066434"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683066434"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-2070"></span><span id="flattenStmtTree"><span class="annot"><span class="annottext">flattenStmtTree :: forall a. StmtTree a -&gt; [a]
</span><a href="GHC.Rename.Expr.html#flattenStmtTree"><span class="hs-identifier hs-var hs-var">flattenStmtTree</span></a></span></span><span> </span><span id="local-6989586621683068631"><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068631"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StmtTree a -&gt; [a] -&gt; [a]
forall {a}. StmtTree a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621683068632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068631"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2071"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2072"></span><span>  </span><span id="local-6989586621683068632"><span class="annot"><span class="annottext">go :: StmtTree a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621683068632"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span id="local-6989586621683068634"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068634"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068635"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068635"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068634"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068635"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-2073"></span><span>  </span><span class="annot"><a href="#local-6989586621683068632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeBind"><span class="hs-identifier hs-type">StmtTreeBind</span></a></span><span> </span><span id="local-6989586621683068636"><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068636"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683068637"><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068637"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068638"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068638"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StmtTree a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621683068632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068636"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtTree a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621683068632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree a
</span><a href="#local-6989586621683068637"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068638"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2074"></span><span>  </span><span class="annot"><a href="#local-6989586621683068632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeApplicative"><span class="hs-identifier hs-type">StmtTreeApplicative</span></a></span><span> </span><span id="local-6989586621683068639"><span class="annot"><span class="annottext">[StmtTree a]
</span><a href="#local-6989586621683068639"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068640"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068640"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StmtTree a -&gt; [a] -&gt; [a]) -&gt; [a] -&gt; [StmtTree a] -&gt; [a]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">StmtTree a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621683068632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683068640"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[StmtTree a]
</span><a href="#local-6989586621683068639"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-2075"></span><span>
</span><span id="line-2076"></span><span class="hs-keyword">type</span><span> </span><span id="ExprStmtTree"><span class="annot"><a href="GHC.Rename.Expr.html#ExprStmtTree"><span class="hs-identifier hs-var">ExprStmtTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTree"><span class="hs-identifier hs-type">StmtTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2077"></span><span class="hs-keyword">type</span><span> </span><span id="Cost"><span class="annot"><a href="GHC.Rename.Expr.html#Cost"><span class="hs-identifier hs-var">Cost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span class="hs-comment">-- | Turn a sequence of statements into an ExprStmtTree using a</span><span>
</span><span id="line-2080"></span><span class="hs-comment">-- heuristic algorithm.  /O(n^2)/</span><span>
</span><span id="line-2081"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkStmtTreeHeuristic"><span class="hs-identifier hs-type">mkStmtTreeHeuristic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#ExprStmtTree"><span class="hs-identifier hs-type">ExprStmtTree</span></a></span><span>
</span><span id="line-2082"></span><span id="mkStmtTreeHeuristic"><span class="annot"><span class="annottext">mkStmtTreeHeuristic :: [(ExprLStmt GhcRn, FreeVars)] -&gt; ExprStmtTree
</span><a href="GHC.Rename.Expr.html#mkStmtTreeHeuristic"><span class="hs-identifier hs-var hs-var">mkStmtTreeHeuristic</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683068642"><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
</span><a href="#local-6989586621683068642"><span class="hs-identifier hs-var">one</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
</span><a href="#local-6989586621683068642"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-2083"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkStmtTreeHeuristic"><span class="hs-identifier hs-var">mkStmtTreeHeuristic</span></a></span><span> </span><span id="local-6989586621683068643"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068643"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2084"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; [[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="GHC.Rename.Expr.html#segments"><span class="hs-identifier hs-var">segments</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068643"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2085"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621683068645"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068645"><span class="hs-identifier hs-var">one</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
</span><a href="#local-6989586621683068646"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068645"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-2086"></span><span>    </span><span id="local-6989586621683068647"><span class="annot"><span class="annottext">[[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="#local-6989586621683068647"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[StmtTree
   (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)]
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. [StmtTree a] -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeApplicative"><span class="hs-identifier hs-var">StmtTreeApplicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)]
 -&gt; StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars))
-&gt; [[(GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
-&gt; [StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
</span><a href="#local-6989586621683068646"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">[[(ExprLStmt GhcRn, FreeVars)]]
[[(GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)]]
</span><a href="#local-6989586621683068647"><span class="hs-identifier hs-var">segs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2087"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2088"></span><span>  </span><span id="local-6989586621683068646"><span class="annot"><span class="annottext">split :: [(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
</span><a href="#local-6989586621683068646"><span class="hs-identifier hs-var hs-var">split</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683068648"><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
</span><a href="#local-6989586621683068648"><span class="hs-identifier hs-var">one</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
</span><a href="#local-6989586621683068648"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-2089"></span><span>  </span><span class="annot"><a href="#local-6989586621683068646"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span id="local-6989586621683068649"><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068649"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2090"></span><span>    </span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. StmtTree a -&gt; StmtTree a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeBind"><span class="hs-identifier hs-var">StmtTreeBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; ExprStmtTree
</span><a href="GHC.Rename.Expr.html#mkStmtTreeHeuristic"><span class="hs-identifier hs-var">mkStmtTreeHeuristic</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068650"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; ExprStmtTree
</span><a href="GHC.Rename.Expr.html#mkStmtTreeHeuristic"><span class="hs-identifier hs-var">mkStmtTreeHeuristic</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068651"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2091"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068650"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068650"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068651"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068651"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
-&gt; ([(ExprLStmt GhcRn, FreeVars)], [(ExprLStmt GhcRn, FreeVars)])
</span><a href="GHC.Rename.Expr.html#splitSegment"><span class="hs-identifier hs-var">splitSegment</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068649"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2092"></span><span>
</span><span id="line-2093"></span><span class="hs-comment">-- | Turn a sequence of statements into an ExprStmtTree optimally,</span><span>
</span><span id="line-2094"></span><span class="hs-comment">-- using dynamic programming.  /O(n^3)/</span><span>
</span><span id="line-2095"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkStmtTreeOptimal"><span class="hs-identifier hs-type">mkStmtTreeOptimal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#ExprStmtTree"><span class="hs-identifier hs-type">ExprStmtTree</span></a></span><span>
</span><span id="line-2096"></span><span id="mkStmtTreeOptimal"><span class="annot"><span class="annottext">mkStmtTreeOptimal :: [(ExprLStmt GhcRn, FreeVars)] -&gt; ExprStmtTree
</span><a href="GHC.Rename.Expr.html#mkStmtTreeOptimal"><span class="hs-identifier hs-var hs-var">mkStmtTreeOptimal</span></a></span></span><span> </span><span id="local-6989586621683068653"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068653"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2097"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ExprStmtTree -&gt; ExprStmtTree
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068653"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExprStmtTree -&gt; ExprStmtTree) -&gt; ExprStmtTree -&gt; ExprStmtTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- the empty case is handled by the caller;</span><span>
</span><span id="line-2098"></span><span>                              </span><span class="hs-comment">-- we don't support empty StmtTrees.</span><span>
</span><span id="line-2099"></span><span>  </span><span class="annot"><span class="annottext">(ExprStmtTree, Int) -&gt; ExprStmtTree
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array (Int, Int) (ExprStmtTree, Int)
Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
</span><a href="#local-6989586621683068654"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
-&gt; (Int, Int)
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068656"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2101"></span><span>    </span><span id="local-6989586621683068656"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621683068656"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068653"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2102"></span><span>    </span><span id="local-6989586621683068657"><span class="annot"><span class="annottext">stmt_arr :: Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var hs-var">stmt_arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; Array
     Int
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall i e. Ix i =&gt; (i, i) -&gt; [e] -&gt; Array i e
</span><span class="hs-identifier hs-var">listArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068656"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068653"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2103"></span><span>
</span><span id="line-2104"></span><span>    </span><span class="hs-comment">-- lazy cache of optimal trees for subsequences of the input</span><span>
</span><span id="line-2105"></span><span>    </span><span class="annot"><a href="#local-6989586621683068654"><span class="hs-identifier hs-type">arr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#ExprStmtTree"><span class="hs-identifier hs-type">ExprStmtTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#Cost"><span class="hs-identifier hs-type">Cost</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2106"></span><span>    </span><span id="local-6989586621683068654"><span class="annot"><span class="annottext">arr :: Array (Int, Int) (ExprStmtTree, Int)
</span><a href="#local-6989586621683068654"><span class="hs-identifier hs-var hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int), (Int, Int))
-&gt; [((Int, Int),
     (StmtTree
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
         FreeVars),
      Int))]
-&gt; Array
     (Int, Int)
     (StmtTree
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
         FreeVars),
      Int)
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068656"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068656"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2107"></span><span>             </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068660"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068661"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
</span><a href="#local-6989586621683068662"><span class="hs-identifier hs-var">tree</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068660"><span class="hs-identifier hs-var">lo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068661"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2108"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683068660"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068660"><span class="hs-identifier hs-var">lo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068656"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2109"></span><span>             </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068661"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068661"><span class="hs-identifier hs-var">hi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068660"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068656"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2110"></span><span>
</span><span id="line-2111"></span><span>    </span><span class="hs-comment">-- compute the optimal tree for the sequence [lo..hi]</span><span>
</span><span id="line-2112"></span><span>    </span><span id="local-6989586621683068662"><span class="annot"><span class="annottext">tree :: Int
-&gt; Int
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
</span><a href="#local-6989586621683068662"><span class="hs-identifier hs-var hs-var">tree</span></a></span></span><span> </span><span id="local-6989586621683068663"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068663"><span class="hs-identifier hs-var">lo</span></a></span></span><span> </span><span id="local-6989586621683068664"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068664"><span class="hs-identifier hs-var">hi</span></a></span></span><span>
</span><span id="line-2113"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068664"><span class="hs-identifier hs-var">hi</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068663"><span class="hs-identifier hs-var">lo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var">stmt_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; Int
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068663"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2114"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2115"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; [[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="GHC.Rename.Expr.html#segments"><span class="hs-identifier hs-var">segments</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var">stmt_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; Int
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068665"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683068665"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068665"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068663"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068664"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2116"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkStmtTree&quot;</span></span><span>
</span><span id="line-2117"></span><span>           </span><span class="hs-special">[</span><span id="local-6989586621683068666"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068666"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (ExprStmtTree, Int)
</span><a href="#local-6989586621683068667"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068663"><span class="hs-identifier hs-var">lo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068664"><span class="hs-identifier hs-var">hi</span></a></span><span>
</span><span id="line-2118"></span><span>           </span><span id="local-6989586621683068668"><span class="annot"><span class="annottext">[[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="#local-6989586621683068668"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StmtTree
   (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)]
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. [StmtTree a] -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeApplicative"><span class="hs-identifier hs-var">StmtTreeApplicative</span></a></span><span> </span><span class="annot"><span class="annottext">[StmtTree
   (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)]
</span><a href="#local-6989586621683068669"><span class="hs-identifier hs-var">trees</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621683068671"><span class="hs-identifier hs-var">costs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2119"></span><span>             </span><span class="hs-keyword">where</span><span>
</span><span id="line-2120"></span><span>               </span><span id="local-6989586621683068672"><span class="annot"><span class="annottext">bounds :: [(Int, Int)]
</span><a href="#local-6989586621683068672"><span class="hs-identifier hs-var hs-var">bounds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int)
 -&gt; [(GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]
 -&gt; (Int, Int))
-&gt; (Int, Int)
-&gt; [[(GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
-&gt; [(Int, Int)]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">scanl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683068674"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068674"><span class="hs-identifier hs-var">hi</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068675"><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068675"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068674"><span class="hs-identifier hs-var">hi</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068674"><span class="hs-identifier hs-var">hi</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068675"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068663"><span class="hs-identifier hs-var">lo</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(ExprLStmt GhcRn, FreeVars)]]
[[(GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)]]
</span><a href="#local-6989586621683068668"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-2121"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621683068669"><span class="annot"><span class="annottext">[StmtTree
   (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)]
</span><a href="#local-6989586621683068669"><span class="hs-identifier hs-var">trees</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068671"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621683068671"><span class="hs-identifier hs-var">costs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(StmtTree
    (GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars),
  Int)]
-&gt; ([StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars)],
    [Int])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, Int)
 -&gt; (StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int))
-&gt; [(Int, Int)]
-&gt; [(StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int
 -&gt; Int
 -&gt; (StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int))
-&gt; (Int, Int)
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (ExprStmtTree, Int)
Int
-&gt; Int
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
</span><a href="#local-6989586621683068667"><span class="hs-identifier hs-var">split</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; [(Int, Int)]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621683068672"><span class="hs-identifier hs-var">bounds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2122"></span><span>
</span><span id="line-2123"></span><span>    </span><span class="hs-comment">-- find the best place to split the segment [lo..hi]</span><span>
</span><span id="line-2124"></span><span>    </span><span class="annot"><a href="#local-6989586621683068667"><span class="hs-identifier hs-type">split</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#ExprStmtTree"><span class="hs-identifier hs-type">ExprStmtTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#Cost"><span class="hs-identifier hs-type">Cost</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2125"></span><span>    </span><span id="local-6989586621683068667"><span class="annot"><span class="annottext">split :: Int -&gt; Int -&gt; (ExprStmtTree, Int)
</span><a href="#local-6989586621683068667"><span class="hs-identifier hs-var hs-var">split</span></a></span></span><span> </span><span id="local-6989586621683068680"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span></span><span> </span><span id="local-6989586621683068681"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span></span><span>
</span><span id="line-2126"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var">stmt_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; Int
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2127"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. StmtTree a -&gt; StmtTree a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeBind"><span class="hs-identifier hs-var">StmtTreeBind</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068682"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068683"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068684"><span class="hs-identifier hs-var">c1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068685"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2128"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-2129"></span><span>         </span><span class="hs-comment">-- As per the paper, for a sequence s1...sn, we want to find</span><span>
</span><span id="line-2130"></span><span>         </span><span class="hs-comment">-- the split with the minimum cost, where the cost is the</span><span>
</span><span id="line-2131"></span><span>         </span><span class="hs-comment">-- sum of the cost of the left and right subsequences.</span><span>
</span><span id="line-2132"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-2133"></span><span>         </span><span class="hs-comment">-- As an optimisation (also in the paper) if the cost of</span><span>
</span><span id="line-2134"></span><span>         </span><span class="hs-comment">-- s1..s(n-1) is different from the cost of s2..sn, we know</span><span>
</span><span id="line-2135"></span><span>         </span><span class="hs-comment">-- that the optimal solution is the lower of the two.  Only</span><span>
</span><span id="line-2136"></span><span>         </span><span class="hs-comment">-- in the case that these two have the same cost do we need</span><span>
</span><span id="line-2137"></span><span>         </span><span class="hs-comment">-- to do the exhaustive search.</span><span>
</span><span id="line-2138"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-2139"></span><span>         </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068682"><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068682"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068684"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068684"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621683068683"><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068683"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068685"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068685"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2140"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2141"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var">stmt_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; Int
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-2142"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var">stmt_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; Int
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2143"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068686"><span class="hs-identifier hs-var">left_cost</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068688"><span class="hs-identifier hs-var">right_cost</span></a></span><span>
</span><span id="line-2144"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068689"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068686"><span class="hs-identifier hs-var">left_cost</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var">stmt_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; Int
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2145"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068686"><span class="hs-identifier hs-var">left_cost</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068688"><span class="hs-identifier hs-var">right_cost</span></a></span><span>
</span><span id="line-2146"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
forall a. a -&gt; StmtTree a
</span><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-var">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068657"><span class="hs-identifier hs-var">stmt_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  Int
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; Int
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068691"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068688"><span class="hs-identifier hs-var">right_cost</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2147"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int),
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int))
 -&gt; ((StmtTree
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
         FreeVars),
      Int),
     (StmtTree
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
         FreeVars),
      Int))
 -&gt; Ordering)
-&gt; [((StmtTree
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
         FreeVars),
      Int),
     (StmtTree
        (GenLocated
           SrcSpanAnnA
           (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
         FreeVars),
      Int))]
-&gt; ((StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int),
    (StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int))
forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int),
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int))
 -&gt; Int)
-&gt; ((StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int),
    (StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int))
-&gt; ((StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int),
    (StmtTree
       (GenLocated
          SrcSpanAnnA
          (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
        FreeVars),
     Int))
-&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">((StmtTree
    (GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars),
  Int),
 (StmtTree
    (GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars),
  Int))
-&gt; Int
forall {a} {a} {a}. Num a =&gt; ((a, a), (a, a)) -&gt; a
</span><a href="#local-6989586621683068693"><span class="hs-identifier hs-var">cost</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int),
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int))]
</span><a href="#local-6989586621683068694"><span class="hs-identifier hs-var">alternatives</span></a></span><span>
</span><span id="line-2148"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-2149"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621683068689"><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068689"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068686"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068686"><span class="hs-identifier hs-var">left_cost</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array (Int, Int) (ExprStmtTree, Int)
Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
</span><a href="#local-6989586621683068654"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
-&gt; (Int, Int)
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2150"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621683068691"><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068691"><span class="hs-identifier hs-var">right</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068688"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068688"><span class="hs-identifier hs-var">right_cost</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array (Int, Int) (ExprStmtTree, Int)
Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
</span><a href="#local-6989586621683068654"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
-&gt; (Int, Int)
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2151"></span><span>             </span><span id="local-6989586621683068693"><span class="annot"><span class="annottext">cost :: ((a, a), (a, a)) -&gt; a
</span><a href="#local-6989586621683068693"><span class="hs-identifier hs-var hs-var">cost</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683068697"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068697"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683068698"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068698"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068697"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683068698"><span class="hs-identifier hs-var">c2</span></a></span><span>
</span><span id="line-2152"></span><span>             </span><span id="local-6989586621683068694"><span class="annot"><span class="annottext">alternatives :: [((StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int),
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int))]
</span><a href="#local-6989586621683068694"><span class="hs-identifier hs-var hs-var">alternatives</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array (Int, Int) (ExprStmtTree, Int)
Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
</span><a href="#local-6989586621683068654"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
-&gt; (Int, Int)
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068699"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Array (Int, Int) (ExprStmtTree, Int)
Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
</span><a href="#local-6989586621683068654"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array
  (Int, Int)
  (StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars),
   Int)
-&gt; (Int, Int)
-&gt; (StmtTree
      (GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars),
    Int)
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068699"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2153"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683068699"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068699"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068680"><span class="hs-identifier hs-var">lo</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683068681"><span class="hs-identifier hs-var">hi</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2154"></span><span>
</span><span id="line-2155"></span><span>
</span><span id="line-2156"></span><span class="hs-comment">-- | Turn the ExprStmtTree back into a sequence of statements, using</span><span>
</span><span id="line-2157"></span><span class="hs-comment">-- ApplicativeStmt where necessary.</span><span>
</span><span id="line-2158"></span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-type">stmtTreeToStmts</span></a></span><span>
</span><span id="line-2159"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-type">MonadNames</span></a></span><span>
</span><span id="line-2160"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span>
</span><span id="line-2161"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#ExprStmtTree"><span class="hs-identifier hs-type">ExprStmtTree</span></a></span><span>
</span><span id="line-2162"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>             </span><span class="annot"><span class="hs-comment">-- ^ the &quot;tail&quot;</span></span><span>
</span><span id="line-2163"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span>                     </span><span class="annot"><span class="hs-comment">-- ^ free variables of the tail</span></span><span>
</span><span id="line-2164"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- ( output statements,</span><span>
</span><span id="line-2165"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span> </span><span class="hs-special">)</span><span>             </span><span class="hs-comment">-- , things we needed</span><span>
</span><span id="line-2166"></span><span>
</span><span id="line-2167"></span><span class="hs-comment">-- If we have a single bind, and we can do it without a join, transform</span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- to an ApplicativeStmt.  This corresponds to the rule</span><span>
</span><span id="line-2169"></span><span class="hs-comment">--   dsBlock [pat &lt;- rhs] (return expr) = expr &lt;$&gt; rhs</span><span>
</span><span id="line-2170"></span><span class="hs-comment">-- In the spec, but we do it here rather than in the desugarer,</span><span>
</span><span id="line-2171"></span><span class="hs-comment">-- because we need the typechecker to typecheck the &lt;$&gt; form rather than</span><span>
</span><span id="line-2172"></span><span class="hs-comment">-- the bind form, which would give rise to a Monad constraint.</span><span>
</span><span id="line-2173"></span><span class="hs-comment">--</span><span>
</span><span id="line-2174"></span><span class="hs-comment">-- If we have a single let, and the last statement is @return E@ or @return $ E@,</span><span>
</span><span id="line-2175"></span><span class="hs-comment">-- change the @return@ to @pure@.</span><span>
</span><span id="line-2176"></span><span id="stmtTreeToStmts"><span class="annot"><span class="annottext">stmtTreeToStmts :: MonadNames
-&gt; HsDoFlavour
-&gt; ExprStmtTree
-&gt; [ExprLStmt GhcRn]
-&gt; FreeVars
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var hs-var">stmtTreeToStmts</span></a></span></span><span> </span><span id="local-6989586621683068700"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068700"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span> </span><span id="local-6989586621683068701"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068701"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span id="local-6989586621683068702"><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621683068702"><span class="hs-identifier hs-var">xbs</span></a></span></span><span> </span><span id="local-6989586621683068703"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068703"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683068704"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068704"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2177"></span><span>                </span><span id="local-6989586621683068705"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068705"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621683068706"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068706"><span class="hs-identifier hs-var">_tail_fvs</span></a></span></span><span>
</span><span id="line-2178"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068703"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span id="local-6989586621683068708"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068708"><span class="hs-identifier hs-var">tail'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MonadNames
-&gt; [ExprLStmt GhcRn]
-&gt; Maybe (HsExpr GhcRn)
-&gt; (Bool, [ExprLStmt GhcRn])
</span><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-var">needJoin</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068700"><span class="hs-identifier hs-var">monad_names</span></a></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068705"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2179"></span><span>  </span><span class="hs-comment">-- See Note [ApplicativeDo and strict patterns]</span><span>
</span><span id="line-2180"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
-&gt; [ApplicativeArg GhcRn]
-&gt; Bool
-&gt; [ExprLStmt GhcRn]
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#mkApplicativeStmt"><span class="hs-identifier hs-var">mkApplicativeStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068701"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span>
</span><span id="line-2181"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xarg_app_arg_one :: XApplicativeArgOne GhcRn
</span><a href="GHC.Hs.Expr.html#xarg_app_arg_one"><span class="hs-identifier hs-var">xarg_app_arg_one</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XBindStmtRn -&gt; Maybe (SyntaxExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#xbsrn_failOp"><span class="hs-identifier hs-var">xbsrn_failOp</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
XBindStmtRn
</span><a href="#local-6989586621683068702"><span class="hs-identifier hs-var">xbs</span></a></span><span>
</span><span id="line-2182"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">app_arg_pattern :: LPat GhcRn
</span><a href="GHC.Hs.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068703"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-2183"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">arg_expr :: XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#arg_expr"><span class="hs-identifier hs-var">arg_expr</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068704"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2184"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_body_stmt :: Bool
</span><a href="GHC.Hs.Expr.html#is_body_stmt"><span class="hs-identifier hs-var">is_body_stmt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2185"></span><span>                            </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><span id="line-2186"></span><span>                      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068708"><span class="hs-identifier hs-var">tail'</span></a></span><span>
</span><span id="line-2187"></span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var">stmtTreeToStmts</span></a></span><span> </span><span id="local-6989586621683068715"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068715"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span> </span><span id="local-6989586621683068716"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068716"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068717"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068717"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2188"></span><span>                </span><span id="local-6989586621683068718"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068718"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621683068719"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068719"><span class="hs-identifier hs-var">_tail_fvs</span></a></span></span><span>
</span><span id="line-2189"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span id="local-6989586621683068720"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068720"><span class="hs-identifier hs-var">tail'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MonadNames
-&gt; [ExprLStmt GhcRn]
-&gt; Maybe (HsExpr GhcRn)
-&gt; (Bool, [ExprLStmt GhcRn])
</span><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-var">needJoin</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068715"><span class="hs-identifier hs-var">monad_names</span></a></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068718"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2190"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
-&gt; [ApplicativeArg GhcRn]
-&gt; Bool
-&gt; [ExprLStmt GhcRn]
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#mkApplicativeStmt"><span class="hs-identifier hs-var">mkApplicativeStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068716"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-2191"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span>
</span><span id="line-2192"></span><span>       </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xarg_app_arg_one :: XApplicativeArgOne GhcRn
</span><a href="GHC.Hs.Expr.html#xarg_app_arg_one"><span class="hs-identifier hs-var">xarg_app_arg_one</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprRn
XApplicativeArgOne GhcRn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2193"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">app_arg_pattern :: LPat GhcRn
</span><a href="GHC.Hs.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="GHC.Hs.Utils.html#nlWildPatName"><span class="hs-identifier hs-var">nlWildPatName</span></a></span><span>
</span><span id="line-2194"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">arg_expr :: XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#arg_expr"><span class="hs-identifier hs-var">arg_expr</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068717"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2195"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_body_stmt :: Bool
</span><a href="GHC.Hs.Expr.html#is_body_stmt"><span class="hs-identifier hs-var">is_body_stmt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2196"></span><span>       </span><span class="hs-special">}</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068720"><span class="hs-identifier hs-var">tail'</span></a></span><span>
</span><span id="line-2197"></span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var">stmtTreeToStmts</span></a></span><span> </span><span id="local-6989586621683068722"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068722"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span> </span><span id="local-6989586621683068723"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068723"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068724"><span class="annot"><span class="annottext">let_stmt :: ExprLStmt GhcRn
</span><a href="#local-6989586621683068724"><span class="hs-identifier hs-var">let_stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2198"></span><span>                </span><span id="local-6989586621683068725"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068725"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621683068726"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068726"><span class="hs-identifier hs-var">_tail_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2199"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683068727"><span class="annot"><a href="#local-6989586621683068727"><span class="hs-identifier hs-var">pure_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContext (ZonkAny 0) -&gt; Name -&gt; TcM (HsExpr GhcRn, FreeVars)
forall fn. HsStmtContext fn -&gt; Name -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDoExpr"><span class="hs-identifier hs-var">lookupQualifiedDoExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (ZonkAny 0)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068723"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#pureAName"><span class="hs-identifier hs-var">pureAName</span></a></span><span>
</span><span id="line-2200"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-type">needJoin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068722"><span class="hs-identifier hs-type">monad_names</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068725"><span class="hs-identifier hs-type">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683068727"><span class="hs-identifier hs-type">pure_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2201"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068729"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068729"><span class="hs-identifier hs-var">tail'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprLStmt GhcRn
GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068724"><span class="hs-identifier hs-var">let_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683068729"><span class="hs-identifier hs-var">tail'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2202"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprLStmt GhcRn
GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068724"><span class="hs-identifier hs-var">let_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683068725"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2203"></span><span>
</span><span id="line-2204"></span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var">stmtTreeToStmts</span></a></span><span> </span><span id="local-6989586621683068730"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068730"><span class="hs-identifier hs-var">_monad_names</span></a></span></span><span> </span><span id="local-6989586621683068731"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068731"><span class="hs-identifier hs-var">_ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068732"><span class="annot"><span class="annottext">ExprLStmt GhcRn
</span><a href="#local-6989586621683068732"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068733"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068733"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621683068734"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068734"><span class="hs-identifier hs-var">_tail_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2205"></span><span>  </span><span class="annot"><span class="annottext">([GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
 FreeVars)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
      FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprLStmt GhcRn
GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068732"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683068733"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2206"></span><span>
</span><span id="line-2207"></span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var">stmtTreeToStmts</span></a></span><span> </span><span id="local-6989586621683068735"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068735"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span> </span><span id="local-6989586621683068736"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068736"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeBind"><span class="hs-identifier hs-type">StmtTreeBind</span></a></span><span> </span><span id="local-6989586621683068737"><span class="annot"><span class="annottext">ExprStmtTree
</span><a href="#local-6989586621683068737"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621683068738"><span class="annot"><span class="annottext">ExprStmtTree
</span><a href="#local-6989586621683068738"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068739"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068739"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621683068740"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068740"><span class="hs-identifier hs-var">tail_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2208"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683068741"><span class="annot"><a href="#local-6989586621683068741"><span class="hs-identifier hs-var">stmts1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068742"><span class="annot"><a href="#local-6989586621683068742"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MonadNames
-&gt; HsDoFlavour
-&gt; ExprStmtTree
-&gt; [ExprLStmt GhcRn]
-&gt; FreeVars
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var">stmtTreeToStmts</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068735"><span class="hs-identifier hs-var">monad_names</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068736"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmtTree
</span><a href="#local-6989586621683068738"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068739"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068740"><span class="hs-identifier hs-var">tail_fvs</span></a></span><span>
</span><span id="line-2209"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068743"><span class="annot"><a href="#local-6989586621683068743"><span class="hs-identifier hs-var hs-var">tail1_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unionNameSets"><span class="hs-identifier hs-var">unionNameSets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068740"><span class="hs-identifier hs-var">tail_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; [FreeVars] -&gt; [FreeVars]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)
 -&gt; FreeVars)
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; [FreeVars]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; FreeVars
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. StmtTree a -&gt; [a]
</span><a href="GHC.Rename.Expr.html#flattenStmtTree"><span class="hs-identifier hs-var">flattenStmtTree</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmtTree
StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068738"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2210"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683068745"><span class="annot"><a href="#local-6989586621683068745"><span class="hs-identifier hs-var">stmts2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068746"><span class="annot"><a href="#local-6989586621683068746"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-type">stmtTreeToStmts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068735"><span class="hs-identifier hs-type">monad_names</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068736"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068737"><span class="hs-identifier hs-type">before</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068741"><span class="hs-identifier hs-type">stmts1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068743"><span class="hs-identifier hs-type">tail1_fvs</span></a></span><span>
</span><span id="line-2211"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068745"><span class="hs-identifier hs-type">stmts2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068742"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068746"><span class="hs-identifier hs-type">fvs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2212"></span><span>
</span><span id="line-2213"></span><span class="annot"><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var">stmtTreeToStmts</span></a></span><span> </span><span id="local-6989586621683068747"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068747"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span> </span><span id="local-6989586621683068748"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068748"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeApplicative"><span class="hs-identifier hs-type">StmtTreeApplicative</span></a></span><span> </span><span id="local-6989586621683068749"><span class="annot"><span class="annottext">[ExprStmtTree]
</span><a href="#local-6989586621683068749"><span class="hs-identifier hs-var">trees</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068750"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068750"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621683068751"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068751"><span class="hs-identifier hs-var">tail_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2214"></span><span>   </span><span id="local-6989586621683068752"><span class="annot"><a href="#local-6989586621683068752"><span class="hs-identifier hs-var">hscEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-2215"></span><span>   </span><span id="local-6989586621683068754"><span class="annot"><a href="#local-6989586621683068754"><span class="hs-identifier hs-var">rdrEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-2216"></span><span>   </span><span id="local-6989586621683068756"><span class="annot"><a href="#local-6989586621683068756"><span class="hs-identifier hs-var">comps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCompleteMatchesTcM"><span class="hs-identifier hs-type">getCompleteMatchesTcM</span></a></span><span>
</span><span id="line-2217"></span><span>   </span><span id="local-6989586621683068758"><span class="annot"><a href="#local-6989586621683068758"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068759"><span class="hs-identifier hs-type">stmtTreeArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068748"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068751"><span class="hs-identifier hs-type">tail_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068749"><span class="hs-identifier hs-type">trees</span></a></span><span>
</span><span id="line-2218"></span><span>   </span><span id="local-6989586621683068760"><span class="annot"><a href="#local-6989586621683068760"><span class="hs-identifier hs-var">strict</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Strict</span></span><span>
</span><span id="line-2219"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068762"><span class="annot"><a href="#local-6989586621683068762"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068763"><span class="annot"><a href="#local-6989586621683068763"><span class="hs-identifier hs-var">fvss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621683068758"><span class="hs-identifier hs-type">pairs</span></a></span><span>
</span><span id="line-2220"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068764"><span class="annot"><a href="#local-6989586621683068764"><span class="hs-identifier hs-var">need_join</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068765"><span class="annot"><a href="#local-6989586621683068765"><span class="hs-identifier hs-var">tail'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2221"></span><span>     </span><span class="hs-comment">-- See Note [ApplicativeDo and refutable patterns]</span><span>
</span><span id="line-2222"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#hasRefutablePattern"><span class="hs-identifier hs-type">hasRefutablePattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068760"><span class="hs-identifier hs-type">strict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068752"><span class="hs-identifier hs-type">hscEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068754"><span class="hs-identifier hs-type">rdrEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068756"><span class="hs-identifier hs-type">comps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683068762"><span class="hs-identifier hs-type">stmts'</span></a></span><span>
</span><span id="line-2223"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068750"><span class="hs-identifier hs-type">tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2224"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-type">needJoin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068747"><span class="hs-identifier hs-type">monad_names</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068750"><span class="hs-identifier hs-type">tail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-2225"></span><span>
</span><span id="line-2226"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621683068768"><span class="annot"><a href="#local-6989586621683068768"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068769"><span class="annot"><a href="#local-6989586621683068769"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#mkApplicativeStmt"><span class="hs-identifier hs-type">mkApplicativeStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068748"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068762"><span class="hs-identifier hs-type">stmts'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068764"><span class="hs-identifier hs-type">need_join</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068765"><span class="hs-identifier hs-type">tail'</span></a></span><span>
</span><span id="line-2227"></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068768"><span class="hs-identifier hs-type">stmts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unionNameSets"><span class="hs-identifier hs-type">unionNameSets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068769"><span class="hs-identifier hs-type">fvs</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683068763"><span class="hs-identifier hs-type">fvss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2228"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2229"></span><span>   </span><span id="local-6989586621683068759"><span class="annot"><span class="annottext">stmtTreeArg :: HsDoFlavour
-&gt; FreeVars
-&gt; StmtTree
     (GenLocated
        SrcSpanAnnA
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcRn, FreeVars)
</span><a href="#local-6989586621683068759"><span class="hs-identifier hs-var hs-var">stmtTreeArg</span></a></span></span><span> </span><span id="local-6989586621683068770"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068770"><span class="hs-identifier hs-var">_ctxt</span></a></span></span><span> </span><span id="local-6989586621683068771"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068771"><span class="hs-identifier hs-var">_tail_fvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span id="local-6989586621683068772"><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621683068772"><span class="hs-identifier hs-var">xbs</span></a></span></span><span> </span><span id="local-6989586621683068773"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068773"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683068774"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068774"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2230"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApplicativeArg GhcRn, FreeVars)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span>
</span><span id="line-2231"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xarg_app_arg_one :: XApplicativeArgOne GhcRn
</span><a href="GHC.Hs.Expr.html#xarg_app_arg_one"><span class="hs-identifier hs-var">xarg_app_arg_one</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XBindStmtRn -&gt; Maybe (SyntaxExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#xbsrn_failOp"><span class="hs-identifier hs-var">xbsrn_failOp</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
XBindStmtRn
</span><a href="#local-6989586621683068772"><span class="hs-identifier hs-var">xbs</span></a></span><span>
</span><span id="line-2232"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">app_arg_pattern :: LPat GhcRn
</span><a href="GHC.Hs.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068773"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-2233"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">arg_expr :: XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#arg_expr"><span class="hs-identifier hs-var">arg_expr</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068774"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-2234"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_body_stmt :: Bool
</span><a href="GHC.Hs.Expr.html#is_body_stmt"><span class="hs-identifier hs-var">is_body_stmt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2235"></span><span>               </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2236"></span><span>   </span><span class="annot"><a href="#local-6989586621683068759"><span class="hs-identifier hs-var">stmtTreeArg</span></a></span><span> </span><span id="local-6989586621683068775"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068775"><span class="hs-identifier hs-var">_ctxt</span></a></span></span><span> </span><span id="local-6989586621683068776"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068776"><span class="hs-identifier hs-var">_tail_fvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Expr.html#StmtTreeOne"><span class="hs-identifier hs-type">StmtTreeOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068777"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068777"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2237"></span><span>     </span><span class="annot"><span class="annottext">(ApplicativeArg GhcRn, FreeVars)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span>
</span><span id="line-2238"></span><span>             </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xarg_app_arg_one :: XApplicativeArgOne GhcRn
</span><a href="GHC.Hs.Expr.html#xarg_app_arg_one"><span class="hs-identifier hs-var">xarg_app_arg_one</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprRn
XApplicativeArgOne GhcRn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2239"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">app_arg_pattern :: LPat GhcRn
</span><a href="GHC.Hs.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="GHC.Hs.Utils.html#nlWildPatName"><span class="hs-identifier hs-var">nlWildPatName</span></a></span><span>
</span><span id="line-2240"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">arg_expr :: XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Hs.Expr.html#arg_expr"><span class="hs-identifier hs-var">arg_expr</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068777"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-2241"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_body_stmt :: Bool
</span><a href="GHC.Hs.Expr.html#is_body_stmt"><span class="hs-identifier hs-var">is_body_stmt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2242"></span><span>             </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2243"></span><span>   </span><span class="annot"><a href="#local-6989586621683068759"><span class="hs-identifier hs-var">stmtTreeArg</span></a></span><span> </span><span id="local-6989586621683068778"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068778"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068779"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068779"><span class="hs-identifier hs-var">tail_fvs</span></a></span></span><span> </span><span id="local-6989586621683068780"><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068780"><span class="hs-identifier hs-var">tree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2244"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068781"><span class="annot"><span class="annottext">stmts :: [(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068781"><span class="hs-identifier hs-var hs-var hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. StmtTree a -&gt; [a]
</span><a href="GHC.Rename.Expr.html#flattenStmtTree"><span class="hs-identifier hs-var">flattenStmtTree</span></a></span><span> </span><span class="annot"><span class="annottext">StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068780"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-2245"></span><span>         </span><span id="local-6989586621683068782"><span class="annot"><span class="annottext">pvarset :: FreeVars
</span><a href="#local-6989586621683068782"><span class="hs-identifier hs-var hs-var hs-var">pvarset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)
 -&gt; [Name])
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; [Name]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag GhcRn
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; [IdP GhcRn]
forall (idL :: Pass) (idR :: Pass) body.
(IsPass idL, IsPass idR, CollectPass (GhcPass idL)) =&gt;
CollectFlag (GhcPass idL)
-&gt; StmtLR (GhcPass idL) (GhcPass idR) body -&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectStmtBinders"><span class="hs-identifier hs-var">collectStmtBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
 -&gt; [Name])
-&gt; ((GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)
    -&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
 -&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; ((GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)
    -&gt; GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068781"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2246"></span><span>                     </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#intersectNameSet"><span class="hs-operator hs-var">`intersectNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068779"><span class="hs-identifier hs-var">tail_fvs</span></a></span><span>
</span><span id="line-2247"></span><span>         </span><span id="local-6989586621683068784"><span class="annot"><span class="annottext">pvars :: [Name]
</span><a href="#local-6989586621683068784"><span class="hs-identifier hs-var hs-var hs-var">pvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; [Name]
</span><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068782"><span class="hs-identifier hs-var">pvarset</span></a></span><span>
</span><span id="line-2248"></span><span>           </span><span class="hs-comment">-- See Note [Deterministic ApplicativeDo and RecursiveDo desugaring]</span><span>
</span><span id="line-2249"></span><span>         </span><span id="local-6989586621683068785"><span class="annot"><span class="annottext">pat :: LPat GhcRn
</span><a href="#local-6989586621683068785"><span class="hs-identifier hs-var hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn] -&gt; LPat GhcRn
</span><a href="GHC.Hs.Utils.html#mkBigLHsVarPatTup"><span class="hs-identifier hs-var">mkBigLHsVarPatTup</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683068784"><span class="hs-identifier hs-var">pvars</span></a></span><span>
</span><span id="line-2250"></span><span>         </span><span id="local-6989586621683068787"><span class="annot"><span class="annottext">tup :: XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068787"><span class="hs-identifier hs-var hs-var hs-var">tup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn] -&gt; XExplicitTuple GhcRn -&gt; XRec GhcRn (HsExpr GhcRn)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
[IdP (GhcPass p)]
-&gt; XExplicitTuple (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#mkBigLHsVarTup"><span class="hs-identifier hs-var">mkBigLHsVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621683068784"><span class="hs-identifier hs-var">pvars</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-2251"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621683068789"><span class="annot"><a href="#local-6989586621683068789"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068790"><span class="annot"><a href="#local-6989586621683068790"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MonadNames
-&gt; HsDoFlavour
-&gt; ExprStmtTree
-&gt; [ExprLStmt GhcRn]
-&gt; FreeVars
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#stmtTreeToStmts"><span class="hs-identifier hs-var">stmtTreeToStmts</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068747"><span class="hs-identifier hs-var">monad_names</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068778"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmtTree
StmtTree
  (GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)
</span><a href="#local-6989586621683068780"><span class="hs-identifier hs-var">tree</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068782"><span class="hs-identifier hs-var">pvarset</span></a></span><span>
</span><span id="line-2252"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621683068791"><span class="annot"><a href="#local-6989586621683068791"><span class="hs-identifier hs-var">mb_ret</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068792"><span class="annot"><a href="#local-6989586621683068792"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2253"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XStmtLR"><span class="hs-identifier hs-type">XStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeStmt"><span class="hs-identifier hs-type">ApplicativeStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">last</span></span><span> </span><span class="annot"><a href="#local-6989586621683068789"><span class="hs-identifier hs-type">stmts'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2254"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068787"><span class="hs-identifier hs-type">tup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2255"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2256"></span><span>             </span><span class="hs-comment">-- Need 'pureAName' and not 'returnMName' here, so that it requires</span><span>
</span><span id="line-2257"></span><span>             </span><span class="hs-comment">-- 'Applicative' and not 'Monad' whenever possible (until #20540 is fixed).</span><span>
</span><span id="line-2258"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621683068794"><span class="annot"><a href="#local-6989586621683068794"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoExpr"><span class="hs-identifier hs-type">lookupQualifiedDoExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068778"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#pureAName"><span class="hs-identifier hs-type">pureAName</span></a></span><span>
</span><span id="line-2259"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068795"><span class="annot"><a href="#local-6989586621683068795"><span class="hs-identifier hs-var hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683068794"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068787"><span class="hs-identifier hs-var">tup</span></a></span><span>
</span><span id="line-2260"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683068795"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArgMany"><span class="hs-identifier hs-type">ApplicativeArgMany</span></a></span><span>
</span><span id="line-2262"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#xarg_app_arg_many"><span class="hs-identifier hs-var">xarg_app_arg_many</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span>
</span><span id="line-2263"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#app_stmts"><span class="hs-identifier hs-var">app_stmts</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068789"><span class="hs-identifier hs-type">stmts'</span></a></span><span>
</span><span id="line-2264"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#final_expr"><span class="hs-identifier hs-var">final_expr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068791"><span class="hs-identifier hs-type">mb_ret</span></a></span><span>
</span><span id="line-2265"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#bv_pattern"><span class="hs-identifier hs-var">bv_pattern</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068785"><span class="hs-identifier hs-type">pat</span></a></span><span>
</span><span id="line-2266"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#stmt_context"><span class="hs-identifier hs-var">stmt_context</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683068778"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-2267"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-2268"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068792"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068790"><span class="hs-identifier hs-type">fvs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2269"></span><span>
</span><span id="line-2270"></span><span>
</span><span id="line-2271"></span><span class="hs-comment">-- | Divide a sequence of statements into segments, where no segment</span><span>
</span><span id="line-2272"></span><span class="hs-comment">-- depends on any variables defined by a statement in another segment.</span><span>
</span><span id="line-2273"></span><span class="annot"><a href="GHC.Rename.Expr.html#segments"><span class="hs-identifier hs-type">segments</span></a></span><span>
</span><span id="line-2274"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2275"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2276"></span><span id="segments"><span class="annot"><span class="annottext">segments :: [(ExprLStmt GhcRn, FreeVars)] -&gt; [[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="GHC.Rename.Expr.html#segments"><span class="hs-identifier hs-var hs-var">segments</span></a></span></span><span> </span><span id="local-6989586621683068802"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068802"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)]]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
forall {a :: Pass} {b} {b}.
[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
-&gt; [[(GenLocated
        (Anno (StmtLR (GhcPass a) (GhcPass a) b))
        (StmtLR (GhcPass a) (GhcPass a) b),
      b)]]
</span><a href="#local-6989586621683068803"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">([[(GenLocated
      (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)]]
 -&gt; [[(GenLocated
         (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars)]])
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)]]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([[(GenLocated
      (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)]]
 -&gt; [[(GenLocated
         (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars)]])
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([(ExprLStmt GhcRn, FreeVars)]
 -&gt; [(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)])
-&gt; [[(ExprLStmt GhcRn, FreeVars)]]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([[(ExprLStmt GhcRn, FreeVars)]]
 -&gt; [[(GenLocated
         (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars)]])
-&gt; [[(ExprLStmt GhcRn, FreeVars)]]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; [[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="#local-6989586621683068804"><span class="hs-identifier hs-var">walk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068802"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2277"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2278"></span><span>    </span><span id="local-6989586621683068805"><span class="annot"><span class="annottext">allvars :: FreeVars
</span><a href="#local-6989586621683068805"><span class="hs-identifier hs-var hs-var">allvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)
 -&gt; [Name])
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; [Name]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag GhcRn
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; [IdP GhcRn]
forall (idL :: Pass) (idR :: Pass) body.
(IsPass idL, IsPass idR, CollectPass (GhcPass idL)) =&gt;
CollectFlag (GhcPass idL)
-&gt; StmtLR (GhcPass idL) (GhcPass idR) body -&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectStmtBinders"><span class="hs-identifier hs-var">collectStmtBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
 -&gt; [Name])
-&gt; ((GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)
    -&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
 -&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; ((GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)
    -&gt; GenLocated
         SrcSpanAnnA
         (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    FreeVars)
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068802"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2279"></span><span>
</span><span id="line-2280"></span><span>    </span><span class="hs-comment">-- We would rather not have a segment that just has LetStmts in</span><span>
</span><span id="line-2281"></span><span>    </span><span class="hs-comment">-- it, so combine those with the next segment where possible.</span><span>
</span><span id="line-2282"></span><span>    </span><span class="hs-comment">-- We don't merge it with the previous segment because the merged segment</span><span>
</span><span id="line-2283"></span><span>    </span><span class="hs-comment">-- would require 'Monad' while it may otherwise only require 'Applicative'.</span><span>
</span><span id="line-2284"></span><span>    </span><span id="local-6989586621683068803"><span class="annot"><span class="annottext">merge :: [[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
-&gt; [[(GenLocated
        (Anno (StmtLR (GhcPass a) (GhcPass a) b))
        (StmtLR (GhcPass a) (GhcPass a) b),
      b)]]
</span><a href="#local-6989586621683068803"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2285"></span><span>    </span><span class="annot"><a href="#local-6989586621683068803"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068807"><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
</span><a href="#local-6989586621683068807"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068808"><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068808"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2286"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068809"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2287"></span><span>          </span><span id="local-6989586621683068810"><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
</span><a href="#local-6989586621683068810"><span class="hs-identifier hs-var">s</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683068811"><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068811"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068812"><span class="hs-identifier hs-var">all_lets</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
</span><a href="#local-6989586621683068807"><span class="hs-identifier hs-var">seg</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
-&gt; [(GenLocated
       (Anno (StmtLR (GhcPass a) (GhcPass a) b))
       (StmtLR (GhcPass a) (GhcPass a) b),
     b)]
-&gt; [(GenLocated
       (Anno (StmtLR (GhcPass a) (GhcPass a) b))
       (StmtLR (GhcPass a) (GhcPass a) b),
     b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
</span><a href="#local-6989586621683068810"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
-&gt; [[(GenLocated
        (Anno (StmtLR (GhcPass a) (GhcPass a) b))
        (StmtLR (GhcPass a) (GhcPass a) b),
      b)]]
-&gt; [[(GenLocated
        (Anno (StmtLR (GhcPass a) (GhcPass a) b))
        (StmtLR (GhcPass a) (GhcPass a) b),
      b)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068811"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-2288"></span><span>          </span><span id="local-6989586621683068813"><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068813"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
</span><a href="#local-6989586621683068807"><span class="hs-identifier hs-var">seg</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
-&gt; [[(GenLocated
        (Anno (StmtLR (GhcPass a) (GhcPass a) b))
        (StmtLR (GhcPass a) (GhcPass a) b),
      b)]]
-&gt; [[(GenLocated
        (Anno (StmtLR (GhcPass a) (GhcPass a) b))
        (StmtLR (GhcPass a) (GhcPass a) b),
      b)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068809"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2289"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2290"></span><span>        </span><span id="local-6989586621683068809"><span class="annot"><span class="annottext">rest :: [[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068809"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
-&gt; [[(GenLocated
        (Anno (StmtLR (GhcPass a) (GhcPass a) b))
        (StmtLR (GhcPass a) (GhcPass a) b),
      b)]]
</span><a href="#local-6989586621683068803"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">[[(GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b),
   b)]]
</span><a href="#local-6989586621683068808"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-2291"></span><span>        </span><span id="local-6989586621683068812"><span class="annot"><span class="annottext">all_lets :: Bool
</span><a href="#local-6989586621683068812"><span class="hs-identifier hs-var hs-var">all_lets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)
 -&gt; Bool)
-&gt; [(GenLocated
       (Anno (StmtLR (GhcPass a) (GhcPass a) b))
       (StmtLR (GhcPass a) (GhcPass a) b),
     b)]
-&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LStmt (GhcPass a) b -&gt; Bool
GenLocated
  (Anno (StmtLR (GhcPass a) (GhcPass a) b))
  (StmtLR (GhcPass a) (GhcPass a) b)
-&gt; Bool
forall (a :: Pass) b. LStmt (GhcPass a) b -&gt; Bool
</span><a href="GHC.Rename.Expr.html#isLetStmt"><span class="hs-identifier hs-var">isLetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   (Anno (StmtLR (GhcPass a) (GhcPass a) b))
   (StmtLR (GhcPass a) (GhcPass a) b)
 -&gt; Bool)
-&gt; ((GenLocated
       (Anno (StmtLR (GhcPass a) (GhcPass a) b))
       (StmtLR (GhcPass a) (GhcPass a) b),
     b)
    -&gt; GenLocated
         (Anno (StmtLR (GhcPass a) (GhcPass a) b))
         (StmtLR (GhcPass a) (GhcPass a) b))
-&gt; (GenLocated
      (Anno (StmtLR (GhcPass a) (GhcPass a) b))
      (StmtLR (GhcPass a) (GhcPass a) b),
    b)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   (Anno (StmtLR (GhcPass a) (GhcPass a) b))
   (StmtLR (GhcPass a) (GhcPass a) b),
 b)
-&gt; GenLocated
     (Anno (StmtLR (GhcPass a) (GhcPass a) b))
     (StmtLR (GhcPass a) (GhcPass a) b)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR (GhcPass a) (GhcPass a) b))
    (StmtLR (GhcPass a) (GhcPass a) b),
  b)]
</span><a href="#local-6989586621683068807"><span class="hs-identifier hs-var">seg</span></a></span><span>
</span><span id="line-2292"></span><span>
</span><span id="line-2293"></span><span>    </span><span class="hs-comment">-- walk splits the statement sequence into segments, traversing</span><span>
</span><span id="line-2294"></span><span>    </span><span class="hs-comment">-- the sequence from the back to the front, and keeping track of</span><span>
</span><span id="line-2295"></span><span>    </span><span class="hs-comment">-- the set of free variables of the current segment.  Whenever</span><span>
</span><span id="line-2296"></span><span>    </span><span class="hs-comment">-- this set of free variables is empty, we have a complete segment.</span><span>
</span><span id="line-2297"></span><span>    </span><span class="annot"><a href="#local-6989586621683068804"><span class="hs-identifier hs-type">walk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2298"></span><span>    </span><span id="local-6989586621683068804"><span class="annot"><span class="annottext">walk :: [(ExprLStmt GhcRn, FreeVars)] -&gt; [[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="#local-6989586621683068804"><span class="hs-identifier hs-var hs-var">walk</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2299"></span><span>    </span><span class="annot"><a href="#local-6989586621683068804"><span class="hs-identifier hs-var">walk</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068816"><span class="annot"><span class="annottext">ExprLStmt GhcRn
</span><a href="#local-6989586621683068816"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068817"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068817"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068818"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068818"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprLStmt GhcRn
GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068816"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068817"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068819"><span class="hs-identifier hs-var">seg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
-&gt; [[(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)] -&gt; [[(ExprLStmt GhcRn, FreeVars)]]
</span><a href="#local-6989586621683068804"><span class="hs-identifier hs-var">walk</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068820"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2300"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068819"><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068819"><span class="hs-identifier hs-var">seg</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068820"><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068820"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; ([(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)],
    [(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)])
</span><a href="#local-6989586621683068821"><span class="hs-identifier hs-var">chunter</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068822"><span class="hs-identifier hs-var">fvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068818"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2301"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068822"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068822"><span class="hs-identifier hs-var">fvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; FreeVars -&gt; (FreeVars, FreeVars)
</span><a href="#local-6989586621683068823"><span class="hs-identifier hs-var">stmtRefs</span></a></span><span> </span><span class="annot"><span class="annottext">ExprLStmt GhcRn
GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068816"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068817"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-2302"></span><span>
</span><span id="line-2303"></span><span>    </span><span id="local-6989586621683068821"><span class="annot"><span class="annottext">chunter :: FreeVars
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; ([(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)],
    [(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)])
</span><a href="#local-6989586621683068821"><span class="hs-identifier hs-var hs-var">chunter</span></a></span></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2304"></span><span>    </span><span class="annot"><a href="#local-6989586621683068821"><span class="hs-identifier hs-var">chunter</span></a></span><span> </span><span id="local-6989586621683068824"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068824"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621683068825"><span class="annot"><span class="annottext">orig :: [(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068825"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683068826"><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068826"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068827"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068827"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068828"><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068828"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2305"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068824"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExprLStmt GhcRn -&gt; Bool
</span><a href="#local-6989586621683068829"><span class="hs-identifier hs-var">definitelyLazyPatternBind</span></a></span><span> </span><span class="annot"><span class="annottext">ExprLStmt GhcRn
GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068826"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2306"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068825"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2307"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2308"></span><span>           </span><span class="hs-comment">-- See Note [ApplicativeDo and strict patterns]</span><span>
</span><span id="line-2309"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068826"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068827"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
   (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
 FreeVars)
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068830"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068831"><span class="hs-identifier hs-var">rest'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2310"></span><span>       </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068830"><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068830"><span class="hs-identifier hs-var">chunk</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068831"><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068831"><span class="hs-identifier hs-var">rest'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
-&gt; [(GenLocated
       (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; ([(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)],
    [(GenLocated
        (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
        (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)])
</span><a href="#local-6989586621683068821"><span class="hs-identifier hs-var">chunter</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068832"><span class="hs-identifier hs-var">vars'</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068828"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2311"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621683068833"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068833"><span class="hs-identifier hs-var">pvars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068834"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068834"><span class="hs-identifier hs-var">evars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; FreeVars -&gt; (FreeVars, FreeVars)
</span><a href="#local-6989586621683068823"><span class="hs-identifier hs-var">stmtRefs</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068826"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068827"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-2312"></span><span>             </span><span id="local-6989586621683068832"><span class="annot"><span class="annottext">vars' :: FreeVars
</span><a href="#local-6989586621683068832"><span class="hs-identifier hs-var hs-var">vars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068824"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#minusNameSet"><span class="hs-operator hs-var">`minusNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068833"><span class="hs-identifier hs-var">pvars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-var">`unionNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068834"><span class="hs-identifier hs-var">evars</span></a></span><span>
</span><span id="line-2313"></span><span>
</span><span id="line-2314"></span><span>    </span><span id="local-6989586621683068823"><span class="annot"><span class="annottext">stmtRefs :: GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; FreeVars -&gt; (FreeVars, FreeVars)
</span><a href="#local-6989586621683068823"><span class="hs-identifier hs-var hs-var">stmtRefs</span></a></span></span><span> </span><span id="local-6989586621683068836"><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068836"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span id="local-6989586621683068837"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068837"><span class="hs-identifier hs-var">fvs</span></a></span></span><span>
</span><span id="line-2315"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; Bool
forall (a :: Pass) b. LStmt (GhcPass a) b -&gt; Bool
</span><a href="GHC.Rename.Expr.html#isLetStmt"><span class="hs-identifier hs-var">isLetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068836"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068838"><span class="hs-identifier hs-var">pvars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068839"><span class="hs-identifier hs-var">fvs'</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#minusNameSet"><span class="hs-operator hs-var">`minusNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068838"><span class="hs-identifier hs-var">pvars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2316"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068838"><span class="hs-identifier hs-var">pvars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068839"><span class="hs-identifier hs-var">fvs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2317"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683068839"><span class="annot"><span class="annottext">fvs' :: FreeVars
</span><a href="#local-6989586621683068839"><span class="hs-identifier hs-var hs-var">fvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068837"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#intersectNameSet"><span class="hs-operator hs-var">`intersectNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068805"><span class="hs-identifier hs-var">allvars</span></a></span><span>
</span><span id="line-2318"></span><span>            </span><span id="local-6989586621683068838"><span class="annot"><span class="annottext">pvars :: FreeVars
</span><a href="#local-6989586621683068838"><span class="hs-identifier hs-var hs-var">pvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag GhcRn
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; [IdP GhcRn]
forall (idL :: Pass) (idR :: Pass) body.
(IsPass idL, IsPass idR, CollectPass (GhcPass idL)) =&gt;
CollectFlag (GhcPass idL)
-&gt; StmtLR (GhcPass idL) (GhcPass idR) body -&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectStmtBinders"><span class="hs-identifier hs-var">collectStmtBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcRn
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  (Anno (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
  (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621683068836"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2319"></span><span>
</span><span id="line-2320"></span><span>    </span><span class="annot"><a href="#local-6989586621683068829"><span class="hs-identifier hs-type">definitelyLazyPatternBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2321"></span><span>    </span><span id="local-6989586621683068829"><span class="annot"><span class="annottext">definitelyLazyPatternBind :: ExprLStmt GhcRn -&gt; Bool
</span><a href="#local-6989586621683068829"><span class="hs-identifier hs-var hs-var">definitelyLazyPatternBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068840"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068840"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068840"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-2322"></span><span>    </span><span class="annot"><a href="#local-6989586621683068829"><span class="hs-identifier hs-var">definitelyLazyPatternBind</span></a></span><span> </span><span class="annot"><span class="annottext">ExprLStmt GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2323"></span><span>
</span><span id="line-2324"></span><span class="hs-comment">{-
Note [ApplicativeDo and strict patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A strict pattern match is really a dependency.  For example,

do
  (x,y) &lt;- A
  z &lt;- B
  return C

The pattern (_,_) must be matched strictly before we do B.  If we
allowed this to be transformed into

  (\(x,y) -&gt; \z -&gt; C) &lt;$&gt; A &lt;*&gt; B

then it could be lazier than the standard desugaring using &gt;&gt;=.  See #13875
for more examples.

Thus, whenever we have a potentially strict pattern match, we treat it as a
dependency between that statement and the following one.  The
dependency prevents those two statements from being performed &quot;in
parallel&quot; in an ApplicativeStmt, but doesn't otherwise affect what we
can do with the rest of the statements in the same &quot;do&quot; expression.

The necessary &quot;definitely lazy&quot; test is similar, but distinct to irrefutability.
See Note [definitelyLazyPattern vs. isIrrefutableHsPat].

Note [definitelyLazyPattern vs. isIrrefutableHsPat]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Lazy patterns are irrefutable, but not all irrefutable patterns are lazy.
Examples:
  * (x,y) is an irrefutable pattern, but not lazy.
  * x is both irrefutable and lazy.
  * The or pattern (~True; False) is both irrefutable and lazy,
    because the first pattern alt accepts without forcing the scrutinee.
  * The or pattern (False; ~True) is irrefutable, but not lazy,
    because the first pattern alt forces the scrutinee and may fail,
    but the second alt is irrefutable and hence the whole pattern is.
-}</span><span>
</span><span id="line-2363"></span><span>
</span><span id="line-2364"></span><span class="annot"><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-type">definitelyLazyPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683066464"><span class="annot"><a href="#local-6989586621683066464"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#IsPass"><span class="hs-identifier hs-type">IsPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066464"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066464"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2365"></span><span class="hs-comment">-- See Note [definitelyLazyPattern vs. isIrrefutableHsPat]</span><span>
</span><span id="line-2366"></span><span class="hs-comment">-- A conservative analysis that says False if in doubt, hence &quot;definitely&quot;.</span><span>
</span><span id="line-2367"></span><span class="hs-comment">-- E.g., the ViewPat (const 5 -&gt; 13) is really lazy, but below we say False.</span><span>
</span><span id="line-2368"></span><span id="definitelyLazyPattern"><span class="annot"><span class="annottext">definitelyLazyPattern :: forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var hs-var">definitelyLazyPattern</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068848"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068848"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683068849"><span class="annot"><span class="annottext">Pat (GhcPass p)
</span><a href="#local-6989586621683068849"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2369"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass p)
</span><a href="#local-6989586621683068849"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2370"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-type">WildPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2371"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2372"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2373"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span class="annot"><span class="annottext">XAsPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LIdP (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068854"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068854"><span class="hs-identifier hs-var">p</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068854"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2374"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068856"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068856"><span class="hs-identifier hs-var">p</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068856"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2375"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ViewPat"><span class="hs-identifier hs-type">ViewPat</span></a></span><span> </span><span class="annot"><span class="annottext">XViewPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068858"><span class="annot"><span class="annottext">LHsExpr (GhcPass p)
</span><a href="#local-6989586621683068858"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span id="local-6989586621683068859"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068859"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068859"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-comment">--- || definitelyLazyFun _f</span><span>
</span><span id="line-2376"></span><span>      </span><span class="hs-comment">-- NB: We keep it simple and assume `definitelyLazyFun _ = False`</span><span>
</span><span id="line-2377"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SigPat"><span class="hs-identifier hs-type">SigPat</span></a></span><span> </span><span class="annot"><span class="annottext">XSigPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068861"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068861"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc (GhcPass p))
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068861"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2378"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#OrPat"><span class="hs-identifier hs-type">OrPat</span></a></span><span> </span><span class="annot"><span class="annottext">XOrPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068863"><span class="annot"><span class="annottext">NonEmpty (LPat (GhcPass p))
</span><a href="#local-6989586621683068863"><span class="hs-identifier hs-var">p</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass p))
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-var">NE.head</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LPat (GhcPass p))
NonEmpty (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
</span><a href="#local-6989586621683068863"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2379"></span><span>      </span><span class="hs-comment">-- NB: foo (~True; False) = () is lazy!</span><span>
</span><span id="line-2380"></span><span>      </span><span class="hs-comment">-- See Note [definitelyLazyPattern vs. isIrrefutableHsPat]</span><span>
</span><span id="line-2381"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2382"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-type">ListPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2383"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2384"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SumPat"><span class="hs-identifier hs-type">SumPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2385"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- Some PatSyns are lazy; False is conservative</span><span>
</span><span id="line-2386"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LitPat"><span class="hs-identifier hs-type">LitPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2387"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPat"><span class="hs-identifier hs-type">NPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- Some NPats are lazy; False is conservative</span><span>
</span><span id="line-2388"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPlusKPat"><span class="hs-identifier hs-type">NPlusKPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2389"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-type">SplicePat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2390"></span><span>
</span><span id="line-2391"></span><span>    </span><span class="hs-comment">-- The behavior of this case is unimportant, as GHC will throw an error shortly</span><span>
</span><span id="line-2392"></span><span>    </span><span class="hs-comment">-- after reaching this case for other reasons (see TcRnIllegalTypePattern).</span><span>
</span><span id="line-2393"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#EmbTyPat"><span class="hs-identifier hs-type">EmbTyPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2394"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#InvisPat"><span class="hs-identifier hs-type">InvisPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2395"></span><span>
</span><span id="line-2396"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#XPat"><span class="hs-identifier hs-type">XPat</span></a></span><span> </span><span id="local-6989586621683068876"><span class="annot"><span class="annottext">XXPat (GhcPass p)
</span><a href="#local-6989586621683068876"><span class="hs-identifier hs-var">ext</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). IsPass p =&gt; GhcPass p
</span><a href="GHC.Hs.Extension.html#ghcPass"><span class="hs-identifier hs-var">ghcPass</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621683066464"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2397"></span><span>      </span><span class="annot"><span class="annottext">GhcPass p
</span><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-var">GhcRn</span></a></span><span>
</span><span id="line-2398"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#HsPatExpanded"><span class="hs-identifier hs-type">HsPatExpanded</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068883"><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621683068883"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">XXPat (GhcPass p)
</span><a href="#local-6989586621683068876"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-2399"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; Pat GhcRn -&gt; GenLocated SrcSpanAnnA (Pat GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068848"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621683068883"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2400"></span><span>      </span><span class="annot"><span class="annottext">GhcPass p
</span><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-var">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">XXPat (GhcPass p)
</span><a href="#local-6989586621683068876"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2401"></span><span>        </span><span class="annot"><a href="GHC.Hs.Pat.html#ExpansionPat"><span class="hs-identifier hs-type">ExpansionPat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068891"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683068891"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068848"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683068891"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2402"></span><span>        </span><span class="annot"><a href="GHC.Hs.Pat.html#CoPat"><span class="hs-identifier hs-type">CoPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;definitelyLazyPattern: CoPat&quot;</span></span><span>
</span><span id="line-2403"></span><span>
</span><span id="line-2404"></span><span class="hs-comment">{-
Note [ApplicativeDo and refutable patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Refutable patterns in do blocks are desugared to use the monadic 'fail' operation.
This means that sometimes an applicative block needs to be wrapped in 'join' simply because
of a refutable pattern, in order for the types to work out.

-}</span><span>
</span><span id="line-2412"></span><span>
</span><span id="line-2413"></span><span class="annot"><a href="GHC.Rename.Expr.html#hasRefutablePattern"><span class="hs-identifier hs-type">hasRefutablePattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ is -XStrict enabled?</span></span><span>
</span><span id="line-2414"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2415"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-2416"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatches"><span class="hs-identifier hs-type">CompleteMatches</span></a></span><span>
</span><span id="line-2417"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArg"><span class="hs-identifier hs-type">ApplicativeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2418"></span><span id="hasRefutablePattern"><span class="annot"><span class="annottext">hasRefutablePattern :: Bool
-&gt; HscEnv
-&gt; GlobalRdrEnv
-&gt; CompleteMatches
-&gt; ApplicativeArg GhcRn
-&gt; Bool
</span><a href="GHC.Rename.Expr.html#hasRefutablePattern"><span class="hs-identifier hs-var hs-var">hasRefutablePattern</span></a></span></span><span> </span><span id="local-6989586621683068893"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068893"><span class="hs-identifier hs-var">is_strict</span></a></span></span><span> </span><span id="local-6989586621683068894"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683068894"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683068895"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683068895"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621683068896"><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621683068896"><span class="hs-identifier hs-var">comps</span></a></span></span><span> </span><span id="local-6989586621683068897"><span class="annot"><span class="annottext">ApplicativeArg GhcRn
</span><a href="#local-6989586621683068897"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2419"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApplicativeArg GhcRn
</span><a href="#local-6989586621683068897"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2420"></span><span>    </span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">app_arg_pattern :: forall idL. ApplicativeArg idL -&gt; LPat idL
</span><a href="GHC.Hs.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683068898"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068898"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_body_stmt :: forall idL. ApplicativeArg idL -&gt; Bool
</span><a href="GHC.Hs.Expr.html#is_body_stmt"><span class="hs-identifier hs-var">is_body_stmt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span>
</span><span id="line-2421"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; (ConLikeP GhcRn -&gt; Bool) -&gt; LPat GhcRn -&gt; Bool
forall (p :: Pass).
IsPass p =&gt;
Bool -&gt; (ConLikeP (GhcPass p) -&gt; Bool) -&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Hs.Pat.html#isIrrefutableHsPat"><span class="hs-identifier hs-var">isIrrefutableHsPat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068893"><span class="hs-identifier hs-var">is_strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
HscEnv -&gt; GlobalRdrEnv -&gt; CompleteMatches -&gt; Name -&gt; Bool
HscEnv -&gt; GlobalRdrEnv -&gt; CompleteMatches -&gt; Name -&gt; Bool
</span><a href="GHC.Rename.Env.html#irrefutableConLikeRn"><span class="hs-identifier hs-var">irrefutableConLikeRn</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683068894"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683068895"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621683068896"><span class="hs-identifier hs-var">comps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683068898"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2422"></span><span>    </span><span class="annot"><span class="annottext">ApplicativeArg GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2423"></span><span>
</span><span id="line-2424"></span><span id="local-6989586621683066484"><span id="local-6989586621683066485"><span class="annot"><a href="GHC.Rename.Expr.html#isLetStmt"><span class="hs-identifier hs-type">isLetStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066484"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683066485"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-2425"></span><span id="isLetStmt"><span class="annot"><span class="annottext">isLetStmt :: forall (a :: Pass) b. LStmt (GhcPass a) b -&gt; Bool
</span><a href="GHC.Rename.Expr.html#isLetStmt"><span class="hs-identifier hs-var hs-var">isLetStmt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">Anno (StmtLR (GhcPass a) (GhcPass a) b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2426"></span><span class="annot"><a href="GHC.Rename.Expr.html#isLetStmt"><span class="hs-identifier hs-var">isLetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt (GhcPass a) b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2427"></span><span>
</span><span id="line-2428"></span><span class="hs-comment">-- | Find a &quot;good&quot; place to insert a bind in an indivisible segment.</span><span>
</span><span id="line-2429"></span><span class="hs-comment">-- This is the only place where we use heuristics.  The current</span><span>
</span><span id="line-2430"></span><span class="hs-comment">-- heuristic is to peel off the first group of independent statements</span><span>
</span><span id="line-2431"></span><span class="hs-comment">-- and put the bind after those.</span><span>
</span><span id="line-2432"></span><span class="annot"><a href="GHC.Rename.Expr.html#splitSegment"><span class="hs-identifier hs-type">splitSegment</span></a></span><span>
</span><span id="line-2433"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2434"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2435"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2436"></span><span id="splitSegment"><span class="annot"><span class="annottext">splitSegment :: [(ExprLStmt GhcRn, FreeVars)]
-&gt; ([(ExprLStmt GhcRn, FreeVars)], [(ExprLStmt GhcRn, FreeVars)])
</span><a href="GHC.Rename.Expr.html#splitSegment"><span class="hs-identifier hs-var hs-var">splitSegment</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683068901"><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
</span><a href="#local-6989586621683068901"><span class="hs-identifier hs-var">one</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068902"><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
</span><a href="#local-6989586621683068902"><span class="hs-identifier hs-var">two</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
</span><a href="#local-6989586621683068901"><span class="hs-identifier hs-var">one</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
</span><a href="#local-6989586621683068902"><span class="hs-identifier hs-var">two</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2437"></span><span>  </span><span class="hs-comment">-- there is no choice when there are only two statements; this just saves</span><span>
</span><span id="line-2438"></span><span>  </span><span class="hs-comment">-- some work in a common case.</span><span>
</span><span id="line-2439"></span><span class="annot"><a href="GHC.Rename.Expr.html#splitSegment"><span class="hs-identifier hs-var">splitSegment</span></a></span><span> </span><span id="local-6989586621683068903"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068903"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-2440"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068904"><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
</span><a href="#local-6989586621683068904"><span class="hs-identifier hs-var">lets</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068905"><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
</span><a href="#local-6989586621683068905"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683068906"><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
</span><a href="#local-6989586621683068906"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
-&gt; Maybe
     ([(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)],
      [(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)],
      [(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)])
forall (body :: * -&gt; *).
[(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)]
-&gt; Maybe
     ([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)],
      [(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)],
      [(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)])
</span><a href="GHC.Rename.Expr.html#slurpIndependentStmts"><span class="hs-identifier hs-var">slurpIndependentStmts</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
</span><a href="#local-6989586621683068903"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2441"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068904"><span class="hs-identifier hs-var">lets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2442"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
</span><a href="#local-6989586621683068904"><span class="hs-identifier hs-var">lets</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068905"><span class="hs-identifier hs-var">binds</span></a></span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068906"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2443"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068904"><span class="hs-identifier hs-var">lets</span></a></span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
-&gt; [(GenLocated
       SrcSpanAnnA
       (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
     FreeVars)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
[(GenLocated
    SrcSpanAnnA
    (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068905"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
[(LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)), FreeVars)]
</span><a href="#local-6989586621683068906"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2444"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2445"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068903"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2446"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683068908"><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
</span><a href="#local-6989586621683068908"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683068909"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068909"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">(ExprLStmt GhcRn, FreeVars)
</span><a href="#local-6989586621683068908"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068909"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2447"></span><span>      </span><span id="local-6989586621683068910"><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068910"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ExprLStmt GhcRn, FreeVars)]
</span><a href="#local-6989586621683068903"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2448"></span><span>
</span><span id="line-2449"></span><span id="local-6989586621683066504"><span class="annot"><a href="GHC.Rename.Expr.html#slurpIndependentStmts"><span class="hs-identifier hs-type">slurpIndependentStmts</span></a></span><span>
</span><span id="line-2450"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066504"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2451"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066504"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- LetStmts</span><span>
</span><span id="line-2452"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066504"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- BindStmts</span><span>
</span><span id="line-2453"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066504"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span></span><span>
</span><span id="line-2454"></span><span id="slurpIndependentStmts"><span class="annot"><span class="annottext">slurpIndependentStmts :: forall (body :: * -&gt; *).
[(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)]
-&gt; Maybe
     ([(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)],
      [(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)],
      [(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)])
</span><a href="GHC.Rename.Expr.html#slurpIndependentStmts"><span class="hs-identifier hs-var hs-var">slurpIndependentStmts</span></a></span></span><span> </span><span id="local-6989586621683068915"><span class="annot"><span class="annottext">[(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)]
</span><a href="#local-6989586621683068915"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
  FreeVars)]
-&gt; [(GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
     FreeVars)]
-&gt; FreeVars
-&gt; [(GenLocated
       SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
     FreeVars)]
-&gt; Maybe
     ([(GenLocated
          SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
        FreeVars)],
      [(GenLocated
          SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
        FreeVars)],
      [(GenLocated
          SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
        FreeVars)])
forall {p :: Pass} {idR} {body} {idR} {body} {l}.
(XBindStmt (GhcPass p) idR body ~ XBindStmt (GhcPass p) idR body,
 IdGhcP p ~ Name,
 XLetStmt (GhcPass p) idR body ~ XLetStmt (GhcPass p) idR body,
 IsPass p) =&gt;
[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; FreeVars
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; Maybe
     ([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
</span><a href="#local-6989586621683068916"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">[(LStmt GhcRn (LocatedA (body GhcRn)), FreeVars)]
[(GenLocated
    SrcSpanAnnA (StmtLR GhcRn GhcRn (LocatedA (body GhcRn))),
  FreeVars)]
</span><a href="#local-6989586621683068915"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2455"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2456"></span><span>  </span><span class="hs-comment">-- If we encounter a BindStmt that doesn't depend on a previous BindStmt</span><span>
</span><span id="line-2457"></span><span>  </span><span class="hs-comment">-- in this group, then add it to the group. We have to be careful about</span><span>
</span><span id="line-2458"></span><span>  </span><span class="hs-comment">-- strict patterns though; splitSegments expects that if we return Just</span><span>
</span><span id="line-2459"></span><span>  </span><span class="hs-comment">-- then we have actually done some splitting. Otherwise it will go into</span><span>
</span><span id="line-2460"></span><span>  </span><span class="hs-comment">-- an infinite loop (#14163).</span><span>
</span><span id="line-2461"></span><span>  </span><span id="local-6989586621683068916"><span class="annot"><span class="annottext">go :: [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; FreeVars
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; Maybe
     ([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
</span><a href="#local-6989586621683068916"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683068934"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068934"><span class="hs-identifier hs-var">lets</span></a></span></span><span> </span><span id="local-6989586621683068935"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068935"><span class="hs-identifier hs-var">indep</span></a></span></span><span> </span><span id="local-6989586621683068936"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068936"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068937"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683068937"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span id="local-6989586621683068938"><span class="annot"><span class="annottext">XBindStmt (GhcPass p) idR body
</span><a href="#local-6989586621683068938"><span class="hs-identifier hs-var">xbs</span></a></span></span><span> </span><span id="local-6989586621683068939"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068939"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683068940"><span class="annot"><span class="annottext">body
</span><a href="#local-6989586621683068940"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068941"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068941"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068942"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068942"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2462"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#disjointNameSet"><span class="hs-identifier hs-var">disjointNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068936"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068941"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; Bool
forall (p :: Pass). IsPass p =&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Rename.Expr.html#definitelyLazyPattern"><span class="hs-identifier hs-var">definitelyLazyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068939"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-2463"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; FreeVars
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; Maybe
     ([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
</span><a href="#local-6989586621683068916"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068934"><span class="hs-identifier hs-var">lets</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">l
-&gt; StmtLR (GhcPass p) idR body
-&gt; GenLocated l (StmtLR (GhcPass p) idR body)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683068937"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XBindStmt (GhcPass p) idR body
-&gt; LPat (GhcPass p) -&gt; body -&gt; StmtLR (GhcPass p) idR body
forall idL idR body.
XBindStmt idL idR body -&gt; LPat idL -&gt; body -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-var">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt (GhcPass p) idR body
XBindStmt (GhcPass p) idR body
</span><a href="#local-6989586621683068938"><span class="hs-identifier hs-var">xbs</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068939"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">body
</span><a href="#local-6989586621683068940"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068941"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068935"><span class="hs-identifier hs-var">indep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2464"></span><span>         </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068943"><span class="hs-identifier hs-var">bndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068942"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2465"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683068943"><span class="annot"><span class="annottext">bndrs' :: FreeVars
</span><a href="#local-6989586621683068943"><span class="hs-identifier hs-var hs-var">bndrs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068936"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-var">`unionNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass p) -&gt; LPat (GhcPass p) -&gt; [IdP (GhcPass p)]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass p)
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683068939"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2466"></span><span>  </span><span class="hs-comment">-- If we encounter a LetStmt that doesn't depend on a BindStmt in this</span><span>
</span><span id="line-2467"></span><span>  </span><span class="hs-comment">-- group, then move it to the beginning, so that it doesn't interfere with</span><span>
</span><span id="line-2468"></span><span>  </span><span class="hs-comment">-- grouping more BindStmts.</span><span>
</span><span id="line-2469"></span><span>  </span><span class="hs-comment">-- TODO: perhaps we shouldn't do this if there are any strict bindings,</span><span>
</span><span id="line-2470"></span><span>  </span><span class="hs-comment">-- because we might be moving evaluation earlier.</span><span>
</span><span id="line-2471"></span><span>  </span><span class="annot"><a href="#local-6989586621683068916"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683068944"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068944"><span class="hs-identifier hs-var">lets</span></a></span></span><span> </span><span id="local-6989586621683068945"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068945"><span class="hs-identifier hs-var">indep</span></a></span></span><span> </span><span id="local-6989586621683068946"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068946"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068947"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683068947"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span id="local-6989586621683068948"><span class="annot"><span class="annottext">XLetStmt (GhcPass p) idR body
</span><a href="#local-6989586621683068948"><span class="hs-identifier hs-var">noExtField</span></a></span></span><span> </span><span id="local-6989586621683068949"><span class="annot"><span class="annottext">HsLocalBindsLR (GhcPass p) idR
</span><a href="#local-6989586621683068949"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068950"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068950"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683068951"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068951"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2472"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#disjointNameSet"><span class="hs-identifier hs-var">disjointNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068946"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068950"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-2473"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; FreeVars
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; Maybe
     ([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
</span><a href="#local-6989586621683068916"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">l
-&gt; StmtLR (GhcPass p) idR body
-&gt; GenLocated l (StmtLR (GhcPass p) idR body)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683068947"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLetStmt (GhcPass p) idR body
-&gt; HsLocalBindsLR (GhcPass p) idR -&gt; StmtLR (GhcPass p) idR body
forall idL idR body.
XLetStmt idL idR body
-&gt; HsLocalBindsLR idL idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-var">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt (GhcPass p) idR body
XLetStmt (GhcPass p) idR body
</span><a href="#local-6989586621683068948"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBindsLR (GhcPass p) idR
</span><a href="#local-6989586621683068949"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068950"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068944"><span class="hs-identifier hs-var">lets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068945"><span class="hs-identifier hs-var">indep</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683068946"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068951"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2474"></span><span>  </span><span class="annot"><a href="#local-6989586621683068916"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  ([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
   [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
   [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2475"></span><span>  </span><span class="annot"><a href="#local-6989586621683068916"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  ([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
   [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
   [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2476"></span><span>  </span><span class="annot"><a href="#local-6989586621683068916"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683068952"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068952"><span class="hs-identifier hs-var">lets</span></a></span></span><span> </span><span id="local-6989586621683068953"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068953"><span class="hs-identifier hs-var">indep</span></a></span></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068954"><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068954"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
 [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
 [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
-&gt; Maybe
     ([(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)],
      [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068952"><span class="hs-identifier hs-var">lets</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
-&gt; [(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068953"><span class="hs-identifier hs-var">indep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(GenLocated l (StmtLR (GhcPass p) idR body), FreeVars)]
</span><a href="#local-6989586621683068954"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2477"></span><span>
</span><span id="line-2478"></span><span class="hs-comment">-- | Build an ApplicativeStmt, and strip the &quot;return&quot; from the tail</span><span>
</span><span id="line-2479"></span><span class="hs-comment">-- if necessary.</span><span>
</span><span id="line-2480"></span><span class="hs-comment">--</span><span>
</span><span id="line-2481"></span><span class="hs-comment">-- For example, if we start with</span><span>
</span><span id="line-2482"></span><span class="hs-comment">--   do x &lt;- E1; y &lt;- E2; return (f x y)</span><span>
</span><span id="line-2483"></span><span class="hs-comment">-- then we get</span><span>
</span><span id="line-2484"></span><span class="hs-comment">--   do (E1[x] | E2[y]); f x y</span><span>
</span><span id="line-2485"></span><span class="hs-comment">--</span><span>
</span><span id="line-2486"></span><span class="hs-comment">-- the LastStmt in this case has the return removed, but we set the</span><span>
</span><span id="line-2487"></span><span class="hs-comment">-- flag on the LastStmt to indicate this, so that we can print out the</span><span>
</span><span id="line-2488"></span><span class="hs-comment">-- original statement correctly in error messages.  It is easier to do</span><span>
</span><span id="line-2489"></span><span class="hs-comment">-- it this way rather than try to ignore the return later in both the</span><span>
</span><span id="line-2490"></span><span class="hs-comment">-- typechecker and the desugarer (I tried it that way first!).</span><span>
</span><span id="line-2491"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkApplicativeStmt"><span class="hs-identifier hs-type">mkApplicativeStmt</span></a></span><span>
</span><span id="line-2492"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span>
</span><span id="line-2493"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeArg"><span class="hs-identifier hs-type">ApplicativeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>             </span><span class="annot"><span class="hs-comment">-- ^ The args</span></span><span>
</span><span id="line-2494"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                               </span><span class="annot"><span class="hs-comment">-- ^ True &lt;=&gt; need a join</span></span><span>
</span><span id="line-2495"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The body statements</span></span><span>
</span><span id="line-2496"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2497"></span><span id="mkApplicativeStmt"><span class="annot"><span class="annottext">mkApplicativeStmt :: HsDoFlavour
-&gt; [ApplicativeArg GhcRn]
-&gt; Bool
-&gt; [ExprLStmt GhcRn]
-&gt; RnM ([ExprLStmt GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#mkApplicativeStmt"><span class="hs-identifier hs-var hs-var">mkApplicativeStmt</span></a></span></span><span> </span><span id="local-6989586621683068955"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068955"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683068956"><span class="annot"><span class="annottext">[ApplicativeArg GhcRn]
</span><a href="#local-6989586621683068956"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621683068957"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683068957"><span class="hs-identifier hs-var">need_join</span></a></span></span><span> </span><span id="local-6989586621683068958"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068958"><span class="hs-identifier hs-var">body_stmts</span></a></span></span><span>
</span><span id="line-2498"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068959"><span class="annot"><a href="#local-6989586621683068959"><span class="hs-identifier hs-var">fmap_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068960"><span class="annot"><a href="#local-6989586621683068960"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-var">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683068955"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fmapName"><span class="hs-identifier hs-var">fmapName</span></a></span><span>
</span><span id="line-2499"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068961"><span class="annot"><a href="#local-6989586621683068961"><span class="hs-identifier hs-var">ap_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068962"><span class="annot"><a href="#local-6989586621683068962"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-type">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068955"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#apAName"><span class="hs-identifier hs-type">apAName</span></a></span><span>
</span><span id="line-2500"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068964"><span class="annot"><a href="#local-6989586621683068964"><span class="hs-identifier hs-var">mb_join</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068965"><span class="annot"><a href="#local-6989586621683068965"><span class="hs-identifier hs-var">fvs3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2501"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683068957"><span class="hs-identifier hs-type">need_join</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2502"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068966"><span class="annot"><a href="#local-6989586621683068966"><span class="hs-identifier hs-var">join_op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068967"><span class="annot"><a href="#local-6989586621683068967"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#lookupQualifiedDoStmtName"><span class="hs-identifier hs-type">lookupQualifiedDoStmtName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068955"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#joinMName"><span class="hs-identifier hs-type">joinMName</span></a></span><span>
</span><span id="line-2503"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683068966"><span class="hs-identifier hs-type">join_op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068967"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2504"></span><span>           </span><span class="hs-keyword">else</span><span>
</span><span id="line-2505"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2506"></span><span>       </span><span class="hs-comment">-- We cannot really say where the ApplicativeStmt is located with more accuracy</span><span>
</span><span id="line-2507"></span><span>       </span><span class="hs-comment">-- than the span of the do-block, but it is better than nothing for IDE info</span><span>
</span><span id="line-2508"></span><span>       </span><span class="hs-comment">-- See Note [Source locations for implicit function calls]</span><span>
</span><span id="line-2509"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683068969"><span class="annot"><a href="#local-6989586621683068969"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span>
</span><span id="line-2510"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683068970"><span class="annot"><a href="#local-6989586621683068970"><span class="hs-identifier hs-var hs-var">applicative_stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683068969"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))))
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XXStmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall idL idR body. XXStmtLR idL idR body -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#XStmtLR"><span class="hs-identifier hs-var">XStmtLR</span></a></span><span> </span><span class="annot"><span class="annottext">(XXStmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
 -&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; XXStmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XApplicativeStmt GhcRn GhcRn
-&gt; [(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
-&gt; Maybe (SyntaxExpr GhcRn)
-&gt; ApplicativeStmt GhcRn GhcRn
forall idL idR.
XApplicativeStmt idL idR
-&gt; [(SyntaxExpr idR, ApplicativeArg idL)]
-&gt; Maybe (SyntaxExpr idR)
-&gt; ApplicativeStmt idL idR
</span><a href="GHC.Hs.Expr.html#ApplicativeStmt"><span class="hs-identifier hs-var">ApplicativeStmt</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XApplicativeStmt GhcRn GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-2511"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SyntaxExprRn]
-&gt; [ApplicativeArg GhcRn] -&gt; [(SyntaxExprRn, ApplicativeArg GhcRn)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621683068959"><span class="hs-identifier hs-var">fmap_op</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn -&gt; [SyntaxExprRn] -&gt; [SyntaxExprRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn -&gt; [SyntaxExprRn]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621683068961"><span class="hs-identifier hs-var">ap_op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ApplicativeArg GhcRn]
</span><a href="#local-6989586621683068956"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2512"></span><span>               </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
Maybe SyntaxExprRn
</span><a href="#local-6989586621683068964"><span class="hs-identifier hs-var">mb_join</span></a></span><span>
</span><span id="line-2513"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683068970"><span class="hs-identifier hs-type">applicative_stmt</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683068958"><span class="hs-identifier hs-type">body_stmts</span></a></span><span>
</span><span id="line-2514"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683068960"><span class="hs-identifier hs-type">fvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068962"><span class="hs-identifier hs-type">fvs2</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683068965"><span class="hs-identifier hs-type">fvs3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2515"></span><span>
</span><span id="line-2516"></span><span class="hs-comment">-- | Given the statements following an ApplicativeStmt, determine whether</span><span>
</span><span id="line-2517"></span><span class="hs-comment">-- we need a @join@ or not, and remove the @return@ if necessary.</span><span>
</span><span id="line-2518"></span><span class="hs-comment">--</span><span>
</span><span id="line-2519"></span><span class="hs-comment">-- We don't need @join@ if there's a single @LastStmt@ in the form of</span><span>
</span><span id="line-2520"></span><span class="hs-comment">-- @return E@, @return $ E@, @pure E@ or @pure $ E@.</span><span>
</span><span id="line-2521"></span><span class="annot"><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-type">needJoin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-type">MonadNames</span></a></span><span>
</span><span id="line-2522"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2523"></span><span>            </span><span class="hs-comment">-- If this is @Just pure@, replace return by pure</span><span>
</span><span id="line-2524"></span><span>            </span><span class="hs-comment">-- If this is @Nothing@, strip the return/pure</span><span>
</span><span id="line-2525"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2526"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprLStmt"><span class="hs-identifier hs-type">ExprLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2527"></span><span id="needJoin"><span class="annot"><span class="annottext">needJoin :: MonadNames
-&gt; [ExprLStmt GhcRn]
-&gt; Maybe (HsExpr GhcRn)
-&gt; (Bool, [ExprLStmt GhcRn])
</span><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-var hs-var">needJoin</span></a></span></span><span> </span><span id="local-6989586621683068971"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068971"><span class="hs-identifier hs-var">_monad_names</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683068972"><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068972"><span class="hs-identifier hs-var">_mb_pure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- we're in an ApplicativeArg</span><span>
</span><span id="line-2528"></span><span class="annot"><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-var">needJoin</span></a></span><span> </span><span id="local-6989586621683068973"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068973"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068974"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068974"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068975"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068975"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068976"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621683068976"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683068977"><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068977"><span class="hs-identifier hs-var">mb_pure</span></a></span></span><span>
</span><span id="line-2529"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683068978"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068978"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683068979"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621683068979"><span class="hs-identifier hs-var">noret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MonadNames
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; Maybe (HsExpr GhcRn)
-&gt; Maybe (XRec GhcRn (HsExpr GhcRn), Maybe Bool)
</span><a href="GHC.Rename.Expr.html#isReturnApp"><span class="hs-identifier hs-var">isReturnApp</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068973"><span class="hs-identifier hs-var">monad_names</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068975"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068977"><span class="hs-identifier hs-var">mb_pure</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2530"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068974"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLastStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; Maybe Bool
-&gt; SyntaxExpr GhcRn
-&gt; StmtLR GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall idL idR body.
XLastStmt idL idR body
-&gt; body -&gt; Maybe Bool -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-var">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068978"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621683068979"><span class="hs-identifier hs-var">noret</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621683068976"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2531"></span><span class="annot"><a href="GHC.Rename.Expr.html#needJoin"><span class="hs-identifier hs-var">needJoin</span></a></span><span> </span><span id="local-6989586621683068981"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068981"><span class="hs-identifier hs-var">_monad_names</span></a></span></span><span> </span><span id="local-6989586621683068982"><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068982"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621683068983"><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068983"><span class="hs-identifier hs-var">_mb_pure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExprLStmt GhcRn]
</span><a href="#local-6989586621683068982"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2532"></span><span>
</span><span id="line-2533"></span><span class="hs-comment">-- | @(Just e, Just False)@, if the expression is @return/pure e@,</span><span>
</span><span id="line-2534"></span><span class="hs-comment">--     and the third argument is Nothing,</span><span>
</span><span id="line-2535"></span><span class="hs-comment">--   @(Just e, Just True)@ if the expression is @return/pure $ e@,</span><span>
</span><span id="line-2536"></span><span class="hs-comment">--     and the third argument is Nothing,</span><span>
</span><span id="line-2537"></span><span class="hs-comment">--   @(Just (pure e), Nothing)@ if the expression is @return/pure e@,</span><span>
</span><span id="line-2538"></span><span class="hs-comment">--     and the third argument is @Just pure_expr@,</span><span>
</span><span id="line-2539"></span><span class="hs-comment">--   @(Just (pure $ e), Nothing)@ if the expression is @return/pure $ e@,</span><span>
</span><span id="line-2540"></span><span class="hs-comment">--     and the third argument is @Just pure_expr@,</span><span>
</span><span id="line-2541"></span><span class="hs-comment">--   otherwise @Nothing@.</span><span>
</span><span id="line-2542"></span><span class="annot"><a href="GHC.Rename.Expr.html#isReturnApp"><span class="hs-identifier hs-type">isReturnApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#MonadNames"><span class="hs-identifier hs-type">MonadNames</span></a></span><span>
</span><span id="line-2543"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2544"></span><span>            </span><span class="hs-comment">-- If this is @Just pure@, replace return by pure</span><span>
</span><span id="line-2545"></span><span>            </span><span class="hs-comment">-- If this is @Nothing@, strip the return/pure</span><span>
</span><span id="line-2546"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2547"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-2548"></span><span id="isReturnApp"><span class="annot"><span class="annottext">isReturnApp :: MonadNames
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; Maybe (HsExpr GhcRn)
-&gt; Maybe (XRec GhcRn (HsExpr GhcRn), Maybe Bool)
</span><a href="GHC.Rename.Expr.html#isReturnApp"><span class="hs-identifier hs-var hs-var">isReturnApp</span></a></span></span><span> </span><span id="local-6989586621683068984"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068984"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683068985"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068985"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068986"><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068986"><span class="hs-identifier hs-var">mb_pure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2549"></span><span>  </span><span class="annot"><span class="annottext">MonadNames
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; Maybe (HsExpr GhcRn)
-&gt; Maybe (XRec GhcRn (HsExpr GhcRn), Maybe Bool)
</span><a href="GHC.Rename.Expr.html#isReturnApp"><span class="hs-identifier hs-var">isReturnApp</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068984"><span class="hs-identifier hs-var">monad_names</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068985"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068986"><span class="hs-identifier hs-var">mb_pure</span></a></span><span>
</span><span id="line-2550"></span><span class="annot"><a href="GHC.Rename.Expr.html#isReturnApp"><span class="hs-identifier hs-var">isReturnApp</span></a></span><span> </span><span id="local-6989586621683068987"><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068987"><span class="hs-identifier hs-var">monad_names</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683068988"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068988"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683068989"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683068989"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683068990"><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068990"><span class="hs-identifier hs-var">mb_pure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683068989"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2551"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OpApp"><span class="hs-identifier hs-type">OpApp</span></a></span><span> </span><span id="local-6989586621683068991"><span class="annot"><span class="annottext">XOpApp GhcRn
</span><a href="#local-6989586621683068991"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683068992"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068992"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683068993"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068993"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621683068994"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068994"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-2552"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683068995"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683068995"><span class="hs-identifier hs-var">pure_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068990"><span class="hs-identifier hs-var">mb_pure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068996"><span class="hs-identifier hs-var">is_return</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068992"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068997"><span class="hs-identifier hs-var">is_dollar</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068993"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2553"></span><span>        </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
-&gt; Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068988"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XOpApp GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p.
XOpApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#OpApp"><span class="hs-identifier hs-var">OpApp</span></a></span><span> </span><span class="annot"><span class="annottext">XOpApp GhcRn
</span><a href="#local-6989586621683068991"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall {l} {e} {e}. GenLocated l e -&gt; e -&gt; GenLocated l e
</span><a href="#local-6989586621683068998"><span class="hs-identifier hs-var">to_pure</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068992"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683068995"><span class="hs-identifier hs-var">pure_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068993"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683068994"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-2554"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068996"><span class="hs-identifier hs-var">is_return</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068992"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068997"><span class="hs-identifier hs-var">is_dollar</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068993"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
-&gt; Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683068994"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-2555"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span id="local-6989586621683068999"><span class="annot"><span class="annottext">XApp GhcRn
</span><a href="#local-6989586621683068999"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683069000"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069000"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683069001"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069001"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-2556"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683069002"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069002"><span class="hs-identifier hs-var">pure_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
</span><a href="#local-6989586621683068990"><span class="hs-identifier hs-var">mb_pure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068996"><span class="hs-identifier hs-var">is_return</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069000"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2557"></span><span>        </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
-&gt; Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683068988"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XApp GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcRn
</span><a href="#local-6989586621683068999"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall {l} {e} {e}. GenLocated l e -&gt; e -&gt; GenLocated l e
</span><a href="#local-6989586621683068998"><span class="hs-identifier hs-var">to_pure</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069000"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069002"><span class="hs-identifier hs-var">pure_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069001"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-2558"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068996"><span class="hs-identifier hs-var">is_return</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069000"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
-&gt; Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069001"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-2559"></span><span>  </span><span id="local-6989586621683069003"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069003"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (XRec GhcRn (HsExpr GhcRn), Maybe Bool)
Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn), Maybe Bool)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2560"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2561"></span><span>  </span><span id="local-6989586621683069008"><span class="annot"><span class="annottext">is_var :: (IdP p -&gt; Bool) -&gt; GenLocated l (HsExpr p) -&gt; Bool
</span><a href="#local-6989586621683069008"><span class="hs-identifier hs-var hs-var">is_var</span></a></span></span><span> </span><span id="local-6989586621683069009"><span class="annot"><span class="annottext">IdP p -&gt; Bool
</span><a href="#local-6989586621683069009"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683069010"><span class="annot"><span class="annottext">XRec p (HsExpr p)
</span><a href="#local-6989586621683069010"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IdP p -&gt; Bool) -&gt; GenLocated l (HsExpr p) -&gt; Bool
</span><a href="#local-6989586621683069008"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span class="annot"><span class="annottext">IdP p -&gt; Bool
</span><a href="#local-6989586621683069009"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">XRec p (HsExpr p)
GenLocated l (HsExpr p)
</span><a href="#local-6989586621683069010"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2562"></span><span>  </span><span class="annot"><a href="#local-6989586621683069008"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span id="local-6989586621683069011"><span class="annot"><span class="annottext">IdP p -&gt; Bool
</span><a href="#local-6989586621683069011"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683069012"><span class="annot"><span class="annottext">XRec p (HsExpr p)
</span><a href="#local-6989586621683069012"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc p)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IdP p -&gt; Bool) -&gt; GenLocated l (HsExpr p) -&gt; Bool
</span><a href="#local-6989586621683069008"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span class="annot"><span class="annottext">IdP p -&gt; Bool
</span><a href="#local-6989586621683069011"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">XRec p (HsExpr p)
GenLocated l (HsExpr p)
</span><a href="#local-6989586621683069012"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2563"></span><span>  </span><span class="annot"><a href="#local-6989586621683069008"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span id="local-6989586621683069013"><span class="annot"><span class="annottext">IdP p -&gt; Bool
</span><a href="#local-6989586621683069013"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683069014"><span class="annot"><span class="annottext">IdP p
</span><a href="#local-6989586621683069014"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdP p -&gt; Bool
</span><a href="#local-6989586621683069013"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">IdP p
</span><a href="#local-6989586621683069014"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2564"></span><span>       </span><span class="hs-comment">-- TODO: I don't know how to get this right for rebindable syntax</span><span>
</span><span id="line-2565"></span><span>  </span><span class="annot"><a href="#local-6989586621683069008"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span class="annot"><span class="annottext">IdP p -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsExpr p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2566"></span><span>
</span><span id="line-2567"></span><span>  </span><span id="local-6989586621683068996"><span class="annot"><span class="annottext">is_return :: GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068996"><span class="hs-identifier hs-var hs-var">is_return</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IdP GhcRn -&gt; Bool)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
forall {p} {l} {l}.
(XRec p (HsExpr p) ~ GenLocated l (HsExpr p),
 XRec p (IdP p) ~ GenLocated l (IdP p)) =&gt;
(IdP p -&gt; Bool) -&gt; GenLocated l (HsExpr p) -&gt; Bool
</span><a href="#local-6989586621683069008"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683069015"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621683069015"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683069015"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MonadNames -&gt; Name
</span><a href="GHC.Rename.Expr.html#return_name"><span class="hs-identifier hs-var">return_name</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068987"><span class="hs-identifier hs-var">monad_names</span></a></span><span>
</span><span id="line-2568"></span><span>                         </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683069015"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MonadNames -&gt; Name
</span><a href="GHC.Rename.Expr.html#pure_name"><span class="hs-identifier hs-var">pure_name</span></a></span><span> </span><span class="annot"><span class="annottext">MonadNames
</span><a href="#local-6989586621683068987"><span class="hs-identifier hs-var">monad_names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2569"></span><span>  </span><span id="local-6989586621683068998"><span class="annot"><span class="annottext">to_pure :: GenLocated l e -&gt; e -&gt; GenLocated l e
</span><a href="#local-6989586621683068998"><span class="hs-identifier hs-var hs-var">to_pure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683069016"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683069016"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683069017"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621683069017"><span class="hs-identifier hs-var">pure_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">l -&gt; e -&gt; GenLocated l e
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683069016"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621683069017"><span class="hs-identifier hs-var">pure_expr</span></a></span><span>
</span><span id="line-2570"></span><span>  </span><span id="local-6989586621683068997"><span class="annot"><span class="annottext">is_dollar :: GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
</span><a href="#local-6989586621683068997"><span class="hs-identifier hs-var hs-var">is_dollar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IdP GhcRn -&gt; Bool)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; Bool
forall {p} {l} {l}.
(XRec p (HsExpr p) ~ GenLocated l (HsExpr p),
 XRec p (IdP p) ~ GenLocated l (IdP p)) =&gt;
(IdP p -&gt; Bool) -&gt; GenLocated l (HsExpr p) -&gt; Bool
</span><a href="#local-6989586621683069008"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP GhcRn -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#dollarIdKey"><span class="hs-identifier hs-var">dollarIdKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2571"></span><span>
</span><span id="line-2572"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{Errors}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2579"></span><span>
</span><span id="line-2580"></span><span class="annot"><a href="GHC.Rename.Expr.html#checkEmptyStmts"><span class="hs-identifier hs-type">checkEmptyStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2581"></span><span class="hs-comment">-- We've seen an empty sequence of Stmts... is that ok?</span><span>
</span><span id="line-2582"></span><span id="checkEmptyStmts"><span class="annot"><span class="annottext">checkEmptyStmts :: HsStmtContextRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkEmptyStmts"><span class="hs-identifier hs-var hs-var">checkEmptyStmts</span></a></span></span><span> </span><span id="local-6989586621683069025"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069025"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-2583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmptyStatementGroupErrReason -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; Maybe EmptyStatementGroupErrReason
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; (EmptyStatementGroupErrReason -&gt; TcRnMessage)
-&gt; EmptyStatementGroupErrReason
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnEmptyStmtsGroup"><span class="hs-identifier hs-var">TcRnEmptyStmtsGroup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe EmptyStatementGroupErrReason
</span><a href="#local-6989586621683069027"><span class="hs-identifier hs-var">mb_err</span></a></span><span>
</span><span id="line-2584"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2585"></span><span>    </span><span id="local-6989586621683069027"><span class="annot"><span class="annottext">mb_err :: Maybe EmptyStatementGroupErrReason
</span><a href="#local-6989586621683069027"><span class="hs-identifier hs-var hs-var">mb_err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069025"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2586"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#PatGuard"><span class="hs-identifier hs-type">PatGuard</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe EmptyStatementGroupErrReason
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- Pattern guards can be empty</span><span>
</span><span id="line-2587"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtCtxt"><span class="hs-identifier hs-type">ParStmtCtxt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason -&gt; Maybe EmptyStatementGroupErrReason
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason
</span><a href="GHC.Tc.Errors.Types.html#EmptyStmtsGroupInParallelComp"><span class="hs-identifier hs-var">EmptyStmtsGroupInParallelComp</span></a></span><span>
</span><span id="line-2588"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmtCtxt"><span class="hs-identifier hs-type">TransStmtCtxt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason -&gt; Maybe EmptyStatementGroupErrReason
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason
</span><a href="GHC.Tc.Errors.Types.html#EmptyStmtsGroupInTransformListComp"><span class="hs-identifier hs-var">EmptyStmtsGroupInTransformListComp</span></a></span><span>
</span><span id="line-2589"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span id="local-6989586621683069030"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683069030"><span class="hs-identifier hs-var">flav</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason -&gt; Maybe EmptyStatementGroupErrReason
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EmptyStatementGroupErrReason
 -&gt; Maybe EmptyStatementGroupErrReason)
-&gt; EmptyStatementGroupErrReason
-&gt; Maybe EmptyStatementGroupErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour -&gt; EmptyStatementGroupErrReason
</span><a href="GHC.Tc.Errors.Types.html#EmptyStmtsGroupInDoNotation"><span class="hs-identifier hs-var">EmptyStmtsGroupInDoNotation</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683069030"><span class="hs-identifier hs-var">flav</span></a></span><span>
</span><span id="line-2590"></span><span>      </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowExpr"><span class="hs-identifier hs-var">ArrowExpr</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason -&gt; Maybe EmptyStatementGroupErrReason
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">EmptyStatementGroupErrReason
</span><a href="GHC.Tc.Errors.Types.html#EmptyStmtsGroupInArrowNotation"><span class="hs-identifier hs-var">EmptyStmtsGroupInArrowNotation</span></a></span><span>
</span><span id="line-2591"></span><span>
</span><span id="line-2592"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-2593"></span><span id="local-6989586621683066267"><span class="annot"><a href="GHC.Rename.Expr.html#checkLastStmt"><span class="hs-identifier hs-type">checkLastStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066267"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-2594"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-2595"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066267"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2596"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066267"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-2597"></span><span id="checkLastStmt"><span class="annot"><span class="annottext">checkLastStmt :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; RnM (LStmt GhcPs (LocatedA (body GhcPs)))
</span><a href="GHC.Rename.Expr.html#checkLastStmt"><span class="hs-identifier hs-var hs-var">checkLastStmt</span></a></span></span><span> </span><span id="local-6989586621683069053"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069053"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683069054"><span class="annot"><span class="annottext">lstmt :: LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069054"><span class="hs-identifier hs-var">lstmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683069055"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683069055"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683069056"><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069056"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2598"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069053"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2599"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#ListComp"><span class="hs-identifier hs-var">ListComp</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM (LStmt GhcPs (LocatedA (body GhcPs)))
IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069057"><span class="hs-identifier hs-var">check_comp</span></a></span><span>
</span><span id="line-2600"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#MonadComp"><span class="hs-identifier hs-var">MonadComp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM (LStmt GhcPs (LocatedA (body GhcPs)))
IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069057"><span class="hs-identifier hs-var">check_comp</span></a></span><span>
</span><span id="line-2601"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-type">DoExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM (LStmt GhcPs (LocatedA (body GhcPs)))
IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069058"><span class="hs-identifier hs-var">check_do</span></a></span><span>
</span><span id="line-2602"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MDoExpr"><span class="hs-identifier hs-type">MDoExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM (LStmt GhcPs (LocatedA (body GhcPs)))
IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069058"><span class="hs-identifier hs-var">check_do</span></a></span><span>
</span><span id="line-2603"></span><span>      </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowExpr"><span class="hs-identifier hs-var">ArrowExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM (LStmt GhcPs (LocatedA (body GhcPs)))
IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069058"><span class="hs-identifier hs-var">check_do</span></a></span><span>
</span><span id="line-2604"></span><span>      </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM (LStmt GhcPs (LocatedA (body GhcPs)))
IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069059"><span class="hs-identifier hs-var">check_other</span></a></span><span>
</span><span id="line-2605"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2606"></span><span>    </span><span id="local-6989586621683069058"><span class="annot"><span class="annottext">check_do :: IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069058"><span class="hs-identifier hs-var hs-var">check_do</span></a></span></span><span>    </span><span class="hs-comment">-- Expect BodyStmt, and change it to LastStmt</span><span>
</span><span id="line-2607"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069056"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2608"></span><span>          </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683069060"><span class="annot"><span class="annottext">LocatedA (body GhcPs)
</span><a href="#local-6989586621683069060"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
-&gt; GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683069055"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (body GhcPs) -&gt; StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
forall (idR :: Pass) (bodyR :: * -&gt; *) (idL :: Pass).
IsPass idR =&gt;
LocatedA (bodyR (GhcPass idR))
-&gt; StmtLR
     (GhcPass idL) (GhcPass idR) (LocatedA (bodyR (GhcPass idR)))
</span><a href="GHC.Hs.Utils.html#mkLastStmt"><span class="hs-identifier hs-var">mkLastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (body GhcPs)
</span><a href="#local-6989586621683069060"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2609"></span><span>          </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
</span><a href="#local-6989586621683069054"><span class="hs-identifier hs-var">lstmt</span></a></span><span>   </span><span class="hs-comment">-- &quot;Deriving&quot; clauses may generate a</span><span>
</span><span id="line-2610"></span><span>                                             </span><span class="hs-comment">-- LastStmt directly (unlike the parser)</span><span>
</span><span id="line-2611"></span><span>          </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; UnexpectedStatement -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnLastStmtNotExpr"><span class="hs-identifier hs-var">TcRnLastStmtNotExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069053"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-2612"></span><span>                                          </span><span class="annot"><span class="annottext">(UnexpectedStatement -&gt; TcRnMessage)
-&gt; UnexpectedStatement -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs)) -&gt; UnexpectedStatement
forall body.
Outputable (StmtLR GhcPs GhcPs body) =&gt;
StmtLR GhcPs GhcPs body -&gt; UnexpectedStatement
</span><a href="GHC.Tc.Errors.Types.html#UnexpectedStatement"><span class="hs-identifier hs-var">UnexpectedStatement</span></a></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069056"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2613"></span><span>                                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
</span><a href="#local-6989586621683069054"><span class="hs-identifier hs-var">lstmt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2614"></span><span>
</span><span id="line-2615"></span><span>
</span><span id="line-2616"></span><span>    </span><span id="local-6989586621683069057"><span class="annot"><span class="annottext">check_comp :: IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069057"><span class="hs-identifier hs-var hs-var">check_comp</span></a></span></span><span>  </span><span class="hs-comment">-- Expect LastStmt; this should be enforced by the parser!</span><span>
</span><span id="line-2617"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069056"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2618"></span><span>          </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
</span><a href="#local-6989586621683069054"><span class="hs-identifier hs-var">lstmt</span></a></span><span>
</span><span id="line-2619"></span><span>          </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkLastStmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
</span><a href="#local-6989586621683069054"><span class="hs-identifier hs-var">lstmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2620"></span><span>
</span><span id="line-2621"></span><span>    </span><span id="local-6989586621683069059"><span class="annot"><span class="annottext">check_other :: IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated
     SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
</span><a href="#local-6989586621683069059"><span class="hs-identifier hs-var hs-var">check_other</span></a></span></span><span> </span><span class="hs-comment">-- Behave just as if this wasn't the last stmt</span><span>
</span><span id="line-2622"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkStmt"><span class="hs-identifier hs-var">checkStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069053"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069054"><span class="hs-identifier hs-var">lstmt</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LocatedA (body GhcPs))
GenLocated SrcSpanAnnA (StmtLR GhcPs GhcPs (LocatedA (body GhcPs)))
</span><a href="#local-6989586621683069054"><span class="hs-identifier hs-var">lstmt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2623"></span><span>
</span><span id="line-2624"></span><span class="hs-comment">-- Checking when a particular Stmt is ok</span><span>
</span><span id="line-2625"></span><span id="local-6989586621683066269"><span class="annot"><a href="GHC.Rename.Expr.html#checkStmt"><span class="hs-identifier hs-type">checkStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066269"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-2626"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-2627"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066269"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2628"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2629"></span><span id="checkStmt"><span class="annot"><span class="annottext">checkStmt :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsStmtContextRn
-&gt; LStmt GhcPs (LocatedA (body GhcPs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkStmt"><span class="hs-identifier hs-var hs-var">checkStmt</span></a></span></span><span> </span><span id="local-6989586621683069074"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069074"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683069075"><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069075"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2630"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683069076"><span class="annot"><a href="#local-6989586621683069076"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2631"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#okStmt"><span class="hs-identifier hs-type">okStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069076"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069074"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069075"><span class="hs-identifier hs-type">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2632"></span><span>           </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2633"></span><span>           </span><span class="annot"><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-type">NotValid</span></a></span><span> </span><span id="local-6989586621683069080"><span class="annot"><span class="annottext">Maybe Extension
</span><a href="#local-6989586621683069080"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2634"></span><span>              </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; UnexpectedStatement -&gt; Maybe Extension -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnexpectedStatementInContext"><span class="hs-identifier hs-var">TcRnUnexpectedStatementInContext</span></a></span><span>
</span><span id="line-2635"></span><span>                </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069074"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs)) -&gt; UnexpectedStatement
forall body.
Outputable (StmtLR GhcPs GhcPs body) =&gt;
StmtLR GhcPs GhcPs body -&gt; UnexpectedStatement
</span><a href="GHC.Tc.Errors.Types.html#UnexpectedStatement"><span class="hs-identifier hs-var">UnexpectedStatement</span></a></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069075"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Extension
</span><a href="#local-6989586621683069080"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2636"></span><span>
</span><span id="line-2637"></span><span class="hs-comment">------------</span><span>
</span><span id="line-2638"></span><span class="annot"><a href="GHC.Rename.Expr.html#emptyInvalid"><span class="hs-identifier hs-type">emptyInvalid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span class="hs-special">)</span><span>
</span><span id="line-2639"></span><span id="emptyInvalid"><span class="annot"><span class="annottext">emptyInvalid :: Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#emptyInvalid"><span class="hs-identifier hs-var hs-var">emptyInvalid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Extension -&gt; Validity' (Maybe Extension)
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Extension
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- Invalid, and no extension to suggest</span><span>
</span><span id="line-2640"></span><span>
</span><span id="line-2641"></span><span id="local-6989586621683066535"><span class="annot"><a href="GHC.Rename.Expr.html#okStmt"><span class="hs-identifier hs-type">okStmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#okDoStmt"><span class="hs-identifier hs-type">okDoStmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#okCompStmt"><span class="hs-identifier hs-type">okCompStmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#okParStmt"><span class="hs-identifier hs-type">okParStmt</span></a></span><span>
</span><span id="line-2642"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-2643"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Stmt"><span class="hs-identifier hs-type">Stmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066535"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2644"></span><span class="hs-comment">-- Return Nothing if OK, (Just extra) if not ok</span><span>
</span><span id="line-2645"></span><span class="hs-comment">-- The &quot;extra&quot; is an SDoc that is appended to a generic error message</span><span>
</span><span id="line-2646"></span><span>
</span><span id="line-2647"></span><span id="okStmt"><span class="annot"><span class="annottext">okStmt :: forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okStmt"><span class="hs-identifier hs-var hs-var">okStmt</span></a></span></span><span> </span><span id="local-6989586621683069086"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069086"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683069087"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069087"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683069088"><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069088"><span class="hs-identifier hs-var">stmt</span></a></span></span><span>
</span><span id="line-2648"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069087"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2649"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#PatGuard"><span class="hs-identifier hs-type">PatGuard</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs)) -&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
Stmt GhcPs (LocatedA (body GhcPs)) -&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okPatGuardStmt"><span class="hs-identifier hs-var">okPatGuardStmt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069088"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2650"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtCtxt"><span class="hs-identifier hs-type">ParStmtCtxt</span></a></span><span> </span><span id="local-6989586621683069090"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069090"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okParStmt"><span class="hs-identifier hs-var">okParStmt</span></a></span><span>  </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069086"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069090"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069088"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2651"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span id="local-6989586621683069091"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683069091"><span class="hs-identifier hs-var">flavour</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsDoFlavour
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsDoFlavour
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okDoFlavourStmt"><span class="hs-identifier hs-var">okDoFlavourStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069086"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683069091"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069087"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069088"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2652"></span><span>      </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowExpr"><span class="hs-identifier hs-var">ArrowExpr</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okDoStmt"><span class="hs-identifier hs-var">okDoStmt</span></a></span><span>   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069086"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069087"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069088"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2653"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmtCtxt"><span class="hs-identifier hs-type">TransStmtCtxt</span></a></span><span> </span><span id="local-6989586621683069093"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069093"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okStmt"><span class="hs-identifier hs-var">okStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069086"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069093"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069088"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2654"></span><span>
</span><span id="line-2655"></span><span id="local-6989586621683066539"><span class="annot"><a href="GHC.Rename.Expr.html#okDoFlavourStmt"><span class="hs-identifier hs-type">okDoFlavourStmt</span></a></span><span>
</span><span id="line-2656"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-2657"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Stmt"><span class="hs-identifier hs-type">Stmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066539"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2658"></span><span id="okDoFlavourStmt"><span class="annot"><span class="annottext">okDoFlavourStmt :: forall (body :: * -&gt; *).
DynFlags
-&gt; HsDoFlavour
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okDoFlavourStmt"><span class="hs-identifier hs-var hs-var">okDoFlavourStmt</span></a></span></span><span> </span><span id="local-6989586621683069094"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069094"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683069095"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683069095"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span id="local-6989586621683069096"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069096"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683069097"><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069097"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683069095"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2659"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-type">DoExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okDoStmt"><span class="hs-identifier hs-var">okDoStmt</span></a></span><span>   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069094"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069096"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069097"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2660"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MDoExpr"><span class="hs-identifier hs-type">MDoExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okDoStmt"><span class="hs-identifier hs-var">okDoStmt</span></a></span><span>   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069094"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069096"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069097"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2661"></span><span>      </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okDoStmt"><span class="hs-identifier hs-var">okDoStmt</span></a></span><span>   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069094"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069096"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069097"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2662"></span><span>      </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#ListComp"><span class="hs-identifier hs-var">ListComp</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okCompStmt"><span class="hs-identifier hs-var">okCompStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069094"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069096"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069097"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2663"></span><span>      </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#MonadComp"><span class="hs-identifier hs-var">MonadComp</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okCompStmt"><span class="hs-identifier hs-var">okCompStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069094"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069096"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069097"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2664"></span><span>
</span><span id="line-2665"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-2666"></span><span id="local-6989586621683066538"><span class="annot"><a href="GHC.Rename.Expr.html#okPatGuardStmt"><span class="hs-identifier hs-type">okPatGuardStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Stmt"><span class="hs-identifier hs-type">Stmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683066538"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2667"></span><span id="okPatGuardStmt"><span class="annot"><span class="annottext">okPatGuardStmt :: forall (body :: * -&gt; *).
Stmt GhcPs (LocatedA (body GhcPs)) -&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okPatGuardStmt"><span class="hs-identifier hs-var hs-var">okPatGuardStmt</span></a></span></span><span> </span><span id="local-6989586621683069098"><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069098"><span class="hs-identifier hs-var">stmt</span></a></span></span><span>
</span><span id="line-2668"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069098"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2669"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2670"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2671"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2672"></span><span>      </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#emptyInvalid"><span class="hs-identifier hs-var">emptyInvalid</span></a></span><span>
</span><span id="line-2673"></span><span>
</span><span id="line-2674"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-2675"></span><span id="okParStmt"><span class="annot"><span class="annottext">okParStmt :: forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okParStmt"><span class="hs-identifier hs-var hs-var">okParStmt</span></a></span></span><span> </span><span id="local-6989586621683069099"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069099"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683069100"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069100"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683069101"><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069101"><span class="hs-identifier hs-var">stmt</span></a></span></span><span>
</span><span id="line-2676"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069101"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2677"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt GhcPs GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsIPBinds"><span class="hs-identifier hs-type">HsIPBinds</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#emptyInvalid"><span class="hs-identifier hs-var">emptyInvalid</span></a></span><span>
</span><span id="line-2678"></span><span>      </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okStmt"><span class="hs-identifier hs-var">okStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069099"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069100"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069101"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-2679"></span><span>
</span><span id="line-2680"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-2681"></span><span id="okDoStmt"><span class="annot"><span class="annottext">okDoStmt :: forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okDoStmt"><span class="hs-identifier hs-var hs-var">okDoStmt</span></a></span></span><span> </span><span id="local-6989586621683069102"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069102"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683069103"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069103"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683069104"><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069104"><span class="hs-identifier hs-var">stmt</span></a></span></span><span>
</span><span id="line-2682"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069104"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2683"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-2684"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RecursiveDo</span></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-operator hs-var">`xopt`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069102"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2685"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowExpr"><span class="hs-identifier hs-var">ArrowExpr</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069103"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>    </span><span class="hs-comment">-- Arrows allows 'rec'</span><span>
</span><span id="line-2686"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Extension -&gt; Validity' (Maybe Extension)
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Maybe Extension
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RecursiveDo</span></span><span class="hs-special">)</span><span>
</span><span id="line-2687"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2688"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2689"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2690"></span><span>       </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#emptyInvalid"><span class="hs-identifier hs-var">emptyInvalid</span></a></span><span>
</span><span id="line-2691"></span><span>
</span><span id="line-2692"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-2693"></span><span id="okCompStmt"><span class="annot"><span class="annottext">okCompStmt :: forall (body :: * -&gt; *).
DynFlags
-&gt; HsStmtContextRn
-&gt; Stmt GhcPs (LocatedA (body GhcPs))
-&gt; Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#okCompStmt"><span class="hs-identifier hs-var hs-var">okCompStmt</span></a></span></span><span> </span><span id="local-6989586621683069106"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069106"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683069107"><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069107"><span class="hs-identifier hs-var">stmt</span></a></span></span><span>
</span><span id="line-2694"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stmt GhcPs (LocatedA (body GhcPs))
</span><a href="#local-6989586621683069107"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2695"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2696"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2697"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2698"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-2699"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ParallelListComp</span></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-operator hs-var">`xopt`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069106"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2700"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Extension -&gt; Validity' (Maybe Extension)
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Maybe Extension
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ParallelListComp</span></span><span class="hs-special">)</span><span>
</span><span id="line-2701"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-2702"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TransformListComp</span></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-operator hs-var">`xopt`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683069106"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-2703"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Extension -&gt; Validity' (Maybe Extension)
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Maybe Extension
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TransformListComp</span></span><span class="hs-special">)</span><span>
</span><span id="line-2704"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#emptyInvalid"><span class="hs-identifier hs-var">emptyInvalid</span></a></span><span>
</span><span id="line-2705"></span><span>       </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' (Maybe Extension)
</span><a href="GHC.Rename.Expr.html#emptyInvalid"><span class="hs-identifier hs-var">emptyInvalid</span></a></span><span>  </span><span class="hs-comment">-- Should not happen (dealt with by checkLastStmt)</span><span>
</span><span id="line-2706"></span><span>
</span><span id="line-2707"></span><span class="hs-comment">---------</span><span>
</span><span id="line-2708"></span><span class="annot"><a href="GHC.Rename.Expr.html#checkTupleSection"><span class="hs-identifier hs-type">checkTupleSection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTupArg"><span class="hs-identifier hs-type">HsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2709"></span><span id="checkTupleSection"><span class="annot"><span class="annottext">checkTupleSection :: [HsTupArg GhcPs] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Expr.html#checkTupleSection"><span class="hs-identifier hs-var hs-var">checkTupleSection</span></a></span></span><span> </span><span id="local-6989586621683069110"><span class="annot"><span class="annottext">[HsTupArg GhcPs]
</span><a href="#local-6989586621683069110"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-2710"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683069111"><span class="annot"><a href="#local-6989586621683069111"><span class="hs-identifier hs-var">tuple_section</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TupleSections</span></span><span>
</span><span id="line-2711"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier hs-type">checkErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">all</span></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#tupArgPresent"><span class="hs-identifier hs-type">tupArgPresent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069110"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621683069111"><span class="hs-identifier hs-type">tuple_section</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683069115"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2712"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2713"></span><span>    </span><span class="annot"><a href="#local-6989586621683069115"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-2714"></span><span>    </span><span id="local-6989586621683069115"><span class="annot"><span class="annottext">msg :: TcRnMessage
</span><a href="#local-6989586621683069115"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalTupleSection"><span class="hs-identifier hs-var">TcRnIllegalTupleSection</span></a></span><span>
</span><span id="line-2715"></span><span>
</span><span id="line-2716"></span><span class="hs-comment">---------</span><span>
</span><span id="line-2717"></span><span class="annot"><a href="GHC.Rename.Expr.html#sectionErr"><span class="hs-identifier hs-type">sectionErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-2718"></span><span id="sectionErr"><span class="annot"><span class="annottext">sectionErr :: HsExpr GhcPs -&gt; TcRnMessage
</span><a href="GHC.Rename.Expr.html#sectionErr"><span class="hs-identifier hs-var hs-var">sectionErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnSectionWithoutParentheses"><span class="hs-identifier hs-var">TcRnSectionWithoutParentheses</span></a></span><span>
</span><span id="line-2719"></span><span>
</span><span id="line-2720"></span><span class="annot"><a href="GHC.Rename.Expr.html#badIpBinds"><span class="hs-identifier hs-type">badIpBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsLocalBindsLR"><span class="hs-identifier hs-type">HsLocalBindsLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsLocalBindsLR"><span class="hs-identifier hs-type">HsLocalBindsLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-2721"></span><span id="badIpBinds"><span class="annot"><span class="annottext">badIpBinds :: Either (HsLocalBinds GhcPs) (HsLocalBindsLR GhcRn GhcPs)
-&gt; TcRnMessage
</span><a href="GHC.Rename.Expr.html#badIpBinds"><span class="hs-identifier hs-var hs-var">badIpBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (HsLocalBinds GhcPs) (HsLocalBindsLR GhcRn GhcPs)
-&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalImplicitParameterBindings"><span class="hs-identifier hs-var">TcRnIllegalImplicitParameterBindings</span></a></span><span>
</span><span id="line-2722"></span><span>
</span><span id="line-2723"></span><span class="hs-comment">---------</span><span>
</span><span id="line-2724"></span><span>
</span><span id="line-2725"></span><span class="annot"><a href="GHC.Rename.Expr.html#monadFailOp"><span class="hs-identifier hs-type">monadFailOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2726"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-2727"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FailOperator"><span class="hs-identifier hs-type">FailOperator</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2728"></span><span id="monadFailOp"><span class="annot"><span class="annottext">monadFailOp :: LPat GhcRn
-&gt; HsStmtContextRn -&gt; RnM (Maybe (SyntaxExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#monadFailOp"><span class="hs-identifier hs-var hs-var">monadFailOp</span></a></span></span><span> </span><span id="local-6989586621683069120"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621683069120"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683069121"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683069121"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2729"></span><span>    </span><span id="local-6989586621683069122"><span class="annot"><a href="#local-6989586621683069122"><span class="hs-identifier hs-var">strict</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.Strict</span></span><span>
</span><span id="line-2730"></span><span>    </span><span id="local-6989586621683069123"><span class="annot"><a href="#local-6989586621683069123"><span class="hs-identifier hs-var">hscEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-2731"></span><span>    </span><span id="local-6989586621683069124"><span class="annot"><a href="#local-6989586621683069124"><span class="hs-identifier hs-var">rdrEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-2732"></span><span>    </span><span id="local-6989586621683069125"><span class="annot"><a href="#local-6989586621683069125"><span class="hs-identifier hs-var">comps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCompleteMatchesTcM"><span class="hs-identifier hs-type">getCompleteMatchesTcM</span></a></span><span>
</span><span id="line-2733"></span><span>        </span><span class="hs-comment">-- If the pattern is irrefutable (e.g.: wildcard, tuple, ~pat, etc.)</span><span>
</span><span id="line-2734"></span><span>        </span><span class="hs-comment">-- we should not need to fail.</span><span>
</span><span id="line-2735"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#isIrrefutableHsPat"><span class="hs-identifier hs-type">isIrrefutableHsPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069122"><span class="hs-identifier hs-type">strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#irrefutableConLikeRn"><span class="hs-identifier hs-type">irrefutableConLikeRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069123"><span class="hs-identifier hs-type">hscEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069124"><span class="hs-identifier hs-type">rdrEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069125"><span class="hs-identifier hs-type">comps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683069120"><span class="hs-identifier hs-type">pat</span></a></span><span>
</span><span id="line-2736"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2737"></span><span>
</span><span id="line-2738"></span><span>        </span><span class="hs-comment">-- For non-monadic contexts (e.g. guard patterns, list</span><span>
</span><span id="line-2739"></span><span>        </span><span class="hs-comment">-- comprehensions, etc.) we should not need to fail, or failure is handled in</span><span>
</span><span id="line-2740"></span><span>        </span><span class="hs-comment">-- a different way. See Note [Failing pattern matches in Stmts].</span><span>
</span><span id="line-2741"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#isMonadStmtContext"><span class="hs-identifier hs-type">isMonadStmtContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069121"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2742"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2743"></span><span>
</span><span id="line-2744"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>
</span><span id="line-2745"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#getMonadFailOp"><span class="hs-identifier hs-type">getMonadFailOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069121"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-2746"></span><span>
</span><span id="line-2747"></span><span class="hs-comment">{-
Note [Monad fail : Rebindable syntax, overloaded strings]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given the code
  foo x = do { Just y &lt;- x; return y }

we expect it to desugar as
  foo x = x &gt;&gt;= \r -&gt; case r of
                        Just y  -&gt; return y
                        Nothing -&gt; fail &quot;Pattern match error&quot;

But with RebindableSyntax and OverloadedStrings, we really want
it to desugar thus:
  foo x = x &gt;&gt;= \r -&gt; case r of
                        Just y  -&gt; return y
                        Nothing -&gt; fail (fromString &quot;Patterm match error&quot;)

So, in this case, we synthesize the function
  \x -&gt; fail (fromString x)

(rather than plain 'fail') for the 'fail' operation. This is done in
'getMonadFailOp'.

Similarly with QualifiedDo and OverloadedStrings, we also want to desugar
using fromString:

  foo x = M.do { Just y &lt;- x; return y }

  ===&gt;

  foo x = x M.&gt;&gt;= \r -&gt; case r of
                        Just y  -&gt; return y
                        Nothing -&gt; M.fail (fromString &quot;Pattern match error&quot;)

-}</span><span>
</span><span id="line-2783"></span><span id="local-6989586621683066392"><span class="annot"><a href="GHC.Rename.Expr.html#getMonadFailOp"><span class="hs-identifier hs-type">getMonadFailOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStmtContext"><span class="hs-identifier hs-type">HsStmtContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683066392"><span class="hs-identifier hs-type">fn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FailOperator"><span class="hs-identifier hs-type">FailOperator</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-comment">-- Syntax expr fail op</span><span>
</span><span id="line-2784"></span><span id="getMonadFailOp"><span class="annot"><span class="annottext">getMonadFailOp :: forall fn.
HsStmtContext fn -&gt; RnM (Maybe (SyntaxExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#getMonadFailOp"><span class="hs-identifier hs-var hs-var">getMonadFailOp</span></a></span></span><span> </span><span id="local-6989586621683069154"><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683069154"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-2785"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683069155"><span class="annot"><a href="#local-6989586621683069155"><span class="hs-identifier hs-var">xOverloadedStrings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Bool)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DynFlags
-&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.OverloadedStrings</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2786"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683069156"><span class="annot"><a href="#local-6989586621683069156"><span class="hs-identifier hs-var">xRebindableSyntax</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-type">xopt</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.RebindableSyntax</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-2787"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683069157"><span class="annot"><a href="#local-6989586621683069157"><span class="hs-identifier hs-var">fail</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069158"><span class="annot"><a href="#local-6989586621683069158"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683069159"><span class="hs-identifier hs-type">reallyGetMonadFailOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069156"><span class="hs-identifier hs-type">xRebindableSyntax</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069155"><span class="hs-identifier hs-type">xOverloadedStrings</span></a></span><span>
</span><span id="line-2788"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683069157"><span class="hs-identifier hs-type">fail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683069158"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2789"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-2790"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2791"></span><span>    </span><span id="local-6989586621683069160"><span class="annot"><span class="annottext">isQualifiedDo :: Bool
</span><a href="#local-6989586621683069160"><span class="hs-identifier hs-var hs-var">isQualifiedDo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsStmtContext fn -&gt; Maybe ModuleName
forall fn. HsStmtContext fn -&gt; Maybe ModuleName
</span><a href="Language.Haskell.Syntax.Expr.html#qualifiedDoModuleName_maybe"><span class="hs-identifier hs-var">qualifiedDoModuleName_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683069154"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2792"></span><span>
</span><span id="line-2793"></span><span>    </span><span id="local-6989586621683069159"><span class="annot"><span class="annottext">reallyGetMonadFailOp :: Bool
-&gt; Bool -&gt; IOEnv (Env TcGblEnv TcLclEnv) (SyntaxExprRn, FreeVars)
</span><a href="#local-6989586621683069159"><span class="hs-identifier hs-var hs-var">reallyGetMonadFailOp</span></a></span></span><span> </span><span id="local-6989586621683069162"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683069162"><span class="hs-identifier hs-var">rebindableSyntax</span></a></span></span><span> </span><span id="local-6989586621683069163"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683069163"><span class="hs-identifier hs-var">overloadedStrings</span></a></span></span><span>
</span><span id="line-2794"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683069160"><span class="hs-identifier hs-var">isQualifiedDo</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683069162"><span class="hs-identifier hs-var">rebindableSyntax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683069163"><span class="hs-identifier hs-var">overloadedStrings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2795"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683069164"><span class="annot"><a href="#local-6989586621683069164"><span class="hs-identifier hs-var">failExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069165"><span class="annot"><a href="#local-6989586621683069165"><span class="hs-identifier hs-var">failFvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn -&gt; Name -&gt; TcM (HsExpr GhcRn, FreeVars)
forall fn. HsStmtContext fn -&gt; Name -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDoExpr"><span class="hs-identifier hs-var">lookupQualifiedDoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683069154"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#failMName"><span class="hs-identifier hs-var">failMName</span></a></span><span>
</span><span id="line-2796"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683069167"><span class="annot"><a href="#local-6989586621683069167"><span class="hs-identifier hs-var">fromStringExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069168"><span class="annot"><a href="#local-6989586621683069168"><span class="hs-identifier hs-var">fromStringFvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxExpr"><span class="hs-identifier hs-type">lookupSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#fromStringName"><span class="hs-identifier hs-type">fromStringName</span></a></span><span>
</span><span id="line-2797"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683069171"><span class="annot"><a href="#local-6989586621683069171"><span class="hs-identifier hs-var hs-var">arg_lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2798"></span><span>        </span><span id="local-6989586621683069174"><span class="annot"><a href="#local-6989586621683069174"><span class="hs-identifier hs-var">arg_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-type">newSysName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069171"><span class="hs-identifier hs-type">arg_lit</span></a></span><span>
</span><span id="line-2799"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683069176"><span class="annot"><a href="#local-6989586621683069176"><span class="hs-identifier hs-var hs-var">arg_syn_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; XRec GhcRn (HsExpr GhcRn)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683069174"><span class="hs-identifier hs-var">arg_name</span></a></span><span>
</span><span id="line-2800"></span><span>            </span><span id="local-6989586621683069178"><span class="annot"><a href="#local-6989586621683069178"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">LHsExpr</span></span><span> </span><span class="annot"><span class="hs-identifier">GhcRn</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2801"></span><span>              </span><span class="annot"><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-type">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069164"><span class="hs-identifier hs-type">failExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2802"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-type">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683069167"><span class="hs-identifier hs-type">fromStringExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683069176"><span class="hs-identifier hs-type">arg_syn_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2803"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683069180"><span class="annot"><a href="#local-6989586621683069180"><span class="hs-identifier hs-var">failAfterFromStringExpr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">HsExpr</span></span><span> </span><span class="annot"><span class="hs-identifier">GhcRn</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2804"></span><span>              </span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsLam"><span class="hs-identifier hs-type">mkHsLam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069174"><span class="hs-identifier hs-type">arg_name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683069178"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-2805"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683069182"><span class="annot"><a href="#local-6989586621683069182"><span class="hs-identifier hs-var">failAfterFromStringSynExpr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">SyntaxExpr</span></span><span> </span><span class="annot"><span class="hs-identifier">GhcRn</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2806"></span><span>              </span><span class="annot"><a href="GHC.Hs.Expr.html#mkSyntaxExpr"><span class="hs-identifier hs-type">mkSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069180"><span class="hs-identifier hs-type">failAfterFromStringExpr</span></a></span><span>
</span><span id="line-2807"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683069182"><span class="hs-identifier hs-type">failAfterFromStringSynExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683069165"><span class="hs-identifier hs-type">failFvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-type">`plusFV`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069168"><span class="hs-identifier hs-type">fromStringFvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2808"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
forall fn.
HsStmtContext fn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDo"><span class="hs-identifier hs-var">lookupQualifiedDo</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683069154"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#failMName"><span class="hs-identifier hs-var">failMName</span></a></span><span>
</span><span id="line-2809"></span><span>
</span><span id="line-2810"></span><span>
</span><span id="line-2811"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Generating code for ExpandedThingRn
      See Note [Handling overloaded and rebindable constructs]
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2817"></span><span>
</span><span id="line-2818"></span><span class="hs-comment">-- | Expand `HsIf` if rebindable syntax is turned on</span><span>
</span><span id="line-2819"></span><span class="hs-comment">--   See Note [Handling overloaded and rebindable constructs]</span><span>
</span><span id="line-2820"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnHsIf"><span class="hs-identifier hs-type">rnHsIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2821"></span><span id="rnHsIf"><span class="annot"><span class="annottext">rnHsIf :: LHsExpr GhcPs
-&gt; LHsExpr GhcPs -&gt; LHsExpr GhcPs -&gt; TcM (HsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnHsIf"><span class="hs-identifier hs-var hs-var">rnHsIf</span></a></span></span><span> </span><span id="local-6989586621683069183"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683069183"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683069184"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683069184"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621683069185"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683069185"><span class="hs-identifier hs-var">b2</span></a></span></span><span>
</span><span id="line-2822"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683069186"><span class="annot"><a href="#local-6989586621683069186"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">,</span><span>  </span><span id="local-6989586621683069187"><span class="annot"><a href="#local-6989586621683069187"><span class="hs-identifier hs-var">fvP</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683069183"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2823"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683069188"><span class="annot"><a href="#local-6989586621683069188"><span class="hs-identifier hs-var">b1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069189"><span class="annot"><a href="#local-6989586621683069189"><span class="hs-identifier hs-var">fvB1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069184"><span class="hs-identifier hs-type">b1</span></a></span><span>
</span><span id="line-2824"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683069190"><span class="annot"><a href="#local-6989586621683069190"><span class="hs-identifier hs-var">b2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069191"><span class="annot"><a href="#local-6989586621683069191"><span class="hs-identifier hs-var">fvB2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-type">rnLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069185"><span class="hs-identifier hs-type">b2</span></a></span><span>
</span><span id="line-2825"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683069192"><span class="annot"><a href="#local-6989586621683069192"><span class="hs-identifier hs-var hs-var">fvs_if</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683069187"><span class="hs-identifier hs-var">fvP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683069189"><span class="hs-identifier hs-var">fvB1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683069191"><span class="hs-identifier hs-var">fvB2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2826"></span><span>             </span><span id="local-6989586621683069193"><span class="annot"><a href="#local-6989586621683069193"><span class="hs-identifier hs-var hs-var">rn_if</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XIf GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p. XIf p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsIf"><span class="hs-identifier hs-var">HsIf</span></a></span><span> </span><span class="annot"><span class="annottext">XIf GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>  </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069186"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069188"><span class="hs-identifier hs-var">b1'</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069190"><span class="hs-identifier hs-var">b2'</span></a></span><span>
</span><span id="line-2827"></span><span>
</span><span id="line-2828"></span><span>       </span><span class="hs-comment">-- Deal with rebindable syntax</span><span>
</span><span id="line-2829"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683069194"><span class="annot"><a href="#local-6989586621683069194"><span class="hs-identifier hs-var">mb_ite</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupIfThenElse"><span class="hs-identifier hs-type">lookupIfThenElse</span></a></span><span>
</span><span id="line-2830"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683069194"><span class="hs-identifier hs-type">mb_ite</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2831"></span><span>            </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-comment">-- Non rebindable-syntax case</span><span>
</span><span id="line-2832"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069193"><span class="hs-identifier hs-var">rn_if</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683069192"><span class="hs-identifier hs-var">fvs_if</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2833"></span><span>
</span><span id="line-2834"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683069195"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069195"><span class="hs-identifier hs-var">ite_name</span></a></span></span><span>   </span><span class="hs-comment">-- Rebindable-syntax case</span><span>
</span><span id="line-2835"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683069196"><span class="annot"><span class="annottext">ds_if :: HsExpr GhcRn
</span><a href="#local-6989586621683069196"><span class="hs-identifier hs-var hs-var">ds_if</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApps"><span class="hs-identifier hs-var">genHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069195"><span class="hs-identifier hs-var">ite_name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069186"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069188"><span class="hs-identifier hs-var">b1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069190"><span class="hs-identifier hs-var">b2'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2836"></span><span>                          </span><span id="local-6989586621683069197"><span class="annot"><span class="annottext">fvs :: FreeVars
</span><a href="#local-6989586621683069197"><span class="hs-identifier hs-var hs-var">fvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FreeVars] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683069192"><span class="hs-identifier hs-var">fvs_if</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069195"><span class="hs-identifier hs-var">ite_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2837"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, FreeVars) -&gt; TcM (HsExpr GhcRn, FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsExpr GhcRn -&gt; HsExpr GhcRn
</span><a href="GHC.Hs.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-var">mkExpandedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069193"><span class="hs-identifier hs-var">rn_if</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069196"><span class="hs-identifier hs-var">ds_if</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683069197"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2838"></span><span>
</span><span id="line-2839"></span><span class="hs-comment">-----------------------------------------</span><span>
</span><span id="line-2840"></span><span class="hs-comment">-- Bits and pieces for RecordDotSyntax.</span><span>
</span><span id="line-2841"></span><span class="hs-comment">--</span><span>
</span><span id="line-2842"></span><span class="hs-comment">-- See Note [Overview of record dot syntax] in GHC.Hs.Expr.</span><span>
</span><span id="line-2843"></span><span>
</span><span id="line-2844"></span><span class="hs-comment">-- mkGetField arg field calculates a get_field @field arg expression.</span><span>
</span><span id="line-2845"></span><span class="hs-comment">-- e.g. z.x = mkGetField z x = get_field @x z</span><span>
</span><span id="line-2846"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkGetField"><span class="hs-identifier hs-type">mkGetField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedAn"><span class="hs-identifier hs-type">LocatedAn</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#NoEpAnns"><span class="hs-identifier hs-type">NoEpAnns</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2847"></span><span id="mkGetField"><span class="annot"><span class="annottext">mkGetField :: Name
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; LocatedAn NoEpAnns FieldLabelString
-&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Expr.html#mkGetField"><span class="hs-identifier hs-var hs-var">mkGetField</span></a></span></span><span> </span><span id="local-6989586621683069198"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069198"><span class="hs-identifier hs-var">get_field</span></a></span></span><span> </span><span id="local-6989586621683069199"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069199"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683069200"><span class="annot"><span class="annottext">LocatedAn NoEpAnns FieldLabelString
</span><a href="#local-6989586621683069200"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[XRec GhcRn (HsExpr GhcRn)] -&gt; XRec GhcRn (HsExpr GhcRn)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([XRec GhcRn (HsExpr GhcRn)] -&gt; XRec GhcRn (HsExpr GhcRn))
-&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; XRec GhcRn (HsExpr GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [XRec GhcRn (HsExpr GhcRn)]
-&gt; LocatedAn NoEpAnns FieldLabelString
-&gt; [XRec GhcRn (HsExpr GhcRn)]
</span><a href="GHC.Rename.Expr.html#mkGet"><span class="hs-identifier hs-var">mkGet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069198"><span class="hs-identifier hs-var">get_field</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069199"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">LocatedAn NoEpAnns FieldLabelString
</span><a href="#local-6989586621683069200"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2848"></span><span>
</span><span id="line-2849"></span><span class="hs-comment">-- mkSetField a field b calculates a set_field @field expression.</span><span>
</span><span id="line-2850"></span><span class="hs-comment">-- e.g mkSetSetField a field b = set_field @&quot;field&quot; a b (read as &quot;set field 'field' on a to b&quot;).</span><span>
</span><span id="line-2851"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkSetField"><span class="hs-identifier hs-type">mkSetField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedAn"><span class="hs-identifier hs-type">LocatedAn</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#NoEpAnns"><span class="hs-identifier hs-type">NoEpAnns</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2852"></span><span id="mkSetField"><span class="annot"><span class="annottext">mkSetField :: Name
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; LocatedAn NoEpAnns FieldLabelString
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Expr.html#mkSetField"><span class="hs-identifier hs-var hs-var">mkSetField</span></a></span></span><span> </span><span id="local-6989586621683069203"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069203"><span class="hs-identifier hs-var">set_field</span></a></span></span><span> </span><span id="local-6989586621683069204"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069204"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn NoEpAnns
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span id="local-6989586621683069206"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683069206"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683069207"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069207"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2853"></span><span>  </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; XRec GhcRn (HsExpr GhcRn) -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApp"><span class="hs-identifier hs-var">genHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; XRec GhcRn (HsExpr GhcRn) -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApp"><span class="hs-identifier hs-var">genHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsVar"><span class="hs-identifier hs-var">genHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069203"><span class="hs-identifier hs-var">set_field</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsType (NoGhcTc GhcRn) -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genAppType"><span class="hs-operator hs-var">`genAppType`</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; HsType GhcRn
</span><a href="GHC.Rename.Utils.html#genHsTyLit"><span class="hs-identifier hs-var">genHsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683069206"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069204"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069207"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2854"></span><span>
</span><span id="line-2855"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkGet"><span class="hs-identifier hs-type">mkGet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedAn"><span class="hs-identifier hs-type">LocatedAn</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#NoEpAnns"><span class="hs-identifier hs-type">NoEpAnns</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2856"></span><span id="mkGet"><span class="annot"><span class="annottext">mkGet :: Name
-&gt; [XRec GhcRn (HsExpr GhcRn)]
-&gt; LocatedAn NoEpAnns FieldLabelString
-&gt; [XRec GhcRn (HsExpr GhcRn)]
</span><a href="GHC.Rename.Expr.html#mkGet"><span class="hs-identifier hs-var hs-var">mkGet</span></a></span></span><span> </span><span id="local-6989586621683069208"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069208"><span class="hs-identifier hs-var">get_field</span></a></span></span><span> </span><span id="local-6989586621683069209"><span class="annot"><span class="annottext">l :: [XRec GhcRn (HsExpr GhcRn)]
</span><a href="#local-6989586621683069209"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683069210"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069210"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[XRec GhcRn (HsExpr GhcRn)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn NoEpAnns
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span id="local-6989586621683069211"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683069211"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2857"></span><span>  </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; XRec GhcRn (HsExpr GhcRn) -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApp"><span class="hs-identifier hs-var">genHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsVar"><span class="hs-identifier hs-var">genHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069208"><span class="hs-identifier hs-var">get_field</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsType (NoGhcTc GhcRn) -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genAppType"><span class="hs-operator hs-var">`genAppType`</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; HsType GhcRn
</span><a href="GHC.Rename.Utils.html#genHsTyLit"><span class="hs-identifier hs-var">genHsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683069211"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069210"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[XRec GhcRn (HsExpr GhcRn)]
[GenLocated SrcSpanAnnA (HsExpr GhcRn)]
</span><a href="#local-6989586621683069209"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-2858"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkGet"><span class="hs-identifier hs-var">mkGet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">LocatedAn NoEpAnns FieldLabelString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkGet : The impossible has happened!&quot;</span></span><span>
</span><span id="line-2859"></span><span>
</span><span id="line-2860"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkSet"><span class="hs-identifier hs-type">mkSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedAn"><span class="hs-identifier hs-type">LocatedAn</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#NoEpAnns"><span class="hs-identifier hs-type">NoEpAnns</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2861"></span><span id="mkSet"><span class="annot"><span class="annottext">mkSet :: Name
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; (LocatedAn NoEpAnns FieldLabelString, XRec GhcRn (HsExpr GhcRn))
-&gt; XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Rename.Expr.html#mkSet"><span class="hs-identifier hs-var hs-var">mkSet</span></a></span></span><span> </span><span id="local-6989586621683069213"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069213"><span class="hs-identifier hs-var">set_field</span></a></span></span><span> </span><span id="local-6989586621683069214"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069214"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683069215"><span class="annot"><span class="annottext">LocatedAn NoEpAnns FieldLabelString
</span><a href="#local-6989586621683069215"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069216"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069216"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; LocatedAn NoEpAnns FieldLabelString
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Expr.html#mkSetField"><span class="hs-identifier hs-var">mkSetField</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069213"><span class="hs-identifier hs-var">set_field</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069216"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedAn NoEpAnns FieldLabelString
</span><a href="#local-6989586621683069215"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069214"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2862"></span><span>
</span><span id="line-2863"></span><span class="hs-comment">-- mkProjection fields calculates a projection.</span><span>
</span><span id="line-2864"></span><span class="hs-comment">-- e.g. .x = mkProjection [x] = getField @&quot;x&quot;</span><span>
</span><span id="line-2865"></span><span class="hs-comment">--      .x.y = mkProjection [.x, .y] = (.y) . (.x) = getField @&quot;y&quot; . getField @&quot;x&quot;</span><span>
</span><span id="line-2866"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkProjection"><span class="hs-identifier hs-type">mkProjection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2867"></span><span id="mkProjection"><span class="annot"><span class="annottext">mkProjection :: Name -&gt; Name -&gt; NonEmpty FieldLabelString -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Expr.html#mkProjection"><span class="hs-identifier hs-var hs-var">mkProjection</span></a></span></span><span> </span><span id="local-6989586621683069217"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069217"><span class="hs-identifier hs-var">getFieldName</span></a></span></span><span> </span><span id="local-6989586621683069218"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069218"><span class="hs-identifier hs-var">circName</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683069219"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683069219"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621683069221"><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621683069221"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn -&gt; FieldLabelString -&gt; HsExpr GhcRn)
-&gt; HsExpr GhcRn -&gt; [FieldLabelString] -&gt; HsExpr GhcRn
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; FieldLabelString -&gt; HsExpr GhcRn
</span><a href="#local-6989586621683069223"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; HsExpr GhcRn
</span><a href="#local-6989586621683069224"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683069219"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621683069221"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-2868"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2869"></span><span>    </span><span class="annot"><a href="#local-6989586621683069223"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2870"></span><span>    </span><span id="local-6989586621683069223"><span class="annot"><span class="annottext">f :: HsExpr GhcRn -&gt; FieldLabelString -&gt; HsExpr GhcRn
</span><a href="#local-6989586621683069223"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683069225"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069225"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683069226"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683069226"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApps"><span class="hs-identifier hs-var">genHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069218"><span class="hs-identifier hs-var">circName</span></a></span><span> </span><span class="annot"><span class="annottext">([XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn)
-&gt; [XRec GhcRn (HsExpr GhcRn)] -&gt; HsExpr GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn -&gt; XRec GhcRn (HsExpr GhcRn))
-&gt; [HsExpr GhcRn] -&gt; [XRec GhcRn (HsExpr GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; XRec GhcRn (HsExpr GhcRn)
HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldLabelString -&gt; HsExpr GhcRn
</span><a href="#local-6989586621683069224"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683069226"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069225"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2871"></span><span>
</span><span id="line-2872"></span><span>    </span><span class="annot"><a href="#local-6989586621683069224"><span class="hs-identifier hs-type">proj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2873"></span><span>    </span><span id="local-6989586621683069224"><span class="annot"><span class="annottext">proj :: FieldLabelString -&gt; HsExpr GhcRn
</span><a href="#local-6989586621683069224"><span class="hs-identifier hs-var hs-var">proj</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span id="local-6989586621683069227"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683069227"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsVar"><span class="hs-identifier hs-var">genHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069217"><span class="hs-identifier hs-var">getFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsType (NoGhcTc GhcRn) -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genAppType"><span class="hs-operator hs-var">`genAppType`</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; HsType GhcRn
</span><a href="GHC.Rename.Utils.html#genHsTyLit"><span class="hs-identifier hs-var">genHsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683069227"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-2874"></span><span>
</span><span id="line-2875"></span><span class="hs-comment">-- mkProjUpdateSetField calculates functions representing dot notation record updates.</span><span>
</span><span id="line-2876"></span><span class="hs-comment">-- e.g. Suppose an update like foo.bar = 1.</span><span>
</span><span id="line-2877"></span><span class="hs-comment">--      We calculate the function \a -&gt; setField @&quot;foo&quot; a (setField @&quot;bar&quot; (getField @&quot;foo&quot; a) 1).</span><span>
</span><span id="line-2878"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkProjUpdateSetField"><span class="hs-identifier hs-type">mkProjUpdateSetField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsRecProj"><span class="hs-identifier hs-type">LHsRecProj</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2879"></span><span id="mkProjUpdateSetField"><span class="annot"><span class="annottext">mkProjUpdateSetField :: Name
-&gt; Name
-&gt; LHsRecUpdProj GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Rename.Expr.html#mkProjUpdateSetField"><span class="hs-identifier hs-var hs-var">mkProjUpdateSetField</span></a></span></span><span> </span><span id="local-6989586621683069230"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069230"><span class="hs-identifier hs-var">get_field</span></a></span></span><span> </span><span id="local-6989586621683069231"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069231"><span class="hs-identifier hs-var">set_field</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hfbLHS :: forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn NoEpAnns
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FieldLabelStrings"><span class="hs-identifier hs-type">FieldLabelStrings</span></a></span><span> </span><span id="local-6989586621683069234"><span class="annot"><span class="annottext">[XRec GhcRn (DotFieldOcc GhcRn)]
</span><a href="#local-6989586621683069234"><span class="hs-identifier hs-var">flds'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbRHS :: forall lhs rhs. HsFieldBind lhs rhs -&gt; rhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683069235"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069235"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2880"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2881"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683069236"><span class="annot"><span class="annottext">flds :: [LocatedAn NoEpAnns FieldLabelString]
</span><a href="#local-6989586621683069236"><span class="hs-identifier hs-var hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn)
 -&gt; LocatedAn NoEpAnns FieldLabelString)
-&gt; [GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn)]
-&gt; [LocatedAn NoEpAnns FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DotFieldOcc GhcRn -&gt; FieldLabelString)
-&gt; GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn)
-&gt; LocatedAn NoEpAnns FieldLabelString
forall a b.
(a -&gt; b)
-&gt; GenLocated (EpAnn NoEpAnns) a -&gt; GenLocated (EpAnn NoEpAnns) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN FieldLabelString -&gt; FieldLabelString
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnN FieldLabelString -&gt; FieldLabelString)
-&gt; (DotFieldOcc GhcRn -&gt; GenLocated SrcSpanAnnN FieldLabelString)
-&gt; DotFieldOcc GhcRn
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DotFieldOcc GhcRn -&gt; XRec GhcRn FieldLabelString
DotFieldOcc GhcRn -&gt; GenLocated SrcSpanAnnN FieldLabelString
forall p. DotFieldOcc p -&gt; XRec p FieldLabelString
</span><a href="Language.Haskell.Syntax.Expr.html#dfoLabel"><span class="hs-identifier hs-var">dfoLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[XRec GhcRn (DotFieldOcc GhcRn)]
[GenLocated (EpAnn NoEpAnns) (DotFieldOcc GhcRn)]
</span><a href="#local-6989586621683069234"><span class="hs-identifier hs-var">flds'</span></a></span><span>
</span><span id="line-2882"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683069237"><span class="annot"><span class="annottext">final :: LocatedAn NoEpAnns FieldLabelString
</span><a href="#local-6989586621683069237"><span class="hs-identifier hs-var hs-var">final</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
-&gt; LocatedAn NoEpAnns FieldLabelString
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
</span><a href="#local-6989586621683069236"><span class="hs-identifier hs-var">flds</span></a></span><span>  </span><span class="hs-comment">-- quux</span><span>
</span><span id="line-2883"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683069238"><span class="annot"><span class="annottext">fields :: [LocatedAn NoEpAnns FieldLabelString]
</span><a href="#local-6989586621683069238"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
-&gt; [LocatedAn NoEpAnns FieldLabelString]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
</span><a href="#local-6989586621683069236"><span class="hs-identifier hs-var">flds</span></a></span><span>   </span><span class="hs-comment">-- [foo, bar, baz]</span><span>
</span><span id="line-2884"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683069240"><span class="annot"><span class="annottext">getters :: GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
</span><a href="#local-6989586621683069240"><span class="hs-identifier hs-var hs-var">getters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683069241"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069241"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (HsExpr GhcRn)]
 -&gt; LocatedAn NoEpAnns FieldLabelString
 -&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)])
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
-&gt; [LocatedAn NoEpAnns FieldLabelString]
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
-&gt; [XRec GhcRn (HsExpr GhcRn)]
-&gt; LocatedAn NoEpAnns FieldLabelString
-&gt; [XRec GhcRn (HsExpr GhcRn)]
</span><a href="GHC.Rename.Expr.html#mkGet"><span class="hs-identifier hs-var">mkGet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069230"><span class="hs-identifier hs-var">get_field</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069241"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
</span><a href="#local-6989586621683069238"><span class="hs-identifier hs-var">fields</span></a></span><span>  </span><span class="hs-comment">-- Ordered from deep to shallow.</span><span>
</span><span id="line-2885"></span><span>          </span><span class="hs-comment">-- [getField@&quot;baz&quot;(getField@&quot;bar&quot;(getField@&quot;foo&quot; a), getField@&quot;bar&quot;(getField@&quot;foo&quot; a), getField@&quot;foo&quot; a, a]</span><span>
</span><span id="line-2886"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683069242"><span class="annot"><span class="annottext">zips :: GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; [(LocatedAn NoEpAnns FieldLabelString,
     GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621683069242"><span class="hs-identifier hs-var hs-var">zips</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683069243"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069243"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedAn NoEpAnns FieldLabelString
</span><a href="#local-6989586621683069237"><span class="hs-identifier hs-var">final</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcRn)]
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
</span><a href="#local-6989586621683069240"><span class="hs-identifier hs-var">getters</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069243"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LocatedAn NoEpAnns FieldLabelString,
 GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; [(LocatedAn NoEpAnns FieldLabelString,
     GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; [(LocatedAn NoEpAnns FieldLabelString,
     GenLocated SrcSpanAnnA (HsExpr GhcRn))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
-&gt; [(LocatedAn NoEpAnns FieldLabelString,
     GenLocated SrcSpanAnnA (HsExpr GhcRn))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
-&gt; [LocatedAn NoEpAnns FieldLabelString]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[LocatedAn NoEpAnns FieldLabelString]
</span><a href="#local-6989586621683069238"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcRn)]
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcRn)]
</span><a href="#local-6989586621683069240"><span class="hs-identifier hs-var">getters</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069243"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Ordered from deep to shallow.</span><span>
</span><span id="line-2887"></span><span>          </span><span class="hs-comment">-- [(&quot;quux&quot;, getField@&quot;baz&quot;(getField@&quot;bar&quot;(getField@&quot;foo&quot; a)), (&quot;baz&quot;, getField@&quot;bar&quot;(getField@&quot;foo&quot; a)), (&quot;bar&quot;, getField@&quot;foo&quot; a), (&quot;foo&quot;, a)]</span><span>
</span><span id="line-2888"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-2889"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683069244"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069244"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcRn)
 -&gt; (LocatedAn NoEpAnns FieldLabelString,
     GenLocated SrcSpanAnnA (HsExpr GhcRn))
 -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; [(LocatedAn NoEpAnns FieldLabelString,
     GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; (LocatedAn NoEpAnns FieldLabelString, XRec GhcRn (HsExpr GhcRn))
-&gt; XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Rename.Expr.html#mkSet"><span class="hs-identifier hs-var">mkSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069231"><span class="hs-identifier hs-var">set_field</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069235"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; [(LocatedAn NoEpAnns FieldLabelString,
     GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621683069242"><span class="hs-identifier hs-var">zips</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069244"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2890"></span><span>          </span><span class="hs-comment">-- setField@&quot;foo&quot; (a) (setField@&quot;bar&quot; (getField @&quot;foo&quot; (a))(setField@&quot;baz&quot; (getField @&quot;bar&quot; (getField @&quot;foo&quot; (a)))(setField@&quot;quux&quot; (getField @&quot;baz&quot; (getField @&quot;bar&quot; (getField @&quot;foo&quot; (a))))(quux))))</span><span>
</span><span id="line-2891"></span><span>
</span><span id="line-2892"></span><span class="annot"><a href="GHC.Rename.Expr.html#mkRecordDotUpd"><span class="hs-identifier hs-type">mkRecordDotUpd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsRecUpdProj"><span class="hs-identifier hs-type">LHsRecUpdProj</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2893"></span><span id="mkRecordDotUpd"><span class="annot"><span class="annottext">mkRecordDotUpd :: Name
-&gt; Name
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; [LHsRecUpdProj GhcRn]
-&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Expr.html#mkRecordDotUpd"><span class="hs-identifier hs-var hs-var">mkRecordDotUpd</span></a></span></span><span> </span><span id="local-6989586621683069245"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069245"><span class="hs-identifier hs-var">get_field</span></a></span></span><span> </span><span id="local-6989586621683069246"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069246"><span class="hs-identifier hs-var">set_field</span></a></span></span><span> </span><span id="local-6989586621683069247"><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
</span><a href="#local-6989586621683069247"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621683069248"><span class="annot"><span class="annottext">[LHsRecUpdProj GhcRn]
</span><a href="#local-6989586621683069248"><span class="hs-identifier hs-var">updates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn
 -&gt; GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
         (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
 -&gt; HsExpr GhcRn)
-&gt; HsExpr GhcRn
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
         (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
-&gt; HsExpr GhcRn
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; LHsRecUpdProj GhcRn -&gt; HsExpr GhcRn
HsExpr GhcRn
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
        (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; HsExpr GhcRn
</span><a href="#local-6989586621683069249"><span class="hs-identifier hs-var">fieldUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (HsExpr GhcRn)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621683069247"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdProj GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
      (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621683069248"><span class="hs-identifier hs-var">updates</span></a></span><span>
</span><span id="line-2894"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2895"></span><span>    </span><span class="annot"><a href="#local-6989586621683069249"><span class="hs-identifier hs-type">fieldUpdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsRecUpdProj"><span class="hs-identifier hs-type">LHsRecUpdProj</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2896"></span><span>    </span><span id="local-6989586621683069249"><span class="annot"><span class="annottext">fieldUpdate :: HsExpr GhcRn -&gt; LHsRecUpdProj GhcRn -&gt; HsExpr GhcRn
</span><a href="#local-6989586621683069249"><span class="hs-identifier hs-var hs-var">fieldUpdate</span></a></span></span><span> </span><span id="local-6989586621683069250"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069250"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683069251"><span class="annot"><span class="annottext">LHsRecUpdProj GhcRn
</span><a href="#local-6989586621683069251"><span class="hs-identifier hs-var">lpu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; HsExpr GhcRn)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; HsExpr GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
-&gt; Name
-&gt; LHsRecUpdProj GhcRn
-&gt; XRec GhcRn (HsExpr GhcRn)
-&gt; XRec GhcRn (HsExpr GhcRn)
</span><a href="GHC.Rename.Expr.html#mkProjUpdateSetField"><span class="hs-identifier hs-var">mkProjUpdateSetField</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069245"><span class="hs-identifier hs-var">get_field</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683069246"><span class="hs-identifier hs-var">set_field</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdProj GhcRn
</span><a href="#local-6989586621683069251"><span class="hs-identifier hs-var">lpu</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall an a. HasAnnotation an =&gt; a -&gt; GenLocated an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621683069250"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2897"></span><span>
</span><span id="line-2898"></span><span class="annot"><a href="GHC.Rename.Expr.html#rnHsUpdProjs"><span class="hs-identifier hs-type">rnHsUpdProjs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsRecUpdProj"><span class="hs-identifier hs-type">LHsRecUpdProj</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsRecUpdProj"><span class="hs-identifier hs-type">LHsRecUpdProj</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2899"></span><span id="rnHsUpdProjs"><span class="annot"><span class="annottext">rnHsUpdProjs :: [LHsRecUpdProj GhcPs] -&gt; RnM ([LHsRecUpdProj GhcRn], FreeVars)
</span><a href="GHC.Rename.Expr.html#rnHsUpdProjs"><span class="hs-identifier hs-var hs-var">rnHsUpdProjs</span></a></span></span><span> </span><span id="local-6989586621683069252"><span class="annot"><span class="annottext">[LHsRecUpdProj GhcPs]
</span><a href="#local-6989586621683069252"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2900"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683069253"><span class="annot"><a href="#local-6989586621683069253"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069254"><span class="annot"><a href="#local-6989586621683069254"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
       (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  FreeVars)]
-&gt; ([GenLocated
       SrcSpanAnnA
       (HsFieldBind
          (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
          (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
    [FreeVars])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
        (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
   FreeVars)]
 -&gt; ([GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
           (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
     [FreeVars]))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
            (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
            (GenLocated SrcSpanAnnA (HsExpr GhcRn)))],
      [FreeVars])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
      (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
            (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars))
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
         (GenLocated SrcSpanAnnA (HsExpr GhcPs)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
            (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
       FreeVars)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdProj GhcPs -&gt; RnM (LHsRecUpdProj GhcRn, FreeVars)
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
     (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcRn))
           (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
      FreeVars)
</span><a href="#local-6989586621683069255"><span class="hs-identifier hs-var">rnRecUpdProj</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdProj GhcPs]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
      (GenLocated SrcSpanAnnA (HsExpr GhcPs)))]
</span><a href="#local-6989586621683069252"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-2901"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683069253"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusFVs"><span class="hs-identifier hs-type">plusFVs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069254"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2902"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2903"></span><span>    </span><span class="annot"><a href="#local-6989586621683069255"><span class="hs-identifier hs-type">rnRecUpdProj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsRecUpdProj"><span class="hs-identifier hs-type">LHsRecUpdProj</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsRecUpdProj"><span class="hs-identifier hs-type">LHsRecUpdProj</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2904"></span><span>    </span><span id="local-6989586621683069255"><span class="annot"><span class="annottext">rnRecUpdProj :: LHsRecUpdProj GhcPs -&gt; RnM (LHsRecUpdProj GhcRn, FreeVars)
</span><a href="#local-6989586621683069255"><span class="hs-identifier hs-var hs-var">rnRecUpdProj</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683069256"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683069256"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span> </span><span class="annot"><span class="annottext">XHsFieldBind
  (GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683069257"><span class="annot"><span class="annottext">GenLocated (EpAnn NoEpAnns) (FieldLabelStrings GhcPs)
</span><a href="#local-6989586621683069257"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621683069258"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683069258"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683069259"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683069259"><span class="hs-identifier hs-var">pun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2905"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683069260"><span class="annot"><a href="#local-6989586621683069260"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683069261"><span class="annot"><a href="#local-6989586621683069261"><span class="hs-identifier hs-var">fv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (XRec GhcRn (HsExpr GhcRn), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683069258"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-2906"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2907"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069256"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2908"></span><span>                         </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#hfbAnn"><span class="hs-identifier hs-var">hfbAnn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span>
</span><span id="line-2909"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnFieldLabelStrings"><span class="hs-identifier hs-type">rnFieldLabelStrings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683069257"><span class="hs-identifier hs-type">fs</span></a></span><span>
</span><span id="line-2910"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683069260"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-2911"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#hfbPun"><span class="hs-identifier hs-var">hfbPun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683069259"><span class="hs-identifier hs-type">pun</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683069261"><span class="hs-identifier hs-type">fv</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2912"></span></pre></body></html>