<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | Dynamically lookup up values from modules and loading them.</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html"><span class="hs-identifier">GHC.Runtime.Loader</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-5"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier">initializePlugins</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html#initializeSessionPlugins"><span class="hs-identifier">initializeSessionPlugins</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Loading plugins</span></span><span>
</span><span id="line-7"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#loadFrontendPlugin"><span class="hs-identifier">loadFrontendPlugin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Force loading information</span></span><span>
</span><span id="line-10"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#forceLoadModuleInterfaces"><span class="hs-identifier">forceLoadModuleInterfaces</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#forceLoadNameModuleInterface"><span class="hs-identifier">forceLoadNameModuleInterface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#forceLoadTyCon"><span class="hs-identifier">forceLoadTyCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Finding names</span></span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#lookupRdrNameInModuleForPlugins"><span class="hs-identifier">lookupRdrNameInModuleForPlugins</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Loading values</span></span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#getValueSafely"><span class="hs-identifier">getValueSafely</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#getHValueSafely"><span class="hs-identifier">getHValueSafely</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Loader.html#lessUnsafeCoerce"><span class="hs-identifier">lessUnsafeCoerce</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.External.html"><span class="hs-identifier">GHC.Driver.Plugins.External</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html"><span class="hs-identifier">GHC.Linker.Loader</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html#loadModule"><span class="hs-identifier">loadModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html#loadName"><span class="hs-identifier">loadName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier">wormhole</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Types</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html"><span class="hs-identifier">GHC.Rename.Names</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#gresFromAvails"><span class="hs-identifier">gresFromAvails</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier">initTcInteractive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier">initIfaceTcRn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#loadPluginInterface"><span class="hs-identifier">loadPluginInterface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Errors.html#cannotFindModule"><span class="hs-identifier">cannotFindModule</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#pluginTyConName"><span class="hs-identifier">pluginTyConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#frontendPluginTyConName"><span class="hs-identifier">frontendPluginTyConName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValue"><span class="hs-identifier">HValue</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier">mkTyConTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html"><span class="hs-identifier">GHC.Core.TyCo.Compare</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier">eqType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier">TyCon</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier">tyConName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier">noSrcSpan</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier">nameModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier">nameModule_maybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier">idType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html"><span class="hs-identifier">GHC.Types.PkgQual</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html"><span class="hs-identifier">GHC.Types.Name.Occurrence</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier">OccName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier">mkVarOccFS</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html"><span class="hs-identifier">GHC.Unit.Finder</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html#findPluginModule"><span class="hs-identifier">findPluginModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FindResult"><span class="hs-identifier">FindResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Finder.html"><span class="hs-identifier">GHC.Driver.Config.Finder</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier">initFinderOpts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initIfaceMessageOpts"><span class="hs-identifier">initIfaceMessageOpts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#thisGhcUnit"><span class="hs-identifier">thisGhcUnit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#GenModule"><span class="hs-identifier">GenModule</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier">moduleUnit</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier">IsBootInterface</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier">HasDebugCallStack</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Unsafe.Coerce.html"><span class="hs-identifier">Unsafe.Coerce</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">unsafeCoerce</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip4</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Ppr.html"><span class="hs-identifier">GHC.Iface.Errors.Ppr</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html"><span class="hs-identifier">GHC.Driver.Monad</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">{- Note [Timing of plugin initialization]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Plugins needs to be initialised as soon as possible in the pipeline. This is because
driver plugins are executed immediately after being loaded, which can modify anything
in the HscEnv, including the logger and DynFlags (for example #21279). For example,
in ghc/Main.hs the logger is used almost immediately after the session has been initialised
and so if a user overwrites the logger expecting all output to go there then unless
the plugins are initialised before that point then unexpected things will happen.

We initialise plugins in ghc/Main.hs for the main ghc executable.

When people are using the GHC API, they also need to initialise plugins
at the highest level possible for things to work as expected. We keep
some defensive calls to plugin initialisation in functions like `load'` and `oneshot`
to catch cases where API users have not initialised their own plugins.

In addition to this, there needs to be an initialisation call for each module
just in case the user has enabled a plugin just for that module using OPTIONS_GHC
pragma.

-}</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="annot"><span class="hs-comment">-- | Initialise plugins specified by the current DynFlags and update the session.</span></span><span>
</span><span id="line-104"></span><span id="local-6989586621683071156"><span class="annot"><a href="GHC.Runtime.Loader.html#initializeSessionPlugins"><span class="hs-identifier hs-type">initializeSessionPlugins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071156"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683071156"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-105"></span><span id="initializeSessionPlugins"><span class="annot"><span class="annottext">initializeSessionPlugins :: forall (m :: * -&gt; *). GhcMonad m =&gt; m ()
</span><a href="GHC.Runtime.Loader.html#initializeSessionPlugins"><span class="hs-identifier hs-var hs-var">initializeSessionPlugins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span> </span><span class="annot"><span class="annottext">m HscEnv -&gt; (HscEnv -&gt; m HscEnv) -&gt; m HscEnv
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO HscEnv -&gt; m HscEnv
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO HscEnv -&gt; m HscEnv)
-&gt; (HscEnv -&gt; IO HscEnv) -&gt; HscEnv -&gt; m HscEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
</span><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier hs-var">initializePlugins</span></a></span><span> </span><span class="annot"><span class="annottext">m HscEnv -&gt; (HscEnv -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Loads the plugins specified in the pluginModNames field of the dynamic</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- flags. Should be called after command line arguments are parsed, but before</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- actual compilation starts. Idempotent operation. Should be re-called if</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- pluginModNames or pluginModNameOpts changes.</span><span>
</span><span id="line-111"></span><span class="annot"><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier hs-type">initializePlugins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-112"></span><span id="initializePlugins"><span class="annot"><span class="annottext">initializePlugins :: HscEnv -&gt; IO HscEnv
</span><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier hs-var hs-var">initializePlugins</span></a></span></span><span> </span><span id="local-6989586621683071462"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- check that plugin specifications didn't change</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- dynamic plugins</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683071463"><span class="annot"><span class="annottext">[LoadedPlugin]
</span><a href="#local-6989586621683071463"><span class="hs-identifier hs-var">loaded_plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Plugins -&gt; [LoadedPlugin]
</span><a href="GHC.Driver.Plugins.html#loadedPlugins"><span class="hs-identifier hs-var">loadedPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(LoadedPlugin -&gt; ModuleName) -&gt; [LoadedPlugin] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin -&gt; ModuleName
</span><a href="GHC.Driver.Plugins.html#lpModuleName"><span class="hs-identifier hs-var">lpModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">[LoadedPlugin]
</span><a href="#local-6989586621683071463"><span class="hs-identifier hs-var">loaded_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; [ModuleName] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; [ModuleName]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [ModuleName]
</span><a href="GHC.Driver.DynFlags.html#pluginModNames"><span class="hs-identifier hs-var">pluginModNames</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071469"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(LoadedPlugin -&gt; Bool) -&gt; [LoadedPlugin] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin -&gt; Bool
</span><a href="#local-6989586621683071471"><span class="hs-identifier hs-var">same_args</span></a></span><span> </span><span class="annot"><span class="annottext">[LoadedPlugin]
</span><a href="#local-6989586621683071463"><span class="hs-identifier hs-var">loaded_plugins</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-comment">-- external plugins</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071472"><span class="annot"><span class="annottext">[ExternalPlugin]
</span><a href="#local-6989586621683071472"><span class="hs-identifier hs-var">external_plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Plugins -&gt; [ExternalPlugin]
</span><a href="GHC.Driver.Plugins.html#externalPlugins"><span class="hs-identifier hs-var">externalPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExternalPlugin] -&gt; [ExternalPluginSpec] -&gt; Bool
</span><a href="#local-6989586621683071474"><span class="hs-identifier hs-var">check_external_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">[ExternalPlugin]
</span><a href="#local-6989586621683071472"><span class="hs-identifier hs-var">external_plugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [ExternalPluginSpec]
</span><a href="GHC.Driver.DynFlags.html#externalPluginSpecs"><span class="hs-identifier hs-var">externalPluginSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071469"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-comment">-- ensure we have initialised static plugins</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(StaticPlugin -&gt; Bool) -&gt; [StaticPlugin] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">StaticPlugin -&gt; Bool
</span><a href="GHC.Driver.Plugins.html#spInitialised"><span class="hs-identifier hs-var">spInitialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Plugins -&gt; [StaticPlugin]
</span><a href="GHC.Driver.Plugins.html#staticPlugins"><span class="hs-identifier hs-var">staticPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-comment">-- no change, no need to reload plugins</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683071478"><span class="annot"><a href="#local-6989586621683071478"><span class="hs-identifier hs-var">loaded_plugins</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071479"><span class="annot"><a href="#local-6989586621683071479"><span class="hs-identifier hs-var">links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071480"><span class="annot"><a href="#local-6989586621683071480"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ([LoadedPlugin], [Linkable], PkgsLoaded)
</span><a href="GHC.Runtime.Loader.html#loadPlugins"><span class="hs-identifier hs-var">loadPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-131"></span><span>       </span><span id="local-6989586621683071482"><span class="annot"><a href="#local-6989586621683071482"><span class="hs-identifier hs-var">external_plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#loadExternalPlugins"><span class="hs-identifier hs-type">loadExternalPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#externalPluginSpecs"><span class="hs-identifier hs-var">externalPluginSpecs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071469"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071484"><span class="annot"><a href="#local-6989586621683071484"><span class="hs-identifier hs-var hs-var">plugins'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#staticPlugins"><span class="hs-identifier hs-var">staticPlugins</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683071485"><span class="annot"><span class="annottext">StaticPlugin
</span><a href="#local-6989586621683071485"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StaticPlugin
</span><a href="#local-6989586621683071485"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#spInitialised"><span class="hs-identifier hs-var">spInitialised</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#staticPlugins"><span class="hs-identifier hs-var">staticPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071462"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#externalPlugins"><span class="hs-identifier hs-var">externalPlugins</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683071482"><span class="hs-identifier hs-type">external_plugins</span></a></span><span>
</span><span id="line-134"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#loadedPlugins"><span class="hs-identifier hs-var">loadedPlugins</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683071478"><span class="hs-identifier hs-type">loaded_plugins</span></a></span><span>
</span><span id="line-135"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#loadedPluginDeps"><span class="hs-identifier hs-var">loadedPluginDeps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683071479"><span class="hs-identifier hs-type">links</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683071480"><span class="hs-identifier hs-type">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>                                            </span><span class="hs-special">}</span><span>
</span><span id="line-137"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071487"><span class="annot"><a href="#local-6989586621683071487"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683071484"><span class="hs-identifier hs-type">plugins'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>       </span><span class="annot"><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-type">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071487"><span class="hs-identifier hs-type">hsc_env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#driverPlugin"><span class="hs-identifier hs-var">driverPlugin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071487"><span class="hs-identifier hs-type">hsc_env'</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621683071469"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683071469"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071462"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">-- dynamic plugins</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621683071491"><span class="annot"><span class="annottext">plugin_args :: [(ModuleName, CommandLineOption)]
</span><a href="#local-6989586621683071491"><span class="hs-identifier hs-var hs-var">plugin_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [(ModuleName, CommandLineOption)]
</span><a href="GHC.Driver.DynFlags.html#pluginModNameOpts"><span class="hs-identifier hs-var">pluginModNameOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071469"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621683071471"><span class="annot"><span class="annottext">same_args :: LoadedPlugin -&gt; Bool
</span><a href="#local-6989586621683071471"><span class="hs-identifier hs-var hs-var">same_args</span></a></span></span><span> </span><span id="local-6989586621683071493"><span class="annot"><span class="annottext">LoadedPlugin
</span><a href="#local-6989586621683071493"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PluginWithArgs -&gt; [CommandLineOption]
</span><a href="GHC.Driver.Plugins.html#paArguments"><span class="hs-identifier hs-var">paArguments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoadedPlugin -&gt; PluginWithArgs
</span><a href="GHC.Driver.Plugins.html#lpPlugin"><span class="hs-identifier hs-var">lpPlugin</span></a></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin
</span><a href="#local-6989586621683071493"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CommandLineOption] -&gt; [CommandLineOption] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin
-&gt; [(ModuleName, CommandLineOption)] -&gt; [CommandLineOption]
forall {b}. LoadedPlugin -&gt; [(ModuleName, b)] -&gt; [b]
</span><a href="#local-6989586621683071496"><span class="hs-identifier hs-var">argumentsForPlugin</span></a></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin
</span><a href="#local-6989586621683071493"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, CommandLineOption)]
</span><a href="#local-6989586621683071491"><span class="hs-identifier hs-var">plugin_args</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621683071496"><span class="annot"><span class="annottext">argumentsForPlugin :: LoadedPlugin -&gt; [(ModuleName, b)] -&gt; [b]
</span><a href="#local-6989586621683071496"><span class="hs-identifier hs-var hs-var">argumentsForPlugin</span></a></span></span><span> </span><span id="local-6989586621683071498"><span class="annot"><span class="annottext">LoadedPlugin
</span><a href="#local-6989586621683071498"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ModuleName, b) -&gt; b) -&gt; [(ModuleName, b)] -&gt; [b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(ModuleName, b)] -&gt; [b])
-&gt; ([(ModuleName, b)] -&gt; [(ModuleName, b)])
-&gt; [(ModuleName, b)]
-&gt; [b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((ModuleName, b) -&gt; Bool) -&gt; [(ModuleName, b)] -&gt; [(ModuleName, b)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin -&gt; ModuleName
</span><a href="GHC.Driver.Plugins.html#lpModuleName"><span class="hs-identifier hs-var">lpModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">LoadedPlugin
</span><a href="#local-6989586621683071498"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; Bool)
-&gt; ((ModuleName, b) -&gt; ModuleName) -&gt; (ModuleName, b) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName, b) -&gt; ModuleName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- external plugins</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621683071506"><span class="annot"><span class="annottext">check_external_plugin :: ExternalPlugin -&gt; ExternalPluginSpec -&gt; Bool
</span><a href="#local-6989586621683071506"><span class="hs-identifier hs-var hs-var">check_external_plugin</span></a></span></span><span> </span><span id="local-6989586621683071507"><span class="annot"><span class="annottext">ExternalPlugin
</span><a href="#local-6989586621683071507"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683071508"><span class="annot"><span class="annottext">ExternalPluginSpec
</span><a href="#local-6989586621683071508"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ExternalPlugin -&gt; CommandLineOption
</span><a href="GHC.Driver.Plugins.html#epUnit"><span class="hs-identifier hs-var">epUnit</span></a></span><span>                </span><span class="annot"><span class="annottext">ExternalPlugin
</span><a href="#local-6989586621683071507"><span class="hs-identifier hs-var">p</span></a></span><span>  </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ExternalPluginSpec -&gt; CommandLineOption
</span><a href="GHC.Driver.Plugins.External.html#esp_unit_id"><span class="hs-identifier hs-var">esp_unit_id</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPluginSpec
</span><a href="#local-6989586621683071508"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExternalPlugin -&gt; CommandLineOption
</span><a href="GHC.Driver.Plugins.html#epModule"><span class="hs-identifier hs-var">epModule</span></a></span><span>              </span><span class="annot"><span class="annottext">ExternalPlugin
</span><a href="#local-6989586621683071507"><span class="hs-identifier hs-var">p</span></a></span><span>  </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ExternalPluginSpec -&gt; CommandLineOption
</span><a href="GHC.Driver.Plugins.External.html#esp_module"><span class="hs-identifier hs-var">esp_module</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPluginSpec
</span><a href="#local-6989586621683071508"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PluginWithArgs -&gt; [CommandLineOption]
</span><a href="GHC.Driver.Plugins.html#paArguments"><span class="hs-identifier hs-var">paArguments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalPlugin -&gt; PluginWithArgs
</span><a href="GHC.Driver.Plugins.html#epPlugin"><span class="hs-identifier hs-var">epPlugin</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPlugin
</span><a href="#local-6989586621683071507"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CommandLineOption] -&gt; [CommandLineOption] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ExternalPluginSpec -&gt; [CommandLineOption]
</span><a href="GHC.Driver.Plugins.External.html#esp_args"><span class="hs-identifier hs-var">esp_args</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPluginSpec
</span><a href="#local-6989586621683071508"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621683071474"><span class="annot"><span class="annottext">check_external_plugins :: [ExternalPlugin] -&gt; [ExternalPluginSpec] -&gt; Bool
</span><a href="#local-6989586621683071474"><span class="hs-identifier hs-var hs-var">check_external_plugins</span></a></span></span><span> </span><span id="local-6989586621683071516"><span class="annot"><span class="annottext">[ExternalPlugin]
</span><a href="#local-6989586621683071516"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span id="local-6989586621683071517"><span class="annot"><span class="annottext">[ExternalPluginSpec]
</span><a href="#local-6989586621683071517"><span class="hs-identifier hs-var">specs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExternalPlugin]
</span><a href="#local-6989586621683071516"><span class="hs-identifier hs-var">eps</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[ExternalPluginSpec]
</span><a href="#local-6989586621683071517"><span class="hs-identifier hs-var">specs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExternalPlugin]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- some external plugin removed</span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExternalPluginSpec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- some external plugin added</span><span>
</span><span id="line-155"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683071518"><span class="annot"><span class="annottext">ExternalPlugin
</span><a href="#local-6989586621683071518"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683071519"><span class="annot"><span class="annottext">[ExternalPlugin]
</span><a href="#local-6989586621683071519"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683071520"><span class="annot"><span class="annottext">ExternalPluginSpec
</span><a href="#local-6989586621683071520"><span class="hs-identifier hs-var">s</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683071521"><span class="annot"><span class="annottext">[ExternalPluginSpec]
</span><a href="#local-6989586621683071521"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExternalPlugin -&gt; ExternalPluginSpec -&gt; Bool
</span><a href="#local-6989586621683071506"><span class="hs-identifier hs-var">check_external_plugin</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPlugin
</span><a href="#local-6989586621683071518"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPluginSpec
</span><a href="#local-6989586621683071520"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[ExternalPlugin] -&gt; [ExternalPluginSpec] -&gt; Bool
</span><a href="#local-6989586621683071474"><span class="hs-identifier hs-var">check_external_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">[ExternalPlugin]
</span><a href="#local-6989586621683071519"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[ExternalPluginSpec]
</span><a href="#local-6989586621683071521"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="GHC.Runtime.Loader.html#loadPlugins"><span class="hs-identifier hs-type">loadPlugins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Plugins.html#LoadedPlugin"><span class="hs-identifier hs-type">LoadedPlugin</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span id="loadPlugins"><span class="annot"><span class="annottext">loadPlugins :: HscEnv -&gt; IO ([LoadedPlugin], [Linkable], PkgsLoaded)
</span><a href="GHC.Runtime.Loader.html#loadPlugins"><span class="hs-identifier hs-var hs-var">loadPlugins</span></a></span></span><span> </span><span id="local-6989586621683071523"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071523"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621683071525"><span class="hs-identifier hs-var">to_load</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-160"></span><span>           </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#checkExternalInterpreter"><span class="hs-identifier hs-var">checkExternalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071523"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-161"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683071527"><span class="annot"><a href="#local-6989586621683071527"><span class="hs-identifier hs-var">plugins_with_deps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; IO (Plugin, ModIface, [Linkable], PkgsLoaded))
-&gt; [ModuleName] -&gt; IO [(Plugin, ModIface, [Linkable], PkgsLoaded)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IO (Plugin, ModIface, [Linkable], PkgsLoaded)
</span><a href="#local-6989586621683071529"><span class="hs-identifier hs-var">loadPlugin</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621683071525"><span class="hs-identifier hs-var">to_load</span></a></span><span>
</span><span id="line-162"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683071530"><span class="annot"><a href="#local-6989586621683071530"><span class="hs-identifier hs-var">plugins</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071531"><span class="annot"><a href="#local-6989586621683071531"><span class="hs-identifier hs-var">ifaces</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071532"><span class="annot"><a href="#local-6989586621683071532"><span class="hs-identifier hs-var">links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071533"><span class="annot"><a href="#local-6989586621683071533"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip4</span></span><span> </span><span class="annot"><a href="#local-6989586621683071527"><span class="hs-identifier hs-type">plugins_with_deps</span></a></span><span>
</span><span id="line-163"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><a href="#local-6989586621683071535"><span class="hs-identifier hs-type">attachOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071525"><span class="hs-identifier hs-type">to_load</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621683071530"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071531"><span class="hs-identifier hs-type">ifaces</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621683071532"><span class="hs-identifier hs-type">links</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldl'</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html#plusUDFM"><span class="hs-identifier hs-type">plusUDFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html#emptyUDFM"><span class="hs-identifier hs-type">emptyUDFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071533"><span class="hs-identifier hs-type">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621683071540"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683071540"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071523"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621683071525"><span class="annot"><span class="annottext">to_load :: [ModuleName]
</span><a href="#local-6989586621683071525"><span class="hs-identifier hs-var hs-var">to_load</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; [ModuleName]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([ModuleName] -&gt; [ModuleName]) -&gt; [ModuleName] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [ModuleName]
</span><a href="GHC.Driver.DynFlags.html#pluginModNames"><span class="hs-identifier hs-var">pluginModNames</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071540"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621683071535"><span class="annot"><span class="annottext">attachOptions :: ModuleName -&gt; (Plugin, ModIface) -&gt; LoadedPlugin
</span><a href="#local-6989586621683071535"><span class="hs-identifier hs-var hs-var">attachOptions</span></a></span></span><span> </span><span id="local-6989586621683071541"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071541"><span class="hs-identifier hs-var">mod_nm</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683071542"><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683071542"><span class="hs-identifier hs-var">plug</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071543"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683071543"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><span class="annottext">PluginWithArgs -&gt; ModIface -&gt; LoadedPlugin
</span><a href="GHC.Driver.Plugins.html#LoadedPlugin"><span class="hs-identifier hs-var">LoadedPlugin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Plugin -&gt; [CommandLineOption] -&gt; PluginWithArgs
</span><a href="GHC.Driver.Plugins.html#PluginWithArgs"><span class="hs-identifier hs-var">PluginWithArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683071542"><span class="hs-identifier hs-var">plug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CommandLineOption] -&gt; [CommandLineOption]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[CommandLineOption]
</span><a href="#local-6989586621683071546"><span class="hs-identifier hs-var">options</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683071543"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>        </span><span id="local-6989586621683071546"><span class="annot"><span class="annottext">options :: [CommandLineOption]
</span><a href="#local-6989586621683071546"><span class="hs-identifier hs-var hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621683071547"><span class="hs-identifier hs-var">option</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683071548"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071548"><span class="hs-identifier hs-var">opt_mod_nm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071547"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621683071547"><span class="hs-identifier hs-var">option</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [(ModuleName, CommandLineOption)]
</span><a href="GHC.Driver.DynFlags.html#pluginModNameOpts"><span class="hs-identifier hs-var">pluginModNameOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071540"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-173"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071548"><span class="hs-identifier hs-var">opt_mod_nm</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071541"><span class="hs-identifier hs-var">mod_nm</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621683071529"><span class="annot"><span class="annottext">loadPlugin :: ModuleName -&gt; IO (Plugin, ModIface, [Linkable], PkgsLoaded)
</span><a href="#local-6989586621683071529"><span class="hs-identifier hs-var hs-var">loadPlugin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName
-&gt; Name
-&gt; HscEnv
-&gt; ModuleName
-&gt; IO (Plugin, ModIface, [Linkable], PkgsLoaded)
forall a.
OccName
-&gt; Name
-&gt; HscEnv
-&gt; ModuleName
-&gt; IO (a, ModIface, [Linkable], PkgsLoaded)
</span><a href="GHC.Runtime.Loader.html#loadPlugin%27"><span class="hs-identifier hs-var">loadPlugin'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;plugin&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#pluginTyConName"><span class="hs-identifier hs-var">pluginTyConName</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071523"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="annot"><a href="GHC.Runtime.Loader.html#loadFrontendPlugin"><span class="hs-identifier hs-type">loadFrontendPlugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Plugins.html#FrontendPlugin"><span class="hs-identifier hs-type">FrontendPlugin</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span id="loadFrontendPlugin"><span class="annot"><span class="annottext">loadFrontendPlugin :: HscEnv -&gt; ModuleName -&gt; IO (FrontendPlugin, [Linkable], PkgsLoaded)
</span><a href="GHC.Runtime.Loader.html#loadFrontendPlugin"><span class="hs-identifier hs-var hs-var">loadFrontendPlugin</span></a></span></span><span> </span><span id="local-6989586621683071551"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071551"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071552"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071552"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#checkExternalInterpreter"><span class="hs-identifier hs-var">checkExternalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683071553"><span class="annot"><a href="#local-6989586621683071553"><span class="hs-identifier hs-var">plugin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071554"><span class="annot"><a href="#local-6989586621683071554"><span class="hs-identifier hs-var">_iface</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071555"><span class="annot"><a href="#local-6989586621683071555"><span class="hs-identifier hs-var">links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071556"><span class="annot"><a href="#local-6989586621683071556"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName
-&gt; Name
-&gt; HscEnv
-&gt; ModuleName
-&gt; IO (FrontendPlugin, ModIface, [Linkable], PkgsLoaded)
forall a.
OccName
-&gt; Name
-&gt; HscEnv
-&gt; ModuleName
-&gt; IO (a, ModIface, [Linkable], PkgsLoaded)
</span><a href="GHC.Runtime.Loader.html#loadPlugin%27"><span class="hs-identifier hs-var">loadPlugin'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;frontendPlugin&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#frontendPluginTyConName"><span class="hs-identifier hs-var">frontendPluginTyConName</span></a></span><span>
</span><span id="line-182"></span><span>           </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071552"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683071553"><span class="hs-identifier hs-type">plugin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683071555"><span class="hs-identifier hs-type">links</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683071556"><span class="hs-identifier hs-type">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- #14335</span><span>
</span><span id="line-186"></span><span class="annot"><a href="GHC.Runtime.Loader.html#checkExternalInterpreter"><span class="hs-identifier hs-type">checkExternalInterpreter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span id="checkExternalInterpreter"><span class="annot"><span class="annottext">checkExternalInterpreter :: HscEnv -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#checkExternalInterpreter"><span class="hs-identifier hs-var hs-var">checkExternalInterpreter</span></a></span></span><span> </span><span id="local-6989586621683071557"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071557"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">(Interp -&gt; InterpInstance) -&gt; Maybe Interp -&gt; Maybe InterpInstance
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071557"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO ()
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Plugins require -fno-external-interpreter&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><span class="annottext">Maybe InterpInstance
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span id="local-6989586621683071236"><span class="annot"><a href="GHC.Runtime.Loader.html#loadPlugin%27"><span class="hs-identifier hs-type">loadPlugin'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683071236"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-193"></span><span id="loadPlugin%27"><span class="annot"><span class="annottext">loadPlugin' :: forall a.
OccName
-&gt; Name
-&gt; HscEnv
-&gt; ModuleName
-&gt; IO (a, ModIface, [Linkable], PkgsLoaded)
</span><a href="GHC.Runtime.Loader.html#loadPlugin%27"><span class="hs-identifier hs-var hs-var">loadPlugin'</span></a></span></span><span> </span><span id="local-6989586621683071595"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683071595"><span class="hs-identifier hs-var">occ_name</span></a></span></span><span> </span><span id="local-6989586621683071596"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071596"><span class="hs-identifier hs-var">plugin_name</span></a></span></span><span> </span><span id="local-6989586621683071597"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071597"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071598"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071598"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071599"><span class="annot"><span class="annottext">plugin_rdr_name :: RdrName
</span><a href="#local-6989586621683071599"><span class="hs-identifier hs-var hs-var hs-var">plugin_rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrQual"><span class="hs-identifier hs-var">mkRdrQual</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071598"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683071595"><span class="hs-identifier hs-var">occ_name</span></a></span><span>
</span><span id="line-195"></span><span>             </span><span id="local-6989586621683071601"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683071601"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071597"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-196"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683071602"><span class="annot"><a href="#local-6989586621683071602"><span class="hs-identifier hs-var">mb_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
HscEnv -&gt; ModuleName -&gt; RdrName -&gt; IO (Maybe (Name, ModIface))
HscEnv -&gt; ModuleName -&gt; RdrName -&gt; IO (Maybe (Name, ModIface))
</span><a href="GHC.Runtime.Loader.html#lookupRdrNameInModuleForPlugins"><span class="hs-identifier hs-var">lookupRdrNameInModuleForPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071597"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071598"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-197"></span><span>                        </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683071599"><span class="hs-identifier hs-var">plugin_rdr_name</span></a></span><span>
</span><span id="line-198"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683071602"><span class="hs-identifier hs-type">mb_name</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-199"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Name, ModIface)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-200"></span><span>                </span><span class="annot"><span class="annottext">GhcException -&gt; IO (a, ModIface, [Linkable], PkgsLoaded)
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; GhcException)
-&gt; CommandLineOption -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; CommandLineOption
</span><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071601"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; CommandLineOption) -&gt; SDoc -&gt; CommandLineOption
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span>
</span><span id="line-201"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;The module&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071598"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-202"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;did not export the plugin name&quot;</span></span><span>
</span><span id="line-203"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683071599"><span class="hs-identifier hs-var">plugin_rdr_name</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-204"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683071609"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071609"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071610"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683071610"><span class="hs-identifier hs-var">mod_iface</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683071611"><span class="annot"><a href="#local-6989586621683071611"><span class="hs-identifier hs-var">plugin_tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Name -&gt; IO TyCon
</span><a href="GHC.Runtime.Loader.html#forceLoadTyCon"><span class="hs-identifier hs-var">forceLoadTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071597"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071596"><span class="hs-identifier hs-var">plugin_name</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#thisGhcUnit"><span class="hs-identifier hs-type">thisGhcUnit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-type">nameModule</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683071611"><span class="hs-identifier hs-type">plugin_tycon</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-208"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-209"></span><span>                </span><span class="annot"><span class="annottext">GhcException -&gt; IO (a, ModIface, [Linkable], PkgsLoaded)
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; GhcException)
-&gt; CommandLineOption -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; CommandLineOption
</span><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071601"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; CommandLineOption) -&gt; SDoc -&gt; CommandLineOption
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span>
</span><span id="line-210"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;The plugin module&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071598"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-211"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;was built with a compiler that is incompatible with the one loading it&quot;</span></span><span>
</span><span id="line-212"></span><span>                          </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-213"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683071612"><span class="annot"><a href="#local-6989586621683071612"><span class="hs-identifier hs-var">eith_plugin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Name -&gt; Type -&gt; IO (Either Type (a, [Linkable], PkgsLoaded))
forall a.
HscEnv
-&gt; Name -&gt; Type -&gt; IO (Either Type (a, [Linkable], PkgsLoaded))
</span><a href="GHC.Runtime.Loader.html#getValueSafely"><span class="hs-identifier hs-var">getValueSafely</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071597"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071609"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683071611"><span class="hs-identifier hs-var">plugin_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683071612"><span class="hs-identifier hs-type">eith_plugin</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683071613"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071613"><span class="hs-identifier hs-var">actual_type</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>                </span><span class="annot"><span class="annottext">GhcException -&gt; IO (a, ModIface, [Linkable], PkgsLoaded)
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; GhcException)
-&gt; CommandLineOption -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-218"></span><span>                    </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState -&gt; NamePprCtx -&gt; SDoc -&gt; CommandLineOption
</span><a href="GHC.Driver.Ppr.html#showSDocForUser"><span class="hs-identifier hs-var">showSDocForUser</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071601"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; UnitState
UnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#ue_units"><span class="hs-identifier hs-var">ue_units</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071597"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>                      </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="GHC.Utils.Outputable.html#alwaysQualify"><span class="hs-identifier hs-var">alwaysQualify</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; CommandLineOption) -&gt; SDoc -&gt; CommandLineOption
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span>
</span><span id="line-220"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;The value&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071609"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-221"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;with type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071613"><span class="hs-identifier hs-var">actual_type</span></a></span><span>
</span><span id="line-222"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;did not have the type&quot;</span></span><span>
</span><span id="line-223"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;GHC.Plugins.Plugin&quot;</span></span><span>
</span><span id="line-224"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;as required&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683071618"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683071618"><span class="hs-identifier hs-var">plugin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071619"><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621683071619"><span class="hs-identifier hs-var">links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071620"><span class="annot"><span class="annottext">PkgsLoaded
</span><a href="#local-6989586621683071620"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, ModIface, [Linkable], PkgsLoaded)
-&gt; IO (a, ModIface, [Linkable], PkgsLoaded)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683071618"><span class="hs-identifier hs-var">plugin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683071610"><span class="hs-identifier hs-var">mod_iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621683071619"><span class="hs-identifier hs-var">links</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PkgsLoaded
</span><a href="#local-6989586621683071620"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | Force the interfaces for the given modules to be loaded. The 'SDoc' parameter is used</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- for debugging (@-ddump-if-trace@) only: it is shown as the reason why the module is being loaded.</span><span>
</span><span id="line-230"></span><span class="annot"><a href="GHC.Runtime.Loader.html#forceLoadModuleInterfaces"><span class="hs-identifier hs-type">forceLoadModuleInterfaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span id="forceLoadModuleInterfaces"><span class="annot"><span class="annottext">forceLoadModuleInterfaces :: HscEnv -&gt; SDoc -&gt; [GenModule Unit] -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#forceLoadModuleInterfaces"><span class="hs-identifier hs-var hs-var">forceLoadModuleInterfaces</span></a></span></span><span> </span><span id="local-6989586621683071621"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071621"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071622"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683071622"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621683071623"><span class="annot"><span class="annottext">[GenModule Unit]
</span><a href="#local-6989586621683071623"><span class="hs-identifier hs-var">modules</span></a></span></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TcM () -&gt; IO (Messages TcRnMessage, Maybe ())
forall a. HscEnv -&gt; TcM a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-var">initTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071621"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; IO (Messages TcRnMessage, Maybe ()))
-&gt; TcM () -&gt; IO (Messages TcRnMessage, Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-233"></span><span>       </span><span class="annot"><span class="annottext">IfG () -&gt; TcM ()
forall a. IfG a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-var">initIfaceTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">(IfG () -&gt; TcM ()) -&gt; IfG () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-234"></span><span>       </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; IOEnv (Env IfGblEnv ()) ModIface)
-&gt; [GenModule Unit] -&gt; IfG ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; GenModule Unit -&gt; IOEnv (Env IfGblEnv ()) ModIface
forall lcl. SDoc -&gt; GenModule Unit -&gt; IfM lcl ModIface
</span><a href="GHC.Iface.Load.html#loadPluginInterface"><span class="hs-identifier hs-var">loadPluginInterface</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683071622"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenModule Unit]
</span><a href="#local-6989586621683071623"><span class="hs-identifier hs-var">modules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="annottext">IO (Messages TcRnMessage, Maybe ()) -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">-- | Force the interface for the module containing the name to be loaded. The 'SDoc' parameter is used</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- for debugging (@-ddump-if-trace@) only: it is shown as the reason why the module is being loaded.</span><span>
</span><span id="line-239"></span><span class="annot"><a href="GHC.Runtime.Loader.html#forceLoadNameModuleInterface"><span class="hs-identifier hs-type">forceLoadNameModuleInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span id="forceLoadNameModuleInterface"><span class="annot"><span class="annottext">forceLoadNameModuleInterface :: HscEnv -&gt; SDoc -&gt; Name -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#forceLoadNameModuleInterface"><span class="hs-identifier hs-var hs-var">forceLoadNameModuleInterface</span></a></span></span><span> </span><span id="local-6989586621683071625"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071625"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071626"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683071626"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621683071627"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071627"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071628"><span class="annot"><span class="annottext">name_modules :: [GenModule Unit]
</span><a href="#local-6989586621683071628"><span class="hs-identifier hs-var hs-var">name_modules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe (GenModule Unit)) -&gt; [Name] -&gt; [GenModule Unit]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe (GenModule Unit)
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071627"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; SDoc -&gt; [GenModule Unit] -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#forceLoadModuleInterfaces"><span class="hs-identifier hs-var">forceLoadModuleInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071625"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683071626"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">[GenModule Unit]
</span><a href="#local-6989586621683071628"><span class="hs-identifier hs-var">name_modules</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Load the 'TyCon' associated with the given name, come hell or high water. Fails if:</span><span>
</span><span id="line-245"></span><span class="hs-comment">--</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- * The interface could not be loaded</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- * The name is not that of a 'TyCon'</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- * The name did not exist in the loaded module</span><span>
</span><span id="line-249"></span><span class="annot"><a href="GHC.Runtime.Loader.html#forceLoadTyCon"><span class="hs-identifier hs-type">forceLoadTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-250"></span><span id="forceLoadTyCon"><span class="annot"><span class="annottext">forceLoadTyCon :: HscEnv -&gt; Name -&gt; IO TyCon
</span><a href="GHC.Runtime.Loader.html#forceLoadTyCon"><span class="hs-identifier hs-var hs-var">forceLoadTyCon</span></a></span></span><span> </span><span id="local-6989586621683071629"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071629"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071630"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071630"><span class="hs-identifier hs-var">con_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; SDoc -&gt; Name -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#forceLoadNameModuleInterface"><span class="hs-identifier hs-var">forceLoadNameModuleInterface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071629"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;contains a name used in an invocation of loadTyConTy&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071630"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621683071631"><span class="annot"><a href="#local-6989586621683071631"><span class="hs-identifier hs-var">mb_con_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Name -&gt; IO (Maybe TyThing)
</span><a href="GHC.Driver.Env.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071629"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071630"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683071631"><span class="hs-identifier hs-type">mb_con_thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">Maybe TyThing
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO TyCon
forall a. DynFlags -&gt; SDoc -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-var">throwCmdLineErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071634"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO TyCon) -&gt; SDoc -&gt; IO TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Runtime.Loader.html#missingTyThingError"><span class="hs-identifier hs-var">missingTyThingError</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071630"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621683071637"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683071637"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; IO TyCon
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683071637"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683071638"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683071638"><span class="hs-identifier hs-var">con_thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO TyCon
forall a. DynFlags -&gt; SDoc -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-var">throwCmdLineErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071634"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO TyCon) -&gt; SDoc -&gt; IO TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyThing -&gt; SDoc
</span><a href="GHC.Runtime.Loader.html#wrongTyThingError"><span class="hs-identifier hs-var">wrongTyThingError</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071630"><span class="hs-identifier hs-var">con_name</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683071638"><span class="hs-identifier hs-var">con_thing</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683071634"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683071634"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071629"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- | Loads the value corresponding to a 'Name' if that value has the given 'Type'. This only provides limited safety</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- in that it is up to the user to ensure that that type corresponds to the type you try to use the return value at!</span><span>
</span><span id="line-262"></span><span class="hs-comment">--</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- If the value found was not of the correct type, returns @Left &lt;actual_type&gt;@. Any other condition results in an exception:</span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- * If we could not load the names module</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- * If the thing being loaded is not a value</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- * If the Name does not exist in the module</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- * If the link failed</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span id="local-6989586621683071262"><span class="annot"><a href="GHC.Runtime.Loader.html#getValueSafely"><span class="hs-identifier hs-type">getValueSafely</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683071262"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-271"></span><span id="getValueSafely"><span class="annot"><span class="annottext">getValueSafely :: forall a.
HscEnv
-&gt; Name -&gt; Type -&gt; IO (Either Type (a, [Linkable], PkgsLoaded))
</span><a href="GHC.Runtime.Loader.html#getValueSafely"><span class="hs-identifier hs-var hs-var">getValueSafely</span></a></span></span><span> </span><span id="local-6989586621683071644"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071644"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071645"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071645"><span class="hs-identifier hs-var">val_name</span></a></span></span><span> </span><span id="local-6989586621683071646"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071646"><span class="hs-identifier hs-var">expected_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>  </span><span id="local-6989586621683071647"><span class="annot"><a href="#local-6989586621683071647"><span class="hs-identifier hs-var">eith_hval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; Maybe
     (HscEnv
      -&gt; Name
      -&gt; Type
      -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded)))
</span><a href="GHC.Driver.Hooks.html#getValueSafelyHook"><span class="hs-identifier hs-var">getValueSafelyHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621683071649"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (HscEnv
   -&gt; Name
   -&gt; Type
   -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded)))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; HscEnv
-&gt; Name
-&gt; Type
-&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
</span><a href="GHC.Runtime.Loader.html#getHValueSafely"><span class="hs-identifier hs-var">getHValueSafely</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683071650"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071644"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071645"><span class="hs-identifier hs-var">val_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071646"><span class="hs-identifier hs-var">expected_type</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683071651"><span class="annot"><span class="annottext">HscEnv
-&gt; Name
-&gt; Type
-&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
</span><a href="#local-6989586621683071651"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Name
-&gt; Type
-&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
</span><a href="#local-6989586621683071651"><span class="hs-identifier hs-var">h</span></a></span><span>                      </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071644"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071645"><span class="hs-identifier hs-var">val_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071646"><span class="hs-identifier hs-var">expected_type</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683071647"><span class="hs-identifier hs-type">eith_hval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683071652"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071652"><span class="hs-identifier hs-var">actual_type</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Type (a, [Linkable], PkgsLoaded)
-&gt; IO (Either Type (a, [Linkable], PkgsLoaded))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Either Type (a, [Linkable], PkgsLoaded)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071652"><span class="hs-identifier hs-var">actual_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683071653"><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621683071653"><span class="hs-identifier hs-var">hval</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071654"><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621683071654"><span class="hs-identifier hs-var">links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071655"><span class="annot"><span class="annottext">PkgsLoaded
</span><a href="#local-6989586621683071655"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>      </span><span id="local-6989586621683071656"><span class="annot"><a href="#local-6989586621683071656"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; CommandLineOption -&gt; HValue -&gt; IO a
forall a b. Logger -&gt; CommandLineOption -&gt; a -&gt; IO b
</span><a href="GHC.Runtime.Loader.html#lessUnsafeCoerce"><span class="hs-identifier hs-var">lessUnsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683071657"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;getValueSafely&quot;</span></span><span> </span><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621683071653"><span class="hs-identifier hs-var">hval</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683071656"><span class="hs-identifier hs-type">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683071654"><span class="hs-identifier hs-type">links</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683071655"><span class="hs-identifier hs-type">pkgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621683071650"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621683071650"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071644"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621683071657"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683071657"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071644"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621683071649"><span class="annot"><span class="annottext">hooks :: Hooks
</span><a href="#local-6989586621683071649"><span class="hs-identifier hs-var hs-var">hooks</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071644"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><a href="GHC.Runtime.Loader.html#getHValueSafely"><span class="hs-identifier hs-type">getHValueSafely</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValue"><span class="hs-identifier hs-type">HValue</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span id="getHValueSafely"><span class="annot"><span class="annottext">getHValueSafely :: Interp
-&gt; HscEnv
-&gt; Name
-&gt; Type
-&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
</span><a href="GHC.Runtime.Loader.html#getHValueSafely"><span class="hs-identifier hs-var hs-var">getHValueSafely</span></a></span></span><span> </span><span id="local-6989586621683071661"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683071661"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621683071662"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071662"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071663"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071663"><span class="hs-identifier hs-var">val_name</span></a></span></span><span> </span><span id="local-6989586621683071664"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071664"><span class="hs-identifier hs-var">expected_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; SDoc -&gt; Name -&gt; IO ()
</span><a href="GHC.Runtime.Loader.html#forceLoadNameModuleInterface"><span class="hs-identifier hs-var">forceLoadNameModuleInterface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071662"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;contains a name used in an invocation of getHValueSafely&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071663"><span class="hs-identifier hs-var">val_name</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-comment">-- Now look up the names for the value and type constructor in the type environment</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621683071665"><span class="annot"><a href="#local-6989586621683071665"><span class="hs-identifier hs-var">mb_val_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Name -&gt; IO (Maybe TyThing)
</span><a href="GHC.Driver.Env.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071662"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071663"><span class="hs-identifier hs-var">val_name</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683071665"><span class="hs-identifier hs-type">mb_val_thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">Maybe TyThing
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; SDoc -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
forall a. DynFlags -&gt; SDoc -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-var">throwCmdLineErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071666"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded)))
-&gt; SDoc -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Runtime.Loader.html#missingTyThingError"><span class="hs-identifier hs-var">missingTyThingError</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071663"><span class="hs-identifier hs-var">val_name</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683071668"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683071668"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>            </span><span class="hs-comment">-- Check the value type in the interface against the type recovered from the type constructor</span><span>
</span><span id="line-294"></span><span>            </span><span class="hs-comment">-- before finally casting the value to the type we assume corresponds to that constructor</span><span>
</span><span id="line-295"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683071664"><span class="hs-identifier hs-var">expected_type</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683071668"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-296"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-comment">-- Link in the module that contains the value, if it has such a module</span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe (GenModule Unit)
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071663"><span class="hs-identifier hs-var">val_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-299"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683071669"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683071669"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; HscEnv -&gt; GenModule Unit -&gt; IO ()
</span><a href="GHC.Linker.Loader.html#loadModule"><span class="hs-identifier hs-var">loadModule</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683071661"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071662"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683071669"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-300"></span><span>                                   </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (GenModule Unit)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>                </span><span class="hs-comment">-- Find the value that we just linked in and cast it given that we have proved it's type</span><span>
</span><span id="line-303"></span><span>                </span><span id="local-6989586621683071670"><span class="annot"><a href="#local-6989586621683071670"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621683071671"><span class="annot"><a href="#local-6989586621683071671"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071672"><span class="annot"><a href="#local-6989586621683071672"><span class="hs-identifier hs-var">links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071673"><span class="annot"><a href="#local-6989586621683071673"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; HscEnv -&gt; Name -&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Linker.Loader.html#loadName"><span class="hs-identifier hs-var">loadName</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683071661"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071662"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071663"><span class="hs-identifier hs-var">val_name</span></a></span><span>
</span><span id="line-305"></span><span>                  </span><span id="local-6989586621683071674"><span class="annot"><a href="#local-6989586621683071674"><span class="hs-identifier hs-var">hv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier hs-type">wormhole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071661"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071671"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-306"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683071674"><span class="hs-identifier hs-type">hv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683071672"><span class="hs-identifier hs-type">links</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683071673"><span class="hs-identifier hs-type">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621683071670"><span class="hs-identifier hs-type">hval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either Type (HValue, [Linkable], PkgsLoaded)
-&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Either Type (HValue, [Linkable], PkgsLoaded)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683071668"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683071675"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683071675"><span class="hs-identifier hs-var">val_thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; SDoc -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
forall a. DynFlags -&gt; SDoc -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-var">throwCmdLineErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071666"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded)))
-&gt; SDoc -&gt; IO (Either Type (HValue, [Linkable], PkgsLoaded))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyThing -&gt; SDoc
</span><a href="GHC.Runtime.Loader.html#wrongTyThingError"><span class="hs-identifier hs-var">wrongTyThingError</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071663"><span class="hs-identifier hs-var">val_name</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683071675"><span class="hs-identifier hs-var">val_thing</span></a></span><span>
</span><span id="line-310"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683071666"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683071666"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071662"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="hs-comment">-- | Coerce a value as usual, but:</span><span>
</span><span id="line-313"></span><span class="hs-comment">--</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- 1) Evaluate it immediately to get a segfault early if the coercion was wrong</span><span>
</span><span id="line-315"></span><span class="hs-comment">--</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- 2) Wrap it in some debug messages at verbosity 3 or higher so we can see what happened</span><span>
</span><span id="line-317"></span><span class="hs-comment">--    if it /does/ segfault</span><span>
</span><span id="line-318"></span><span id="local-6989586621683071291"><span id="local-6989586621683071292"><span class="annot"><a href="GHC.Runtime.Loader.html#lessUnsafeCoerce"><span class="hs-identifier hs-type">lessUnsafeCoerce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683071291"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683071292"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-319"></span><span id="lessUnsafeCoerce"><span class="annot"><span class="annottext">lessUnsafeCoerce :: forall a b. Logger -&gt; CommandLineOption -&gt; a -&gt; IO b
</span><a href="GHC.Runtime.Loader.html#lessUnsafeCoerce"><span class="hs-identifier hs-var hs-var">lessUnsafeCoerce</span></a></span></span><span> </span><span id="local-6989586621683071686"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683071686"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621683071687"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621683071687"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621683071688"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683071688"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683071686"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Coercing a value in&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621683071687"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;...&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621683071692"><span class="annot"><a href="#local-6989586621683071692"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">evaluate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
forall a b. a -&gt; b
</span><span class="hs-identifier hs-var">unsafeCoerce</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683071688"><span class="hs-identifier hs-var">what</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-type">debugTraceMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683071686"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Successfully evaluated coercion&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683071692"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- | Finds the 'Name' corresponding to the given 'RdrName' in the</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- context of the 'ModuleName'. Returns @Nothing@ if no such 'Name'</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- could be found. Any other condition results in an exception:</span><span>
</span><span id="line-330"></span><span class="hs-comment">--</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- * If the module could not be found</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- * If we could not determine the imports of the module</span><span>
</span><span id="line-333"></span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- Can only be used for looking up names while loading plugins (and is</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- *not* suitable for use within plugins).  The interface file is</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- loaded very partially: just enough that it can be used, without its</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- rules and instances affecting (and being linked from!) the module</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- being compiled.  This was introduced by 57d6798.</span><span>
</span><span id="line-339"></span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- Need the module as well to record information in the interface file</span><span>
</span><span id="line-341"></span><span class="annot"><a href="GHC.Runtime.Loader.html#lookupRdrNameInModuleForPlugins"><span class="hs-identifier hs-type">lookupRdrNameInModuleForPlugins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-342"></span><span>                                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-343"></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span id="lookupRdrNameInModuleForPlugins"><span class="annot"><span class="annottext">lookupRdrNameInModuleForPlugins :: HasDebugCallStack =&gt;
HscEnv -&gt; ModuleName -&gt; RdrName -&gt; IO (Maybe (Name, ModIface))
</span><a href="GHC.Runtime.Loader.html#lookupRdrNameInModuleForPlugins"><span class="hs-identifier hs-var hs-var">lookupRdrNameInModuleForPlugins</span></a></span></span><span> </span><span id="local-6989586621683071705"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683071706"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071706"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span id="local-6989586621683071707"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683071707"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071708"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683071708"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071709"><span class="annot"><span class="annottext">fopts :: FinderOpts
</span><a href="#local-6989586621683071709"><span class="hs-identifier hs-var hs-var hs-var">fopts</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FinderOpts
</span><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier hs-var">initFinderOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071708"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071710"><span class="annot"><span class="annottext">fc :: FinderCache
</span><a href="#local-6989586621683071710"><span class="hs-identifier hs-var hs-var hs-var">fc</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071712"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621683071712"><span class="hs-identifier hs-var hs-var hs-var">unit_env</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071713"><span class="annot"><span class="annottext">unit_state :: UnitState
</span><a href="#local-6989586621683071713"><span class="hs-identifier hs-var hs-var hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; UnitState
UnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#ue_units"><span class="hs-identifier hs-var">ue_units</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683071712"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071714"><span class="annot"><span class="annottext">mhome_unit :: Maybe HomeUnit
</span><a href="#local-6989586621683071714"><span class="hs-identifier hs-var hs-var hs-var">mhome_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit_maybe"><span class="hs-identifier hs-var">hsc_home_unit_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- First find the unit the module resides in by searching exposed units and home modules</span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621683071716"><span class="annot"><a href="#local-6989586621683071716"><span class="hs-identifier hs-var">found_module</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FinderCache
-&gt; FinderOpts
-&gt; UnitState
-&gt; Maybe HomeUnit
-&gt; ModuleName
-&gt; IO FindResult
</span><a href="GHC.Unit.Finder.html#findPluginModule"><span class="hs-identifier hs-var">findPluginModule</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621683071710"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621683071709"><span class="hs-identifier hs-var">fopts</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621683071713"><span class="hs-identifier hs-var">unit_state</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><a href="#local-6989586621683071714"><span class="hs-identifier hs-var">mhome_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071706"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683071716"><span class="hs-identifier hs-type">found_module</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683071718"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683071718"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>            </span><span class="hs-comment">-- Find the exports of the module</span><span>
</span><span id="line-356"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683071719"><span class="annot"><a href="#local-6989586621683071719"><span class="hs-identifier hs-var">mb_iface</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcM ModIface -&gt; IO (Messages TcRnMessage, Maybe ModIface)
forall a. HscEnv -&gt; TcM a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-var">initTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ModIface -&gt; IO (Messages TcRnMessage, Maybe ModIface))
-&gt; TcM ModIface -&gt; IO (Messages TcRnMessage, Maybe ModIface)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-357"></span><span>                             </span><span class="annot"><span class="annottext">IOEnv (Env IfGblEnv ()) ModIface -&gt; TcM ModIface
forall a. IfG a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-var">initIfaceTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env IfGblEnv ()) ModIface -&gt; TcM ModIface)
-&gt; IOEnv (Env IfGblEnv ()) ModIface -&gt; TcM ModIface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-358"></span><span>                             </span><span class="annot"><span class="annottext">SDoc -&gt; GenModule Unit -&gt; IOEnv (Env IfGblEnv ()) ModIface
forall lcl. SDoc -&gt; GenModule Unit -&gt; IfM lcl ModIface
</span><a href="GHC.Iface.Load.html#loadPluginInterface"><span class="hs-identifier hs-var">loadPluginInterface</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683071720"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683071718"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-359"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683071719"><span class="hs-identifier hs-type">mb_iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683071721"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683071721"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>                    </span><span class="hs-comment">-- Try and find the required name in the exports</span><span>
</span><span id="line-362"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071722"><span class="annot"><span class="annottext">decl_spec :: ImpDeclSpec
</span><a href="#local-6989586621683071722"><span class="hs-identifier hs-var hs-var">decl_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_mod :: GenModule Unit
</span><a href="GHC.Types.Name.Reader.html#is_mod"><span class="hs-identifier hs-var">is_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683071718"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_as :: ModuleName
</span><a href="GHC.Types.Name.Reader.html#is_as"><span class="hs-identifier hs-var">is_as</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071706"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_pkg_qual :: PkgQual
</span><a href="GHC.Types.Name.Reader.html#is_pkg_qual"><span class="hs-identifier hs-var">is_pkg_qual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span>
</span><span id="line-363"></span><span>                                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_qual :: Bool
</span><a href="GHC.Types.Name.Reader.html#is_qual"><span class="hs-identifier hs-var">is_qual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_dloc :: SrcSpan
</span><a href="GHC.Types.Name.Reader.html#is_dloc"><span class="hs-identifier hs-var">is_dloc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_isboot :: IsBootInterface
</span><a href="GHC.Types.Name.Reader.html#is_isboot"><span class="hs-identifier hs-var">is_isboot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>                        </span><span id="local-6989586621683071731"><span class="annot"><span class="annottext">imp_spec :: ImportSpec
</span><a href="#local-6989586621683071731"><span class="hs-identifier hs-var hs-var">imp_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec -&gt; ImpItemSpec -&gt; ImportSpec
</span><a href="GHC.Types.Name.Reader.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a></span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683071722"><span class="hs-identifier hs-var">decl_spec</span></a></span><span> </span><span class="annot"><span class="annottext">ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a></span><span>
</span><span id="line-365"></span><span>                        </span><span id="local-6989586621683071734"><span class="annot"><span class="annottext">env :: GlobalRdrEnv
</span><a href="#local-6989586621683071734"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a></span><span>
</span><span id="line-366"></span><span>                            </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; GlobalRdrEnv) -&gt; [GlobalRdrElt] -&gt; GlobalRdrEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe ImportSpec -&gt; [AvailInfo] -&gt; [GlobalRdrElt]
</span><a href="GHC.Rename.Names.html#gresFromAvails"><span class="hs-identifier hs-var">gresFromAvails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportSpec -&gt; Maybe ImportSpec
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683071731"><span class="hs-identifier hs-var">imp_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; [AvailInfo]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [AvailInfo]
</span><a href="GHC.Unit.Module.ModIface.html#mi_exports"><span class="hs-identifier hs-var">mi_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683071721"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683071734"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; WhichGREs GREInfo -&gt; LookupGRE GREInfo
forall info. RdrName -&gt; WhichGREs info -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupRdrName"><span class="hs-identifier hs-var">LookupRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683071707"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-368"></span><span>                        </span><span class="hs-special">[</span><span id="local-6989586621683071741"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683071741"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Name, ModIface) -&gt; IO (Maybe (Name, ModIface))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name, ModIface) -&gt; Maybe (Name, ModIface)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683071741"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683071721"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Name, ModIface) -&gt; IO (Maybe (Name, ModIface))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Name, ModIface)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-370"></span><span>                        </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; IO (Maybe (Name, ModIface))
forall a. HasCallStack =&gt; CommandLineOption -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;lookupRdrNameInModule&quot;</span></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>                </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO (Maybe (Name, ModIface))
forall a. DynFlags -&gt; SDoc -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-var">throwCmdLineErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071708"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO (Maybe (Name, ModIface)))
-&gt; SDoc -&gt; IO (Maybe (Name, ModIface))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Could not determine the exports of the module&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071706"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621683071744"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621683071744"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683071745"><span class="annot"><span class="annottext">opts :: DiagnosticOpts IfaceMessage
</span><a href="#local-6989586621683071745"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagnosticOpts IfaceMessage
</span><a href="GHC.Driver.Config.Diagnostic.html#initIfaceMessageOpts"><span class="hs-identifier hs-var">initIfaceMessageOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071708"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-375"></span><span>              </span><span id="local-6989586621683071746"><span class="annot"><span class="annottext">err_txt :: SDoc
</span><a href="#local-6989586621683071746"><span class="hs-identifier hs-var hs-var">err_txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceMessageOpts -&gt; MissingInterfaceError -&gt; SDoc
</span><a href="GHC.Iface.Errors.Ppr.html#missingInterfaceErrorDiagnostic"><span class="hs-identifier hs-var">missingInterfaceErrorDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticOpts IfaceMessage
IfaceMessageOpts
</span><a href="#local-6989586621683071745"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-376"></span><span>                      </span><span class="annot"><span class="annottext">(MissingInterfaceError -&gt; SDoc) -&gt; MissingInterfaceError -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; FindResult -&gt; MissingInterfaceError
</span><a href="GHC.Iface.Errors.html#cannotFindModule"><span class="hs-identifier hs-var">cannotFindModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683071705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683071706"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621683071744"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-377"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO (Maybe (Name, ModIface))
forall a. DynFlags -&gt; SDoc -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-var">throwCmdLineErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071708"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683071746"><span class="hs-identifier hs-var">err_txt</span></a></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621683071720"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683071720"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;contains a name used in an invocation of lookupRdrNameInModule&quot;</span></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="GHC.Runtime.Loader.html#wrongTyThingError"><span class="hs-identifier hs-type">wrongTyThingError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-382"></span><span id="wrongTyThingError"><span class="annot"><span class="annottext">wrongTyThingError :: Name -&gt; TyThing -&gt; SDoc
</span><a href="GHC.Runtime.Loader.html#wrongTyThingError"><span class="hs-identifier hs-var hs-var">wrongTyThingError</span></a></span></span><span> </span><span id="local-6989586621683071751"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071751"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683071752"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683071752"><span class="hs-identifier hs-var">got_thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;The name&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071751"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;is not that of a value but rather a&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; SDoc
</span><a href="GHC.Types.TyThing.html#pprTyThingCategory"><span class="hs-identifier hs-var">pprTyThingCategory</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683071752"><span class="hs-identifier hs-var">got_thing</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="GHC.Runtime.Loader.html#missingTyThingError"><span class="hs-identifier hs-type">missingTyThingError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-385"></span><span id="missingTyThingError"><span class="annot"><span class="annottext">missingTyThingError :: Name -&gt; SDoc
</span><a href="GHC.Runtime.Loader.html#missingTyThingError"><span class="hs-identifier hs-var hs-var">missingTyThingError</span></a></span></span><span> </span><span id="local-6989586621683071754"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071754"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;The name&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683071754"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;is not in the type environment: are you sure it exists?&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span id="local-6989586621683071284"><span class="annot"><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-type">throwCmdLineErrorS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683071284"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-388"></span><span id="throwCmdLineErrorS"><span class="annot"><span class="annottext">throwCmdLineErrorS :: forall a. DynFlags -&gt; SDoc -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineErrorS"><span class="hs-identifier hs-var hs-var">throwCmdLineErrorS</span></a></span></span><span> </span><span id="local-6989586621683071755"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071755"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; IO a
forall a. CommandLineOption -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineError"><span class="hs-identifier hs-var">throwCmdLineError</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; IO a)
-&gt; (SDoc -&gt; CommandLineOption) -&gt; SDoc -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; CommandLineOption
</span><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683071755"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span id="local-6989586621683071334"><span class="annot"><a href="GHC.Runtime.Loader.html#throwCmdLineError"><span class="hs-identifier hs-type">throwCmdLineError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683071334"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-391"></span><span id="throwCmdLineError"><span class="annot"><span class="annottext">throwCmdLineError :: forall a. CommandLineOption -&gt; IO a
</span><a href="GHC.Runtime.Loader.html#throwCmdLineError"><span class="hs-identifier hs-var hs-var">throwCmdLineError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; IO a)
-&gt; (CommandLineOption -&gt; GhcException) -&gt; CommandLineOption -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span>
</span><span id="line-392"></span></pre></body></html>